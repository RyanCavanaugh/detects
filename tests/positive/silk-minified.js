var SILK_DEBUGGING = false;
(function (window) {

// in nodejs, global is an object
// in normal browser environment, global is undefined
// in webpack, global is set to window
var isNodeJs   = typeof global !== "undefined" && global.window === undefined;
var isCommonJs = typeof module === "object" && module && typeof module.exports === "object";

// require, that the nodejs will handle, but will remain not processed by webpack and the like
var obfuscatedRequire = function (moduleName)
{
  return module["r" + "equire"](moduleName);
}

var SilkApi =
  function (url, secureUrl, modifyRequest)
  {
    var self = this;
    var postfix          = '/v' + this.version + '/';
    var contextUrl       = url + postfix;
    var secureContextUrl = (secureUrl || url.replace(/^http:/, "https:")) + postfix;

    this.cookieJar = isNodeJs ? obfuscatedRequire('request').jar() : undefined;

    if(!modifyRequest) modifyRequest = function (req) { return req; };

    var finalModifyRequest = function (req)
    {
      if (isNodeJs) req.jar = self.cookieJar;
      return modifyRequest(req);
    }

    SilkApi.setContext(this, contextUrl, secureContextUrl, finalModifyRequest);
  };

var jqFun;
if (isNodeJs)
{
  // Export as Node module.
  module.exports = SilkApi;

  SilkApi.ajaxCall = nodeRequest;
}
else
{
  if (isCommonJs) {
    // Export as CommonJs
    module.exports = SilkApi;
    jqFun = function () { return require("jquery"); };
  } else if (typeof define === "function" && define.amd) {
    // Export as AMD.
    define("SilkApi", [], function () { return SilkApi; });
    jqFun = function () { return window.$; };
  } else {
    // Export as global.
    window.SilkApi = SilkApi;
    jqFun = function () { return window.$; };
  }

  SilkApi.ajaxCall = jQueryRequest;
}

SilkApi.addObject = function (obj1, obj2)
{
  for (var fld in obj2)
    obj1[fld] = obj2[fld];
};

SilkApi.defaultAjaxOptions = {};
SilkApi.defaultHeaders = {};

function jQueryRequest (method, url, params, success, error, contentType, acceptHeader, data, callOpts, modifyRequest)
{
  var q = window.Q || function (a) { return a };
  var jq = jqFun();

  var headers = jq.extend(true, {}, SilkApi.defaultHeaders);
  SilkApi.addObject(headers, { Accept : acceptHeader });

  var callData =
    { type        : method
    , url         : url + (params ? '?' + jq.param(params) : '')
    , cache       : false
    , success     : success || function () {}
    , error       : error || function () {}
    , contentType : contentType
    , headers     : headers
    , xhrFields   : { withCredentials: true }
    , data        : data || []
    };

  callData = modifyRequest(callData);

  SilkApi.addObject(callData, SilkApi.defaultAjaxOptions);
  SilkApi.addObject(callData, callOpts);

  return q(jq.ajax(callData));
}

function nodeRequest (method, url, params, onSuccess, onError, contentType, acceptHeader, data, callOpts, modifyRequest)
{
  var allParams = {};
  SilkApi.addObject(allParams, params);

  if (method === "GET" || method === "HEAD")
    // Avoid cached API responses.
    allParams._ = Date.now();

  var headers = { "Content-type" : contentType
                , "Accept"       : acceptHeader
                };

  SilkApi.addObject(headers, SilkApi.defaultHeaders);

  var callData =
    { url     : url
    , qs      : allParams
    , method  : method
    , headers : headers
    };

  if (data) callData.body = data;

  callData = modifyRequest(callData);

  SilkApi.addObject(callData, SilkApi.defaultAjaxOptions);
  SilkApi.addObject(callData, callOpts);

  return require("q").Promise(function (resolve, reject)
  {
    obfuscatedRequire("request")(callData, callback);

    function callback (error, message, body)
    {
      if (message && message.statusCode >= 200 && message.statusCode < 300)
      {
        var parsedResponse = parse(body);
        onSuccess && onSuccess(parsedResponse, message);
        resolve(parsedResponse)
      }
      else
      {
        if (!error)
        {
          error = new Error("HTTP request error");
          error.statusCode = message.statusCode;
          error.responseBody = body;
        }

        error.response = parse(body);

        if (onError)
          onError(error);

        reject(error);
      }
    }
  });

  function parse (response)
  {
    if (acceptHeader.split(";").indexOf('text/json') >= 0)
    {
      var r = response;
      try
      {
        r = JSON.parse(response);
      }
      catch (e)
      {
        return r;
      }
      return r;
    }
    else return response;
  }
}

SilkApi.setContext =
  function (obj, url, secureUrl, modifyRequest)
  {
    obj.contextUrl = url;
    obj.secureContextUrl = secureUrl;
    obj.modifyRequest = modifyRequest;
    for (var fld in obj)
    {
      if (obj[fld] != undefined && obj[fld].apiObjectType != undefined && obj[fld].apiObjectType == 'resourceDir')
      {
        var postfix = fld.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase() + '/';
        SilkApi.setContext(obj[fld], url + postfix, secureUrl + postfix, modifyRequest);
      }
    }
  };SilkApi.prototype.version = "1.13.4";
SilkApi.prototype.Error =
  function Error (url, secureUrl, modifyRequest)
  {
    if (this instanceof Error)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Error.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Error.apiObjectType = "resourceDir";
SilkApi.prototype.Error.create =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + '', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Metric =
  function Metric (url, secureUrl, modifyRequest)
  {
    if (this instanceof Metric)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Metric.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Metric.apiObjectType = "resourceDir";
SilkApi.prototype.Metric.create =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + '', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site =
  function Site (url, secureUrl, modifyRequest)
  {
    if (this instanceof Site)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Site.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.apiObjectType = "resourceDir";
SilkApi.prototype.Site.byUri =
  function (repositoryURI)
  {
    var postfix = 'uri/' + encodeURIComponent(repositoryURI) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.listBySearch =
  function (string, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'search/' + encodeURIComponent(string) + '/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.saveByUri =
  function (repositoryURI, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'uri/' + encodeURIComponent(repositoryURI) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.saveManyByUri =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'uri/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.available =
  function (text, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'available/', params, success, error, "text/plain", "text/json", text, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.suggest =
  function (text, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'suggest/', params, success, error, "text/plain", "text/plain,text/json", text, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.remove =
  function (text, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.secureContextUrl + '', params, success, error, "text/plain", "text/json", text, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.getImportStatus =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'import-status/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.enrich =
  function (xml, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'enrich/', params, success, error, "text/xml", "text/xml", xml, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.query =
  function (text, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'query/', params, success, error, "text/plain", "text/xml", text, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.wipe =
  function (text, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.secureContextUrl + 'wipe/', params, success, error, "text/plain", "text/json", text, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.suggestPage =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'suggest-page/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Feed =
  function Feed (url, secureUrl, modifyRequest)
  {
    if (this instanceof Feed)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Feed.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Feed.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Feed.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Feed.listDocument =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'document/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.File =
  function File (url, secureUrl, modifyRequest)
  {
    if (this instanceof File)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return File.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.File.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.File.byId =
  function (uuid)
  {
    var postfix = 'id/' + encodeURIComponent(uuid) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json,application/octet-stream", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.File.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.File.saveById =
  function (uuid, file, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'id/' + encodeURIComponent(uuid) + '/', params, success, error, "application/octet-stream", "text/json", file, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.File.create =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + '', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.File.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Geodata =
  function Geodata (url, secureUrl, modifyRequest)
  {
    if (this instanceof Geodata)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Geodata.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Geodata.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Geodata.save =
  function (string, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + '' + encodeURIComponent(string) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Geodata.saveMany =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + '', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import =
  function Import (url, secureUrl, modifyRequest)
  {
    if (this instanceof Import)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Import.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Import.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Import.byId =
  function (uuid)
  {
    var postfix = 'id/' + encodeURIComponent(uuid) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Import.latest =
  function ()
  {
    var postfix = 'latest/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Import.saveById =
  function (uuid, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'id/' + encodeURIComponent(uuid) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.saveManyById =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'id/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.removeManyById =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + 'id/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.saveLatest =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'latest/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.upload =
  function (file, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'upload/', params, success, error, "application/octet-stream", "text/json", file, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.uploadJson =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'upload-json/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.uploadUrl =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'upload-url/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.uploadSheetsUrl =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'upload-sheets-url/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.uploadSheets =
  function (file, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'upload-sheets/', params, success, error, "application/octet-stream", "text/json", file, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.selectSheet =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'select-sheet/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.prototype.remove =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.prototype.getPreview =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'preview/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.prototype.getProgress =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'progress/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.prototype.start =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'start/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Import.prototype.reset =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'reset/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Invite =
  function Invite (url, secureUrl, modifyRequest)
  {
    if (this instanceof Invite)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Invite.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Invite.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Invite.byEmail =
  function (emailaddress)
  {
    var postfix = 'email/' + encodeURIComponent(emailaddress) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Invite.byCode =
  function (uuid)
  {
    var postfix = 'code/' + encodeURIComponent(uuid) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Invite.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Invite.saveByEmail =
  function (emailaddress, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'email/' + encodeURIComponent(emailaddress) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Invite.saveManyByEmail =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'email/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Invite.removeManyByEmail =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + 'email/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Invite.saveByCode =
  function (uuid, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'code/' + encodeURIComponent(uuid) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Invite.saveManyByCode =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'code/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Invite.removeManyByCode =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + 'code/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Invite.prototype.remove =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Invite.prototype.accept =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'accept/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Invite.prototype.resend =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'resend/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page =
  function Page (url, secureUrl, modifyRequest)
  {
    if (this instanceof Page)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Page.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Page.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Page.access =
  function (name)
  {
    var postfix = '' + encodeURIComponent(name) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Page.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.save =
  function (name, xml, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + '' + encodeURIComponent(name) + '/', params, success, error, "text/xml", "text/json", xml, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.removeMany =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.remove =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.getTransformed =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'transformed/', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.getPinned =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'pinned/', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.getTransformedPinned =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'transformed-pinned/', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Autosave =
  function Autosave (url, secureUrl, modifyRequest)
  {
    if (this instanceof Autosave)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Autosave.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Page.prototype.Autosave.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Page.prototype.Autosave.byId =
  function (uuid)
  {
    var postfix = 'id/' + encodeURIComponent(uuid) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Page.prototype.Autosave.current =
  function ()
  {
    var postfix = 'current/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Page.prototype.Autosave.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Autosave.saveById =
  function (uuid, xml, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'id/' + encodeURIComponent(uuid) + '/', params, success, error, "text/xml", "text/json", xml, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Autosave.removeManyById =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + 'id/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Autosave.saveCurrent =
  function (xml, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'current/', params, success, error, "text/xml", "text/json", xml, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Autosave.prototype.remove =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Autosave.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Autosave.prototype.getTransformed =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'transformed/', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Diff =
  function Diff (url, secureUrl, modifyRequest)
  {
    if (this instanceof Diff)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Diff.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Page.prototype.Diff.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Page.prototype.Diff.access =
  function ()
  {
    var postfix = '';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Page.prototype.Version =
  function Version (url, secureUrl, modifyRequest)
  {
    if (this instanceof Version)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Version.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Page.prototype.Version.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Page.prototype.Version.byId =
  function (integer)
  {
    var postfix = 'id/' + encodeURIComponent(integer) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Page.prototype.Version.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Version.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Version.prototype.restore =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'restore/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Version.prototype.Revision =
  function Revision (url, secureUrl, modifyRequest)
  {
    if (this instanceof Revision)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Revision.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Page.prototype.Version.prototype.Revision.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Page.prototype.Version.prototype.Revision.byId =
  function (integer)
  {
    var postfix = 'id/' + encodeURIComponent(integer) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Page.prototype.Version.prototype.Revision.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Page.prototype.Version.prototype.Revision.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Permission =
  function Permission (url, secureUrl, modifyRequest)
  {
    if (this instanceof Permission)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Permission.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Permission.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Permission.current =
  function ()
  {
    var postfix = 'current/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Permission.byId =
  function (account)
  {
    var postfix = 'id/' + encodeURIComponent(account) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Permission.byEmail =
  function (emailaddress)
  {
    var postfix = 'email/' + encodeURIComponent(emailaddress) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Permission.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Permission.saveCurrent =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'current/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Permission.saveById =
  function (account, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'id/' + encodeURIComponent(account) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Permission.saveManyById =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'id/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Permission.removeManyById =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + 'id/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Permission.saveByEmail =
  function (emailaddress, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'email/' + encodeURIComponent(emailaddress) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Permission.saveManyByEmail =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'email/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Permission.removeManyByEmail =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + 'email/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Permission.prototype.remove =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Pin =
  function Pin (url, secureUrl, modifyRequest)
  {
    if (this instanceof Pin)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Pin.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Pin.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Pin.byCollection =
  function (name)
  {
    var postfix = 'collection/' + encodeURIComponent(name) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Pin.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Pin.saveByCollection =
  function (name, xml, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'collection/' + encodeURIComponent(name) + '/', params, success, error, "text/xml", "text/json", xml, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Pin.removeManyByCollection =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + 'collection/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Pin.prototype.remove =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Pin.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Pin.prototype.Version =
  function Version (url, secureUrl, modifyRequest)
  {
    if (this instanceof Version)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Version.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Pin.prototype.Version.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Pin.prototype.Version.byId =
  function (integer)
  {
    var postfix = 'id/' + encodeURIComponent(integer) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Pin.prototype.Version.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Pin.prototype.Version.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Pin.prototype.Version.prototype.restore =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'restore/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Pin.prototype.Version.prototype.Revision =
  function Revision (url, secureUrl, modifyRequest)
  {
    if (this instanceof Revision)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Revision.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Pin.prototype.Version.prototype.Revision.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Pin.prototype.Version.prototype.Revision.byId =
  function (integer)
  {
    var postfix = 'id/' + encodeURIComponent(integer) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Pin.prototype.Version.prototype.Revision.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Pin.prototype.Version.prototype.Revision.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.QueryLog =
  function QueryLog (url, secureUrl, modifyRequest)
  {
    if (this instanceof QueryLog)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return QueryLog.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.QueryLog.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.QueryLog.create =
  function (text, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + '', params, success, error, "text/plain", "text/json", text, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Subscription =
  function Subscription (url, secureUrl, modifyRequest)
  {
    if (this instanceof Subscription)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Subscription.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Subscription.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Subscription.byId =
  function (uuid)
  {
    var postfix = 'id/' + encodeURIComponent(uuid) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Subscription.current =
  function ()
  {
    var postfix = 'current/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Subscription.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Subscription.saveById =
  function (uuid, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'id/' + encodeURIComponent(uuid) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Subscription.saveManyById =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'id/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Subscription.removeManyById =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + 'id/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Subscription.saveCurrent =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'current/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Subscription.prototype.remove =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Tag =
  function Tag (url, secureUrl, modifyRequest)
  {
    if (this instanceof Tag)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Tag.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Tag.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Tag.access =
  function (name)
  {
    var postfix = '' + encodeURIComponent(name) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Tag.save =
  function (name, xml, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + '' + encodeURIComponent(name) + '/', params, success, error, "text/xml", "text/json", xml, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Tag.removeMany =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Tag.prototype.remove =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Tag.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Tag.prototype.Version =
  function Version (url, secureUrl, modifyRequest)
  {
    if (this instanceof Version)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Version.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Tag.prototype.Version.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Tag.prototype.Version.byId =
  function (integer)
  {
    var postfix = 'id/' + encodeURIComponent(integer) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Tag.prototype.Version.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Tag.prototype.Version.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Tag.prototype.Version.prototype.restore =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'restore/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Tag.prototype.Version.prototype.Revision =
  function Revision (url, secureUrl, modifyRequest)
  {
    if (this instanceof Revision)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Revision.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Tag.prototype.Version.prototype.Revision.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Tag.prototype.Version.prototype.Revision.byId =
  function (integer)
  {
    var postfix = 'id/' + encodeURIComponent(integer) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.Site.prototype.Tag.prototype.Version.prototype.Revision.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Tag.prototype.Version.prototype.Revision.prototype.getMetadata =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'metadata/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.Site.prototype.Taglist =
  function Taglist (url, secureUrl, modifyRequest)
  {
    if (this instanceof Taglist)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Taglist.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.Site.prototype.Taglist.apiObjectType = "resourceDir";
SilkApi.prototype.Site.prototype.Taglist.access =
  function ()
  {
    var postfix = '';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/xml", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.User =
  function User (url, secureUrl, modifyRequest)
  {
    if (this instanceof User)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return User.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.User.apiObjectType = "resourceDir";
SilkApi.prototype.User.byId =
  function (uuid)
  {
    var postfix = 'id/' + encodeURIComponent(uuid) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.User.byEmail =
  function (emailaddress)
  {
    var postfix = 'email/' + encodeURIComponent(emailaddress) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.User.byResetCode =
  function (uuid)
  {
    var postfix = 'reset-code/' + encodeURIComponent(uuid) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.User.current =
  function ()
  {
    var postfix = 'current/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.User.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.listBySearch =
  function (string, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + 'search/' + encodeURIComponent(string) + '/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.saveById =
  function (uuid, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'id/' + encodeURIComponent(uuid) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.saveManyById =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'id/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.saveByEmail =
  function (emailaddress, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'email/' + encodeURIComponent(emailaddress) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.saveManyByEmail =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'email/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.saveByResetCode =
  function (uuid, json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'reset-code/' + encodeURIComponent(uuid) + '/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.saveManyByResetCode =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'reset-code/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.saveCurrent =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'current/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.signin =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'signin/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.requestPassword =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'request-password/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.resetPassword =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'reset-password/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.getSessionMigration =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'get-session-migration/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.useSessionMigration =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'use-session-migration/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.unsubscribeDigests =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'unsubscribe-digests/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.unsubscribeNews =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'unsubscribe-news/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.create =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.secureContextUrl + '', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.remove =
  function (text, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.secureContextUrl + '', params, success, error, "text/plain", "text/json", text, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.signout =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'signout/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.become =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("POST", this.contextUrl + 'become/', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.Autosave =
  function Autosave (url, secureUrl, modifyRequest)
  {
    if (this instanceof Autosave)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Autosave.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.User.prototype.Autosave.apiObjectType = "resourceDir";
SilkApi.prototype.User.prototype.Autosave.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.Feed =
  function Feed (url, secureUrl, modifyRequest)
  {
    if (this instanceof Feed)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Feed.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.User.prototype.Feed.apiObjectType = "resourceDir";
SilkApi.prototype.User.prototype.Feed.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.Permission =
  function Permission (url, secureUrl, modifyRequest)
  {
    if (this instanceof Permission)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Permission.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.User.prototype.Permission.apiObjectType = "resourceDir";
SilkApi.prototype.User.prototype.Permission.access =
  function ()
  {
    var postfix = '';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.User.prototype.Quotum =
  function Quotum (url, secureUrl, modifyRequest)
  {
    if (this instanceof Quotum)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Quotum.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.User.prototype.Quotum.apiObjectType = "resourceDir";
SilkApi.prototype.User.prototype.Quotum.site =
  function ()
  {
    var postfix = 'site/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/plain,text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.User.prototype.Storage =
  function Storage (url, secureUrl, modifyRequest)
  {
    if (this instanceof Storage)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Storage.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.User.prototype.Storage.apiObjectType = "resourceDir";
SilkApi.prototype.User.prototype.Storage.byKey =
  function (string)
  {
    var postfix = 'key/' + encodeURIComponent(string) + '/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };
SilkApi.prototype.User.prototype.Storage.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.Storage.saveByKey =
  function (string, text, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("PUT", this.contextUrl + 'key/' + encodeURIComponent(string) + '/', params, success, error, "text/plain", "text/json", text, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.Storage.removeManyByKey =
  function (json, success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + 'key/', params, success, error, "text/json", "text/json", JSON.stringify(json), callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.Storage.prototype.remove =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("DELETE", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.Subscription =
  function Subscription (url, secureUrl, modifyRequest)
  {
    if (this instanceof Subscription)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Subscription.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.User.prototype.Subscription.apiObjectType = "resourceDir";
SilkApi.prototype.User.prototype.Subscription.prototype.Site =
  function Site (url, secureUrl, modifyRequest)
  {
    if (this instanceof Site)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Site.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.User.prototype.Subscription.prototype.Site.apiObjectType = "resourceDir";
SilkApi.prototype.User.prototype.Subscription.prototype.Site.list =
  function (success, error, params, callOpts)
  {
    return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/json", undefined, callOpts, this.modifyRequest);
  };
SilkApi.prototype.User.prototype.Visited =
  function Visited (url, secureUrl, modifyRequest)
  {
    if (this instanceof Visited)
    {
      SilkApi.setContext(this, url, secureUrl, modifyRequest);
    }
    else
    {
      return Visited.access(url, secureUrl, modifyRequest);
    }
  };
SilkApi.prototype.User.prototype.Visited.apiObjectType = "resourceDir";
SilkApi.prototype.User.prototype.Visited.lastSite =
  function ()
  {
    var postfix = 'last-site/';
    var accessor = new this(this.contextUrl + postfix, this.secureContextUrl + postfix, this.modifyRequest);
    accessor.get =
      function (success, error, params, callOpts)
      {
        return SilkApi.ajaxCall("GET", this.contextUrl + '', params, success, error, "text/plain", "text/plain,text/json", undefined, callOpts, this.modifyRequest);
      };
    return accessor;
  };

})(this);
!function(){function n(n,t){return t>n?-1:n>t?1:n>=t?0:0/0}function t(n){return null!=n&&!isNaN(n)}function e(n){return{left:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n(t[i],e)<0?r=i+1:u=i}return r},right:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n(t[i],e)>0?u=i:r=i+1}return r}}}function r(n){return n.length}function u(n){for(var t=1;n*t%1;)t*=10;return t}function i(n,t){try{for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}catch(r){n.prototype=t}}function o(){}function a(n){return ha+n in this}function c(n){return n=ha+n,n in this&&delete this[n]}function s(){var n=[];return this.forEach(function(t){n.push(t)}),n}function l(){var n=0;for(var t in this)t.charCodeAt(0)===ga&&++n;return n}function f(){for(var n in this)if(n.charCodeAt(0)===ga)return!1;return!0}function h(){}function g(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function p(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.substring(1);for(var e=0,r=pa.length;r>e;++e){var u=pa[e]+t;if(u in n)return u}}function v(){}function d(){}function m(n){function t(){for(var t,r=e,u=-1,i=r.length;++u<i;)(t=r[u].on)&&t.apply(this,arguments);return n}var e=[],r=new o;return t.on=function(t,u){var i,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,e=e.slice(0,i=e.indexOf(o)).concat(e.slice(i+1)),r.remove(t)),u&&e.push(r.set(t,{on:u})),n)},t}function y(){Go.event.preventDefault()}function x(){for(var n,t=Go.event;n=t.sourceEvent;)t=n;return t}function M(n){for(var t=new d,e=0,r=arguments.length;++e<r;)t[arguments[e]]=m(t);return t.of=function(e,r){return function(u){try{var i=u.sourceEvent=Go.event;u.target=n,Go.event=u,t[u.type].apply(e,r)}finally{Go.event=i}}},t}function _(n){return da(n,_a),n}function b(n){return"function"==typeof n?n:function(){return ma(n,this)}}function w(n){return"function"==typeof n?n:function(){return ya(n,this)}}function S(n,t){function e(){this.removeAttribute(n)}function r(){this.removeAttributeNS(n.space,n.local)}function u(){this.setAttribute(n,t)}function i(){this.setAttributeNS(n.space,n.local,t)}function o(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}function a(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}return n=Go.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?a:o:n.local?i:u}function k(n){return n.trim().replace(/\s+/g," ")}function E(n){return new RegExp("(?:^|\\s+)"+Go.requote(n)+"(?:\\s+|$)","g")}function N(n){return n.trim().split(/^|\s+/)}function A(n,t){function e(){for(var e=-1;++e<u;)n[e](this,t)}function r(){for(var e=-1,r=t.apply(this,arguments);++e<u;)n[e](this,r)}n=N(n).map(C);var u=n.length;return"function"==typeof t?r:e}function C(n){var t=E(n);return function(e,r){if(u=e.classList)return r?u.add(n):u.remove(n);var u=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(u)||e.setAttribute("class",k(u+" "+n))):e.setAttribute("class",k(u.replace(t," ")))}}function L(n,t,e){function r(){this.style.removeProperty(n)}function u(){this.style.setProperty(n,t,e)}function i(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}return null==t?r:"function"==typeof t?i:u}function T(n,t){function e(){delete this[n]}function r(){this[n]=t}function u(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}return null==t?e:"function"==typeof t?u:r}function q(n){return"function"==typeof n?n:(n=Go.ns.qualify(n)).local?function(){return this.ownerDocument.createElementNS(n.space,n.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,n)}}function z(n){return{__data__:n}}function R(n){return function(){return Ma(this,n)}}function D(t){return arguments.length||(t=n),function(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}}function P(n,t){for(var e=0,r=n.length;r>e;e++)for(var u,i=n[e],o=0,a=i.length;a>o;o++)(u=i[o])&&t(u,o,e);return n}function U(n){return da(n,wa),n}function j(n){var t,e;return function(r,u,i){var o,a=n[i].update,c=a.length;for(i!=e&&(e=i,t=0),u>=t&&(t=u+1);!(o=a[t])&&++t<c;);return o}}function H(){var n=this.__transition__;n&&++n.active}function F(n,t,e){function r(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}function u(){var u=c(t,Qo(arguments));r.call(this),this.addEventListener(n,this[o]=u,u.$=e),u._=t}function i(){var t,e=new RegExp("^__on([^.]+)"+Go.requote(n)+"$");for(var r in this)if(t=r.match(e)){var u=this[r];this.removeEventListener(t[1],u,u.$),delete this[r]}}var o="__on"+n,a=n.indexOf("."),c=O;a>0&&(n=n.substring(0,a));var s=ka.get(n);return s&&(n=s,c=Y),a?t?u:r:t?v:i}function O(n,t){return function(e){var r=Go.event;Go.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{Go.event=r}}}function Y(n,t){var e=O(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function I(){var n=".dragsuppress-"+ ++Na,t="click"+n,e=Go.select(ea).on("touchmove"+n,y).on("dragstart"+n,y).on("selectstart"+n,y);if(Ea){var r=ta.style,u=r[Ea];r[Ea]="none"}return function(i){function o(){e.on(t,null)}e.on(n,null),Ea&&(r[Ea]=u),i&&(e.on(t,function(){y(),o()},!0),setTimeout(o,0))}}function Z(n,t){t.changedTouches&&(t=t.changedTouches[0]);var e=n.ownerSVGElement||n;if(e.createSVGPoint){var r=e.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(n.getScreenCTM().inverse()),[r.x,r.y]}var u=n.getBoundingClientRect();return[t.clientX-u.left-n.clientLeft,t.clientY-u.top-n.clientTop]}function V(){return Go.event.changedTouches[0].identifier}function $(){return Go.event.target}function X(){return ea}function B(n){return n>0?1:0>n?-1:0}function J(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(t[1]-n[1])*(e[0]-n[0])}function W(n){return n>1?0:-1>n?Aa:Math.acos(n)}function G(n){return n>1?La:-1>n?-La:Math.asin(n)}function K(n){return((n=Math.exp(n))-1/n)/2}function Q(n){return((n=Math.exp(n))+1/n)/2}function nt(n){return((n=Math.exp(2*n))-1)/(n+1)}function tt(n){return(n=Math.sin(n/2))*n}function et(){}function rt(n,t,e){return new ut(n,t,e)}function ut(n,t,e){this.h=n,this.s=t,this.l=e}function it(n,t,e){function r(n){return n>360?n-=360:0>n&&(n+=360),60>n?i+(o-i)*n/60:180>n?o:240>n?i+(o-i)*(240-n)/60:i}function u(n){return Math.round(255*r(n))}var i,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,e=0>e?0:e>1?1:e,o=.5>=e?e*(1+t):e+t-e*t,i=2*e-o,yt(u(n+120),u(n),u(n-120))}function ot(n,t,e){return new at(n,t,e)}function at(n,t,e){this.h=n,this.c=t,this.l=e}function ct(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),st(e,Math.cos(n*=za)*t,Math.sin(n)*t)}function st(n,t,e){return new lt(n,t,e)}function lt(n,t,e){this.l=n,this.a=t,this.b=e}function ft(n,t,e){var r=(n+16)/116,u=r+t/500,i=r-e/200;return u=gt(u)*Za,r=gt(r)*Va,i=gt(i)*$a,yt(vt(3.2404542*u-1.5371385*r-.4985314*i),vt(-.969266*u+1.8760108*r+.041556*i),vt(.0556434*u-.2040259*r+1.0572252*i))}function ht(n,t,e){return n>0?ot(Math.atan2(e,t)*Ra,Math.sqrt(t*t+e*e),n):ot(0/0,0/0,n)}function gt(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function pt(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function vt(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function dt(n){return yt(n>>16,255&n>>8,255&n)}function mt(n){return dt(n)+""}function yt(n,t,e){return new xt(n,t,e)}function xt(n,t,e){this.r=n,this.g=t,this.b=e}function Mt(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function _t(n,t,e){var r,u,i,o=0,a=0,c=0;if(r=/([a-z]+)\((.*)\)/i.exec(n))switch(u=r[2].split(","),r[1]){case"hsl":return e(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(kt(u[0]),kt(u[1]),kt(u[2]))}return(i=Ja.get(n))?t(i.r,i.g,i.b):(null==n||"#"!==n.charAt(0)||isNaN(i=parseInt(n.substring(1),16))||(4===n.length?(o=(3840&i)>>4,o=o>>4|o,a=240&i,a=a>>4|a,c=15&i,c=c<<4|c):7===n.length&&(o=(16711680&i)>>16,a=(65280&i)>>8,c=255&i)),t(o,a,c))}function bt(n,t,e){var r,u,i=Math.min(n/=255,t/=255,e/=255),o=Math.max(n,t,e),a=o-i,c=(o+i)/2;return a?(u=.5>c?a/(o+i):a/(2-o-i),r=n==o?(t-e)/a+(e>t?6:0):t==o?(e-n)/a+2:(n-t)/a+4,r*=60):(r=0/0,u=c>0&&1>c?0:r),rt(r,u,c)}function wt(n,t,e){n=St(n),t=St(t),e=St(e);var r=pt((.4124564*n+.3575761*t+.1804375*e)/Za),u=pt((.2126729*n+.7151522*t+.072175*e)/Va),i=pt((.0193339*n+.119192*t+.9503041*e)/$a);return st(116*u-16,500*(r-u),200*(u-i))}function St(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function kt(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function Et(n){return"function"==typeof n?n:function(){return n}}function Nt(n){return n}function At(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),Ct(t,e,n,r)}}function Ct(n,t,e,r){function u(){var n,t=c.status;if(!t&&c.responseText||t>=200&&300>t||304===t){try{n=e.call(i,c)}catch(r){return o.error.call(i,r),void 0}o.load.call(i,n)}else o.error.call(i,c)}var i={},o=Go.dispatch("beforesend","progress","load","error"),a={},c=new XMLHttpRequest,s=null;return!ea.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(n)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=u:c.onreadystatechange=function(){c.readyState>3&&u()},c.onprogress=function(n){var t=Go.event;Go.event=n;try{o.progress.call(i,c)}finally{Go.event=t}},i.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",i)},i.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",i):t},i.responseType=function(n){return arguments.length?(s=n,i):s},i.response=function(n){return e=n,i},["get","post"].forEach(function(n){i[n]=function(){return i.send.apply(i,[n].concat(Qo(arguments)))}}),i.send=function(e,r,u){if(2===arguments.length&&"function"==typeof r&&(u=r,r=null),c.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),c.setRequestHeader)for(var l in a)c.setRequestHeader(l,a[l]);return null!=t&&c.overrideMimeType&&c.overrideMimeType(t),null!=s&&(c.responseType=s),null!=u&&i.on("error",u).on("load",function(n){u(null,n)}),o.beforesend.call(i,c),c.send(null==r?null:r),i},i.abort=function(){return c.abort(),i},Go.rebind(i,o,"on"),null==r?i:i.get(Lt(r))}function Lt(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}function Tt(){var n=qt(),t=zt()-n;t>24?(isFinite(t)&&(clearTimeout(Qa),Qa=setTimeout(Tt,t)),Ka=0):(Ka=1,tc(Tt))}function qt(){var n=Date.now();for(nc=Wa;nc;)n>=nc.t&&(nc.f=nc.c(n-nc.t)),nc=nc.n;return n}function zt(){for(var n,t=Wa,e=1/0;t;)t.f?t=n?n.n=t.n:Wa=t.n:(t.t<e&&(e=t.t),t=(n=t).n);return Ga=n,e}function Rt(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Dt(n,t){var e=Math.pow(10,3*fa(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}}function Pt(n){var t=n.decimal,e=n.thousands,r=n.grouping,u=n.currency,i=r?function(n){for(var t=n.length,u=[],i=0,o=r[0];t>0&&o>0;)u.push(n.substring(t-=o,t+o)),o=r[i=(i+1)%r.length];return u.reverse().join(e)}:Nt;return function(n){var e=rc.exec(n),r=e[1]||" ",o=e[2]||">",a=e[3]||"",c=e[4]||"",s=e[5],l=+e[6],f=e[7],h=e[8],g=e[9],p=1,v="",d="",m=!1;switch(h&&(h=+h.substring(1)),(s||"0"===r&&"="===o)&&(s=r="0",o="=",f&&(l-=Math.floor((l-1)/4))),g){case"n":f=!0,g="g";break;case"%":p=100,d="%",g="f";break;case"p":p=100,d="%",g="r";break;case"b":case"o":case"x":case"X":"#"===c&&(v="0"+g.toLowerCase());case"c":case"d":m=!0,h=0;break;case"s":p=-1,g="r"}"$"===c&&(v=u[0],d=u[1]),"r"!=g||h||(g="g"),null!=h&&("g"==g?h=Math.max(1,Math.min(21,h)):("e"==g||"f"==g)&&(h=Math.max(0,Math.min(20,h)))),g=uc.get(g)||Ut;var y=s&&f;return function(n){var e=d;if(m&&n%1)return"";var u=0>n||0===n&&0>1/n?(n=-n,"-"):a;if(0>p){var c=Go.formatPrefix(n,h);n=c.scale(n),e=c.symbol+d}else n*=p;n=g(n,h);var x=n.lastIndexOf("."),M=0>x?n:n.substring(0,x),_=0>x?"":t+n.substring(x+1);!s&&f&&(M=i(M));var b=v.length+M.length+_.length+(y?0:u.length),w=l>b?new Array(b=l-b+1).join(r):"";return y&&(M=i(w+M)),u+=v,n=M+_,("<"===o?u+n+w:">"===o?w+u+n:"^"===o?w.substring(0,b>>=1)+u+n+w.substring(b):u+(y?n:w+n))+e}}}function Ut(n){return n+""}function jt(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ht(n,t,e){function r(t){var e=n(t),r=i(e,1);return r-t>t-e?e:r}function u(e){return t(e=n(new oc(e-1)),1),e}function i(n,e){return t(n=new oc(+n),e),n}function o(n,r,i){var o=u(n),a=[];if(i>1)for(;r>o;)e(o)%i||a.push(new Date(+o)),t(o,1);else for(;r>o;)a.push(new Date(+o)),t(o,1);return a}function a(n,t,e){try{oc=jt;var r=new jt;return r._=n,o(r,t,e)}finally{oc=Date}}n.floor=n,n.round=r,n.ceil=u,n.offset=i,n.range=o;var c=n.utc=Ft(n);return c.floor=c,c.round=Ft(r),c.ceil=Ft(u),c.offset=Ft(i),c.range=a,n}function Ft(n){return function(t,e){try{oc=jt;var r=new jt;return r._=t,n(r,e)._}finally{oc=Date}}}function Ot(n){function t(n){function t(t){for(var e,u,i,o=[],a=-1,c=0;++a<r;)37===n.charCodeAt(a)&&(o.push(n.substring(c,a)),null!=(u=cc[e=n.charAt(++a)])&&(e=n.charAt(++a)),(i=A[e])&&(e=i(t,null==u?"e"===e?" ":"0":u)),o.push(e),c=a+1);return o.push(n.substring(c,a)),o.join("")}var r=n.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},u=e(r,n,t,0);if(u!=t.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var i=null!=r.Z&&oc!==jt,o=new(i?jt:oc);return"j"in r?o.setFullYear(r.y,0,r.j):"w"in r&&("W"in r||"U"in r)?(o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+Math.floor(r.Z/100),r.M+r.Z%100,r.S,r.L),i?o._:o},t.toString=function(){return n},t}function e(n,t,e,r){for(var u,i,o,a=0,c=t.length,s=e.length;c>a;){if(r>=s)return-1;if(u=t.charCodeAt(a++),37===u){if(o=t.charAt(a++),i=C[o in cc?t.charAt(a++):o],!i||(r=i(n,e,r))<0)return-1}else if(u!=e.charCodeAt(r++))return-1}return r}function r(n,t,e){b.lastIndex=0;var r=b.exec(t.substring(e));return r?(n.w=w.get(r[0].toLowerCase()),e+r[0].length):-1}function u(n,t,e){M.lastIndex=0;var r=M.exec(t.substring(e));return r?(n.w=_.get(r[0].toLowerCase()),e+r[0].length):-1}function i(n,t,e){E.lastIndex=0;var r=E.exec(t.substring(e));return r?(n.m=N.get(r[0].toLowerCase()),e+r[0].length):-1}function o(n,t,e){S.lastIndex=0;var r=S.exec(t.substring(e));return r?(n.m=k.get(r[0].toLowerCase()),e+r[0].length):-1}function a(n,t,r){return e(n,A.c.toString(),t,r)}function c(n,t,r){return e(n,A.x.toString(),t,r)}function s(n,t,r){return e(n,A.X.toString(),t,r)}function l(n,t,e){var r=x.get(t.substring(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)}var f=n.dateTime,h=n.date,g=n.time,p=n.periods,v=n.days,d=n.shortDays,m=n.months,y=n.shortMonths;t.utc=function(n){function e(n){try{oc=jt;var t=new oc;return t._=n,r(t)}finally{oc=Date}}var r=t(n);return e.parse=function(n){try{oc=jt;var t=r.parse(n);return t&&t._}finally{oc=Date}},e.toString=r.toString,e},t.multi=t.utc.multi=ae;var x=Go.map(),M=It(v),_=Zt(v),b=It(d),w=Zt(d),S=It(m),k=Zt(m),E=It(y),N=Zt(y);p.forEach(function(n,t){x.set(n.toLowerCase(),t)});var A={a:function(n){return d[n.getDay()]},A:function(n){return v[n.getDay()]},b:function(n){return y[n.getMonth()]},B:function(n){return m[n.getMonth()]},c:t(f),d:function(n,t){return Yt(n.getDate(),t,2)},e:function(n,t){return Yt(n.getDate(),t,2)},H:function(n,t){return Yt(n.getHours(),t,2)},I:function(n,t){return Yt(n.getHours()%12||12,t,2)},j:function(n,t){return Yt(1+ic.dayOfYear(n),t,3)},L:function(n,t){return Yt(n.getMilliseconds(),t,3)},m:function(n,t){return Yt(n.getMonth()+1,t,2)},M:function(n,t){return Yt(n.getMinutes(),t,2)},p:function(n){return p[+(n.getHours()>=12)]},S:function(n,t){return Yt(n.getSeconds(),t,2)},U:function(n,t){return Yt(ic.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return Yt(ic.mondayOfYear(n),t,2)},x:t(h),X:t(g),y:function(n,t){return Yt(n.getFullYear()%100,t,2)},Y:function(n,t){return Yt(n.getFullYear()%1e4,t,4)},Z:ie,"%":function(){return"%"}},C={a:r,A:u,b:i,B:o,c:a,d:Qt,e:Qt,H:te,I:te,j:ne,L:ue,m:Kt,M:ee,p:l,S:re,U:$t,w:Vt,W:Xt,x:c,X:s,y:Jt,Y:Bt,Z:Wt,"%":oe};return t}function Yt(n,t,e){var r=0>n?"-":"",u=(r?-n:n)+"",i=u.length;return r+(e>i?new Array(e-i+1).join(t)+u:u)}function It(n){return new RegExp("^(?:"+n.map(Go.requote).join("|")+")","i")}function Zt(n){for(var t=new o,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function Vt(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function $t(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e));return r?(n.U=+r[0],e+r[0].length):-1}function Xt(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e));return r?(n.W=+r[0],e+r[0].length):-1}function Bt(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Jt(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e,e+2));return r?(n.y=Gt(+r[0]),e+r[0].length):-1}function Wt(n,t,e){return/^[+-]\d{4}$/.test(t=t.substring(e,e+5))?(n.Z=+t,e+5):-1}function Gt(n){return n+(n>68?1900:2e3)}function Kt(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function Qt(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function ne(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function te(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function ee(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function re(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function ue(n,t,e){sc.lastIndex=0;var r=sc.exec(t.substring(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function ie(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=~~(fa(t)/60),u=fa(t)%60;return e+Yt(r,"0",2)+Yt(u,"0",2)}function oe(n,t,e){lc.lastIndex=0;var r=lc.exec(t.substring(e,e+1));return r?e+r[0].length:-1}function ae(n){for(var t=n.length,e=-1;++e<t;)n[e][0]=this(n[e][0]);return function(t){for(var e=0,r=n[e];!r[1](t);)r=n[++e];return r[0](t)}}function ce(){}function se(n,t,e){var r=e.s=n+t,u=r-n,i=r-u;e.t=n-i+(t-u)}function le(n,t){n&&pc.hasOwnProperty(n.type)&&pc[n.type](n,t)}function fe(n,t,e){var r,u=-1,i=n.length-e;for(t.lineStart();++u<i;)r=n[u],t.point(r[0],r[1],r[2]);t.lineEnd()}function he(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)fe(n[e],t,1);t.polygonEnd()}function ge(){function n(n,t){n*=za,t=t*za/2+Aa/4;var e=n-r,o=e>=0?1:-1,a=o*e,c=Math.cos(t),s=Math.sin(t),l=i*s,f=u*c+l*Math.cos(a),h=l*o*Math.sin(a);dc.add(Math.atan2(h,f)),r=n,u=c,i=s}var t,e,r,u,i;mc.point=function(o,a){mc.point=n,r=(t=o)*za,u=Math.cos(a=(e=a)*za/2+Aa/4),i=Math.sin(a)},mc.lineEnd=function(){n(t,e)}}function pe(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function ve(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function de(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function me(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function ye(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function xe(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Me(n){return[Math.atan2(n[1],n[0]),G(n[2])]}function _e(n,t){return fa(n[0]-t[0])<Ta&&fa(n[1]-t[1])<Ta}function be(n,t){n*=za;var e=Math.cos(t*=za);we(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function we(n,t,e){++yc,Mc+=(n-Mc)/yc,_c+=(t-_c)/yc,bc+=(e-bc)/yc}function Se(){function n(n,u){n*=za;var i=Math.cos(u*=za),o=i*Math.cos(n),a=i*Math.sin(n),c=Math.sin(u),s=Math.atan2(Math.sqrt((s=e*c-r*a)*s+(s=r*o-t*c)*s+(s=t*a-e*o)*s),t*o+e*a+r*c);xc+=s,wc+=s*(t+(t=o)),Sc+=s*(e+(e=a)),kc+=s*(r+(r=c)),we(t,e,r)}var t,e,r;Cc.point=function(u,i){u*=za;var o=Math.cos(i*=za);t=o*Math.cos(u),e=o*Math.sin(u),r=Math.sin(i),Cc.point=n,we(t,e,r)}}function ke(){Cc.point=be}function Ee(){function n(n,t){n*=za;var e=Math.cos(t*=za),o=e*Math.cos(n),a=e*Math.sin(n),c=Math.sin(t),s=u*c-i*a,l=i*o-r*c,f=r*a-u*o,h=Math.sqrt(s*s+l*l+f*f),g=r*o+u*a+i*c,p=h&&-W(g)/h,v=Math.atan2(h,g);Ec+=p*s,Nc+=p*l,Ac+=p*f,xc+=v,wc+=v*(r+(r=o)),Sc+=v*(u+(u=a)),kc+=v*(i+(i=c)),we(r,u,i)}var t,e,r,u,i;Cc.point=function(o,a){t=o,e=a,Cc.point=n,o*=za;var c=Math.cos(a*=za);r=c*Math.cos(o),u=c*Math.sin(o),i=Math.sin(a),we(r,u,i)},Cc.lineEnd=function(){n(t,e),Cc.lineEnd=ke,Cc.point=be}}function Ne(){return!0}function Ae(n,t,e,r,u){var i=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(_e(e,r)){u.lineStart();for(var a=0;t>a;++a)u.point((e=n[a])[0],e[1]);return u.lineEnd(),void 0}var c=new Le(e,n,null,!0),s=new Le(e,null,c,!1);c.o=s,i.push(c),o.push(s),c=new Le(r,n,null,!1),s=new Le(r,null,c,!0),c.o=s,i.push(c),o.push(s)}}),o.sort(t),Ce(i),Ce(o),i.length){for(var a=0,c=e,s=o.length;s>a;++a)o[a].e=c=!c;for(var l,f,h=i[0];;){for(var g=h,p=!0;g.v;)if((g=g.n)===h)return;l=g.z,u.lineStart();do{if(g.v=g.o.v=!0,g.e){if(p)for(var a=0,s=l.length;s>a;++a)u.point((f=l[a])[0],f[1]);else r(g.x,g.n.x,1,u);g=g.n}else{if(p){l=g.p.z;for(var a=l.length-1;a>=0;--a)u.point((f=l[a])[0],f[1])}else r(g.x,g.p.x,-1,u);g=g.p}g=g.o,l=g.z,p=!p}while(!g.v);u.lineEnd()}}}function Ce(n){if(t=n.length){for(var t,e,r=0,u=n[0];++r<t;)u.n=e=n[r],e.p=u,u=e;u.n=e=n[0],e.p=u}}function Le(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Te(n,t,e,r){return function(u,i){function o(t,e){var r=u(t,e);n(t=r[0],e=r[1])&&i.point(t,e)}function a(n,t){var e=u(n,t);d.point(e[0],e[1])}function c(){y.point=a,d.lineStart()}function s(){y.point=o,d.lineEnd()}function l(n,t){v.push([n,t]);var e=u(n,t);M.point(e[0],e[1])}function f(){M.lineStart(),v=[]}function h(){l(v[0][0],v[0][1]),M.lineEnd();var n,t=M.clean(),e=x.buffer(),r=e.length;if(v.pop(),p.push(v),v=null,r){if(1&t){n=e[0];var u,r=n.length-1,o=-1;for(i.lineStart();++o<r;)i.point((u=n[o])[0],u[1]);return i.lineEnd(),void 0}r>1&&2&t&&e.push(e.pop().concat(e.shift())),g.push(e.filter(qe))}}var g,p,v,d=t(i),m=u.invert(r[0],r[1]),y={point:o,lineStart:c,lineEnd:s,polygonStart:function(){y.point=l,y.lineStart=f,y.lineEnd=h,g=[],p=[],i.polygonStart()},polygonEnd:function(){y.point=o,y.lineStart=c,y.lineEnd=s,g=Go.merge(g);var n=De(m,p);g.length?Ae(g,Re,n,e,i):n&&(i.lineStart(),e(null,null,1,i),i.lineEnd()),i.polygonEnd(),g=p=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}},x=ze(),M=t(x);return y}}function qe(n){return n.length>1}function ze(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:v,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Re(n,t){return((n=n.x)[0]<0?n[1]-La-Ta:La-n[1])-((t=t.x)[0]<0?t[1]-La-Ta:La-t[1])}function De(n,t){var e=n[0],r=n[1],u=[Math.sin(e),-Math.cos(e),0],i=0,o=0;dc.reset();for(var a=0,c=t.length;c>a;++a){var s=t[a],l=s.length;if(l)for(var f=s[0],h=f[0],g=f[1]/2+Aa/4,p=Math.sin(g),v=Math.cos(g),d=1;;){d===l&&(d=0),n=s[d];var m=n[0],y=n[1]/2+Aa/4,x=Math.sin(y),M=Math.cos(y),_=m-h,b=_>=0?1:-1,w=b*_,S=w>Aa,k=p*x;if(dc.add(Math.atan2(k*b*Math.sin(w),v*M+k*Math.cos(w))),i+=S?_+b*Ca:_,S^h>=e^m>=e){var E=de(pe(f),pe(n));xe(E);var N=de(u,E);xe(N);var A=(S^_>=0?-1:1)*G(N[2]);(r>A||r===A&&(E[0]||E[1]))&&(o+=S^_>=0?1:-1)}if(!d++)break;h=m,p=x,v=M,f=n}}return(-Ta>i||Ta>i&&0>dc)^1&o}function Pe(n){var t,e=0/0,r=0/0,u=0/0;return{lineStart:function(){n.lineStart(),t=1},point:function(i,o){var a=i>0?Aa:-Aa,c=fa(i-e);fa(c-Aa)<Ta?(n.point(e,r=(r+o)/2>0?La:-La),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(i,r),t=0):u!==a&&c>=Aa&&(fa(e-u)<Ta&&(e-=u*Ta),fa(i-a)<Ta&&(i-=a*Ta),r=Ue(e,r,i,o),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=i,r=o),u=a},lineEnd:function(){n.lineEnd(),e=r=0/0},clean:function(){return 2-t}}}function Ue(n,t,e,r){var u,i,o=Math.sin(n-e);return fa(o)>Ta?Math.atan((Math.sin(t)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(u=Math.cos(t))*Math.sin(n))/(u*i*o)):(t+r)/2}function je(n,t,e,r){var u;if(null==n)u=e*La,r.point(-Aa,u),r.point(0,u),r.point(Aa,u),r.point(Aa,0),r.point(Aa,-u),r.point(0,-u),r.point(-Aa,-u),r.point(-Aa,0),r.point(-Aa,u);else if(fa(n[0]-t[0])>Ta){var i=n[0]<t[0]?Aa:-Aa;u=e*i/2,r.point(-i,u),r.point(0,u),r.point(i,u)}else r.point(t[0],t[1])}function He(n){function t(n,t){return Math.cos(n)*Math.cos(t)>i}function e(n){var e,i,c,s,l;return{lineStart:function(){s=c=!1,l=1},point:function(f,h){var g,p=[f,h],v=t(f,h),d=o?v?0:u(f,h):v?u(f+(0>f?Aa:-Aa),h):0;if(!e&&(s=c=v)&&n.lineStart(),v!==c&&(g=r(e,p),(_e(e,g)||_e(p,g))&&(p[0]+=Ta,p[1]+=Ta,v=t(p[0],p[1]))),v!==c)l=0,v?(n.lineStart(),g=r(p,e),n.point(g[0],g[1])):(g=r(e,p),n.point(g[0],g[1]),n.lineEnd()),e=g;else if(a&&e&&o^v){var m;d&i||!(m=r(p,e,!0))||(l=0,o?(n.lineStart(),n.point(m[0][0],m[0][1]),n.point(m[1][0],m[1][1]),n.lineEnd()):(n.point(m[1][0],m[1][1]),n.lineEnd(),n.lineStart(),n.point(m[0][0],m[0][1])))}!v||e&&_e(e,p)||n.point(p[0],p[1]),e=p,c=v,i=d},lineEnd:function(){c&&n.lineEnd(),e=null},clean:function(){return l|(s&&c)<<1}}}function r(n,t,e){var r=pe(n),u=pe(t),o=[1,0,0],a=de(r,u),c=ve(a,a),s=a[0],l=c-s*s;if(!l)return!e&&n;var f=i*c/l,h=-i*s/l,g=de(o,a),p=ye(o,f),v=ye(a,h);me(p,v);var d=g,m=ve(p,d),y=ve(d,d),x=m*m-y*(ve(p,p)-1);if(!(0>x)){var M=Math.sqrt(x),_=ye(d,(-m-M)/y);if(me(_,p),_=Me(_),!e)return _;var b,w=n[0],S=t[0],k=n[1],E=t[1];w>S&&(b=w,w=S,S=b);var N=S-w,A=fa(N-Aa)<Ta,C=A||Ta>N;if(!A&&k>E&&(b=k,k=E,E=b),C?A?k+E>0^_[1]<(fa(_[0]-w)<Ta?k:E):k<=_[1]&&_[1]<=E:N>Aa^(w<=_[0]&&_[0]<=S)){var L=ye(d,(-m+M)/y);return me(L,p),[_,Me(L)]}}}function u(t,e){var r=o?n:Aa-n,u=0;return-r>t?u|=1:t>r&&(u|=2),-r>e?u|=4:e>r&&(u|=8),u}var i=Math.cos(n),o=i>0,a=fa(i)>Ta,c=gr(n,6*za);return Te(t,e,c,o?[0,-n]:[-Aa,n-Aa])}function Fe(n,t,e,r){return function(u){var i,o=u.a,a=u.b,c=o.x,s=o.y,l=a.x,f=a.y,h=0,g=1,p=l-c,v=f-s;if(i=n-c,p||!(i>0)){if(i/=p,0>p){if(h>i)return;g>i&&(g=i)}else if(p>0){if(i>g)return;i>h&&(h=i)}if(i=e-c,p||!(0>i)){if(i/=p,0>p){if(i>g)return;i>h&&(h=i)}else if(p>0){if(h>i)return;g>i&&(g=i)}if(i=t-s,v||!(i>0)){if(i/=v,0>v){if(h>i)return;g>i&&(g=i)}else if(v>0){if(i>g)return;i>h&&(h=i)}if(i=r-s,v||!(0>i)){if(i/=v,0>v){if(i>g)return;i>h&&(h=i)}else if(v>0){if(h>i)return;g>i&&(g=i)}return h>0&&(u.a={x:c+h*p,y:s+h*v}),1>g&&(u.b={x:c+g*p,y:s+g*v}),u}}}}}}function Oe(n,t,e,r){function u(r,u){return fa(r[0]-n)<Ta?u>0?0:3:fa(r[0]-e)<Ta?u>0?2:1:fa(r[1]-t)<Ta?u>0?1:0:u>0?3:2}function i(n,t){return o(n.x,t.x)}function o(n,t){var e=u(n,1),r=u(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){function c(n){for(var t=0,e=d.length,r=n[1],u=0;e>u;++u)for(var i,o=1,a=d[u],c=a.length,s=a[0];c>o;++o)i=a[o],s[1]<=r?i[1]>r&&J(s,i,n)>0&&++t:i[1]<=r&&J(s,i,n)<0&&--t,s=i;return 0!==t}function s(i,a,c,s){var l=0,f=0;if(null==i||(l=u(i,c))!==(f=u(a,c))||o(i,a)<0^c>0){do s.point(0===l||3===l?n:e,l>1?r:t);while((l=(l+c+4)%4)!==f)}else s.point(a[0],a[1])}function l(u,i){return u>=n&&e>=u&&i>=t&&r>=i}function f(n,t){l(n,t)&&a.point(n,t)}function h(){C.point=p,d&&d.push(m=[]),S=!0,w=!1,_=b=0/0}function g(){v&&(p(y,x),M&&w&&N.rejoin(),v.push(N.buffer())),C.point=f,w&&a.lineEnd()}function p(n,t){n=Math.max(-Tc,Math.min(Tc,n)),t=Math.max(-Tc,Math.min(Tc,t));var e=l(n,t);if(d&&m.push([n,t]),S)y=n,x=t,M=e,S=!1,e&&(a.lineStart(),a.point(n,t));else if(e&&w)a.point(n,t);else{var r={a:{x:_,y:b},b:{x:n,y:t}};A(r)?(w||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),e||a.lineEnd(),k=!1):e&&(a.lineStart(),a.point(n,t),k=!1)}_=n,b=t,w=e}var v,d,m,y,x,M,_,b,w,S,k,E=a,N=ze(),A=Fe(n,t,e,r),C={point:f,lineStart:h,lineEnd:g,polygonStart:function(){a=N,v=[],d=[],k=!0},polygonEnd:function(){a=E,v=Go.merge(v);var t=c([n,r]),e=k&&t,u=v.length;(e||u)&&(a.polygonStart(),e&&(a.lineStart(),s(null,null,1,a),a.lineEnd()),u&&Ae(v,i,t,s,a),a.polygonEnd()),v=d=m=null}};return C}}function Ye(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),e}function Ie(n){var t=0,e=Aa/3,r=ir(n),u=r(t,e);return u.parallels=function(n){return arguments.length?r(t=n[0]*Aa/180,e=n[1]*Aa/180):[180*(t/Aa),180*(e/Aa)]},u}function Ze(n,t){function e(n,t){var e=Math.sqrt(i-2*u*Math.sin(t))/u;return[e*Math.sin(n*=u),o-e*Math.cos(n)]}var r=Math.sin(n),u=(r+Math.sin(t))/2,i=1+r*(2*u-r),o=Math.sqrt(i)/u;return e.invert=function(n,t){var e=o-t;return[Math.atan2(n,e)/u,G((i-(n*n+e*e)*u*u)/(2*u))]},e}function Ve(){function n(n,t){zc+=u*n-r*t,r=n,u=t}var t,e,r,u;jc.point=function(i,o){jc.point=n,t=r=i,e=u=o},jc.lineEnd=function(){n(t,e)}}function $e(n,t){Rc>n&&(Rc=n),n>Pc&&(Pc=n),Dc>t&&(Dc=t),t>Uc&&(Uc=t)}function Xe(){function n(n,t){o.push("M",n,",",t,i)}function t(n,t){o.push("M",n,",",t),a.point=e}function e(n,t){o.push("L",n,",",t)}function r(){a.point=n}function u(){o.push("Z")}var i=Be(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:r,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=r,a.point=n},pointRadius:function(n){return i=Be(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}function Be(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function Je(n,t){Mc+=n,_c+=t,++bc}function We(){function n(n,r){var u=n-t,i=r-e,o=Math.sqrt(u*u+i*i);wc+=o*(t+n)/2,Sc+=o*(e+r)/2,kc+=o,Je(t=n,e=r)}var t,e;Fc.point=function(r,u){Fc.point=n,Je(t=r,e=u)}}function Ge(){Fc.point=Je}function Ke(){function n(n,t){var e=n-r,i=t-u,o=Math.sqrt(e*e+i*i);wc+=o*(r+n)/2,Sc+=o*(u+t)/2,kc+=o,o=u*n-r*t,Ec+=o*(r+n),Nc+=o*(u+t),Ac+=3*o,Je(r=n,u=t)}var t,e,r,u;Fc.point=function(i,o){Fc.point=n,Je(t=r=i,e=u=o)},Fc.lineEnd=function(){n(t,e)}}function Qe(n){function t(t,e){n.moveTo(t,e),n.arc(t,e,o,0,Ca)}function e(t,e){n.moveTo(t,e),a.point=r}function r(t,e){n.lineTo(t,e)}function u(){a.point=t}function i(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=e},lineEnd:u,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=u,a.point=t},pointRadius:function(n){return o=n,a},result:v};return a}function nr(n){function t(n){return(a?r:e)(n)}function e(t){return rr(t,function(e,r){e=n(e,r),t.point(e[0],e[1])})}function r(t){function e(e,r){e=n(e,r),t.point(e[0],e[1])}function r(){x=0/0,S.point=i,t.lineStart()}function i(e,r){var i=pe([e,r]),o=n(e,r);u(x,M,y,_,b,w,x=o[0],M=o[1],y=e,_=i[0],b=i[1],w=i[2],a,t),t.point(x,M)}function o(){S.point=e,t.lineEnd()}function c(){r(),S.point=s,S.lineEnd=l}function s(n,t){i(f=n,h=t),g=x,p=M,v=_,d=b,m=w,S.point=i}function l(){u(x,M,y,_,b,w,g,p,f,v,d,m,a,t),S.lineEnd=o,o()}var f,h,g,p,v,d,m,y,x,M,_,b,w,S={point:e,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),S.lineStart=c},polygonEnd:function(){t.polygonEnd(),S.lineStart=r}};return S}function u(t,e,r,a,c,s,l,f,h,g,p,v,d,m){var y=l-t,x=f-e,M=y*y+x*x;if(M>4*i&&d--){var _=a+g,b=c+p,w=s+v,S=Math.sqrt(_*_+b*b+w*w),k=Math.asin(w/=S),E=fa(fa(w)-1)<Ta||fa(r-h)<Ta?(r+h)/2:Math.atan2(b,_),N=n(E,k),A=N[0],C=N[1],L=A-t,T=C-e,q=x*L-y*T;(q*q/M>i||fa((y*L+x*T)/M-.5)>.3||o>a*g+c*p+s*v)&&(u(t,e,r,a,c,s,A,C,E,_/=S,b/=S,w,d,m),m.point(A,C),u(A,C,E,_,b,w,l,f,h,g,p,v,d,m))}}var i=.5,o=Math.cos(30*za),a=16;return t.precision=function(n){return arguments.length?(a=(i=n*n)>0&&16,t):Math.sqrt(i)},t}function tr(n){var t=nr(function(t,e){return n([t*Ra,e*Ra])});return function(n){return or(t(n))}}function er(n){this.stream=n}function rr(n,t){return{point:t,sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}function ur(n){return ir(function(){return n})()}function ir(n){function t(n){return n=a(n[0]*za,n[1]*za),[n[0]*h+c,s-n[1]*h]}function e(n){return n=a.invert((n[0]-c)/h,(s-n[1])/h),n&&[n[0]*Ra,n[1]*Ra]}function r(){a=Ye(o=sr(m,y,x),i);var n=i(v,d);return c=g-n[0]*h,s=p+n[1]*h,u()}function u(){return l&&(l.valid=!1,l=null),t}var i,o,a,c,s,l,f=nr(function(n,t){return n=i(n,t),[n[0]*h+c,s-n[1]*h]
}),h=150,g=480,p=250,v=0,d=0,m=0,y=0,x=0,M=Lc,_=Nt,b=null,w=null;return t.stream=function(n){return l&&(l.valid=!1),l=or(M(o,f(_(n)))),l.valid=!0,l},t.clipAngle=function(n){return arguments.length?(M=null==n?(b=n,Lc):He((b=+n)*za),u()):b},t.clipExtent=function(n){return arguments.length?(w=n,_=n?Oe(n[0][0],n[0][1],n[1][0],n[1][1]):Nt,u()):w},t.scale=function(n){return arguments.length?(h=+n,r()):h},t.translate=function(n){return arguments.length?(g=+n[0],p=+n[1],r()):[g,p]},t.center=function(n){return arguments.length?(v=n[0]%360*za,d=n[1]%360*za,r()):[v*Ra,d*Ra]},t.rotate=function(n){return arguments.length?(m=n[0]%360*za,y=n[1]%360*za,x=n.length>2?n[2]%360*za:0,r()):[m*Ra,y*Ra,x*Ra]},Go.rebind(t,f,"precision"),function(){return i=n.apply(this,arguments),t.invert=i.invert&&e,r()}}function or(n){return rr(n,function(t,e){n.point(t*za,e*za)})}function ar(n,t){return[n,t]}function cr(n,t){return[n>Aa?n-Ca:-Aa>n?n+Ca:n,t]}function sr(n,t,e){return n?t||e?Ye(fr(n),hr(t,e)):fr(n):t||e?hr(t,e):cr}function lr(n){return function(t,e){return t+=n,[t>Aa?t-Ca:-Aa>t?t+Ca:t,e]}}function fr(n){var t=lr(n);return t.invert=lr(-n),t}function hr(n,t){function e(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,s=Math.sin(t),l=s*r+a*u;return[Math.atan2(c*i-l*o,a*r-s*u),G(l*i+c*o)]}var r=Math.cos(n),u=Math.sin(n),i=Math.cos(t),o=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,s=Math.sin(t),l=s*i-c*o;return[Math.atan2(c*i+s*o,a*r+l*u),G(l*r-a*u)]},e}function gr(n,t){var e=Math.cos(n),r=Math.sin(n);return function(u,i,o,a){var c=o*t;null!=u?(u=pr(e,u),i=pr(e,i),(o>0?i>u:u>i)&&(u+=o*Ca)):(u=n+o*Ca,i=n-.5*c);for(var s,l=u;o>0?l>i:i>l;l-=c)a.point((s=Me([e,-r*Math.cos(l),-r*Math.sin(l)]))[0],s[1])}}function pr(n,t){var e=pe(t);e[0]-=n,xe(e);var r=W(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Ta)%(2*Math.PI)}function vr(n,t,e){var r=Go.range(n,t-Ta,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function dr(n,t,e){var r=Go.range(n,t-Ta,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function mr(n){return n.source}function yr(n){return n.target}function xr(n,t,e,r){var u=Math.cos(t),i=Math.sin(t),o=Math.cos(r),a=Math.sin(r),c=u*Math.cos(n),s=u*Math.sin(n),l=o*Math.cos(e),f=o*Math.sin(e),h=2*Math.asin(Math.sqrt(tt(r-t)+u*o*tt(e-n))),g=1/Math.sin(h),p=h?function(n){var t=Math.sin(n*=h)*g,e=Math.sin(h-n)*g,r=e*c+t*l,u=e*s+t*f,o=e*i+t*a;return[Math.atan2(u,r)*Ra,Math.atan2(o,Math.sqrt(r*r+u*u))*Ra]}:function(){return[n*Ra,t*Ra]};return p.distance=h,p}function Mr(){function n(n,u){var i=Math.sin(u*=za),o=Math.cos(u),a=fa((n*=za)-t),c=Math.cos(a);Oc+=Math.atan2(Math.sqrt((a=o*Math.sin(a))*a+(a=r*i-e*o*c)*a),e*i+r*o*c),t=n,e=i,r=o}var t,e,r;Yc.point=function(u,i){t=u*za,e=Math.sin(i*=za),r=Math.cos(i),Yc.point=n},Yc.lineEnd=function(){Yc.point=Yc.lineEnd=v}}function _r(n,t){function e(t,e){var r=Math.cos(t),u=Math.cos(e),i=n(r*u);return[i*u*Math.sin(t),i*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),u=t(r),i=Math.sin(u),o=Math.cos(u);return[Math.atan2(n*i,r*o),Math.asin(r&&e*i/r)]},e}function br(n,t){function e(n,t){o>0?-La+Ta>t&&(t=-La+Ta):t>La-Ta&&(t=La-Ta);var e=o/Math.pow(u(t),i);return[e*Math.sin(i*n),o-e*Math.cos(i*n)]}var r=Math.cos(n),u=function(n){return Math.tan(Aa/4+n/2)},i=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(u(t)/u(n)),o=r*Math.pow(u(n),i)/i;return i?(e.invert=function(n,t){var e=o-t,r=B(i)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/i,2*Math.atan(Math.pow(o/r,1/i))-La]},e):Sr}function wr(n,t){function e(n,t){var e=i-t;return[e*Math.sin(u*n),i-e*Math.cos(u*n)]}var r=Math.cos(n),u=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),i=r/u+n;return fa(u)<Ta?ar:(e.invert=function(n,t){var e=i-t;return[Math.atan2(n,e)/u,i-B(u)*Math.sqrt(n*n+e*e)]},e)}function Sr(n,t){return[n,Math.log(Math.tan(Aa/4+t/2))]}function kr(n){var t,e=ur(n),r=e.scale,u=e.translate,i=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=u.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var o=i.apply(e,arguments);if(o===e){if(t=null==n){var a=Aa*r(),c=u();i([[c[0]-a,c[1]-a],[c[0]+a,c[1]+a]])}}else t&&(o=null);return o},e.clipExtent(null)}function Er(n,t){return[Math.log(Math.tan(Aa/4+t/2)),-n]}function Nr(n){return n[0]}function Ar(n){return n[1]}function Cr(n){for(var t=n.length,e=[0,1],r=2,u=2;t>u;u++){for(;r>1&&J(n[e[r-2]],n[e[r-1]],n[u])<=0;)--r;e[r++]=u}return e.slice(0,r)}function Lr(n,t){return n[0]-t[0]||n[1]-t[1]}function Tr(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function qr(n,t,e,r){var u=n[0],i=e[0],o=t[0]-u,a=r[0]-i,c=n[1],s=e[1],l=t[1]-c,f=r[1]-s,h=(a*(c-s)-f*(u-i))/(f*o-a*l);return[u+h*o,c+h*l]}function zr(n){var t=n[0],e=n[n.length-1];return!(t[0]-e[0]||t[1]-e[1])}function Rr(){tu(this),this.edge=this.site=this.circle=null}function Dr(n){var t=ns.pop()||new Rr;return t.site=n,t}function Pr(n){$r(n),Gc.remove(n),ns.push(n),tu(n)}function Ur(n){var t=n.circle,e=t.x,r=t.cy,u={x:e,y:r},i=n.P,o=n.N,a=[n];Pr(n);for(var c=i;c.circle&&fa(e-c.circle.x)<Ta&&fa(r-c.circle.cy)<Ta;)i=c.P,a.unshift(c),Pr(c),c=i;a.unshift(c),$r(c);for(var s=o;s.circle&&fa(e-s.circle.x)<Ta&&fa(r-s.circle.cy)<Ta;)o=s.N,a.push(s),Pr(s),s=o;a.push(s),$r(s);var l,f=a.length;for(l=1;f>l;++l)s=a[l],c=a[l-1],Kr(s.edge,c.site,s.site,u);c=a[0],s=a[f-1],s.edge=Wr(c.site,s.site,null,u),Vr(c),Vr(s)}function jr(n){for(var t,e,r,u,i=n.x,o=n.y,a=Gc._;a;)if(r=Hr(a,o)-i,r>Ta)a=a.L;else{if(u=i-Fr(a,o),!(u>Ta)){r>-Ta?(t=a.P,e=a):u>-Ta?(t=a,e=a.N):t=e=a;break}if(!a.R){t=a;break}a=a.R}var c=Dr(n);if(Gc.insert(t,c),t||e){if(t===e)return $r(t),e=Dr(t.site),Gc.insert(c,e),c.edge=e.edge=Wr(t.site,c.site),Vr(t),Vr(e),void 0;if(!e)return c.edge=Wr(t.site,c.site),void 0;$r(t),$r(e);var s=t.site,l=s.x,f=s.y,h=n.x-l,g=n.y-f,p=e.site,v=p.x-l,d=p.y-f,m=2*(h*d-g*v),y=h*h+g*g,x=v*v+d*d,M={x:(d*y-g*x)/m+l,y:(h*x-v*y)/m+f};Kr(e.edge,s,p,M),c.edge=Wr(s,n,null,M),e.edge=Wr(n,p,null,M),Vr(t),Vr(e)}}function Hr(n,t){var e=n.site,r=e.x,u=e.y,i=u-t;if(!i)return r;var o=n.P;if(!o)return-1/0;e=o.site;var a=e.x,c=e.y,s=c-t;if(!s)return a;var l=a-r,f=1/i-1/s,h=l/s;return f?(-h+Math.sqrt(h*h-2*f*(l*l/(-2*s)-c+s/2+u-i/2)))/f+r:(r+a)/2}function Fr(n,t){var e=n.N;if(e)return Hr(e,t);var r=n.site;return r.y===t?r.x:1/0}function Or(n){this.site=n,this.edges=[]}function Yr(n){for(var t,e,r,u,i,o,a,c,s,l,f=n[0][0],h=n[1][0],g=n[0][1],p=n[1][1],v=Wc,d=v.length;d--;)if(i=v[d],i&&i.prepare())for(a=i.edges,c=a.length,o=0;c>o;)l=a[o].end(),r=l.x,u=l.y,s=a[++o%c].start(),t=s.x,e=s.y,(fa(r-t)>Ta||fa(u-e)>Ta)&&(a.splice(o,0,new Qr(Gr(i.site,l,fa(r-f)<Ta&&p-u>Ta?{x:f,y:fa(t-f)<Ta?e:p}:fa(u-p)<Ta&&h-r>Ta?{x:fa(e-p)<Ta?t:h,y:p}:fa(r-h)<Ta&&u-g>Ta?{x:h,y:fa(t-h)<Ta?e:g}:fa(u-g)<Ta&&r-f>Ta?{x:fa(e-g)<Ta?t:f,y:g}:null),i.site,null)),++c)}function Ir(n,t){return t.angle-n.angle}function Zr(){tu(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vr(n){var t=n.P,e=n.N;if(t&&e){var r=t.site,u=n.site,i=e.site;if(r!==i){var o=u.x,a=u.y,c=r.x-o,s=r.y-a,l=i.x-o,f=i.y-a,h=2*(c*f-s*l);if(!(h>=-qa)){var g=c*c+s*s,p=l*l+f*f,v=(f*g-s*p)/h,d=(c*p-l*g)/h,f=d+a,m=ts.pop()||new Zr;m.arc=n,m.site=u,m.x=v+o,m.y=f+Math.sqrt(v*v+d*d),m.cy=f,n.circle=m;for(var y=null,x=Qc._;x;)if(m.y<x.y||m.y===x.y&&m.x<=x.x){if(!x.L){y=x.P;break}x=x.L}else{if(!x.R){y=x;break}x=x.R}Qc.insert(y,m),y||(Kc=m)}}}}function $r(n){var t=n.circle;t&&(t.P||(Kc=t.N),Qc.remove(t),ts.push(t),tu(t),n.circle=null)}function Xr(n){for(var t,e=Jc,r=Fe(n[0][0],n[0][1],n[1][0],n[1][1]),u=e.length;u--;)t=e[u],(!Br(t,n)||!r(t)||fa(t.a.x-t.b.x)<Ta&&fa(t.a.y-t.b.y)<Ta)&&(t.a=t.b=null,e.splice(u,1))}function Br(n,t){var e=n.b;if(e)return!0;var r,u,i=n.a,o=t[0][0],a=t[1][0],c=t[0][1],s=t[1][1],l=n.l,f=n.r,h=l.x,g=l.y,p=f.x,v=f.y,d=(h+p)/2,m=(g+v)/2;if(v===g){if(o>d||d>=a)return;if(h>p){if(i){if(i.y>=s)return}else i={x:d,y:c};e={x:d,y:s}}else{if(i){if(i.y<c)return}else i={x:d,y:s};e={x:d,y:c}}}else if(r=(h-p)/(v-g),u=m-r*d,-1>r||r>1)if(h>p){if(i){if(i.y>=s)return}else i={x:(c-u)/r,y:c};e={x:(s-u)/r,y:s}}else{if(i){if(i.y<c)return}else i={x:(s-u)/r,y:s};e={x:(c-u)/r,y:c}}else if(v>g){if(i){if(i.x>=a)return}else i={x:o,y:r*o+u};e={x:a,y:r*a+u}}else{if(i){if(i.x<o)return}else i={x:a,y:r*a+u};e={x:o,y:r*o+u}}return n.a=i,n.b=e,!0}function Jr(n,t){this.l=n,this.r=t,this.a=this.b=null}function Wr(n,t,e,r){var u=new Jr(n,t);return Jc.push(u),e&&Kr(u,n,t,e),r&&Kr(u,t,n,r),Wc[n.i].edges.push(new Qr(u,n,t)),Wc[t.i].edges.push(new Qr(u,t,n)),u}function Gr(n,t,e){var r=new Jr(n,null);return r.a=t,r.b=e,Jc.push(r),r}function Kr(n,t,e,r){n.a||n.b?n.l===e?n.b=r:n.a=r:(n.a=r,n.l=t,n.r=e)}function Qr(n,t,e){var r=n.a,u=n.b;this.edge=n,this.site=t,this.angle=e?Math.atan2(e.y-t.y,e.x-t.x):n.l===t?Math.atan2(u.x-r.x,r.y-u.y):Math.atan2(r.x-u.x,u.y-r.y)}function nu(){this._=null}function tu(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function eu(n,t){var e=t,r=t.R,u=e.U;u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e}function ru(n,t){var e=t,r=t.L,u=e.U;u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e}function uu(n){for(;n.L;)n=n.L;return n}function iu(n,t){var e,r,u,i=n.sort(ou).pop();for(Jc=[],Wc=new Array(n.length),Gc=new nu,Qc=new nu;;)if(u=Kc,i&&(!u||i.y<u.y||i.y===u.y&&i.x<u.x))(i.x!==e||i.y!==r)&&(Wc[i.i]=new Or(i),jr(i),e=i.x,r=i.y),i=n.pop();else{if(!u)break;Ur(u.arc)}t&&(Xr(t),Yr(t));var o={cells:Wc,edges:Jc};return Gc=Qc=Jc=Wc=null,o}function ou(n,t){return t.y-n.y||t.x-n.x}function au(n,t,e){return(n.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-n.y)}function cu(n){return n.x}function su(n){return n.y}function lu(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function fu(n,t,e,r,u,i){if(!n(t,e,r,u,i)){var o=.5*(e+u),a=.5*(r+i),c=t.nodes;c[0]&&fu(n,c[0],e,r,o,a),c[1]&&fu(n,c[1],o,r,u,a),c[2]&&fu(n,c[2],e,a,o,i),c[3]&&fu(n,c[3],o,a,u,i)}}function hu(n,t){n=Go.rgb(n),t=Go.rgb(t);var e=n.r,r=n.g,u=n.b,i=t.r-e,o=t.g-r,a=t.b-u;return function(n){return"#"+Mt(Math.round(e+i*n))+Mt(Math.round(r+o*n))+Mt(Math.round(u+a*n))}}function gu(n,t){var e,r={},u={};for(e in n)e in t?r[e]=du(n[e],t[e]):u[e]=n[e];for(e in t)e in n||(u[e]=t[e]);return function(n){for(e in r)u[e]=r[e](n);return u}}function pu(n,t){return t-=n=+n,function(e){return n+t*e}}function vu(n,t){var e,r,u,i,o,a=0,c=0,s=[],l=[];for(n+="",t+="",rs.lastIndex=0,r=0;e=rs.exec(t);++r)e.index&&s.push(t.substring(a,c=e.index)),l.push({i:s.length,x:e[0]}),s.push(null),a=rs.lastIndex;for(a<t.length&&s.push(t.substring(a)),r=0,i=l.length;(e=rs.exec(n))&&i>r;++r)if(o=l[r],o.x==e[0]){if(o.i)if(null==s[o.i+1])for(s[o.i-1]+=o.x,s.splice(o.i,1),u=r+1;i>u;++u)l[u].i--;else for(s[o.i-1]+=o.x+s[o.i+1],s.splice(o.i,2),u=r+1;i>u;++u)l[u].i-=2;else if(null==s[o.i+1])s[o.i]=o.x;else for(s[o.i]=o.x+s[o.i+1],s.splice(o.i+1,1),u=r+1;i>u;++u)l[u].i--;l.splice(r,1),i--,r--}else o.x=pu(parseFloat(e[0]),parseFloat(o.x));for(;i>r;)o=l.pop(),null==s[o.i+1]?s[o.i]=o.x:(s[o.i]=o.x+s[o.i+1],s.splice(o.i+1,1)),i--;return 1===s.length?null==s[0]?(o=l[0].x,function(n){return o(n)+""}):function(){return t}:function(n){for(r=0;i>r;++r)s[(o=l[r]).i]=o.x(n);return s.join("")}}function du(n,t){for(var e,r=Go.interpolators.length;--r>=0&&!(e=Go.interpolators[r](n,t)););return e}function mu(n,t){var e,r=[],u=[],i=n.length,o=t.length,a=Math.min(n.length,t.length);for(e=0;a>e;++e)r.push(du(n[e],t[e]));for(;i>e;++e)u[e]=n[e];for(;o>e;++e)u[e]=t[e];return function(n){for(e=0;a>e;++e)u[e]=r[e](n);return u}}function yu(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}function xu(n){return function(t){return 1-n(1-t)}}function Mu(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function _u(n){return n*n}function bu(n){return n*n*n}function wu(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,e=t*n;return 4*(.5>n?e:3*(n-t)+e-.75)}function Su(n){return function(t){return Math.pow(t,n)}}function ku(n){return 1-Math.cos(n*La)}function Eu(n){return Math.pow(2,10*(n-1))}function Nu(n){return 1-Math.sqrt(1-n*n)}function Au(n,t){var e;return arguments.length<2&&(t=.45),arguments.length?e=t/Ca*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-e)*Ca/t)}}function Cu(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function Lu(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function Tu(n,t){n=Go.hcl(n),t=Go.hcl(t);var e=n.h,r=n.c,u=n.l,i=t.h-e,o=t.c-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return ct(e+i*n,r+o*n,u+a*n)+""}}function qu(n,t){n=Go.hsl(n),t=Go.hsl(t);var e=n.h,r=n.s,u=n.l,i=t.h-e,o=t.s-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return it(e+i*n,r+o*n,u+a*n)+""}}function zu(n,t){n=Go.lab(n),t=Go.lab(t);var e=n.l,r=n.a,u=n.b,i=t.l-e,o=t.a-r,a=t.b-u;return function(n){return ft(e+i*n,r+o*n,u+a*n)+""}}function Ru(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function Du(n){var t=[n.a,n.b],e=[n.c,n.d],r=Uu(t),u=Pu(t,e),i=Uu(ju(e,t,-u))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,u*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*Ra,this.translate=[n.e,n.f],this.scale=[r,i],this.skew=i?Math.atan2(u,i)*Ra:0}function Pu(n,t){return n[0]*t[0]+n[1]*t[1]}function Uu(n){var t=Math.sqrt(Pu(n,n));return t&&(n[0]/=t,n[1]/=t),t}function ju(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}function Hu(n,t){var e,r=[],u=[],i=Go.transform(n),o=Go.transform(t),a=i.translate,c=o.translate,s=i.rotate,l=o.rotate,f=i.skew,h=o.skew,g=i.scale,p=o.scale;return a[0]!=c[0]||a[1]!=c[1]?(r.push("translate(",null,",",null,")"),u.push({i:1,x:pu(a[0],c[0])},{i:3,x:pu(a[1],c[1])})):c[0]||c[1]?r.push("translate("+c+")"):r.push(""),s!=l?(s-l>180?l+=360:l-s>180&&(s+=360),u.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:pu(s,l)})):l&&r.push(r.pop()+"rotate("+l+")"),f!=h?u.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:pu(f,h)}):h&&r.push(r.pop()+"skewX("+h+")"),g[0]!=p[0]||g[1]!=p[1]?(e=r.push(r.pop()+"scale(",null,",",null,")"),u.push({i:e-4,x:pu(g[0],p[0])},{i:e-2,x:pu(g[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),e=u.length,function(n){for(var t,i=-1;++i<e;)r[(t=u[i]).i]=t.x(n);return r.join("")}}function Fu(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return(e-n)*t}}function Ou(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return Math.max(0,Math.min(1,(e-n)*t))}}function Yu(n){for(var t=n.source,e=n.target,r=Zu(t,e),u=[t];t!==r;)t=t.parent,u.push(t);for(var i=u.length;e!==r;)u.splice(i,0,e),e=e.parent;return u}function Iu(n){for(var t=[],e=n.parent;null!=e;)t.push(n),n=e,e=e.parent;return t.push(n),t}function Zu(n,t){if(n===t)return n;for(var e=Iu(n),r=Iu(t),u=e.pop(),i=r.pop(),o=null;u===i;)o=u,u=e.pop(),i=r.pop();return o}function Vu(n){n.fixed|=2}function $u(n){n.fixed&=-7}function Xu(n){n.fixed|=4,n.px=n.x,n.py=n.y}function Bu(n){n.fixed&=-5}function Ju(n,t,e){var r=0,u=0;if(n.charge=0,!n.leaf)for(var i,o=n.nodes,a=o.length,c=-1;++c<a;)i=o[c],null!=i&&(Ju(i,t,e),n.charge+=i.charge,r+=i.charge*i.cx,u+=i.charge*i.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var s=t*e[n.point.index];n.charge+=n.pointCharge=s,r+=s*n.point.x,u+=s*n.point.y}n.cx=r/n.charge,n.cy=u/n.charge}function Wu(n,t){return Go.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=ni,n}function Gu(n){return n.children}function Ku(n){return n.value}function Qu(n,t){return t.value-n.value}function ni(n){return Go.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function ti(n){return n.x}function ei(n){return n.y}function ri(n,t,e){n.y0=t,n.y=e}function ui(n){return Go.range(n.length)}function ii(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function oi(n){for(var t,e=1,r=0,u=n[0][1],i=n.length;i>e;++e)(t=n[e][1])>u&&(r=e,u=t);return r}function ai(n){return n.reduce(ci,0)}function ci(n,t){return n+t[1]}function si(n,t){return li(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function li(n,t){for(var e=-1,r=+n[0],u=(n[1]-r)/t,i=[];++e<=t;)i[e]=u*e+r;return i}function fi(n){return[Go.min(n),Go.max(n)]}function hi(n,t){return n.parent==t.parent?1:2}function gi(n){var t=n.children;return t&&t.length?t[0]:n._tree.thread}function pi(n){var t,e=n.children;return e&&(t=e.length)?e[t-1]:n._tree.thread}function vi(n,t){var e=n.children;if(e&&(u=e.length))for(var r,u,i=-1;++i<u;)t(r=vi(e[i],t),n)>0&&(n=r);return n}function di(n,t){return n.x-t.x}function mi(n,t){return t.x-n.x}function yi(n,t){return n.depth-t.depth}function xi(n,t){function e(n,r){var u=n.children;if(u&&(o=u.length))for(var i,o,a=null,c=-1;++c<o;)i=u[c],e(i,a),a=i;t(n,r)}e(n,null)}function Mi(n){for(var t,e=0,r=0,u=n.children,i=u.length;--i>=0;)t=u[i]._tree,t.prelim+=e,t.mod+=e,e+=t.shift+(r+=t.change)}function _i(n,t,e){n=n._tree,t=t._tree;var r=e/(t.number-n.number);n.change+=r,t.change-=r,t.shift+=e,t.prelim+=e,t.mod+=e}function bi(n,t,e){return n._tree.ancestor.parent==t.parent?n._tree.ancestor:e}function wi(n,t){return n.value-t.value}function Si(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t}function ki(n,t){n._pack_next=t,t._pack_prev=n}function Ei(n,t){var e=t.x-n.x,r=t.y-n.y,u=n.r+t.r;return.999*u*u>e*e+r*r}function Ni(n){function t(n){l=Math.min(n.x-n.r,l),f=Math.max(n.x+n.r,f),h=Math.min(n.y-n.r,h),g=Math.max(n.y+n.r,g)}if((e=n.children)&&(s=e.length)){var e,r,u,i,o,a,c,s,l=1/0,f=-1/0,h=1/0,g=-1/0;if(e.forEach(Ai),r=e[0],r.x=-r.r,r.y=0,t(r),s>1&&(u=e[1],u.x=u.r,u.y=0,t(u),s>2))for(i=e[2],Ti(r,u,i),t(i),Si(r,i),r._pack_prev=i,Si(i,u),u=r._pack_next,o=3;s>o;o++){Ti(r,u,i=e[o]);var p=0,v=1,d=1;for(a=u._pack_next;a!==u;a=a._pack_next,v++)if(Ei(a,i)){p=1;break}if(1==p)for(c=r._pack_prev;c!==a._pack_prev&&!Ei(c,i);c=c._pack_prev,d++);p?(d>v||v==d&&u.r<r.r?ki(r,u=a):ki(r=c,u),o--):(Si(r,i),u=i,t(i))}var m=(l+f)/2,y=(h+g)/2,x=0;for(o=0;s>o;o++)i=e[o],i.x-=m,i.y-=y,x=Math.max(x,i.r+Math.sqrt(i.x*i.x+i.y*i.y));n.r=x,e.forEach(Ci)}}function Ai(n){n._pack_next=n._pack_prev=n}function Ci(n){delete n._pack_next,delete n._pack_prev}function Li(n,t,e,r){var u=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,u)for(var i=-1,o=u.length;++i<o;)Li(u[i],t,e,r)}function Ti(n,t,e){var r=n.r+e.r,u=t.x-n.x,i=t.y-n.y;if(r&&(u||i)){var o=t.r+e.r,a=u*u+i*i;o*=o,r*=r;var c=.5+(r-o)/(2*a),s=Math.sqrt(Math.max(0,2*o*(r+a)-(r-=a)*r-o*o))/(2*a);e.x=n.x+c*u+s*i,e.y=n.y+c*i-s*u}else e.x=n.x+r,e.y=n.y}function qi(n){return 1+Go.max(n,function(n){return n.y})}function zi(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function Ri(n){var t=n.children;return t&&t.length?Ri(t[0]):n}function Di(n){var t,e=n.children;return e&&(t=e.length)?Di(e[t-1]):n}function Pi(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Ui(n,t){var e=n.x+t[3],r=n.y+t[0],u=n.dx-t[1]-t[3],i=n.dy-t[0]-t[2];return 0>u&&(e+=u/2,u=0),0>i&&(r+=i/2,i=0),{x:e,y:r,dx:u,dy:i}}function ji(n){var t=n[0],e=n[n.length-1];return e>t?[t,e]:[e,t]}function Hi(n){return n.rangeExtent?n.rangeExtent():ji(n.range())}function Fi(n,t,e,r){var u=e(n[0],n[1]),i=r(t[0],t[1]);return function(n){return i(u(n))}}function Oi(n,t){var e,r=0,u=n.length-1,i=n[r],o=n[u];return i>o&&(e=r,r=u,u=e,e=i,i=o,o=e),n[r]=t.floor(i),n[u]=t.ceil(o),n}function Yi(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:ps}function Ii(n,t,e,r){var u=[],i=[],o=0,a=Math.min(n.length,t.length)-1;for(n[a]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<=a;)u.push(e(n[o-1],n[o])),i.push(r(t[o-1],t[o]));return function(t){var e=Go.bisect(n,t,1,a)-1;return i[e](u[e](t))}}function Zi(n,t,e,r){function u(){var u=Math.min(n.length,t.length)>2?Ii:Fi,c=r?Ou:Fu;return o=u(n,t,c,e),a=u(t,n,c,du),i}function i(n){return o(n)}var o,a;return i.invert=function(n){return a(n)},i.domain=function(t){return arguments.length?(n=t.map(Number),u()):n},i.range=function(n){return arguments.length?(t=n,u()):t},i.rangeRound=function(n){return i.range(n).interpolate(Ru)},i.clamp=function(n){return arguments.length?(r=n,u()):r},i.interpolate=function(n){return arguments.length?(e=n,u()):e},i.ticks=function(t){return Bi(n,t)},i.tickFormat=function(t,e){return Ji(n,t,e)},i.nice=function(t){return $i(n,t),u()},i.copy=function(){return Zi(n,t,e,r)},u()}function Vi(n,t){return Go.rebind(n,t,"range","rangeRound","interpolate","clamp")}function $i(n,t){return Oi(n,Yi(Xi(n,t)[2]))}function Xi(n,t){null==t&&(t=10);var e=ji(n),r=e[1]-e[0],u=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),i=t/r*u;return.15>=i?u*=10:.35>=i?u*=5:.75>=i&&(u*=2),e[0]=Math.ceil(e[0]/u)*u,e[1]=Math.floor(e[1]/u)*u+.5*u,e[2]=u,e}function Bi(n,t){return Go.range.apply(Go,Xi(n,t))}function Ji(n,t,e){var r=Xi(n,t);if(e){var u=rc.exec(e);if(u.shift(),"s"===u[8]){var i=Go.formatPrefix(Math.max(fa(r[0]),fa(r[1])));return u[7]||(u[7]="."+Wi(i.scale(r[2]))),u[8]="f",e=Go.format(u.join("")),function(n){return e(i.scale(n))+i.symbol}}u[7]||(u[7]="."+Gi(u[8],r)),e=u.join("")}else e=",."+Wi(r[2])+"f";return Go.format(e)}function Wi(n){return-Math.floor(Math.log(n)/Math.LN10+.01)}function Gi(n,t){var e=Wi(t[2]);return n in vs?Math.abs(e-Wi(Math.max(fa(t[0]),fa(t[1]))))+ +("e"!==n):e-2*("%"===n)}function Ki(n,t,e,r){function u(n){return(e?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(t)}function i(n){return e?Math.pow(t,n):-Math.pow(t,-n)}function o(t){return n(u(t))}return o.invert=function(t){return i(n.invert(t))},o.domain=function(t){return arguments.length?(e=t[0]>=0,n.domain((r=t.map(Number)).map(u)),o):r},o.base=function(e){return arguments.length?(t=+e,n.domain(r.map(u)),o):t},o.nice=function(){var t=Oi(r.map(u),e?Math:ms);return n.domain(t),r=t.map(i),o},o.ticks=function(){var n=ji(r),o=[],a=n[0],c=n[1],s=Math.floor(u(a)),l=Math.ceil(u(c)),f=t%1?2:t;if(isFinite(l-s)){if(e){for(;l>s;s++)for(var h=1;f>h;h++)o.push(i(s)*h);o.push(i(s))}else for(o.push(i(s));s++<l;)for(var h=f-1;h>0;h--)o.push(i(s)*h);for(s=0;o[s]<a;s++);for(l=o.length;o[l-1]>c;l--);o=o.slice(s,l)}return o},o.tickFormat=function(n,t){if(!arguments.length)return ds;arguments.length<2?t=ds:"function"!=typeof t&&(t=Go.format(t));var r,a=Math.max(.1,n/o.ticks().length),c=e?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(n){return n/i(c(u(n)+r))<=a?t(n):""}},o.copy=function(){return Ki(n.copy(),t,e,r)},Vi(o,n)}function Qi(n,t,e){function r(t){return n(u(t))}var u=no(t),i=no(1/t);return r.invert=function(t){return i(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(u)),r):e},r.ticks=function(n){return Bi(e,n)},r.tickFormat=function(n,t){return Ji(e,n,t)},r.nice=function(n){return r.domain($i(e,n))},r.exponent=function(o){return arguments.length?(u=no(t=o),i=no(1/t),n.domain(e.map(u)),r):t},r.copy=function(){return Qi(n.copy(),t,e)},Vi(r,n)}function no(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function to(n,t){function e(e){return i[((u.get(e)||("range"===t.t?u.set(e,n.push(e)):0/0))-1)%i.length]}function r(t,e){return Go.range(n.length).map(function(n){return t+e*n})}var u,i,a;return e.domain=function(r){if(!arguments.length)return n;n=[],u=new o;for(var i,a=-1,c=r.length;++a<c;)u.has(i=r[a])||u.set(i,n.push(i));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(i=n,a=0,t={t:"range",a:arguments},e):i},e.rangePoints=function(u,o){arguments.length<2&&(o=0);var c=u[0],s=u[1],l=(s-c)/(Math.max(1,n.length-1)+o);return i=r(n.length<2?(c+s)/2:c+l*o/2,l),a=0,t={t:"rangePoints",a:arguments},e},e.rangeBands=function(u,o,c){arguments.length<2&&(o=0),arguments.length<3&&(c=o);var s=u[1]<u[0],l=u[s-0],f=u[1-s],h=(f-l)/(n.length-o+2*c);return i=r(l+h*c,h),s&&i.reverse(),a=h*(1-o),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(u,o,c){arguments.length<2&&(o=0),arguments.length<3&&(c=o);var s=u[1]<u[0],l=u[s-0],f=u[1-s],h=Math.floor((f-l)/(n.length-o+2*c)),g=f-l-(n.length-o)*h;return i=r(l+Math.round(g/2),h),s&&i.reverse(),a=Math.round(h*(1-o)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return a},e.rangeExtent=function(){return ji(t.a[0])},e.copy=function(){return to(n,t)},e.domain(n)}function eo(t,e){function r(){var n=0,r=e.length;for(i=[];++n<r;)i[n-1]=Go.quantile(t,n/r);return u}function u(n){return isNaN(n=+n)?void 0:e[Go.bisect(i,n)]}var i;return u.domain=function(e){return arguments.length?(t=e.filter(function(n){return!isNaN(n)}).sort(n),r()):t},u.range=function(n){return arguments.length?(e=n,r()):e},u.quantiles=function(){return i},u.invertExtent=function(n){return n=e.indexOf(n),0>n?[0/0,0/0]:[n>0?i[n-1]:t[0],n<i.length?i[n]:t[t.length-1]]},u.copy=function(){return eo(t,e)},r()}function ro(n,t,e){function r(t){return e[Math.max(0,Math.min(o,Math.floor(i*(t-n))))]}function u(){return i=e.length/(t-n),o=e.length-1,r}var i,o;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],u()):[n,t]},r.range=function(n){return arguments.length?(e=n,u()):e},r.invertExtent=function(t){return t=e.indexOf(t),t=0>t?0/0:t/i+n,[t,t+1/i]},r.copy=function(){return ro(n,t,e)},u()}function uo(n,t){function e(e){return e>=e?t[Go.bisect(n,e)]:void 0}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]]},e.copy=function(){return uo(n,t)},e}function io(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return Bi(n,t)},t.tickFormat=function(t,e){return Ji(n,t,e)},t.copy=function(){return io(n)},t}function oo(n){return n.innerRadius}function ao(n){return n.outerRadius}function co(n){return n.startAngle}function so(n){return n.endAngle}function lo(n){function t(t){function o(){s.push("M",i(n(l),a))}for(var c,s=[],l=[],f=-1,h=t.length,g=Et(e),p=Et(r);++f<h;)u.call(this,c=t[f],f)?l.push([+g.call(this,c,f),+p.call(this,c,f)]):l.length&&(o(),l=[]);return l.length&&o(),s.length?s.join(""):null}var e=Nr,r=Ar,u=Ne,i=fo,o=i.key,a=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(u=n,t):u},t.interpolate=function(n){return arguments.length?(o="function"==typeof n?i=n:(i=Ss.get(n)||fo).key,t):o},t.tension=function(n){return arguments.length?(a=n,t):a},t}function fo(n){return n.join("L")}function ho(n){return fo(n)+"Z"}function go(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);return e>1&&u.push("H",r[0]),u.join("")}function po(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("V",(r=n[t])[1],"H",r[0]);return u.join("")}function vo(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r=n[t])[0],"V",r[1]);return u.join("")}function mo(n,t){return n.length<4?fo(n):n[1]+Mo(n.slice(1,n.length-1),_o(n,t))}function yo(n,t){return n.length<3?fo(n):n[0]+Mo((n.push(n[0]),n),_o([n[n.length-2]].concat(n,[n[1]]),t))}function xo(n,t){return n.length<3?fo(n):n[0]+Mo(n,_o(n,t))}function Mo(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return fo(n);var e=n.length!=t.length,r="",u=n[0],i=n[1],o=t[0],a=o,c=1;if(e&&(r+="Q"+(i[0]-2*o[0]/3)+","+(i[1]-2*o[1]/3)+","+i[0]+","+i[1],u=n[1],c=2),t.length>1){a=t[1],i=n[c],c++,r+="C"+(u[0]+o[0])+","+(u[1]+o[1])+","+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1];for(var s=2;s<t.length;s++,c++)i=n[c],a=t[s],r+="S"+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1]}if(e){var l=n[c];r+="Q"+(i[0]+2*a[0]/3)+","+(i[1]+2*a[1]/3)+","+l[0]+","+l[1]}return r}function _o(n,t){for(var e,r=[],u=(1-t)/2,i=n[0],o=n[1],a=1,c=n.length;++a<c;)e=i,i=o,o=n[a],r.push([u*(o[0]-e[0]),u*(o[1]-e[1])]);return r}function bo(n){if(n.length<3)return fo(n);var t=1,e=n.length,r=n[0],u=r[0],i=r[1],o=[u,u,u,(r=n[1])[0]],a=[i,i,i,r[1]],c=[u,",",i,"L",Eo(Ns,o),",",Eo(Ns,a)];for(n.push(n[e-1]);++t<=e;)r=n[t],o.shift(),o.push(r[0]),a.shift(),a.push(r[1]),No(c,o,a);return n.pop(),c.push("L",r),c.join("")}function wo(n){if(n.length<4)return fo(n);for(var t,e=[],r=-1,u=n.length,i=[0],o=[0];++r<3;)t=n[r],i.push(t[0]),o.push(t[1]);for(e.push(Eo(Ns,i)+","+Eo(Ns,o)),--r;++r<u;)t=n[r],i.shift(),i.push(t[0]),o.shift(),o.push(t[1]),No(e,i,o);return e.join("")}function So(n){for(var t,e,r=-1,u=n.length,i=u+4,o=[],a=[];++r<4;)e=n[r%u],o.push(e[0]),a.push(e[1]);for(t=[Eo(Ns,o),",",Eo(Ns,a)],--r;++r<i;)e=n[r%u],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),No(t,o,a);return t.join("")}function ko(n,t){var e=n.length-1;if(e)for(var r,u,i=n[0][0],o=n[0][1],a=n[e][0]-i,c=n[e][1]-o,s=-1;++s<=e;)r=n[s],u=s/e,r[0]=t*r[0]+(1-t)*(i+u*a),r[1]=t*r[1]+(1-t)*(o+u*c);return bo(n)}function Eo(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function No(n,t,e){n.push("C",Eo(ks,t),",",Eo(ks,e),",",Eo(Es,t),",",Eo(Es,e),",",Eo(Ns,t),",",Eo(Ns,e))}function Ao(n,t){return(t[1]-n[1])/(t[0]-n[0])}function Co(n){for(var t=0,e=n.length-1,r=[],u=n[0],i=n[1],o=r[0]=Ao(u,i);++t<e;)r[t]=(o+(o=Ao(u=i,i=n[t+1])))/2;return r[t]=o,r}function Lo(n){for(var t,e,r,u,i=[],o=Co(n),a=-1,c=n.length-1;++a<c;)t=Ao(n[a],n[a+1]),fa(t)<Ta?o[a]=o[a+1]=0:(e=o[a]/t,r=o[a+1]/t,u=e*e+r*r,u>9&&(u=3*t/Math.sqrt(u),o[a]=u*e,o[a+1]=u*r));for(a=-1;++a<=c;)u=(n[Math.min(c,a+1)][0]-n[Math.max(0,a-1)][0])/(6*(1+o[a]*o[a])),i.push([u||0,o[a]*u||0]);return i}function To(n){return n.length<3?fo(n):n[0]+Mo(n,Lo(n))}function qo(n){for(var t,e,r,u=-1,i=n.length;++u<i;)t=n[u],e=t[0],r=t[1]+bs,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function zo(n){function t(t){function c(){v.push("M",a(n(m),f),l,s(n(d.reverse()),f),"Z")}for(var h,g,p,v=[],d=[],m=[],y=-1,x=t.length,M=Et(e),_=Et(u),b=e===r?function(){return g}:Et(r),w=u===i?function(){return p}:Et(i);++y<x;)o.call(this,h=t[y],y)?(d.push([g=+M.call(this,h,y),p=+_.call(this,h,y)]),m.push([+b.call(this,h,y),+w.call(this,h,y)])):d.length&&(c(),d=[],m=[]);return d.length&&c(),v.length?v.join(""):null}var e=Nr,r=Nr,u=0,i=Ar,o=Ne,a=fo,c=a.key,s=a,l="L",f=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(u=i=n,t):i},t.y0=function(n){return arguments.length?(u=n,t):u},t.y1=function(n){return arguments.length?(i=n,t):i},t.defined=function(n){return arguments.length?(o=n,t):o},t.interpolate=function(n){return arguments.length?(c="function"==typeof n?a=n:(a=Ss.get(n)||fo).key,s=a.reverse||a,l=a.closed?"M":"L",t):c},t.tension=function(n){return arguments.length?(f=n,t):f},t}function Ro(n){return n.radius}function Do(n){return[n.x,n.y]}function Po(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]+bs;return[e*Math.cos(r),e*Math.sin(r)]}}function Uo(){return 64}function jo(){return"circle"}function Ho(n){var t=Math.sqrt(n/Aa);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Fo(n,t){return da(n,zs),n.id=t,n}function Oo(n,t,e,r){var u=n.id;return P(n,"function"==typeof e?function(n,i,o){n.__transition__[u].tween.set(t,r(e.call(n,n.__data__,i,o)))}:(e=r(e),function(n){n.__transition__[u].tween.set(t,e)}))}function Yo(n){return null==n&&(n=""),function(){this.textContent=n}}function Io(n,t,e,r){var u=n.__transition__||(n.__transition__={active:0,count:0}),i=u[e];if(!i){var a=r.time;i=u[e]={tween:new o,time:a,ease:r.ease,delay:r.delay,duration:r.duration},++u.count,Go.timer(function(r){function o(r){return u.active>e?s():(u.active=e,i.event&&i.event.start.call(n,l,t),i.tween.forEach(function(e,r){(r=r.call(n,l,t))&&v.push(r)}),Go.timer(function(){return p.c=c(r||1)?Ne:c,1},0,a),void 0)}function c(r){if(u.active!==e)return s();for(var o=r/g,a=f(o),c=v.length;c>0;)v[--c].call(n,a);return o>=1?(i.event&&i.event.end.call(n,l,t),s()):void 0}function s(){return--u.count?delete u[e]:delete n.__transition__,1}var l=n.__data__,f=i.ease,h=i.delay,g=i.duration,p=nc,v=[];return p.t=h+a,r>=h?o(r-h):(p.c=o,void 0)
},0,a)}}function Zo(n,t){n.attr("transform",function(n){return"translate("+t(n)+",0)"})}function Vo(n,t){n.attr("transform",function(n){return"translate(0,"+t(n)+")"})}function $o(n){return n.toISOString()}function Xo(n,t,e){function r(t){return n(t)}function u(n,e){var r=n[1]-n[0],u=r/e,i=Go.bisect(Ys,u);return i==Ys.length?[t.year,Xi(n.map(function(n){return n/31536e6}),e)[2]]:i?t[u/Ys[i-1]<Ys[i]/u?i-1:i]:[Vs,Xi(n,e)[2]]}return r.invert=function(t){return Bo(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(Bo)},r.nice=function(n,t){function e(e){return!isNaN(e)&&!n.range(e,Bo(+e+1),t).length}var i=r.domain(),o=ji(i),a=null==n?u(o,10):"number"==typeof n&&u(o,n);return a&&(n=a[0],t=a[1]),r.domain(Oi(i,t>1?{floor:function(t){for(;e(t=n.floor(t));)t=Bo(t-1);return t},ceil:function(t){for(;e(t=n.ceil(t));)t=Bo(+t+1);return t}}:n))},r.ticks=function(n,t){var e=ji(r.domain()),i=null==n?u(e,10):"number"==typeof n?u(e,n):!n.range&&[{range:n},t];return i&&(n=i[0],t=i[1]),n.range(e[0],Bo(+e[1]+1),1>t?1:t)},r.tickFormat=function(){return e},r.copy=function(){return Xo(n.copy(),t,e)},Vi(r,n)}function Bo(n){return new Date(n)}function Jo(n){return JSON.parse(n.responseText)}function Wo(n){var t=na.createRange();return t.selectNode(na.body),t.createContextualFragment(n.responseText)}var Go={version:"3.4.4"};Date.now||(Date.now=function(){return+new Date});var Ko=[].slice,Qo=function(n){return Ko.call(n)},na=document,ta=na.documentElement,ea=window;try{Qo(ta.childNodes)[0].nodeType}catch(ra){Qo=function(n){for(var t=n.length,e=new Array(t);t--;)e[t]=n[t];return e}}try{na.createElement("div").style.setProperty("opacity",0,"")}catch(ua){var ia=ea.Element.prototype,oa=ia.setAttribute,aa=ia.setAttributeNS,ca=ea.CSSStyleDeclaration.prototype,sa=ca.setProperty;ia.setAttribute=function(n,t){oa.call(this,n,t+"")},ia.setAttributeNS=function(n,t,e){aa.call(this,n,t,e+"")},ca.setProperty=function(n,t,e){sa.call(this,n,t+"",e)}}Go.ascending=n,Go.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:0/0},Go.min=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&!(null!=(e=n[u])&&e>=e);)e=void 0;for(;++u<i;)null!=(r=n[u])&&e>r&&(e=r)}else{for(;++u<i&&!(null!=(e=t.call(n,n[u],u))&&e>=e);)e=void 0;for(;++u<i;)null!=(r=t.call(n,n[u],u))&&e>r&&(e=r)}return e},Go.max=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&!(null!=(e=n[u])&&e>=e);)e=void 0;for(;++u<i;)null!=(r=n[u])&&r>e&&(e=r)}else{for(;++u<i&&!(null!=(e=t.call(n,n[u],u))&&e>=e);)e=void 0;for(;++u<i;)null!=(r=t.call(n,n[u],u))&&r>e&&(e=r)}return e},Go.extent=function(n,t){var e,r,u,i=-1,o=n.length;if(1===arguments.length){for(;++i<o&&!(null!=(e=u=n[i])&&e>=e);)e=u=void 0;for(;++i<o;)null!=(r=n[i])&&(e>r&&(e=r),r>u&&(u=r))}else{for(;++i<o&&!(null!=(e=u=t.call(n,n[i],i))&&e>=e);)e=void 0;for(;++i<o;)null!=(r=t.call(n,n[i],i))&&(e>r&&(e=r),r>u&&(u=r))}return[e,u]},Go.sum=function(n,t){var e,r=0,u=n.length,i=-1;if(1===arguments.length)for(;++i<u;)isNaN(e=+n[i])||(r+=e);else for(;++i<u;)isNaN(e=+t.call(n,n[i],i))||(r+=e);return r},Go.mean=function(n,e){var r,u=n.length,i=0,o=-1,a=0;if(1===arguments.length)for(;++o<u;)t(r=n[o])&&(i+=(r-i)/++a);else for(;++o<u;)t(r=e.call(n,n[o],o))&&(i+=(r-i)/++a);return a?i:void 0},Go.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),u=+n[r-1],i=e-r;return i?u+i*(n[r]-u):u},Go.median=function(e,r){return arguments.length>1&&(e=e.map(r)),e=e.filter(t),e.length?Go.quantile(e.sort(n),.5):void 0};var la=e(n);Go.bisectLeft=la.left,Go.bisect=Go.bisectRight=la.right,Go.bisector=function(t){return e(1===t.length?function(e,r){return n(t(e),r)}:t)},Go.shuffle=function(n){for(var t,e,r=n.length;r;)e=0|Math.random()*r--,t=n[r],n[r]=n[e],n[e]=t;return n},Go.permute=function(n,t){for(var e=t.length,r=new Array(e);e--;)r[e]=n[t[e]];return r},Go.pairs=function(n){for(var t,e=0,r=n.length-1,u=n[0],i=new Array(0>r?0:r);r>e;)i[e]=[t=u,u=n[++e]];return i},Go.zip=function(){if(!(u=arguments.length))return[];for(var n=-1,t=Go.min(arguments,r),e=new Array(t);++n<t;)for(var u,i=-1,o=e[n]=new Array(u);++i<u;)o[i]=arguments[i][n];return e},Go.transpose=function(n){return Go.zip.apply(Go,n)},Go.keys=function(n){var t=[];for(var e in n)t.push(e);return t},Go.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},Go.entries=function(n){var t=[];for(var e in n)t.push({key:e,value:n[e]});return t},Go.merge=function(n){for(var t,e,r,u=n.length,i=-1,o=0;++i<u;)o+=n[i].length;for(e=new Array(o);--u>=0;)for(r=n[u],t=r.length;--t>=0;)e[--o]=r[t];return e};var fa=Math.abs;Go.range=function(n,t,e){if(arguments.length<3&&(e=1,arguments.length<2&&(t=n,n=0)),1/0===(t-n)/e)throw new Error("infinite range");var r,i=[],o=u(fa(e)),a=-1;if(n*=o,t*=o,e*=o,0>e)for(;(r=n+e*++a)>t;)i.push(r/o);else for(;(r=n+e*++a)<t;)i.push(r/o);return i},Go.map=function(n){var t=new o;if(n instanceof o)n.forEach(function(n,e){t.set(n,e)});else for(var e in n)t.set(e,n[e]);return t},i(o,{has:a,get:function(n){return this[ha+n]},set:function(n,t){return this[ha+n]=t},remove:c,keys:s,values:function(){var n=[];return this.forEach(function(t,e){n.push(e)}),n},entries:function(){var n=[];return this.forEach(function(t,e){n.push({key:t,value:e})}),n},size:l,empty:f,forEach:function(n){for(var t in this)t.charCodeAt(0)===ga&&n.call(this,t.substring(1),this[t])}});var ha="\x00",ga=ha.charCodeAt(0);Go.nest=function(){function n(t,a,c){if(c>=i.length)return r?r.call(u,a):e?a.sort(e):a;for(var s,l,f,h,g=-1,p=a.length,v=i[c++],d=new o;++g<p;)(h=d.get(s=v(l=a[g])))?h.push(l):d.set(s,[l]);return t?(l=t(),f=function(e,r){l.set(e,n(t,r,c))}):(l={},f=function(e,r){l[e]=n(t,r,c)}),d.forEach(f),l}function t(n,e){if(e>=i.length)return n;var r=[],u=a[e++];return n.forEach(function(n,u){r.push({key:n,values:t(u,e)})}),u?r.sort(function(n,t){return u(n.key,t.key)}):r}var e,r,u={},i=[],a=[];return u.map=function(t,e){return n(e,t,0)},u.entries=function(e){return t(n(Go.map,e,0),0)},u.key=function(n){return i.push(n),u},u.sortKeys=function(n){return a[i.length-1]=n,u},u.sortValues=function(n){return e=n,u},u.rollup=function(n){return r=n,u},u},Go.set=function(n){var t=new h;if(n)for(var e=0,r=n.length;r>e;++e)t.add(n[e]);return t},i(h,{has:a,add:function(n){return this[ha+n]=!0,n},remove:function(n){return n=ha+n,n in this&&delete this[n]},values:s,size:l,empty:f,forEach:function(n){for(var t in this)t.charCodeAt(0)===ga&&n.call(this,t.substring(1))}}),Go.behavior={},Go.rebind=function(n,t){for(var e,r=1,u=arguments.length;++r<u;)n[e=arguments[r]]=g(n,t,t[e]);return n};var pa=["webkit","ms","moz","Moz","o","O"];Go.dispatch=function(){for(var n=new d,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=m(n);return n},d.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.substring(e+1),n=n.substring(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},Go.event=null,Go.requote=function(n){return n.replace(va,"\\$&")};var va=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,da={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]},ma=function(n,t){return t.querySelector(n)},ya=function(n,t){return t.querySelectorAll(n)},xa=ta[p(ta,"matchesSelector")],Ma=function(n,t){return xa.call(n,t)};"function"==typeof Sizzle&&(ma=function(n,t){return Sizzle(n,t)[0]||null},ya=Sizzle,Ma=Sizzle.matchesSelector),Go.selection=function(){return Sa};var _a=Go.selection.prototype=[];_a.select=function(n){var t,e,r,u,i=[];n=b(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var c=-1,s=r.length;++c<s;)(u=r[c])?(t.push(e=n.call(u,u.__data__,c,o)),e&&"__data__"in u&&(e.__data__=u.__data__)):t.push(null)}return _(i)},_a.selectAll=function(n){var t,e,r=[];n=w(n);for(var u=-1,i=this.length;++u<i;)for(var o=this[u],a=-1,c=o.length;++a<c;)(e=o[a])&&(r.push(t=Qo(n.call(e,e.__data__,a,u))),t.parentNode=e);return _(r)};var ba={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};Go.ns={prefix:ba,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&(e=n.substring(0,t),n=n.substring(t+1)),ba.hasOwnProperty(e)?{space:ba[e],local:n}:n}},_a.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return n=Go.ns.qualify(n),n.local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(S(t,n[t]));return this}return this.each(S(n,t))},_a.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=N(n)).length,u=-1;if(t=e.classList){for(;++u<r;)if(!t.contains(n[u]))return!1}else for(t=e.getAttribute("class");++u<r;)if(!E(n[u]).test(t))return!1;return!0}for(t in n)this.each(A(t,n[t]));return this}return this.each(A(n,t))},_a.style=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t="");for(e in n)this.each(L(e,n[e],t));return this}if(2>r)return ea.getComputedStyle(this.node(),null).getPropertyValue(n);e=""}return this.each(L(n,t,e))},_a.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(T(t,n[t]));return this}return this.each(T(n,t))},_a.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},_a.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},_a.append=function(n){return n=q(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},_a.insert=function(n,t){return n=q(n),t=b(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null)})},_a.remove=function(){return this.each(function(){var n=this.parentNode;n&&n.removeChild(this)})},_a.data=function(n,t){function e(n,e){var r,u,i,a=n.length,f=e.length,h=Math.min(a,f),g=new Array(f),p=new Array(f),v=new Array(a);if(t){var d,m=new o,y=new o,x=[];for(r=-1;++r<a;)d=t.call(u=n[r],u.__data__,r),m.has(d)?v[r]=u:m.set(d,u),x.push(d);for(r=-1;++r<f;)d=t.call(e,i=e[r],r),(u=m.get(d))?(g[r]=u,u.__data__=i):y.has(d)||(p[r]=z(i)),y.set(d,i),m.remove(d);for(r=-1;++r<a;)m.has(x[r])&&(v[r]=n[r])}else{for(r=-1;++r<h;)u=n[r],i=e[r],u?(u.__data__=i,g[r]=u):p[r]=z(i);for(;f>r;++r)p[r]=z(e[r]);for(;a>r;++r)v[r]=n[r]}p.update=g,p.parentNode=g.parentNode=v.parentNode=n.parentNode,c.push(p),s.push(g),l.push(v)}var r,u,i=-1,a=this.length;if(!arguments.length){for(n=new Array(a=(r=this[0]).length);++i<a;)(u=r[i])&&(n[i]=u.__data__);return n}var c=U([]),s=_([]),l=_([]);if("function"==typeof n)for(;++i<a;)e(r=this[i],n.call(r,r.parentNode.__data__,i));else for(;++i<a;)e(r=this[i],n);return s.enter=function(){return c},s.exit=function(){return l},s},_a.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},_a.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=R(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]),t.parentNode=(e=this[i]).parentNode;for(var a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a,i)&&t.push(r)}return _(u)},_a.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],u=r.length-1,i=r[u];--u>=0;)(e=r[u])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);return this},_a.sort=function(n){n=D.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},_a.each=function(n){return P(this,function(t,e,r){n.call(t,t.__data__,e,r)})},_a.call=function(n){var t=Qo(arguments);return n.apply(t[0]=this,t),this},_a.empty=function(){return!this.node()},_a.node=function(){for(var n=0,t=this.length;t>n;n++)for(var e=this[n],r=0,u=e.length;u>r;r++){var i=e[r];if(i)return i}return null},_a.size=function(){var n=0;return this.each(function(){++n}),n};var wa=[];Go.selection.enter=U,Go.selection.enter.prototype=wa,wa.append=_a.append,wa.empty=_a.empty,wa.node=_a.node,wa.call=_a.call,wa.size=_a.size,wa.select=function(n){for(var t,e,r,u,i,o=[],a=-1,c=this.length;++a<c;){r=(u=this[a]).update,o.push(t=[]),t.parentNode=u.parentNode;for(var s=-1,l=u.length;++s<l;)(i=u[s])?(t.push(r[s]=e=n.call(u.parentNode,i.__data__,s,a)),e.__data__=i.__data__):t.push(null)}return _(o)},wa.insert=function(n,t){return arguments.length<2&&(t=j(this)),_a.insert.call(this,n,t)},_a.transition=function(){for(var n,t,e=Cs||++Rs,r=[],u=Ls||{time:Date.now(),ease:wu,delay:0,duration:250},i=-1,o=this.length;++i<o;){r.push(n=[]);for(var a=this[i],c=-1,s=a.length;++c<s;)(t=a[c])&&Io(t,c,e,u),n.push(t)}return Fo(r,e)},_a.interrupt=function(){return this.each(H)},Go.select=function(n){var t=["string"==typeof n?ma(n,na):n];return t.parentNode=ta,_([t])},Go.selectAll=function(n){var t=Qo("string"==typeof n?ya(n,na):n);return t.parentNode=ta,_([t])};var Sa=Go.select(ta);_a.on=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(e in n)this.each(F(e,n[e],t));return this}if(2>r)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(F(n,t,e))};var ka=Go.map({mouseenter:"mouseover",mouseleave:"mouseout"});ka.forEach(function(n){"on"+n in na&&ka.remove(n)});var Ea="onselectstart"in na?null:p(ta.style,"userSelect"),Na=0;Go.mouse=function(n){return Z(n,x())},Go.touches=function(n,t){return arguments.length<2&&(t=x().touches),t?Qo(t).map(function(t){var e=Z(n,t);return e.identifier=t.identifier,e}):[]},Go.behavior.drag=function(){function n(){this.on("mousedown.drag",u).on("touchstart.drag",i)}function t(n,t,u,i,o){return function(){function a(){var n,e,r=t(h,v);r&&(n=r[0]-x[0],e=r[1]-x[1],p|=n|e,x=r,g({type:"drag",x:r[0]+s[0],y:r[1]+s[1],dx:n,dy:e}))}function c(){t(h,v)&&(m.on(i+d,null).on(o+d,null),y(p&&Go.event.target===f),g({type:"dragend"}))}var s,l=this,f=Go.event.target,h=l.parentNode,g=e.of(l,arguments),p=0,v=n(),d=".drag"+(null==v?"":"-"+v),m=Go.select(u()).on(i+d,a).on(o+d,c),y=I(),x=t(h,v);r?(s=r.apply(l,arguments),s=[s.x-x[0],s.y-x[1]]):s=[0,0],g({type:"dragstart"})}}var e=M(n,"drag","dragstart","dragend"),r=null,u=t(v,Go.mouse,X,"mousemove","mouseup"),i=t(V,Go.touch,$,"touchmove","touchend");return n.origin=function(t){return arguments.length?(r=t,n):r},Go.rebind(n,e,"on")};var Aa=Math.PI,Ca=2*Aa,La=Aa/2,Ta=1e-6,qa=Ta*Ta,za=Aa/180,Ra=180/Aa,Da=Math.SQRT2,Pa=2,Ua=4;Go.interpolateZoom=function(n,t){function e(n){var t=n*y;if(m){var e=Q(v),o=i/(Pa*h)*(e*nt(Da*t+v)-K(v));return[r+o*s,u+o*l,i*e/Q(Da*t+v)]}return[r+n*s,u+n*l,i*Math.exp(Da*t)]}var r=n[0],u=n[1],i=n[2],o=t[0],a=t[1],c=t[2],s=o-r,l=a-u,f=s*s+l*l,h=Math.sqrt(f),g=(c*c-i*i+Ua*f)/(2*i*Pa*h),p=(c*c-i*i-Ua*f)/(2*c*Pa*h),v=Math.log(Math.sqrt(g*g+1)-g),d=Math.log(Math.sqrt(p*p+1)-p),m=d-v,y=(m||Math.log(c/i))/Da;return e.duration=1e3*y,e},Go.behavior.zoom=function(){function n(n){n.on(N,s).on(Fa+".zoom",f).on(A,h).on("dblclick.zoom",g).on(L,l)}function t(n){return[(n[0]-S.x)/S.k,(n[1]-S.y)/S.k]}function e(n){return[n[0]*S.k+S.x,n[1]*S.k+S.y]}function r(n){S.k=Math.max(E[0],Math.min(E[1],n))}function u(n,t){t=e(t),S.x+=n[0]-t[0],S.y+=n[1]-t[1]}function i(){_&&_.domain(x.range().map(function(n){return(n-S.x)/S.k}).map(x.invert)),w&&w.domain(b.range().map(function(n){return(n-S.y)/S.k}).map(b.invert))}function o(n){n({type:"zoomstart"})}function a(n){i(),n({type:"zoom",scale:S.k,translate:[S.x,S.y]})}function c(n){n({type:"zoomend"})}function s(){function n(){l=1,u(Go.mouse(r),g),a(s)}function e(){f.on(A,ea===r?h:null).on(C,null),p(l&&Go.event.target===i),c(s)}var r=this,i=Go.event.target,s=T.of(r,arguments),l=0,f=Go.select(ea).on(A,n).on(C,e),g=t(Go.mouse(r)),p=I();H.call(r),o(s)}function l(){function n(){var n=Go.touches(g);return h=S.k,n.forEach(function(n){n.identifier in v&&(v[n.identifier]=t(n))}),n}function e(){for(var t=Go.event.changedTouches,e=0,i=t.length;i>e;++e)v[t[e].identifier]=null;var o=n(),c=Date.now();if(1===o.length){if(500>c-m){var s=o[0],l=v[s.identifier];r(2*S.k),u(s,l),y(),a(p)}m=c}else if(o.length>1){var s=o[0],f=o[1],h=s[0]-f[0],g=s[1]-f[1];d=h*h+g*g}}function i(){for(var n,t,e,i,o=Go.touches(g),c=0,s=o.length;s>c;++c,i=null)if(e=o[c],i=v[e.identifier]){if(t)break;n=e,t=i}if(i){var l=(l=e[0]-n[0])*l+(l=e[1]-n[1])*l,f=d&&Math.sqrt(l/d);n=[(n[0]+e[0])/2,(n[1]+e[1])/2],t=[(t[0]+i[0])/2,(t[1]+i[1])/2],r(f*h)}m=null,u(n,t),a(p)}function f(){if(Go.event.touches.length){for(var t=Go.event.changedTouches,e=0,r=t.length;r>e;++e)delete v[t[e].identifier];for(var u in v)return void n()}b.on(x,null),w.on(N,s).on(L,l),k(),c(p)}var h,g=this,p=T.of(g,arguments),v={},d=0,x=".zoom-"+Go.event.changedTouches[0].identifier,M="touchmove"+x,_="touchend"+x,b=Go.select(Go.event.target).on(M,i).on(_,f),w=Go.select(g).on(N,null).on(L,e),k=I();H.call(g),e(),o(p)}function f(){var n=T.of(this,arguments);d?clearTimeout(d):(H.call(this),o(n)),d=setTimeout(function(){d=null,c(n)},50),y();var e=v||Go.mouse(this);p||(p=t(e)),r(Math.pow(2,.002*ja())*S.k),u(e,p),a(n)}function h(){p=null}function g(){var n=T.of(this,arguments),e=Go.mouse(this),i=t(e),s=Math.log(S.k)/Math.LN2;o(n),r(Math.pow(2,Go.event.shiftKey?Math.ceil(s)-1:Math.floor(s)+1)),u(e,i),a(n),c(n)}var p,v,d,m,x,_,b,w,S={x:0,y:0,k:1},k=[960,500],E=Ha,N="mousedown.zoom",A="mousemove.zoom",C="mouseup.zoom",L="touchstart.zoom",T=M(n,"zoomstart","zoom","zoomend");return n.event=function(n){n.each(function(){var n=T.of(this,arguments),t=S;Cs?Go.select(this).transition().each("start.zoom",function(){S=this.__chart__||{x:0,y:0,k:1},o(n)}).tween("zoom:zoom",function(){var e=k[0],r=k[1],u=e/2,i=r/2,o=Go.interpolateZoom([(u-S.x)/S.k,(i-S.y)/S.k,e/S.k],[(u-t.x)/t.k,(i-t.y)/t.k,e/t.k]);return function(t){var r=o(t),c=e/r[2];this.__chart__=S={x:u-r[0]*c,y:i-r[1]*c,k:c},a(n)}}).each("end.zoom",function(){c(n)}):(this.__chart__=S,o(n),a(n),c(n))})},n.translate=function(t){return arguments.length?(S={x:+t[0],y:+t[1],k:S.k},i(),n):[S.x,S.y]},n.scale=function(t){return arguments.length?(S={x:S.x,y:S.y,k:+t},i(),n):S.k},n.scaleExtent=function(t){return arguments.length?(E=null==t?Ha:[+t[0],+t[1]],n):E},n.center=function(t){return arguments.length?(v=t&&[+t[0],+t[1]],n):v},n.size=function(t){return arguments.length?(k=t&&[+t[0],+t[1]],n):k},n.x=function(t){return arguments.length?(_=t,x=t.copy(),S={x:0,y:0,k:1},n):_},n.y=function(t){return arguments.length?(w=t,b=t.copy(),S={x:0,y:0,k:1},n):w},Go.rebind(n,T,"on")};var ja,Ha=[0,1/0],Fa="onwheel"in na?(ja=function(){return-Go.event.deltaY*(Go.event.deltaMode?120:1)},"wheel"):"onmousewheel"in na?(ja=function(){return Go.event.wheelDelta},"mousewheel"):(ja=function(){return-Go.event.detail},"MozMousePixelScroll");et.prototype.toString=function(){return this.rgb()+""},Go.hsl=function(n,t,e){return 1===arguments.length?n instanceof ut?rt(n.h,n.s,n.l):_t(""+n,bt,rt):rt(+n,+t,+e)};var Oa=ut.prototype=new et;Oa.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),rt(this.h,this.s,this.l/n)},Oa.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),rt(this.h,this.s,n*this.l)},Oa.rgb=function(){return it(this.h,this.s,this.l)},Go.hcl=function(n,t,e){return 1===arguments.length?n instanceof at?ot(n.h,n.c,n.l):n instanceof lt?ht(n.l,n.a,n.b):ht((n=wt((n=Go.rgb(n)).r,n.g,n.b)).l,n.a,n.b):ot(+n,+t,+e)};var Ya=at.prototype=new et;Ya.brighter=function(n){return ot(this.h,this.c,Math.min(100,this.l+Ia*(arguments.length?n:1)))},Ya.darker=function(n){return ot(this.h,this.c,Math.max(0,this.l-Ia*(arguments.length?n:1)))},Ya.rgb=function(){return ct(this.h,this.c,this.l).rgb()},Go.lab=function(n,t,e){return 1===arguments.length?n instanceof lt?st(n.l,n.a,n.b):n instanceof at?ct(n.l,n.c,n.h):wt((n=Go.rgb(n)).r,n.g,n.b):st(+n,+t,+e)};var Ia=18,Za=.95047,Va=1,$a=1.08883,Xa=lt.prototype=new et;Xa.brighter=function(n){return st(Math.min(100,this.l+Ia*(arguments.length?n:1)),this.a,this.b)},Xa.darker=function(n){return st(Math.max(0,this.l-Ia*(arguments.length?n:1)),this.a,this.b)},Xa.rgb=function(){return ft(this.l,this.a,this.b)},Go.rgb=function(n,t,e){return 1===arguments.length?n instanceof xt?yt(n.r,n.g,n.b):_t(""+n,yt,it):yt(~~n,~~t,~~e)};var Ba=xt.prototype=new et;Ba.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,u=30;return t||e||r?(t&&u>t&&(t=u),e&&u>e&&(e=u),r&&u>r&&(r=u),yt(Math.min(255,~~(t/n)),Math.min(255,~~(e/n)),Math.min(255,~~(r/n)))):yt(u,u,u)},Ba.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),yt(~~(n*this.r),~~(n*this.g),~~(n*this.b))},Ba.hsl=function(){return bt(this.r,this.g,this.b)},Ba.toString=function(){return"#"+Mt(this.r)+Mt(this.g)+Mt(this.b)};var Ja=Go.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Ja.forEach(function(n,t){Ja.set(n,dt(t))}),Go.functor=Et,Go.xhr=At(Nt),Go.dsv=function(n,t){function e(n,e,i){arguments.length<3&&(i=e,e=null);var o=Ct(n,t,null==e?r:u(e),i);return o.row=function(n){return arguments.length?o.response(null==(e=n)?r:u(n)):e},o}function r(n){return e.parse(n.responseText)}function u(n){return function(t){return e.parse(t.responseText,n)}}function i(t){return t.map(o).join(n)}function o(n){return a.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var a=new RegExp('["'+n+"\n]"),c=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var u=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(u(n),e)}:u})},e.parseRows=function(n,t){function e(){if(l>=s)return o;if(u)return u=!1,i;var t=l;if(34===n.charCodeAt(t)){for(var e=t;e++<s;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}l=e+2;var r=n.charCodeAt(e+1);return 13===r?(u=!0,10===n.charCodeAt(e+2)&&++l):10===r&&(u=!0),n.substring(t+1,e).replace(/""/g,'"')}for(;s>l;){var r=n.charCodeAt(l++),a=1;if(10===r)u=!0;else if(13===r)u=!0,10===n.charCodeAt(l)&&(++l,++a);else if(r!==c)continue;return n.substring(t,l-a)}return n.substring(t)}for(var r,u,i={},o={},a=[],s=n.length,l=0,f=0;(r=e())!==o;){for(var h=[];r!==i&&r!==o;)h.push(r),r=e();(!t||(h=t(h,f++)))&&a.push(h)}return a},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new h,u=[];return t.forEach(function(n){for(var t in n)r.has(t)||u.push(r.add(t))}),[u.map(o).join(n)].concat(t.map(function(t){return u.map(function(n){return o(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(i).join("\n")},e},Go.csv=Go.dsv(",","text/csv"),Go.tsv=Go.dsv("	","text/tab-separated-values"),Go.touch=function(n,t,e){if(arguments.length<3&&(e=t,t=x().changedTouches),t)for(var r,u=0,i=t.length;i>u;++u)if((r=t[u]).identifier===e)return Z(n,r)};var Wa,Ga,Ka,Qa,nc,tc=ea[p(ea,"requestAnimationFrame")]||function(n){setTimeout(n,17)};Go.timer=function(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now());var u=e+t,i={c:n,t:u,f:!1,n:null};Ga?Ga.n=i:Wa=i,Ga=i,Ka||(Qa=clearTimeout(Qa),Ka=1,tc(Tt))},Go.timer.flush=function(){qt(),zt()},Go.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)};var ec=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"].map(Dt);Go.formatPrefix=function(n,t){var e=0;return n&&(0>n&&(n*=-1),t&&(n=Go.round(n,Rt(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((e-1)/3)))),ec[8+e/3]};var rc=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,uc=Go.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=Go.round(n,Rt(n,t))).toFixed(Math.max(0,Math.min(20,Rt(n*(1+1e-15),t))))}}),ic=Go.time={},oc=Date;jt.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){ac.setUTCDate.apply(this._,arguments)},setDay:function(){ac.setUTCDay.apply(this._,arguments)},setFullYear:function(){ac.setUTCFullYear.apply(this._,arguments)},setHours:function(){ac.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){ac.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){ac.setUTCMinutes.apply(this._,arguments)},setMonth:function(){ac.setUTCMonth.apply(this._,arguments)},setSeconds:function(){ac.setUTCSeconds.apply(this._,arguments)},setTime:function(){ac.setTime.apply(this._,arguments)}};var ac=Date.prototype;ic.year=Ht(function(n){return n=ic.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),ic.years=ic.year.range,ic.years.utc=ic.year.utc.range,ic.day=Ht(function(n){var t=new oc(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),ic.days=ic.day.range,ic.days.utc=ic.day.utc.range,ic.dayOfYear=function(n){var t=ic.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(n,t){t=7-t;var e=ic[n]=Ht(function(n){return(n=ic.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=ic.year(n).getDay();return Math.floor((ic.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});ic[n+"s"]=e.range,ic[n+"s"].utc=e.utc.range,ic[n+"OfYear"]=function(n){var e=ic.year(n).getDay();return Math.floor((ic.dayOfYear(n)+(e+t)%7)/7)}}),ic.week=ic.sunday,ic.weeks=ic.sunday.range,ic.weeks.utc=ic.sunday.utc.range,ic.weekOfYear=ic.sundayOfYear;var cc={"-":"",_:" ",0:"0"},sc=/^\s*\d+/,lc=/^%/;Go.locale=function(n){return{numberFormat:Pt(n),timeFormat:Ot(n)}};var fc=Go.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Go.format=fc.numberFormat,Go.geo={},ce.prototype={s:0,t:0,add:function(n){se(n,this.t,hc),se(hc.s,this.s,this),this.s?this.t+=hc.t:this.s=hc.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var hc=new ce;Go.geo.stream=function(n,t){n&&gc.hasOwnProperty(n.type)?gc[n.type](n,t):le(n,t)};var gc={Feature:function(n,t){le(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,u=e.length;++r<u;)le(e[r].geometry,t)}},pc={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){fe(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)fe(e[r],t,0)},Polygon:function(n,t){he(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)he(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,u=e.length;++r<u;)le(e[r],t)}};Go.geo.area=function(n){return vc=0,Go.geo.stream(n,mc),vc};var vc,dc=new ce,mc={sphere:function(){vc+=4*Aa},point:v,lineStart:v,lineEnd:v,polygonStart:function(){dc.reset(),mc.lineStart=ge},polygonEnd:function(){var n=2*dc;vc+=0>n?4*Aa+n:n,mc.lineStart=mc.lineEnd=mc.point=v}};Go.geo.bounds=function(){function n(n,t){x.push(M=[l=n,h=n]),f>t&&(f=t),t>g&&(g=t)}function t(t,e){var r=pe([t*za,e*za]);if(m){var u=de(m,r),i=[u[1],-u[0],0],o=de(i,u);xe(o),o=Me(o);var c=t-p,s=c>0?1:-1,v=o[0]*Ra*s,d=fa(c)>180;if(d^(v>s*p&&s*t>v)){var y=o[1]*Ra;y>g&&(g=y)}else if(v=(v+360)%360-180,d^(v>s*p&&s*t>v)){var y=-o[1]*Ra;f>y&&(f=y)}else f>e&&(f=e),e>g&&(g=e);d?p>t?a(l,t)>a(l,h)&&(h=t):a(t,h)>a(l,h)&&(l=t):h>=l?(l>t&&(l=t),t>h&&(h=t)):t>p?a(l,t)>a(l,h)&&(h=t):a(t,h)>a(l,h)&&(l=t)}else n(t,e);m=r,p=t}function e(){_.point=t}function r(){M[0]=l,M[1]=h,_.point=n,m=null}function u(n,e){if(m){var r=n-p;y+=fa(r)>180?r+(r>0?360:-360):r}else v=n,d=e;mc.point(n,e),t(n,e)}function i(){mc.lineStart()}function o(){u(v,d),mc.lineEnd(),fa(y)>Ta&&(l=-(h=180)),M[0]=l,M[1]=h,m=null}function a(n,t){return(t-=n)<0?t+360:t}function c(n,t){return n[0]-t[0]}function s(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var l,f,h,g,p,v,d,m,y,x,M,_={point:n,lineStart:e,lineEnd:r,polygonStart:function(){_.point=u,_.lineStart=i,_.lineEnd=o,y=0,mc.polygonStart()},polygonEnd:function(){mc.polygonEnd(),_.point=n,_.lineStart=e,_.lineEnd=r,0>dc?(l=-(h=180),f=-(g=90)):y>Ta?g=90:-Ta>y&&(f=-90),M[0]=l,M[1]=h
}};return function(n){g=h=-(l=f=1/0),x=[],Go.geo.stream(n,_);var t=x.length;if(t){x.sort(c);for(var e,r=1,u=x[0],i=[u];t>r;++r)e=x[r],s(e[0],u)||s(e[1],u)?(a(u[0],e[1])>a(u[0],u[1])&&(u[1]=e[1]),a(e[0],u[1])>a(u[0],u[1])&&(u[0]=e[0])):i.push(u=e);for(var o,e,p=-1/0,t=i.length-1,r=0,u=i[t];t>=r;u=e,++r)e=i[r],(o=a(u[1],e[0]))>p&&(p=o,l=e[0],h=u[1])}return x=M=null,1/0===l||1/0===f?[[0/0,0/0],[0/0,0/0]]:[[l,f],[h,g]]}}(),Go.geo.centroid=function(n){yc=xc=Mc=_c=bc=wc=Sc=kc=Ec=Nc=Ac=0,Go.geo.stream(n,Cc);var t=Ec,e=Nc,r=Ac,u=t*t+e*e+r*r;return qa>u&&(t=wc,e=Sc,r=kc,Ta>xc&&(t=Mc,e=_c,r=bc),u=t*t+e*e+r*r,qa>u)?[0/0,0/0]:[Math.atan2(e,t)*Ra,G(r/Math.sqrt(u))*Ra]};var yc,xc,Mc,_c,bc,wc,Sc,kc,Ec,Nc,Ac,Cc={sphere:v,point:be,lineStart:Se,lineEnd:ke,polygonStart:function(){Cc.lineStart=Ee},polygonEnd:function(){Cc.lineStart=Se}},Lc=Te(Ne,Pe,je,[-Aa,-Aa/2]),Tc=1e9;Go.geo.clipExtent=function(){var n,t,e,r,u,i,o={stream:function(n){return u&&(u.valid=!1),u=i(n),u.valid=!0,u},extent:function(a){return arguments.length?(i=Oe(n=+a[0][0],t=+a[0][1],e=+a[1][0],r=+a[1][1]),u&&(u.valid=!1,u=null),o):[[n,t],[e,r]]}};return o.extent([[0,0],[960,500]])},(Go.geo.conicEqualArea=function(){return Ie(Ze)}).raw=Ze,Go.geo.albers=function(){return Go.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},Go.geo.albersUsa=function(){function n(n){var i=n[0],o=n[1];return t=null,e(i,o),t||(r(i,o),t)||u(i,o),t}var t,e,r,u,i=Go.geo.albers(),o=Go.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=Go.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(n,e){t=[n,e]}};return n.invert=function(n){var t=i.scale(),e=i.translate(),r=(n[0]-e[0])/t,u=(n[1]-e[1])/t;return(u>=.12&&.234>u&&r>=-.425&&-.214>r?o:u>=.166&&.234>u&&r>=-.214&&-.115>r?a:i).invert(n)},n.stream=function(n){var t=i.stream(n),e=o.stream(n),r=a.stream(n);return{point:function(n,u){t.point(n,u),e.point(n,u),r.point(n,u)},sphere:function(){t.sphere(),e.sphere(),r.sphere()},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},n.precision=function(t){return arguments.length?(i.precision(t),o.precision(t),a.precision(t),n):i.precision()},n.scale=function(t){return arguments.length?(i.scale(t),o.scale(.35*t),a.scale(t),n.translate(i.translate())):i.scale()},n.translate=function(t){if(!arguments.length)return i.translate();var s=i.scale(),l=+t[0],f=+t[1];return e=i.translate(t).clipExtent([[l-.455*s,f-.238*s],[l+.455*s,f+.238*s]]).stream(c).point,r=o.translate([l-.307*s,f+.201*s]).clipExtent([[l-.425*s+Ta,f+.12*s+Ta],[l-.214*s-Ta,f+.234*s-Ta]]).stream(c).point,u=a.translate([l-.205*s,f+.212*s]).clipExtent([[l-.214*s+Ta,f+.166*s+Ta],[l-.115*s-Ta,f+.234*s-Ta]]).stream(c).point,n},n.scale(1070)};var qc,zc,Rc,Dc,Pc,Uc,jc={point:v,lineStart:v,lineEnd:v,polygonStart:function(){zc=0,jc.lineStart=Ve},polygonEnd:function(){jc.lineStart=jc.lineEnd=jc.point=v,qc+=fa(zc/2)}},Hc={point:$e,lineStart:v,lineEnd:v,polygonStart:v,polygonEnd:v},Fc={point:Je,lineStart:We,lineEnd:Ge,polygonStart:function(){Fc.lineStart=Ke},polygonEnd:function(){Fc.point=Je,Fc.lineStart=We,Fc.lineEnd=Ge}};Go.geo.path=function(){function n(n){return n&&("function"==typeof a&&i.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=u(i)),Go.geo.stream(n,o)),i.result()}function t(){return o=null,n}var e,r,u,i,o,a=4.5;return n.area=function(n){return qc=0,Go.geo.stream(n,u(jc)),qc},n.centroid=function(n){return Mc=_c=bc=wc=Sc=kc=Ec=Nc=Ac=0,Go.geo.stream(n,u(Fc)),Ac?[Ec/Ac,Nc/Ac]:kc?[wc/kc,Sc/kc]:bc?[Mc/bc,_c/bc]:[0/0,0/0]},n.bounds=function(n){return Pc=Uc=-(Rc=Dc=1/0),Go.geo.stream(n,u(Hc)),[[Rc,Dc],[Pc,Uc]]},n.projection=function(n){return arguments.length?(u=(e=n)?n.stream||tr(n):Nt,t()):e},n.context=function(n){return arguments.length?(i=null==(r=n)?new Xe:new Qe(n),"function"!=typeof a&&i.pointRadius(a),t()):r},n.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(i.pointRadius(+t),+t),n):a},n.projection(Go.geo.albersUsa()).context(null)},Go.geo.transform=function(n){return{stream:function(t){var e=new er(t);for(var r in n)e[r]=n[r];return e}}},er.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Go.geo.projection=ur,Go.geo.projectionMutator=ir,(Go.geo.equirectangular=function(){return ur(ar)}).raw=ar.invert=ar,Go.geo.rotation=function(n){function t(t){return t=n(t[0]*za,t[1]*za),t[0]*=Ra,t[1]*=Ra,t}return n=sr(n[0]%360*za,n[1]*za,n.length>2?n[2]*za:0),t.invert=function(t){return t=n.invert(t[0]*za,t[1]*za),t[0]*=Ra,t[1]*=Ra,t},t},cr.invert=ar,Go.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=sr(-n[0]*za,-n[1]*za,0).invert,u=[];return e(null,null,1,{point:function(n,e){u.push(n=t(n,e)),n[0]*=Ra,n[1]*=Ra}}),{type:"Polygon",coordinates:[u]}}var t,e,r=[0,0],u=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=gr((t=+r)*za,u*za),n):t},n.precision=function(r){return arguments.length?(e=gr(t*za,(u=+r)*za),n):u},n.angle(90)},Go.geo.distance=function(n,t){var e,r=(t[0]-n[0])*za,u=n[1]*za,i=t[1]*za,o=Math.sin(r),a=Math.cos(r),c=Math.sin(u),s=Math.cos(u),l=Math.sin(i),f=Math.cos(i);return Math.atan2(Math.sqrt((e=f*o)*e+(e=s*l-c*f*a)*e),c*l+s*f*a)},Go.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return Go.range(Math.ceil(i/d)*d,u,d).map(h).concat(Go.range(Math.ceil(s/m)*m,c,m).map(g)).concat(Go.range(Math.ceil(r/p)*p,e,p).filter(function(n){return fa(n%d)>Ta}).map(l)).concat(Go.range(Math.ceil(a/v)*v,o,v).filter(function(n){return fa(n%m)>Ta}).map(f))}var e,r,u,i,o,a,c,s,l,f,h,g,p=10,v=p,d=90,m=360,y=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(g(c).slice(1),h(u).reverse().slice(1),g(s).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(i=+t[0][0],u=+t[1][0],s=+t[0][1],c=+t[1][1],i>u&&(t=i,i=u,u=t),s>c&&(t=s,s=c,c=t),n.precision(y)):[[i,s],[u,c]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],a=+t[0][1],o=+t[1][1],r>e&&(t=r,r=e,e=t),a>o&&(t=a,a=o,o=t),n.precision(y)):[[r,a],[e,o]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(d=+t[0],m=+t[1],n):[d,m]},n.minorStep=function(t){return arguments.length?(p=+t[0],v=+t[1],n):[p,v]},n.precision=function(t){return arguments.length?(y=+t,l=vr(a,o,90),f=dr(r,e,y),h=vr(s,c,90),g=dr(i,u,y),n):y},n.majorExtent([[-180,-90+Ta],[180,90-Ta]]).minorExtent([[-180,-80-Ta],[180,80+Ta]])},Go.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||u.apply(this,arguments)]}}var t,e,r=mr,u=yr;return n.distance=function(){return Go.geo.distance(t||r.apply(this,arguments),e||u.apply(this,arguments))},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r},n.target=function(t){return arguments.length?(u=t,e="function"==typeof t?null:t,n):u},n.precision=function(){return arguments.length?n:0},n},Go.geo.interpolate=function(n,t){return xr(n[0]*za,n[1]*za,t[0]*za,t[1]*za)},Go.geo.length=function(n){return Oc=0,Go.geo.stream(n,Yc),Oc};var Oc,Yc={sphere:v,point:v,lineStart:Mr,lineEnd:v,polygonStart:v,polygonEnd:v},Ic=_r(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(Go.geo.azimuthalEqualArea=function(){return ur(Ic)}).raw=Ic;var Zc=_r(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},Nt);(Go.geo.azimuthalEquidistant=function(){return ur(Zc)}).raw=Zc,(Go.geo.conicConformal=function(){return Ie(br)}).raw=br,(Go.geo.conicEquidistant=function(){return Ie(wr)}).raw=wr;var Vc=_r(function(n){return 1/n},Math.atan);(Go.geo.gnomonic=function(){return ur(Vc)}).raw=Vc,Sr.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-La]},(Go.geo.mercator=function(){return kr(Sr)}).raw=Sr;var $c=_r(function(){return 1},Math.asin);(Go.geo.orthographic=function(){return ur($c)}).raw=$c;var Xc=_r(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(Go.geo.stereographic=function(){return ur(Xc)}).raw=Xc,Er.invert=function(n,t){return[-t,2*Math.atan(Math.exp(n))-La]},(Go.geo.transverseMercator=function(){var n=kr(Er),t=n.center,e=n.rotate;return n.center=function(n){return n?t([-n[1],n[0]]):(n=t(),[-n[1],n[0]])},n.rotate=function(n){return n?e([n[0],n[1],n.length>2?n[2]+90:90]):(n=e(),[n[0],n[1],n[2]-90])},n.rotate([0,0])}).raw=Er,Go.geom={},Go.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,u=Et(e),i=Et(r),o=n.length,a=[],c=[];for(t=0;o>t;t++)a.push([+u.call(this,n[t],t),+i.call(this,n[t],t),t]);for(a.sort(Lr),t=0;o>t;t++)c.push([a[t][0],-a[t][1]]);var s=Cr(a),l=Cr(c),f=l[0]===s[0],h=l[l.length-1]===s[s.length-1],g=[];for(t=s.length-1;t>=0;--t)g.push(n[a[s[t]][2]]);for(t=+f;t<l.length-h;++t)g.push(n[a[l[t]][2]]);return g}var e=Nr,r=Ar;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},Go.geom.polygon=function(n){return da(n,Bc),n};var Bc=Go.geom.polygon.prototype=[];Bc.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],u=0;++t<e;)n=r,r=this[t],u+=n[1]*r[0]-n[0]*r[1];return.5*u},Bc.centroid=function(n){var t,e,r=-1,u=this.length,i=0,o=0,a=this[u-1];for(arguments.length||(n=-1/(6*this.area()));++r<u;)t=a,a=this[r],e=t[0]*a[1]-a[0]*t[1],i+=(t[0]+a[0])*e,o+=(t[1]+a[1])*e;return[i*n,o*n]},Bc.clip=function(n){for(var t,e,r,u,i,o,a=zr(n),c=-1,s=this.length-zr(this),l=this[s-1];++c<s;){for(t=n.slice(),n.length=0,u=this[c],i=t[(r=t.length-a)-1],e=-1;++e<r;)o=t[e],Tr(o,l,u)?(Tr(i,l,u)||n.push(qr(i,o,l,u)),n.push(o)):Tr(i,l,u)&&n.push(qr(i,o,l,u)),i=o;a&&n.push(n[0]),l=u}return n};var Jc,Wc,Gc,Kc,Qc,ns=[],ts=[];Or.prototype.prepare=function(){for(var n,t=this.edges,e=t.length;e--;)n=t[e].edge,n.b&&n.a||t.splice(e,1);return t.sort(Ir),t.length},Qr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},nu.prototype={insert:function(n,t){var e,r,u;if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;)n=n.L;n.L=t}else n.R=t;e=n}else this._?(n=uu(this._),t.P=null,t.N=n,n.P=n.L=t,e=n):(t.P=t.N=null,this._=t,e=null);for(t.L=t.R=null,t.U=e,t.C=!0,n=t;e&&e.C;)r=e.U,e===r.L?(u=r.R,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.R&&(eu(this,e),n=e,e=n.U),e.C=!1,r.C=!0,ru(this,r))):(u=r.L,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.L&&(ru(this,e),n=e,e=n.U),e.C=!1,r.C=!0,eu(this,r))),e=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var t,e,r,u=n.U,i=n.L,o=n.R;if(e=i?o?uu(o):i:o,u?u.L===n?u.L=e:u.R=e:this._=e,i&&o?(r=e.C,e.C=n.C,e.L=i,i.U=e,e!==o?(u=e.U,e.U=n.U,n=e.R,u.L=n,e.R=o,o.U=e):(e.U=u,u=e,n=e.R)):(r=n.C,n=e),n&&(n.U=u),!r){if(n&&n.C)return n.C=!1,void 0;do{if(n===this._)break;if(n===u.L){if(t=u.R,t.C&&(t.C=!1,u.C=!0,eu(this,u),t=u.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,ru(this,t),t=u.R),t.C=u.C,u.C=t.R.C=!1,eu(this,u),n=this._;break}}else if(t=u.L,t.C&&(t.C=!1,u.C=!0,ru(this,u),t=u.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,eu(this,t),t=u.L),t.C=u.C,u.C=t.L.C=!1,ru(this,u),n=this._;break}t.C=!0,n=u,u=u.U}while(!n.C);n&&(n.C=!1)}}},Go.geom.voronoi=function(n){function t(n){var t=new Array(n.length),r=a[0][0],u=a[0][1],i=a[1][0],o=a[1][1];return iu(e(n),a).cells.forEach(function(e,a){var c=e.edges,s=e.site,l=t[a]=c.length?c.map(function(n){var t=n.start();return[t.x,t.y]}):s.x>=r&&s.x<=i&&s.y>=u&&s.y<=o?[[r,o],[i,o],[i,u],[r,u]]:[];l.point=n[a]}),t}function e(n){return n.map(function(n,t){return{x:Math.round(i(n,t)/Ta)*Ta,y:Math.round(o(n,t)/Ta)*Ta,i:t}})}var r=Nr,u=Ar,i=r,o=u,a=es;return n?t(n):(t.links=function(n){return iu(e(n)).edges.filter(function(n){return n.l&&n.r}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]}})},t.triangles=function(n){var t=[];return iu(e(n)).cells.forEach(function(e,r){for(var u,i,o=e.site,a=e.edges.sort(Ir),c=-1,s=a.length,l=a[s-1].edge,f=l.l===o?l.r:l.l;++c<s;)u=l,i=f,l=a[c].edge,f=l.l===o?l.r:l.l,r<i.i&&r<f.i&&au(o,i,f)<0&&t.push([n[r],n[i.i],n[f.i]])}),t},t.x=function(n){return arguments.length?(i=Et(r=n),t):r},t.y=function(n){return arguments.length?(o=Et(u=n),t):u},t.clipExtent=function(n){return arguments.length?(a=null==n?es:n,t):a===es?null:a},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):a===es?null:a&&a[1]},t)};var es=[[-1e6,-1e6],[1e6,1e6]];Go.geom.delaunay=function(n){return Go.geom.voronoi().triangles(n)},Go.geom.quadtree=function(n,t,e,r,u){function i(n){function i(n,t,e,r,u,i,o,a){if(!isNaN(e)&&!isNaN(r))if(n.leaf){var c=n.x,l=n.y;if(null!=c)if(fa(c-e)+fa(l-r)<.01)s(n,t,e,r,u,i,o,a);else{var f=n.point;n.x=n.y=n.point=null,s(n,f,c,l,u,i,o,a),s(n,t,e,r,u,i,o,a)}else n.x=e,n.y=r,n.point=t}else s(n,t,e,r,u,i,o,a)}function s(n,t,e,r,u,o,a,c){var s=.5*(u+a),l=.5*(o+c),f=e>=s,h=r>=l,g=(h<<1)+f;n.leaf=!1,n=n.nodes[g]||(n.nodes[g]=lu()),f?u=s:a=s,h?o=l:c=l,i(n,t,e,r,u,o,a,c)}var l,f,h,g,p,v,d,m,y,x=Et(a),M=Et(c);if(null!=t)v=t,d=e,m=r,y=u;else if(m=y=-(v=d=1/0),f=[],h=[],p=n.length,o)for(g=0;p>g;++g)l=n[g],l.x<v&&(v=l.x),l.y<d&&(d=l.y),l.x>m&&(m=l.x),l.y>y&&(y=l.y),f.push(l.x),h.push(l.y);else for(g=0;p>g;++g){var _=+x(l=n[g],g),b=+M(l,g);v>_&&(v=_),d>b&&(d=b),_>m&&(m=_),b>y&&(y=b),f.push(_),h.push(b)}var w=m-v,S=y-d;w>S?y=d+w:m=v+S;var k=lu();if(k.add=function(n){i(k,n,+x(n,++g),+M(n,g),v,d,m,y)},k.visit=function(n){fu(n,k,v,d,m,y)},g=-1,null==t){for(;++g<p;)i(k,n[g],f[g],h[g],v,d,m,y);--g}else n.forEach(k.add);return f=h=n=l=null,k}var o,a=Nr,c=Ar;return(o=arguments.length)?(a=cu,c=su,3===o&&(u=e,r=t,e=t=0),i(n)):(i.x=function(n){return arguments.length?(a=n,i):a},i.y=function(n){return arguments.length?(c=n,i):c},i.extent=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],u=+n[1][1]),i):null==t?null:[[t,e],[r,u]]},i.size=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=e=0,r=+n[0],u=+n[1]),i):null==t?null:[r-t,u-e]},i)},Go.interpolateRgb=hu,Go.interpolateObject=gu,Go.interpolateNumber=pu,Go.interpolateString=vu;var rs=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;Go.interpolate=du,Go.interpolators=[function(n,t){var e=typeof t;return("string"===e?Ja.has(t)||/^(#|rgb\(|hsl\()/.test(t)?hu:vu:t instanceof et?hu:Array.isArray(t)?mu:"object"===e&&isNaN(t)?gu:pu)(n,t)}],Go.interpolateArray=mu;var us=function(){return Nt},is=Go.map({linear:us,poly:Su,quad:function(){return _u},cubic:function(){return bu},sin:function(){return ku},exp:function(){return Eu},circle:function(){return Nu},elastic:Au,back:Cu,bounce:function(){return Lu}}),os=Go.map({"in":Nt,out:xu,"in-out":Mu,"out-in":function(n){return Mu(xu(n))}});Go.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.substring(0,t):n,r=t>=0?n.substring(t+1):"in";return e=is.get(e)||us,r=os.get(r)||Nt,yu(r(e.apply(null,Ko.call(arguments,1))))},Go.interpolateHcl=Tu,Go.interpolateHsl=qu,Go.interpolateLab=zu,Go.interpolateRound=Ru,Go.transform=function(n){var t=na.createElementNS(Go.ns.prefix.svg,"g");return(Go.transform=function(n){if(null!=n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate()}return new Du(e?e.matrix:as)})(n)},Du.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var as={a:1,b:0,c:0,d:1,e:0,f:0};Go.interpolateTransform=Hu,Go.layout={},Go.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(Yu(n[e]));return t}},Go.layout.chord=function(){function n(){var n,s,f,h,g,p={},v=[],d=Go.range(i),m=[];for(e=[],r=[],n=0,h=-1;++h<i;){for(s=0,g=-1;++g<i;)s+=u[h][g];v.push(s),m.push(Go.range(i)),n+=s}for(o&&d.sort(function(n,t){return o(v[n],v[t])}),a&&m.forEach(function(n,t){n.sort(function(n,e){return a(u[t][n],u[t][e])})}),n=(Ca-l*i)/n,s=0,h=-1;++h<i;){for(f=s,g=-1;++g<i;){var y=d[h],x=m[y][g],M=u[y][x],_=s,b=s+=M*n;p[y+"-"+x]={index:y,subindex:x,startAngle:_,endAngle:b,value:M}}r[y]={index:y,startAngle:f,endAngle:s,value:(s-f)/n},s+=l}for(h=-1;++h<i;)for(g=h-1;++g<i;){var w=p[h+"-"+g],S=p[g+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}c&&t()}function t(){e.sort(function(n,t){return c((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,u,i,o,a,c,s={},l=0;return s.matrix=function(n){return arguments.length?(i=(u=n)&&u.length,e=r=null,s):u},s.padding=function(n){return arguments.length?(l=n,e=r=null,s):l},s.sortGroups=function(n){return arguments.length?(o=n,e=r=null,s):o},s.sortSubgroups=function(n){return arguments.length?(a=n,e=null,s):a},s.sortChords=function(n){return arguments.length?(c=n,e&&t(),s):c},s.chords=function(){return e||n(),e},s.groups=function(){return r||n(),r},s},Go.layout.force=function(){function n(n){return function(t,e,r,u){if(t.point!==n){var i=t.cx-n.x,o=t.cy-n.y,a=u-e,c=i*i+o*o;if(c>a*a/d){if(p>c){var s=t.charge/c;n.px-=i*s,n.py-=o*s}return!0}if(t.point&&c&&p>c){var s=t.pointCharge/c;n.px-=i*s,n.py-=o*s}}return!t.charge}}function t(n){n.px=Go.event.x,n.py=Go.event.y,a.resume()}var e,r,u,i,o,a={},c=Go.dispatch("start","tick","end"),s=[1,1],l=.9,f=cs,h=ss,g=-30,p=ls,v=.1,d=.64,m=[],y=[];return a.tick=function(){if((r*=.99)<.005)return c.end({type:"end",alpha:r=0}),!0;var t,e,a,f,h,p,d,x,M,_=m.length,b=y.length;for(e=0;b>e;++e)a=y[e],f=a.source,h=a.target,x=h.x-f.x,M=h.y-f.y,(p=x*x+M*M)&&(p=r*i[e]*((p=Math.sqrt(p))-u[e])/p,x*=p,M*=p,h.x-=x*(d=f.weight/(h.weight+f.weight)),h.y-=M*d,f.x+=x*(d=1-d),f.y+=M*d);if((d=r*v)&&(x=s[0]/2,M=s[1]/2,e=-1,d))for(;++e<_;)a=m[e],a.x+=(x-a.x)*d,a.y+=(M-a.y)*d;if(g)for(Ju(t=Go.geom.quadtree(m),r,o),e=-1;++e<_;)(a=m[e]).fixed||t.visit(n(a));for(e=-1;++e<_;)a=m[e],a.fixed?(a.x=a.px,a.y=a.py):(a.x-=(a.px-(a.px=a.x))*l,a.y-=(a.py-(a.py=a.y))*l);c.tick({type:"tick",alpha:r})},a.nodes=function(n){return arguments.length?(m=n,a):m},a.links=function(n){return arguments.length?(y=n,a):y},a.size=function(n){return arguments.length?(s=n,a):s},a.linkDistance=function(n){return arguments.length?(f="function"==typeof n?n:+n,a):f},a.distance=a.linkDistance,a.linkStrength=function(n){return arguments.length?(h="function"==typeof n?n:+n,a):h},a.friction=function(n){return arguments.length?(l=+n,a):l},a.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,a):g},a.chargeDistance=function(n){return arguments.length?(p=n*n,a):Math.sqrt(p)},a.gravity=function(n){return arguments.length?(v=+n,a):v},a.theta=function(n){return arguments.length?(d=n*n,a):Math.sqrt(d)},a.alpha=function(n){return arguments.length?(n=+n,r?r=n>0?n:0:n>0&&(c.start({type:"start",alpha:r=n}),Go.timer(a.tick)),a):r},a.start=function(){function n(n,r){if(!e){for(e=new Array(c),a=0;c>a;++a)e[a]=[];for(a=0;s>a;++a){var u=y[a];e[u.source.index].push(u.target),e[u.target.index].push(u.source)}}for(var i,o=e[t],a=-1,s=o.length;++a<s;)if(!isNaN(i=o[a][n]))return i;return Math.random()*r}var t,e,r,c=m.length,l=y.length,p=s[0],v=s[1];for(t=0;c>t;++t)(r=m[t]).index=t,r.weight=0;for(t=0;l>t;++t)r=y[t],"number"==typeof r.source&&(r.source=m[r.source]),"number"==typeof r.target&&(r.target=m[r.target]),++r.source.weight,++r.target.weight;for(t=0;c>t;++t)r=m[t],isNaN(r.x)&&(r.x=n("x",p)),isNaN(r.y)&&(r.y=n("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(u=[],"function"==typeof f)for(t=0;l>t;++t)u[t]=+f.call(this,y[t],t);else for(t=0;l>t;++t)u[t]=f;if(i=[],"function"==typeof h)for(t=0;l>t;++t)i[t]=+h.call(this,y[t],t);else for(t=0;l>t;++t)i[t]=h;if(o=[],"function"==typeof g)for(t=0;c>t;++t)o[t]=+g.call(this,m[t],t);else for(t=0;c>t;++t)o[t]=g;return a.resume()},a.resume=function(){return a.alpha(.1)},a.stop=function(){return a.alpha(0)},a.drag=function(){return e||(e=Go.behavior.drag().origin(Nt).on("dragstart.force",Vu).on("drag.force",t).on("dragend.force",$u)),arguments.length?(this.on("mouseover.force",Xu).on("mouseout.force",Bu).call(e),void 0):e},Go.rebind(a,c,"on")};var cs=20,ss=1,ls=1/0;Go.layout.hierarchy=function(){function n(t,o,a){var c=u.call(e,t,o);if(t.depth=o,a.push(t),c&&(s=c.length)){for(var s,l,f=-1,h=t.children=new Array(s),g=0,p=o+1;++f<s;)l=h[f]=n(c[f],p,a),l.parent=t,g+=l.value;r&&h.sort(r),i&&(t.value=g)}else delete t.children,i&&(t.value=+i.call(e,t,o)||0);return t}function t(n,r){var u=n.children,o=0;if(u&&(a=u.length))for(var a,c=-1,s=r+1;++c<a;)o+=t(u[c],s);else i&&(o=+i.call(e,n,r)||0);return i&&(n.value=o),o}function e(t){var e=[];return n(t,0,e),e}var r=Qu,u=Gu,i=Ku;return e.sort=function(n){return arguments.length?(r=n,e):r},e.children=function(n){return arguments.length?(u=n,e):u},e.value=function(n){return arguments.length?(i=n,e):i},e.revalue=function(n){return t(n,0),n},e},Go.layout.partition=function(){function n(t,e,r,u){var i=t.children;if(t.x=e,t.y=t.depth*u,t.dx=r,t.dy=u,i&&(o=i.length)){var o,a,c,s=-1;for(r=t.value?r/t.value:0;++s<o;)n(a=i[s],e,c=a.value*r,u),e+=c}}function t(n){var e=n.children,r=0;if(e&&(u=e.length))for(var u,i=-1;++i<u;)r=Math.max(r,t(e[i]));return 1+r}function e(e,i){var o=r.call(this,e,i);return n(o[0],0,u[0],u[1]/t(o[0])),o}var r=Go.layout.hierarchy(),u=[1,1];return e.size=function(n){return arguments.length?(u=n,e):u},Wu(e,r)},Go.layout.pie=function(){function n(i){var o=i.map(function(e,r){return+t.call(n,e,r)}),a=+("function"==typeof r?r.apply(this,arguments):r),c=(("function"==typeof u?u.apply(this,arguments):u)-a)/Go.sum(o),s=Go.range(i.length);null!=e&&s.sort(e===fs?function(n,t){return o[t]-o[n]}:function(n,t){return e(i[n],i[t])});var l=[];return s.forEach(function(n){var t;l[n]={data:i[n],value:t=o[n],startAngle:a,endAngle:a+=t*c}}),l}var t=Number,e=fs,r=0,u=Ca;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(u=t,n):u},n};var fs={};Go.layout.stack=function(){function n(a,c){var s=a.map(function(e,r){return t.call(n,e,r)}),l=s.map(function(t){return t.map(function(t,e){return[i.call(n,t,e),o.call(n,t,e)]})}),f=e.call(n,l,c);s=Go.permute(s,f),l=Go.permute(l,f);var h,g,p,v=r.call(n,l,c),d=s.length,m=s[0].length;for(g=0;m>g;++g)for(u.call(n,s[0][g],p=v[g],l[0][g][1]),h=1;d>h;++h)u.call(n,s[h][g],p+=l[h-1][g][1],l[h][g][1]);return a}var t=Nt,e=ui,r=ii,u=ri,i=ti,o=ei;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:hs.get(t)||ui,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:gs.get(t)||ii,n):r},n.x=function(t){return arguments.length?(i=t,n):i},n.y=function(t){return arguments.length?(o=t,n):o},n.out=function(t){return arguments.length?(u=t,n):u},n};var hs=Go.map({"inside-out":function(n){var t,e,r=n.length,u=n.map(oi),i=n.map(ai),o=Go.range(r).sort(function(n,t){return u[n]-u[t]}),a=0,c=0,s=[],l=[];for(t=0;r>t;++t)e=o[t],c>a?(a+=i[e],s.push(e)):(c+=i[e],l.push(e));return l.reverse().concat(s)},reverse:function(n){return Go.range(n.length).reverse()},"default":ui}),gs=Go.map({silhouette:function(n){var t,e,r,u=n.length,i=n[0].length,o=[],a=0,c=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];r>a&&(a=r),o.push(r)}for(e=0;i>e;++e)c[e]=(a-o[e])/2;return c},wiggle:function(n){var t,e,r,u,i,o,a,c,s,l=n.length,f=n[0],h=f.length,g=[];for(g[0]=c=s=0,e=1;h>e;++e){for(t=0,u=0;l>t;++t)u+=n[t][e][1];for(t=0,i=0,a=f[e][0]-f[e-1][0];l>t;++t){for(r=0,o=(n[t][e][1]-n[t][e-1][1])/(2*a);t>r;++r)o+=(n[r][e][1]-n[r][e-1][1])/a;i+=o*n[t][e][1]}g[e]=c-=u?i/u*a:0,s>c&&(s=c)}for(e=0;h>e;++e)g[e]-=s;return g},expand:function(n){var t,e,r,u=n.length,i=n[0].length,o=1/u,a=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];if(r)for(t=0;u>t;t++)n[t][e][1]/=r;else for(t=0;u>t;t++)n[t][e][1]=o}for(e=0;i>e;++e)a[e]=0;return a},zero:ii});Go.layout.histogram=function(){function n(n,i){for(var o,a,c=[],s=n.map(e,this),l=r.call(this,s,i),f=u.call(this,l,s,i),i=-1,h=s.length,g=f.length-1,p=t?1:1/h;++i<g;)o=c[i]=[],o.dx=f[i+1]-(o.x=f[i]),o.y=0;if(g>0)for(i=-1;++i<h;)a=s[i],a>=l[0]&&a<=l[1]&&(o=c[Go.bisect(f,a,1,g)-1],o.y+=p,o.push(n[i]));return c}var t=!0,e=Number,r=fi,u=si;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=Et(t),n):r},n.bins=function(t){return arguments.length?(u="number"==typeof t?function(n){return li(n,t)}:Et(t),n):u},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},Go.layout.tree=function(){function n(n,i){function o(n,t){var r=n.children,u=n._tree;if(r&&(i=r.length)){for(var i,a,s,l=r[0],f=l,h=-1;++h<i;)s=r[h],o(s,a),f=c(s,a,f),a=s;Mi(n);var g=.5*(l._tree.prelim+s._tree.prelim);t?(u.prelim=t._tree.prelim+e(n,t),u.mod=u.prelim-g):u.prelim=g}else t&&(u.prelim=t._tree.prelim+e(n,t))}function a(n,t){n.x=n._tree.prelim+t;var e=n.children;if(e&&(r=e.length)){var r,u=-1;for(t+=n._tree.mod;++u<r;)a(e[u],t)}}function c(n,t,r){if(t){for(var u,i=n,o=n,a=t,c=n.parent.children[0],s=i._tree.mod,l=o._tree.mod,f=a._tree.mod,h=c._tree.mod;a=pi(a),i=gi(i),a&&i;)c=gi(c),o=pi(o),o._tree.ancestor=n,u=a._tree.prelim+f-i._tree.prelim-s+e(a,i),u>0&&(_i(bi(a,n,r),n,u),s+=u,l+=u),f+=a._tree.mod,s+=i._tree.mod,h+=c._tree.mod,l+=o._tree.mod;a&&!pi(o)&&(o._tree.thread=a,o._tree.mod+=f-l),i&&!gi(c)&&(c._tree.thread=i,c._tree.mod+=s-h,r=n)}return r}var s=t.call(this,n,i),l=s[0];xi(l,function(n,t){n._tree={ancestor:n,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),o(l),a(l,-l._tree.prelim);var f=vi(l,mi),h=vi(l,di),g=vi(l,yi),p=f.x-e(f,h)/2,v=h.x+e(h,f)/2,d=g.depth||1;return xi(l,u?function(n){n.x*=r[0],n.y=n.depth*r[1],delete n._tree}:function(n){n.x=(n.x-p)/(v-p)*r[0],n.y=n.depth/d*r[1],delete n._tree}),s}var t=Go.layout.hierarchy().sort(null).value(null),e=hi,r=[1,1],u=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(u=null==(r=t),n):u?null:r},n.nodeSize=function(t){return arguments.length?(u=null!=(r=t),n):u?r:null},Wu(n,t)},Go.layout.pack=function(){function n(n,i){var o=e.call(this,n,i),a=o[0],c=u[0],s=u[1],l=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(a.x=a.y=0,xi(a,function(n){n.r=+l(n.value)}),xi(a,Ni),r){var f=r*(t?1:Math.max(2*a.r/c,2*a.r/s))/2;xi(a,function(n){n.r+=f}),xi(a,Ni),xi(a,function(n){n.r-=f})}return Li(a,c/2,s/2,t?1:1/Math.max(2*a.r/c,2*a.r/s)),o}var t,e=Go.layout.hierarchy().sort(wi),r=0,u=[1,1];return n.size=function(t){return arguments.length?(u=t,n):u},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t},n.padding=function(t){return arguments.length?(r=+t,n):r},Wu(n,e)},Go.layout.cluster=function(){function n(n,i){var o,a=t.call(this,n,i),c=a[0],s=0;xi(c,function(n){var t=n.children;t&&t.length?(n.x=zi(t),n.y=qi(t)):(n.x=o?s+=e(n,o):0,n.y=0,o=n)});var l=Ri(c),f=Di(c),h=l.x-e(l,f)/2,g=f.x+e(f,l)/2;return xi(c,u?function(n){n.x=(n.x-c.x)*r[0],n.y=(c.y-n.y)*r[1]}:function(n){n.x=(n.x-h)/(g-h)*r[0],n.y=(1-(c.y?n.y/c.y:1))*r[1]}),a}var t=Go.layout.hierarchy().sort(null).value(null),e=hi,r=[1,1],u=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(u=null==(r=t),n):u?null:r},n.nodeSize=function(t){return arguments.length?(u=null!=(r=t),n):u?r:null},Wu(n,t)},Go.layout.treemap=function(){function n(n,t){for(var e,r,u=-1,i=n.length;++u<i;)r=(e=n[u]).value*(0>t?0:t),e.area=isNaN(r)||0>=r?0:r}function t(e){var i=e.children;if(i&&i.length){var o,a,c,s=f(e),l=[],h=i.slice(),p=1/0,v="slice"===g?s.dx:"dice"===g?s.dy:"slice-dice"===g?1&e.depth?s.dy:s.dx:Math.min(s.dx,s.dy);for(n(h,s.dx*s.dy/e.value),l.area=0;(c=h.length)>0;)l.push(o=h[c-1]),l.area+=o.area,"squarify"!==g||(a=r(l,v))<=p?(h.pop(),p=a):(l.area-=l.pop().area,u(l,v,s,!1),v=Math.min(s.dx,s.dy),l.length=l.area=0,p=1/0);l.length&&(u(l,v,s,!0),l.length=l.area=0),i.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var i,o=f(t),a=r.slice(),c=[];for(n(a,o.dx*o.dy/t.value),c.area=0;i=a.pop();)c.push(i),c.area+=i.area,null!=i.z&&(u(c,i.z?o.dx:o.dy,o,!a.length),c.length=c.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,u=0,i=1/0,o=-1,a=n.length;++o<a;)(e=n[o].area)&&(i>e&&(i=e),e>u&&(u=e));return r*=r,t*=t,r?Math.max(t*u*p/r,r/(t*i*p)):1/0}function u(n,t,e,r){var u,i=-1,o=n.length,a=e.x,s=e.y,l=t?c(n.area/t):0;if(t==e.dx){for((r||l>e.dy)&&(l=e.dy);++i<o;)u=n[i],u.x=a,u.y=s,u.dy=l,a+=u.dx=Math.min(e.x+e.dx-a,l?c(u.area/l):0);u.z=!0,u.dx+=e.x+e.dx-a,e.y+=l,e.dy-=l}else{for((r||l>e.dx)&&(l=e.dx);++i<o;)u=n[i],u.x=a,u.y=s,u.dx=l,s+=u.dy=Math.min(e.y+e.dy-s,l?c(u.area/l):0);u.z=!1,u.dy+=e.y+e.dy-s,e.x+=l,e.dx-=l}}function i(r){var u=o||a(r),i=u[0];return i.x=0,i.y=0,i.dx=s[0],i.dy=s[1],o&&a.revalue(i),n([i],i.dx*i.dy/i.value),(o?e:t)(i),h&&(o=u),u}var o,a=Go.layout.hierarchy(),c=Math.round,s=[1,1],l=null,f=Pi,h=!1,g="squarify",p=.5*(1+Math.sqrt(5));return i.size=function(n){return arguments.length?(s=n,i):s},i.padding=function(n){function t(t){var e=n.call(i,t,t.depth);return null==e?Pi(t):Ui(t,"number"==typeof e?[e,e,e,e]:e)}function e(t){return Ui(t,n)}if(!arguments.length)return l;var r;return f=null==(l=n)?Pi:"function"==(r=typeof n)?t:"number"===r?(n=[n,n,n,n],e):e,i},i.round=function(n){return arguments.length?(c=n?Math.round:Number,i):c!=Number},i.sticky=function(n){return arguments.length?(h=n,o=null,i):h},i.ratio=function(n){return arguments.length?(p=n,i):p},i.mode=function(n){return arguments.length?(g=n+"",i):g},Wu(i,a)},Go.random={normal:function(n,t){var e=arguments.length;return 2>e&&(t=1),1>e&&(n=0),function(){var e,r,u;do e=2*Math.random()-1,r=2*Math.random()-1,u=e*e+r*r;while(!u||u>1);return n+t*e*Math.sqrt(-2*Math.log(u)/u)}},logNormal:function(){var n=Go.random.normal.apply(Go,arguments);return function(){return Math.exp(n())}},bates:function(n){var t=Go.random.irwinHall(n);return function(){return t()/n}},irwinHall:function(n){return function(){for(var t=0,e=0;n>e;e++)t+=Math.random();return t}}},Go.scale={};var ps={floor:Nt,ceil:Nt};Go.scale.linear=function(){return Zi([0,1],[0,1],du,!1)};var vs={s:1,g:1,p:1,r:1,e:1};Go.scale.log=function(){return Ki(Go.scale.linear().domain([0,1]),10,!0,[1,10])};var ds=Go.format(".0e"),ms={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};Go.scale.pow=function(){return Qi(Go.scale.linear(),1,[0,1])},Go.scale.sqrt=function(){return Go.scale.pow().exponent(.5)},Go.scale.ordinal=function(){return to([],{t:"range",a:[[]]})},Go.scale.category10=function(){return Go.scale.ordinal().range(ys)},Go.scale.category20=function(){return Go.scale.ordinal().range(xs)},Go.scale.category20b=function(){return Go.scale.ordinal().range(Ms)},Go.scale.category20c=function(){return Go.scale.ordinal().range(_s)};var ys=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(mt),xs=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(mt),Ms=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(mt),_s=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(mt);Go.scale.quantile=function(){return eo([],[])
},Go.scale.quantize=function(){return ro(0,1,[0,1])},Go.scale.threshold=function(){return uo([.5],[0,1])},Go.scale.identity=function(){return io([0,1])},Go.svg={},Go.svg.arc=function(){function n(){var n=t.apply(this,arguments),i=e.apply(this,arguments),o=r.apply(this,arguments)+bs,a=u.apply(this,arguments)+bs,c=(o>a&&(c=o,o=a,a=c),a-o),s=Aa>c?"0":"1",l=Math.cos(o),f=Math.sin(o),h=Math.cos(a),g=Math.sin(a);return c>=ws?n?"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"M0,"+n+"A"+n+","+n+" 0 1,0 0,"+-n+"A"+n+","+n+" 0 1,0 0,"+n+"Z":"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"Z":n?"M"+i*l+","+i*f+"A"+i+","+i+" 0 "+s+",1 "+i*h+","+i*g+"L"+n*h+","+n*g+"A"+n+","+n+" 0 "+s+",0 "+n*l+","+n*f+"Z":"M"+i*l+","+i*f+"A"+i+","+i+" 0 "+s+",1 "+i*h+","+i*g+"L0,0"+"Z"}var t=oo,e=ao,r=co,u=so;return n.innerRadius=function(e){return arguments.length?(t=Et(e),n):t},n.outerRadius=function(t){return arguments.length?(e=Et(t),n):e},n.startAngle=function(t){return arguments.length?(r=Et(t),n):r},n.endAngle=function(t){return arguments.length?(u=Et(t),n):u},n.centroid=function(){var n=(t.apply(this,arguments)+e.apply(this,arguments))/2,i=(r.apply(this,arguments)+u.apply(this,arguments))/2+bs;return[Math.cos(i)*n,Math.sin(i)*n]},n};var bs=-La,ws=Ca-Ta;Go.svg.line=function(){return lo(Nt)};var Ss=Go.map({linear:fo,"linear-closed":ho,step:go,"step-before":po,"step-after":vo,basis:bo,"basis-open":wo,"basis-closed":So,bundle:ko,cardinal:xo,"cardinal-open":mo,"cardinal-closed":yo,monotone:To});Ss.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var ks=[0,2/3,1/3,0],Es=[0,1/3,2/3,0],Ns=[0,1/6,2/3,1/6];Go.svg.line.radial=function(){var n=lo(qo);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},po.reverse=vo,vo.reverse=po,Go.svg.area=function(){return zo(Nt)},Go.svg.area.radial=function(){var n=zo(qo);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},Go.svg.chord=function(){function n(n,a){var c=t(this,i,n,a),s=t(this,o,n,a);return"M"+c.p0+r(c.r,c.p1,c.a1-c.a0)+(e(c,s)?u(c.r,c.p1,c.r,c.p0):u(c.r,c.p1,s.r,s.p0)+r(s.r,s.p1,s.a1-s.a0)+u(s.r,s.p1,c.r,c.p0))+"Z"}function t(n,t,e,r){var u=t.call(n,e,r),i=a.call(n,u,r),o=c.call(n,u,r)+bs,l=s.call(n,u,r)+bs;return{r:i,a0:o,a1:l,p0:[i*Math.cos(o),i*Math.sin(o)],p1:[i*Math.cos(l),i*Math.sin(l)]}}function e(n,t){return n.a0==t.a0&&n.a1==t.a1}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>Aa)+",1 "+t}function u(n,t,e,r){return"Q 0,0 "+r}var i=mr,o=yr,a=Ro,c=co,s=so;return n.radius=function(t){return arguments.length?(a=Et(t),n):a},n.source=function(t){return arguments.length?(i=Et(t),n):i},n.target=function(t){return arguments.length?(o=Et(t),n):o},n.startAngle=function(t){return arguments.length?(c=Et(t),n):c},n.endAngle=function(t){return arguments.length?(s=Et(t),n):s},n},Go.svg.diagonal=function(){function n(n,u){var i=t.call(this,n,u),o=e.call(this,n,u),a=(i.y+o.y)/2,c=[i,{x:i.x,y:a},{x:o.x,y:a},o];return c=c.map(r),"M"+c[0]+"C"+c[1]+" "+c[2]+" "+c[3]}var t=mr,e=yr,r=Do;return n.source=function(e){return arguments.length?(t=Et(e),n):t},n.target=function(t){return arguments.length?(e=Et(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},Go.svg.diagonal.radial=function(){var n=Go.svg.diagonal(),t=Do,e=n.projection;return n.projection=function(n){return arguments.length?e(Po(t=n)):t},n},Go.svg.symbol=function(){function n(n,r){return(As.get(t.call(this,n,r))||Ho)(e.call(this,n,r))}var t=jo,e=Uo;return n.type=function(e){return arguments.length?(t=Et(e),n):t},n.size=function(t){return arguments.length?(e=Et(t),n):e},n};var As=Go.map({circle:Ho,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*qs)),e=t*qs;return"M0,"+-t+"L"+e+",0"+" 0,"+t+" "+-e+",0"+"Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/Ts),e=t*Ts/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/Ts),e=t*Ts/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});Go.svg.symbolTypes=As.keys();var Cs,Ls,Ts=Math.sqrt(3),qs=Math.tan(30*za),zs=[],Rs=0;zs.call=_a.call,zs.empty=_a.empty,zs.node=_a.node,zs.size=_a.size,Go.transition=function(n){return arguments.length?Cs?n.transition():n:Sa.transition()},Go.transition.prototype=zs,zs.select=function(n){var t,e,r,u=this.id,i=[];n=b(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]);for(var c=this[o],s=-1,l=c.length;++s<l;)(r=c[s])&&(e=n.call(r,r.__data__,s,o))?("__data__"in r&&(e.__data__=r.__data__),Io(e,s,u,r.__transition__[u]),t.push(e)):t.push(null)}return Fo(i,u)},zs.selectAll=function(n){var t,e,r,u,i,o=this.id,a=[];n=w(n);for(var c=-1,s=this.length;++c<s;)for(var l=this[c],f=-1,h=l.length;++f<h;)if(r=l[f]){i=r.__transition__[o],e=n.call(r,r.__data__,f,c),a.push(t=[]);for(var g=-1,p=e.length;++g<p;)(u=e[g])&&Io(u,g,o,i),t.push(u)}return Fo(a,o)},zs.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=R(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]);for(var e=this[i],a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a,i)&&t.push(r)}return Fo(u,this.id)},zs.tween=function(n,t){var e=this.id;return arguments.length<2?this.node().__transition__[e].tween.get(n):P(this,null==t?function(t){t.__transition__[e].tween.remove(n)}:function(r){r.__transition__[e].tween.set(n,t)})},zs.attr=function(n,t){function e(){this.removeAttribute(a)}function r(){this.removeAttributeNS(a.space,a.local)}function u(n){return null==n?e:(n+="",function(){var t,e=this.getAttribute(a);return e!==n&&(t=o(e,n),function(n){this.setAttribute(a,t(n))})})}function i(n){return null==n?r:(n+="",function(){var t,e=this.getAttributeNS(a.space,a.local);return e!==n&&(t=o(e,n),function(n){this.setAttributeNS(a.space,a.local,t(n))})})}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var o="transform"==n?Hu:du,a=Go.ns.qualify(n);return Oo(this,"attr."+n,t,a.local?i:u)},zs.attrTween=function(n,t){function e(n,e){var r=t.call(this,n,e,this.getAttribute(u));return r&&function(n){this.setAttribute(u,r(n))}}function r(n,e){var r=t.call(this,n,e,this.getAttributeNS(u.space,u.local));return r&&function(n){this.setAttributeNS(u.space,u.local,r(n))}}var u=Go.ns.qualify(n);return this.tween("attr."+n,u.local?r:e)},zs.style=function(n,t,e){function r(){this.style.removeProperty(n)}function u(t){return null==t?r:(t+="",function(){var r,u=ea.getComputedStyle(this,null).getPropertyValue(n);return u!==t&&(r=du(u,t),function(t){this.style.setProperty(n,r(t),e)})})}var i=arguments.length;if(3>i){if("string"!=typeof n){2>i&&(t="");for(e in n)this.style(e,n[e],t);return this}e=""}return Oo(this,"style."+n,t,u)},zs.styleTween=function(n,t,e){function r(r,u){var i=t.call(this,r,u,ea.getComputedStyle(this,null).getPropertyValue(n));return i&&function(t){this.style.setProperty(n,i(t),e)}}return arguments.length<3&&(e=""),this.tween("style."+n,r)},zs.text=function(n){return Oo(this,"text",n,Yo)},zs.remove=function(){return this.each("end.transition",function(){var n;this.__transition__.count<2&&(n=this.parentNode)&&n.removeChild(this)})},zs.ease=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof n&&(n=Go.ease.apply(Go,arguments)),P(this,function(e){e.__transition__[t].ease=n}))},zs.delay=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].delay:P(this,"function"==typeof n?function(e,r,u){e.__transition__[t].delay=+n.call(e,e.__data__,r,u)}:(n=+n,function(e){e.__transition__[t].delay=n}))},zs.duration=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].duration:P(this,"function"==typeof n?function(e,r,u){e.__transition__[t].duration=Math.max(1,n.call(e,e.__data__,r,u))}:(n=Math.max(1,n),function(e){e.__transition__[t].duration=n}))},zs.each=function(n,t){var e=this.id;if(arguments.length<2){var r=Ls,u=Cs;Cs=e,P(this,function(t,r,u){Ls=t.__transition__[e],n.call(t,t.__data__,r,u)}),Ls=r,Cs=u}else P(this,function(r){var u=r.__transition__[e];(u.event||(u.event=Go.dispatch("start","end"))).on(n,t)});return this},zs.transition=function(){for(var n,t,e,r,u=this.id,i=++Rs,o=[],a=0,c=this.length;c>a;a++){o.push(n=[]);for(var t=this[a],s=0,l=t.length;l>s;s++)(e=t[s])&&(r=Object.create(e.__transition__[u]),r.delay+=r.duration,Io(e,s,i,r)),n.push(e)}return Fo(o,i)},Go.svg.axis=function(){function n(n){n.each(function(){var n,s=Go.select(this),l=this.__chart__||e,f=this.__chart__=e.copy(),h=null==c?f.ticks?f.ticks.apply(f,a):f.domain():c,g=null==t?f.tickFormat?f.tickFormat.apply(f,a):Nt:t,p=s.selectAll(".tick").data(h,f),v=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Ta),d=Go.transition(p.exit()).style("opacity",Ta).remove(),m=Go.transition(p.order()).style("opacity",1),y=Hi(f),x=s.selectAll(".domain").data([0]),M=(x.enter().append("path").attr("class","domain"),Go.transition(x));v.append("line"),v.append("text");var _=v.select("line"),b=m.select("line"),w=p.select("text").text(g),S=v.select("text"),k=m.select("text");switch(r){case"bottom":n=Zo,_.attr("y2",u),S.attr("y",Math.max(u,0)+o),b.attr("x2",0).attr("y2",u),k.attr("x",0).attr("y",Math.max(u,0)+o),w.attr("dy",".71em").style("text-anchor","middle"),M.attr("d","M"+y[0]+","+i+"V0H"+y[1]+"V"+i);break;case"top":n=Zo,_.attr("y2",-u),S.attr("y",-(Math.max(u,0)+o)),b.attr("x2",0).attr("y2",-u),k.attr("x",0).attr("y",-(Math.max(u,0)+o)),w.attr("dy","0em").style("text-anchor","middle"),M.attr("d","M"+y[0]+","+-i+"V0H"+y[1]+"V"+-i);break;case"left":n=Vo,_.attr("x2",-u),S.attr("x",-(Math.max(u,0)+o)),b.attr("x2",-u).attr("y2",0),k.attr("x",-(Math.max(u,0)+o)).attr("y",0),w.attr("dy",".32em").style("text-anchor","end"),M.attr("d","M"+-i+","+y[0]+"H0V"+y[1]+"H"+-i);break;case"right":n=Vo,_.attr("x2",u),S.attr("x",Math.max(u,0)+o),b.attr("x2",u).attr("y2",0),k.attr("x",Math.max(u,0)+o).attr("y",0),w.attr("dy",".32em").style("text-anchor","start"),M.attr("d","M"+i+","+y[0]+"H0V"+y[1]+"H"+i)}if(f.rangeBand){var E=f,N=E.rangeBand()/2;l=f=function(n){return E(n)+N}}else l.rangeBand?l=f:d.call(n,f);v.call(n,l),m.call(n,f)})}var t,e=Go.scale.linear(),r=Ds,u=6,i=6,o=3,a=[10],c=null;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in Ps?t+"":Ds,n):r},n.ticks=function(){return arguments.length?(a=arguments,n):a},n.tickValues=function(t){return arguments.length?(c=t,n):c},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t){var e=arguments.length;return e?(u=+t,i=+arguments[e-1],n):u},n.innerTickSize=function(t){return arguments.length?(u=+t,n):u},n.outerTickSize=function(t){return arguments.length?(i=+t,n):i},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(){return arguments.length&&n},n};var Ds="bottom",Ps={top:1,right:1,bottom:1,left:1};Go.svg.brush=function(){function n(i){i.each(function(){var i=Go.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",u).on("touchstart.brush",u),o=i.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),i.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var a=i.selectAll(".resize").data(p,Nt);a.exit().remove(),a.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return Us[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),a.style("display",n.empty()?"none":null);var l,f=Go.transition(i),h=Go.transition(o);c&&(l=Hi(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),e(f)),s&&(l=Hi(s),h.attr("y",l[0]).attr("height",l[1]-l[0]),r(f)),t(f)})}function t(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+l[+/e$/.test(n)]+","+f[+/^s/.test(n)]+")"})}function e(n){n.select(".extent").attr("x",l[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",l[1]-l[0])}function r(n){n.select(".extent").attr("y",f[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",f[1]-f[0])}function u(){function u(){32==Go.event.keyCode&&(A||(x=null,L[0]-=l[1],L[1]-=f[1],A=2),y())}function p(){32==Go.event.keyCode&&2==A&&(L[0]+=l[1],L[1]+=f[1],A=0,y())}function v(){var n=Go.mouse(_),u=!1;M&&(n[0]+=M[0],n[1]+=M[1]),A||(Go.event.altKey?(x||(x=[(l[0]+l[1])/2,(f[0]+f[1])/2]),L[0]=l[+(n[0]<x[0])],L[1]=f[+(n[1]<x[1])]):x=null),E&&d(n,c,0)&&(e(S),u=!0),N&&d(n,s,1)&&(r(S),u=!0),u&&(t(S),w({type:"brush",mode:A?"move":"resize"}))}function d(n,t,e){var r,u,a=Hi(t),c=a[0],s=a[1],p=L[e],v=e?f:l,d=v[1]-v[0];return A&&(c-=p,s-=d+p),r=(e?g:h)?Math.max(c,Math.min(s,n[e])):n[e],A?u=(r+=p)+d:(x&&(p=Math.max(c,Math.min(s,2*x[e]-r))),r>p?(u=r,r=p):u=p),v[0]!=r||v[1]!=u?(e?o=null:i=null,v[0]=r,v[1]=u,!0):void 0}function m(){v(),S.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),Go.select("body").style("cursor",null),T.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),C(),w({type:"brushend"})}var x,M,_=this,b=Go.select(Go.event.target),w=a.of(_,arguments),S=Go.select(_),k=b.datum(),E=!/^(n|s)$/.test(k)&&c,N=!/^(e|w)$/.test(k)&&s,A=b.classed("extent"),C=I(),L=Go.mouse(_),T=Go.select(ea).on("keydown.brush",u).on("keyup.brush",p);if(Go.event.changedTouches?T.on("touchmove.brush",v).on("touchend.brush",m):T.on("mousemove.brush",v).on("mouseup.brush",m),S.interrupt().selectAll("*").interrupt(),A)L[0]=l[0]-L[0],L[1]=f[0]-L[1];else if(k){var q=+/w$/.test(k),z=+/^n/.test(k);M=[l[1-q]-L[0],f[1-z]-L[1]],L[0]=l[q],L[1]=f[z]}else Go.event.altKey&&(x=L.slice());S.style("pointer-events","none").selectAll(".resize").style("display",null),Go.select("body").style("cursor",b.style("cursor")),w({type:"brushstart"}),v()}var i,o,a=M(n,"brushstart","brush","brushend"),c=null,s=null,l=[0,0],f=[0,0],h=!0,g=!0,p=js[0];return n.event=function(n){n.each(function(){var n=a.of(this,arguments),t={x:l,y:f,i:i,j:o},e=this.__chart__||t;this.__chart__=t,Cs?Go.select(this).transition().each("start.brush",function(){i=e.i,o=e.j,l=e.x,f=e.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=mu(l,t.x),r=mu(f,t.y);return i=o=null,function(u){l=t.x=e(u),f=t.y=r(u),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){i=t.i,o=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},n.x=function(t){return arguments.length?(c=t,p=js[!c<<1|!s],n):c},n.y=function(t){return arguments.length?(s=t,p=js[!c<<1|!s],n):s},n.clamp=function(t){return arguments.length?(c&&s?(h=!!t[0],g=!!t[1]):c?h=!!t:s&&(g=!!t),n):c&&s?[h,g]:c?h:s?g:null},n.extent=function(t){var e,r,u,a,h;return arguments.length?(c&&(e=t[0],r=t[1],s&&(e=e[0],r=r[0]),i=[e,r],c.invert&&(e=c(e),r=c(r)),e>r&&(h=e,e=r,r=h),(e!=l[0]||r!=l[1])&&(l=[e,r])),s&&(u=t[0],a=t[1],c&&(u=u[1],a=a[1]),o=[u,a],s.invert&&(u=s(u),a=s(a)),u>a&&(h=u,u=a,a=h),(u!=f[0]||a!=f[1])&&(f=[u,a])),n):(c&&(i?(e=i[0],r=i[1]):(e=l[0],r=l[1],c.invert&&(e=c.invert(e),r=c.invert(r)),e>r&&(h=e,e=r,r=h))),s&&(o?(u=o[0],a=o[1]):(u=f[0],a=f[1],s.invert&&(u=s.invert(u),a=s.invert(a)),u>a&&(h=u,u=a,a=h))),c&&s?[[e,u],[r,a]]:c?[e,r]:s&&[u,a])},n.clear=function(){return n.empty()||(l=[0,0],f=[0,0],i=o=null),n},n.empty=function(){return!!c&&l[0]==l[1]||!!s&&f[0]==f[1]},Go.rebind(n,a,"on")};var Us={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},js=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Hs=ic.format=fc.timeFormat,Fs=Hs.utc,Os=Fs("%Y-%m-%dT%H:%M:%S.%LZ");Hs.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?$o:Os,$o.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},$o.toString=Os.toString,ic.second=Ht(function(n){return new oc(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),ic.seconds=ic.second.range,ic.seconds.utc=ic.second.utc.range,ic.minute=Ht(function(n){return new oc(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),ic.minutes=ic.minute.range,ic.minutes.utc=ic.minute.utc.range,ic.hour=Ht(function(n){var t=n.getTimezoneOffset()/60;return new oc(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),ic.hours=ic.hour.range,ic.hours.utc=ic.hour.utc.range,ic.month=Ht(function(n){return n=ic.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),ic.months=ic.month.range,ic.months.utc=ic.month.utc.range;var Ys=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Is=[[ic.second,1],[ic.second,5],[ic.second,15],[ic.second,30],[ic.minute,1],[ic.minute,5],[ic.minute,15],[ic.minute,30],[ic.hour,1],[ic.hour,3],[ic.hour,6],[ic.hour,12],[ic.day,1],[ic.day,2],[ic.week,1],[ic.month,1],[ic.month,3],[ic.year,1]],Zs=Hs.multi([[".%L",function(n){return n.getMilliseconds()}],[":%S",function(n){return n.getSeconds()}],["%I:%M",function(n){return n.getMinutes()}],["%I %p",function(n){return n.getHours()}],["%a %d",function(n){return n.getDay()&&1!=n.getDate()}],["%b %d",function(n){return 1!=n.getDate()}],["%B",function(n){return n.getMonth()}],["%Y",Ne]]),Vs={range:function(n,t,e){return Go.range(Math.ceil(n/e)*e,+t,e).map(Bo)},floor:Nt,ceil:Nt};Is.year=ic.year,ic.scale=function(){return Xo(Go.scale.linear(),Is,Zs)};var $s=Is.map(function(n){return[n[0].utc,n[1]]}),Xs=Fs.multi([[".%L",function(n){return n.getUTCMilliseconds()}],[":%S",function(n){return n.getUTCSeconds()}],["%I:%M",function(n){return n.getUTCMinutes()}],["%I %p",function(n){return n.getUTCHours()}],["%a %d",function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],["%b %d",function(n){return 1!=n.getUTCDate()}],["%B",function(n){return n.getUTCMonth()}],["%Y",Ne]]);$s.year=ic.year.utc,ic.scale.utc=function(){return Xo(Go.scale.linear(),$s,Xs)},Go.text=At(function(n){return n.responseText}),Go.json=function(n,t){return Ct(n,"application/json",Jo,t)},Go.html=function(n,t){return Ct(n,"text/html",Wo,t)},Go.xml=At(function(n){return n.responseXML}),"function"==typeof define&&define.amd?define(Go):"object"==typeof module&&module.exports?module.exports=Go:this.d3=Go}();(function(p){"function"==typeof define?define(p):"function"==typeof YUI?YUI.add("es5",p):p()})(function(){function p(a){a=+a;a!==a?a=0:0!==a&&(a!==1/0&&a!==-(1/0))&&(a=(0<a||-1)*Math.floor(Math.abs(a)));return a}function s(a){var b=typeof a;return null===a||"undefined"===b||"boolean"===b||"number"===b||"string"===b}Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError("Function.prototype.bind called on incompatible "+b);var d=q.call(arguments,
1),c=function(){if(this instanceof c){var e=b.apply(this,d.concat(q.call(arguments)));return Object(e)===e?e:this}return b.apply(a,d.concat(q.call(arguments)))};b.prototype&&(c.prototype=Object.create(b.prototype));return c});var k=Function.prototype.call,o=Object.prototype,q=Array.prototype.slice,h=k.bind(o.toString),t=k.bind(o.hasOwnProperty);t(o,"__defineGetter__")&&(k.bind(o.__defineGetter__),k.bind(o.__defineSetter__),k.bind(o.__lookupGetter__),k.bind(o.__lookupSetter__));if(2!=[1,2].splice(0).length){var x=
Array.prototype.splice;Array.prototype.splice=function(a,b){return arguments.length?x.apply(this,[a===void 0?0:a,b===void 0?this.length-a:b].concat(q.call(arguments,2))):[]}}if(1!=[].unshift(0)){var y=Array.prototype.unshift;Array.prototype.unshift=function(){y.apply(this,arguments);return this.length}}Array.isArray||(Array.isArray=function(a){return h(a)=="[object Array]"});var k=Object("a"),l="a"!=k[0]||!(0 in k);Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var d=n(this),c=l&&
h(this)=="[object String]"?this.split(""):d,e=-1,f=c.length>>>0;if(h(a)!="[object Function]")throw new TypeError;for(;++e<f;)e in c&&a.call(b,c[e],e,d)});Array.prototype.map||(Array.prototype.map=function(a,b){var d=n(this),c=l&&h(this)=="[object String]"?this.split(""):d,e=c.length>>>0,f=Array(e);if(h(a)!="[object Function]")throw new TypeError(a+" is not a function");for(var g=0;g<e;g++)g in c&&(f[g]=a.call(b,c[g],g,d));return f});Array.prototype.filter||(Array.prototype.filter=function(a,b){var d=
n(this),c=l&&h(this)=="[object String]"?this.split(""):d,e=c.length>>>0,f=[],g;if(h(a)!="[object Function]")throw new TypeError(a+" is not a function");for(var i=0;i<e;i++)if(i in c){g=c[i];a.call(b,g,i,d)&&f.push(g)}return f});Array.prototype.every||(Array.prototype.every=function(a,b){var d=n(this),c=l&&h(this)=="[object String]"?this.split(""):d,e=c.length>>>0;if(h(a)!="[object Function]")throw new TypeError(a+" is not a function");for(var f=0;f<e;f++)if(f in c&&!a.call(b,c[f],f,d))return false;
return true});Array.prototype.some||(Array.prototype.some=function(a,b){var d=n(this),c=l&&h(this)=="[object String]"?this.split(""):d,e=c.length>>>0;if(h(a)!="[object Function]")throw new TypeError(a+" is not a function");for(var f=0;f<e;f++)if(f in c&&a.call(b,c[f],f,d))return true;return false});Array.prototype.reduce||(Array.prototype.reduce=function(a){var b=n(this),d=l&&h(this)=="[object String]"?this.split(""):b,c=d.length>>>0;if(h(a)!="[object Function]")throw new TypeError(a+" is not a function");
if(!c&&arguments.length==1)throw new TypeError("reduce of empty array with no initial value");var e=0,f;if(arguments.length>=2)f=arguments[1];else{do{if(e in d){f=d[e++];break}if(++e>=c)throw new TypeError("reduce of empty array with no initial value");}while(1)}for(;e<c;e++)e in d&&(f=a.call(void 0,f,d[e],e,b));return f});Array.prototype.reduceRight||(Array.prototype.reduceRight=function(a){var b=n(this),d=l&&h(this)=="[object String]"?this.split(""):b,c=d.length>>>0;if(h(a)!="[object Function]")throw new TypeError(a+
" is not a function");if(!c&&arguments.length==1)throw new TypeError("reduceRight of empty array with no initial value");var e,c=c-1;if(arguments.length>=2)e=arguments[1];else{do{if(c in d){e=d[c--];break}if(--c<0)throw new TypeError("reduceRight of empty array with no initial value");}while(1)}do c in this&&(e=a.call(void 0,e,d[c],c,b));while(c--);return e});if(!Array.prototype.indexOf||-1!=[0,1].indexOf(1,2))Array.prototype.indexOf=function(a){var b=l&&h(this)=="[object String]"?this.split(""):
n(this),d=b.length>>>0;if(!d)return-1;var c=0;arguments.length>1&&(c=p(arguments[1]));for(c=c>=0?c:Math.max(0,d+c);c<d;c++)if(c in b&&b[c]===a)return c;return-1};if(!Array.prototype.lastIndexOf||-1!=[0,1].lastIndexOf(0,-3))Array.prototype.lastIndexOf=function(a){var b=l&&h(this)=="[object String]"?this.split(""):n(this),d=b.length>>>0;if(!d)return-1;var c=d-1;arguments.length>1&&(c=Math.min(c,p(arguments[1])));for(c=c>=0?c:d-Math.abs(c);c>=0;c--)if(c in b&&a===b[c])return c;return-1};if(!Object.keys){var v=
!0,w="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),z=w.length,r;for(r in{toString:null})v=!1;Object.keys=function(a){if(typeof a!="object"&&typeof a!="function"||a===null)throw new TypeError("Object.keys called on a non-object");var b=[],d;for(d in a)t(a,d)&&b.push(d);if(v)for(d=0;d<z;d++){var c=w[d];t(a,c)&&b.push(c)}return b}}if(!Date.prototype.toISOString||-1===(new Date(-621987552E5)).toISOString().indexOf("-000001"))Date.prototype.toISOString=
function(){var a,b,d,c;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");c=this.getUTCFullYear();a=this.getUTCMonth();c=c+Math.floor(a/12);a=[(a%12+12)%12+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()];c=(c<0?"-":c>9999?"+":"")+("00000"+Math.abs(c)).slice(0<=c&&c<=9999?-4:-6);for(b=a.length;b--;){d=a[b];d<10&&(a[b]="0"+d)}return c+"-"+a.slice(0,2).join("-")+"T"+a.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+
"Z"};r=!1;try{r=Date.prototype.toJSON&&null===(new Date(NaN)).toJSON()&&-1!==(new Date(-621987552E5)).toJSON().indexOf("-000001")&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(G){}r||(Date.prototype.toJSON=function(){var a=Object(this),b;a:if(s(a))b=a;else{b=a.valueOf;if(typeof b==="function"){b=b.call(a);if(s(b))break a}b=a.toString;if(typeof b==="function"){b=b.call(a);if(s(b))break a}throw new TypeError;}if(typeof b==="number"&&!isFinite(b))return null;b=a.toISOString;
if(typeof b!="function")throw new TypeError("toISOString property is not callable");return b.call(a)});var g=Date,m=function(a,b,d,c,e,f,h){var i=arguments.length;if(this instanceof g){i=i==1&&String(a)===a?new g(m.parse(a)):i>=7?new g(a,b,d,c,e,f,h):i>=6?new g(a,b,d,c,e,f):i>=5?new g(a,b,d,c,e):i>=4?new g(a,b,d,c):i>=3?new g(a,b,d):i>=2?new g(a,b):i>=1?new g(a):new g;i.constructor=m;return i}return g.apply(this,arguments)},u=function(a,b){var d=b>1?1:0;return A[b]+Math.floor((a-1969+d)/4)-Math.floor((a-
1901+d)/100)+Math.floor((a-1601+d)/400)+365*(a-1970)},B=RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),A=[0,31,59,90,120,151,181,212,243,273,304,334,365],j;for(j in g)m[j]=g[j];m.now=g.now;m.UTC=g.UTC;m.prototype=g.prototype;m.prototype.constructor=m;m.parse=function(a){var b=B.exec(a);if(b){var d=Number(b[1]),c=Number(b[2]||1)-1,e=Number(b[3]||1)-1,f=Number(b[4]||0),h=Number(b[5]||0),i=Number(b[6]||
0),j=Number(b[7]||0),m=!b[4]||b[8]?0:Number(new g(1970,0)),k=b[9]==="-"?1:-1,l=Number(b[10]||0),b=Number(b[11]||0);if(f<(h>0||i>0||j>0?24:25)&&h<60&&i<60&&j<1E3&&c>-1&&c<12&&l<24&&b<60&&e>-1&&e<u(d,c+1)-u(d,c)){d=((u(d,c)+e)*24+f+l*k)*60;d=((d+h+b*k)*60+i)*1E3+j+m;if(-864E13<=d&&d<=864E13)return d}return NaN}return g.parse.apply(this,arguments)};Date=m;Date.now||(Date.now=function(){return(new Date).getTime()});if("0".split(void 0,0).length){var C=String.prototype.split;String.prototype.split=function(a,
b){return a===void 0&&b===0?[]:C.apply(this,arguments)}}if("".substr&&"b"!=="0b".substr(-1)){var D=String.prototype.substr;String.prototype.substr=function(a,b){return D.call(this,a<0?(a=this.length+a)<0?0:a:a,b)}}j="\t\n\x0B\f\r \u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff";if(!String.prototype.trim||j.trim()){j="["+j+"]";var E=RegExp("^"+j+j+"*"),F=RegExp(j+j+"*$");String.prototype.trim=function(){if(this===void 0||this===
null)throw new TypeError("can't convert "+this+" to object");return String(this).replace(E,"").replace(F,"")}}var n=function(a){if(a==null)throw new TypeError("can't convert "+a+" to object");return Object(a)}});
/*! jQuery v1.9.1 | (c) 2005, 2012 jQuery Foundation, Inc. | jquery.org/license
//@ sourceMappingURL=jquery.min.map
*/(function(e,t){var n,r,i=typeof t,o=e.document,a=e.location,s=e.jQuery,u=e.$,l={},c=[],p="1.9.1",f=c.concat,d=c.push,h=c.slice,g=c.indexOf,m=l.toString,y=l.hasOwnProperty,v=p.trim,b=function(e,t){return new b.fn.init(e,t,r)},x=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/^[\],:{}\s]*$/,E=/(?:^|:|,)(?:\s*\[)+/g,S=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,A=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,j=/^-ms-/,D=/-([\da-z])/gi,L=function(e,t){return t.toUpperCase()},H=function(e){(o.addEventListener||"load"===e.type||"complete"===o.readyState)&&(q(),b.ready())},q=function(){o.addEventListener?(o.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(o.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))};b.fn=b.prototype={jquery:p,constructor:b,init:function(e,n,r){var i,a;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0)),C.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(a=o.getElementById(i[2]),a&&a.parentNode){if(a.id!==i[2])return r.find(e);this.length=1,this[0]=a}return this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return h.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(h.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},u=2),"object"==typeof s||b.isFunction(s)||(s={}),l===u&&(s=this,--u);l>u;u++)if(null!=(o=arguments[u]))for(i in o)e=s[i],r=o[i],s!==r&&(c&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,a=e&&b.isArray(e)?e:[]):a=e&&b.isPlainObject(e)?e:{},s[i]=b.extend(c,a,r)):r!==t&&(s[i]=r));return s},b.extend({noConflict:function(t){return e.$===b&&(e.$=u),t&&e.jQuery===b&&(e.jQuery=s),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!o.body)return setTimeout(b.ready);b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(o,[b]),b.fn.trigger&&b(o).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!y.call(e,"constructor")&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||y.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=C.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&k.test(n.replace(S,"@").replace(A,"]").replace(E,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(j,"ms-").replace(D,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(a){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:v&&!v.call("\ufeff\u00a0")?function(e){return null==e?"":v.call(e)}:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?b.merge(n,"string"==typeof e?[e]:e):d.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(g)return g.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else while(n[o]!==t)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(s[s.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(s[s.length]=r);return f.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),b.isFunction(e)?(r=h.call(arguments,2),i=function(){return e.apply(n||this,r.concat(h.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,o,a,s){var u=0,l=e.length,c=null==r;if("object"===b.type(r)){o=!0;for(u in r)b.access(e,n,u,r[u],!0,a,s)}else if(i!==t&&(o=!0,b.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(b(e),n)})),n))for(;l>u;u++)n(e[u],r,s?i:i.call(e[u],u,n(e[u],r)));return o?e:c?n.call(e):l?n(e[0],r):a},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n)if(n=b.Deferred(),"complete"===o.readyState)setTimeout(b.ready);else if(o.addEventListener)o.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1);else{o.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(i){}r&&r.doScroll&&function a(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(a,50)}q(),b.ready()}}()}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function M(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}r=b(o);var _={};function F(e){var t=_[e]={};return b.each(e.match(w)||[],function(e,n){t[n]=!0}),t}b.Callbacks=function(e){e="string"==typeof e?_[e]||F(e):b.extend({},e);var n,r,i,o,a,s,u=[],l=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=u.length,n=!0;u&&o>a;a++)if(u[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,u&&(l?l.length&&c(l.shift()):r?u=[]:p.disable())},p={add:function(){if(u){var t=u.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&p.has(n)||u.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?o=u.length:r&&(s=t,c(r))}return this},remove:function(){return u&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,u,r))>-1)u.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}),this},has:function(e){return e?b.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=l=r=t,this},disabled:function(){return!u},lock:function(){return l=t,r||p.disable(),this},locked:function(){return!l},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||i&&!l||(n?l.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,o){var a=o[0],s=b.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=h.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,o=1===i?e:b.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?h.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},s,u,l;if(r>1)for(s=Array(r),u=Array(r),l=Array(r);r>t;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(a(t,l,n)).fail(o.reject).progress(a(t,u,s)):--i;return i||o.resolveWith(l,n),o.promise()}}),b.support=function(){var t,n,r,a,s,u,l,c,p,f,d=o.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),r=d.getElementsByTagName("a")[0],!n||!r||!n.length)return{};s=o.createElement("select"),l=s.appendChild(o.createElement("option")),a=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!a.value,optSelected:l.selected,enctype:!!o.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===o.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!l.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}a=o.createElement("input"),a.setAttribute("value",""),t.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","t"),a.setAttribute("name","t"),u=o.createDocumentFragment(),u.appendChild(a),t.appendChecked=a.checked,t.checkClone=u.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1;return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,b(function(){var n,r,a,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",u=o.getElementsByTagName("body")[0];u&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",u.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=d.getElementsByTagName("td"),a[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===a[0].offsetHeight,a[0].style.display="",a[1].style.display="none",t.reliableHiddenOffsets=p&&0===a[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==u.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(o.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(u.style.zoom=1)),u.removeChild(n),n=d=a=r=null)}),n=s=u=l=r=a=null,t}();var O=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;function P(e,n,r,i){if(b.acceptData(e)){var o,a,s=b.expando,u="string"==typeof n,l=e.nodeType,p=l?b.cache:e,f=l?e[s]:e[s]&&s;if(f&&p[f]&&(i||p[f].data)||!u||r!==t)return f||(l?e[s]=f=c.pop()||b.guid++:f=s),p[f]||(p[f]={},l||(p[f].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?p[f]=b.extend(p[f],n):p[f].data=b.extend(p[f].data,n)),o=p[f],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[b.camelCase(n)]=r),u?(a=o[n],null==a&&(a=o[b.camelCase(n)])):a=o,a}}function R(e,t,n){if(b.acceptData(e)){var r,i,o,a=e.nodeType,s=a?b.cache:e,u=a?e[b.expando]:b.expando;if(s[u]){if(t&&(o=n?s[u]:s[u].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in o?t=[t]:(t=b.camelCase(t),t=t in o?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++)delete o[t[r]];if(!(n?$:b.isEmptyObject)(o))return}(n||(delete s[u].data,$(s[u])))&&(a?b.cleanData([e],!0):b.support.deleteExpando||s!=s.window?delete s[u]:s[u]=null)}}}b.extend({cache:{},expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!$(e)},data:function(e,t,n){return P(e,t,n)},removeData:function(e,t){return R(e,t)},_data:function(e,t,n){return P(e,t,n,!0)},_removeData:function(e,t){return R(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,o=this[0],a=0,s=null;if(e===t){if(this.length&&(s=b.data(o),1===o.nodeType&&!b._data(o,"parsedAttrs"))){for(r=o.attributes;r.length>a;a++)i=r[a].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),W(o,i,s[i]));b._data(o,"parsedAttrs",!0)}return s}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?o?W(o,e,b.data(o,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}});function W(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(B,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:O.test(r)?b.parseJSON(r):r}catch(o){}b.data(e,n,r)}else r=t}return r}function $(e){var t;for(t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),o=b._queueHooks(e,t),a=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),o.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=b.Deferred(),a=this,s=this.length,u=function(){--i||o.resolveWith(a,[a])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(s--)r=b._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(u));return u(),o.promise(n)}});var I,z,X=/[\t\r\n]/g,U=/\r/g,V=/^(?:input|select|textarea|button|object)$/i,Y=/^(?:a|area)$/i,J=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,G=/^(?:checked|selected)$/i,Q=b.support.getSetAttribute,K=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,u="string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){o=0;while(i=t[o++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=b.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,u=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){o=0;while(i=t[o++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var o,a=0,s=b(this),u=t,l=e.match(w)||[];while(o=l[a++])u=r?u:!s.hasClass(o),s[u?"addClass":"removeClass"](o)}else(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];{if(arguments.length)return i=b.isFunction(e),this.each(function(n){var o,a=b(this);1===this.nodeType&&(o=i?e.call(this,n,a.val()):e,null==o?o="":"number"==typeof o?o+="":b.isArray(o)&&(o=b.map(o,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,o,"value")!==t||(this.value=o))});if(o)return r=b.valHooks[o.type]||b.valHooks[o.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(U,""):null==n?"":n)}}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,u=0>i?s:o?i:0;for(;s>u;u++)if(n=r[u],!(!n.selected&&u!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var o,a,s,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return typeof e.getAttribute===i?b.prop(e,n,r):(a=1!==u||!b.isXMLDoc(e),a&&(n=n.toLowerCase(),o=b.attrHooks[n]||(J.test(n)?z:I)),r===t?o&&a&&"get"in o&&null!==(s=o.get(e,n))?s:(typeof e.getAttribute!==i&&(s=e.getAttribute(n)),null==s?t:s):null!==r?o&&a&&"set"in o&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(w);if(o&&1===e.nodeType)while(n=o[i++])r=b.propFix[n]||n,J.test(n)?!Q&&G.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(Q?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!b.isXMLDoc(e),a&&(n=b.propFix[n]||n,o=b.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):V.test(e.nodeName)||Y.test(e.nodeName)&&e.href?0:t}}}}),z={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),o="boolean"==typeof r?K&&Q?null!=i:G.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return o&&o.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},K&&Q||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):I&&I.set(e,n,r)}}),Q||(I=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:I.get,set:function(e,t,n){I.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;function it(){return!0}function ot(){return!1}b.event={global:{},add:function(e,n,r,o,a){var s,u,l,c,p,f,d,h,g,m,y,v=b._data(e);if(v){r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=b.guid++),(u=v.events)||(u=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(w)||[""],l=n.length;while(l--)s=rt.exec(n[l])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),p=b.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=b.event.special[g]||{},d=b.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&b.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=u[g])||(h=u[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),b.event.global[g]=!0;e=null}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,p,f,d,h,g,m=b.hasData(e)&&b._data(e);if(m&&(c=m.events)){t=(t||"").match(w)||[""],l=t.length;while(l--)if(s=rt.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){p=b.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=f.length;while(o--)a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a));u&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||b.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)b.event.remove(e,d+t[l],n,r,!0);b.isEmptyObject(c)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,a){var s,u,l,c,p,f,d,h=[i||o],g=y.call(n,"type")?n.type:n,m=y.call(n,"namespace")?n.namespace.split("."):[];if(l=f=i=i||o,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+b.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),u=0>g.indexOf(":")&&"on"+g,n=n[b.expando]?n:new b.Event(g,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),p=b.event.special[g]||{},a||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!a&&!p.noBubble&&!b.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(l=l.parentNode);l;l=l.parentNode)h.push(l),f=l;f===(i.ownerDocument||o)&&h.push(f.defaultView||f.parentWindow||e)}d=0;while((l=h[d++])&&!n.isPropagationStopped())n.type=d>1?c:p.bindType||g,s=(b._data(l,"events")||{})[n.type]&&b._data(l,"handle"),s&&s.apply(l,r),s=u&&l[u],s&&b.acceptData(l)&&s.apply&&s.apply(l,r)===!1&&n.preventDefault();if(n.type=g,!(a||n.isDefaultPrevented()||p._default&&p._default.apply(i.ownerDocument,r)!==!1||"click"===g&&b.nodeName(i,"a")||!b.acceptData(i)||!u||!i[g]||b.isWindow(i))){f=i[u],f&&(i[u]=null),b.event.triggered=g;try{i[g]()}catch(v){}b.event.triggered=t,f&&(i[u]=f)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,o,a,s=[],u=h.call(arguments),l=(b._data(this,"events")||{})[e.type]||[],c=b.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){s=b.event.handlers.call(this,e,l),n=0;while((o=s[n++])&&!e.isPropagationStopped()){e.currentTarget=o.elem,a=0;while((i=o.handlers[a++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,u),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],u=n.delegateCount,l=e.target;if(u&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(o=[],a=0;u>a;a++)i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?b(r,this).index(l)>=0:b.find(r,this,null,[l]).length),o[r]&&o.push(i);o.length&&s.push({elem:l,handlers:o})}return n.length>u&&s.push({elem:this,handlers:n.slice(u)}),s},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,a=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new b.Event(a),t=r.length;while(t--)n=r[t],e[n]=a[n];return e.target||(e.target=a.srcElement||o),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,a,s=n.button,u=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||o,a=i.documentElement,r=i.body,e.pageX=n.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&u&&(e.relatedTarget=u===e.target?n.toElement:u),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==o.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===o.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;
return(!i||i!==r&&!b.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=ot;else if(!i)return this;return 1===o&&(s=i,i=function(e){return b().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){var n,r,i,o,a,s,u,l,c,p,f,d,h,g,m,y,v,x="sizzle"+-new Date,w=e.document,T={},N=0,C=0,k=it(),E=it(),S=it(),A=typeof t,j=1<<31,D=[],L=D.pop,H=D.push,q=D.slice,M=D.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},_="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=F.replace("w","w#"),B="([*^$|!~]?=)",P="\\["+_+"*("+F+")"+_+"*(?:"+B+_+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+O+")|)|)"+_+"*\\]",R=":("+F+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+P.replace(3,8)+")*)|.*)\\)|)",W=RegExp("^"+_+"+|((?:^|[^\\\\])(?:\\\\.)*)"+_+"+$","g"),$=RegExp("^"+_+"*,"+_+"*"),I=RegExp("^"+_+"*([\\x20\\t\\r\\n\\f>+~])"+_+"*"),z=RegExp(R),X=RegExp("^"+O+"$"),U={ID:RegExp("^#("+F+")"),CLASS:RegExp("^\\.("+F+")"),NAME:RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:RegExp("^("+F.replace("w","w*")+")"),ATTR:RegExp("^"+P),PSEUDO:RegExp("^"+R),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+_+"*(even|odd|(([+-]|)(\\d*)n|)"+_+"*(?:([+-]|)"+_+"*(\\d+)|))"+_+"*\\)|)","i"),needsContext:RegExp("^"+_+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+_+"*((?:-\\d)?\\d*)"+_+"*\\)|)(?=[^-]|$)","i")},V=/[\x20\t\r\n\f]*[+~]/,Y=/^[^{]+\{\s*\[native code/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,G=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,K=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{q.call(w.documentElement.childNodes,0)[0].nodeType}catch(nt){q=function(e){var t,n=[];while(t=this[e++])n.push(t);return n}}function rt(e){return Y.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ot(e){return e[x]=!0,e}function at(e){var t=p.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function st(e,t,n,r){var i,o,a,s,u,l,f,g,m,v;if((t?t.ownerDocument||t:w)!==p&&c(t),t=t||p,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!d&&!r){if(i=J.exec(e))if(a=i[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&y(t,o)&&o.id===a)return n.push(o),n}else{if(i[2])return H.apply(n,q.call(t.getElementsByTagName(e),0)),n;if((a=i[3])&&T.getByClassName&&t.getElementsByClassName)return H.apply(n,q.call(t.getElementsByClassName(a),0)),n}if(T.qsa&&!h.test(e)){if(f=!0,g=x,m=t,v=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){l=ft(e),(f=t.getAttribute("id"))?g=f.replace(K,"\\$&"):t.setAttribute("id",g),g="[id='"+g+"'] ",u=l.length;while(u--)l[u]=g+dt(l[u]);m=V.test(e)&&t.parentNode||t,v=l.join(",")}if(v)try{return H.apply(n,q.call(m.querySelectorAll(v),0)),n}catch(b){}finally{f||t.removeAttribute("id")}}}return wt(e.replace(W,"$1"),t,n,r)}a=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},c=st.setDocument=function(e){var n=e?e.ownerDocument||e:w;return n!==p&&9===n.nodeType&&n.documentElement?(p=n,f=n.documentElement,d=a(n),T.tagNameNoComments=at(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),T.attributes=at(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),T.getByClassName=at(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),T.getByName=at(function(e){e.id=x+0,e.innerHTML="<a name='"+x+"'></a><div name='"+x+"'></div>",f.insertBefore(e,f.firstChild);var t=n.getElementsByName&&n.getElementsByName(x).length===2+n.getElementsByName(x+0).length;return T.getIdNotName=!n.getElementById(x),f.removeChild(e),t}),i.attrHandle=at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==A&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},T.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==A&&!d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==A&&!d){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==A&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=T.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==A?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},i.find.NAME=T.getByName&&function(e,n){return typeof n.getElementsByName!==A?n.getElementsByName(name):t},i.find.CLASS=T.getByClassName&&function(e,n){return typeof n.getElementsByClassName===A||d?t:n.getElementsByClassName(e)},g=[],h=[":focus"],(T.qsa=rt(n.querySelectorAll))&&(at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||h.push("\\["+_+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||h.push(":checked")}),at(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&h.push("[*^$]="+_+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||h.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),h.push(",.*:")})),(T.matchesSelector=rt(m=f.matchesSelector||f.mozMatchesSelector||f.webkitMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&at(function(e){T.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),g.push("!=",R)}),h=RegExp(h.join("|")),g=RegExp(g.join("|")),y=rt(f.contains)||f.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},v=f.compareDocumentPosition?function(e,t){var r;return e===t?(u=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||y(w,e)?-1:t===n||y(w,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t)return u=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:0;if(o===a)return ut(e,t);r=e;while(r=r.parentNode)s.unshift(r);r=t;while(r=r.parentNode)l.unshift(r);while(s[i]===l[i])i++;return i?ut(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},u=!1,[0,0].sort(v),T.detectDuplicates=u,p):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&c(e),t=t.replace(Z,"='$1']"),!(!T.matchesSelector||d||g&&g.test(t)||h.test(t)))try{var n=m.call(e,t);if(n||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&c(e),y(e,t)},st.attr=function(e,t){var n;return(e.ownerDocument||e)!==p&&c(e),d||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):d||T.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},st.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],r=1,i=0;if(u=!T.detectDuplicates,e.sort(v),u){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e};function ut(e,t){var n=t&&e,r=n&&(~t.sourceIndex||j)-(~e.sourceIndex||j);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ot(function(t){return t=+t,ot(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},i=st.selectors={cacheLength:50,createPseudo:ot,match:U,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return U.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&z.test(n)&&(t=ft(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[e+" "];return t||(t=RegExp("(^|"+_+")"+e+"("+_+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!u&&!s;if(m){if(o){while(g){p=t;while(p=p[g])if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){c=m[x]||(m[x]={}),l=c[e]||[],d=l[0]===N&&l[1],f=l[0]===N&&l[2],p=d&&m.childNodes[d];while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if(1===p.nodeType&&++f&&p===t){c[e]=[N,d,f];break}}else if(v&&(l=(t[x]||(t[x]={}))[e])&&l[0]===N)f=l[1];else while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if((s?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(v&&((p[x]||(p[x]={}))[e]=[N,f]),p===t))break;return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[x]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ot(function(e,n){var i,o=r(e,t),a=o.length;while(a--)i=M.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ot(function(e){var t=[],n=[],r=s(e.replace(W,"$1"));return r[x]?ot(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:ot(function(e){return function(t){return st(e,t).length>0}}),contains:ot(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ot(function(e){return X.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=d?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=lt(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=ct(n);function ft(e,t){var n,r,o,a,s,u,l,c=E[e+" "];if(c)return t?0:c.slice(0);s=e,u=[],l=i.preFilter;while(s){(!n||(r=$.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),u.push(o=[])),n=!1,(r=I.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(W," ")}),s=s.slice(n.length));for(a in i.filter)!(r=U[a].exec(s))||l[a]&&!(r=l[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?st.error(e):E(e,u).slice(0)}function dt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function ht(e,t,n){var i=t.dir,o=n&&"parentNode"===i,a=C++;return t.first?function(t,n,r){while(t=t[i])if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,s){var u,l,c,p=N+" "+a;if(s){while(t=t[i])if((1===t.nodeType||o)&&e(t,n,s))return!0}else while(t=t[i])if(1===t.nodeType||o)if(c=t[x]||(t[x]={}),(l=c[i])&&l[0]===p){if((u=l[1])===!0||u===r)return u===!0}else if(l=c[i]=[p],l[1]=e(t,n,s)||r,l[1]===!0)return!0}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var o,a=[],s=0,u=e.length,l=null!=t;for(;u>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),l&&t.push(s));return a}function yt(e,t,n,r,i,o){return r&&!r[x]&&(r=yt(r)),i&&!i[x]&&(i=yt(i,o)),ot(function(o,a,s,u){var l,c,p,f=[],d=[],h=a.length,g=o||xt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:mt(g,f,e,s,u),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,u),r){l=mt(y,d),r(l,[],s,u),c=l.length;while(c--)(p=l[c])&&(y[d[c]]=!(m[d[c]]=p))}if(o){if(i||e){if(i){l=[],c=y.length;while(c--)(p=y[c])&&l.push(m[c]=p);i(null,y=[],l,u)}c=y.length;while(c--)(p=y[c])&&(l=i?M.call(o,p):f[c])>-1&&(o[l]=!(a[l]=p))}}else y=mt(y===a?y.splice(h,y.length):y),i?i(null,a,y,u):H.apply(a,y)})}function vt(e){var t,n,r,o=e.length,a=i.relative[e[0].type],s=a||i.relative[" "],u=a?1:0,c=ht(function(e){return e===t},s,!0),p=ht(function(e){return M.call(t,e)>-1},s,!0),f=[function(e,n,r){return!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;o>u;u++)if(n=i.relative[e[u].type])f=[ht(gt(f),n)];else{if(n=i.filter[e[u].type].apply(null,e[u].matches),n[x]){for(r=++u;o>r;r++)if(i.relative[e[r].type])break;return yt(u>1&&gt(f),u>1&&dt(e.slice(0,u-1)).replace(W,"$1"),n,r>u&&vt(e.slice(u,r)),o>r&&vt(e=e.slice(r)),o>r&&dt(e))}f.push(n)}return gt(f)}function bt(e,t){var n=0,o=t.length>0,a=e.length>0,s=function(s,u,c,f,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,T=l,C=s||a&&i.find.TAG("*",d&&u.parentNode||u),k=N+=null==T?1:Math.random()||.1;for(w&&(l=u!==p&&u,r=n);null!=(h=C[b]);b++){if(a&&h){g=0;while(m=e[g++])if(m(h,u,c)){f.push(h);break}w&&(N=k,r=++n)}o&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,o&&b!==v){g=0;while(m=t[g++])m(x,y,u,c);if(s){if(v>0)while(b--)x[b]||y[b]||(y[b]=L.call(f));y=mt(y)}H.apply(f,y),w&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(f)}return w&&(N=k,l=T),x};return o?ot(s):s}s=st.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){t||(t=ft(e)),n=t.length;while(n--)o=vt(t[n]),o[x]?r.push(o):i.push(o);o=S(e,bt(i,r))}return o};function xt(e,t,n){var r=0,i=t.length;for(;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r){var o,a,u,l,c,p=ft(e);if(!r&&1===p.length){if(a=p[0]=p[0].slice(0),a.length>2&&"ID"===(u=a[0]).type&&9===t.nodeType&&!d&&i.relative[a[1].type]){if(t=i.find.ID(u.matches[0].replace(et,tt),t)[0],!t)return n;e=e.slice(a.shift().value.length)}o=U.needsContext.test(e)?0:a.length;while(o--){if(u=a[o],i.relative[l=u.type])break;if((c=i.find[l])&&(r=c(u.matches[0].replace(et,tt),V.test(a[0].type)&&t.parentNode||t))){if(a.splice(o,1),e=r.length&&dt(a),!e)return H.apply(n,q.call(r,0)),n;break}}}return s(e,p)(r,t,d,n,V.test(e)),n}i.pseudos.nth=i.pseudos.eq;function Tt(){}i.filters=Tt.prototype=i.pseudos,i.setFilters=new Tt,c(),st.attr=b.attr,b.find=st,b.expr=st.selectors,b.expr[":"]=b.expr.pseudos,b.unique=st.uniqueSort,b.text=st.getText,b.isXMLDoc=st.isXML,b.contains=st.contains}(e);var at=/Until$/,st=/^(?:parents|prev(?:Until|All))/,ut=/^.[^:#\[\.,]*$/,lt=b.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e)return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++)if(b.contains(r[t],this))return!0}));for(n=[],t=0;i>t;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1))},filter:function(e){return this.pushStack(ft(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?lt.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,o=[],a=lt.test(e)||"string"!=typeof e?b(e,t||this.context):0;for(;i>r;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&11!==n.nodeType){if(a?a.index(n)>-1:b.find.matchesSelector(n,e)){o.push(n);break}n=n.parentNode}}return this.pushStack(o.length>1?b.unique(o):o)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack;function pt(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return at.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!ct[e]?b.unique(i):i,this.length>1&&st.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!b(o).is(r)))1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function ft(e,t,n){if(t=t||0,b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(ut.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Nt=/^(?:checkbox|radio)$/i,Ct=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(o),Dt=jt.appendChild(o.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;null!=(n=this[r]);r++)(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(Ot(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Mt(Ot(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&b.cleanData(Ot(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(gt,""):t;if(!("string"!=typeof e||Tt.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(b.cleanData(Ot(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=f.apply([],e);var i,o,a,s,u,l,c=0,p=this.length,d=this,h=p-1,g=e[0],m=b.isFunction(g);if(m||!(1>=p||"string"!=typeof g||b.support.checkClone)&&Ct.test(g))return this.each(function(i){var o=d.eq(i);m&&(e[0]=g.call(this,i,n?o.html():t)),o.domManip(e,n,r)});if(p&&(l=b.buildFragment(e,this[0].ownerDocument,!1,this),i=l.firstChild,1===l.childNodes.length&&(l=i),i)){for(n=n&&b.nodeName(i,"tr"),s=b.map(Ot(l,"script"),Ht),a=s.length;p>c;c++)o=l,c!==h&&(o=b.clone(o,!0,!0),a&&b.merge(s,Ot(o,"script"))),r.call(n&&b.nodeName(this[c],"table")?Lt(this[c],"tbody"):this[c],o,c);if(a)for(u=s[s.length-1].ownerDocument,b.map(s,qt),c=0;a>c;c++)o=s[c],kt.test(o.type||"")&&!b._data(o,"globalEval")&&b.contains(u,o)&&(o.src?b.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((o.text||o.textContent||o.innerHTML||"").replace(St,"")));l=i=null}return this}});function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function Ht(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Mt(e,t){var n,r=0;for(;null!=(n=e[r]);r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function _t(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,o=b._data(e),a=b._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)b.event.add(t,n,s[n][r])}a.data&&(a.data=b.extend({},a.data))}}function Ft(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Nt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],o=b(e),a=o.length-1;for(;a>=r;r++)n=r===a?this:this.clone(!0),b(o[r])[t](n),d.apply(i,n.get());return this.pushStack(i)}});function Ot(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++)!n||b.nodeName(o,n)?s.push(o):b.merge(s,Ot(o,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],s):s}function Bt(e){Nt.test(e.type)&&(e.defaultChecked=e.checked)}b.extend({clone:function(e,t,n){var r,i,o,a,s,u=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(r=Ot(o),s=Ot(e),a=0;null!=(i=s[a]);++a)r[a]&&Ft(i,r[a]);if(t)if(n)for(s=s||Ot(e),r=r||Ot(o),a=0;null!=(i=s[a]);a++)_t(i,r[a]);else _t(e,o);return r=Ot(o,"script"),r.length>0&&Mt(r,!u&&Ot(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){var i,o,a,s,u,l,c,p=e.length,f=dt(t),d=[],h=0;for(;p>h;h++)if(o=e[h],o||0===o)if("object"===b.type(o))b.merge(d,o.nodeType?[o]:o);else if(wt.test(o)){s=s||f.appendChild(t.createElement("div")),u=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[u]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];while(i--)s=s.lastChild;if(!b.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!b.support.tbody){o="table"!==u||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;while(i--)b.nodeName(l=o.childNodes[i],"tbody")&&!l.childNodes.length&&o.removeChild(l)
}b.merge(d,s.childNodes),s.textContent="";while(s.firstChild)s.removeChild(s.firstChild);s=f.lastChild}else d.push(t.createTextNode(o));s&&f.removeChild(s),b.support.appendChecked||b.grep(Ot(d,"input"),Bt),h=0;while(o=d[h++])if((!r||-1===b.inArray(o,r))&&(a=b.contains(o.ownerDocument,o),s=Ot(f.appendChild(o),"script"),a&&Mt(s),n)){i=0;while(o=s[i++])kt.test(o.type||"")&&n.push(o)}return s=null,f},cleanData:function(e,t){var n,r,o,a,s=0,u=b.expando,l=b.cache,p=b.support.deleteExpando,f=b.event.special;for(;null!=(n=e[s]);s++)if((t||b.acceptData(n))&&(o=n[u],a=o&&l[o])){if(a.events)for(r in a.events)f[r]?b.event.remove(n,r):b.removeEvent(n,r,a.handle);l[o]&&(delete l[o],p?delete n[u]:typeof n.removeAttribute!==i?n.removeAttribute(u):n[u]=null,c.push(o))}}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+x+")(.*)$","i"),Yt=RegExp("^("+x+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+x+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,o=[],a=0,s=e.length;for(;s>a;a++)r=e[a],r.style&&(o[a]=b._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=b._data(r,"olddisplay",un(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))));for(a=0;s>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,o,a={},s=0;if(b.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++)a[n[s]]=b.css(e,n[s],!1,o);return a}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,u=b.camelCase(n),l=e.style;if(n=b.cssProps[u]||(b.cssProps[u]=tn(l,u)),s=b.cssHooks[n]||b.cssHooks[u],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:l[n];if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(b.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||b.cssNumber[u]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{l[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,u=b.camelCase(n);return n=b.cssProps[u]||(b.cssProps[u]=tn(e.style,u)),s=b.cssHooks[n]||b.cssHooks[u],s&&"get"in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||b.isNumeric(o)?o||0:a):a},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==u||b.contains(e.ownerDocument,e)||(u=b.style(e,n)),Yt.test(u)&&Ut.test(n)&&(i=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=u,u=s.width,l.width=i,l.minWidth=o,l.maxWidth=a)),u}):o.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s[n]:t,l=e.style;return null==u&&l&&l[n]&&(u=l[n]),Yt.test(u)&&!zt.test(n)&&(i=l.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),l.left="fontSize"===n?"1em":u,u=l.pixelLeft+"px",l.left=i,a&&(o.left=a)),""===u?"auto":u});function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;for(;4>o;o+=2)"margin"===n&&(a+=b.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=b.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=b.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=b.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=b.css(e,"border"+Zt[o]+"Width",!0,i)));return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i))return i;r=a&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function un(e){var t=o,n=Gt[e];return n||(n=ln(e,t),"none"!==n&&n||(Pt=(Pt||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=ln(e,t),Pt.detach()),Gt[e]=n),n}function ln(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=o[r]||o[r-2]||o[0];return i}},Ut.test(e)||(b.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Nt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],o=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){o(this.name,this.value)});else for(r in e)gn(r,e[r],n,o);return i.join("&").replace(cn,"+")};function gn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==b.type(t))r(e,t);else for(i in t)gn(e+"["+i+"]",t[i],n,r)}b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,yn,vn=b.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Nn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Cn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=b.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=a.href}catch(Ln){yn=o.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[];function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(w)||[];if(b.isFunction(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,n,r,i){var o={},a=e===jn;function s(u){var l;return o[u]=!0,b.each(e[u]||[],function(e,u){var c=u(n,r,i);return"string"!=typeof c||a||o[c]?a?!(l=c):t:(n.dataTypes.unshift(c),s(c),!1)}),l}return s(n.dataTypes[0])||!o["*"]&&s("*")}function Mn(e,n){var r,i,o=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}b.fn.load=function(e,n,r){if("string"!=typeof e&&Sn)return Sn.apply(this,arguments);var i,o,a,s=this,u=e.indexOf(" ");return u>=0&&(i=e.slice(u,e.length),e=e.slice(0,u)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&b.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,o){return b.isFunction(r)&&(o=o||i,i=r,r=t),b.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Nn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Mn(Mn(e,b.ajaxSettings),t):Mn(b.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,u,l,c,p=b.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?b(f):b.event,h=b.Deferred(),g=b.Callbacks("once memory"),m=p.statusCode||{},y={},v={},x=0,T="canceled",N={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!c){c={};while(t=Tn.exec(a))c[t[1].toLowerCase()]=t[2]}t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return x||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>x)for(t in e)m[t]=[m[t],e[t]];else N.always(e[N.status]);return this},abort:function(e){var t=e||T;return l&&l.abort(t),k(0,t),this}};if(h.promise(N).complete=g.add,N.success=N.done,N.error=N.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=b.trim(p.dataType||"*").toLowerCase().match(w)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=b.param(p.data,p.traditional)),qn(An,p,n,N),2===x)return N;u=p.global,u&&0===b.active++&&b.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Cn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(b.lastModified[o]&&N.setRequestHeader("If-Modified-Since",b.lastModified[o]),b.etag[o]&&N.setRequestHeader("If-None-Match",b.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&N.setRequestHeader("Content-Type",p.contentType),N.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers)N.setRequestHeader(i,p.headers[i]);if(p.beforeSend&&(p.beforeSend.call(f,N,p)===!1||2===x))return N.abort();T="abort";for(i in{success:1,error:1,complete:1})N[i](p[i]);if(l=qn(jn,p,n,N)){N.readyState=1,u&&d.trigger("ajaxSend",[N,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){N.abort("timeout")},p.timeout));try{x=1,l.send(y,k)}catch(C){if(!(2>x))throw C;k(-1,C)}}else k(-1,"No Transport");function k(e,n,r,i){var c,y,v,w,T,C=n;2!==x&&(x=2,s&&clearTimeout(s),l=t,a=i||"",N.readyState=e>0?4:0,r&&(w=_n(p,N,r)),e>=200&&300>e||304===e?(p.ifModified&&(T=N.getResponseHeader("Last-Modified"),T&&(b.lastModified[o]=T),T=N.getResponseHeader("etag"),T&&(b.etag[o]=T)),204===e?(c=!0,C="nocontent"):304===e?(c=!0,C="notmodified"):(c=Fn(p,w),C=c.state,y=c.data,v=c.error,c=!v)):(v=C,(e||!C)&&(C="error",0>e&&(e=0))),N.status=e,N.statusText=(n||C)+"",c?h.resolveWith(f,[y,C,N]):h.rejectWith(f,[N,C,v]),N.statusCode(m),m=t,u&&d.trigger(c?"ajaxSuccess":"ajaxError",[N,p,c?y:v]),g.fireWith(f,[N,C]),u&&(d.trigger("ajaxComplete",[N,p]),--b.active||b.event.trigger("ajaxStop")))}return N},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}});function _n(e,n,r){var i,o,a,s,u=e.contents,l=e.dataTypes,c=e.responseFields;for(s in c)s in r&&(n[c[s]]=r[s]);while("*"===l[0])l.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in u)if(u[s]&&u[s].test(o)){l.unshift(s);break}if(l[0]in r)a=l[0];else{for(s in r){if(!l[0]||e.converters[s+" "+l[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==l[0]&&l.unshift(a),r[a]):t}function Fn(e,t){var n,r,i,o,a={},s=0,u=e.dataTypes.slice(),l=u[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u[1])for(i in e.converters)a[i.toLowerCase()]=e.converters[i];for(;r=u[++s];)if("*"!==r){if("*"!==l&&l!==r){if(i=a[l+" "+r]||a["* "+r],!i)for(n in a)if(o=n.split(" "),o[1]===r&&(i=a[l+" "+o[0]]||a["* "+o[0]])){i===!0?i=a[n]:a[n]!==!0&&(r=o[0],u.splice(s--,0,r));break}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+l+" to "+r}}}l=r}return{state:"success",data:t}}b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||b("head")[0]||o.documentElement;return{send:function(t,i){n=o.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var On=[],Bn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=On.pop()||b.expando+"_"+vn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,u=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return u||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||b.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,On.push(o)),s&&b.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn)Pn[e](t,!0)};function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&In()||zn()}:In,Rn=b.ajaxSettings.xhr(),b.support.cors=!!Rn&&"withCredentials"in Rn,Rn=b.support.ajax=!!Rn,Rn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,o){var a,s,u=n.xhr();if(n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)u[s]=n.xhrFields[s];n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)u.setRequestHeader(s,i[s])}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var s,l,c,p;try{if(r&&(i||4===u.readyState))if(r=t,a&&(u.onreadystatechange=b.noop,$n&&delete Pn[a]),i)4!==u.readyState&&u.abort();else{p={},s=u.status,l=u.getAllResponseHeaders(),"string"==typeof u.responseText&&(p.text=u.responseText);try{c=u.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}catch(d){i||o(-1,d)}p&&o(s,c,p,l)},n.async?4===u.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},b(e).unload($n)),Pn[a]=r),u.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+x+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n,r,i=this.createTween(e,t),o=Yn.exec(t),a=i.cur(),s=+a||0,u=1,l=20;if(o){if(n=+o[2],r=o[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&s){s=b.css(i.elem,e,!0)||n||1;do u=u||".5",s/=u,b.style(i.elem,e,s+r);while(u!==(u=i.cur()/a)&&1!==u&&--l)}i.unit=r,i.start=s,i.end=o[1]?s+(o[1]+1)*n:n}return i}]};function Kn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Qn[t]||[]).concat(Qn["*"]),i=0,o=r.length;for(;o>i;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,o=0,a=Gn.length,s=b.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;var t=Xn||Kn(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;for(;u>a;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),1>o&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)l.tweens[n].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),c=l.props;for(tr(c,l.opts.specialEasing);a>o;o++)if(r=Gn[o].call(l,e,c,l.opts))return r;return Zn(l,c),b.isFunction(l.opts.start)&&l.opts.start.call(e,l),b.fx.timer(b.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function tr(e,t){var n,r,i,o,a;for(i in e)if(r=b.camelCase(i),o=t[r],n=e[i],b.isArray(n)&&(o=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),a=b.cssHooks[r],a&&"expand"in a){n=a.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=o)}else t[r]=o}b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}});function nr(e,t,n){var r,i,o,a,s,u,l,c,p,f=this,d=e.style,h={},g=[],m=e.nodeType&&nn(e);n.queue||(c=b._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,f.always(function(){f.always(function(){c.unqueued--,b.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==un(e.nodeName)?d.zoom=1:d.display="inline-block")),n.overflow&&(d.overflow="hidden",b.support.shrinkWrapBlocks||f.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(i in t)if(a=t[i],Vn.exec(a)){if(delete t[i],u=u||"toggle"===a,a===(m?"hide":"show"))continue;g.push(i)}if(o=g.length){s=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in s&&(m=s.hidden),u&&(s.hidden=!m),m?b(e).show():f.done(function(){b(e).hide()}),f.done(function(){var t;b._removeData(e,"fxshow");for(t in h)b.style(e,t,h[t])});for(i=0;o>i;i++)r=g[i],l=f.createTween(r,m?s[r]:0),h[r]=s[r]||b.style(e,r),r in s||(s[r]=l.start,m&&(l.end=l.start,l.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),o=b.speed(t,n,r),a=function(){var t=er(this,b.extend({},e),o);a.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=b.timers,a=b._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&Jn.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=b.timers,a=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Un||(Un=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Un),Un=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s)return n=s.documentElement,b.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var i=b(e),o=i.offset(),a=b.css(e,"top"),s=b.css(e,"left"),u=("absolute"===r||"fixed"===r)&&b.inArray("auto",[a,s])>-1,l={},c={},p,f;u?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),b.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(l.top=t.top-o.top+p),null!=t.left&&(l.left=t.left-o.left+f),"using"in t?t.using.call(e,l):i.css(l)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||o.documentElement;while(e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position"))e=e.offsetParent;return e||o.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?b(a).scrollLeft():o,r?o:b(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}});function or(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return b.access(this,function(n,r,i){var o;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?b.css(n,r,s):b.style(n,r,i,s)},n,a?i:t,a,null)}})}),e.jQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})})(window);!function(window,undefined){"use strict";var EMPTY="",UNKNOWN="?",FUNC_TYPE="function",UNDEF_TYPE="undefined",OBJ_TYPE="object",MAJOR="major",MODEL="model",NAME="name",TYPE="type",VENDOR="vendor",VERSION="version",ARCHITECTURE="architecture",CONSOLE="console",MOBILE="mobile",TABLET="tablet";var util={has:function(str1,str2){return str2.toLowerCase().indexOf(str1.toLowerCase())!==-1},lowerize:function(str){return str.toLowerCase()}};var mapper={rgx:function(){for(var result,i=0,j,k,p,q,matches,match,args=arguments;i<args.length;i+=2){var regex=args[i],props=args[i+1];if(typeof result===UNDEF_TYPE){result={};for(p in props){q=props[p];if(typeof q===OBJ_TYPE){result[q[0]]=undefined}else{result[q]=undefined}}}for(j=k=0;j<regex.length;j++){matches=regex[j].exec(this.getUA());if(!!matches){for(p in props){match=matches[++k];q=props[p];if(typeof q===OBJ_TYPE&&q.length>0){if(q.length==2){if(typeof q[1]==FUNC_TYPE){result[q[0]]=q[1].call(this,match)}else{result[q[0]]=q[1]}}else if(q.length==3){if(typeof q[1]===FUNC_TYPE&&!(q[1].exec&&q[1].test)){result[q[0]]=match?q[1].call(this,match,q[2]):undefined}else{result[q[0]]=match?match.replace(q[1],q[2]):undefined}}else if(q.length==4){result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):undefined}}else{result[q]=match?match:undefined}}break}}if(!!matches)break}return result},str:function(str,map){for(var i in map){if(typeof map[i]===OBJ_TYPE&&map[i].length>0){for(var j=0;j<map[i].length;j++){if(util.has(map[i][j],str)){return i===UNKNOWN?undefined:i}}}else if(util.has(map[i],str)){return i===UNKNOWN?undefined:i}}return str}};var maps={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",RT:"ARM"}}}};var regexes={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[NAME,"Opera"],VERSION,MAJOR],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt)\/((\d+)?[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[NAME,"Yandex"],VERSION,MAJOR],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[NAME,/_/g," "],VERSION,MAJOR],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[NAME,"Dolphin"],VERSION,MAJOR],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[NAME,"Chrome"],VERSION,MAJOR],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[VERSION,MAJOR,[NAME,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[VERSION,MAJOR,NAME],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[NAME,[MAJOR,mapper.str,maps.browser.oldsafari.major],[VERSION,mapper.str,maps.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[NAME,"Netscape"],VERSION,MAJOR],[/(swiftfox)/i,/(iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[ARCHITECTURE,"amd64"]],[/((?:i[346]|x)86)[;\)]/i],[[ARCHITECTURE,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[ARCHITECTURE,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[ARCHITECTURE,/ower/,"",util.lowerize]],[/(sun4\w)[;\)]/i],[[ARCHITECTURE,"sparc"]],[/(ia64(?=;)|68k(?=\))|arm(?=v\d+;)|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[ARCHITECTURE,util.lowerize]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[MODEL,VENDOR,[TYPE,TABLET]],[/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[VENDOR,MODEL,[TYPE,TABLET]],[/\((ip[honed]+);.+(apple)/i],[MODEL,VENDOR,[TYPE,MOBILE]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/\((bb10);\s(\w+)/i],[[VENDOR,"BlackBerry"],MODEL,[TYPE,MOBILE]],[/android.+((transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+))/i],[[VENDOR,"Asus"],MODEL,[TYPE,TABLET]],[/(sony)\s(tablet\s[ps])/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(nintendo)\s([wids3u]+)/i],[VENDOR,MODEL,[TYPE,CONSOLE]],[/((playstation)\s[3portablevi]+)/i],[[VENDOR,"Sony"],MODEL,[TYPE,CONSOLE]],[/(sprint\s(\w+))/i],[[VENDOR,mapper.str,maps.device.sprint.vendor],[MODEL,mapper.str,maps.device.sprint.model],[TYPE,MOBILE]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[VENDOR,[MODEL,/_/g," "],[TYPE,MOBILE]],[/\s((milestone|droid[2x]?))[globa\s]*\sbuild\//i,/(mot)[\s-]?(\w+)*/i],[[VENDOR,"Motorola"],MODEL,[TYPE,MOBILE]],[/android.+\s((mz60\d|xoom[\s2]{0,2}))\sbuild\//i],[[VENDOR,"Motorola"],MODEL,[TYPE,TABLET]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,TABLET]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,MOBILE]],[/(sie)-(\w+)*/i],[[VENDOR,"Siemens"],MODEL,[TYPE,MOBILE]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[VENDOR,"Nokia"],MODEL,[TYPE,MOBILE]],[/android\s3\.[\s\w-;]{10}((a\d{3}))/i],[[VENDOR,"Acer"],MODEL,[TYPE,TABLET]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[VENDOR,"LG"],MODEL,[TYPE,TABLET]],[/((nexus\s4))/i,/(lg)[e;\s-\/]+(\w+)*/i],[[VENDOR,"LG"],MODEL,[TYPE,MOBILE]],[/(mobile|tablet);.+rv\:.+gecko\//i],[TYPE,VENDOR,MODEL]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[NAME,"Windows"],[VERSION,mapper.str,maps.os.windows.version]],[/\((bb)(10);/i],[[NAME,"BlackBerry"],VERSION],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[NAME,VERSION],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[NAME,"Symbian"],VERSION],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[NAME,"Firefox OS"],VERSION],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[NAME,VERSION],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[NAME,"Chromium OS"],VERSION],[/(sunos)\s?([\w\.]+\d)*/i],[[NAME,"Solaris"],VERSION],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[NAME,"iOS"],[VERSION,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[NAME,[VERSION,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[NAME,VERSION]]};var UAParser=function(uastring){var ua=uastring||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:EMPTY);if(!(this instanceof UAParser)){return new UAParser(uastring).getResult()}this.getBrowser=function(){return mapper.rgx.apply(this,regexes.browser)};this.getCPU=function(){return mapper.rgx.apply(this,regexes.cpu)};this.getDevice=function(){return mapper.rgx.apply(this,regexes.device)};this.getEngine=function(){return mapper.rgx.apply(this,regexes.engine)};this.getOS=function(){return mapper.rgx.apply(this,regexes.os)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}};this.getUA=function(){return ua};this.setUA=function(uastring){ua=uastring;return this};this.setUA(ua)};if(typeof exports!==UNDEF_TYPE){if(typeof module!==UNDEF_TYPE&&module.exports){exports=module.exports=UAParser}exports.UAParser=UAParser}else{window.UAParser=UAParser;if(typeof define===FUNC_TYPE&&define.amd){define(function(){return UAParser})}if(typeof window.jQuery!==UNDEF_TYPE){var $=window.jQuery;var parser=new UAParser;$.ua=parser.getResult();$.ua.get=function(){return parser.getUA()};$.ua.set=function(uastring){parser.setUA(uastring);var result=parser.getResult();for(var prop in result){$.ua[prop]=result[prop]}}}}}(this);(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(jQuery)}})(function(e){function n(e){return e}function r(e){return decodeURIComponent(e.replace(t," "))}function i(e){if(e.indexOf('"')===0){e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{return s.json?JSON.parse(e):e}catch(t){}}var t=/\+/g;var s=e.cookie=function(t,o,u){if(o!==undefined){u=e.extend({},s.defaults,u);if(typeof u.expires==="number"){var a=u.expires,f=u.expires=new Date;f.setDate(f.getDate()+a)}o=s.json?JSON.stringify(o):String(o);return document.cookie=[s.raw?t:encodeURIComponent(t),"=",s.raw?o:encodeURIComponent(o),u.expires?"; expires="+u.expires.toUTCString():"",u.path?"; path="+u.path:"",u.domain?"; domain="+u.domain:"",u.secure?"; secure":""].join("")}var l=s.raw?n:r;var c=document.cookie.split("; ");var h=t?undefined:{};for(var p=0,d=c.length;p<d;p++){var v=c[p].split("=");var m=l(v.shift());var g=l(v.join("="));if(t&&t===m){h=i(g);break}if(!t){h[m]=i(g)}}return h};s.defaults={};e.removeCookie=function(t,n){if(e.cookie(t)!==undefined){e.cookie(t,"",e.extend(n,{expires:-1}));return true}return false}});/*
 * jQuery hashchange event - v1.3 - 7/21/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function($,e,b){var c="hashchange",h=document,f,g=$.event.special,i=h.documentMode,d="on"+c in e&&(i===b||i>7);function a(j){j=j||location.href;return"#"+j.replace(/^[^#]*#?(.*)$/,"$1")}$.fn[c]=function(j){return j?this.bind(c,j):this.trigger(c)};$.fn[c].delay=50;g[c]=$.extend(g[c],{setup:function(){if(d){return false}$(f.start)},teardown:function(){if(d){return false}$(f.stop)}});f=(function(){var j={},p,m=a(),k=function(q){return q},l=k,o=k;j.start=function(){p||n()};j.stop=function(){p&&clearTimeout(p);p=b};function n(){var r=a(),q=o(m);if(r!==m){l(m=r,q);$(e).trigger(c)}else{if(q!==m){location.href=location.href.replace(/#.*/,"")+q}}p=setTimeout(n,$.fn[c].delay)}$.ua.engine.name==="Trident"&&!d&&(function(){var q,r;j.start=function(){if(!q){r=$.fn[c].src;r=r&&r+a();q=$('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){r||l(a());n()}).attr("src",r||"javascript:0").insertAfter("body")[0].contentWindow;h.onpropertychange=function(){try{if(event.propertyName==="title"){q.document.title=h.title}}catch(s){}}}};j.stop=k;o=function(){return a(q.location.href)};l=function(v,s){var u=q.document,t=$.fn[c].domain;if(v!==s){u.title=h.title;u.open();t&&u.write('<script>document.domain="'+t+'"<\/script>');u.close();q.location.hash=v}}})();return j})()})(jQuery,this);
/*! Copyright (c) 2013 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.1.3
 *
 * Requires: 1.2.2+
 */
(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)})(function(e){function t(t){var l,i=t||window.event,s=[].slice.call(arguments,1),h=0,u=0,a=0,r=0,d=0;return t=e.event.fix(i),t.type="mousewheel",i.wheelDelta&&(h=i.wheelDelta),i.detail&&(h=-1*i.detail),i.deltaY&&(a=-1*i.deltaY,h=a),i.deltaX&&(u=i.deltaX,h=-1*u),void 0!==i.wheelDeltaY&&(a=i.wheelDeltaY),void 0!==i.wheelDeltaX&&(u=-1*i.wheelDeltaX),r=Math.abs(h),(!o||o>r)&&(o=r),d=Math.max(Math.abs(a),Math.abs(u)),(!n||n>d)&&(n=d),l=h>0?"floor":"ceil",h=Math[l](h/o),u=Math[l](u/n),a=Math[l](a/n),s.unshift(t,h,u,a),(e.event.dispatch||e.event.handle).apply(this,s)}var o,n,l=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],i="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(e.event.fixHooks)for(var s=l.length;s;)e.event.fixHooks[l[--s]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=i.length;e;)this.addEventListener(i[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=i.length;e;)this.removeEventListener(i[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})});
(function($){$.extend({tablesorter:new
function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",cssChildRow:"expand-child",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,sortLocaleCompare:true,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",decimal:'/\.|\,/g',onRenderHeader:null,selectorHeaders:'thead th',debug:false};function benchmark(s,d){log(s+","+(new Date().getTime()-d.getTime())+"ms");}this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s);}else{alert(s);}}function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug="";}if(table.tBodies.length==0)return;var rows=table.tBodies[0].rows;if(rows[0]){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($.metadata&&($($headers[i]).metadata()&&$($headers[i]).metadata().sorter)){p=getParserById($($headers[i]).metadata().sorter);}else if((table.config.headers[i]&&table.config.headers[i].sorter)){p=getParserById(table.config.headers[i].sorter);}if(!p){p=detectParserForColumn(table,rows,-1,i);}if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n";}list.push(p);}}if(table.config.debug){log(parsersDebug);}return list;};function detectParserForColumn(table,rows,rowIndex,cellIndex){var l=parsers.length,node=false,nodeValue=false,keepLooking=true;while(nodeValue==''&&keepLooking){rowIndex++;if(rows[rowIndex]){node=getNodeFromRowAndCellIndex(rows,rowIndex,cellIndex);nodeValue=trimAndGetNodeText(table.config,node);if(table.config.debug){log('Checking if value was empty on row:'+rowIndex);}}else{keepLooking=false;}}for(var i=1;i<l;i++){if(parsers[i].is(nodeValue,table,node)){return parsers[i];}}return parsers[0];}function getNodeFromRowAndCellIndex(rows,rowIndex,cellIndex){return rows[rowIndex].cells[cellIndex];}function trimAndGetNodeText(config,node){return $.trim(getElementText(config,node));}function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i];}}return false;}function buildCache(table){if(table.config.debug){var cacheTime=new Date();}var totalRows=(table.tBodies[0]&&table.tBodies[0].rows.length)||0,totalCells=(table.tBodies[0].rows[0]&&table.tBodies[0].rows[0].cells.length)||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=$(table.tBodies[0].rows[i]),cols=[];if(c.hasClass(table.config.cssChildRow)){cache.row[cache.row.length-1]=cache.row[cache.row.length-1].add(c);continue;}cache.row.push(c);for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c[0].cells[j]),table,c[0].cells[j]));}cols.push(cache.normalized.length);cache.normalized.push(cols);cols=null;};if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime);}return cache;};function getElementText(config,node){var text="";if(!node)return"";if(!config.supportsTextContent)config.supportsTextContent=node.textContent||false;if(config.textExtraction=="simple"){if(config.supportsTextContent){text=node.textContent;}else{if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){text=node.childNodes[0].innerHTML;}else{text=node.innerHTML;}}}else{if(typeof(config.textExtraction)=="function"){text=config.textExtraction(node);}else{text=$(node).text();}}return text;}function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date()}var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){var pos=n[i][checkCell];rows.push(r[pos]);if(!table.config.appender){var l=r[pos].length;for(var j=0;j<l;j++){tableBody[0].appendChild(r[pos][j]);}}}if(table.config.appender){table.config.appender(table,rows);}rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime);}applyWidget(table);setTimeout(function(){$(table).trigger("sortEnd");},0);};function buildHeaders(table){if(table.config.debug){var time=new Date();}var meta=($.metadata)?true:false;var header_index=computeTableHeaderCellIndexes(table);$tableHeaders=$(table.config.selectorHeaders,table).each(function(index){this.column=header_index[this.parentNode.rowIndex+"-"+this.cellIndex];this.order=formatSortingOrder(table.config.sortInitialOrder);this.count=this.order;if(checkHeaderMetadata(this)||checkHeaderOptions(table,index))this.sortDisabled=true;if(checkHeaderOptionsSortingLocked(table,index))this.order=this.lockedOrder=checkHeaderOptionsSortingLocked(table,index);if(!this.sortDisabled){var $th=$(this).addClass(table.config.cssHeader);if(table.config.onRenderHeader)table.config.onRenderHeader.apply($th);}table.config.headerList[index]=this;});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders);}return $tableHeaders;};function computeTableHeaderCellIndexes(t){var matrix=[];var lookup={};var thead=t.getElementsByTagName('THEAD')[0];var trs=thead.getElementsByTagName('TR');for(var i=0;i<trs.length;i++){var cells=trs[i].cells;for(var j=0;j<cells.length;j++){var c=cells[j];var rowIndex=c.parentNode.rowIndex;var cellId=rowIndex+"-"+c.cellIndex;var rowSpan=c.rowSpan||1;var colSpan=c.colSpan||1
var firstAvailCol;if(typeof(matrix[rowIndex])=="undefined"){matrix[rowIndex]=[];}for(var k=0;k<matrix[rowIndex].length+1;k++){if(typeof(matrix[rowIndex][k])=="undefined"){firstAvailCol=k;break;}}lookup[cellId]=firstAvailCol;for(var k=rowIndex;k<rowIndex+rowSpan;k++){if(typeof(matrix[k])=="undefined"){matrix[k]=[];}var matrixrow=matrix[k];for(var l=firstAvailCol;l<firstAvailCol+colSpan;l++){matrixrow[l]="x";}}}}return lookup;}function checkCellColSpan(table,rows,row){var arr=[],r=table.tHead.rows,c=r[row].cells;for(var i=0;i<c.length;i++){var cell=c[i];if(cell.colSpan>1){arr=arr.concat(checkCellColSpan(table,headerArr,row++));}else{if(table.tHead.length==1||(cell.rowSpan>1||!r[row+1])){arr.push(cell);}}}return arr;};function checkHeaderMetadata(cell){if(($.metadata)&&($(cell).metadata().sorter===false)){return true;};return false;}function checkHeaderOptions(table,i){if((table.config.headers[i])&&(table.config.headers[i].sorter===false)){return true;};return false;}function checkHeaderOptionsSortingLocked(table,i){if((table.config.headers[i])&&(table.config.headers[i].lockedOrder))return table.config.headers[i].lockedOrder;return false;}function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table);}}function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i];}}};function formatSortingOrder(v){if(typeof(v)!="Number"){return(v.toLowerCase()=="desc")?1:0;}else{return(v==1)?1:0;}}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true;}}return false;}function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$(this);}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]]);}}function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$('<colgroup>');$("tr:first td",table.tBodies[0]).each(function(){colgroup.append($('<col>').css('width',$(this).width()));});$(table).prepend(colgroup);};}function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++;}}function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date();}var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=(table.config.parsers[c].type=="text")?((order==0)?makeSortFunction("text","asc",c):makeSortFunction("text","desc",c)):((order==0)?makeSortFunction("numeric","asc",c):makeSortFunction("numeric","desc",c));var e="e"+i;dynamicExp+="var "+e+" = "+s;dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { ";}var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; ";}dynamicExp+="return 0; ";dynamicExp+="}; ";if(table.config.debug){benchmark("Evaling expression:"+dynamicExp,new Date());}eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime);}return cache;};function makeSortFunction(type,direction,index){var a="a["+index+"]",b="b["+index+"]";if(type=='text'&&direction=='asc'){return"("+a+" == "+b+" ? 0 : ("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : ("+a+" < "+b+") ? -1 : 1 )));";}else if(type=='text'&&direction=='desc'){return"("+a+" == "+b+" ? 0 : ("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : ("+b+" < "+a+") ? -1 : 1 )));";}else if(type=='numeric'&&direction=='asc'){return"("+a+" === null && "+b+" === null) ? 0 :("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : "+a+" - "+b+"));";}else if(type=='numeric'&&direction=='desc'){return"("+a+" === null && "+b+" === null) ? 0 :("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : "+b+" - "+a+"));";}};function makeSortText(i){return"((a["+i+"] < b["+i+"]) ? -1 : ((a["+i+"] > b["+i+"]) ? 1 : 0));";};function makeSortTextDesc(i){return"((b["+i+"] < a["+i+"]) ? -1 : ((b["+i+"] > a["+i+"]) ? 1 : 0));";};function makeSortNumeric(i){return"a["+i+"]-b["+i+"];";};function makeSortNumericDesc(i){return"b["+i+"]-a["+i+"];";};function sortText(a,b){if(table.config.sortLocaleCompare)return a.localeCompare(b);return((a<b)?-1:((a>b)?1:0));};function sortTextDesc(a,b){if(table.config.sortLocaleCompare)return b.localeCompare(a);return((b<a)?-1:((b>a)?1:0));};function sortNumeric(a,b){return a-b;};function sortNumericDesc(a,b){return b-a;};function getCachedSortType(parsers,i){return parsers[i].type;};this.construct=function(settings){return this.each(function(){if(!this.tHead||!this.tBodies)return;var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$.extend(this.config,$.tablesorter.defaults,settings);$this=$(this);$.data(this,"tablesorter",config);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.click(function(e){var totalRows=($this[0].tBodies[0]&&$this[0].tBodies[0].rows.length)||0;if(!this.sortDisabled&&totalRows>0){$this.trigger("sortStart");var $cell=$(this);var i=this.column;this.order=this.count++%2;if(this.lockedOrder)this.order=this.lockedOrder;if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){if(a[j][0]!=i){config.sortList.push(a[j]);}}}config.sortList.push([i,this.order]);}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2;}}}else{config.sortList.push([i,this.order]);}};setTimeout(function(){setHeadersCss($this[0],$headers,config.sortList,sortCSS);appendToTable($this[0],multisort($this[0],config.sortList,cache));},1);return false;}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false;}});$this.bind("update",function(){var me=this;setTimeout(function(){me.config.parsers=buildParserCache(me,$headers);cache=buildCache(me);},1);}).bind("updateCell",function(e,cell){var config=this.config;var pos=[(cell.parentNode.rowIndex-1),cell.cellIndex];cache.normalized[pos[0]][pos[1]]=config.parsers[pos[1]].format(getElementText(config,cell),cell);}).bind("sorton",function(e,list){$(this).trigger("sortStart");config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache));}).bind("appendCache",function(){appendToTable(this,cache);}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this);}).bind("applyWidgets",function(){applyWidget(this);});if($.metadata&&($(this).metadata()&&$(this).metadata().sortlist)){config.sortList=$(this).metadata().sortlist;}if(config.sortList.length>0){$this.trigger("sorton",[config.sortList]);}applyWidget(this);});};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false;}}if(a){parsers.push(parser);};};this.addWidget=function(widget){widgets.push(widget);};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i;};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i;};this.isDigit=function(s,config){return/^[-+]?\d*$/.test($.trim(s.replace(/[,.']/g,'')));};this.clearTableBody=function(table){if($.browser.msie){function empty(){while(this.firstChild)this.removeChild(this.firstChild);}empty.apply(table.tBodies[0]);}else{table.tBodies[0].innerHTML="";}};}});$.fn.extend({tablesorter:$.tablesorter.construct});var ts=$.tablesorter;ts.addParser({id:"text",is:function(s){return true;},format:function(s){return $.trim(s.toLocaleLowerCase());},type:"text"});ts.addParser({id:"digit",is:function(s,table){var c=table.config;return $.tablesorter.isDigit(s,c);},format:function(s){return $.tablesorter.formatFloat(s);},type:"numeric"});ts.addParser({id:"currency",is:function(s){return/^[£$€?.]/.test(s);},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/[£$€]/g),""));},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s);},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item;}else{r+=item;}}return $.tablesorter.formatFloat(r);},type:"numeric"});ts.addParser({id:"url",is:function(s){return/^(https?|ftp|file):\/\/$/.test(s);},format:function(s){return jQuery.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),''));},type:"text"});ts.addParser({id:"isoDate",is:function(s){return/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s);},format:function(s){return $.tablesorter.formatFloat((s!="")?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0");},type:"numeric"});ts.addParser({id:"percent",is:function(s){return/\%$/.test($.trim(s));},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""));},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/));},format:function(s){return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(s);},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2");}else if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1");}else if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3");}return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"time",is:function(s){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s);},format:function(s){return $.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime());},type:"numeric"});ts.addParser({id:"metadata",is:function(s){return false;},format:function(s,table,cell){var c=table.config,p=(!c.parserMetadataName)?'sortValue':c.parserMetadataName;return $(cell).metadata()[p];},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date();}var $tr,row=-1,odd;$("tr:visible",table.tBodies[0]).each(function(i){$tr=$(this);if(!$tr.hasClass(table.config.cssChildRow))row++;odd=(row%2==0);$tr.removeClass(table.config.widgetZebra.css[odd?0:1]).addClass(table.config.widgetZebra.css[odd?1:0])});if(table.config.debug){$.tablesorter.benchmark("Applying Zebra widget",time);}}});})(jQuery);/*! jQuery UI - v1.9.2 - 2013-04-09
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.sortable.js, jquery.ui.slider.js
* Copyright 2013 jQuery Foundation and other contributors Licensed MIT */

(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=parseFloat(t[1],10)===6}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},contains:e.contains,hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})})(jQuery);(function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a=t.split(".")[0];t=t.split(".")[1],i=a+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[a]=e[a]||{},s=e[a][t],o=e[a][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,i){e.isFunction(i)&&(r[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},r=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=r,s=i.apply(this,arguments),this._super=t,this._superApply=n,s}}())}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},r,{constructor:o,namespace:a,widgetName:t,widgetBaseClass:i,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetName,this),e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&(e.effects.effect[u]||e.uiBackCompat!==!1&&e.effects[u])?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})})(jQuery);(function(e,t){var n=!1;e(document).mouseup(function(e){n=!1}),e.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}})})(jQuery);(function(e,t){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){t==="disabled"?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(t);var i=null,s=e(t.target).parents().each(function(){if(e.data(this,r.widgetName+"-item")==r)return i=e(this),!1});e.data(t.target,r.widgetName+"-item")==r&&(i=e(t.target));if(!i)return!1;if(this.options.handle&&!n){var o=!1;e(this.options.handle,i).find("*").andSelf().each(function(){this==t.target&&(o=!0)});if(!o)return!1}return this.currentItem=i,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,n,r){var i=this.options;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),i.containment&&this._setContainment(),i.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",i.cursor)),i.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",i.opacity)),i.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",i.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!r)for(var s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var n=this.options,r=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed)),t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var i=this.items.length-1;i>=0;i--){var s=this.items[i],o=s.item[0],u=this._intersectsWithPointer(s);if(!u)continue;if(s.instance!==this.currentContainer)continue;if(o!=this.currentItem[0]&&this.placeholder[u==1?"next":"prev"]()[0]!=o&&!e.contains(this.placeholder[0],o)&&(this.options.type=="semi-dynamic"?!e.contains(this.element[0],o):!0)){this.direction=u==1?"down":"up";if(this.options.tolerance!="pointer"&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(!t)return;e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t);if(this.options.revert){var r=this,i=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c=r+f>u&&r+f<a&&t+l>s&&t+l<o;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a},_intersectsWithPointer:function(t){var n=this.options.axis==="x"||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),r=this.options.axis==="y"||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&o=="right"||s=="down"?2:1:s&&(s=="down"?2:1):!1},_intersectsWithSides:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),r=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?s=="right"&&r||s=="left"&&!r:i&&(i=="down"&&n||i=="up"&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!=0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!=0&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n=[],r=[],i=this._connectWith();if(i&&t)for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);a&&a!=this&&!a.options.disabled&&r.push([e.isFunction(a.options.items)?a.options.items.call(a.element):e(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a])}}r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var s=r.length-1;s>=0;s--)r[s][0].each(function(){n.push(this)});return e(n)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++)if(t[n]==e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n=this.items,r=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],i=this._connectWith();if(i&&this.ready)for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);a&&a!=this&&!a.options.disabled&&(r.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a))}}for(var s=r.length-1;s>=0;s--){var f=r[s][1],l=r[s][0];for(var u=0,c=l.length;u<c;u++){var h=e(l[u]);h.data(this.widgetName+"-item",f),n.push({item:h,instance:f,width:0,height:0,left:0,top:0})}}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var n=this.items.length-1;n>=0;n--){var r=this.items[n];if(r.instance!=this.currentContainer&&this.currentContainer&&r.item[0]!=this.currentItem[0])continue;var i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item;t||(r.width=i.outerWidth(),r.height=i.outerHeight());var s=i.offset();r.left=s.left,r.top=s.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var n=this.containers.length-1;n>=0;n--){var s=this.containers[n].element.offset();this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight()}return this},_createPlaceholder:function(t){t=t||this;var n=t.options;if(!n.placeholder||n.placeholder.constructor==String){var r=n.placeholder;n.placeholder={element:function(){var n=e(document.createElement(t.currentItem[0].nodeName)).addClass(r||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return r||(n.style.visibility="hidden"),n},update:function(e,i){if(r&&!n.forcePlaceholderSize)return;i.height()||i.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),i.width()||i.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}}}t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),n.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var n=null,r=null;for(var i=this.containers.length-1;i>=0;i--){if(e.contains(this.currentItem[0],this.containers[i].element[0]))continue;if(this._intersectsWith(this.containers[i].containerCache)){if(n&&e.contains(this.containers[i].element[0],n.element[0]))continue;n=this.containers[i],r=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0)}if(!n)return;if(this.containers.length===1)this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1;else{var s=1e4,o=null,u=this.containers[r].floating?"left":"top",a=this.containers[r].floating?"width":"height",f=this.positionAbs[u]+this.offset.click[u];for(var l=this.items.length-1;l>=0;l--){if(!e.contains(this.containers[r].element[0],this.items[l].item[0]))continue;if(this.items[l].item[0]==this.currentItem[0])continue;var c=this.items[l].item.offset()[u],h=!1;Math.abs(c-f)>Math.abs(c+this.items[l][a]-f)&&(h=!0,c+=this.items[l][a]),Math.abs(c-f)<s&&(s=Math.abs(c-f),o=this.items[l],this.direction=h?"up":"down")}if(!o&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[r],o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[r].element,!0),this._trigger("change",t,this._uiHash()),this.containers[r]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper=="clone"?this.currentItem.clone():this.currentItem;return r.parents("body").length||e(n.appendTo!="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(r[0].style.width==""||n.forceHelperSize)&&r.width(this.currentItem.width()),(r[0].style.height==""||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)){var n=e(t.containment)[0],r=e(t.containment).offset(),i=e(n).css("overflow")!="hidden";this.containment=[r.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,r.left+(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var s=t.pageX,o=t.pageY;if(this.originalPosition){this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top));if(n.grid){var u=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1];o=this.containment?u-this.offset.click.top<this.containment[1]||u-this.offset.click.top>this.containment[3]?u-this.offset.click.top<this.containment[1]?u+n.grid[1]:u-n.grid[1]:u:u;var a=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0];s=this.containment?a-this.offset.click.left<this.containment[0]||a-this.offset.click.left>this.containment[2]?a-this.offset.click.left<this.containment[0]?a+n.grid[0]:a-n.grid[0]:a:a}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i==this.counter&&this.refreshPositions(!r)})},_clear:function(t,n){this.reverting=!1;var r=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS)if(this._storedCSS[i]=="auto"||this._storedCSS[i]=="static")this._storedCSS[i]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!n&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!n&&r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(n||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(var i=this.containers.length-1;i>=0;i--)n||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",t,this._uiHash());for(var i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}n||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!n){for(var i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})})(jQuery);(function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var t,r,i=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",u=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(i.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),i.range&&(i.range===!0&&(i.values||(i.values=[this._valueMin(),this._valueMin()]),i.values.length&&i.values.length!==2&&(i.values=[i.values[0],i.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(i.range==="min"||i.range==="max"?" ui-slider-range-"+i.range:""))),r=i.values&&i.values.length||1;for(t=s.length;t<r;t++)u.push(o);this.handles=s.add(e(u.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){i.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){i.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._on(this.handles,{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);if(r===!1)return}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));i>n&&(i=n,s=e(this),o=t)}),c.range===!0&&this.values(1)===c.min&&(o+=1,s=e(this.handles[o])),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))}})})(jQuery);/*!
 * jsUri
 * https://github.com/derek-watson/jsUri
 *
 * Copyright 2012, Derek Watson
 * Released under the MIT license.
 *
 * Includes parseUri regular expressions
 * http://blog.stevenlevithan.com/archives/parseuri
 * Copyright 2007, Steven Levithan
 * Released under the MIT license.
 *
 */(function(e){function t(e){return e=decodeURIComponent(e),e=e.replace("+"," "),e}function n(e){var t=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],r=t.exec(e||""),i={};return n.forEach(function(e,t){i[e]=r[t]||""}),i}function r(e){var t,n,r,i,s,o,u=[];if(typeof e=="undefined"||e===null||e==="")return u;e.indexOf("?")===0&&(e=e.substring(1)),n=e.toString().split(/[&;]/);for(t=0;t<n.length;t++)r=n[t],i=r.split("="),s=i[0],o=r.indexOf("=")===-1?null:i[1]===null?"":i[1],u.push([s,o]);return u}function i(e){this.uriParts=n(e),this.queryPairs=r(this.uriParts.query),this.hasAuthorityPrefixUserPref=null}Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;n<r;++n)e.call(t||this,this[n],n,this)}),["protocol","userInfo","host","port","path","anchor"].forEach(function(e){i.prototype[e]=function(t){return typeof t!="undefined"&&(this.uriParts[e]=t),this.uriParts[e]}}),i.prototype.hasAuthorityPrefix=function(e){return typeof e!="undefined"&&(this.hasAuthorityPrefixUserPref=e),this.hasAuthorityPrefixUserPref===null?this.uriParts.source.indexOf("//")!==-1:this.hasAuthorityPrefixUserPref},i.prototype.query=function(e){var t="",n,i;typeof e!="undefined"&&(this.queryPairs=r(e));for(n=0;n<this.queryPairs.length;n++)i=this.queryPairs[n],t.length>0&&(t+="&"),i[1]===null?t+=i[0]:(t+=i[0],t+="=",i[1]&&(t+=encodeURIComponent(i[1])));return t.length>0?"?"+t:t},i.prototype.getQueryParamValue=function(e){var n,r;for(r=0;r<this.queryPairs.length;r++){n=this.queryPairs[r];if(t(e)===t(n[0]))return n[1]}},i.prototype.getQueryParamValues=function(e){var n=[],r,i;for(r=0;r<this.queryPairs.length;r++)i=this.queryPairs[r],t(e)===t(i[0])&&n.push(i[1]);return n},i.prototype.deleteQueryParam=function(e,n){var r=[],i,s,o,u;for(i=0;i<this.queryPairs.length;i++)s=this.queryPairs[i],o=t(s[0])===t(e),u=t(s[1])===t(n),(arguments.length===1&&!o||arguments.length===2&&!o&&!u)&&r.push(s);return this.queryPairs=r,this},i.prototype.addQueryParam=function(e,t,n){return arguments.length===3&&n!==-1?(n=Math.min(n,this.queryPairs.length),this.queryPairs.splice(n,0,[e,t])):arguments.length>0&&this.queryPairs.push([e,t]),this},i.prototype.replaceQueryParam=function(e,n,r){var i=-1,s,o;if(arguments.length===3){for(s=0;s<this.queryPairs.length;s++){o=this.queryPairs[s];if(t(o[0])===t(e)&&decodeURIComponent(o[1])===t(r)){i=s;break}}this.deleteQueryParam(e,r).addQueryParam(e,n,i)}else{for(s=0;s<this.queryPairs.length;s++){o=this.queryPairs[s];if(t(o[0])===t(e)){i=s;break}}this.deleteQueryParam(e),this.addQueryParam(e,n,i)}return this},["protocol","hasAuthorityPrefix","userInfo","host","port","path","query","anchor"].forEach(function(e){var t="set"+e.charAt(0).toUpperCase()+e.slice(1);i.prototype[t]=function(t){return this[e](t),this}}),i.prototype.scheme=function(){var e="";return this.protocol()?(e+=this.protocol(),this.protocol().indexOf(":")!==this.protocol().length-1&&(e+=":"),e+="//"):this.hasAuthorityPrefix()&&this.host()&&(e+="//"),e},i.prototype.origin=function(){var e=this.scheme();return this.userInfo()&&this.host()&&(e+=this.userInfo(),this.userInfo().indexOf("@")!==this.userInfo().length-1&&(e+="@")),this.host()&&(e+=this.host(),this.port()&&(e+=":"+this.port())),e},i.prototype.toString=function(){var e=this.origin();return this.path()?e+=this.path():this.host()&&(this.query().toString()||this.anchor())&&(e+="/"),this.query().toString()&&(this.query().toString().indexOf("?")!==0&&(e+="?"),e+=this.query().toString()),this.anchor()&&(this.anchor().indexOf("#")!==0&&(e+="#"),e+=this.anchor()),e},i.prototype.clone=function(){return new i(this.toString())},typeof module=="undefined"?e.Uri=i:module.exports=i})(this);(function(){var times={year:315576E5,month:26298E5,week:6048E5,day:864E5,hour:36E5,minute:6E4},defaults={past:"just now",future:"soon"},formats={past:formatPast,future:formatFuture};if(typeof exports==="undefined"||exports===null)window.vagueTime={get:getVagueTime};else exports.get=getVagueTime;function getVagueTime(options){var units=normaliseUnits(options.units),now=Date.now(),from=normaliseTime(options.from,units,now),to=normaliseTime(options.to,units,now),difference=from-to,type;if(difference>
0)type="past";else{type="future";difference=-difference}return estimate(difference,type)}function normaliseUnits(units){if(typeof units==="undefined")return"ms";if(units==="s"||units==="ms")return units;throw new Error("Invalid units");}function normaliseTime(time,units,defaultTime){if(typeof time==="undefined")return defaultTime;if(typeof time==="string")time=parseInt(time,10);if(isNotDate(time)&&isNotTimestamp(time))throw new Error("Invalid time");if(typeof time==="number"&&units==="s")time*=1E3;
return time}function isNotDate(date){return Object.prototype.toString.call(date)!=="[object Date]"||isNaN(date.getTime())}function isNotTimestamp(timestamp){return typeof timestamp!=="number"||isNaN(timestamp)}function estimate(difference,type){var time,vagueTime;for(time in times)if(times.hasOwnProperty(time)&&difference>=times[time]){vagueTime=Math.floor(difference/times[time]);return formats[type](vagueTime,pluraliseNoun(time,vagueTime))}return defaults[type]}function pluraliseNoun(noun,amount){return noun+
(amount>1?"s":"")}function formatPast(vagueTime,unit){return vagueTime+" "+unit+" ago"}function formatFuture(vagueTime,unit){return"in "+vagueTime+" "+unit}})();
/*! jQuery Validation Plugin - v1.11.0 - 2/4/2013
* https://github.com/jzaefferer/jquery-validation
* Copyright (c) 2013 Jörn Zaefferer; Licensed MIT */
(function(e){e.extend(e.fn,{validate:function(t){if(!this.length){t&&t.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing.");return}var n=e.data(this[0],"validator");return n?n:(this.attr("novalidate","novalidate"),n=new e.validator(t,this[0]),e.data(this[0],"validator",n),n.settings.onsubmit&&(this.validateDelegate(":submit","click",function(t){n.settings.submitHandler&&(n.submitButton=t.target),e(t.target).hasClass("cancel")&&(n.cancelSubmit=!0)}),this.submit(function(t){function r(){var r;return n.settings.submitHandler?(n.submitButton&&(r=e("<input type='hidden'/>").attr("name",n.submitButton.name).val(n.submitButton.value).appendTo(n.currentForm)),n.settings.submitHandler.call(n,n.currentForm,t),n.submitButton&&r.remove(),!1):!0}return n.settings.debug&&t.preventDefault(),n.cancelSubmit?(n.cancelSubmit=!1,r()):n.form()?n.pendingRequest?(n.formSubmitted=!0,!1):r():(n.focusInvalid(),!1)})),n)},valid:function(){if(e(this[0]).is("form"))return this.validate().form();var t=!0,n=e(this[0].form).validate();return this.each(function(){t&=n.element(this)}),t},removeAttrs:function(t){var n={},r=this;return e.each(t.split(/\s/),function(e,t){n[t]=r.attr(t),r.removeAttr(t)}),n},rules:function(t,n){var r=this[0];if(t){var i=e.data(r.form,"validator").settings,s=i.rules,o=e.validator.staticRules(r);switch(t){case"add":e.extend(o,e.validator.normalizeRule(n)),s[r.name]=o,n.messages&&(i.messages[r.name]=e.extend(i.messages[r.name],n.messages));break;case"remove":if(!n)return delete s[r.name],o;var u={};return e.each(n.split(/\s/),function(e,t){u[t]=o[t],delete o[t]}),u}}var a=e.validator.normalizeRules(e.extend({},e.validator.classRules(r),e.validator.attributeRules(r),e.validator.dataRules(r),e.validator.staticRules(r)),r);if(a.required){var f=a.required;delete a.required,a=e.extend({required:f},a)}return a}}),e.extend(e.expr[":"],{blank:function(t){return!e.trim(""+t.value)},filled:function(t){return!!e.trim(""+t.value)},unchecked:function(e){return!e.checked}}),e.validator=function(t,n){this.settings=e.extend(!0,{},e.validator.defaults,t),this.currentForm=n,this.init()},e.validator.format=function(t,n){return arguments.length===1?function(){var n=e.makeArray(arguments);return n.unshift(t),e.validator.format.apply(this,n)}:(arguments.length>2&&n.constructor!==Array&&(n=e.makeArray(arguments).slice(1)),n.constructor!==Array&&(n=[n]),e.each(n,function(e,n){t=t.replace(new RegExp("\\{"+e+"\\}","g"),function(){return n})}),t)},e.extend(e.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:e([]),errorLabelContainer:e([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(e,t){this.lastActive=e,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,e,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(e)).hide())},onfocusout:function(e,t){!this.checkable(e)&&(e.name in this.submitted||!this.optional(e))&&this.element(e)},onkeyup:function(e,t){if(t.which===9&&this.elementValue(e)==="")return;(e.name in this.submitted||e===this.lastElement)&&this.element(e)},onclick:function(e,t){e.name in this.submitted?this.element(e):e.parentNode.name in this.submitted&&this.element(e.parentNode)},highlight:function(t,n,r){t.type==="radio"?this.findByName(t.name).addClass(n).removeClass(r):e(t).addClass(n).removeClass(r)},unhighlight:function(t,n,r){t.type==="radio"?this.findByName(t.name).removeClass(n).addClass(r):e(t).removeClass(n).addClass(r)}},setDefaults:function(t){e.extend(e.validator.defaults,t)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:e.validator.format("Please enter no more than {0} characters."),minlength:e.validator.format("Please enter at least {0} characters."),rangelength:e.validator.format("Please enter a value between {0} and {1} characters long."),range:e.validator.format("Please enter a value between {0} and {1}."),max:e.validator.format("Please enter a value less than or equal to {0}."),min:e.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function r(t){var n=e.data(this[0].form,"validator"),r="on"+t.type.replace(/^validate/,"");n.settings[r]&&n.settings[r].call(n,this[0],t)}this.labelContainer=e(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||e(this.currentForm),this.containers=e(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var t=this.groups={};e.each(this.settings.groups,function(n,r){typeof r=="string"&&(r=r.split(/\s/)),e.each(r,function(e,r){t[r]=n})});var n=this.settings.rules;e.each(n,function(t,r){n[t]=e.validator.normalizeRule(r)}),e(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",r).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",r),this.settings.invalidHandler&&e(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),e.extend(this.submitted,this.errorMap),this.invalid=e.extend({},this.errorMap),this.valid()||e(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var e=0,t=this.currentElements=this.elements();t[e];e++)this.check(t[e]);return this.valid()},element:function(t){t=this.validationTargetFor(this.clean(t)),this.lastElement=t,this.prepareElement(t),this.currentElements=e(t);var n=this.check(t)!==!1;return n?delete this.invalid[t.name]:this.invalid[t.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),n},showErrors:function(t){if(t){e.extend(this.errorMap,t),this.errorList=[];for(var n in t)this.errorList.push({message:t[n],element:this.findByName(n)[0]});this.successList=e.grep(this.successList,function(e){return!(e.name in t)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){e.fn.resetForm&&e(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(e){var t=0;for(var n in e)t++;return t},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()===0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{e(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(t){}},findLastActive:function(){var t=this.lastActive;return t&&e.grep(this.errorList,function(e){return e.element.name===t.name}).length===1&&t},elements:function(){var t=this,n={};return e(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&t.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in n||!t.objectLength(e(this).rules())?!1:(n[this.name]=!0,!0)})},clean:function(t){return e(t)[0]},errors:function(){var t=this.settings.errorClass.replace(" ",".");return e(this.settings.errorElement+"."+t,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=e([]),this.toHide=e([]),this.currentElements=e([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(e){this.reset(),this.toHide=this.errorsFor(e)},elementValue:function(t){var n=e(t).attr("type"),r=e(t).val();return n==="radio"||n==="checkbox"?e("input[name='"+e(t).attr("name")+"']:checked").val():typeof r=="string"?r.replace(/\r/g,""):r},check:function(t){t=this.validationTargetFor(this.clean(t));var n=e(t).rules(),r=!1,i=this.elementValue(t),s;for(var o in n){var u={method:o,parameters:n[o]};try{s=e.validator.methods[o].call(this,i,t,u.parameters);if(s==="dependency-mismatch"){r=!0;continue}r=!1;if(s==="pending"){this.toHide=this.toHide.not(this.errorsFor(t));return}if(!s)return this.formatAndAdd(t,u),!1}catch(a){throw this.settings.debug&&window.console&&console.log("Exception occured when checking element "+t.id+", check the '"+u.method+"' method.",a),a}}if(r)return;return this.objectLength(n)&&this.successList.push(t),!0},customDataMessage:function(t,n){return e(t).data("msg-"+n.toLowerCase())||t.attributes&&e(t).attr("data-msg-"+n.toLowerCase())},customMessage:function(e,t){var n=this.settings.messages[e];return n&&(n.constructor===String?n:n[t])},findDefined:function(){for(var e=0;e<arguments.length;e++)if(arguments[e]!==undefined)return arguments[e];return undefined},defaultMessage:function(t,n){return this.findDefined(this.customMessage(t.name,n),this.customDataMessage(t,n),!this.settings.ignoreTitle&&t.title||undefined,e.validator.messages[n],"<strong>Warning: No message defined for "+t.name+"</strong>")},formatAndAdd:function(t,n){var r=this.defaultMessage(t,n.method),i=/\$?\{(\d+)\}/g;typeof r=="function"?r=r.call(this,n.parameters,t):i.test(r)&&(r=e.validator.format(r.replace(i,"{$1}"),n.parameters)),this.errorList.push({message:r,element:t}),this.errorMap[t.name]=r,this.submitted[t.name]=r},addWrapper:function(e){return this.settings.wrapper&&(e=e.add(e.parent(this.settings.wrapper))),e},defaultShowErrors:function(){var e,t;for(e=0;this.errorList[e];e++){var n=this.errorList[e];this.settings.highlight&&this.settings.highlight.call(this,n.element,this.settings.errorClass,this.settings.validClass),this.showLabel(n.element,n.message)}this.errorList.length&&(this.toShow=this.toShow.add(this.containers));if(this.settings.success)for(e=0;this.successList[e];e++)this.showLabel(this.successList[e]);if(this.settings.unhighlight)for(e=0,t=this.validElements();t[e];e++)this.settings.unhighlight.call(this,t[e],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return e(this.errorList).map(function(){return this.element})},showLabel:function(t,n){var r=this.errorsFor(t);r.length?(r.removeClass(this.settings.validClass).addClass(this.settings.errorClass),r.html(n)):(r=e("<"+this.settings.errorElement+">").attr("for",this.idOrName(t)).addClass(this.settings.errorClass).html(n||""),this.settings.wrapper&&(r=r.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(r).length||(this.settings.errorPlacement?this.settings.errorPlacement(r,e(t)):r.insertAfter(t))),!n&&this.settings.success&&(r.text(""),typeof this.settings.success=="string"?r.addClass(this.settings.success):this.settings.success(r,t)),this.toShow=this.toShow.add(r)},errorsFor:function(t){var n=this.idOrName(t);return this.errors().filter(function(){return e(this).attr("for")===n})},idOrName:function(e){return this.groups[e.name]||(this.checkable(e)?e.name:e.id||e.name)},validationTargetFor:function(e){return this.checkable(e)&&(e=this.findByName(e.name).not(this.settings.ignore)[0]),e},checkable:function(e){return/radio|checkbox/i.test(e.type)},findByName:function(t){return e(this.currentForm).find("[name='"+t+"']")},getLength:function(t,n){switch(n.nodeName.toLowerCase()){case"select":return e("option:selected",n).length;case"input":if(this.checkable(n))return this.findByName(n.name).filter(":checked").length}return t.length},depend:function(e,t){return this.dependTypes[typeof e]?this.dependTypes[typeof e](e,t):!0},dependTypes:{"boolean":function(e,t){return e},string:function(t,n){return!!e(t,n.form).length},"function":function(e,t){return e(t)}},optional:function(t){var n=this.elementValue(t);return!e.validator.methods.required.call(this,n,t)&&"dependency-mismatch"},startRequest:function(e){this.pending[e.name]||(this.pendingRequest++,this.pending[e.name]=!0)},stopRequest:function(t,n){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[t.name],n&&this.pendingRequest===0&&this.formSubmitted&&this.form()?(e(this.currentForm).submit(),this.formSubmitted=!1):!n&&this.pendingRequest===0&&this.formSubmitted&&(e(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(t){return e.data(t,"previousValue")||e.data(t,"previousValue",{old:null,valid:!0,message:this.defaultMessage(t,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(t,n){t.constructor===String?this.classRuleSettings[t]=n:e.extend(this.classRuleSettings,t)},classRules:function(t){var n={},r=e(t).attr("class");return r&&e.each(r.split(" "),function(){this in e.validator.classRuleSettings&&e.extend(n,e.validator.classRuleSettings[this])}),n},attributeRules:function(t){var n={},r=e(t);for(var i in e.validator.methods){var s;i==="required"?(s=r.get(0).getAttribute(i),s===""&&(s=!0),s=!!s):s=r.attr(i),s?n[i]=s:r[0].getAttribute("type")===i&&(n[i]=!0)}return n.maxlength&&/-1|2147483647|524288/.test(n.maxlength)&&delete n.maxlength,n},dataRules:function(t){var n,r,i={},s=e(t);for(n in e.validator.methods)r=s.data("rule-"+n.toLowerCase()),r!==undefined&&(i[n]=r);return i},staticRules:function(t){var n={},r=e.data(t.form,"validator");return r.settings.rules&&(n=e.validator.normalizeRule(r.settings.rules[t.name])||{}),n},normalizeRules:function(t,n){return e.each(t,function(r,i){if(i===!1){delete t[r];return}if(i.param||i.depends){var s=!0;switch(typeof i.depends){case"string":s=!!e(i.depends,n.form).length;break;case"function":s=i.depends.call(n,n)}s?t[r]=i.param!==undefined?i.param:!0:delete t[r]}}),e.each(t,function(r,i){t[r]=e.isFunction(i)?i(n):i}),e.each(["minlength","maxlength"],function(){t[this]&&(t[this]=Number(t[this]))}),e.each(["rangelength"],function(){var n;t[this]&&(e.isArray(t[this])?t[this]=[Number(t[this][0]),Number(t[this][1])]:typeof t[this]=="string"&&(n=t[this].split(/[\s,]+/),t[this]=[Number(n[0]),Number(n[1])]))}),e.validator.autoCreateRanges&&(t.min&&t.max&&(t.range=[t.min,t.max],delete t.min,delete t.max),t.minlength&&t.maxlength&&(t.rangelength=[t.minlength,t.maxlength],delete t.minlength,delete t.maxlength)),t},normalizeRule:function(t){if(typeof t=="string"){var n={};e.each(t.split(/\s/),function(){n[this]=!0}),t=n}return t},addMethod:function(t,n,r){e.validator.methods[t]=n,e.validator.messages[t]=r!==undefined?r:e.validator.messages[t],n.length<3&&e.validator.addClassRules(t,e.validator.normalizeRule(t))},methods:{required:function(t,n,r){if(!this.depend(r,n))return"dependency-mismatch";if(n.nodeName.toLowerCase()==="select"){var i=e(n).val();return i&&i.length>0}return this.checkable(n)?this.getLength(t,n)>0:e.trim(t).length>0},remote:function(t,n,r){if(this.optional(n))return"dependency-mismatch";var i=this.previousValue(n);this.settings.messages[n.name]||(this.settings.messages[n.name]={}),i.originalMessage=this.settings.messages[n.name].remote,this.settings.messages[n.name].remote=i.message,r=typeof r=="string"&&{url:r}||r;if(i.old===t)return i.valid;i.old=t;var s=this;this.startRequest(n);var o={};return o[n.name]=t,e.ajax(e.extend(!0,{url:r,mode:"abort",port:"validate"+n.name,dataType:"json",data:o,success:function(r){s.settings.messages[n.name].remote=i.originalMessage;var o=r===!0||r==="true";if(o){var u=s.formSubmitted;s.prepareElement(n),s.formSubmitted=u,s.successList.push(n),delete s.invalid[n.name],s.showErrors()}else{var a={},f=r||s.defaultMessage(n,"remote");a[n.name]=i.message=e.isFunction(f)?f(t):f,s.invalid[n.name]=!0,s.showErrors(a)}i.valid=o,s.stopRequest(n,o)}},r)),"pending"},minlength:function(t,n,r){var i=e.isArray(t)?t.length:this.getLength(e.trim(t),n);return this.optional(n)||i>=r},maxlength:function(t,n,r){var i=e.isArray(t)?t.length:this.getLength(e.trim(t),n);return this.optional(n)||i<=r},rangelength:function(t,n,r){var i=e.isArray(t)?t.length:this.getLength(e.trim(t),n);return this.optional(n)||i>=r[0]&&i<=r[1]},min:function(e,t,n){return this.optional(t)||e>=n},max:function(e,t,n){return this.optional(t)||e<=n},range:function(e,t,n){return this.optional(t)||e>=n[0]&&e<=n[1]},email:function(e,t){return this.optional(t)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e)},url:function(e,t){return this.optional(t)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},date:function(e,t){return this.optional(t)||!/Invalid|NaN/.test((new Date(e)).toString())},dateISO:function(e,t){return this.optional(t)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(e)},number:function(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)},digits:function(e,t){return this.optional(t)||/^\d+$/.test(e)},creditcard:function(e,t){if(this.optional(t))return"dependency-mismatch";if(/[^0-9 \-]+/.test(e))return!1;var n=0,r=0,i=!1;e=e.replace(/\D/g,"");for(var s=e.length-1;s>=0;s--){var o=e.charAt(s);r=parseInt(o,10),i&&(r*=2)>9&&(r-=9),n+=r,i=!i}return n%10===0},equalTo:function(t,n,r){var i=e(r);return this.settings.onfocusout&&i.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){e(n).valid()}),t===i.val()}}}),e.format=e.validator.format})(jQuery),function(e){var t={};if(e.ajaxPrefilter)e.ajaxPrefilter(function(e,n,r){var i=e.port;e.mode==="abort"&&(t[i]&&t[i].abort(),t[i]=r)});else{var n=e.ajax;e.ajax=function(r){var i=("mode"in r?r:e.ajaxSettings).mode,s=("port"in r?r:e.ajaxSettings).port;return i==="abort"?(t[s]&&t[s].abort(),t[s]=n.apply(this,arguments)):n.apply(this,arguments)}}}(jQuery),function(e){e.extend(e.fn,{validateDelegate:function(t,n,r){return this.bind(n,function(n){var i=e(n.target);if(i.is(t))return r.apply(i,arguments)})}})}(jQuery);/*!
* ZeroClipboard
* The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
* Copyright (c) 2014 Jon Rohan, James M. Greene
* Licensed MIT
* http://zeroclipboard.org/
* v1.3.5
*/
!function(a){"use strict";function b(a){return a.replace(/,/g,".").replace(/[^0-9\.]/g,"")}function c(a){return parseFloat(b(a))>=10}var d,e={bridge:null,version:"0.0.0",disabled:null,outdated:null,ready:null},f={},g=0,h={},i=0,j={},k=null,l=null,m=function(){var a,b,c,d,e="ZeroClipboard.swf";if(document.currentScript&&(d=document.currentScript.src));else{var f=document.getElementsByTagName("script");if("readyState"in f[0])for(a=f.length;a--&&("interactive"!==f[a].readyState||!(d=f[a].src)););else if("loading"===document.readyState)d=f[f.length-1].src;else{for(a=f.length;a--;){if(c=f[a].src,!c){b=null;break}if(c=c.split("#")[0].split("?")[0],c=c.slice(0,c.lastIndexOf("/")+1),null==b)b=c;else if(b!==c){b=null;break}}null!==b&&(d=b)}}return d&&(d=d.split("#")[0].split("?")[0],e=d.slice(0,d.lastIndexOf("/")+1)+e),e}(),n=function(){var a=/\-([a-z])/g,b=function(a,b){return b.toUpperCase()};return function(c){return c.replace(a,b)}}(),o=function(b,c){var d,e,f;return a.getComputedStyle?d=a.getComputedStyle(b,null).getPropertyValue(c):(e=n(c),d=b.currentStyle?b.currentStyle[e]:b.style[e]),"cursor"!==c||d&&"auto"!==d||(f=b.tagName.toLowerCase(),"a"!==f)?d:"pointer"},p=function(b){b||(b=a.event);var c;this!==a?c=this:b.target?c=b.target:b.srcElement&&(c=b.srcElement),K.activate(c)},q=function(a,b,c){a&&1===a.nodeType&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c))},r=function(a,b,c){a&&1===a.nodeType&&(a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c))},s=function(a,b){if(!a||1!==a.nodeType)return a;if(a.classList)return a.classList.contains(b)||a.classList.add(b),a;if(b&&"string"==typeof b){var c=(b||"").split(/\s+/);if(1===a.nodeType)if(a.className){for(var d=" "+a.className+" ",e=a.className,f=0,g=c.length;g>f;f++)d.indexOf(" "+c[f]+" ")<0&&(e+=" "+c[f]);a.className=e.replace(/^\s+|\s+$/g,"")}else a.className=b}return a},t=function(a,b){if(!a||1!==a.nodeType)return a;if(a.classList)return a.classList.contains(b)&&a.classList.remove(b),a;if(b&&"string"==typeof b||void 0===b){var c=(b||"").split(/\s+/);if(1===a.nodeType&&a.className)if(b){for(var d=(" "+a.className+" ").replace(/[\n\t]/g," "),e=0,f=c.length;f>e;e++)d=d.replace(" "+c[e]+" "," ");a.className=d.replace(/^\s+|\s+$/g,"")}else a.className=""}return a},u=function(){var a,b,c,d=1;return"function"==typeof document.body.getBoundingClientRect&&(a=document.body.getBoundingClientRect(),b=a.right-a.left,c=document.body.offsetWidth,d=Math.round(b/c*100)/100),d},v=function(b,c){var d={left:0,top:0,width:0,height:0,zIndex:B(c)-1};if(b.getBoundingClientRect){var e,f,g,h=b.getBoundingClientRect();"pageXOffset"in a&&"pageYOffset"in a?(e=a.pageXOffset,f=a.pageYOffset):(g=u(),e=Math.round(document.documentElement.scrollLeft/g),f=Math.round(document.documentElement.scrollTop/g));var i=document.documentElement.clientLeft||0,j=document.documentElement.clientTop||0;d.left=h.left+e-i,d.top=h.top+f-j,d.width="width"in h?h.width:h.right-h.left,d.height="height"in h?h.height:h.bottom-h.top}return d},w=function(a,b){var c=null==b||b&&b.cacheBust===!0&&b.useNoCache===!0;return c?(-1===a.indexOf("?")?"?":"&")+"noCache="+(new Date).getTime():""},x=function(b){var c,d,e,f=[],g=[],h=[];if(b.trustedOrigins&&("string"==typeof b.trustedOrigins?g.push(b.trustedOrigins):"object"==typeof b.trustedOrigins&&"length"in b.trustedOrigins&&(g=g.concat(b.trustedOrigins))),b.trustedDomains&&("string"==typeof b.trustedDomains?g.push(b.trustedDomains):"object"==typeof b.trustedDomains&&"length"in b.trustedDomains&&(g=g.concat(b.trustedDomains))),g.length)for(c=0,d=g.length;d>c;c++)if(g.hasOwnProperty(c)&&g[c]&&"string"==typeof g[c]){if(e=E(g[c]),!e)continue;if("*"===e){h=[e];break}h.push.apply(h,[e,"//"+e,a.location.protocol+"//"+e])}return h.length&&f.push("trustedOrigins="+encodeURIComponent(h.join(","))),"string"==typeof b.jsModuleId&&b.jsModuleId&&f.push("jsModuleId="+encodeURIComponent(b.jsModuleId)),f.join("&")},y=function(a,b,c){if("function"==typeof b.indexOf)return b.indexOf(a,c);var d,e=b.length;for("undefined"==typeof c?c=0:0>c&&(c=e+c),d=c;e>d;d++)if(b.hasOwnProperty(d)&&b[d]===a)return d;return-1},z=function(a){if("string"==typeof a)throw new TypeError("ZeroClipboard doesn't accept query strings.");return a.length?a:[a]},A=function(b,c,d,e){e?a.setTimeout(function(){b.apply(c,d)},0):b.apply(c,d)},B=function(a){var b,c;return a&&("number"==typeof a&&a>0?b=a:"string"==typeof a&&(c=parseInt(a,10))&&!isNaN(c)&&c>0&&(b=c)),b||("number"==typeof N.zIndex&&N.zIndex>0?b=N.zIndex:"string"==typeof N.zIndex&&(c=parseInt(N.zIndex,10))&&!isNaN(c)&&c>0&&(b=c)),b||0},C=function(a,b){if(a&&b!==!1&&"undefined"!=typeof console&&console&&(console.warn||console.log)){var c="`"+a+"` is deprecated. See docs for more info:\n    https://github.com/zeroclipboard/zeroclipboard/blob/master/docs/instructions.md#deprecations";console.warn?console.warn(c):console.log(c)}},D=function(){var a,b,c,d,e,f,g=arguments[0]||{};for(a=1,b=arguments.length;b>a;a++)if(null!=(c=arguments[a]))for(d in c)if(c.hasOwnProperty(d)){if(e=g[d],f=c[d],g===f)continue;void 0!==f&&(g[d]=f)}return g},E=function(a){if(null==a||""===a)return null;if(a=a.replace(/^\s+|\s+$/g,""),""===a)return null;var b=a.indexOf("//");a=-1===b?a:a.slice(b+2);var c=a.indexOf("/");return a=-1===c?a:-1===b||0===c?null:a.slice(0,c),a&&".swf"===a.slice(-4).toLowerCase()?null:a||null},F=function(){var a=function(a,b){var c,d,e;if(null!=a&&"*"!==b[0]&&("string"==typeof a&&(a=[a]),"object"==typeof a&&"length"in a))for(c=0,d=a.length;d>c;c++)if(a.hasOwnProperty(c)&&(e=E(a[c]))){if("*"===e){b.length=0,b.push("*");break}-1===y(e,b)&&b.push(e)}},b={always:"always",samedomain:"sameDomain",never:"never"};return function(c,d){var e,f=d.allowScriptAccess;if("string"==typeof f&&(e=f.toLowerCase())&&/^always|samedomain|never$/.test(e))return b[e];var g=E(d.moviePath);null===g&&(g=c);var h=[];a(d.trustedOrigins,h),a(d.trustedDomains,h);var i=h.length;if(i>0){if(1===i&&"*"===h[0])return"always";if(-1!==y(c,h))return 1===i&&c===g?"sameDomain":"always"}return"never"}}(),G=function(a){if(null==a)return[];if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},H=function(a){if(a)for(var b in a)a.hasOwnProperty(b)&&delete a[b];return a},I=function(){try{return document.activeElement}catch(a){}return null},J=function(){var a=!1;if("boolean"==typeof e.disabled)a=e.disabled===!1;else{if("function"==typeof ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(a=!0)}catch(b){}!a&&navigator.mimeTypes["application/x-shockwave-flash"]&&(a=!0)}return a},K=function(a,b){return this instanceof K?(this.id=""+g++,h[this.id]={instance:this,elements:[],handlers:{}},a&&this.clip(a),"undefined"!=typeof b&&(C("new ZeroClipboard(elements, options)",N.debug),K.config(b)),this.options=K.config(),"boolean"!=typeof e.disabled&&(e.disabled=!J()),e.disabled===!1&&e.outdated!==!0&&null===e.bridge&&(e.outdated=!1,e.ready=!1,O()),void 0):new K(a,b)};K.prototype.setText=function(a){return a&&""!==a&&(f["text/plain"]=a,e.ready===!0&&e.bridge&&"function"==typeof e.bridge.setText?e.bridge.setText(a):e.ready=!1),this},K.prototype.setSize=function(a,b){return e.ready===!0&&e.bridge&&"function"==typeof e.bridge.setSize?e.bridge.setSize(a,b):e.ready=!1,this};var L=function(a){e.ready===!0&&e.bridge&&"function"==typeof e.bridge.setHandCursor?e.bridge.setHandCursor(a):e.ready=!1};K.prototype.destroy=function(){this.unclip(),this.off(),delete h[this.id]};var M=function(){var a,b,c,d=[],e=G(h);for(a=0,b=e.length;b>a;a++)c=h[e[a]].instance,c&&c instanceof K&&d.push(c);return d};K.version="1.3.5";var N={swfPath:m,trustedDomains:a.location.host?[a.location.host]:[],cacheBust:!0,forceHandCursor:!1,zIndex:999999999,debug:!0,title:null,autoActivate:!0};K.config=function(a){"object"==typeof a&&null!==a&&D(N,a);{if("string"!=typeof a||!a){var b={};for(var c in N)N.hasOwnProperty(c)&&(b[c]="object"==typeof N[c]&&null!==N[c]?"length"in N[c]?N[c].slice(0):D({},N[c]):N[c]);return b}if(N.hasOwnProperty(a))return N[a]}},K.destroy=function(){K.deactivate();for(var a in h)if(h.hasOwnProperty(a)&&h[a]){var b=h[a].instance;b&&"function"==typeof b.destroy&&b.destroy()}var c=P(e.bridge);c&&c.parentNode&&(c.parentNode.removeChild(c),e.ready=null,e.bridge=null)},K.activate=function(a){d&&(t(d,N.hoverClass),t(d,N.activeClass)),d=a,s(a,N.hoverClass),Q();var b=N.title||a.getAttribute("title");if(b){var c=P(e.bridge);c&&c.setAttribute("title",b)}var f=N.forceHandCursor===!0||"pointer"===o(a,"cursor");L(f)},K.deactivate=function(){var a=P(e.bridge);a&&(a.style.left="0px",a.style.top="-9999px",a.removeAttribute("title")),d&&(t(d,N.hoverClass),t(d,N.activeClass),d=null)};var O=function(){var b,c,d=document.getElementById("global-zeroclipboard-html-bridge");if(!d){var f=K.config();f.jsModuleId="string"==typeof k&&k||"string"==typeof l&&l||null;var g=F(a.location.host,N),h=x(f),i=N.moviePath+w(N.moviePath,N),j='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+i+'"/>         <param name="allowScriptAccess" value="'+g+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+h+'"/>         <embed src="'+i+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="'+g+'"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+h+'"           scale="exactfit">         </embed>       </object>';d=document.createElement("div"),d.id="global-zeroclipboard-html-bridge",d.setAttribute("class","global-zeroclipboard-container"),d.style.position="absolute",d.style.left="0px",d.style.top="-9999px",d.style.width="15px",d.style.height="15px",d.style.zIndex=""+B(N.zIndex),document.body.appendChild(d),d.innerHTML=j}b=document["global-zeroclipboard-flash-bridge"],b&&(c=b.length)&&(b=b[c-1]),e.bridge=b||d.children[0].lastElementChild},P=function(a){for(var b=/^OBJECT|EMBED$/,c=a&&a.parentNode;c&&b.test(c.nodeName)&&c.parentNode;)c=c.parentNode;return c||null},Q=function(){if(d){var a=v(d,N.zIndex),b=P(e.bridge);b&&(b.style.top=a.top+"px",b.style.left=a.left+"px",b.style.width=a.width+"px",b.style.height=a.height+"px",b.style.zIndex=a.zIndex+1),e.ready===!0&&e.bridge&&"function"==typeof e.bridge.setSize?e.bridge.setSize(a.width,a.height):e.ready=!1}return this};K.prototype.on=function(a,b){var c,d,f,g={},i=h[this.id]&&h[this.id].handlers;if("string"==typeof a&&a)f=a.toLowerCase().split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof b)for(c in a)a.hasOwnProperty(c)&&"string"==typeof c&&c&&"function"==typeof a[c]&&this.on(c,a[c]);if(f&&f.length){for(c=0,d=f.length;d>c;c++)a=f[c].replace(/^on/,""),g[a]=!0,i[a]||(i[a]=[]),i[a].push(b);g.noflash&&e.disabled&&T.call(this,"noflash",{}),g.wrongflash&&e.outdated&&T.call(this,"wrongflash",{flashVersion:e.version}),g.load&&e.ready&&T.call(this,"load",{flashVersion:e.version})}return this},K.prototype.off=function(a,b){var c,d,e,f,g,i=h[this.id]&&h[this.id].handlers;if(0===arguments.length)f=G(i);else if("string"==typeof a&&a)f=a.split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof b)for(c in a)a.hasOwnProperty(c)&&"string"==typeof c&&c&&"function"==typeof a[c]&&this.off(c,a[c]);if(f&&f.length)for(c=0,d=f.length;d>c;c++)if(a=f[c].toLowerCase().replace(/^on/,""),g=i[a],g&&g.length)if(b)for(e=y(b,g);-1!==e;)g.splice(e,1),e=y(b,g,e);else i[a].length=0;return this},K.prototype.handlers=function(a){var b,c=null,d=h[this.id]&&h[this.id].handlers;if(d){if("string"==typeof a&&a)return d[a]?d[a].slice(0):null;c={};for(b in d)d.hasOwnProperty(b)&&d[b]&&(c[b]=d[b].slice(0))}return c};var R=function(b,c,d,e){var f=h[this.id]&&h[this.id].handlers[b];if(f&&f.length){var g,i,j,k=c||this;for(g=0,i=f.length;i>g;g++)j=f[g],c=k,"string"==typeof j&&"function"==typeof a[j]&&(j=a[j]),"object"==typeof j&&j&&"function"==typeof j.handleEvent&&(c=j,j=j.handleEvent),"function"==typeof j&&A(j,c,d,e)}return this};K.prototype.clip=function(a){a=z(a);for(var b=0;b<a.length;b++)if(a.hasOwnProperty(b)&&a[b]&&1===a[b].nodeType){a[b].zcClippingId?-1===y(this.id,j[a[b].zcClippingId])&&j[a[b].zcClippingId].push(this.id):(a[b].zcClippingId="zcClippingId_"+i++,j[a[b].zcClippingId]=[this.id],N.autoActivate===!0&&q(a[b],"mouseover",p));var c=h[this.id].elements;-1===y(a[b],c)&&c.push(a[b])}return this},K.prototype.unclip=function(a){var b=h[this.id];if(b){var c,d=b.elements;a="undefined"==typeof a?d.slice(0):z(a);for(var e=a.length;e--;)if(a.hasOwnProperty(e)&&a[e]&&1===a[e].nodeType){for(c=0;-1!==(c=y(a[e],d,c));)d.splice(c,1);var f=j[a[e].zcClippingId];if(f){for(c=0;-1!==(c=y(this.id,f,c));)f.splice(c,1);0===f.length&&(N.autoActivate===!0&&r(a[e],"mouseover",p),delete a[e].zcClippingId)}}}return this},K.prototype.elements=function(){var a=h[this.id];return a&&a.elements?a.elements.slice(0):[]};var S=function(a){var b,c,d,e,f,g=[];if(a&&1===a.nodeType&&(b=a.zcClippingId)&&j.hasOwnProperty(b)&&(c=j[b],c&&c.length))for(d=0,e=c.length;e>d;d++)f=h[c[d]].instance,f&&f instanceof K&&g.push(f);return g};N.hoverClass="zeroclipboard-is-hover",N.activeClass="zeroclipboard-is-active",N.trustedOrigins=null,N.allowScriptAccess=null,N.useNoCache=!0,N.moviePath="ZeroClipboard.swf",K.detectFlashSupport=function(){return C("ZeroClipboard.detectFlashSupport",N.debug),J()},K.dispatch=function(a,b){if("string"==typeof a&&a){var c=a.toLowerCase().replace(/^on/,"");if(c)for(var e=d&&N.autoActivate===!0?S(d):M(),f=0,g=e.length;g>f;f++)T.call(e[f],c,b)}},K.prototype.setHandCursor=function(a){return C("ZeroClipboard.prototype.setHandCursor",N.debug),a="boolean"==typeof a?a:!!a,L(a),N.forceHandCursor=a,this},K.prototype.reposition=function(){return C("ZeroClipboard.prototype.reposition",N.debug),Q()},K.prototype.receiveEvent=function(a,b){if(C("ZeroClipboard.prototype.receiveEvent",N.debug),"string"==typeof a&&a){var c=a.toLowerCase().replace(/^on/,"");c&&T.call(this,c,b)}},K.prototype.setCurrent=function(a){return C("ZeroClipboard.prototype.setCurrent",N.debug),K.activate(a),this},K.prototype.resetBridge=function(){return C("ZeroClipboard.prototype.resetBridge",N.debug),K.deactivate(),this},K.prototype.setTitle=function(a){if(C("ZeroClipboard.prototype.setTitle",N.debug),a=a||N.title||d&&d.getAttribute("title")){var b=P(e.bridge);b&&b.setAttribute("title",a)}return this},K.setDefaults=function(a){C("ZeroClipboard.setDefaults",N.debug),K.config(a)},K.prototype.addEventListener=function(a,b){return C("ZeroClipboard.prototype.addEventListener",N.debug),this.on(a,b)},K.prototype.removeEventListener=function(a,b){return C("ZeroClipboard.prototype.removeEventListener",N.debug),this.off(a,b)},K.prototype.ready=function(){return C("ZeroClipboard.prototype.ready",N.debug),e.ready===!0};var T=function(a,g){a=a.toLowerCase().replace(/^on/,"");var h=g&&g.flashVersion&&b(g.flashVersion)||null,i=d,j=!0;switch(a){case"load":if(h){if(!c(h))return T.call(this,"onWrongFlash",{flashVersion:h}),void 0;e.outdated=!1,e.ready=!0,e.version=h}break;case"wrongflash":h&&!c(h)&&(e.outdated=!0,e.ready=!1,e.version=h);break;case"mouseover":s(i,N.hoverClass);break;case"mouseout":N.autoActivate===!0&&K.deactivate();break;case"mousedown":s(i,N.activeClass);break;case"mouseup":t(i,N.activeClass);break;case"datarequested":if(i){var k=i.getAttribute("data-clipboard-target"),l=k?document.getElementById(k):null;if(l){var m=l.value||l.textContent||l.innerText;m&&this.setText(m)}else{var n=i.getAttribute("data-clipboard-text");n&&this.setText(n)}}j=!1;break;case"complete":H(f),i&&i!==I()&&i.focus&&i.focus()}var o=i,p=[this,g];return R.call(this,a,o,p,j)};"function"==typeof define&&define.amd?define(["require","exports","module"],function(a,b,c){return k=c&&c.id||null,K}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports&&"function"==typeof a.require?(l=module.id||null,module.exports=K):a.ZeroClipboard=K}(function(){return this}());var bugsense;

(function ( root, factory ) {
    if ( typeof define === 'function' && define.amd ) {
        // AMD. Register as an anonymous module.
        define(function () {
            // Also create a global in case some scripts
            // that are loaded still are looking for
            // a global even when an AMD loader is in use.
            return ( root.Bugsense = factory() );
        });
    } else {
        // Browser globals
        root.Bugsense = factory();
    }
}( this, function () {

  /**
   * Simple extend() implementation
   * @param  {Object} original The object to extend
   * @param  {Object} extra    The properties to extend with
   * @return {Object}          The extended original object
   */
  var extend = function extend ( original, extra ) {
    return Object.keys( extra ).forEach( function ( key ) { original[ key ] = extra[ key ]; } );
  };

  // BEGIN - Extracted from Zepto
  var escape = encodeURIComponent;

  var isObject = function isObject ( instance ) {
    return instance instanceof Object;
  };

  var isArray = function isArray ( instance ) {
    return instance instanceof Array;
  };

  var isValidKeyValue = function isValidKeyValue ( instance ) {
    return ( typeof(instance) == 'string' || typeof(instance) == 'number' || typeof(instance) == 'boolean' );
  };

  /**
   * Simple forEach, implements jQuery/Zepto api, sort of, and most likely breaks with arrays: LOL
   * @param  {Object} obj      To be iterated
   * @param  {Object} iterator Iterator function
   */
  var forEach = function forEach ( obj, iterator ) {
    Array.prototype.forEach.call( Object.keys( obj ), function ( key ) {
      iterator( key, obj[ key ] );
    } );
  };

  var serialize = function serialize ( params, obj, traditional, scope ) {
    var array = isArray( obj );

    forEach( obj, function ( key, value ) {
      if ( scope ) { key = traditional ? scope : scope + '[' + (array ? '' : key) + ']'; }

      // handle data in serializeArray() format
      if ( !scope && array ) {
        params.add( value.name, value.value );
      // recurse into nested objects
      } else if ( traditional ? isArray( value ) : isObject( value ) ) {
        serialize( params, value, traditional, key );
      } else {
        params.add( key, value );
      }
    });
  };

  var param = function param ( obj, traditional ) {
    var params = [];
    params.add = function( k, v ){ this.push( escape( k ) + '=' + escape( v ) ); };
    serialize( params, obj, traditional );
    return params.join( '&' ).replace( /%20/g, '+' );
  };
    // END - Extracted from Zepto


  var guid_generator = function GUIDGenerator() {
      var S4 = function () {
          return Math.floor(
                  Math.random() * 0x10000 /* 65536 */
              ).toString(16);
      };

      return (
              S4() + S4() + "-" +
              S4() + "-" +
              S4() + "-" +
              S4() + "-" +
              S4() + S4() + S4()
          );
  }


  /**
   * Constructor for the Bugsense instance
   * @param {Object} config Overrides for the default config, use to specify api key
   */
  var Bugsense = function ( config ) {
      extend(this.config, config);
      this.config.winjs = typeof (WinJS) !== 'undefined';
      this.extraData = {};
      this.breadcrumbs = [];

    bugsense = this;
    if ( typeof(this.config.context.onerror) !== 'undefined' && !this.config.noOnError )
        this.config.context.onerror = bugsense.onerror;
    // WINJS
    if ( this.config.winjs ) {
        WinJS.Promise.onerror = bugsense.onpremiseerror;
        var p = Windows.ApplicationModel.Package.current.id.version;
        this.config.appversion = [p.major, p.minor, p.build, p.revision].join('.');
        this.send_cached_report_if_any();
        // Create unique device id
        var localSettings = Windows.Storage.ApplicationData.current.localSettings;
        var guid = localSettings['guid'];
        if (!guid) {
            guid = guid_generator();
            localSettings['guid'] = guid;
        }
        this.config.guid = guid;
    }
    // CORDOVA

    return this;
  };

  // Default config
  Bugsense.prototype.config = {
    apiKey     : 'FOOBAR',
    url        : 'https://www.bugsense.com/api/errors',
    //url      : 'https://csh-bugsense.fwd.wf/api/errors',
    pingUrl    : 'http://ticks2.bugsense.com/api/ticks',
    appversion : null,
    popup      : false, // unless WinJS
    callback   : null,
    context: window,
    winjs: null,
    message: null
  };

  /**
    * Add extra data (meta data) to be sent upon uncaught exception
    * @params {String} key      Key
    * @params {String} value    Value
    */
  Bugsense.prototype.addExtraData = function bugsenseAddExtraData ( key, value ) {
     if ( isValidKeyValue( key ) && isValidKeyValue( value ) ) {
        this.extraData[ key ] = value;
     }
  }

  /**
    * Remove a key value pair from extra data
    * @params {String} key      Key
    */
  Bugsense.prototype.removeExtraData = function bugsenseRemoveExtraData ( key ) {
     delete this.extraData[ key ];
  }

  /**
    * Clear extra data
    */
  Bugsense.prototype.clearExtraData = function bugsenseClearExtraData () {
     this.extraData = {};
  }

  /**
    * Leave a breadcrump
    * @params {String} breadcrumb  Breadcrumb
    */
  Bugsense.prototype.leaveBreadcrumb = function bugsenseLeaveBreadcrumb ( breadcrumb ) {
     if ( isValidKeyValue( breadcrumb ) ) {
        if ( this.breadcrumbs.length + 1 == 16 ) {
            this.breadcrumbs = this.breadcrumbs.slice( 1 );
        }
        this.breadcrumbs.push( breadcrumb );
     }
  }

  /**
    * Clear breadcrumbs
    */
  Bugsense.prototype.clearBreadcrumbs = function bugsenseClearBreadcrumbs () {
     this.breadcrumbs = {};
  }

    /**
      * Kill bugsense and the app. Force exit
      */
  Bugsense.prototype._die = function bugsenseDie() {
      throw 'BugSense exited';
  }

  /**
   * Handles the response from the Bugsense API endpoint
   * @param  {Object} data       Bugsense response object
   * @param  {String} textStatus Response http status code
   * @param  {Object} XHR        XHR object
   */
  Bugsense.prototype.successHandler = function bugsenseSuccessHandler(request) {
      // Die
      function _die () { throw 'BugSense exited'; }
      // TODO if WinJS show notifications to user
      if (request.target && request.target.readyState != 4) { return; }
      if (request.target && request.target.status != 200 && bugsense.config.winjs) {
          return false;
      }

      // some console.log implementations don't support multiple parameters, guess it's okay in this case to concatenate
      if ('console' in window) {
          console.log('logged 1 error to Bugsense, status: ' + request.target.responseText);
      }
      if (bugsense.config.winjs) {
          if (request.target.responseText !== undefined && request.target.responseText.indexOf('url') > 0) {
              var response = JSON.parse(request.target.responseText);
              // Display fix notification if set

                  var md = new Windows.UI.Popups.MessageDialog(response.data.tickerText);
                  var result, resultOptions = ['Update', 'Cancel'];
                  var cmd;

                  for (var i = 0; i < resultOptions.length; i++) {
                      cmd = new Windows.UI.Popups.UICommand();
                      cmd.label = resultOptions[i];
                      // Style update
                      cmd.invoked = function (c) {
                          result = c.label;
                      }
                      md.commands.append(cmd);
                  }

                  md.showAsync().then(function (c) {
                      if (c.label == 'Update') {
                          var uri = Windows.Foundation.Uri(response.data.url);
                          Windows.System.Launcher.launchUriAsync(uri);
                      }
                      return c.label;
                  }).done(function complete() { window.bugsense._die(); });
              // Show popup message is set

          } else if (request.target.responseText.length > 0 && request.target.responseText.indexOf('url') < 0) { // NOT OPTIONS
              if (window.bugsense.config.message !== null) {
                  var md = new Windows.UI.Popups.MessageDialog(window.bugsense.config.message);
                  var result, resultOptions = ['OK'];
                  var cmd;

                  for (var i = 0; i < resultOptions.length; i++) {
                      cmd = new Windows.UI.Popups.UICommand();
                      cmd.label = resultOptions[i];
                      cmd.invoked = function (c) {
                          result = c.label;
                      }
                      md.commands.append(cmd);
                  }

                  md.showAsync().then(function (c) {
                      return c.label;
                  }).done(function complete() { window.bugsense._die(); });
              } else {
                  // Just die!
                  window.bugsense._die();
              }
          }
      }

  };

  /**
   * Returns the Bugsense api url, with a cacheBuster argument
   * @return {String} Bugsense API URL endpoint
   */
  Bugsense.prototype.getPostURL = function bugsenseGetPostURL () {
    return Bugsense.prototype.config.url + '?cacheBuster=' + ( new Date() ).getTime();
  };

  /**
   * Parses a raw Error object
   * @param  {Object} error A raw Error object - e.g.: as sent from try/catch
   * @return {Object}       An object containing the parsed data as its properties
   */
  Bugsense.prototype.parseError = function bugsenseParseError ( error ) {
    var parsedError = {}
    // Firefox
    if ( navigator.userAgent.toLowerCase().indexOf('firefox') > -1 ){
        parsedError = {
            message: error.message,
            url: window.location.href,
            line: error.lineNumber,
            stack: error.stack,
            type: error.name
        }
    // Unhandled WinJS
    } else if ( this.config.winjs === true && typeof( error.stack ) === 'undefined' ) {
        parsedError = {
            message: error.detail.errorMessage,
            url: error.detail.errorUrl,
            line: error.detail.errorLine,
            stack: ( error.detail.stack === undefined ) ? error.detail.errorMessage : error.detail.stack,
            type: error.detail.errorCode
        };
    // Handled WinJS
    } else if (this.config.winjs === true && typeof( error.stack ) !== 'undefined') {
        var s = error.stack;
        var tmp = s.substr(s.indexOf('(') + 1, s.indexOf(')') - s.indexOf('(') - 1).split(':');
        parsedError = {
            message: error.message,
            url: tmp[0] + ':' + tmp[1],
            line:tmp[2] ,
            stack: error.stack,
            type: error.stack.split(':')[0],
            handled: true
        };
    // Webkit
    } else {
        // If .stack is not available
        try {
            var where_parts = error.stack.split( '\n' ).slice(1)[0].match( /\s+at\s.*(\/.*\..*|<anonymous>:\d*:\d*)/ );
        } catch ( error ) {
            error.stack = error.message;
        }
        parsedError = {
          message: [ error.name, error.message ].join( ': ' ),
          url: where_parts ? where_parts[ 1 ].split( ':' )[ 0 ].replace("/","") : '',
          line: where_parts ? where_parts[ 1 ].split( ':' )[ 1 ] : '',
          stack: error.stack,
          type: error.name
        };
    }

    if ( parsedError.stack == null || ( typeof( parsedError.stack ) == 'string' && parsedError.stack.length == 0 ) ) {
        parsedError.stack = parsedError.message;
    }

    return parsedError;
  };

  /**
   * Generates an object containing the exception data, compliant with Bugsense's API
   * @param  {String} exception   The error message ( also accepts Error Object, will be normalized )
   *                              e.g.: "Uncaught ReferenceError: ben is not defined"
   * @param  {String} url         The originating url
   *                              e.g.: "http://lmjabreu.local:8002/assets/js/main.js"
   * @param  {Number} line        The line number
   *                              e.g.: "12"
   * @param  {Object} custom_Data An object containing extra debugging data
   * @return {Object}           Bugsense API-compliant exception object
   */
  Bugsense.prototype.generateExceptionData = function bugsenseGenerateExceptionData ( message, url, line, stack, custom_data ) {
    if ( typeof( message ) != "string" ) {
        message = message.toString()
    }

    var s = window.navigator.userAgent;
    var connection_type = 'unknown';
    if (this.config.winjs) {
        try {
            connection_type = Windows.Networking.Connectivity.NetworkInformation.getInternetConnectionProfile().profileName;
        } catch (exception) {
            connection_type = 'Offline';
        }
    } else if ( typeof window.navigator.network !== 'undefined' ) {
        connection_type = window.navigator.network.connection.type;
    }

    var data = {
      // information about the bugsense client
      client: {
        // Obligatory
        'name'    : 'bugsense-js',
        // Optional
        'version' : '1.1'
      },
      // Optional
      // details & custom data about the exception including url, request, response,…
      request: {
        'custom_data' : custom_data
      },
      // basics about the exception
      exception: {
        // Obligatory
        'message'     : message,
        'where'       : [ url, line ].join( ':' ),
        'klass'       : message.split( ':' )[ 0 ],
        'backtrace'   : ( typeof(stack) === 'undefined' ) ? message : stack,
        'breadcrumbs': this.breadcrumbs
      },
      // basic data ( required )
      application_environment: {
        // Obligatory
        'phone'              : window.navigator.platform,
        'appver'             : ( this.config.appversion || 'unknown' ),
        'appname'            : ( this.config.appname || 'unknown' ),
        'osver'              : ( typeof window.device !== 'undefined' ) ? window.device.version : s.substr(s.indexOf('; ')+2,s.length).replace(')',';').split(';')[0] || 'unknown' ,
        // Optional
        'connection_type'    : connection_type,
        'user_agent'         : window.navigator.userAgent,
        'cordova'            : ( typeof window.device !== 'undefined' ) ? window.device.cordova : 'unknown',
        'device_name'        : ( typeof window.device !== 'undefined' ) ? window.device.name : 'unknown',
        'log_data'           : this.extraData
      }
    };

    if (this.config.winjs) {
        // Extra vars for Windows apps
        data.application_environment.cpuClass = window.navigator.cpuClass;
        data.application_environment.osver = window.navigator.userAgent.split(';')[2];
        data.application_environment.languages = window.navigator.systemLanguage;
        data.application_environment.locale = window.navigator.userLanguage;
        data.application_environment.is_trial = Windows.ApplicationModel.Store.CurrentApp.licenseInformation.isTrial;
        data.application_environment.is_active = Windows.ApplicationModel.Store.CurrentApp.licenseInformation.isActive;
        data.application_environment.uid = this.config.guid;
        if (typeof (custom_data) !== 'undefined') {
            if ( typeof(custom_data.handled) !== 'undefined' ){
                data.exception.handled = 0;
            }
        }
    }

    return data;
  };

  /**
   * Returns true for Error objects
   * @param  {Object} exception The object to test
   * @return {Boolean}           True for Error objects - [object Error]
   */
  Bugsense.prototype.testException = function bugsenseTestException(exception) {
      // unhandled winjs exceptions
      if (this.config.winjs === true && typeof(exception.detail) !== 'undefined')
          return exception.type === "error";
      // catches handled winjs exceptions as well
      return Object.prototype.toString.call(exception) === '[object Error]';
  };

    /**
     * Returns true if it is an exeption throwed by BugSense
     * @param {Object} exception
     */
  Bugsense.prototype.isBugsenseException = function bugsenseIsBugsenseException(exception) {
      return this.config.winjs && this.testException(exception) && exception.detail.errorMessage === "BugSense exited";
  }

  /**
   * Notify Bugsense about an exception
   * @param  {String} exception   The error message ( also accepts Error Object, will be normalized )
   * @param  {String} url         The originating url
   * @param  {String} line        The line number
   * @param  {Object} custom_data Custom data to send over to Bugsense
   */
  Bugsense.prototype.notify = function bugsenseNotify(exception, url, line, custom_data) {
      var stack;
    // Prints exception stack to console before the exception is handled by Bugsense
      if (window.console && window.console.error) {
        console.error(exception.stack);
      }
    // Handle cases where only Error object and custom data are sent - url will be the custom_data
    if ( typeof(url) === 'object' && this.testException( exception ) ) { custom_data = url; url = undefined; }

    // If the exception is the full Error object, extract what we want from it
    if ( this.testException( exception ) ) {
      var parsedError = this.parseError( exception );

      message = [ parsedError.type, parsedError.message ].join( ':' );
      url = parsedError.url;
      line = parsedError.line;
      stack = parsedError.stack;
      if (typeof (parsedError.handled) !== 'undefined') {
          if (typeof (custom_data) !== 'object') custom_data = {};
          custom_data.handled = 0;
      }
    } else {
        message = exception;
    }

    var data = this.generateExceptionData( message, url, line, stack, custom_data );

    // Send the data over to Bugsense
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.open( 'POST', this.getPostURL(), true );
    xmlhttp.setRequestHeader( 'X-BugSense-Api-Key', this.config.apiKey );
    xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xmlhttp.onerror = function (a) {
        if (bugsense.config.winjs) {
            WinJS.Application.local.writeText('CachedCrashReport', JSON.stringify(data)).done(
                function complete() { console.log('written'); window.bugsense._die() }
           );
        }
    }
    if (!(custom_data instanceof Object && custom_data.handled == 0))
        xmlhttp.onreadystatechange = this.successHandler;

    xmlhttp.send(param({ data: JSON.stringify(data) }));

    return true;
  };

    /**
      * Send cashed crash report
      */
  Bugsense.prototype.send_cached_report_if_any = function bugsenseSendCachedReport() {
      var local = WinJS.Application.local;
      local.exists('CachedCrashReport').then(function (exists) {
          if (exists) {
              local.readText('CachedCrashReport').then(function (strdata) {
                  var data = JSON.parse(strdata);
                  // Send the data over to Bugsense
                  var xmlhttp = new XMLHttpRequest();
                  xmlhttp.open('POST', window.bugsense.getPostURL(), true);
                  xmlhttp.setRequestHeader('X-BugSense-Api-Key', window.bugsense.config.apiKey);
                  xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                  xmlhttp.onreadystatechange = function (request) {
                      if (request.target && request.target.readyState == 4) {
                          WinJS.Application.local.remove('CachedCrashReport');
                          return;
                      }
                  };
                  xmlhttp.send(param({ data: JSON.stringify(data) }));
              }).done();
          }
      }).done();
  };

  /**
    * Closure function for unhandled exceptions
    *
    */
  Bugsense.prototype.onerror = function bugsenseonerror(exception, url, line, custom_data) {
      // Ignore bugsense raised exception
      if (window.bugsense.isBugsenseException(exception))
          return false;
      return window.bugsense.notify(exception, url, line, custom_data);
  };

  Bugsense.prototype.onpromiseerror = function bugsenseonpromiseerror(event) {
      // Ignore bugsense raised exception
      if (window.bugsense.isBugsenseException(exception))
          return false;
      return window.bugsense.notify(event.detail.exception, event.detail.promise);
  };

  return Bugsense;

}));
var Strict;
var Pickler;
/*******************************************************************************
 * Misc.
 */

// Workaround for missing functionality in IE 8 and earlier.
if( Object.create === undefined ) {
  Object.create = function( o ) {
    function F(){}
    F.prototype = o;
    return new F();
  };
}

// Insert properties of b in place into a.
function Fay$$objConcat(a,b){
  for (var p in b) if (b.hasOwnProperty(p)){
    a[p] = b[p];
  }
  return a;
}

/*******************************************************************************
 * Thunks.
 */

// Force a thunk (if it is a thunk) until WHNF.
function Fay$$_(thunkish,nocache){
  while (thunkish instanceof Fay$$$) {
    thunkish = thunkish.force(nocache);
  }
  return thunkish;
}

// Apply a function to arguments (see method2 in Fay.hs).
function Fay$$__(){
  var f = arguments[0];
  for (var i = 1, len = arguments.length; i < len; i++) {
    f = (f instanceof Fay$$$? Fay$$_(f) : f)(arguments[i]);
  }
  return f;
}

// Thunk object.
function Fay$$$(value){
  this.forced = false;
  this.value = value;
}

// Force the thunk.
Fay$$$.prototype.force = function(nocache) {
  return nocache ?
    this.value() :
    (this.forced ?
     this.value :
     (this.value = this.value(), this.forced = true, this.value));
};


function Fay$$seq(x) {
  return function(y) {
    Fay$$_(x,false);
    return y;
  }
}

function Fay$$seq$36$uncurried(x,y) {
  Fay$$_(x,false);
  return y;
}

/*******************************************************************************
 * Monad.
 */

function Fay$$Monad(value){
  this.value = value;
}

// This is used directly from Fay, but can be rebound or shadowed. See primOps in Types.hs.
// >>
function Fay$$then(a){
  return function(b){
    return Fay$$bind(a)(function(_){
      return b;
    });
  };
}

// This is used directly from Fay, but can be rebound or shadowed. See primOps in Types.hs.
// >>
function Fay$$then$36$uncurried(a,b){
  return Fay$$bind$36$uncurried(a,function(_){ return b; });
}

// >>=
// This is used directly from Fay, but can be rebound or shadowed. See primOps in Types.hs.
function Fay$$bind(m){
  return function(f){
    return new Fay$$$(function(){
      var monad = Fay$$_(m,true);
      return Fay$$_(f)(monad.value);
    });
  };
}

// >>=
// This is used directly from Fay, but can be rebound or shadowed. See primOps in Types.hs.
function Fay$$bind$36$uncurried(m,f){
  return new Fay$$$(function(){
    var monad = Fay$$_(m,true);
    return Fay$$_(f)(monad.value);
  });
}

// This is used directly from Fay, but can be rebound or shadowed.
function Fay$$$_return(a){
  return new Fay$$Monad(a);
}

// Allow the programmer to access thunk forcing directly.
function Fay$$force(thunk){
  return function(type){
    return new Fay$$$(function(){
      Fay$$_(thunk,type);
      return new Fay$$Monad(Fay$$unit);
    })
  }
}

// This is used directly from Fay, but can be rebound or shadowed.
function Fay$$return$36$uncurried(a){
  return new Fay$$Monad(a);
}

// Unit: ().
var Fay$$unit = null;

/*******************************************************************************
 * Serialization.
 * Fay <-> JS. Should be bijective.
 */

// Serialize a Fay object to JS.
function Fay$$fayToJs(type,fayObj){
  var base = type[0];
  var args = type[1];
  var jsObj;
  if(base == "action") {
    // A nullary monadic action. Should become a nullary JS function.
    // Fay () -> function(){ return ... }
    jsObj = function(){
      return Fay$$fayToJs(args[0],Fay$$_(fayObj,true).value);
    };

  }
  else if(base == "function") {
    // A proper function.
    jsObj = function(){
      var fayFunc = fayObj;
      var return_type = args[args.length-1];
      var len = args.length;
      // If some arguments.
      if (len > 1) {
        // Apply to all the arguments.
        fayFunc = Fay$$_(fayFunc,true);
        // TODO: Perhaps we should throw an error when JS
        // passes more arguments than Haskell accepts.

        // Unserialize the JS values to Fay for the Fay callback.
        if (args == "automatic_function")
        {
          for (var i = 0; i < arguments.length; i++) {
            fayFunc = Fay$$fayToJs(["automatic"], Fay$$_(fayFunc(Fay$$jsToFay(["automatic"],arguments[i])),true));
          }
          return fayFunc;
        }

        for (var i = 0, len = len; i < len - 1 && fayFunc instanceof Function; i++) {
          fayFunc = Fay$$_(fayFunc(Fay$$jsToFay(args[i],arguments[i])),true);
        }
        // Finally, serialize the Fay return value back to JS.
        var return_base = return_type[0];
        var return_args = return_type[1];
        // If it's a monadic return value, get the value instead.
        if(return_base == "action") {
          return Fay$$fayToJs(return_args[0],fayFunc.value);
        }
        // Otherwise just serialize the value direct.
        else {
          return Fay$$fayToJs(return_type,fayFunc);
        }
      } else {
        throw new Error("Nullary function?");
      }
    };

  }
  else if(base == "string") {
    jsObj = Fay$$fayToJs_string(fayObj);
  }
  else if(base == "list") {
    // Serialize Fay list to JavaScript array.
    var arr = [];
    fayObj = Fay$$_(fayObj);
    while(fayObj instanceof Fay$$Cons) {
      arr.push(Fay$$fayToJs(args[0],fayObj.car));
      fayObj = Fay$$_(fayObj.cdr);
    }
    jsObj = arr;
  }
  else if(base == "tuple") {
    // Serialize Fay tuple to JavaScript array.
    var arr = [];
    fayObj = Fay$$_(fayObj);
    var i = 0;
    while(fayObj instanceof Fay$$Cons) {
      arr.push(Fay$$fayToJs(args[i++],fayObj.car));
      fayObj = Fay$$_(fayObj.cdr);
    }
    jsObj = arr;

  }
  else if(base == "defined") {
    fayObj = Fay$$_(fayObj);
    if (fayObj instanceof Fay.FFI._Undefined) {
      jsObj = undefined;
    } else {
      jsObj = Fay$$fayToJs(args[0],fayObj.slot1);
    }

  }
  else if(base == "nullable") {
    fayObj = Fay$$_(fayObj);
    if (fayObj instanceof Fay.FFI._Null) {
      jsObj = null;
    } else {
      jsObj = Fay$$fayToJs(args[0],fayObj.slot1);
    }

  }
  else if(base == "double" || base == "int" || base == "bool") {
    // Bools are unboxed.
    jsObj = Fay$$_(fayObj);

  }
  else if(base == "ptr" || base == "unknown")
    return fayObj;
  else if(base == "automatic" || base == "user") {

    fayObj = Fay$$_(fayObj);

    if(fayObj instanceof Function) {
      jsObj = Fay$$fayToJs(["function", "automatic_function"], fayObj);
    } else if(fayObj instanceof Fay$$Cons || fayObj === null){
      // Serialize Fay list to JavaScript array.
      var arr = [];
      while(fayObj instanceof Fay$$Cons) {
        arr.push(Fay$$fayToJs(["automatic"],fayObj.car));
        fayObj = Fay$$_(fayObj.cdr);
      }
      jsObj = arr;
    } else {
      var fayToJsFun = fayObj && fayObj.constructor && Fay$$fayToJsHash[fayObj.constructor.name];
      jsObj = fayToJsFun ? fayToJsFun(type,type[2],fayObj) : fayObj;
    }
  }
  else
    throw new Error("Unhandled Fay->JS translation type: " + base);
  return jsObj;
}

// Stores the mappings from fay types to js objects.
// This will be populated by compiled modules.
var Fay$$fayToJsHash = {};

// Specialized serializer for string.
function Fay$$fayToJs_string(fayObj){
  // Serialize Fay string to JavaScript string.
  var str = "";
  fayObj = Fay$$_(fayObj);
  while(fayObj instanceof Fay$$Cons) {
    str += Fay$$_(fayObj.car);
    fayObj = Fay$$_(fayObj.cdr);
  }
  return str;
};
function Fay$$jsToFay_string(x){
  return Fay$$list(x)
};

// Special num/bool serializers.
function Fay$$jsToFay_int(x){return x;}
function Fay$$jsToFay_double(x){return x;}
function Fay$$jsToFay_bool(x){return x;}

function Fay$$fayToJs_int(x){return Fay$$_(x);}
function Fay$$fayToJs_double(x){return Fay$$_(x);}
function Fay$$fayToJs_bool(x){return Fay$$_(x);}

// Unserialize an object from JS to Fay.
function Fay$$jsToFay(type,jsObj){
  var base = type[0];
  var args = type[1];
  var fayObj;
  if(base == "action") {
    // Unserialize a "monadic" JavaScript return value into a monadic value.
    fayObj = new Fay$$Monad(Fay$$jsToFay(args[0],jsObj));
  }
  else if(base == "function") {
    // Unserialize a function from JavaScript to a function that Fay can call.
    // So
    //
    //    var f = function(x,y,z){ … }
    //
    // becomes something like:
    //
    //    function(x){
    //      return function(y){
    //        return function(z){
    //          return new Fay$$$(function(){
    //            return Fay$$jsToFay(f(Fay$$fayTojs(x),
    //                                  Fay$$fayTojs(y),
    //                                  Fay$$fayTojs(z))
    //    }}}}};
    var returnType = args[args.length-1];
    var funArgs = args.slice(0,-1);

    if (jsObj.length > 0) {
      var makePartial = function(args){
        return function(arg){
          var i = args.length;
          var fayArg = Fay$$fayToJs(funArgs[i],arg);
          var newArgs = args.concat([fayArg]);
          if(newArgs.length == funArgs.length) {
            return new Fay$$$(function(){
              return Fay$$jsToFay(returnType,jsObj.apply(this,newArgs));
            });
          } else {
            return makePartial(newArgs);
          }
        };
      };
      fayObj = makePartial([]);
    }
    else {
      fayObj =
        function (arg)
        {
           return Fay$$jsToFay(["automatic"], jsObj(Fay$$fayToJs(["automatic"], arg)));
        };
    }
  }
  else if(base == "string") {
    // Unserialize a JS string into Fay list (String).
    fayObj = Fay$$list(jsObj);
  }
  else if(base == "list") {
    // Unserialize a JS array into a Fay list ([a]).
    var serializedList = [];
    for (var i = 0, len = jsObj.length; i < len; i++) {
      // Unserialize each JS value into a Fay value, too.
      serializedList.push(Fay$$jsToFay(args[0],jsObj[i]));
    }
    // Pop it all in a Fay list.
    fayObj = Fay$$list(serializedList);

  }
  else if(base == "tuple") {
    // Unserialize a JS array into a Fay tuple ((a,b,c,...)).
    var serializedTuple = [];
    for (var i = 0, len = jsObj.length; i < len; i++) {
      // Unserialize each JS value into a Fay value, too.
      serializedTuple.push(Fay$$jsToFay(args[i],jsObj[i]));
    }
    // Pop it all in a Fay list.
    fayObj = Fay$$list(serializedTuple);

  }
  else if(base == "defined") {
    if (jsObj === undefined) {
      fayObj = new Fay.FFI._Undefined();
    } else {
      fayObj = new Fay.FFI._Defined(Fay$$jsToFay(args[0],jsObj));
    }

  }
  else if(base == "nullable") {
    if (jsObj === null) {
      fayObj = new Fay.FFI._Null();
    } else {
      fayObj = new Fay.FFI.Nullable(Fay$$jsToFay(args[0],jsObj));
    }

  }
  else if(base == "int") {
    // Int are unboxed, so there's no forcing to do.
    // But we can do validation that the int has no decimal places.
    // E.g. Math.round(x)!=x? throw "NOT AN INTEGER, GET OUT!"
    fayObj = Math.round(jsObj);
    if(fayObj!==jsObj) throw "Argument " + jsObj + " is not an integer!";

  }
  else if (base == "double" ||
           base == "bool" ||
           base ==  "ptr" ||
           base ==  "unknown") {
    return jsObj;
  }
  else if(base == "automatic" || base == "user") {
    if (jsObj && jsObj['instance']) {
      var jsToFayFun = Fay$$jsToFayHash[jsObj["instance"]];
      fayObj = jsToFayFun ? jsToFayFun(type,type[2],jsObj) : jsObj;
    }
    else if (jsObj instanceof Array) {
      var list = null;
      for (var i = jsObj.length - 1; i >= 0; i--) {
        list = new Fay$$Cons(Fay$$jsToFay([base], jsObj[i]), list);
      }
      fayObj = list;
    }
    else if (jsObj instanceof Function) {
      var type = [["automatic"]];
      for (var i = 0; i < jsObj.length; i++)
        type.push(["automatic"]);
      return Fay$$jsToFay(["function", type], jsObj);
    }
    else
      fayObj = jsObj;

  }
  else { throw new Error("Unhandled JS->Fay translation type: " + base); }
  return fayObj;
}

// Stores the mappings from js objects to fay types.
// This will be populated by compiled modules.
var Fay$$jsToFayHash = {};

/*******************************************************************************
 * Lists.
 */

// Cons object.
function Fay$$Cons(car,cdr){
  this.car = car;
  this.cdr = cdr;
}

// Make a list.
function Fay$$list(xs){
  var out = null;
  for(var i=xs.length-1; i>=0;i--)
    out = new Fay$$Cons(xs[i],out);
  return out;
}

// Built-in list cons.
function Fay$$cons(x){
  return function(y){
    return new Fay$$Cons(x,y);
  };
}

// List index.
// `list' is already forced by the time it's passed to this function.
// `list' cannot be null and `index' cannot be out of bounds.
function Fay$$index(index,list){
  for(var i = 0; i < index; i++) {
    list = Fay$$_(list.cdr);
  }
  return list.car;
}

// List length.
// `list' is already forced by the time it's passed to this function.
function Fay$$listLen(list,max){
  for(var i = 0; list !== null && i < max + 1; i++) {
    list = Fay$$_(list.cdr);
  }
  return i == max;
}

/*******************************************************************************
 * Numbers.
 */

// Built-in *.
function Fay$$mult(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$_(x) * Fay$$_(y);
    });
  };
}

function Fay$$mult$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$_(x) * Fay$$_(y);
  });

}

// Built-in +.
function Fay$$add(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$_(x) + Fay$$_(y);
    });
  };
}

// Built-in +.
function Fay$$add$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$_(x) + Fay$$_(y);
  });

}

// Built-in -.
function Fay$$sub(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$_(x) - Fay$$_(y);
    });
  };
}
// Built-in -.
function Fay$$sub$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$_(x) - Fay$$_(y);
  });

}

// Built-in /.
function Fay$$divi(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$_(x) / Fay$$_(y);
    });
  };
}

// Built-in /.
function Fay$$divi$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$_(x) / Fay$$_(y);
  });

}

/*******************************************************************************
 * Booleans.
 */

// Are two values equal?
function Fay$$equal(lit1, lit2) {
  // Simple case
  lit1 = Fay$$_(lit1);
  lit2 = Fay$$_(lit2);
  if (lit1 === lit2) {
    return true;
  }
  // General case
  if (lit1 instanceof Array) {
    if (lit1.length != lit2.length) return false;
    for (var len = lit1.length, i = 0; i < len; i++) {
      if (!Fay$$equal(lit1[i], lit2[i])) return false;
    }
    return true;
  } else if (lit1 instanceof Fay$$Cons && lit2 instanceof Fay$$Cons) {
    do {
      if (!Fay$$equal(lit1.car,lit2.car))
        return false;
      lit1 = Fay$$_(lit1.cdr), lit2 = Fay$$_(lit2.cdr);
      if (lit1 === null || lit2 === null)
        return lit1 === lit2;
    } while (true);
  } else if (typeof lit1 == 'object' && typeof lit2 == 'object' && lit1 && lit2 &&
             lit1.constructor === lit2.constructor) {
    for(var x in lit1) {
      if(!(lit1.hasOwnProperty(x) && lit2.hasOwnProperty(x) &&
           Fay$$equal(lit1[x],lit2[x])))
        return false;
    }
    return true;
  } else {
    return false;
  }
}

// Built-in ==.
function Fay$$eq(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$equal(x,y);
    });
  };
}

function Fay$$eq$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$equal(x,y);
  });

}

// Built-in /=.
function Fay$$neq(x){
  return function(y){
    return new Fay$$$(function(){
      return !(Fay$$equal(x,y));
    });
  };
}

// Built-in /=.
function Fay$$neq$36$uncurried(x,y){

  return new Fay$$$(function(){
    return !(Fay$$equal(x,y));
  });

}

// Built-in >.
function Fay$$gt(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$_(x) > Fay$$_(y);
    });
  };
}

// Built-in >.
function Fay$$gt$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$_(x) > Fay$$_(y);
  });

}

// Built-in <.
function Fay$$lt(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$_(x) < Fay$$_(y);
    });
  };
}


// Built-in <.
function Fay$$lt$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$_(x) < Fay$$_(y);
  });

}


// Built-in >=.
function Fay$$gte(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$_(x) >= Fay$$_(y);
    });
  };
}

// Built-in >=.
function Fay$$gte$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$_(x) >= Fay$$_(y);
  });

}

// Built-in <=.
function Fay$$lte(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$_(x) <= Fay$$_(y);
    });
  };
}

// Built-in <=.
function Fay$$lte$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$_(x) <= Fay$$_(y);
  });

}

// Built-in &&.
function Fay$$and(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$_(x) && Fay$$_(y);
    });
  };
}

// Built-in &&.
function Fay$$and$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$_(x) && Fay$$_(y);
  });
  ;
}

// Built-in ||.
function Fay$$or(x){
  return function(y){
    return new Fay$$$(function(){
      return Fay$$_(x) || Fay$$_(y);
    });
  };
}

// Built-in ||.
function Fay$$or$36$uncurried(x,y){

  return new Fay$$$(function(){
    return Fay$$_(x) || Fay$$_(y);
  });

}

/*******************************************************************************
 * Mutable references.
 */

// Make a new mutable reference.
function Fay$$Ref(x){
  this.value = x;
}

// Write to the ref.
function Fay$$writeRef(ref,x){
  ref.value = x;
}

// Get the value from the ref.
function Fay$$readRef(ref,x){
  return ref.value;
}

/*******************************************************************************
 * Dates.
 */
function Fay$$date(str){
  return window.Date.parse(str);
}

/*******************************************************************************
 * Application code.
 */

var Fay = {};
Fay.FFI = {};
Fay.FFI._Nullable = function Nullable(slot1){
  this.slot1 = slot1;
};
Fay.FFI.Nullable = function(slot1){
  return new Fay$$$(function(){
    return new Fay.FFI._Nullable(slot1);
  });
};
Fay.FFI._Null = function Null(){
};
Fay.FFI.Null = new Fay$$$(function(){
  return new Fay.FFI._Null();
});
Fay.FFI._Defined = function Defined(slot1){
  this.slot1 = slot1;
};
Fay.FFI.Defined = function(slot1){
  return new Fay$$$(function(){
    return new Fay.FFI._Defined(slot1);
  });
};
Fay.FFI._Undefined = function Undefined(){
};
Fay.FFI.Undefined = new Fay$$$(function(){
  return new Fay.FFI._Undefined();
});
Fay$$objConcat(Fay$$fayToJsHash,{"Nullable": function(type,argTypes,_obj){
  var obj_ = {"instance": "Nullable"};
  var obj_slot1 = Fay$$fayToJs(argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],_obj.slot1);
  if (undefined !== obj_slot1) {
    obj_['slot1'] = obj_slot1;
  }
  return obj_;
},"Null": function(type,argTypes,_obj){
  var obj_ = {"instance": "Null"};
  return obj_;
},"Defined": function(type,argTypes,_obj){
  var obj_ = {"instance": "Defined"};
  var obj_slot1 = Fay$$fayToJs(argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],_obj.slot1);
  if (undefined !== obj_slot1) {
    obj_['slot1'] = obj_slot1;
  }
  return obj_;
},"Undefined": function(type,argTypes,_obj){
  var obj_ = {"instance": "Undefined"};
  return obj_;
}});
Fay$$objConcat(Fay$$jsToFayHash,{"Nullable": function(type,argTypes,obj){
  return new Fay.FFI._Nullable(Fay$$jsToFay(argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],obj["slot1"]));
},"Null": function(type,argTypes,obj){
  return new Fay.FFI._Null();
},"Defined": function(type,argTypes,obj){
  return new Fay.FFI._Defined(Fay$$jsToFay(argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],obj["slot1"]));
},"Undefined": function(type,argTypes,obj){
  return new Fay.FFI._Undefined();
}});
var Data = {};
Data.Data = {};
var Prelude = {};
Prelude._Just = function Just(slot1){
  this.slot1 = slot1;
};
Prelude.Just = function(slot1){
  return new Fay$$$(function(){
    return new Prelude._Just(slot1);
  });
};
Prelude._Nothing = function Nothing(){
};
Prelude.Nothing = new Fay$$$(function(){
  return new Prelude._Nothing();
});
Prelude._Left = function Left(slot1){
  this.slot1 = slot1;
};
Prelude.Left = function(slot1){
  return new Fay$$$(function(){
    return new Prelude._Left(slot1);
  });
};
Prelude._Right = function Right(slot1){
  this.slot1 = slot1;
};
Prelude.Right = function(slot1){
  return new Fay$$$(function(){
    return new Prelude._Right(slot1);
  });
};
Prelude.maybe = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        if (Fay$$_($p3) instanceof Prelude._Nothing) {
          var m = $p1;
          return m;
        }
        if (Fay$$_($p3) instanceof Prelude._Just) {
          var x = Fay$$_($p3).slot1;
          var f = $p2;
          return Fay$$_(f)(x);
        }
        throw ["unhandled case in maybe",[$p1,$p2,$p3]];
      });
    };
  };
};
Prelude.$62$$62$$61$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return new Fay$$Monad(Fay$$jsToFay(["unknown"],Fay$$bind(Fay$$fayToJs(["action",[["unknown"]]],$p1))(Fay$$fayToJs(["function",[["unknown"],["action",[["unknown"]]]]],$p2))));
    });
  };
};
Prelude.$62$$62$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return new Fay$$Monad(Fay$$jsToFay(["unknown"],Fay$$then(Fay$$fayToJs(["action",[["unknown"]]],$p1))(Fay$$fayToJs(["action",[["unknown"]]],$p2))));
    });
  };
};
Prelude.$_return = function($p1){
  return new Fay$$$(function(){
    return new Fay$$Monad(Fay$$jsToFay(["unknown"],Fay$$return(Fay$$fayToJs(["unknown"],$p1))));
  });
};
Prelude.when = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var m = $p2;
      var p = $p1;
      return Fay$$_(p) ? Fay$$_(Fay$$_(Fay$$then)(m))(Fay$$_(Fay$$$_return)(Fay$$unit)) : Fay$$_(Fay$$$_return)(Fay$$unit);
    });
  };
};
Prelude.forM_ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var m = $p2;
      var $tmp1 = Fay$$_($p1);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        return Fay$$_(Fay$$_(Fay$$then)(Fay$$_(m)(x)))(Fay$$_(Fay$$_(Prelude.forM_)(xs))(m));
      }
      if (Fay$$_($p1) === null) {
        return Fay$$_(Fay$$$_return)(Fay$$unit);
      }
      throw ["unhandled case in forM_",[$p1,$p2]];
    });
  };
};
Prelude.mapM_ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var m = $p1;
        return Fay$$_(Fay$$_(Fay$$then)(Fay$$_(m)(x)))(Fay$$_(Fay$$_(Prelude.mapM_)(m))(xs));
      }
      if (Fay$$_($p2) === null) {
        return Fay$$_(Fay$$$_return)(Fay$$unit);
      }
      throw ["unhandled case in mapM_",[$p1,$p2]];
    });
  };
};
Prelude.$61$$60$$60$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var x = $p2;
      var f = $p1;
      return Fay$$_(Fay$$_(Fay$$bind)(x))(f);
    });
  };
};
Prelude.sequence = function($p1){
  return new Fay$$$(function(){
    var ms = $p1;
    return (function(){
      var k = function($p1){
        return function($p2){
          return new Fay$$$(function(){
            var m$39$ = $p2;
            var m = $p1;
            return Fay$$_(Fay$$_(Fay$$bind)(m))(function($p1){
              var x = $p1;
              return Fay$$_(Fay$$_(Fay$$bind)(m$39$))(function($p1){
                var xs = $p1;
                return Fay$$_(Fay$$$_return)(Fay$$_(Fay$$_(Fay$$cons)(x))(xs));
              });
            });
          });
        };
      };
      return Fay$$_(Fay$$_(Fay$$_(Prelude.foldr)(k))(Fay$$_(Fay$$$_return)(null)))(ms);
    })();
  });
};
Prelude.sequence_ = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return Fay$$_(Fay$$$_return)(Fay$$unit);
    }
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      var m = $tmp1.car;
      var ms = $tmp1.cdr;
      return Fay$$_(Fay$$_(Fay$$then)(m))(Fay$$_(Prelude.sequence_)(ms));
    }
    throw ["unhandled case in sequence_",[$p1]];
  });
};
Prelude._GT = function GT(){
};
Prelude.GT = new Fay$$$(function(){
  return new Prelude._GT();
});
Prelude._LT = function LT(){
};
Prelude.LT = new Fay$$$(function(){
  return new Prelude._LT();
});
Prelude._EQ = function EQ(){
};
Prelude.EQ = new Fay$$$(function(){
  return new Prelude._EQ();
});
Prelude.compare = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var y = $p2;
      var x = $p1;
      return Fay$$_(Fay$$_(Fay$$_(Fay$$gt)(x))(y)) ? Prelude.GT : Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(x))(y)) ? Prelude.LT : Prelude.EQ;
    });
  };
};
Prelude.succ = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$add)(x))(1);
  });
};
Prelude.pred = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$sub)(x))(1);
  });
};
Prelude.enumFrom = function($p1){
  return new Fay$$$(function(){
    var i = $p1;
    return Fay$$_(Fay$$_(Fay$$cons)(i))(Fay$$_(Prelude.enumFrom)(Fay$$_(Fay$$_(Fay$$add)(i))(1)));
  });
};
Prelude.enumFromTo = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var n = $p2;
      var i = $p1;
      return Fay$$_(Fay$$_(Fay$$_(Fay$$gt)(i))(n)) ? null : Fay$$_(Fay$$_(Fay$$cons)(i))(Fay$$_(Fay$$_(Prelude.enumFromTo)(Fay$$_(Fay$$_(Fay$$add)(i))(1)))(n));
    });
  };
};
Prelude.enumFromBy = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var by = $p2;
      var fr = $p1;
      return Fay$$_(Fay$$_(Fay$$cons)(fr))(Fay$$_(Fay$$_(Prelude.enumFromBy)(Fay$$_(Fay$$_(Fay$$add)(fr))(by)))(by));
    });
  };
};
Prelude.enumFromThen = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var th = $p2;
      var fr = $p1;
      return Fay$$_(Fay$$_(Prelude.enumFromBy)(fr))(Fay$$_(Fay$$_(Fay$$sub)(th))(fr));
    });
  };
};
Prelude.enumFromByTo = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var to = $p3;
        var by = $p2;
        var fr = $p1;
        return (function(){
          var neg = function($p1){
            return new Fay$$$(function(){
              var x = $p1;
              return Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(x))(to)) ? null : Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(neg)(Fay$$_(Fay$$_(Fay$$add)(x))(by)));
            });
          };
          var pos = function($p1){
            return new Fay$$$(function(){
              var x = $p1;
              return Fay$$_(Fay$$_(Fay$$_(Fay$$gt)(x))(to)) ? null : Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(pos)(Fay$$_(Fay$$_(Fay$$add)(x))(by)));
            });
          };
          return Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(by))(0)) ? Fay$$_(neg)(fr) : Fay$$_(pos)(fr);
        })();
      });
    };
  };
};
Prelude.enumFromThenTo = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var to = $p3;
        var th = $p2;
        var fr = $p1;
        return Fay$$_(Fay$$_(Fay$$_(Prelude.enumFromByTo)(fr))(Fay$$_(Fay$$_(Fay$$sub)(th))(fr)))(to);
      });
    };
  };
};
Prelude.fromIntegral = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Fay$$fayToJs_int($p1));
  });
};
Prelude.fromInteger = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Fay$$fayToJs_int($p1));
  });
};
Prelude.not = function($p1){
  return new Fay$$$(function(){
    var p = $p1;
    return Fay$$_(p) ? false : true;
  });
};
Prelude.otherwise = true;
Prelude.show = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_string(JSON.stringify(Fay$$fayToJs(["automatic"],$p1)));
  });
};
Prelude.error = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay(["unknown"],(function() { throw Fay$$fayToJs_string($p1) })());
  });
};
Prelude.$_undefined = new Fay$$$(function(){
  return Fay$$_(Prelude.error)(Fay$$list("Prelude.undefined"));
});
Prelude.either = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        if (Fay$$_($p3) instanceof Prelude._Left) {
          var a = Fay$$_($p3).slot1;
          var f = $p1;
          return Fay$$_(f)(a);
        }
        if (Fay$$_($p3) instanceof Prelude._Right) {
          var b = Fay$$_($p3).slot1;
          var g = $p2;
          return Fay$$_(g)(b);
        }
        throw ["unhandled case in either",[$p1,$p2,$p3]];
      });
    };
  };
};
Prelude.until = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var x = $p3;
        var f = $p2;
        var p = $p1;
        return Fay$$_(Fay$$_(p)(x)) ? x : Fay$$_(Fay$$_(Fay$$_(Prelude.until)(p))(f))(Fay$$_(f)(x));
      });
    };
  };
};
Prelude.$36$$33$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var x = $p2;
      var f = $p1;
      return Fay$$_(Fay$$_(Fay$$seq)(x))(Fay$$_(f)(x));
    });
  };
};
Prelude.$_const = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var a = $p1;
      return a;
    });
  };
};
Prelude.id = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return x;
  });
};
Prelude.$46$ = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var x = $p3;
        var g = $p2;
        var f = $p1;
        return Fay$$_(f)(Fay$$_(g)(x));
      });
    };
  };
};
Prelude.$36$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var x = $p2;
      var f = $p1;
      return Fay$$_(f)(x);
    });
  };
};
Prelude.flip = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var y = $p3;
        var x = $p2;
        var f = $p1;
        return Fay$$_(Fay$$_(f)(y))(x);
      });
    };
  };
};
Prelude.curry = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var y = $p3;
        var x = $p2;
        var f = $p1;
        return Fay$$_(f)(Fay$$list([x,y]));
      });
    };
  };
};
Prelude.uncurry = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var p = $p2;
      var f = $p1;
      return (function($tmp1){
        if (Fay$$listLen(Fay$$_($tmp1),2)) {
          var x = Fay$$index(0,Fay$$_($tmp1));
          var y = Fay$$index(1,Fay$$_($tmp1));
          return Fay$$_(Fay$$_(f)(x))(y);
        }
        return (function(){ throw (["unhandled case",$tmp1]); })();
      })(p);
    });
  };
};
Prelude.snd = function($p1){
  return new Fay$$$(function(){
    if (Fay$$listLen(Fay$$_($p1),2)) {
      var x = Fay$$index(1,Fay$$_($p1));
      return x;
    }
    throw ["unhandled case in snd",[$p1]];
  });
};
Prelude.fst = function($p1){
  return new Fay$$$(function(){
    if (Fay$$listLen(Fay$$_($p1),2)) {
      var x = Fay$$index(0,Fay$$_($p1));
      return x;
    }
    throw ["unhandled case in fst",[$p1]];
  });
};
Prelude.div = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var y = $p2;
      var x = $p1;
      if (Fay$$_(Fay$$_(Fay$$_(Fay$$and)(Fay$$_(Fay$$_(Fay$$gt)(x))(0)))(Fay$$_(Fay$$_(Fay$$lt)(y))(0)))) {
        return Fay$$_(Fay$$_(Fay$$sub)(Fay$$_(Fay$$_(Prelude.quot)(Fay$$_(Fay$$_(Fay$$sub)(x))(1)))(y)))(1);
      } else {if (Fay$$_(Fay$$_(Fay$$_(Fay$$and)(Fay$$_(Fay$$_(Fay$$lt)(x))(0)))(Fay$$_(Fay$$_(Fay$$gt)(y))(0)))) {
          return Fay$$_(Fay$$_(Fay$$sub)(Fay$$_(Fay$$_(Prelude.quot)(Fay$$_(Fay$$_(Fay$$add)(x))(1)))(y)))(1);
        }
      }
      var y = $p2;
      var x = $p1;
      return Fay$$_(Fay$$_(Prelude.quot)(x))(y);
    });
  };
};
Prelude.mod = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var y = $p2;
      var x = $p1;
      if (Fay$$_(Fay$$_(Fay$$_(Fay$$and)(Fay$$_(Fay$$_(Fay$$gt)(x))(0)))(Fay$$_(Fay$$_(Fay$$lt)(y))(0)))) {
        return Fay$$_(Fay$$_(Fay$$add)(Fay$$_(Fay$$_(Fay$$add)(Fay$$_(Fay$$_(Prelude.rem)(Fay$$_(Fay$$_(Fay$$sub)(x))(1)))(y)))(y)))(1);
      } else {if (Fay$$_(Fay$$_(Fay$$_(Fay$$and)(Fay$$_(Fay$$_(Fay$$lt)(x))(0)))(Fay$$_(Fay$$_(Fay$$gt)(y))(0)))) {
          return Fay$$_(Fay$$_(Fay$$sub)(Fay$$_(Fay$$_(Fay$$add)(Fay$$_(Fay$$_(Prelude.rem)(Fay$$_(Fay$$_(Fay$$add)(x))(1)))(y)))(y)))(1);
        }
      }
      var y = $p2;
      var x = $p1;
      return Fay$$_(Fay$$_(Prelude.rem)(x))(y);
    });
  };
};
Prelude.divMod = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var y = $p2;
      var x = $p1;
      if (Fay$$_(Fay$$_(Fay$$_(Fay$$and)(Fay$$_(Fay$$_(Fay$$gt)(x))(0)))(Fay$$_(Fay$$_(Fay$$lt)(y))(0)))) {
        return (function($tmp1){
          if (Fay$$listLen(Fay$$_($tmp1),2)) {
            var q = Fay$$index(0,Fay$$_($tmp1));
            var r = Fay$$index(1,Fay$$_($tmp1));
            return Fay$$list([Fay$$_(Fay$$_(Fay$$sub)(q))(1),Fay$$_(Fay$$_(Fay$$add)(Fay$$_(Fay$$_(Fay$$add)(r))(y)))(1)]);
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(Fay$$_(Fay$$_(Prelude.quotRem)(Fay$$_(Fay$$_(Fay$$sub)(x))(1)))(y));
      } else {if (Fay$$_(Fay$$_(Fay$$_(Fay$$and)(Fay$$_(Fay$$_(Fay$$lt)(x))(0)))(Fay$$_(Fay$$_(Fay$$gt)(y))(1)))) {
          return (function($tmp1){
            if (Fay$$listLen(Fay$$_($tmp1),2)) {
              var q = Fay$$index(0,Fay$$_($tmp1));
              var r = Fay$$index(1,Fay$$_($tmp1));
              return Fay$$list([Fay$$_(Fay$$_(Fay$$sub)(q))(1),Fay$$_(Fay$$_(Fay$$sub)(Fay$$_(Fay$$_(Fay$$add)(r))(y)))(1)]);
            }
            return (function(){ throw (["unhandled case",$tmp1]); })();
          })(Fay$$_(Fay$$_(Prelude.quotRem)(Fay$$_(Fay$$_(Fay$$add)(x))(1)))(y));
        }
      }
      var y = $p2;
      var x = $p1;
      return Fay$$_(Fay$$_(Prelude.quotRem)(x))(y);
    });
  };
};
Prelude.min = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return Fay$$jsToFay(["unknown"],Math.min(Fay$$_(Fay$$fayToJs(["unknown"],$p1)),Fay$$_(Fay$$fayToJs(["unknown"],$p2))));
    });
  };
};
Prelude.max = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return Fay$$jsToFay(["unknown"],Math.max(Fay$$_(Fay$$fayToJs(["unknown"],$p1)),Fay$$_(Fay$$fayToJs(["unknown"],$p2))));
    });
  };
};
Prelude.recip = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$divi)(1))(x);
  });
};
Prelude.negate = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return (-(Fay$$_(x)));
  });
};
Prelude.abs = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(x))(0)) ? Fay$$_(Prelude.negate)(x) : x;
  });
};
Prelude.signum = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$_(Fay$$gt)(x))(0)) ? 1 : Fay$$_(Fay$$_(Fay$$_(Fay$$eq)(x))(0)) ? 0 : (-(1));
  });
};
Prelude.pi = new Fay$$$(function(){
  return Fay$$jsToFay_double(Math.PI);
});
Prelude.exp = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Math.exp(Fay$$fayToJs_double($p1)));
  });
};
Prelude.sqrt = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Math.sqrt(Fay$$fayToJs_double($p1)));
  });
};
Prelude.log = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Math.log(Fay$$fayToJs_double($p1)));
  });
};
Prelude.$42$$42$ = new Fay$$$(function(){
  return Prelude.unsafePow;
});
Prelude.$94$$94$ = new Fay$$$(function(){
  return Prelude.unsafePow;
});
Prelude.unsafePow = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return Fay$$jsToFay(["unknown"],Math.pow(Fay$$_(Fay$$fayToJs(["unknown"],$p1)),Fay$$_(Fay$$fayToJs(["unknown"],$p2))));
    });
  };
};
Prelude.$94$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var b = $p2;
      var a = $p1;
      if (Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(b))(0))) {
        return Fay$$_(Prelude.error)(Fay$$list("(^): negative exponent"));
      } else {if (Fay$$_(Fay$$_(Fay$$_(Fay$$eq)(b))(0))) {
          return 1;
        } else {if (Fay$$_(Fay$$_(Prelude.even)(b))) {
            return (function(){
              return new Fay$$$(function(){
                var x = new Fay$$$(function(){
                  return Fay$$_(Fay$$_(Prelude.$94$)(a))(Fay$$_(Fay$$_(Prelude.quot)(b))(2));
                });
                return Fay$$_(Fay$$_(Fay$$mult)(x))(x);
              });
            })();
          }
        }
      }
      var b = $p2;
      var a = $p1;
      return Fay$$_(Fay$$_(Fay$$mult)(a))(Fay$$_(Fay$$_(Prelude.$94$)(a))(Fay$$_(Fay$$_(Fay$$sub)(b))(1)));
    });
  };
};
Prelude.logBase = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var x = $p2;
      var b = $p1;
      return Fay$$_(Fay$$_(Fay$$divi)(Fay$$_(Prelude.log)(x)))(Fay$$_(Prelude.log)(b));
    });
  };
};
Prelude.sin = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Math.sin(Fay$$fayToJs_double($p1)));
  });
};
Prelude.tan = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Math.tan(Fay$$fayToJs_double($p1)));
  });
};
Prelude.cos = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Math.cos(Fay$$fayToJs_double($p1)));
  });
};
Prelude.asin = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Math.asin(Fay$$fayToJs_double($p1)));
  });
};
Prelude.atan = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Math.atan(Fay$$fayToJs_double($p1)));
  });
};
Prelude.acos = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_double(Math.acos(Fay$$fayToJs_double($p1)));
  });
};
Prelude.sinh = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$divi)(Fay$$_(Fay$$_(Fay$$sub)(Fay$$_(Prelude.exp)(x)))(Fay$$_(Prelude.exp)((-(Fay$$_(x)))))))(2);
  });
};
Prelude.tanh = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return (function(){
      return new Fay$$$(function(){
        var a = new Fay$$$(function(){
          return Fay$$_(Prelude.exp)(x);
        });
        var b = new Fay$$$(function(){
          return Fay$$_(Prelude.exp)((-(Fay$$_(x))));
        });
        return Fay$$_(Fay$$_(Fay$$divi)(Fay$$_(Fay$$_(Fay$$sub)(a))(b)))(Fay$$_(Fay$$_(Fay$$add)(a))(b));
      });
    })();
  });
};
Prelude.cosh = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$divi)(Fay$$_(Fay$$_(Fay$$add)(Fay$$_(Prelude.exp)(x)))(Fay$$_(Prelude.exp)((-(Fay$$_(x)))))))(2);
  });
};
Prelude.asinh = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Prelude.log)(Fay$$_(Fay$$_(Fay$$add)(x))(Fay$$_(Prelude.sqrt)(Fay$$_(Fay$$_(Fay$$add)(Fay$$_(Fay$$_(Prelude.$42$$42$)(x))(2)))(1))));
  });
};
Prelude.atanh = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$divi)(Fay$$_(Prelude.log)(Fay$$_(Fay$$_(Fay$$divi)(Fay$$_(Fay$$_(Fay$$add)(1))(x)))(Fay$$_(Fay$$_(Fay$$sub)(1))(x)))))(2);
  });
};
Prelude.acosh = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Prelude.log)(Fay$$_(Fay$$_(Fay$$add)(x))(Fay$$_(Prelude.sqrt)(Fay$$_(Fay$$_(Fay$$sub)(Fay$$_(Fay$$_(Prelude.$42$$42$)(x))(2)))(1))));
  });
};
Prelude.properFraction = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return (function(){
      return new Fay$$$(function(){
        var a = new Fay$$$(function(){
          return Fay$$_(Prelude.truncate)(x);
        });
        return Fay$$list([a,Fay$$_(Fay$$_(Fay$$sub)(x))(Fay$$_(Prelude.fromIntegral)(a))]);
      });
    })();
  });
};
Prelude.truncate = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(x))(0)) ? Fay$$_(Prelude.ceiling)(x) : Fay$$_(Prelude.floor)(x);
  });
};
Prelude.round = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_int(Math.round(Fay$$fayToJs_double($p1)));
  });
};
Prelude.ceiling = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_int(Math.ceil(Fay$$fayToJs_double($p1)));
  });
};
Prelude.floor = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_int(Math.floor(Fay$$fayToJs_double($p1)));
  });
};
Prelude.subtract = new Fay$$$(function(){
  return Fay$$_(Prelude.flip)(Fay$$sub);
});
Prelude.even = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$eq)(Fay$$_(Fay$$_(Prelude.rem)(x))(2)))(0);
  });
};
Prelude.odd = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Prelude.not)(Fay$$_(Prelude.even)(x));
  });
};
Prelude.gcd = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var b = $p2;
      var a = $p1;
      return (function(){
        var go = function($p1){
          return function($p2){
            return new Fay$$$(function(){
              if (Fay$$_($p2) === 0) {
                var x = $p1;
                return x;
              }
              var y = $p2;
              var x = $p1;
              return Fay$$_(Fay$$_(go)(y))(Fay$$_(Fay$$_(Prelude.rem)(x))(y));
            });
          };
        };
        return Fay$$_(Fay$$_(go)(Fay$$_(Prelude.abs)(a)))(Fay$$_(Prelude.abs)(b));
      })();
    });
  };
};
Prelude.quot = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var y = $p2;
      var x = $p1;
      return Fay$$_(Fay$$_(Fay$$_(Fay$$eq)(y))(0)) ? Fay$$_(Prelude.error)(Fay$$list("Division by zero")) : Fay$$_(Fay$$_(Prelude.quot$39$)(x))(y);
    });
  };
};
Prelude.quot$39$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return Fay$$jsToFay_int(~~(Fay$$fayToJs_int($p1)/Fay$$fayToJs_int($p2)));
    });
  };
};
Prelude.quotRem = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var y = $p2;
      var x = $p1;
      return Fay$$list([Fay$$_(Fay$$_(Prelude.quot)(x))(y),Fay$$_(Fay$$_(Prelude.rem)(x))(y)]);
    });
  };
};
Prelude.rem = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var y = $p2;
      var x = $p1;
      return Fay$$_(Fay$$_(Fay$$_(Fay$$eq)(y))(0)) ? Fay$$_(Prelude.error)(Fay$$list("Division by zero")) : Fay$$_(Fay$$_(Prelude.rem$39$)(x))(y);
    });
  };
};
Prelude.rem$39$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return Fay$$jsToFay_int(Fay$$fayToJs_int($p1) % Fay$$fayToJs_int($p2));
    });
  };
};
Prelude.lcm = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === 0) {
        return 0;
      }
      if (Fay$$_($p1) === 0) {
        return 0;
      }
      var b = $p2;
      var a = $p1;
      return Fay$$_(Prelude.abs)(Fay$$_(Fay$$_(Fay$$mult)(Fay$$_(Fay$$_(Prelude.quot)(a))(Fay$$_(Fay$$_(Prelude.gcd)(a))(b))))(b));
    });
  };
};
Prelude.find = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var p = $p1;
        return Fay$$_(Fay$$_(p)(x)) ? Fay$$_(Prelude.Just)(x) : Fay$$_(Fay$$_(Prelude.find)(p))(xs);
      }
      if (Fay$$_($p2) === null) {
        return Prelude.Nothing;
      }
      throw ["unhandled case in find",[$p1,$p2]];
    });
  };
};
Prelude.filter = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var p = $p1;
        return Fay$$_(Fay$$_(p)(x)) ? Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(Fay$$_(Prelude.filter)(p))(xs)) : Fay$$_(Fay$$_(Prelude.filter)(p))(xs);
      }
      if (Fay$$_($p2) === null) {
        return null;
      }
      throw ["unhandled case in filter",[$p1,$p2]];
    });
  };
};
Prelude.$_null = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return true;
    }
    return false;
  });
};
Prelude.map = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        return null;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var f = $p1;
        return Fay$$_(Fay$$_(Fay$$cons)(Fay$$_(f)(x)))(Fay$$_(Fay$$_(Prelude.map)(f))(xs));
      }
      throw ["unhandled case in map",[$p1,$p2]];
    });
  };
};
Prelude.nub = function($p1){
  return new Fay$$$(function(){
    var ls = $p1;
    return Fay$$_(Fay$$_(Prelude.nub$39$)(ls))(null);
  });
};
Prelude.nub$39$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p1) === null) {
        return null;
      }
      var ls = $p2;
      var $tmp1 = Fay$$_($p1);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        return Fay$$_(Fay$$_(Fay$$_(Prelude.elem)(x))(ls)) ? Fay$$_(Fay$$_(Prelude.nub$39$)(xs))(ls) : Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(Fay$$_(Prelude.nub$39$)(xs))(Fay$$_(Fay$$_(Fay$$cons)(x))(ls)));
      }
      throw ["unhandled case in nub'",[$p1,$p2]];
    });
  };
};
Prelude.elem = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var y = $tmp1.car;
        var ys = $tmp1.cdr;
        var x = $p1;
        return Fay$$_(Fay$$_(Fay$$or)(Fay$$_(Fay$$_(Fay$$eq)(x))(y)))(Fay$$_(Fay$$_(Prelude.elem)(x))(ys));
      }
      if (Fay$$_($p2) === null) {
        return false;
      }
      throw ["unhandled case in elem",[$p1,$p2]];
    });
  };
};
Prelude.notElem = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var ys = $p2;
      var x = $p1;
      return Fay$$_(Prelude.not)(Fay$$_(Fay$$_(Prelude.elem)(x))(ys));
    });
  };
};
Prelude.sort = new Fay$$$(function(){
  return Fay$$_(Prelude.sortBy)(Prelude.compare);
});
Prelude.sortBy = function($p1){
  return new Fay$$$(function(){
    var cmp = $p1;
    return Fay$$_(Fay$$_(Prelude.foldr)(Fay$$_(Prelude.insertBy)(cmp)))(null);
  });
};
Prelude.insertBy = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        if (Fay$$_($p3) === null) {
          var x = $p2;
          return Fay$$list([x]);
        }
        var ys = $p3;
        var x = $p2;
        var cmp = $p1;
        return (function($tmp1){
          if (Fay$$_($tmp1) === null) {
            return Fay$$list([x]);
          }
          var $tmp2 = Fay$$_($tmp1);
          if ($tmp2 instanceof Fay$$Cons) {
            var y = $tmp2.car;
            var ys$39$ = $tmp2.cdr;
            return (function($tmp2){
              if (Fay$$_($tmp2) instanceof Prelude._GT) {
                return Fay$$_(Fay$$_(Fay$$cons)(y))(Fay$$_(Fay$$_(Fay$$_(Prelude.insertBy)(cmp))(x))(ys$39$));
              }
              return Fay$$_(Fay$$_(Fay$$cons)(x))(ys);
            })(Fay$$_(Fay$$_(cmp)(x))(y));
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(ys);
      });
    };
  };
};
Prelude.conc = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var ys = $p2;
      var $tmp1 = Fay$$_($p1);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        return Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(Fay$$_(Prelude.conc)(xs))(ys));
      }
      var ys = $p2;
      if (Fay$$_($p1) === null) {
        return ys;
      }
      throw ["unhandled case in conc",[$p1,$p2]];
    });
  };
};
Prelude.concat = new Fay$$$(function(){
  return Fay$$_(Fay$$_(Prelude.foldr)(Prelude.conc))(null);
});
Prelude.concatMap = function($p1){
  return new Fay$$$(function(){
    var f = $p1;
    return Fay$$_(Fay$$_(Prelude.foldr)(Fay$$_(Fay$$_(Prelude.$46$)(Prelude.$43$$43$))(f)))(null);
  });
};
Prelude.foldr = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        if (Fay$$_($p3) === null) {
          var z = $p2;
          return z;
        }
        var $tmp1 = Fay$$_($p3);
        if ($tmp1 instanceof Fay$$Cons) {
          var x = $tmp1.car;
          var xs = $tmp1.cdr;
          var z = $p2;
          var f = $p1;
          return Fay$$_(Fay$$_(f)(x))(Fay$$_(Fay$$_(Fay$$_(Prelude.foldr)(f))(z))(xs));
        }
        throw ["unhandled case in foldr",[$p1,$p2,$p3]];
      });
    };
  };
};
Prelude.foldr1 = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$listLen(Fay$$_($p2),1)) {
        var x = Fay$$index(0,Fay$$_($p2));
        return x;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var f = $p1;
        return Fay$$_(Fay$$_(f)(x))(Fay$$_(Fay$$_(Prelude.foldr1)(f))(xs));
      }
      if (Fay$$_($p2) === null) {
        return Fay$$_(Prelude.error)(Fay$$list("foldr1: empty list"));
      }
      throw ["unhandled case in foldr1",[$p1,$p2]];
    });
  };
};
Prelude.foldl = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        if (Fay$$_($p3) === null) {
          var z = $p2;
          return z;
        }
        var $tmp1 = Fay$$_($p3);
        if ($tmp1 instanceof Fay$$Cons) {
          var x = $tmp1.car;
          var xs = $tmp1.cdr;
          var z = $p2;
          var f = $p1;
          return Fay$$_(Fay$$_(Fay$$_(Prelude.foldl)(f))(Fay$$_(Fay$$_(f)(z))(x)))(xs);
        }
        throw ["unhandled case in foldl",[$p1,$p2,$p3]];
      });
    };
  };
};
Prelude.foldl1 = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var f = $p1;
        return Fay$$_(Fay$$_(Fay$$_(Prelude.foldl)(f))(x))(xs);
      }
      if (Fay$$_($p2) === null) {
        return Fay$$_(Prelude.error)(Fay$$list("foldl1: empty list"));
      }
      throw ["unhandled case in foldl1",[$p1,$p2]];
    });
  };
};
Prelude.$43$$43$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var y = $p2;
      var x = $p1;
      return Fay$$_(Fay$$_(Prelude.conc)(x))(y);
    });
  };
};
Prelude.$33$$33$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var b = $p2;
      var a = $p1;
      return (function(){
        var go = function($p1){
          return function($p2){
            return new Fay$$$(function(){
              if (Fay$$_($p1) === null) {
                return Fay$$_(Prelude.error)(Fay$$list("(!!): index too large"));
              }
              if (Fay$$_($p2) === 0) {
                var $tmp1 = Fay$$_($p1);
                if ($tmp1 instanceof Fay$$Cons) {
                  var h = $tmp1.car;
                  return h;
                }
              }
              var n = $p2;
              var $tmp1 = Fay$$_($p1);
              if ($tmp1 instanceof Fay$$Cons) {
                var t = $tmp1.cdr;
                return Fay$$_(Fay$$_(go)(t))(Fay$$_(Fay$$_(Fay$$sub)(n))(1));
              }
              throw ["unhandled case in go",[$p1,$p2]];
            });
          };
        };
        return Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(b))(0)) ? Fay$$_(Prelude.error)(Fay$$list("(!!): negative index")) : Fay$$_(Fay$$_(go)(a))(b);
      })();
    });
  };
};
Prelude.head = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return Fay$$_(Prelude.error)(Fay$$list("head: empty list"));
    }
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      var h = $tmp1.car;
      return h;
    }
    throw ["unhandled case in head",[$p1]];
  });
};
Prelude.tail = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return Fay$$_(Prelude.error)(Fay$$list("tail: empty list"));
    }
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      var t = $tmp1.cdr;
      return t;
    }
    throw ["unhandled case in tail",[$p1]];
  });
};
Prelude.init = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return Fay$$_(Prelude.error)(Fay$$list("init: empty list"));
    }
    if (Fay$$listLen(Fay$$_($p1),1)) {
      var a = Fay$$index(0,Fay$$_($p1));
      return null;
    }
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      var h = $tmp1.car;
      var t = $tmp1.cdr;
      return Fay$$_(Fay$$_(Fay$$cons)(h))(Fay$$_(Prelude.init)(t));
    }
    throw ["unhandled case in init",[$p1]];
  });
};
Prelude.last = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return Fay$$_(Prelude.error)(Fay$$list("last: empty list"));
    }
    if (Fay$$listLen(Fay$$_($p1),1)) {
      var a = Fay$$index(0,Fay$$_($p1));
      return a;
    }
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      var t = $tmp1.cdr;
      return Fay$$_(Prelude.last)(t);
    }
    throw ["unhandled case in last",[$p1]];
  });
};
Prelude.iterate = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var x = $p2;
      var f = $p1;
      return Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(Fay$$_(Prelude.iterate)(f))(Fay$$_(f)(x)));
    });
  };
};
Prelude.repeat = function($p1){
  return new Fay$$$(function(){
    var x = $p1;
    return Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(Prelude.repeat)(x));
  });
};
Prelude.replicate = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p1) === 0) {
        return null;
      }
      var x = $p2;
      var n = $p1;
      return Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(n))(0)) ? null : Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(Fay$$_(Prelude.replicate)(Fay$$_(Fay$$_(Fay$$sub)(n))(1)))(x));
    });
  };
};
Prelude.cycle = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return Fay$$_(Prelude.error)(Fay$$list("cycle: empty list"));
    }
    var xs = $p1;
    return (function(){
      var xs$39$ = new Fay$$$(function(){
        return Fay$$_(Fay$$_(Prelude.$43$$43$)(xs))(xs$39$);
      });
      return xs$39$;
    })();
  });
};
Prelude.take = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p1) === 0) {
        return null;
      }
      if (Fay$$_($p2) === null) {
        return null;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var n = $p1;
        return Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(n))(0)) ? null : Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(Fay$$_(Prelude.take)(Fay$$_(Fay$$_(Fay$$sub)(n))(1)))(xs));
      }
      throw ["unhandled case in take",[$p1,$p2]];
    });
  };
};
Prelude.drop = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var xs = $p2;
      if (Fay$$_($p1) === 0) {
        return xs;
      }
      if (Fay$$_($p2) === null) {
        return null;
      }
      var xss = $p2;
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var n = $p1;
        return Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(n))(0)) ? xss : Fay$$_(Fay$$_(Prelude.drop)(Fay$$_(Fay$$_(Fay$$sub)(n))(1)))(xs);
      }
      throw ["unhandled case in drop",[$p1,$p2]];
    });
  };
};
Prelude.splitAt = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var xs = $p2;
      if (Fay$$_($p1) === 0) {
        return Fay$$list([null,xs]);
      }
      if (Fay$$_($p2) === null) {
        return Fay$$list([null,null]);
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var n = $p1;
        return Fay$$_(Fay$$_(Fay$$_(Fay$$lt)(n))(0)) ? Fay$$list([null,Fay$$_(Fay$$_(Fay$$cons)(x))(xs)]) : (function($tmp1){
          if (Fay$$listLen(Fay$$_($tmp1),2)) {
            var a = Fay$$index(0,Fay$$_($tmp1));
            var b = Fay$$index(1,Fay$$_($tmp1));
            return Fay$$list([Fay$$_(Fay$$_(Fay$$cons)(x))(a),b]);
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(Fay$$_(Fay$$_(Prelude.splitAt)(Fay$$_(Fay$$_(Fay$$sub)(n))(1)))(xs));
      }
      throw ["unhandled case in splitAt",[$p1,$p2]];
    });
  };
};
Prelude.takeWhile = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        return null;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var p = $p1;
        return Fay$$_(Fay$$_(p)(x)) ? Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(Fay$$_(Prelude.takeWhile)(p))(xs)) : null;
      }
      throw ["unhandled case in takeWhile",[$p1,$p2]];
    });
  };
};
Prelude.dropWhile = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        return null;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var p = $p1;
        return Fay$$_(Fay$$_(p)(x)) ? Fay$$_(Fay$$_(Prelude.dropWhile)(p))(xs) : Fay$$_(Fay$$_(Fay$$cons)(x))(xs);
      }
      throw ["unhandled case in dropWhile",[$p1,$p2]];
    });
  };
};
Prelude.span = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        return Fay$$list([null,null]);
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var p = $p1;
        return Fay$$_(Fay$$_(p)(x)) ? (function($tmp1){
          if (Fay$$listLen(Fay$$_($tmp1),2)) {
            var a = Fay$$index(0,Fay$$_($tmp1));
            var b = Fay$$index(1,Fay$$_($tmp1));
            return Fay$$list([Fay$$_(Fay$$_(Fay$$cons)(x))(a),b]);
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(Fay$$_(Fay$$_(Prelude.span)(p))(xs)) : Fay$$list([null,Fay$$_(Fay$$_(Fay$$cons)(x))(xs)]);
      }
      throw ["unhandled case in span",[$p1,$p2]];
    });
  };
};
Prelude.$_break = function($p1){
  return new Fay$$$(function(){
    var p = $p1;
    return Fay$$_(Prelude.span)(Fay$$_(Fay$$_(Prelude.$46$)(Prelude.not))(p));
  });
};
Prelude.zipWith = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var $tmp1 = Fay$$_($p3);
        if ($tmp1 instanceof Fay$$Cons) {
          var b = $tmp1.car;
          var bs = $tmp1.cdr;
          var $tmp1 = Fay$$_($p2);
          if ($tmp1 instanceof Fay$$Cons) {
            var a = $tmp1.car;
            var as = $tmp1.cdr;
            var f = $p1;
            return Fay$$_(Fay$$_(Fay$$cons)(Fay$$_(Fay$$_(f)(a))(b)))(Fay$$_(Fay$$_(Fay$$_(Prelude.zipWith)(f))(as))(bs));
          }
        }
        return null;
      });
    };
  };
};
Prelude.zipWith3 = function($p1){
  return function($p2){
    return function($p3){
      return function($p4){
        return new Fay$$$(function(){
          var $tmp1 = Fay$$_($p4);
          if ($tmp1 instanceof Fay$$Cons) {
            var c = $tmp1.car;
            var cs = $tmp1.cdr;
            var $tmp1 = Fay$$_($p3);
            if ($tmp1 instanceof Fay$$Cons) {
              var b = $tmp1.car;
              var bs = $tmp1.cdr;
              var $tmp1 = Fay$$_($p2);
              if ($tmp1 instanceof Fay$$Cons) {
                var a = $tmp1.car;
                var as = $tmp1.cdr;
                var f = $p1;
                return Fay$$_(Fay$$_(Fay$$cons)(Fay$$_(Fay$$_(Fay$$_(f)(a))(b))(c)))(Fay$$_(Fay$$_(Fay$$_(Fay$$_(Prelude.zipWith3)(f))(as))(bs))(cs));
              }
            }
          }
          return null;
        });
      };
    };
  };
};
Prelude.zip = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var b = $tmp1.car;
        var bs = $tmp1.cdr;
        var $tmp1 = Fay$$_($p1);
        if ($tmp1 instanceof Fay$$Cons) {
          var a = $tmp1.car;
          var as = $tmp1.cdr;
          return Fay$$_(Fay$$_(Fay$$cons)(Fay$$list([a,b])))(Fay$$_(Fay$$_(Prelude.zip)(as))(bs));
        }
      }
      return null;
    });
  };
};
Prelude.zip3 = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var $tmp1 = Fay$$_($p3);
        if ($tmp1 instanceof Fay$$Cons) {
          var c = $tmp1.car;
          var cs = $tmp1.cdr;
          var $tmp1 = Fay$$_($p2);
          if ($tmp1 instanceof Fay$$Cons) {
            var b = $tmp1.car;
            var bs = $tmp1.cdr;
            var $tmp1 = Fay$$_($p1);
            if ($tmp1 instanceof Fay$$Cons) {
              var a = $tmp1.car;
              var as = $tmp1.cdr;
              return Fay$$_(Fay$$_(Fay$$cons)(Fay$$list([a,b,c])))(Fay$$_(Fay$$_(Fay$$_(Prelude.zip3)(as))(bs))(cs));
            }
          }
        }
        return null;
      });
    };
  };
};
Prelude.unzip = function($p1){
  return new Fay$$$(function(){
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      if (Fay$$listLen(Fay$$_($tmp1.car),2)) {
        var x = Fay$$index(0,Fay$$_($tmp1.car));
        var y = Fay$$index(1,Fay$$_($tmp1.car));
        var ps = $tmp1.cdr;
        return (function($tmp1){
          if (Fay$$listLen(Fay$$_($tmp1),2)) {
            var xs = Fay$$index(0,Fay$$_($tmp1));
            var ys = Fay$$index(1,Fay$$_($tmp1));
            return Fay$$list([Fay$$_(Fay$$_(Fay$$cons)(x))(xs),Fay$$_(Fay$$_(Fay$$cons)(y))(ys)]);
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(Fay$$_(Prelude.unzip)(ps));
      }
    }
    if (Fay$$_($p1) === null) {
      return Fay$$list([null,null]);
    }
    throw ["unhandled case in unzip",[$p1]];
  });
};
Prelude.unzip3 = function($p1){
  return new Fay$$$(function(){
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      if (Fay$$listLen(Fay$$_($tmp1.car),3)) {
        var x = Fay$$index(0,Fay$$_($tmp1.car));
        var y = Fay$$index(1,Fay$$_($tmp1.car));
        var z = Fay$$index(2,Fay$$_($tmp1.car));
        var ps = $tmp1.cdr;
        return (function($tmp1){
          if (Fay$$listLen(Fay$$_($tmp1),3)) {
            var xs = Fay$$index(0,Fay$$_($tmp1));
            var ys = Fay$$index(1,Fay$$_($tmp1));
            var zs = Fay$$index(2,Fay$$_($tmp1));
            return Fay$$list([Fay$$_(Fay$$_(Fay$$cons)(x))(xs),Fay$$_(Fay$$_(Fay$$cons)(y))(ys),Fay$$_(Fay$$_(Fay$$cons)(z))(zs)]);
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(Fay$$_(Prelude.unzip3)(ps));
      }
    }
    if (Fay$$_($p1) === null) {
      return Fay$$list([null,null,null]);
    }
    throw ["unhandled case in unzip3",[$p1]];
  });
};
Prelude.lines = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return null;
    }
    var s = $p1;
    return (function(){
      var isLineBreak = function($p1){
        return new Fay$$$(function(){
          var c = $p1;
          return Fay$$_(Fay$$_(Fay$$or)(Fay$$_(Fay$$_(Fay$$eq)(c))("\r")))(Fay$$_(Fay$$_(Fay$$eq)(c))("\n"));
        });
      };
      return (function($tmp1){
        if (Fay$$listLen(Fay$$_($tmp1),2)) {
          var a = Fay$$index(0,Fay$$_($tmp1));
          if (Fay$$_(Fay$$index(1,Fay$$_($tmp1))) === null) {
            return Fay$$list([a]);
          }
          var a = Fay$$index(0,Fay$$_($tmp1));
          var $tmp2 = Fay$$_(Fay$$index(1,Fay$$_($tmp1)));
          if ($tmp2 instanceof Fay$$Cons) {
            var cs = $tmp2.cdr;
            return Fay$$_(Fay$$_(Fay$$cons)(a))(Fay$$_(Prelude.lines)(cs));
          }
        }
        return (function(){ throw (["unhandled case",$tmp1]); })();
      })(Fay$$_(Fay$$_(Prelude.$_break)(isLineBreak))(s));
    })();
  });
};
Prelude.unlines = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return null;
    }
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      var l = $tmp1.car;
      var ls = $tmp1.cdr;
      return Fay$$_(Fay$$_(Prelude.$43$$43$)(l))(Fay$$_(Fay$$_(Fay$$cons)("\n"))(Fay$$_(Prelude.unlines)(ls)));
    }
    throw ["unhandled case in unlines",[$p1]];
  });
};
Prelude.words = function($p1){
  return new Fay$$$(function(){
    var str = $p1;
    return (function(){
      var words$39$ = function($p1){
        return new Fay$$$(function(){
          if (Fay$$_($p1) === null) {
            return null;
          }
          var s = $p1;
          return (function($tmp1){
            if (Fay$$listLen(Fay$$_($tmp1),2)) {
              var a = Fay$$index(0,Fay$$_($tmp1));
              var b = Fay$$index(1,Fay$$_($tmp1));
              return Fay$$_(Fay$$_(Fay$$cons)(a))(Fay$$_(Prelude.words)(b));
            }
            return (function(){ throw (["unhandled case",$tmp1]); })();
          })(Fay$$_(Fay$$_(Prelude.$_break)(isSpace))(s));
        });
      };
      var isSpace = function($p1){
        return new Fay$$$(function(){
          var c = $p1;
          return Fay$$_(Fay$$_(Prelude.elem)(c))(Fay$$list(" \t\r\n\u000c\u000b"));
        });
      };
      return Fay$$_(words$39$)(Fay$$_(Fay$$_(Prelude.dropWhile)(isSpace))(str));
    })();
  });
};
Prelude.unwords = new Fay$$$(function(){
  return Fay$$_(Prelude.intercalate)(Fay$$list(" "));
});
Prelude.and = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return true;
    }
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      var x = $tmp1.car;
      var xs = $tmp1.cdr;
      return Fay$$_(Fay$$_(Fay$$and)(x))(Fay$$_(Prelude.and)(xs));
    }
    throw ["unhandled case in and",[$p1]];
  });
};
Prelude.or = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return false;
    }
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      var x = $tmp1.car;
      var xs = $tmp1.cdr;
      return Fay$$_(Fay$$_(Fay$$or)(x))(Fay$$_(Prelude.or)(xs));
    }
    throw ["unhandled case in or",[$p1]];
  });
};
Prelude.any = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        return false;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var p = $p1;
        return Fay$$_(Fay$$_(Fay$$or)(Fay$$_(p)(x)))(Fay$$_(Fay$$_(Prelude.any)(p))(xs));
      }
      throw ["unhandled case in any",[$p1,$p2]];
    });
  };
};
Prelude.all = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        return true;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var p = $p1;
        return Fay$$_(Fay$$_(Fay$$and)(Fay$$_(p)(x)))(Fay$$_(Fay$$_(Prelude.all)(p))(xs));
      }
      throw ["unhandled case in all",[$p1,$p2]];
    });
  };
};
Prelude.intersperse = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        return null;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var sep = $p1;
        return Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(Fay$$_(Prelude.prependToAll)(sep))(xs));
      }
      throw ["unhandled case in intersperse",[$p1,$p2]];
    });
  };
};
Prelude.prependToAll = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        return null;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var sep = $p1;
        return Fay$$_(Fay$$_(Fay$$cons)(sep))(Fay$$_(Fay$$_(Fay$$cons)(x))(Fay$$_(Fay$$_(Prelude.prependToAll)(sep))(xs)));
      }
      throw ["unhandled case in prependToAll",[$p1,$p2]];
    });
  };
};
Prelude.intercalate = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var xss = $p2;
      var xs = $p1;
      return Fay$$_(Prelude.concat)(Fay$$_(Fay$$_(Prelude.intersperse)(xs))(xss));
    });
  };
};
Prelude.maximum = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return Fay$$_(Prelude.error)(Fay$$list("maximum: empty list"));
    }
    var xs = $p1;
    return Fay$$_(Fay$$_(Prelude.foldl1)(Prelude.max))(xs);
  });
};
Prelude.minimum = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return Fay$$_(Prelude.error)(Fay$$list("minimum: empty list"));
    }
    var xs = $p1;
    return Fay$$_(Fay$$_(Prelude.foldl1)(Prelude.min))(xs);
  });
};
Prelude.product = function($p1){
  return new Fay$$$(function(){
    var xs = $p1;
    return Fay$$_(Fay$$_(Fay$$_(Prelude.foldl)(Fay$$mult))(1))(xs);
  });
};
Prelude.sum = function($p1){
  return new Fay$$$(function(){
    var xs = $p1;
    return Fay$$_(Fay$$_(Fay$$_(Prelude.foldl)(Fay$$add))(0))(xs);
  });
};
Prelude.scanl = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var l = $p3;
        var z = $p2;
        var f = $p1;
        return Fay$$_(Fay$$_(Fay$$cons)(z))((function($tmp1){
          if (Fay$$_($tmp1) === null) {
            return null;
          }
          var $tmp2 = Fay$$_($tmp1);
          if ($tmp2 instanceof Fay$$Cons) {
            var x = $tmp2.car;
            var xs = $tmp2.cdr;
            return Fay$$_(Fay$$_(Fay$$_(Prelude.scanl)(f))(Fay$$_(Fay$$_(f)(z))(x)))(xs);
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(l));
      });
    };
  };
};
Prelude.scanl1 = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        return null;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var f = $p1;
        return Fay$$_(Fay$$_(Fay$$_(Prelude.scanl)(f))(x))(xs);
      }
      throw ["unhandled case in scanl1",[$p1,$p2]];
    });
  };
};
Prelude.scanr = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        if (Fay$$_($p3) === null) {
          var z = $p2;
          return Fay$$list([z]);
        }
        var $tmp1 = Fay$$_($p3);
        if ($tmp1 instanceof Fay$$Cons) {
          var x = $tmp1.car;
          var xs = $tmp1.cdr;
          var z = $p2;
          var f = $p1;
          return (function($tmp1){
            var $tmp2 = Fay$$_($tmp1);
            if ($tmp2 instanceof Fay$$Cons) {
              var h = $tmp2.car;
              var t = $tmp2.cdr;
              return Fay$$_(Fay$$_(Fay$$cons)(Fay$$_(Fay$$_(f)(x))(h)))(Fay$$_(Fay$$_(Fay$$cons)(h))(t));
            }
            return Prelude.$_undefined;
          })(Fay$$_(Fay$$_(Fay$$_(Prelude.scanr)(f))(z))(xs));
        }
        throw ["unhandled case in scanr",[$p1,$p2,$p3]];
      });
    };
  };
};
Prelude.scanr1 = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        return null;
      }
      if (Fay$$listLen(Fay$$_($p2),1)) {
        var x = Fay$$index(0,Fay$$_($p2));
        return Fay$$list([x]);
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var x = $tmp1.car;
        var xs = $tmp1.cdr;
        var f = $p1;
        return (function($tmp1){
          var $tmp2 = Fay$$_($tmp1);
          if ($tmp2 instanceof Fay$$Cons) {
            var h = $tmp2.car;
            var t = $tmp2.cdr;
            return Fay$$_(Fay$$_(Fay$$cons)(Fay$$_(Fay$$_(f)(x))(h)))(Fay$$_(Fay$$_(Fay$$cons)(h))(t));
          }
          return Prelude.$_undefined;
        })(Fay$$_(Fay$$_(Prelude.scanr1)(f))(xs));
      }
      throw ["unhandled case in scanr1",[$p1,$p2]];
    });
  };
};
Prelude.lookup = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) === null) {
        var _key = $p1;
        return Prelude.Nothing;
      }
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        if (Fay$$listLen(Fay$$_($tmp1.car),2)) {
          var x = Fay$$index(0,Fay$$_($tmp1.car));
          var y = Fay$$index(1,Fay$$_($tmp1.car));
          var xys = $tmp1.cdr;
          var key = $p1;
          return Fay$$_(Fay$$_(Fay$$_(Fay$$eq)(key))(x)) ? Fay$$_(Prelude.Just)(y) : Fay$$_(Fay$$_(Prelude.lookup)(key))(xys);
        }
      }
      throw ["unhandled case in lookup",[$p1,$p2]];
    });
  };
};
Prelude.length = function($p1){
  return new Fay$$$(function(){
    var xs = $p1;
    return Fay$$_(Fay$$_(Prelude.length$39$)(0))(xs);
  });
};
Prelude.length$39$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var $tmp1 = Fay$$_($p2);
      if ($tmp1 instanceof Fay$$Cons) {
        var xs = $tmp1.cdr;
        var acc = $p1;
        return Fay$$_(Fay$$_(Prelude.length$39$)(Fay$$_(Fay$$_(Fay$$add)(acc))(1)))(xs);
      }
      var acc = $p1;
      return acc;
    });
  };
};
Prelude.reverse = function($p1){
  return new Fay$$$(function(){
    var $tmp1 = Fay$$_($p1);
    if ($tmp1 instanceof Fay$$Cons) {
      var x = $tmp1.car;
      var xs = $tmp1.cdr;
      return Fay$$_(Fay$$_(Prelude.$43$$43$)(Fay$$_(Prelude.reverse)(xs)))(Fay$$list([x]));
    }
    if (Fay$$_($p1) === null) {
      return null;
    }
    throw ["unhandled case in reverse",[$p1]];
  });
};
Prelude.print = function($p1){
  return new Fay$$$(function(){
    return new Fay$$Monad(Fay$$jsToFay(["unknown"],(function(x) { if (console && console.log) console.log(x) })(Fay$$fayToJs(["automatic"],$p1))));
  });
};
Prelude.putStrLn = function($p1){
  return new Fay$$$(function(){
    return new Fay$$Monad(Fay$$jsToFay(["unknown"],(function(x) { if (console && console.log) console.log(x) })(Fay$$fayToJs_string($p1))));
  });
};
Fay$$objConcat(Fay$$fayToJsHash,{"Just": function(type,argTypes,_obj){
  var obj_ = {"instance": "Just"};
  var obj_slot1 = Fay$$fayToJs(argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],_obj.slot1);
  if (undefined !== obj_slot1) {
    obj_['slot1'] = obj_slot1;
  }
  return obj_;
},"Nothing": function(type,argTypes,_obj){
  var obj_ = {"instance": "Nothing"};
  return obj_;
},"Left": function(type,argTypes,_obj){
  var obj_ = {"instance": "Left"};
  var obj_slot1 = Fay$$fayToJs(argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],_obj.slot1);
  if (undefined !== obj_slot1) {
    obj_['slot1'] = obj_slot1;
  }
  return obj_;
},"Right": function(type,argTypes,_obj){
  var obj_ = {"instance": "Right"};
  var obj_slot1 = Fay$$fayToJs(argTypes && (argTypes)[1] ? (argTypes)[1] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],_obj.slot1);
  if (undefined !== obj_slot1) {
    obj_['slot1'] = obj_slot1;
  }
  return obj_;
},"GT": function(type,argTypes,_obj){
  var obj_ = {"instance": "GT"};
  return obj_;
},"LT": function(type,argTypes,_obj){
  var obj_ = {"instance": "LT"};
  return obj_;
},"EQ": function(type,argTypes,_obj){
  var obj_ = {"instance": "EQ"};
  return obj_;
}});
Fay$$objConcat(Fay$$jsToFayHash,{"Just": function(type,argTypes,obj){
  return new Prelude._Just(Fay$$jsToFay(argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],obj["slot1"]));
},"Nothing": function(type,argTypes,obj){
  return new Prelude._Nothing();
},"Left": function(type,argTypes,obj){
  return new Prelude._Left(Fay$$jsToFay(argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],obj["slot1"]));
},"Right": function(type,argTypes,obj){
  return new Prelude._Right(Fay$$jsToFay(argTypes && (argTypes)[1] ? (argTypes)[1] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],obj["slot1"]));
},"GT": function(type,argTypes,obj){
  return new Prelude._GT();
},"LT": function(type,argTypes,obj){
  return new Prelude._LT();
},"EQ": function(type,argTypes,obj){
  return new Prelude._EQ();
}});
var FFI = {};
Fay.Text = {};
Fay.Text._Text = function Text(){
};
Fay.Text.Text = new Fay$$$(function(){
  return new Fay.Text._Text();
});
Fay.Text.pack = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay(["user","Text",[]],Fay$$fayToJs_string($p1));
  });
};
Fay.Text.unpack = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_string(Fay$$fayToJs(["user","Text",[]],$p1));
  });
};
Fay.Text.fromString = new Fay$$$(function(){
  return Fay.Text.pack;
});
Fay$$objConcat(Fay$$fayToJsHash,{"Text": function(type,argTypes,_obj){
  var obj_ = {"instance": "Text"};
  return obj_;
}});
Fay$$objConcat(Fay$$jsToFayHash,{"Text": function(type,argTypes,obj){
  return new Fay.Text._Text();
}});
var Pickler = {};
Pickler.Text = {};
Pickler.Text.lower = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay(["user","Text",[]],Fay$$fayToJs(["user","Text",[]],$p1).toLowerCase());
  });
};
Pickler.Text.split = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return Fay$$jsToFay(["list",[["user","Text",[]]]],Fay$$fayToJs(["user","Text",[]],$p2).split(Fay$$fayToJs(["user","Text",[]],$p1)));
    });
  };
};
Pickler.Text.join = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return Fay$$jsToFay(["user","Text",[]],Fay$$fayToJs(["list",[["user","Text",[]]]],$p2).join(Fay$$fayToJs(["user","Text",[]],$p1)));
    });
  };
};
Pickler.Text.textLength = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay_int(Fay$$fayToJs(["user","Text",[]],$p1).length);
  });
};
Pickler.Text.$60$$62$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return Fay$$jsToFay(["user","Text",[]],Fay$$fayToJs(["user","Text",[]],$p1) + Fay$$fayToJs(["user","Text",[]],$p2));
    });
  };
};
Pickler.Object = {};
Pickler.Object.emptyObj = new Fay$$$(function(){
  return Fay$$jsToFay(["user","Object",[["unknown"]]],{});
});
Pickler.Object.get = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return Fay$$jsToFay(["automatic"],Fay$$fayToJs(["user","Object",[["tuple",[["unknown"],["unknown"]]]]],$p2)[Fay$$fayToJs(["user","Text",[]],$p1)]);
    });
  };
};
Pickler.Object.has = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      return Fay$$jsToFay_bool(Fay$$fayToJs(["user","Object",[["unknown"]]],$p2)[Fay$$fayToJs(["user","Text",[]],$p1)] !== undefined);
    });
  };
};
Pickler.Object.set = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        return Fay$$jsToFay(["user","Object",[["tuple",[["unknown"],["unknown"]]]]],(function (k, v, i)
 { var o = {};
 for (var p in i) o[p] = i[p];
 o[k] = v;
 return o; })
(Fay$$fayToJs(["user","Text",[]],$p1), Fay$$fayToJs(["automatic"],$p2), Fay$$fayToJs(["user","Object",[["unknown"]]],$p3)));
      });
    };
  };
};
Pickler.Object.cast = function($p1){
  return new Fay$$$(function(){
    return Fay$$jsToFay(["user","Object",[["unknown"]]],Fay$$fayToJs(["user","Object",[["tuple",[["unknown"],["unknown"]]]]],$p1));
  });
};
var Strict = {};
Strict.Pickler = {};
Pickler._Prim = function Prim(slot1){
  this.slot1 = slot1;
};
Pickler.Prim = function(slot1){
  return new Fay$$$(function(){
    return new Pickler._Prim(slot1);
  });
};
Pickler._And = function And(slot1,slot2){
  this.slot1 = slot1;
  this.slot2 = slot2;
};
Pickler.And = function(slot1){
  return function(slot2){
    return new Fay$$$(function(){
      return new Pickler._And(slot1,slot2);
    });
  };
};
Pickler._Or = function Or(slot1,slot2){
  this.slot1 = slot1;
  this.slot2 = slot2;
};
Pickler.Or = function(slot1){
  return function(slot2){
    return new Fay$$$(function(){
      return new Pickler._Or(slot1,slot2);
    });
  };
};
Pickler._Many = function Many(slot1){
  this.slot1 = slot1;
};
Pickler.Many = function(slot1){
  return new Fay$$$(function(){
    return new Pickler._Many(slot1);
  });
};
Pickler._Some = function Some(slot1){
  this.slot1 = slot1;
};
Pickler.Some = function(slot1){
  return new Fay$$$(function(){
    return new Pickler._Some(slot1);
  });
};
Pickler.showError = new Fay$$$(function(){
  return new Fay$$$(function(){
    var go = function($p1){
      return new Fay$$$(function(){
        var e = $p1;
        return (function($tmp1){
          if (Fay$$_($tmp1) instanceof Pickler._Prim) {
            var t = Fay$$_($tmp1).slot1;
            return Fay$$list([t]);
          }
          if (Fay$$_($tmp1) instanceof Pickler._And) {
            var a = Fay$$_($tmp1).slot1;
            var b = Fay$$_($tmp1).slot2;
            return Fay$$_(paren)(Fay$$_(Fay$$_(Prelude.$43$$43$)(Fay$$_(go)(a)))(Fay$$_(Fay$$_(Prelude.$43$$43$)(Fay$$list(["and"])))(Fay$$_(go)(b))));
          }
          if (Fay$$_($tmp1) instanceof Pickler._Or) {
            var a = Fay$$_($tmp1).slot1;
            var b = Fay$$_($tmp1).slot2;
            return Fay$$_(paren)(Fay$$_(Fay$$_(Prelude.$43$$43$)(Fay$$_(go)(a)))(Fay$$_(Fay$$_(Prelude.$43$$43$)(Fay$$list(["or"])))(Fay$$_(go)(b))));
          }
          if (Fay$$_($tmp1) instanceof Pickler._Many) {
            var a = Fay$$_($tmp1).slot1;
            return Fay$$_(paren)(Fay$$_(Fay$$_(Prelude.$43$$43$)(Fay$$list(["many of"])))(Fay$$_(go)(a)));
          }
          if (Fay$$_($tmp1) instanceof Pickler._Some) {
            var a = Fay$$_($tmp1).slot1;
            return Fay$$_(paren)(Fay$$_(Fay$$_(Prelude.$43$$43$)(Fay$$list(["some of"])))(Fay$$_(go)(a)));
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(e);
      });
    };
    var paren = function($p1){
      return new Fay$$$(function(){
        var x = $p1;
        return Fay$$_(Fay$$_(Prelude.$43$$43$)(Fay$$list(["("])))(Fay$$_(Fay$$_(Prelude.$43$$43$)(x))(Fay$$list([")"])));
      });
    };
    return Fay$$_(Fay$$_(Prelude.$46$)(Fay$$_(Pickler.Text.join)(" ")))(go);
  });
});
Pickler._Pickler = function Pickler(_parser,_printer,_label){
  this._parser = _parser;
  this._printer = _printer;
  this._label = _label;
};
Pickler.Pickler = function(_parser){
  return function(_printer){
    return function(_label){
      return new Fay$$$(function(){
        return new Pickler._Pickler(_parser,_printer,_label);
      });
    };
  };
};
Pickler._parser = function(x){
  return new Fay$$$(function(){
    return Fay$$_(x)._parser;
  });
};
Pickler._printer = function(x){
  return new Fay$$$(function(){
    return Fay$$_(x)._printer;
  });
};
Pickler._label = function(x){
  return new Fay$$$(function(){
    return Fay$$_(x)._label;
  });
};
Pickler.parser = function($p1){
  return function($p2){
    return function($p3){
      return function($p4){
        return new Fay$$$(function(){
          var ok = $p4;
          var err = $p3;
          var i = $p2;
          var p = $p1;
          return (function($tmp1){
            if (Fay$$_($tmp1) instanceof Prelude._Left) {
              var e = Fay$$_($tmp1).slot1;
              return Fay$$_(err)(e);
            }
            if (Fay$$_($tmp1) instanceof Prelude._Right) {
              if (Fay$$listLen(Fay$$_(Fay$$_($tmp1).slot1),2)) {
                var r = Fay$$index(0,Fay$$_(Fay$$_($tmp1).slot1));
                return Fay$$_(ok)(r);
              }
            }
            return (function(){ throw (["unhandled case",$tmp1]); })();
          })(Fay$$_(Fay$$_(Pickler._parser)(p))(i));
        });
      };
    };
  };
};
Pickler.printer = function($p1){
  return function($p2){
    return function($p3){
      return function($p4){
        return new Fay$$$(function(){
          var ok = $p4;
          var err = $p3;
          var o = $p2;
          var p = $p1;
          return (function($tmp1){
            if (Fay$$_($tmp1) instanceof Prelude._Left) {
              var e = Fay$$_($tmp1).slot1;
              return Fay$$_(err)(e);
            }
            if (Fay$$_($tmp1) instanceof Prelude._Right) {
              var r = Fay$$_($tmp1).slot1;
              return Fay$$_(ok)(r);
            }
            return (function(){ throw (["unhandled case",$tmp1]); })();
          })(Fay$$_(Fay$$_(Pickler._printer)(p))(o));
        });
      };
    };
  };
};
Pickler.parseAnd = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var xs = $p3;
        var cont = $p2;
        var p = $p1;
        return (function($tmp1){
          if (Fay$$_($tmp1) instanceof Prelude._Left) {
            var e = Fay$$_($tmp1).slot1;
            return Fay$$_(Prelude.Left)(e);
          }
          if (Fay$$_($tmp1) instanceof Prelude._Right) {
            if (Fay$$listLen(Fay$$_(Fay$$_($tmp1).slot1),2)) {
              var o = Fay$$index(0,Fay$$_(Fay$$_($tmp1).slot1));
              var ys = Fay$$index(1,Fay$$_(Fay$$_($tmp1).slot1));
              return Fay$$_(Fay$$_(cont)(o))(ys);
            }
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(Fay$$_(Fay$$_(Pickler._parser)(p))(xs));
      });
    };
  };
};
Pickler.parseOr = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var xs = $p3;
        var cont = $p2;
        var p = $p1;
        return (function($tmp1){
          if (Fay$$_($tmp1) instanceof Prelude._Left) {
            var e = Fay$$_($tmp1).slot1;
            return Fay$$_(Fay$$_(cont)(e))(xs);
          }
          if (Fay$$_($tmp1) instanceof Prelude._Right) {
            var o = Fay$$_($tmp1).slot1;
            return Fay$$_(Prelude.Right)(o);
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(Fay$$_(Fay$$_(Pickler._parser)(p))(xs));
      });
    };
  };
};
Pickler.printAnd = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var xs = $p3;
        var cont = $p2;
        var p = $p1;
        return (function($tmp1){
          if (Fay$$_($tmp1) instanceof Prelude._Left) {
            var e = Fay$$_($tmp1).slot1;
            return Fay$$_(Prelude.Left)(e);
          }
          if (Fay$$_($tmp1) instanceof Prelude._Right) {
            var i = Fay$$_($tmp1).slot1;
            return Fay$$_(Fay$$_(cont)(i))(xs);
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(Fay$$_(Fay$$_(Pickler._printer)(p))(xs));
      });
    };
  };
};
Pickler.printOr = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var xs = $p3;
        var cont = $p2;
        var p = $p1;
        return (function($tmp1){
          if (Fay$$_($tmp1) instanceof Prelude._Left) {
            var e = Fay$$_($tmp1).slot1;
            return Fay$$_(Fay$$_(cont)(e))(xs);
          }
          if (Fay$$_($tmp1) instanceof Prelude._Right) {
            var i = Fay$$_($tmp1).slot1;
            return Fay$$_(Prelude.Right)(i);
          }
          return (function(){ throw (["unhandled case",$tmp1]); })();
        })(Fay$$_(Fay$$_(Pickler._printer)(p))(xs));
      });
    };
  };
};
Pickler.$_label = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var a = $p2;
      var l = $p1;
      return (function(){
        var p = new Fay$$$(function(){
          return Fay$$_(Fay$$_(Pickler.parseOr)(a))(e);
        });
        var q = new Fay$$$(function(){
          return Fay$$_(Fay$$_(Pickler.printOr)(a))(e);
        });
        var e = function($p1){
          return function($p2){
            return new Fay$$$(function(){
              return Fay$$_(Prelude.Left)(l);
            });
          };
        };
        return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(l);
      })();
    });
  };
};
Pickler.$_for = new Fay$$$(function(){
  return Pickler.$62$$45$;
});
Pickler.fmap = new Fay$$$(function(){
  return Pickler.$60$$36$$62$;
});
Pickler.app = new Fay$$$(function(){
  return Pickler.$60$$42$$62$;
});
Pickler.alt = new Fay$$$(function(){
  return Pickler.$60$$124$$62$;
});
Pickler.$60$$36$$62$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var a = $p2;
      var f = $p1;
      return (function(){
        var p = new Fay$$$(function(){
          return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.parseAnd)(a)))(function($p1){
            var o = $p1;
            return Fay$$_(Fay$$_(Prelude.$46$)(Prelude.Right))(Fay$$_(function($p1){
              var $gen_1 = $p1;
              return function($p2){
                var $gen_2 = $p2;
                return Fay$$list([$gen_1,$gen_2]);
              };
            })(Fay$$_(f)(o)));
          });
        });
        var q = new Fay$$$(function(){
          return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.printAnd)(a)))(function($p1){
            var i = $p1;
            return Fay$$_(Fay$$_(Prelude.$36$)(Prelude.$_const))(Fay$$_(Prelude.Right)(i));
          });
        });
        var w = new Fay$$$(function(){
          return Fay$$_(Pickler._label)(a);
        });
        return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(w);
      })();
    });
  };
};
Pickler.bimap = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var a = $p3;
        var g = $p2;
        var f = $p1;
        return (function(){
          var p = new Fay$$$(function(){
            return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.parseAnd)(a)))(function($p1){
              var o = $p1;
              return Fay$$_(Fay$$_(Prelude.$46$)(Prelude.Right))(Fay$$_(function($p1){
                var $gen_1 = $p1;
                return function($p2){
                  var $gen_2 = $p2;
                  return Fay$$list([$gen_1,$gen_2]);
                };
              })(Fay$$_(f)(o)));
            });
          });
          var q = new Fay$$$(function(){
            return Fay$$_(Fay$$_(Prelude.$46$)(Fay$$_(Fay$$_(Pickler.printAnd)(a))(function($p1){
              var i = $p1;
              return Fay$$_(Fay$$_(Prelude.$36$)(Prelude.$_const))(Fay$$_(Prelude.Right)(i));
            })))(g);
          });
          var w = new Fay$$$(function(){
            return Fay$$_(Pickler._label)(a);
          });
          return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(w);
        })();
      });
    };
  };
};
Pickler.$62$$45$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      if (Fay$$_($p2) instanceof Pickler._Pickler) {
        var p = Fay$$_($p2)._parser;
        var q = Fay$$_($p2)._printer;
        var w = Fay$$_($p2)._label;
        var f = $p1;
        return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(Fay$$_(Fay$$_(Prelude.$46$)(q))(f)))(w);
      }
      throw ["unhandled case in (\u003e-)",[$p1,$p2]];
    });
  };
};
Pickler.pure = function($p1){
  return new Fay$$$(function(){
    var o = $p1;
    return (function(){
      var p = new Fay$$$(function(){
        return Fay$$_(Fay$$_(Prelude.$46$)(Prelude.Right))(Fay$$_(function($p1){
          var $gen_1 = $p1;
          return function($p2){
            var $gen_2 = $p2;
            return Fay$$list([$gen_1,$gen_2]);
          };
        })(o));
      });
      var q = new Fay$$$(function(){
        return Fay$$_(Prelude.$_const)(Fay$$_(Prelude.Right)(null));
      });
      var w = new Fay$$$(function(){
        return Fay$$_(Pickler.Prim)("pure");
      });
      return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(w);
    })();
  });
};
Pickler.prints = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var i = $p2;
      var a = $p1;
      return (function(){
        var p = new Fay$$$(function(){
          return Fay$$_(Pickler._parser)(a);
        });
        var q = new Fay$$$(function(){
          return Fay$$_(Prelude.$_const)(Fay$$_(Prelude.Right)(i));
        });
        var w = new Fay$$$(function(){
          return Fay$$_(Pickler.Prim)("prints");
        });
        return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(w);
      })();
    });
  };
};
Pickler.$60$$42$$62$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var b = $p2;
      var a = $p1;
      return (function(){
        var p = new Fay$$$(function(){
          return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.parseAnd)(a)))(function($p1){
            var f = $p1;
            return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.parseAnd)(b)))(function($p1){
              var o = $p1;
              return Fay$$_(Fay$$_(Prelude.$46$)(Prelude.Right))(Fay$$_(function($p1){
                var $gen_1 = $p1;
                return function($p2){
                  var $gen_2 = $p2;
                  return Fay$$list([$gen_1,$gen_2]);
                };
              })(Fay$$_(f)(o)));
            });
          });
        });
        var q = new Fay$$$(function(){
          return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.printAnd)(a)))(function($p1){
            var i = $p1;
            return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.printAnd)(b)))(function($p1){
              var j = $p1;
              return Fay$$_(Fay$$_(Prelude.$36$)(Prelude.$_const))(Fay$$_(Prelude.Right)(Fay$$_(Fay$$_(Prelude.$43$$43$)(i))(j)));
            });
          });
        });
        var w = new Fay$$$(function(){
          return Fay$$_(Fay$$_(Pickler.And)(Fay$$_(Pickler._label)(a)))(Fay$$_(Pickler._label)(b));
        });
        return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(w);
      })();
    });
  };
};
Pickler.$60$$42$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var q = $p2;
      var p = $p1;
      return Fay$$_(Fay$$_(Pickler.$60$$42$$62$)(Fay$$_(Fay$$_(Pickler.$60$$36$$62$)(Prelude.$_const))(p)))(q);
    });
  };
};
Pickler.$42$$62$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var q = $p2;
      var p = $p1;
      return Fay$$_(Fay$$_(Pickler.$60$$42$$62$)(Fay$$_(Fay$$_(Pickler.$60$$36$$62$)(Fay$$_(Prelude.flip)(Prelude.$_const)))(p)))(q);
    });
  };
};
Pickler.$60$$124$$62$ = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var b = $p2;
      var a = $p1;
      return (function(){
        var p = new Fay$$$(function(){
          return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.parseOr)(a)))(function($p1){
            var e = $p1;
            return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.parseOr)(b)))(function($p1){
              var f = $p1;
              return Fay$$_(Prelude.$_const)(Fay$$_(Prelude.Left)(Fay$$_(Fay$$_(Pickler.Or)(e))(f)));
            });
          });
        });
        var q = new Fay$$$(function(){
          return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.printOr)(a)))(function($p1){
            var e = $p1;
            return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.printOr)(b)))(function($p1){
              var f = $p1;
              return Fay$$_(Prelude.$_const)(Fay$$_(Prelude.Left)(Fay$$_(Fay$$_(Pickler.Or)(e))(f)));
            });
          });
        });
        var w = new Fay$$$(function(){
          return Fay$$_(Fay$$_(Pickler.Or)(Fay$$_(Pickler._label)(a)))(Fay$$_(Pickler._label)(b));
        });
        return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(w);
      })();
    });
  };
};
Pickler.guards = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var a = $p2;
      var g = $p1;
      return (function(){
        var q = function($p1){
          return new Fay$$$(function(){
            var i = $p1;
            if (Fay$$_(Fay$$_(g)(i))) {
              return Fay$$_(Fay$$_(Pickler._printer)(a))(i);
            }
            return Fay$$_(Prelude.Left)(Fay$$_(Pickler._label)(a));
          });
        };
        return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(Fay$$_(Pickler._parser)(a)))(q))(Fay$$_(Pickler._label)(a));
      })();
    });
  };
};
Pickler.msum = new Fay$$$(function(){
  return Fay$$_(Prelude.foldl1)(Pickler.$60$$124$$62$);
});
Pickler.option = function($p1){
  return new Fay$$$(function(){
    var d = $p1;
    return function($p1){
      var $gen_0 = $p1;
      return Fay$$_(Fay$$_(Pickler.$60$$124$$62$)($gen_0))(Fay$$_(Pickler.pure)(d));
    };
  });
};
Pickler.many = function($p1){
  return new Fay$$$(function(){
    var p = $p1;
    return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.$_label)(Fay$$_(Pickler.Many)(Fay$$_(Pickler._label)(p)))))(Fay$$_(Fay$$_(Pickler.$60$$124$$62$)(Fay$$_(Fay$$_(Pickler.guards)(Pickler.cons))(Fay$$_(Fay$$_(Pickler.$60$$42$$62$)(Fay$$_(Fay$$_(Pickler.$60$$36$$62$)(Fay$$cons))(Fay$$_(Fay$$_(Pickler.$62$$45$)(Prelude.head))(p))))(Fay$$_(Fay$$_(Pickler.$62$$45$)(Prelude.tail))(Fay$$_(Pickler.many)(p))))))(Fay$$_(Fay$$_(Pickler.guards)(Pickler.nil))(Fay$$_(Pickler.pure)(null))));
  });
};
Pickler.some = function($p1){
  return new Fay$$$(function(){
    var p = $p1;
    return Fay$$_(Fay$$_(Prelude.$36$)(Fay$$_(Pickler.$_label)(Fay$$_(Pickler.Some)(Fay$$_(Pickler._label)(p)))))(Fay$$_(Fay$$_(Pickler.guards)(Pickler.cons))(Fay$$_(Fay$$_(Pickler.$60$$42$$62$)(Fay$$_(Fay$$_(Pickler.$60$$36$$62$)(Fay$$cons))(Fay$$_(Fay$$_(Pickler.$62$$45$)(Prelude.head))(p))))(Fay$$_(Fay$$_(Pickler.$62$$45$)(Prelude.tail))(Fay$$_(Pickler.many)(p)))));
  });
};
Pickler.cons = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return false;
    }
    return true;
  });
};
Pickler.nil = function($p1){
  return new Fay$$$(function(){
    if (Fay$$_($p1) === null) {
      return true;
    }
    return true;
  });
};
Pickler.tuple = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var b = $p2;
      var a = $p1;
      return Fay$$_(Fay$$_(Pickler.$60$$42$$62$)(Fay$$_(Fay$$_(Pickler.$60$$36$$62$)(function($p1){
        var $gen_1 = $p1;
        return function($p2){
          var $gen_2 = $p2;
          return Fay$$list([$gen_1,$gen_2]);
        };
      }))(Fay$$_(Fay$$_(Pickler.$62$$45$)(Prelude.fst))(a))))(Fay$$_(Fay$$_(Pickler.$62$$45$)(Prelude.snd))(b));
    });
  };
};
Pickler.withDefault = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var a = $p2;
      var g = $p1;
      return (function(){
        var q = function($p1){
          return new Fay$$$(function(){
            var i = $p1;
            if (Fay$$_(Fay$$_(g)(i))) {
              return Fay$$_(Prelude.Right)(null);
            }
            var i = $p1;
            return Fay$$_(Fay$$_(Pickler._printer)(a))(i);
          });
        };
        return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(Fay$$_(Pickler._parser)(a)))(q))(Fay$$_(Pickler._label)(a));
      })();
    });
  };
};
Pickler.any = new Fay$$$(function(){
  return new Fay$$$(function(){
    var p = function($p1){
      return new Fay$$$(function(){
        var $tmp1 = Fay$$_($p1);
        if ($tmp1 instanceof Fay$$Cons) {
          var x = $tmp1.car;
          var xs = $tmp1.cdr;
          return Fay$$_(Prelude.Right)(Fay$$list([x,xs]));
        }
        if (Fay$$_($p1) === null) {
          return Fay$$_(Prelude.Left)(w);
        }
        throw ["unhandled case in p",[$p1]];
      });
    };
    var q = function($p1){
      return new Fay$$$(function(){
        var x = $p1;
        return Fay$$_(Prelude.Right)(Fay$$list([x]));
      });
    };
    var w = new Fay$$$(function(){
      return Fay$$_(Pickler.Prim)("anything");
    });
    return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(w);
  });
});
Pickler.satisfy = function($p1){
  return new Fay$$$(function(){
    var f = $p1;
    return (function(){
      var p = function($p1){
        return new Fay$$$(function(){
          var $tmp1 = Fay$$_($p1);
          if ($tmp1 instanceof Fay$$Cons) {
            var x = $tmp1.car;
            var xs = $tmp1.cdr;
            if (Fay$$_(Fay$$_(f)(x))) {
              return Fay$$_(Prelude.Right)(Fay$$list([x,xs]));
            }
          }
          return Fay$$_(Prelude.Left)(w);
        });
      };
      var q = function($p1){
        return new Fay$$$(function(){
          var x = $p1;
          if (Fay$$_(Fay$$_(f)(x))) {
            return Fay$$_(Prelude.Right)(Fay$$list([x]));
          }
          return Fay$$_(Prelude.Left)(w);
        });
      };
      var w = new Fay$$$(function(){
        return Fay$$_(Pickler.Prim)("unsatisfied");
      });
      return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(w);
    })();
  });
};
Pickler.token = function($p1){
  return new Fay$$$(function(){
    var t = $p1;
    return (function(){
      var p = function($p1){
        return new Fay$$$(function(){
          var $tmp1 = Fay$$_($p1);
          if ($tmp1 instanceof Fay$$Cons) {
            var x = $tmp1.car;
            var xs = $tmp1.cdr;
            if (Fay$$_(Fay$$_(Fay$$_(Fay$$eq)(x))(t))) {
              return Fay$$_(Prelude.Right)(Fay$$list([t,xs]));
            }
          }
          return Fay$$_(Prelude.Left)(w);
        });
      };
      var q = function($p1){
        return new Fay$$$(function(){
          var x = $p1;
          if (Fay$$_(Fay$$_(Fay$$_(Fay$$eq)(x))(t))) {
            return Fay$$_(Prelude.Right)(Fay$$list([t]));
          }
          return Fay$$_(Prelude.Left)(w);
        });
      };
      var w = new Fay$$$(function(){
        return Fay$$_(Pickler.Prim)(Fay$$_(Fay$$_(Pickler.Text.$60$$62$)(Fay$$_(Fay$$_(Pickler.Text.$60$$62$)("token '"))(t)))("'"));
      });
      return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(w);
    })();
  });
};
Pickler.tokenI = function($p1){
  return new Fay$$$(function(){
    var t = $p1;
    return (function(){
      var p = function($p1){
        return new Fay$$$(function(){
          var $tmp1 = Fay$$_($p1);
          if ($tmp1 instanceof Fay$$Cons) {
            var x = $tmp1.car;
            var xs = $tmp1.cdr;
            if (Fay$$_(Fay$$_(Fay$$_(Fay$$eq)(Fay$$_(Pickler.Text.lower)(x)))(l))) {
              return Fay$$_(Prelude.Right)(Fay$$list([x,xs]));
            }
          }
          return Fay$$_(Prelude.Left)(w);
        });
      };
      var q = function($p1){
        return new Fay$$$(function(){
          var x = $p1;
          if (Fay$$_(Fay$$_(Fay$$_(Fay$$eq)(Fay$$_(Pickler.Text.lower)(x)))(l))) {
            return Fay$$_(Prelude.Right)(Fay$$list([x]));
          }
          return Fay$$_(Prelude.Left)(w);
        });
      };
      var l = new Fay$$$(function(){
        return Fay$$_(Pickler.Text.lower)(t);
      });
      var w = new Fay$$$(function(){
        return Fay$$_(Pickler.Prim)(Fay$$_(Fay$$_(Pickler.Text.$60$$62$)(Fay$$_(Fay$$_(Pickler.Text.$60$$62$)("token '"))(t)))("' (case insensitive)"));
      });
      return Fay$$_(Fay$$_(Fay$$_(Pickler.Pickler)(p))(q))(w);
    })();
  });
};
Pickler.oneOf = new Fay$$$(function(){
  return Fay$$_(Fay$$_(Prelude.$46$)(Pickler.msum))(Fay$$_(Prelude.map)(Pickler.token));
});
Pickler.oneOfI = new Fay$$$(function(){
  return Fay$$_(Fay$$_(Prelude.$46$)(Pickler.msum))(Fay$$_(Prelude.map)(Pickler.tokenI));
});
Pickler.prefix = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var p = $p2;
      var t = $p1;
      return Fay$$_(Fay$$_(Pickler.$42$$62$)(Fay$$_(Fay$$_(Pickler.prints)(Fay$$_(Pickler.tokenI)(t)))(Fay$$list([t]))))(p);
    });
  };
};
Pickler.prefixI = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var p = $p2;
      var t = $p1;
      return Fay$$_(Fay$$_(Pickler.$42$$62$)(Fay$$_(Fay$$_(Pickler.prints)(Fay$$_(Pickler.tokenI)(t)))(Fay$$list([t]))))(p);
    });
  };
};
Pickler.sep1I = function($p1){
  return function($p2){
    return new Fay$$$(function(){
      var p = $p2;
      var s = $p1;
      return Fay$$_(Fay$$_(Pickler.guards)(Pickler.cons))(Fay$$_(Fay$$_(Pickler.$60$$42$$62$)(Fay$$_(Fay$$_(Pickler.$60$$36$$62$)(Fay$$cons))(Fay$$_(Fay$$_(Pickler.$62$$45$)(Prelude.head))(p))))(Fay$$_(Fay$$_(Pickler.$62$$45$)(Prelude.tail))(Fay$$_(Pickler.many)(Fay$$_(Fay$$_(Pickler.prefixI)(s))(p)))));
    });
  };
};
Pickler.named = function($p1){
  return function($p2){
    return function($p3){
      return new Fay$$$(function(){
        var b = $p3;
        var a = $p2;
        var key = $p1;
        return Fay$$_(Fay$$_(Pickler.guards)(Fay$$_(Pickler.Object.has)(key)))(Fay$$_(Fay$$_(Pickler.$60$$42$$62$)(Fay$$_(Fay$$_(Pickler.$60$$36$$62$)(Fay$$_(Pickler.Object.set)(key)))(Fay$$_(Fay$$_(Pickler.$62$$45$)(Fay$$_(Pickler.Object.get)(key)))(a))))(Fay$$_(Fay$$_(Pickler.$62$$45$)(Pickler.Object.cast))(b)));
      });
    };
  };
};
Pickler.obj = new Fay$$$(function(){
  return Fay$$_(Pickler.pure)(Pickler.Object.emptyObj);
});
Strict.Pickler.alt = Fay$$fayToJs(['automatic'],Pickler.alt);
Strict.Pickler.any = Fay$$fayToJs(['automatic'],Pickler.any);
Strict.Pickler.app = Fay$$fayToJs(['automatic'],Pickler.app);
Strict.Pickler.bimap = Fay$$fayToJs(['automatic'],Pickler.bimap);
Strict.Pickler.cons = Fay$$fayToJs(['automatic'],Pickler.cons);
Strict.Pickler.fmap = Fay$$fayToJs(['automatic'],Pickler.fmap);
Strict.Pickler.$_for = Fay$$fayToJs(['automatic'],Pickler.$_for);
Strict.Pickler.guards = Fay$$fayToJs(['automatic'],Pickler.guards);
Strict.Pickler.$_label = Fay$$fayToJs(['automatic'],Pickler.$_label);
Strict.Pickler.many = Fay$$fayToJs(['automatic'],Pickler.many);
Strict.Pickler.msum = Fay$$fayToJs(['automatic'],Pickler.msum);
Strict.Pickler.named = Fay$$fayToJs(['automatic'],Pickler.named);
Strict.Pickler.nil = Fay$$fayToJs(['automatic'],Pickler.nil);
Strict.Pickler.obj = Fay$$fayToJs(['automatic'],Pickler.obj);
Strict.Pickler.oneOf = Fay$$fayToJs(['automatic'],Pickler.oneOf);
Strict.Pickler.oneOfI = Fay$$fayToJs(['automatic'],Pickler.oneOfI);
Strict.Pickler.option = Fay$$fayToJs(['automatic'],Pickler.option);
Strict.Pickler.parseAnd = Fay$$fayToJs(['automatic'],Pickler.parseAnd);
Strict.Pickler.parseOr = Fay$$fayToJs(['automatic'],Pickler.parseOr);
Strict.Pickler.parser = Fay$$fayToJs(['automatic'],Pickler.parser);
Strict.Pickler.prefix = Fay$$fayToJs(['automatic'],Pickler.prefix);
Strict.Pickler.prefixI = Fay$$fayToJs(['automatic'],Pickler.prefixI);
Strict.Pickler.printAnd = Fay$$fayToJs(['automatic'],Pickler.printAnd);
Strict.Pickler.printOr = Fay$$fayToJs(['automatic'],Pickler.printOr);
Strict.Pickler.printer = Fay$$fayToJs(['automatic'],Pickler.printer);
Strict.Pickler.prints = Fay$$fayToJs(['automatic'],Pickler.prints);
Strict.Pickler.pure = Fay$$fayToJs(['automatic'],Pickler.pure);
Strict.Pickler.satisfy = Fay$$fayToJs(['automatic'],Pickler.satisfy);
Strict.Pickler.sep1I = Fay$$fayToJs(['automatic'],Pickler.sep1I);
Strict.Pickler.showError = Fay$$fayToJs(['automatic'],Pickler.showError);
Strict.Pickler.some = Fay$$fayToJs(['automatic'],Pickler.some);
Strict.Pickler.token = Fay$$fayToJs(['automatic'],Pickler.token);
Strict.Pickler.tokenI = Fay$$fayToJs(['automatic'],Pickler.tokenI);
Strict.Pickler.tuple = Fay$$fayToJs(['automatic'],Pickler.tuple);
Strict.Pickler.withDefault = Fay$$fayToJs(['automatic'],Pickler.withDefault);
Strict.Pickler.$42$$62$ = Fay$$fayToJs(['automatic'],Pickler.$42$$62$);
Strict.Pickler.$60$$36$$62$ = Fay$$fayToJs(['automatic'],Pickler.$60$$36$$62$);
Strict.Pickler.$60$$42$ = Fay$$fayToJs(['automatic'],Pickler.$60$$42$);
Strict.Pickler.$60$$42$$62$ = Fay$$fayToJs(['automatic'],Pickler.$60$$42$$62$);
Strict.Pickler.$60$$124$$62$ = Fay$$fayToJs(['automatic'],Pickler.$60$$124$$62$);
Strict.Pickler.$62$$45$ = Fay$$fayToJs(['automatic'],Pickler.$62$$45$);
Fay$$objConcat(Fay$$fayToJsHash,{"Prim": function(type,argTypes,_obj){
  var obj_ = {"instance": "Prim"};
  var obj_slot1 = Fay$$fayToJs(["user","Text",[]],_obj.slot1);
  if (undefined !== obj_slot1) {
    obj_['slot1'] = obj_slot1;
  }
  return obj_;
},"And": function(type,argTypes,_obj){
  var obj_ = {"instance": "And"};
  var obj_slot1 = Fay$$fayToJs(["user","Expect",[]],_obj.slot1);
  if (undefined !== obj_slot1) {
    obj_['slot1'] = obj_slot1;
  }
  var obj_slot2 = Fay$$fayToJs(["user","Expect",[]],_obj.slot2);
  if (undefined !== obj_slot2) {
    obj_['slot2'] = obj_slot2;
  }
  return obj_;
},"Or": function(type,argTypes,_obj){
  var obj_ = {"instance": "Or"};
  var obj_slot1 = Fay$$fayToJs(["user","Expect",[]],_obj.slot1);
  if (undefined !== obj_slot1) {
    obj_['slot1'] = obj_slot1;
  }
  var obj_slot2 = Fay$$fayToJs(["user","Expect",[]],_obj.slot2);
  if (undefined !== obj_slot2) {
    obj_['slot2'] = obj_slot2;
  }
  return obj_;
},"Many": function(type,argTypes,_obj){
  var obj_ = {"instance": "Many"};
  var obj_slot1 = Fay$$fayToJs(["user","Expect",[]],_obj.slot1);
  if (undefined !== obj_slot1) {
    obj_['slot1'] = obj_slot1;
  }
  return obj_;
},"Some": function(type,argTypes,_obj){
  var obj_ = {"instance": "Some"};
  var obj_slot1 = Fay$$fayToJs(["user","Expect",[]],_obj.slot1);
  if (undefined !== obj_slot1) {
    obj_['slot1'] = obj_slot1;
  }
  return obj_;
},"Pickler": function(type,argTypes,_obj){
  var obj_ = {"instance": "Pickler"};
  var obj__parser = Fay$$fayToJs(["function",[["list",[argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"]]],["user","Either",[["user","Expect",[]],["tuple",[argTypes && (argTypes)[1] ? (argTypes)[1] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],["list",[argTypes && (argTypes)[1] ? (argTypes)[1] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"]]]]]]]]],_obj._parser);
  if (undefined !== obj__parser) {
    obj_['_parser'] = obj__parser;
  }
  var obj__printer = Fay$$fayToJs(["function",[argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],["user","Either",[["user","Expect",[]],["list",[argTypes && (argTypes)[1] ? (argTypes)[1] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"]]]]]]],_obj._printer);
  if (undefined !== obj__printer) {
    obj_['_printer'] = obj__printer;
  }
  var obj__label = Fay$$fayToJs(["user","Expect",[]],_obj._label);
  if (undefined !== obj__label) {
    obj_['_label'] = obj__label;
  }
  return obj_;
}});
Fay$$objConcat(Fay$$jsToFayHash,{"Prim": function(type,argTypes,obj){
  return new Pickler._Prim(Fay$$jsToFay(["user","Text",[]],obj["slot1"]));
},"And": function(type,argTypes,obj){
  return new Pickler._And(Fay$$jsToFay(["user","Expect",[]],obj["slot1"]),Fay$$jsToFay(["user","Expect",[]],obj["slot2"]));
},"Or": function(type,argTypes,obj){
  return new Pickler._Or(Fay$$jsToFay(["user","Expect",[]],obj["slot1"]),Fay$$jsToFay(["user","Expect",[]],obj["slot2"]));
},"Many": function(type,argTypes,obj){
  return new Pickler._Many(Fay$$jsToFay(["user","Expect",[]],obj["slot1"]));
},"Some": function(type,argTypes,obj){
  return new Pickler._Some(Fay$$jsToFay(["user","Expect",[]],obj["slot1"]));
},"Pickler": function(type,argTypes,obj){
  return new Pickler._Pickler(Fay$$jsToFay(["function",[["list",[argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"]]],["user","Either",[["user","Expect",[]],["tuple",[argTypes && (argTypes)[1] ? (argTypes)[1] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],["list",[argTypes && (argTypes)[1] ? (argTypes)[1] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"]]]]]]]]],obj["_parser"]),Fay$$jsToFay(["function",[argTypes && (argTypes)[0] ? (argTypes)[0] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"],["user","Either",[["user","Expect",[]],["list",[argTypes && (argTypes)[1] ? (argTypes)[1] : (type)[0] === "automatic" ? ["automatic"] : ["unknown"]]]]]]],obj["_printer"]),Fay$$jsToFay(["user","Expect",[]],obj["_label"]));
}});


RegExp.escape=function(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&');};(function($){'use strict'
$.csv={defaults:{separator:',',delimiter:'"',headers:true},hooks:{castToScalar:function(value,state){var hasDot=/\./;if(isNaN(value)){return value;}else{if(hasDot.test(value)){return parseFloat(value);}else{var integer=parseInt(value);if(isNaN(integer)){return null;}else{return integer;}}}}},parsers:{parse:function(csv,options){var separator=options.separator;var delimiter=options.delimiter;if(!options.state.rowNum){options.state.rowNum=1;}
if(!options.state.colNum){options.state.colNum=1;}
var data=[];var entry=[];var state=0;var value=''
var exit=false;function endOfEntry(){state=0;value='';if(options.start&&options.state.rowNum<options.start){entry=[];options.state.rowNum++;options.state.colNum=1;return;}
if(options.onParseEntry===undefined){data.push(entry);}else{var hookVal=options.onParseEntry(entry,options.state);if(hookVal!==false){data.push(hookVal);}}
entry=[];if(options.end&&options.state.rowNum>=options.end){exit=true;}
options.state.rowNum++;options.state.colNum=1;}
function endOfValue(){if(options.onParseValue===undefined){entry.push(value);}else{var hook=options.onParseValue(value,options.state);if(hook!==false){entry.push(hook);}}
value='';state=0;options.state.colNum++;}
var escSeparator=RegExp.escape(separator);var escDelimiter=RegExp.escape(delimiter);var match=/(D|S|\n|\r|[^DS\r\n]+)/;var matchSrc=match.source;matchSrc=matchSrc.replace(/S/g,escSeparator);matchSrc=matchSrc.replace(/D/g,escDelimiter);match=RegExp(matchSrc,'gm');csv.replace(match,function(m0){if(exit){return;}
switch(state){case 0:if(m0===separator){value+='';endOfValue();break;}
if(m0===delimiter){state=1;break;}
if(m0==='\n'){endOfValue();endOfEntry();break;}
if(/^\r$/.test(m0)){break;}
value+=m0;state=3;break;case 1:if(m0===delimiter){state=2;break;}
value+=m0;state=1;break;case 2:if(m0===delimiter){value+=m0;state=1;break;}
if(m0===separator){endOfValue();break;}
if(m0==='\n'){endOfValue();endOfEntry();break;}
if(/^\r$/.test(m0)){break;}
throw new Error('CSVDataError: Illegal State [Row:'+options.state.rowNum+'][Col:'+options.state.colNum+']');case 3:if(m0===separator){endOfValue();break;}
if(m0==='\n'){endOfValue();endOfEntry();break;}
if(/^\r$/.test(m0)){break;}
if(m0===delimiter){throw new Error('CSVDataError: Illegal Quote [Row:'+options.state.rowNum+'][Col:'+options.state.colNum+']');}
throw new Error('CSVDataError: Illegal Data [Row:'+options.state.rowNum+'][Col:'+options.state.colNum+']');default:throw new Error('CSVDataError: Unknown State [Row:'+options.state.rowNum+'][Col:'+options.state.colNum+']');}});if(entry.length!==0){endOfValue();endOfEntry();}
return data;},splitLines:function(csv,options){var separator=options.separator;var delimiter=options.delimiter;if(!options.state.rowNum){options.state.rowNum=1;}
var entries=[];var state=0;var entry='';var exit=false;function endOfLine(){state=0;if(options.start&&options.state.rowNum<options.start){entry='';options.state.rowNum++;return;}
if(options.onParseEntry===undefined){entries.push(entry);}else{var hookVal=options.onParseEntry(entry,options.state);if(hookVal!==false){entries.push(hookVal);}}
entry='';if(options.end&&options.state.rowNum>=options.end){exit=true;}
options.state.rowNum++;}
var escSeparator=RegExp.escape(separator);var escDelimiter=RegExp.escape(delimiter);var match=/(D|S|\n|\r|[^DS\r\n]+)/;var matchSrc=match.source;matchSrc=matchSrc.replace(/S/g,escSeparator);matchSrc=matchSrc.replace(/D/g,escDelimiter);match=RegExp(matchSrc,'gm');csv.replace(match,function(m0){if(exit){return;}
switch(state){case 0:if(m0===separator){entry+=m0;state=0;break;}
if(m0===delimiter){entry+=m0;state=1;break;}
if(m0==='\n'){endOfLine();break;}
if(/^\r$/.test(m0)){break;}
entry+=m0;state=3;break;case 1:if(m0===delimiter){entry+=m0;state=2;break;}
entry+=m0;state=1;break;case 2:var prevChar=entry.substr(entry.length-1);if(m0===delimiter&&prevChar===delimiter){entry+=m0;state=1;break;}
if(m0===separator){entry+=m0;state=0;break;}
if(m0==='\n'){endOfLine();break;}
if(m0==='\r'){break;}
throw new Error('CSVDataError: Illegal state [Row:'+options.state.rowNum+']');case 3:if(m0===separator){entry+=m0;state=0;break;}
if(m0==='\n'){endOfLine();break;}
if(m0==='\r'){break;}
if(m0===delimiter){throw new Error('CSVDataError: Illegal quote [Row:'+options.state.rowNum+']');}
throw new Error('CSVDataError: Illegal state [Row:'+options.state.rowNum+']');default:throw new Error('CSVDataError: Unknown state [Row:'+options.state.rowNum+']');}});if(entry!==''){endOfLine();}
return entries;},parseEntry:function(csv,options){var separator=options.separator;var delimiter=options.delimiter;if(!options.state.rowNum){options.state.rowNum=1;}
if(!options.state.colNum){options.state.colNum=1;}
var entry=[];var state=0;var value='';function endOfValue(){if(options.onParseValue===undefined){entry.push(value);}else{var hook=options.onParseValue(value,options.state);if(hook!==false){entry.push(hook);}}
value='';state=0;options.state.colNum++;}
if(!options.match){var escSeparator=RegExp.escape(separator);var escDelimiter=RegExp.escape(delimiter);var match=/(D|S|\n|\r|[^DS\r\n]+)/;var matchSrc=match.source;matchSrc=matchSrc.replace(/S/g,escSeparator);matchSrc=matchSrc.replace(/D/g,escDelimiter);options.match=RegExp(matchSrc,'gm');}
csv.replace(options.match,function(m0){switch(state){case 0:if(m0===separator){value+='';endOfValue();break;}
if(m0===delimiter){state=1;break;}
if(m0==='\n'||m0==='\r'){break;}
value+=m0;state=3;break;case 1:if(m0===delimiter){state=2;break;}
value+=m0;state=1;break;case 2:if(m0===delimiter){value+=m0;state=1;break;}
if(m0===separator){endOfValue();break;}
if(m0==='\n'||m0==='\r'){break;}
throw new Error('CSVDataError: Illegal State [Row:'+options.state.rowNum+'][Col:'+options.state.colNum+']');case 3:if(m0===separator){endOfValue();break;}
if(m0==='\n'||m0==='\r'){break;}
if(m0===delimiter){throw new Error('CSVDataError: Illegal Quote [Row:'+options.state.rowNum+'][Col:'+options.state.colNum+']');}
throw new Error('CSVDataError: Illegal Data [Row:'+options.state.rowNum+'][Col:'+options.state.colNum+']');default:throw new Error('CSVDataError: Unknown State [Row:'+options.state.rowNum+'][Col:'+options.state.colNum+']');}});endOfValue();return entry;}},toArray:function(csv,options,callback){var options=(options!==undefined?options:{});var config={};config.callback=((callback!==undefined&&typeof(callback)==='function')?callback:false);config.separator='separator'in options?options.separator:$.csv.defaults.separator;config.delimiter='delimiter'in options?options.delimiter:$.csv.defaults.delimiter;var state=(options.state!==undefined?options.state:{});var options={delimiter:config.delimiter,separator:config.separator,onParseEntry:options.onParseEntry,onParseValue:options.onParseValue,state:state}
var entry=$.csv.parsers.parseEntry(csv,options);if(!config.callback){return entry;}else{config.callback('',entry);}},toArrays:function(csv,options,callback){var options=(options!==undefined?options:{});var config={};config.callback=((callback!==undefined&&typeof(callback)==='function')?callback:false);config.separator='separator'in options?options.separator:$.csv.defaults.separator;config.delimiter='delimiter'in options?options.delimiter:$.csv.defaults.delimiter;var data=[];var options={delimiter:config.delimiter,separator:config.separator,onParseEntry:options.onParseEntry,onParseValue:options.onParseValue,start:options.start,end:options.end,state:{rowNum:1,colNum:1}};data=$.csv.parsers.parse(csv,options);if(!config.callback){return data;}else{config.callback('',data);}},toObjects:function(csv,options,callback){var options=(options!==undefined?options:{});var config={};config.callback=((callback!==undefined&&typeof(callback)==='function')?callback:false);config.separator='separator'in options?options.separator:$.csv.defaults.separator;config.delimiter='delimiter'in options?options.delimiter:$.csv.defaults.delimiter;config.headers='headers'in options?options.headers:$.csv.defaults.headers;options.start='start'in options?options.start:1;if(config.headers){options.start++;}
if(options.end&&config.headers){options.end++;}
var lines=[];var data=[];var options={delimiter:config.delimiter,separator:config.separator,onParseEntry:options.onParseEntry,onParseValue:options.onParseValue,start:options.start,end:options.end,state:{rowNum:1,colNum:1},match:false};var headerOptions={delimiter:config.delimiter,separator:config.separator,start:1,end:1,state:{rowNum:1,colNum:1}}
var headerLine=$.csv.parsers.splitLines(csv,headerOptions);var headers=$.csv.toArray(headerLine[0],options);var lines=$.csv.parsers.splitLines(csv,options);options.state.colNum=1;if(headers){options.state.rowNum=2;}else{options.state.rowNum=1;}
for(var i=0,len=lines.length;i<len;i++){var entry=$.csv.toArray(lines[i],options);var object={};for(var j in headers){object[headers[j]]=entry[j];}
data.push(object);options.state.rowNum++;}
if(!config.callback){return data;}else{config.callback('',data);}},fromArrays:function(arrays,options,callback){var options=(options!==undefined?options:{});var config={};config.callback=((callback!==undefined&&typeof(callback)==='function')?callback:false);config.separator='separator'in options?options.separator:$.csv.defaults.separator;config.delimiter='delimiter'in options?options.delimiter:$.csv.defaults.delimiter;config.escaper='escaper'in options?options.escaper:$.csv.defaults.escaper;config.experimental='experimental'in options?options.experimental:false;if(!config.experimental){throw new Error('not implemented');}
var output=[];for(i in arrays){output.push(arrays[i]);}
if(!config.callback){return output;}else{config.callback('',output);}},fromObjects2CSV:function(objects,options,callback){var options=(options!==undefined?options:{});var config={};config.callback=((callback!==undefined&&typeof(callback)==='function')?callback:false);config.separator='separator'in options?options.separator:$.csv.defaults.separator;config.delimiter='delimiter'in options?options.delimiter:$.csv.defaults.delimiter;config.experimental='experimental'in options?options.experimental:false;if(!config.experimental){throw new Error('not implemented');}
var output=[];for(i in objects){output.push(arrays[i]);}
if(!config.callback){return output;}else{config.callback('',output);}}};$.csvEntry2Array=$.csv.toArray;$.csv2Array=$.csv.toArrays;$.csv2Dictionary=$.csv.toObjects;})(jQuery);// Paste of default Mixpanel code.
(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==
typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,
e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);
// Intercom code for Single Page Apps
// Source: http://docs.intercom.io/integrating-intercom-in-one-page-app
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',window.intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://static.intercomcdn.com/intercom.v1.js';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()
function startFullstory(){
window['_fs_debug']=false;window['_fs_host']='www.fullstory.com';window['_fs_org']='tXq';window.FS=window['FS'] = function(a,b){window.FS.q?window.FS.q.push([a,b]):window.FS._api(a,b);};window['FS'].q=[];
var _fs_hash="4df8e20cf79315ec0b9a484992e4ebf3";
try{"undefined"===typeof WeakMap&&function(){var m=Object.defineProperty,w=Date.now()%1E9,a=function(){this.name="__st"+(1E9*Math.random()>>>0)+(w++ +"__")};a.prototype={set:function(a,k){var d=a[this.name];d&&d[0]===a?d[1]=k:m(a,this.name,{value:[a,k],writable:!0})},get:function(a){var k;return(k=a[this.name])&&k[0]===a?k[1]:void 0}};window.WeakMap=a}()}catch(e$$12){};try{(function(m){function w(){l=!1;var b=E;E=[];b.sort(function(a,b){return a.uid_-b.uid_});var h=!1;b.forEach(function(b){var c=b.takeRecords();a(b);c.length&&(b.callback_(c,b),h=!0)});h&&w()}function a(a){a.nodes_.forEach(function(b){(b=t.get(b))&&b.forEach(function(b){b.observer===a&&b.removeTransientObservers()})})}function f(a,b){for(var h=a;h;h=h.parentNode){var c=t.get(h);if(c)for(var l=0;l<c.length;l++){var e=c[l],g=e.options;(h===a||g.subtree)&&(g=b(g))&&e.enqueue(g)}}}function k(a){this.callback_=
a;this.nodes_=[];this.records_=[];this.uid_=++ka}function d(a,b){this.type=a;this.target=b;this.addedNodes=[];this.removedNodes=[];this.oldValue=this.attributeNamespace=this.attributeName=this.nextSibling=this.previousSibling=null}function c(a,b){return B=new d(a,b)}function b(a){if(q)return q;var b=B,h=new d(b.type,b.target);h.addedNodes=b.addedNodes.slice();h.removedNodes=b.removedNodes.slice();h.previousSibling=b.previousSibling;h.nextSibling=b.nextSibling;h.attributeName=b.attributeName;h.attributeNamespace=
b.attributeNamespace;h.oldValue=b.oldValue;q=h;q.oldValue=a;return q}function h(a,b,h){this.observer=a;this.target=b;this.options=h;this.transientObservedNodes=[]}var t=new WeakMap,e=window.msSetImmediate;if(!e){var g=[],x=String(Math.random());window.addEventListener("message",function(a){a.data===x&&(a=g,g=[],a.forEach(function(a){a()}))});e=function(a){g.push(a);window.postMessage(x,"*")}}var l=!1,E=[],ka=0;k.prototype={observe:function(a,b){a=window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(a)||
a;if(!b.childList&&!b.attributes&&!b.characterData||b.attributeOldValue&&!b.attributes||b.attributeFilter&&b.attributeFilter.length&&!b.attributes||b.characterDataOldValue&&!b.characterData)throw new SyntaxError;var c=t.get(a);c||t.set(a,c=[]);for(var l,e=0;e<c.length;e++)if(c[e].observer===this){l=c[e];l.removeListeners();l.options=b;break}l||(l=new h(this,a,b),c.push(l),this.nodes_.push(a));l.addListeners()},disconnect:function(){this.nodes_.forEach(function(a){a=t.get(a);for(var b=0;b<a.length;b++){var h=
a[b];if(h.observer===this){h.removeListeners();a.splice(b,1);break}}},this);this.records_=[]},takeRecords:function(){var a=this.records_;this.records_=[];return a}};var B,q;h.prototype={enqueue:function(a){var b=this.observer.records_,h=b.length;if(0<b.length){var c=b[h-1];c=c===a?c:!q||c!==q&&c!==B?null:q;if(c){b[h-1]=c;return}}else E.push(this.observer),l||(l=!0,e(w));b[h]=a},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(a){var b=this.options;b.attributes&&a.addEventListener("DOMAttrModified",
this,!0);b.characterData&&a.addEventListener("DOMCharacterDataModified",this,!0);b.childList&&a.addEventListener("DOMNodeInserted",this,!0);(b.childList||b.subtree)&&a.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(a){var b=this.options;b.attributes&&a.removeEventListener("DOMAttrModified",this,!0);b.characterData&&a.removeEventListener("DOMCharacterDataModified",this,!0);b.childList&&a.removeEventListener("DOMNodeInserted",
this,!0);(b.childList||b.subtree)&&a.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(a){if(a!==this.target){this.addListeners_(a);this.transientObservedNodes.push(a);var b=t.get(a);b||t.set(a,b=[]);b.push(this)}},removeTransientObservers:function(){var a=this.transientObservedNodes;this.transientObservedNodes=[];a.forEach(function(a){this.removeListeners_(a);a=t.get(a);for(var b=0;b<a.length;b++)if(a[b]===this){a.splice(b,1);break}},this)},handleEvent:function(a){a.stopImmediatePropagation();
switch(a.type){case "DOMAttrModified":var h=a.attrName,l=a.relatedNode.namespaceURI,t=a.target,e=new c("attributes",t);e.attributeName=h;e.attributeNamespace=l;var g=a.attrChange===MutationEvent.ADDITION?null:a.prevValue;f(t,function(a){if(a.attributes&&(!a.attributeFilter||!a.attributeFilter.length||-1!==a.attributeFilter.indexOf(h)||-1!==a.attributeFilter.indexOf(l)))return a.attributeOldValue?b(g):e});break;case "DOMCharacterDataModified":t=a.target;e=c("characterData",t);g=a.prevValue;f(t,function(a){if(a.characterData)return a.characterDataOldValue?
b(g):e});break;case "DOMNodeRemoved":this.addTransientObserver(a.target);case "DOMNodeInserted":var t=a.relatedNode,d=a.target,x;"DOMNodeInserted"===a.type?(a=[d],x=[]):(a=[],x=[d]);var k=d.previousSibling,d=d.nextSibling,e=c("childList",t);e.addedNodes=a;e.removedNodes=x;e.previousSibling=k;e.nextSibling=d;f(t,function(a){if(a.childList)return e})}B=q=void 0}};m.JsMutationObserver=k;!m.MutationObserver&&m.WebKitMutationObserver&&(m.MutationObserver=m.WebKitMutationObserver);m.MutationObserver||(m.MutationObserver=
k)})(this)}catch(e$$15){};(function(){var m;(function(a){a.EVENT_MUT_UNPARSED_INSERT=0;a.EVENT_MUT_PARSED_INSERT=1;a.EVENT_MUT_INSERT=2;a.EVENT_MUT_REMOVE=3;a.EVENT_MUT_ATTR=4;a.EVENT_MUT_ATTR_CURVE=5;a.EVENT_MUT_TEXT=6;a.EVENT_MUT_SKIPIDS=7;a.EVENT_MOUSEMOVE=8;a.EVENT_MOUSEMOVE_CURVE=9;a.EVENT_SCROLL=10;a.EVENT_SCROLL_CURVE=11;a.EVENT_MOUSEDOWN=12;a.EVENT_MOUSEUP=13;a.EVENT_KEYDOWN=14;a.EVENT_KEYUP=15;a.EVENT_CLICK=16;a.EVENT_FOCUS=17;a.EVENT_VALUECHANGE=18;a.EVENT_RESIZE=19;a.EVENT_DOMLOADED=20;a.EVENT_LOAD=21;a.EVENT_PLACEHOLDER_SIZE=
22;a.EVENT_UNLOAD=23;a.EVENT_BLUR=24;a.EVENT_SET_FRAME_BASE=25;a.EVENT_TOUCHSTART=32;a.EVENT_TOUCHEND=33;a.EVENT_TOUCHCANCEL=34;a.EVENT_TOUCHMOVE=35;a.EVENT_TOUCHMOVE_CURVE=36;a.EVENT_NAVIGATE=37;a.EVENT_PLAY=38;a.EVENT_PAUSE=39;a.EVENT_SYS_SETMETA=8192;a.EVENT_SYS_SETVAR=8193;a.EVENT_COOKED_LOAD="load";a.EVENT_COOKED_UNLOAD="unload";a.EVENT_COOKED_NAVIGATE="navigate";a.EVENT_COOKED_CLICK="click";a.EVENT_COOKED_FOCUS="focus";a.EVENT_COOKED_CHANGE="change";a.isUserActionEvent=function(f){switch(f){case a.EVENT_MOUSEDOWN:case a.EVENT_MOUSEMOVE:case a.EVENT_MOUSEMOVE_CURVE:case a.EVENT_MOUSEUP:case a.EVENT_KEYDOWN:case a.EVENT_KEYUP:case a.EVENT_TOUCHSTART:case a.EVENT_TOUCHEND:case a.EVENT_TOUCHMOVE:case a.EVENT_TOUCHMOVE_CURVE:case a.EVENT_TOUCHCANCEL:case a.EVENT_CLICK:case a.EVENT_SCROLL:case a.EVENT_SCROLL_CURVE:case a.EVENT_NAVIGATE:return!0}return!1}})(m||
(m={}));(function(a){function f(a){var h={};if(!a)return h;if(a.classList)for(var c=0;c<a.classList.length;++c)h[a.classList[c]]=!0;else for(a=(null!=a.className.animVal?a.className.animVal:a.className).split(" "),c=0;c<a.length;++c)h[a[c].trim()]=!0;return h}a.NYI_KIND="nyi";a.BLOCKED_KIND="blocked";a.HIDE_KIND="hide";var k=function(){function a(b,c){var e=this;this._parent=b;this._classes={};this._attrs={};for(var g=0,d=0,l=0,f=function(){if(0!=l-d)switch(g){case 0:e._tag=c.slice(d,l);break;case 1:e._id=
c.slice(d+1,l);break;case 2:e._classes[c.slice(d+1,l)]=!0;break;case 3:var a=c.slice(d,l).slice(1).split("="),b=a[0].trim(),a=a[1].trim();if("]"!=a[a.length-1])throw"Unsupported selector";a=a.slice(0,a.length-1);if("'"==a[0]||'"'==a[0]){if(a[a.length-1]!=a[0])throw"Unsupported selector";a=a.slice(1,a.length-1)}e._attrs[b]=a}},l=0;l<c.length;++l)switch(c[l]){case "#":f();g=1;d=l;break;case ".":f();g=2;d=l;break;case "[":f(),g=3,d=l}f()}a.prototype.parent=function(){return this._parent};a.prototype.serialize=
function(){var a="";this._tag&&(a+=this._tag);this._id&&(a+="#"+this._id);for(var b in this._classes)a+="."+b;for(var c in this._attrs)a+="["+c+"="+this._attrs[c]+"]";return a};a.prototype.matches=function(a,b){if(!a||this._tag&&a.tagName.toLowerCase()!=this._tag||this._id&&a.id!=this._id)return!1;for(var c in this._classes)if(!(c in b))return!1;for(var g in this._attrs)if(a.getAttribute(g)!=this._attrs[g])return!1;return this._parent?this._parent.matches(a.parentElement,f(a.parentElement)):!0};return a}();
a.BlockRuleElem=k;var d=function(){function a(b){this.kind=b.Kind;b=b.Selector.split(">");for(var c=null,e=0;e<b.length;)var g=b[e++].trim(),c=new k(c,g);this.rules=c}a.prototype.serialize=function(){for(var a=null,b=this.rules;b;b=b.parent())a=a?b.serialize()+">"+a:b.serialize();return a};return a}();a.BlockRule=d;var c=function(){function a(){this._rules=[];this._isIdBlocked={};this.rawRules=[]}a.prototype.isBlocked=function(a){for(var b=f(a),c=0;c<this._rules.length;++c)if(this._rules[c].rules.matches(a,
b))return this._isIdBlocked[a._fsid]=a,this._rules[c].kind;return null};a.prototype.wasIdBlocked=function(a){return this._isIdBlocked[a+""]};a.prototype.addRule=function(a){this.rawRules.push(a);this._rules.push(new d(a))};a.prototype.mungeBlockedStyle=function(a,b){var c=a.getBoundingClientRect(),g=Math.floor(c.width),c=Math.floor(c.height);if("object"==a.tagName.toLowerCase())for(var d=a.children,l=0;l<d.length;l++){var f=d[l];if("embed"==f.tagName.toLowerCase()){d=f.getBoundingClientRect();g=Math.max(g,
Math.floor(d.width));c=Math.max(c,Math.floor(d.height));break}}d="";null!=b&&(d=b.trim());0<d.length&&";"!=d.charAt(d.length-1)&&(d+=";");l=a.style.getPropertyValue("display");"inline"==(l?l:window.getComputedStyle(a).getPropertyValue("display")).toLowerCase()&&(d+="display: inline-block !important;");if(0!=g||0!=c)d+="width:"+g+"px;height:"+c+"px;";return d};return a}();a.Blocker=c})(m||(m={}));(function(a){function f(a,b){b.parent=a;a.child&&(a.child.prev=b,b.next=a.child);a.child=b}function k(a){a.parent.child==
a&&(a.parent.child=a.next);a.prev&&(a.prev.next=a.next);a.next&&(a.next.prev=a.prev);a.parent=a.prev=a.next=null}var d=function(){function a(){this._root={parent:null,child:null,prev:null,next:null,fromId:-1,toId:-1,parentIds:[]};this._ranges=[this._root]}a.prototype.insert=function(a,c,d){var e=this.find(d[0]);a={parent:e,child:null,prev:null,next:null,fromId:a,toId:c,parentIds:d};f(e,a);this._ranges.push(a);return a};a.prototype.remove=function(a){var c=this._find(a);if(0>c)return null;var d=this._ranges[c];
if(a==d.fromId)return k(d),this._removeNodeFromRanges(d),d;var e=d.fromId,g=d.parentIds;d.parentIds=g.slice(0,a-e);d.toId=a-1;for(var m=[];a<e+g.length;){for(var l=a+1;g[l-e]>g[a-e];)++l;--l;m.push({parent:d,child:null,prev:null,next:null,fromId:a,toId:l,parentIds:g.slice(a-e,l-e+1)});a=l+1}for(e=d.child;e;){g=e.next;l=e.parentIds[0];if(l>d.toId)for(a=0;a<m.length;++a)if(l<=m[a].toId){k(e);f(m[a],e);break}e=g}e=m.shift();e.parentIds[0]=-1;k(e);g=d.child;for(a=0;a<m.length;++a)l=m[a],l.next=g,d.child=
l,g&&(g.prev=l),g=l;c=[c+1,0].concat(m);this._ranges.splice.apply(this._ranges,c);this._removeNodeFromRanges(e);return e};a.prototype.find=function(a){a=this._find(a);return 0<=a?this._ranges[a]:null};a.prototype._getRoot=function(){return this._root};a.prototype._getRanges=function(){return this._ranges};a.prototype._removeNodeFromRanges=function(a){var c=this._find(a.fromId);0<=c&&this._ranges.splice(c,1);for(a=a.child;a;a=a.next)this._removeNodeFromRanges(a)};a.prototype._find=function(a){if(isNaN(a))return-1;
for(var c=0,d=this._ranges.length-1;c<=d;){var e=Math.floor((c+d)/2),g=this._ranges[e];if(a>g.toId)c=e+1;else if(a<g.fromId)d=e-1;else{if(a>=g.fromId&&a<=g.toId)return e;break}}return-1};return a}();a.IdTree=d})(m||(m={}));(function(a){a.Node_ELEMENT_NODE=1;a.Node_ATTRIBUTE_NODE=2;a.Node_TEXT_NODE=3;a.Node_CDATA_SECTION_NODE=4;a.Node_ENTITY_REFERENCE_NODE=5;a.Node_ENTITY_NODE=6;a.Node_PROCESSING_INSTRUCTION_NODE=7;a.Node_COMMENT_NODE=8;a.Node_DOCUMENT_NODE=9;a.Node_DOCUMENT_TYPE_NODE=10;a.Node_DOCUMENT_FRAGMENT_NODE=
11;a.Node_NOTATION_NODE=12;a.XHR_UNSENT=0;a.XHR_OPENED=1;a.XHR_HEADERS_RECEIVED=2;a.XHR_LOADING=3;a.XHR_DONE=4})(m||(m={}));(function(a){function f(a){return"_fsblocked"in a}function k(a){a._fsblocked=!0}function d(a){return parseInt(a._fsid)}function c(a,b){return a._fsid=b}function b(c){if(a._isWebKitIsh){for(var d=c.fromId;d<=c.toId;++d)delete m[d];for(c=c.child;c;c=c.next)b(c)}}function h(b,d,f,k,q,F){var A=0;if("SCRIPT"==d.nodeName||d.nodeType==a.Node_COMMENT_NODE)return 0;var G=g++;q.push(b);
b=d.nodeName;"http://www.w3.org/2000/svg"==d.namespaceURI&&(b="svg:"+b);k.push("<"+b);c(d,G);a._isWebKitIsh&&(m[G]=d);++A;if(e(d,f,k))return 1;F&&F(d);t(d,function(a,b){k.push(":"+a);k.push(b)});if(d.firstChild){k.push("[");for(b=d.firstChild;b;b=b.nextSibling)A+=h(G,b,f,k,q,F);k.push("]")}d.nodeType==a.Node_TEXT_NODE&&k.push(d.textContent);return A}function t(a,b){if(a.attributes&&0<a.attributes.length)for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];b(d.name,d.value)}}function e(b,c,
d){if(b.nodeType==a.Node_ELEMENT_NODE&&c){var h=c.isBlocked(b);if(h){k(b);var e,g=!1;t(b,function(a,f){if("class"==a)f+=" _fs_block_"+h,e=!0;else if("style"==a)f=c.mungeBlockedStyle(b,f),g=!0;else if("value"==a||"checked"==a)return;d.push(":"+a);d.push(f)});e||(d.push(":class"),d.push("_fs_block_"+h));g||(d.push(":style"),d.push(c.mungeBlockedStyle(b,"")));return!0}}return!1}var g=1,m={};a._isWebKitIsh=-1!=navigator.userAgent.indexOf("WebKit");a.hasFsid=function(a){return"_fsid"in a};a.isBlocked=
f;a.setBlocked=k;a.removeFsid=function(a){delete a._fsid};a.fsid=d;a.setFsid=c;a.fsidIfNotBlocked=function(a){return f(a)?NaN:d(a)};a.unpinNodes=b;a.tokeNode=h;a.tokenizeNode=function(a,b,c,d){var e=g;try{var f=[],k=[];h(a,b,c,f,k,d);return{stream:f,parents:k,fromId:e,toId:g-1}}catch(t){return g=e,{stream:[],parents:[],fromId:g,toId:g-1}}}})(m||(m={}));(function(a){var f=function(){function a(){this.dict={idx:-1,map:{}};this.startIdx=0}a.prototype.encode=function(a){function c(){h?1<g.length?f.push([h.idx,
g.length]):f.push(h.idx):f.push(g[0])}if(0==a.length)return[];var b,h=null,f=[],e,g=[a[0]];for(b=1;b<a.length;b++)if(e=a[b],h&&h.map.hasOwnProperty(e))g.push(e),h=h.map[e];else{c();var k=this.startIdx+b-g.length;null==h&&(h={idx:k,map:{}},this.dict.map[g[g.length-1]]=h);h.map[e]={idx:k,map:{}};g=[e];h=this.dict.map.hasOwnProperty(e)?this.dict.map[e]:null}c();this.startIdx+=a.length;return f};return a}();a.LZJGWEncoder=f;f=function(){function a(){this._seq=[]}a.prototype.sequence=function(){return this._seq};
a.prototype.decode=function(a){for(var c=this._seq.length,b=0;b<a.length;++b){var h=a[b];switch(typeof h){case "string":this._seq.push(h);break;case "number":this._seq.push(this._seq[h]);break;case "object":for(var f=0;f<h[1];f++)this._seq.push(this._seq[h[0]+f])}}return c};return a}();a.LZJGWDecoder=f})(m||(m={}));(function(a){function f(a,b,d){var f=Object.getOwnPropertyDescriptor(a.prototype,b);Object.defineProperty(a.prototype,b,{set:function(a){var b=this;setTimeout(function(){d(b)},0);return f.set.call(this,
a)},get:function(){return f.get.call(this)}})}function k(a){switch(a.type){case "checkbox":case "radio":return""+a.checked;default:return a.value}}var d=function(){function a(b,c){this._onchange=b;this._checkElem=c;this._fallback=!1;this._elems={};this._values={};this.shimPrototypes()||(this._fallback=!0)}a.prototype.addInput=function(a,c){this._fallback&&(this._elems[a]=c,this._values[a]=k(c),this._values[a]&&this._onchange(c))};a.prototype.tick=function(){if(this._fallback)for(var a in this._elems)if(this._checkElem(a)){var c=
this._elems[a],d=k(c);d!=this._values[a]&&(this._onchange(c),this._values[a]=d)}else delete this._elems[a],delete this._values[a]};a.prototype._usingFallback=function(){return this._fallback};a.prototype._trackingElem=function(a){return!!this._elems[a]};a.prototype.shimPrototypes=function(){var a=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value");if(!a||!a.set)return!1;f(HTMLInputElement,"value",this._onchange);f(HTMLInputElement,"checked",this._onchange);f(HTMLSelectElement,"value",
this._onchange);f(HTMLTextAreaElement,"value",this._onchange);return!0};return a}();a.InputWatcher=d;a.valueOfInputishElem=k})(m||(m={}));(function(a){a.EVENT_PROCESSING_INTERVAL=250;a.UPLOAD_INTERVAL=5E3;a.USER_INACTIVITY_TIMEOUT=1E4;var f=function(){function a(c){this._interval=c;this._handle=-1}a.prototype.oneShot=function(a){setTimeout(a,this._interval)};a.prototype.start=function(a){-1==this._handle&&(this._handle=setInterval(a,this._interval))};a.prototype.stop=function(){-1!=this._handle&&
(clearInterval(this._handle),this._handle=-1)};return a}(),k=function(){function d(c,b,d,k,e){"undefined"===typeof k&&(k=new f(a.EVENT_PROCESSING_INTERVAL));"undefined"===typeof e&&(e=new f(a.UPLOAD_INTERVAL));this._ctx=c;this._processQueue=b;this._beforeProcessEvents=d;this._processEventsTicker=k;this._uploadTicker=e;this._eventQueue=[];this._outgoingQueue=[];this._bundleQueue=[];this._recordingDisabled=!1;this._bundleSeq=1;this._lastWhenTime=this._lastPostTime=0;this._lastWhen=-1;this._lastUserAction=
0;this._lz=new a.LZJGWEncoder;this._lastBundleTime=c.wallTime()}d.prototype.startPipeline=function(){var a=this;this._recordingDisabled||this._pipelineStarted||(this.processEvents(),this._processEventsTicker.start(function(){a.processEvents()}),this._ctx.amInsideIFrame()||this._uploadTicker.start(function(){a.enqueueNextBundle()}),this._pipelineStarted=!0)};d.prototype.enqueue=function(a,b){this.enqueueAt(this._ctx.now(),a,b)};d.prototype.enqueueAt=function(c,b,d){this._recordingDisabled||(c<=this._lastWhen&&
(c=this._lastWhen+1),this._lastWhen=c,this._eventQueue.push({When:c,Kind:b,Args:d}),a.isUserActionEvent(b)&&(this._lastUserAction=c))};d.prototype.disableRecording=function(){this._recordingDisabled=!0;this.stopPipeline()};d.prototype.prequeue=function(a,b){this._recordingDisabled||this._eventQueue.unshift({When:0,Kind:a,Args:b})};d.prototype.appendToOutgoingQueue=function(a){this._outgoingQueue=this._outgoingQueue.concat(a)};d.prototype.lastSentEventTime=function(){return this._lastWhenTime};d.prototype.swanSong=
function(){if(!this._recordingDisabled&&!this._ctx.amInsideIFrame()&&(this.processEvents(),this.enqueueNextBundle(),0<this._bundleQueue.length||this._pendingBundle)){var c=this._bundleQueue.concat();this._pendingBundle&&c.unshift(this._pendingBundle);a.log("Saving "+c.length+" bundles in swan-song.");c={UserId:this._ctx.userId(),SessionId:this._ctx.sessionId(),PageId:this._ctx.pageId(),Bundles:c,PageStartTime:this._ctx.startTime(),LastBundleTime:this._lastBundleTime};try{localStorage.swanSong=a.stringify(c)}catch(b){}}};
d.prototype.recoverSwanSong=function(){if(!this._ctx.amInsideIFrame())try{if("swanSong"in localStorage){var c=localStorage.swanSong;delete localStorage.swanSong;var b=JSON.parse(c);if(b.Bundles)if(b.Bundles&&b.UserId&&b.SessionId&&b.PageId)for(c=0;c<b.Bundles.length;++c)this.sendSwanSongBundle(b.UserId,b.SessionId,b.PageId,b.PageStartTime,b.LastBundleTime,b.Bundles[c]);else a.log("Malformed swan song found. Ignoring it.");else b.Bundle&&b.UserId&&b.SessionId&&b.PageId?this.sendSwanSongBundle(b.UserId,
b.SessionId,b.PageId,b.PageStartTime||0,b.LastBundleTime||0,b.Bundle):a.log("Malformed swan song found. Ignoring it.")}}catch(d){a.log("Error recovering swan-song: "+d)}};d.prototype.sendSwanSongBundle=function(c,b,d,f,e,g){c="/rec/bundle?OrgId="+this._ctx.orgId()+"&UserId="+c+"&SessionId="+b+"&PageId="+d+"&Seq="+g.Seq;0!=f&&(c+="&PageStartTime="+f);0!=e&&(c+="&DeltaT="+(this._ctx.wallTime()-e));this._ctx.post(c,g,function(b){a.log("Sent "+g.Evts.length+" trailing events from last session as Seq "+
g.Seq)},function(){a.log("Failed to send events from last session")})};d.prototype.rebaseIframe=function(c){var b=this._ctx.baseUri();0<this._eventQueue.length?this._eventQueue.unshift({When:this._eventQueue[0].When,Kind:a.EVENT_SET_FRAME_BASE,Args:[b]}):this.enqueue(a.EVENT_SET_FRAME_BASE,[b]);for(var b=0,d=this._eventQueue.length;b<d;b++){var f=this._eventQueue[b],e=f.When+this._ctx.startTime()-c;0>e&&(e=0);f.When=e}};d.prototype.processEvents=function(){this._beforeProcessEvents();if(0!=this._eventQueue.length)if(this._ctx.now()-
this._lastUserAction>a.USER_INACTIVITY_TIMEOUT)this._eventQueue=this._processQueue(this._eventQueue);else{if(this._ctx.amInsideIFrame())parent.postMessage(a.FS_IFRAME_EVENTS+a.FS_DELIMITER+a.stringify(this.processAndEncodeQueue(this._eventQueue)),"*");else{if(void 0===this._ctx.pageId())return;this._outgoingQueue=this._outgoingQueue.concat(this.processAndEncodeQueue(this._eventQueue))}this._eventQueue=[]}};d.prototype.enqueueNextBundle=function(){if(0==this._outgoingQueue.length)return this.maybeSendNextBundle(),
null;var a={When:this._outgoingQueue[0].When,Seq:this._bundleSeq++,Evts:this._outgoingQueue};this._outgoingQueue=[];this._bundleQueue.push(a);this.maybeSendNextBundle()};d.prototype.maybeSendNextBundle=function(){var c=this;if(!this._pendingBundle&&0!=this._bundleQueue.length){var b=this._pendingBundle=this._bundleQueue.shift(),d=this._ctx.wallTime(),f="/rec/bundle?OrgId="+this._ctx.orgId()+"&UserId="+this._ctx.userId()+"&SessionId="+this._ctx.sessionId()+"&PageId="+this._ctx.pageId()+"&Seq="+b.Seq+
"&DeltaT="+(d-this._lastBundleTime);this._lastPostTime=this._lastBundleTime=d;this._lastWhenTime=b.Evts[b.Evts.length-1].When;var e=function(){c._ctx.post(f,b,function(d){a.log("Sent bundle "+b.Seq+" with "+b.Evts.length+" events");c._pendingBundle=null;c._ctx.wallTime()-c._lastPostTime>a.UPLOAD_INTERVAL&&c.maybeSendNextBundle()},function(){a.log("Failed to send events.");c._uploadTicker.oneShot(e)})};e()}};d.prototype.processAndEncodeQueue=function(a){a=this._processQueue(a);this.encodeInserts(a);
return a};d.prototype.encodeInserts=function(c){for(var b=0;b<c.length;++b){var d=c[b];d.Kind==a.EVENT_MUT_PARSED_INSERT&&(d.Kind=a.EVENT_MUT_INSERT,d.Args=[d.Args[2],d.Args[3],this._lz.encode(d.Args[4])])}};d.prototype.stopPipeline=function(){this._pipelineStarted&&(this._processEventsTicker.stop(),this._uploadTicker.stop())};return d}();a.EventQueue=k})(m||(m={}));(function(a){function f(a){K&&console&&console.log(a)}function k(a){var b=Array.prototype.toJSON,s=String.prototype.toJSON;b&&delete Array.prototype.toJSON;
s&&delete String.prototype.toJSON;a=JSON.stringify(a);b&&(Array.prototype.toJSON=b);s&&(String.prototype.toJSON=s);return a}function d(){return(new Date).getTime()}function c(){return d()-H}function b(){return window!=top&&!Z}function h(b,c,s,d){"undefined"===typeof d&&(d=null);b="//"+I+b;var e=null;null!=c&&(e=k(c),Q+=e.length,f("total bytes written: "+Q));var g=new XMLHttpRequest;if("withCredentials"in g)g.onreadystatechange=function(){g.readyState==a.XHR_DONE&&(200==g.status?s(g.responseText):
d())},g.open("POST",b),g.withCredentials=!0,g.setRequestHeader("Content-Type","text/plain"),g.send(e);else{var h=new XDomainRequest;h.onload=function(){s(h.responseText)};h.onerror=function(){d()};h.onprogress=function(){};h.open("POST",b);h.send(e)}}function m(){if("baseURI"in document)return document.baseURI;var a=document.getElementsByTagName("base")[0];return a&&a.href?a.href:location.href}function e(b){for(var c=0;c<b.length;++c){var s=b[c];if(s.Kind==a.EVENT_MUT_UNPARSED_INSERT){var d=s.Args[0];
if(z.find(d)){var f=s.Args[1],e=a.tokenizeNode(d,s.Args[2],v,function(a){E(s.When,a)});0<e.parents.length&&z.insert(e.fromId,e.toId,e.parents);s.Kind=a.EVENT_MUT_PARSED_INSERT;s.Args=[e.fromId,e.parents,d,f,e.stream]}else s.Kind=a.EVENT_MUT_PARSED_INSERT,s.Args=[-1,[],-1,-1,[]]}}!$&&document.body&&(A(),$=!0)}function g(b){if(0==b.length)return b;e(b);for(var d=b[0].When,s=c(),f={},g={},h={},k=[],l=new R(k,[0,1]),m={},n={},t=0;t<b.length;++t){var p=b[t];switch(p.Kind){case a.EVENT_MUT_UNPARSED_INSERT:throw"unexpected";
case a.EVENT_MUT_PARSED_INSERT:var r=p.Args[0],q=p.Args[1].length;if(!z.find(r)){for(var u=0;u<q;++u)h[r+u]=!0;if((u=k[k.length-1])&&u.Kind==a.EVENT_MUT_SKIPIDS){u.Args[0]+=q;continue}else p={When:p.When,Kind:a.EVENT_MUT_SKIPIDS,Args:[q]}}p.When=d;x(k,p);break;case a.EVENT_MUT_REMOVE:var q=p.Args,y;(u=k[k.length-1])&&u.Kind==a.EVENT_MUT_REMOVE?y=u.Args:(p.When=d,y=p.Args=[],x(k,p));for(u=0;u<q.length;++u)r=q[u],r in h||y.push(r);break;case a.EVENT_MUT_ATTR:r=p.Args[0];if(!(r in h)){u=p.Args[1];p=
p.Args[2];switch(u){case "style":(q=v.wasIdBlocked(r))&&(p=v.mungeBlockedStyle(q,p));break;case "class":(q=v.wasIdBlocked(r))&&0>p.indexOf("_fs_block_")&&(q=v.isBlocked(q),p+=" _fs_block_"+q);break;case "value":if(v.wasIdBlocked(r))continue}f[r+":"+u]=p}break;case a.EVENT_MUT_TEXT:r=p.Args[0];r in h||(g[r]=p.Args[1]);break;case a.EVENT_PLACEHOLDER_SIZE:r=p.Args[0];if(r in h)continue;p.When=d;x(k,p);break;case a.EVENT_MOUSEMOVE:l.add(p);break;case a.EVENT_TOUCHMOVE:r=p.Args[0];r in m||(m[r]=new R(k,
[1,2]));m[r].add(p);break;case a.EVENT_SCROLL:r=p.Args[0];r in n||(n[r]=new R(k,[1,2]));n[r].add(p);break;default:x(k,p)}}l.finish(a.EVENT_MOUSEMOVE_CURVE,[s])&&(b=l.evts(),d=b[b.length-1].Args,2<d.length&&d[2]&&b[0].Args.push(d[2]));for(r in n)b=parseInt(r),n[b].finish(a.EVENT_SCROLL_CURVE,[s,b]);for(r in m)b=parseInt(r),m[b].finish(a.EVENT_TOUCHMOVE_CURVE,[s,b]);for(var w in f)m=w.split(":"),x(k,{Kind:a.EVENT_MUT_ATTR,When:s,Args:[parseInt(m[0]),m[1],f[w]]});for(w in g)x(k,{Kind:a.EVENT_MUT_TEXT,
When:s,Args:[parseInt(w),g[w]]});return k}function x(a,b){C&&(b.FId=C);a.push(b)}function l(b,d,s){for(var f=0;f<s.length;++f)if(!L)n.enqueue(a.EVENT_MUT_UNPARSED_INSERT,[b,d,s[f]]);else if(!z.find(a.fsid(s[f]))&&z.find(b)){var e=c(),g=a.tokenizeNode(b,s[f],v,function(a){E(e,a)});0<g.parents.length&&(z.insert(g.fromId,g.toId,g.parents),n.enqueueAt(e,a.EVENT_MUT_PARSED_INSERT,[g.fromId,g.parents,b,d,g.stream]))}}function E(b,d){switch(d.nodeName){case "INPUT":case "TEXTAREA":case "SELECT":M.addInput(a.fsid(d),
d);break;case "IFRAME":var c=a.fsid(d);if(!c){f("fsid missing or invalid for iFrame."+d.src);break}aa||(ma(),aa=!0);ba[c]=b;na(c,d);break;case "VIDEO":case "AUDIO":d.paused||(c=a.fsid(d),n.enqueue(a.EVENT_PLAY,[c]))}}function w(a){(a=a.target.tagName)&&(a=a.toLowerCase());return a}function B(a,b){return a.tagName&&a.tagName.toLowerCase()in b?!0:a.parentNode?B(a.parentNode,b):!1}function q(a,b){for(var d=0;d<a.changedTouches.length;++d){var c=a.changedTouches[d];n.enqueue(b,[c.identifier,c.clientX,
c.clientY])}}function F(){var b=document.activeElement;if(b&&"value"in b){var d=a.fsidIfNotBlocked(b);d&&n.enqueue(a.EVENT_VALUECHANGE,[d,b.value])}}function A(){var b=a.fsid(document.body);if(b){var d,c;"pageXOffset"in window?(d=window.pageXOffset,c=pageYOffset):(d=document.body.scrollLeft,c=document.body.scrollTop);n.enqueue(a.EVENT_SCROLL,[b,d,c])}}function G(){n.enqueue(a.EVENT_RESIZE,[document.documentElement.clientWidth,document.documentElement.clientHeight])}function P(){var b=location.href;
S!=b&&(S=b,n.enqueue(a.EVENT_NAVIGATE,[location.href,document.title]))}function U(b){var d=a.fsidIfNotBlocked(b);d&&n.enqueue(a.EVENT_VALUECHANGE,[d,a.valueOfInputishElem(b)])}function V(){ca||(ca=!0,n.enqueue(a.EVENT_UNLOAD,[]),n.swanSong())}function ja(){for(var a={},b=document.cookie.split(";"),d=0;d<b.length;d++){var c=b[d].replace(/^\s+|\s+$/g,"").split("=");a[c[0]]=c[1]}return a.fs_uid}function W(a){y=a.UserIntId;N=a.SessionIntId;L=a.PageIntId;da=a.CookieDomain;document.cookie="fs_uid="+y+"; domain=."+
encodeURIComponent(da)+"; expires=expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/";f("/User,"+y+"/Session,"+N+"/Page,"+L)}function X(){var a=document.doctype;if(!a)return null;var b;b="<!DOCTYPE "+a.name;a.publicId&&(b+=' PUBLIC "'+a.publicId+'"');a.systemId&&(b+=' "'+a.systemId+'"');return b+">"}function la(){(y=ja())||(y="");var b=document.documentElement,d=window._fs_hash;S=location.href;if(O)b={OrgId:D,UserId:y,Url:location.href,Base:m(),ScreenWidth:window.screen.width,ScreenHeight:window.screen.height,
Width:b.clientWidth,Height:b.clientHeight,Referrer:document.referrer,Doctype:X(),Hash:d},h("/rec/page",b,function(b){b=JSON.parse(b);W(b);n.prequeue(a.EVENT_SYS_SETVAR,["user",k(b.InitSetUserVars),!0]);window._fs_ready&&window._fs_ready();for(var d=0;d<b.Blocks.length;++d)v.addRule(b.Blocks[d]);n.startPipeline()},function(){n.disableRecording();ea();f("Disabling FS.");window._fs_ready&&window._fs_ready(!0)});else{f("Unable to record playback stream.");var c=document.createElement("script");window.__fs_startResponse=
function(a){W(a);document.body.removeChild(c)};c.src="//"+I+"/rec/page?OrgId="+D+"&UserId="+y+"&Url="+encodeURIComponent(location.href)+"&Base="+encodeURIComponent(m())+"&ScreenWidth="+window.screen.width+"&ScreenHeight="+window.screen.height+"&Width="+b.clientWidth+"&Height="+b.clientHeight+"&Referrer="+encodeURIComponent(document.referrer)+"&Doctype="+encodeURIComponent(X())+"&Fallback=true"+(d?"&Hash="+d:"");document.body.appendChild(c)}}function oa(){(new window.MutationObserver(function(b){for(var d=
0;d<b.length;++d){var c=b[d],f=a.fsid(c.target);if(f)switch(c.type){case "characterData":var e=c.target.textContent;c.oldValue==e||a.isBlocked(c.target)||n.enqueue(a.EVENT_MUT_TEXT,[f,e]);break;case "attributes":var g=c.attributeName,e=c.target.getAttribute(g);c.oldValue!=e&&n.enqueue(a.EVENT_MUT_ATTR,[f,g,e]);break;case "childList":0<c.addedNodes.length&&!a.isBlocked(c.target)&&(e=c.nextSibling?a.fsid(c.nextSibling):-1,l(f,e,c.addedNodes));f=c.removedNodes;e=[];for(g=0;g<f.length;++g){var Y=a.fsid(f[g]);
z.find(Y)&&(e.push(Y),a.unpinNodes(z.remove(a.fsid(f[g]))))}0<e.length&&n.enqueue(a.EVENT_MUT_REMOVE,e)}for(c=c.target;c&&!a.hasFsid(c);)c=c.parentNode;c&&a.isBlocked(c)&&(e=c.getBoundingClientRect(),f=Math.floor(e.width),e=Math.floor(e.height),n.enqueue(a.EVENT_PLACEHOLDER_SIZE,[a.fsid(c),f,e]))}})).observe(document.documentElement,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0});document.documentElement.addEventListener("scroll",function(b){b=
b.target;var c=a.fsid(b);c&&n.enqueue(a.EVENT_SCROLL,[c,b.scrollLeft,b.scrollTop])},!0);window.addEventListener("mousemove",function(b){b=a.hasFsid(b.target)?[b.clientX,b.clientY,a.fsid(b.target)]:[b.clientX,b.clientY];n.enqueue(a.EVENT_MOUSEMOVE,b)},!0);window.addEventListener("mousedown",function(b){n.enqueue(a.EVENT_MOUSEDOWN,[b.clientX,b.clientY]);!B(b.target,{button:!0,a:!0,input:!0})||"input"==w(b)&&"submit"!=b.target.type||n.swanSong()},!0);window.addEventListener("mouseup",function(b){n.enqueue(a.EVENT_MOUSEUP,
[b.clientX,b.clientY])},!0);window.addEventListener("keydown",function(b){F();var c=document.activeElement;c&&!a.fsidIfNotBlocked(c)||n.enqueue(a.EVENT_KEYDOWN,[b.keyCode]);switch(w(b)){case "button":13!=b.keyCode&&32!=b.keyCode||n.swanSong();break;case "a":13==b.keyCode&&n.swanSong();break;case "input":"submit"==b.target.type&&13==b.keyCode&&n.swanSong()}},!0);window.addEventListener("keyup",function(b){F();var c=document.activeElement;c&&!a.fsidIfNotBlocked(c)||n.enqueue(a.EVENT_KEYUP,[b.keyCode])},
!0);window.addEventListener("scroll",function(a){A()});window.addEventListener("resize",function(a){G()});document.body.addEventListener("click",function(b){(b=a.fsid(b.target))&&n.enqueue(a.EVENT_CLICK,[b])},!0);document.body.addEventListener("focus",function(b){(b=a.fsid(b.target))&&n.enqueue(a.EVENT_FOCUS,[b])},!0);document.body.addEventListener("blur",function(b){(b=a.fsid(b.target))&&n.enqueue(a.EVENT_BLUR,[b])},!0);document.body.addEventListener("change",function(a){U(a.target)},!0);window.addEventListener("touchstart",
function(b){q(b,a.EVENT_TOUCHSTART)},!0);window.addEventListener("touchend",function(b){q(b,a.EVENT_TOUCHEND)},!0);window.addEventListener("touchmove",function(b){q(b,a.EVENT_TOUCHMOVE);A()},!0);window.addEventListener("touchcancel",function(b){q(b,a.EVENT_TOUCHCANCEL)},!0);window.addEventListener("play",function(b){var c=a.EVENT_PLAY;(b=a.fsid(b.target))&&n.enqueue(c,[b])},!0);window.addEventListener("pause",function(b){var c=a.EVENT_PAUSE;(b=a.fsid(b.target))&&n.enqueue(c,[b])},!0);M=new a.InputWatcher(function(a){U(a)},
function(a){return!!z.find(a)});if(history.pushState){window.addEventListener("popstate",function(){P()});var b=history.pushState;history.pushState=function(a,c,d){b.call(this,a,c,d);P()};var d=history.replaceState;history.replaceState=function(a,b,c){d.call(this,a,b,c);P()}}}function pa(){var c=!1,d=function(){c||(c=!0,oa(),n.enqueue(a.EVENT_DOMLOADED,[]),n.enqueue(a.EVENT_MUT_UNPARSED_INSERT,[-1,-1,document.documentElement]),G())},e=!1,f=function(){e||(e=!0,n.enqueue(a.EVENT_LOAD,[]))};switch(document.readyState){case "interactive":document.attachEvent||
d();break;case "complete":d(),f()}c||document.addEventListener("DOMContentLoaded",function(a){d()});e||window.addEventListener("load",function(a){d();f()});b()||(window.addEventListener("beforeunload",function(a){V()}),window.addEventListener("unload",function(a){V()}))}function qa(){var a=window.FS.q;if(a){for(var b=0;b<a.length;b++)fa(a[b][0],a[b][1]);delete window.FS.q}}function fa(b,c){var d={},e;for(e in c)if(c.hasOwnProperty(e)){var g=c[e];f("set-var("+b+'): "'+e+'" = '+k(g));"user"!=b&&f('invalid scope "'+
b+'"; only "user" is supported at present');var h;if(e in ga)h=ga[e];else{h=e.split("_");if(2!=h.length){f('variables must be of the form "name_type", where "type" is one of [str, bool, int, real, date]');continue}h=h[1]}h in ha?ha[h](g)?("date"==h&&(g=(g.constructor===Date?g:new Date(g)).toISOString()),d[e]=g):f("illegal value "+k(g)+" for type "+h):f('invalid type "'+h+'"')}n.enqueue(a.EVENT_SYS_SETVAR,[b,k(d)])}function ia(){return y+":"+N}function ra(){window.addEventListener("message",function(b){if("string"==
typeof b.data&&0==b.data.indexOf(a.FS_MESSAGE_PREFIX)){var c=b.data.split(a.FS_DELIMITER);if(c[0]==a.FS_SET_FRAME_ID_CMD)try{var d=parseInt(c[1]),e=parseInt(c[2]);var g=JSON.parse(c[3]);if(d){f("iframe recording. FrameId: "+d);C=d;for(c=0;c<g.length;++c)v.addRule(g[c]);n.rebaseIframe(e);H=e;n.startPipeline()}else f("Outer page gave us a bogus frame Id! Iframe: "+location.href)}catch(h){f("Failed to parse frameId from message"+b.data)}else c[0]==a.FS_DISABLE_RECORDING?(n.disableRecording(),ea()):f("Invalid _fs postmessage command"+
c[0])}});C||(0==C?f("For some reason the outer window attempted to request a frameId"):parent.postMessage(a.FS_REQUEST_FRAME_ID+a.FS_DELIMITER,"*"))}function ea(){for(var b=0;b<J.length;b++){var c=J[b];c.contentWindow&&c.contentWindow.postMessage&&c.contentWindow.postMessage(a.FS_DISABLE_RECORDING,"*")}}function ma(){window.addEventListener("message",function(b){if("string"==typeof b.data&&0==b.data.indexOf(a.FS_MESSAGE_PREFIX)){var c=b.data.split(a.FS_DELIMITER);if(c[0]==a.FS_IFRAME_EVENTS){b=JSON.parse(c[1]);
var c=n.lastSentEventTime(),d=ba[b[0].FId];c<d&&(c=d);if(b[0].When<c)for(var c=c-b[0].When,d=0,e=b.length;d<e;d++)b[d].When+=c;n.appendToOutgoingQueue(b)}else if(c[0]==a.FS_REQUEST_FRAME_ID){a:{c=b.source;for(d=0;d<J.length;d++)if(J[d].contentWindow==c){c=a.fsid(J[d]);break a}f("Unable to locate frame for window");c=NaN}c?(d=k(v.rawRules),b.source.postMessage(a.FS_SET_FRAME_ID_CMD+a.FS_DELIMITER+c+a.FS_DELIMITER+H+a.FS_DELIMITER+d,"*")):f("No FrameId found. Hoping to send one later.")}else f("Invalid _fs postmessage command"+
c[0])}})}function T(a){try{if("FS"in a.contentWindow)f("'FS' already defined in iframe. Aborting injection.");else{var b="if (!('FS' in window)) { var _fs_org='"+D+"', _fs_host='"+I+"', _fs_run_in_iframe=true, _fs_debug="+K+"; (function(w,a,t){a=w.createElement('script');a.async=1;a.src='https://'+_fs_host+'/s/fs.js';w.head.appendChild(a)})(document); }",c=a.contentDocument,d=c.createElement("script");d.innerText=b;c.head.appendChild(d)}}catch(e){f("iFrame no injecty. Probably not same origin.")}}
function na(b,c){J.push(c);if(c.hasAttribute("src")&&("javascript:;"!=c.src&&"about:blank"!=c.src&&"javascript:false;"!=c.src&&0!=c.src.indexOf(sa)||"FS"in c.contentWindow))f("Frame Doesn't need injecting ["+c.src+"]");else if(f("Attempting to setup Frame ["+c.src+"]"),T(c),c.onload&&"function"==typeof c.onload){var d=c.onload;c.onload=function(a){d.call(this,a);T(c)}}else c.onload=function(){T(c)};if(c.contentWindow.postMessage){var e=k(v.rawRules);c.contentWindow.postMessage(a.FS_SET_FRAME_ID_CMD+
a.FS_DELIMITER+b+a.FS_DELIMITER+H+a.FS_DELIMITER+e,"*")}}var K=!1,Q=0,D,y,N,L,C,I,da,sa=window.location.protocol+"//"+window.location.host,Z,O,H=d(),$=!1,S,ba={},aa,z,v=new a.Blocker,M,n,ta={startTime:function(){return H},now:c,wallTime:d,orgId:function(){return D},userId:function(){return y},sessionId:function(){return N},pageId:function(){return L},baseUri:m,amInsideIFrame:b,frameId:function(){return C},post:h};a.log=f;a.stringify=k;var R=function(){function a(b,c){this._q=b;this._valueIndices=
c;this._evts=[]}a.prototype.add=function(a){0==this._evts.length&&x(this._q,a);this._evts.push(a)};a.prototype.finish=function(a,b){var c=this._evts.length;if(1>=c)return!1;for(var d=this._evts[0].When,e=this._evts[c-1].When,f=0;f<this._valueIndices.length;++f){var g=this._valueIndices[f],h=this._evts[0].Args[g],k=(this._evts[1].When-d)/(e-d),m=(this._evts[1].Args[g]-h)/k,l=this._evts[c-1].Args[g],k=(e-this._evts[c-2].When)/(e-d);b.push(h,l,m,(l-this._evts[c-2].Args[g])/k)}this._evts[0].Kind=a;this._evts[0].Args=
b;return!0};a.prototype.evts=function(){return this._evts};return a}();a.processQueue=g;var ca=!1;a._init=function(){"_fs_host"in window||"_fs_ext_host"in window?"_fs_org"in window||"_fs_ext_org"in window?("_fs_ext_debug"in window?K=!!window._fs_ext_debug:"_fs_debug"in window&&(K=!!window._fs_debug),I=window._fs_ext_host||window._fs_host,D=window._fs_ext_org||window._fs_org,Z=!!window._fs_is_outer_script,C=b()?null:0,f("host: "+I),f("orgid: "+D),O=!!window.MutationEvent,n=new a.EventQueue(ta,g,function(){M&&
M.tick()}),b()?window._fs_run_in_iframe?parent.postMessage?ra():(O=!1,f("postMessage not supported")):f("Fullstory recording for this page is NOT allowed within an iFrame."):(v.addRule({Selector:"object",Kind:a.NYI_KIND}),v.addRule({Selector:"embed",Kind:a.NYI_KIND}),v.addRule({Selector:"canvas",Kind:a.NYI_KIND}),v.addRule({Selector:"noscript",Kind:a.BLOCKED_KIND}),v.addRule({Selector:".fs-hide",Kind:a.HIDE_KIND}),qa(),la())):f("Missing global _fs_org. Recording disabled."):f("Missing global _fs_host. Recording disabled.")};
a._record=function(){O&&(n.recoverSwanSong(),z=new a.IdTree,H=d(),pa())};var ga={uid:"str",displayName:"str",email:"str"},ha={str:function(a){return"string"==typeof a},bool:function(a){return"boolean"==typeof a},"int":function(a){return"number"==typeof a&&0==a-Math.floor(a)},real:function(a){return"number"==typeof a},date:function(a){return!isNaN(a.constructor===Date?a:new Date(a))}};a._api=fa;a.setUid=function(b,c,d){b&&"string"==typeof b?c&&"string"!=typeof c?f("setUid(): second argument (display name) must be a string"):
(c||(c=b),d&&"object"!=typeof d?f('setUid(): third argument (metadata) must be of the form {name0: "value0", name1: "value1", ...}'):(d=d?k(d):"",f("setting uid: "+b+", meta: "+d),n.enqueue(a.EVENT_SYS_SETMETA,[b,c,d]))):f("setUid(): first argument (user id) is required and must be a string")};a.getCurrentSessionURL=function(){return"https://"+I+"/ui/"+D+"/discover/session/"+ia()};a.getCurrentSession=ia;a.FS_MESSAGE_PREFIX="_fs";a.FS_DELIMITER="\u2603";a.FS_REQUEST_FRAME_ID=a.FS_MESSAGE_PREFIX+"RequestFrameId";
a.FS_SET_FRAME_ID_CMD=a.FS_MESSAGE_PREFIX+"SetFrameId";a.FS_IFRAME_EVENTS=a.FS_MESSAGE_PREFIX+"EvtBundle";a.FS_DISABLE_RECORDING=a.FS_MESSAGE_PREFIX+"DisableRecording";var J=[]})(m||(m={}));try{"FS"in window||(window.FS={}),window.FS.setUid=m.setUid,window.FS.getCurrentSessionURL=m.getCurrentSessionURL,window.FS.getCurrentSession=m.getCurrentSession,window.FS._api=m._api,window.FS.m=m,m._init()}catch(w){window.console&&console.log&&console.log("Failed to initialize FullStory.")}})();
}
var _;(function(a){(function(a){var k=function(){function a(){}a.cleanupMemoizedReactiveProperties=function(a){if(a.__memoized)for(var g in a.__memoized)a.__memoized[g].cleanup&&a.__memoized[g].cleanup()};a.removeFromMemoizeParent=function(a){a.__memoizeParent&&delete a.__memoizeParent.__memoized[a.__memoizeName];delete a.__memoizeParent;delete a.__memoizeName};return a}();a.Memoize=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.len=function(c){return c.length};a.mapMap=function(c,a){return c.map(function(c){return c.map(a)})};a.map=function(c,a){return Array.prototype.map.call(c,a)};a.mapProp=function(c,a){return Array.prototype.map.call(c,function(c){return c&&c[a]})};a.mapcat=function(c,a){return h.apply(this,p(c,a))};a.mapMaybe=function(c,a){for(var d=[],b=0;b<c.length;b++){var q=a(c[b],b);void 0!==q&&d.push(q)}return d};a.forEach=function(c,a){return Array.prototype.forEach.call(c,
a)};a.reduce=function(c,a,d){return Array.prototype.reduce.apply(c,d?[a,d]:[a])};a.fold=function(c,a){return function(){return g(arguments,c,a)}};a.enumFromTo=function(c,a,d){var b=[];if(d==Math.floor(d))for(var q=c;q<=a;q+=d)b.push(q);else{d=1/d;for(var f=0;;f++){q=(c*d+f)/d;if(q>a)break;b.push(q)}}return b};a.sum=function(c){return c.reduce(function(c,a){return+c+ +a},0)};a.max=function(c){return Math.max.apply(Math,c)};a.min=function(c){return Math.min.apply(Math,c)};a.average=function(c){return e(c)/
c.length};a.or=function(c){return c.reduce(function(c,a){return c||a},!1)};a.dropLast=function(c){return c.slice(0,c.length-1)};a.tails=function(c){for(var a=[],d=0;d<c.length;d++)a.push(c.slice(d));a.push([]);return a};a.reverse=function(c){return Array.prototype.reverse.call(r(c))};a.sort=function(c,a){return r(c).sort(a)};a.sortByComparing=function(c,a){void 0===a&&(a=function(c){return c});return c.sort(function(c,d){var b=a(c),q=a(d);return b<q?b==q?0:-1:1})};a.segments=function(c,a){if(1>a)throw Error("Arrays.segments: segment size must be greater than 0.");
for(var d=[],b=0;b<c.length;b+=a)d.push(c.slice(b,b+a));return d};a.transpose=function(c){if(!c.length)return[];for(var a=Math.max.apply(this,c.map(function(c){return c.length})),d=[],b=0;b<a;b++){for(var q=[],f=0;f<c.length;f++)q.push(c[f][b]);d.push(q)}return d};a.groupByComparing=function(c,a){for(var d=NaN,b=[],q=null,f=0;f<c.length;f++){var e=a(c[f]);e==d?q.push(c[f]):b.push(q=[c[f]]);d=e}return b};a.sortAndGroupByComparing=function(c,a){return b(d(c,a),a)};a.head=function(c){return c[0]};a.last=
function(c){return c[c.length-1]};a.remove=function(c,a){var d=c.indexOf(a);-1<d&&c.splice(d,1)};a.idx=function(c){return function(a){return a&&a[c]}};a.pick=function(c,a){for(var d=[],b=0;b<a.length;b++)d.push(c[a[b]]);return d};a.indexOf=function(c,a,d){if(!d)return Array.prototype.indexOf.call(c,a);for(var b=0;b<c.length;b++)if(d(c[b],a))return b;return-1};a.find=function(c,a){for(var d=0;d<c.length;d++)if(a(c[d]))return c[d];return null};a.filter=function(c){return function(a){return a.filter(c)}};
a.contains=function(c,a,d){return-1<n(c,a,d)};a.itemByProp=function(c,a,d){c=c.filter(function(c){return c[a]==d});return c.length?c[0]:void 0};a.notNull=function(c){return c.filter(function(c){return void 0!==c&&null!==c})};a.split=function(c,a){for(var d=[],b=[],q=0;q<a.length;q++)0<q&&c(a[q])&&(d.push(b),b=[]),b.push(a[q]);0<q&&d.push(b);return d};a.group=function(c,a){a||(a=function(c,a){return c===a});for(var d=[],b=[],q=0;q<c.length;q++)0<q&&!a(c[q-1],c[q])&&(d.push(b),b=[]),b.push(c[q]);0<
q&&d.push(b);return d};a.partition=function(c,a){for(var d=[],b=[],q=0;q<c.length;q++)a(c[q])?d.push(c[q]):b.push(c[q]);return[d,b]};a.stringJoin=function(c){return c.join("")};a.createFilled=function(c,a){for(var d=Array(c),b=0;b<d.length;b++)d[b]=a;return d};a.singleton=function(c){return[c]};a.slice=function(c,a,d){return"undefined"!=typeof d?Array.prototype.slice.call(c,a,d):Array.prototype.slice.call(c,a)};a.append=function(c,a){return Array.prototype.concat.apply([],arguments)};a.concat=function(c){return[].concat.apply([],
c)};a.concatMap=function(c,a){return f(p(c,a))};a.join=function(c,a){return Array.prototype.join.call(c,a)};a.pushMany=function(c,a){Array.prototype.push.apply(c,a)};a.equals=function(c,a,d){if(!c&&!a)return!0;if(!c||!a)return!1;d||(d=function(c,a){return c===a});if(c.length!=a.length)return!1;for(var b=c.length-1;0<=b;b--)if(!d(c[b],a[b]))return!1;return!0};a.equals1=function(a,d,b){return c(a,d,function(a,d){return c(a,d,b)})};a.clone=function(c){for(var a=[],d=0;d<c.length;d++)a[d]=c[d];return a};
a.unique=function(c){for(var a={},d=[],b=0,q=c.length;b<q;++b)a.hasOwnProperty(c[b])||(a[c[b]]=!0,d.push(c[b]));return d};a.localUniqueBy=function(c,a){a=a||function(c,a){return c===a};for(var d=[],b,q=0;q<c.length;q++)void 0!==b&&a(c[q],b)||d.push(b=c[q]);return d};a.uniqueBy=function(c,a){a=a||function(c,a){return c===a};for(var d=[],b=0;b<c.length;b++)s(function(d){return a(c[b],d)},d)||d.push(c[b]);return d};a.zipWith=function(c,a,d){for(var b=[],q=0;q<a.length&&q<d.length;q++)b[q]=c(a[q],d[q]);
return b};a.prettyJoin=function(c,a,d,b,q,f){var e=c.length,s=Math.min(Math.max(1,e-(e<=a?1:2)),a);return c.slice(0,s).join(d)+(1>=e?"":e<=a?b+c[e-1]:q+(e-s)+f)};a.all=function(c,a){for(var d=!0,b=0;b<a.length&&(d=d&&c(a[b]),d);b++);return d};a.any=function(c,a){for(var d=0;d<a.length;d++){var b=c(a[d]);if(!1!==b&&void 0!==b&&null!==b)return b}return!1};a.intersect=function(c,a){for(var d=[],b=0;b<c.length;b++)for(var f=0;f<a.length;f++)c[b]===a[f]&&d.push(c[b]);return q(d)};a.intersects=function(c){return c.reduce(u)};
a.range=function(c,a){for(var d=[];c<a;)d.push(c++);return d};a.flatten=function(c){var a=[];t(c,a);return a};a.flatten_=function z(c,a){for(var d=0;d<c.length;d++)c[d]instanceof Array?z(c[d],a):a.push(c[d])};a.diff=function(c,a,d){return v([],c,a,c.length-1,a.length-1,d).diff};a.diff_=function B(c,a,d,b,q,f){if(c[b]&&c[b][q])return c[b][q];if(0>b&&0>q)return{diff:[],length:0};if(0>b)return{diff:[{action:"insert",items:d.slice(0,q+1)}],length:q+1};if(0>q)return{diff:[{action:"remove",count:b+1}],
length:b+1};void 0===c[b]&&(c[b]=[]);(f?f(a[b],d[q]):a[b]===d[q])?(a=B(c,a,d,b-1,q-1),c[b][q]={diff:a.diff.concat([{action:"keep"}]),length:a.length}):c[b][q]=x(B(c,a,d,b-1,q),B(c,a,d,b,q-1),q,d);return c[b][q]};a.best=function(c,a,d,b){var q=c.length,f=a.length;return q<f?{diff:w(c.diff),length:c.length+1}:f<q?{diff:y(a.diff,b[d]),length:a.length+1}:{diff:w(c.diff),length:c.length+1}};a.addRemove=function(c){if(0===c.length)return[{action:"remove",count:1}];var a=c[c.length-1];return"remove"===a.action?
(a={action:"remove",count:1+a.count},c=c.slice(0,c.length-1),c.push(a),c):c.concat([{action:"remove",count:1}])};a.addInsert=function(c,a){if(0===c.length)return[{action:"insert",items:[a]}];var d=c[c.length-1];if("insert"===d.action){var d={action:"insert",items:d.items.concat([a])},b=c.slice(0,c.length-1);b.push(d);return b}return c.concat([{action:"insert",items:[a]}])};a.diffLength=function(c){var a=0;c.forEach(function(c){switch(c.action){case "keep":break;case "insert":a+=c.items.length;break;
case "remove":a+=c.count;break;default:throw Error("Unknown action: "+c.action);}});return a};a.patch=function(c,a){var d=[],b=c.length-1;a.reverse().forEach(function(a){switch(a.action){case "keep":d.unshift(c[b]);b--;break;case "remove":b-=a.count;break;case "insert":d.unshift.apply(d,a.items);break;default:throw Error("Unknown action: "+a.action);}});return d};var p=a.map,g=a.reduce,e=a.sum,d=a.sortByComparing,b=a.groupByComparing,n=a.indexOf,r=a.slice,h=a.append,f=a.concat,c=a.equals,q=a.unique,
s=a.any,u=a.intersect,t=a.flatten_,v=a.diff_,x=a.best,w=a.addRemove,y=a.addInsert;return a}();a.Arrays=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){return function(){}}();a.DebugOnly=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){return function(){}}();a.Prop=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Memoize,l=a.typlib.Arrays,p=function(){function a(e,d){var b;if(b=function(a,d){this.reactors=[];this.linkedTo=[];this.busy=this.persistent=this.safeLinked=!1;this.reactive=!0;this.oname=null;this.biactorGroups=[];this.unlinking=this.unlinked=!1}.apply(b||this,arguments))return b}a.newBiactorGroup=function(){return a.nextBiactorGroupId++};a.lens=function(e,d,b){e.safeLinked&&d.safeLinked&&console.error("Both",e,"and",d,"already linked in lens");b||(b=a.newBiactorGroup(),
e.addBiactorGroup(b),d.addBiactorGroup(b));d.link(e,!0);e.is(d,!0)};a.unR=function(a){return a.unR?a.unR():a};a.nextBiactorGroupId=0;a.Reactive=a;a.prototype.dispatchCleanup=function(a){};a.prototype.name=function(a){return this.debugName(a).persist()};a.prototype.debugName=function(){Array.prototype.slice.call(arguments,1);return this};a.prototype.persist=function(){this.persistent=!0;return this};a.prototype.getName=function(){return this.oname};a.prototype.addBiactorGroup=function(a){this.biactorGroups.push(a);
return this};a.prototype.removeBiactorGroup=function(a){l.remove(this.biactorGroups,a);return this};a.prototype.getBiactorGroups=function(){return this.biactorGroups};a.prototype.is=function(a,d){this.link(a,d);a.init(this)};a.prototype.link=function(a,d){!d&&this.safeLinked&&console.error(this,"already linked to",this.linkedTo,"when trying to link to",a);this.linkedTo.push(a);d||(this.safeLinked=!0);this.unlinked=!1;a.reactors.push(this)};a.prototype.unregister=function(a,d){d||this.dispatchCleanup(a);
var b=this.reactors.indexOf(a);-1===b?console.warn("Actor not found during Reactive.unregister."):(this.reactors.splice(b,1),b=this.doUnlink(),!this.persistent&&b&&this.unlink(d))};a.prototype.doUnlink=function(){if(this.unlinking)return!1;for(var a=this.getBiactorGroups(),d=!0,b,n=0;n<this.reactors.length;n++){var r=this.reactors[n].getBiactorGroups(),r=l.intersect(r,a);if(0===r.length){d=!1;break}if(b&&!l.equals(r,b)){d=!1;break}if(-1===this.linkedTo.indexOf(this.reactors[n])){d=!1;break}b=r}if(d&&
b)for(n=0;n<this.linkedTo.length;n++){r=this.linkedTo[n].getBiactorGroups();r=l.intersect(r,a);if(0===r.length){d=!1;break}if(!l.equals(r,b)){d=!1;break}}return d};a.prototype.cleanup=function(){this.unlink()};a.prototype.unlink=function(a){this.unlinking=!0;k.cleanupMemoizedReactiveProperties(this);k.removeFromMemoizeParent(this);for(var d=0;d<this.linkedTo.length;d++)this.linkedTo[d].unregister(this,a);this.linkedTo=[];this.safeLinked=!1;this.biactorGroups=[];this.unlinked=!0;this.unlinking=!1};
a.prototype.unlinkOne=function(a,d){var b;b=this.linkedTo.indexOf(a);-1<b&&(this.linkedTo.splice(b,1),a.unregister(this,d));0===this.linkedTo.length&&(this.safeLinked=!1)};a.prototype.dispatchDo=function(a,d,b){if(!a.unlinked&&!a.busy){var n="on"+d;a[n]?a[n].apply(a,b):console.error("Reactive target object ",a," has no handler for method ",d)}};a.prototype.dispatch=function(a,d,b,n){this.busy=!0;Array.prototype.unshift.call(d,this);if(b)this.dispatchDo(b,a,d);else for(b=this.reactors.slice(),n=0;n<
b.length;n++)this.dispatchDo(b[n],a,d);this.busy=!1};a.prototype.toString=function(){return"[Reactive "+this.getName()+"]"};return a}();m.Reactive=p})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=function(){function a(){}a.compose=function(){Array.prototype.slice.call(arguments,0);return k.reduce(arguments,g)};a.compose2=function(c,a){var d=function(d){return c(a(d))};d.name="compose("+c.name+", "+a.name+")";return d};a.partial=function(c){var a=Array.prototype.slice.call(arguments,1);return function(){return c.apply(this,k.append(a,k.slice(arguments)))}};a.neg=function(c){return!c};a.not=function(c){return function(a){return!c(a)}};a.is=function(c){return function(a){return c==
a}};a.isOneOf=function(){var c=k.slice(arguments);return function(a){return-1!=c.indexOf(a)}};a.gt=function(c){return function(a){return a>c}};a.lt=function(c){return function(a){return a<c}};a.on=function(c,a){return function(d,b){return a(c(d),c(b))}};a.constant=function(c){return function(a){return c}};a.compare=function(c,a){return c<a?-1:c==a?0:1};a.comparing=function(){var a=Array.prototype.slice.call(arguments,0);return k.reduce(a.map(f),c)};a.combineCompares=function(){return k.reduce(arguments,
c)};a.compareAsEnum=function(c){return function(a,d){var b=c.indexOf(a),f=c.indexOf(d);-1===b&&console.warn(a,"not in enum",c,"in compareAsEnum");-1===f&&console.warn(d,"not in enum",c,"in compareAsEnum");b-=f;return 0<b?1:0>b?-1:0}};a.equals=function(c,a){return c===a};a.equating=function(){return k.reduce(k.map(arguments,r),h)};a.id=function(c){return c};a.nop=function(){};a.flip=function(c){return function(a,d){return c(d,a)}};a.nullary=function(c){return function(){return c()}};a.unary=function(c){return function(a){return c(a)}};
a.once=function(c){var a=!1;return function(){if(a)return null;a=!0;return c.apply(null,arguments)}};a.add=function(c){return function(a){return c+a}};a.subtract=function(c){return n(-c)};a.exec=function(c){c.apply(this,arguments);return c};a.returning=function(c,a){return function(){c.apply(this,arguments);return a}};a.apply=function(c){var a=k.slice(arguments,1);return function(){return(a.length?this[c].apply(this,a):this[c]).apply(this,arguments)}};a.debounce=function(c,a,d){var b,f,e,h,n,r=function(){var g=
Date.now()-h;g<a?b=setTimeout(r,a-g):(b=null,d||(n=c.apply(e,f),e=f=null))};return function(){e=this;f=arguments;h=Date.now();var g=d&&!b;b||(b=setTimeout(r,a));g&&(n=c.apply(e,f),e=f=null);return n}};a.equating1=function(c){return e(c,b)};a.combineEquals2=function(c,a){return function(d,b){return c(d,b)&&a(d,b)}};a.comparing1=function(c){return e(c,d)};a.combineCompares2=function(c,a){return function(d,b){var f=c(d,b);return 0!==f?f:a(d,b)}};var g=a.compose2,e=a.on,d=a.compare,b=a.equals,n=a.add,
r=a.equating1,h=a.combineEquals2,f=a.comparing1,c=a.combineCompares2;return a}();m.Functions=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.get=function(a){try{return window.localStorage&&window.localStorage[a]}catch(g){}};a.set=function(a,g){try{window.localStorage&&(window.localStorage[a]=g)}catch(e){}};return a}();a.LocalStorage=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.wrap=function(a){p(a);g(a);e(a);d(a);b(a);n(a);r(a)};a.wrapjQueryOn=function(a){var d=$.fn.on;$.fn.on=function(){for(var c=Array.prototype.slice.call(arguments),b=c.length;1<b;--b)if(c[b-1]&&c[b-1].call){c[b-1].wrapped||(c[b-1].wrapped=a(c[b-1],"event"));c[b-1]=c[b-1].wrapped;break}return d.apply(this,c)};var c=$.fn.off;$.fn.off=function(a,d,b){return b&&b.wrapped?c.call(this,a,d,b.wrapped):d&&d.wrapped?c.call(this,a,d.wrapped,b):c.apply(this,
arguments)}};a.wrapjQueryReady=function(a){var d=$.fn.ready;$.fn.ready=function(c){c.wrapped||(c.wrapped=a(c,"ready"));return d.call(this,c.wrapped)}};a.wrapTimeout=function(a){var d=setTimeout;window.setTimeout=function(c){"function"==typeof c&&(arguments[0]=a(c,"timeout"));return d.apply(this,arguments)}};a.wrapInterval=function(a){var d=setInterval;window.setInterval=function(c){"function"==typeof c&&(arguments[0]=a(c,"interval"));return d.apply(this,arguments)}};a.wrapAjax=function(a){var d=$.ajax;
$.ajax=function(c){for(var b in c.statusCode)c.statusCode[b]=a(c.statusCode[b],"ajax.statusCode",c);return d.call(this,c)}};a.wrapMutationObserver=function(a){var d=window.MutationObserver||window.WebKitMutationObserver;d&&(window.MutationObserver=function(c){c.wrapped||(c.wrapped=a(c,"MutationObserver.constructor"));return new d(c.wrapped)})};a.wrapJQueryCallbacks=function(a){var d=$.Callbacks;$.Callbacks=function(){var c=d.apply(this,arguments);c.fireWith=a(c.fireWith,"Callbacks.fireWith");return c}};
var p=a.wrapjQueryOn,g=a.wrapjQueryReady,e=a.wrapTimeout,d=a.wrapInterval,b=a.wrapAjax,n=a.wrapMutationObserver,r=a.wrapJQueryCallbacks;return a}();a.Thread=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(){}a.init=function(){g.objectId=0;g.currentThreadWrapped=!1};a.idForObject=function(a){return a.__threadEndId?a.__threadEndId:a.__threadEndId=g.objectId++};var g=a;return a}();a.Helpers=l;l.init()})(a.threadEnd||(a.threadEnd={}))})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.threadEnd.Helpers,p=function(){function a(){var d;if(d=function(){this.labeledFns={};this.unlabeledFns=[]}.apply(d||this,arguments))return d}a.runFunction=function(a){a.fun.apply(this,a.args)};var e=a.runFunction;a.Callbacks=a;a.prototype.register=function(a,b,e,r){l.currentThreadWrapped||console.error("onThreadEnd: current thread not wrapped by ThreadEnd when adding function",a,e);a={fun:a,args:b};e?(r=l.idForObject(r||this),this.labeledFns[r]||
(this.labeledFns[r]={}),this.labeledFns[r][e]=a):this.unlabeledFns.push(a)};a.prototype.isEmpty=function(){return $.isEmptyObject(this.labeledFns)&&0===this.unlabeledFns.length};a.prototype.run=function(){var a=this.labeledFns;this.labeledFns={};var b=this.unlabeledFns;this.unlabeledFns=[];for(var n in a)for(var r in a[n])e(a[n][r]);b.forEach(e)};return a}();k.Callbacks=p})(m.threadEnd||(m.threadEnd={}))})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Thread,l=a.typlib.threadEnd.Callbacks,p=a.typlib.threadEnd.Helpers,g=function(){function a(){}a.init=function(){d.threadEndCallbacks=new l;d.beforeThreadEndCallbacks=new l;d.hasFireBug=window&&window.document&&(window.console&&window.console.firebug||window.document.getUserData&&window.document.getUserData("firebug-Token"))};a.setup=function(){k.wrap(b)};a.onBeforeThreadEnd=function(a,d,b,f){this.beforeThreadEndCallbacks.register(a,d,b,f)};a.onThreadEnd=function(a,
d,b,f){this.threadEndCallbacks.register(a,d,b,f)};a.wrapThread=function(b,r){return b&&function(){var h=d.startThread();if(window.SILK_DEBUGGING&&!a.hasFireBug){var f=b.apply(this,arguments);h||d.endThread()}else try{f=b.apply(this,arguments)}catch(c){throw c;}finally{h||d.endThread()}return f}};a.startThread=function(){var a=p.currentThreadWrapped;p.currentThreadWrapped=!0;return a};a.endThread=function(){for(;!this.threadEndCallbacks.isEmpty()||!this.beforeThreadEndCallbacks.isEmpty();)this.beforeThreadEndCallbacks.run(),
this.threadEndCallbacks.run();p.currentThreadWrapped=!1};var d=a,b=a.wrapThread;return a}();m.ThreadEnd=g;g.init()})(a.typlib||(a.typlib={}))})(_||(_={}));var __extends=this.__extends||function(a,m){function k(){this.constructor=a}for(var l in m)m.hasOwnProperty(l)&&(a[l]=m[l]);k.prototype=m.prototype;a.prototype=new k};
(function(a){(function(m){var k=a.reactive.Reactive,l=a.typlib.Arrays,p=a.typlib.Functions,g=a.typlib.LocalStorage,e=a.typlib.ThreadEnd,d=k.lens,b=function(a){function b(c,d){var f;f=a.call(this,c,d);if(f=function(c,a){this.v=c;this.silent=!1;a instanceof Function&&(this.eq=a)}.apply(f||this,arguments))return f}__extends(b,a);b.getName=function(c){return c.getName?c.getName():c.name};b.set=function(c){return function(a){c.set(a)}};b.value=function(c){return c instanceof b?c:(new b(c)).debugName("const("+
c+")")};b.lift=function(c,a,d){return function(){var q=new b,e=[].slice.call(arguments),s=e.map(f),n=s.map(function(c){return c.get()}),g=n,n=n.concat(l.createFilled(n.length,void 0));q.onset=function(a,b){var d=s.indexOf(a);-1===d?console.error("Unknown value sending to lift.",this,a):(n[d]=b,this.set(c.apply(this,n)),n[d+e.length]=b)};s.forEach(function(c){q.link(c,!0)});!0!==a&&q.set(c.apply(q,n));n=g.concat(g);q.debugName(h(c)||"anonymous",s);q.silent=d;return q}};b.once=function(a){return function(b){if(b.v)a(b.v);
else var d=c(function(c,b){c!=b&&(a(c,b),d&&d.cleanup())})(b).debugName(h(a)+"_once")}};b.onchange=function(a,b,d){return function(){var f=c(function(){for(var c=l.slice(arguments,0,arguments.length/2),b=l.slice(arguments,arguments.length/2),d=0;d<c.length;d++)if(c[d]!=b[d]){a.apply(a,arguments);break}},b,d);return f.apply(f,arguments).debugName(h(a))}};b.bridge=function(c,a,d,f){var e=(new b(d)).debugName(c.getName()+"_bridged"),h=!1;c(function(c){h=!0;e.set(c);h=!1});q(function(c){h||a(c)},f)(e);
return e};b.bimap=function(a,b){return u(c(a),c(b))};b.biconnect=function(c,a){return function(b,d){var f=k.newBiactorGroup(),q=c(b);q.addBiactorGroup(f);var e=a(d);e.addBiactorGroup(f);d.is(q,!0);d.addBiactorGroup(f);b.link(e,!0);b.addBiactorGroup(f);return function(c){d.unlinkOne(q,c);b.unlinkOne(e,c)}}};b.toObject=function(c){var a={},b;for(b in c)a[b]=c[b].get();return a};b.toReactiveObject=function(c){function a(b){return function(a){var d={},f;for(f in c)d[f]=c[f].get();d[b]=a;return d}}function d(c){return function(a){return void 0===
a?void 0:a[c]}}l.slice(arguments);var f=new b,q;for(q in c)s(a(q),d(q))(c[q],f);return f};b.persistent=function(c,a,d){c="reactive-value-"+c;a=new b(a);var f=g.get(c);void 0!==f&&a.set(d?d(f):f);a.onchange(function(a){g.set(c,a)});return a.name(c)};b.transpose=function(){return b.lift(function(){return l.slice(arguments,0,arguments.length/2)})}();var h=b.getName,f=b.value,c=b.lift,q=b.onchange,s=b.bimap,u=b.biconnect;b.Value=b;b.prototype.get=function(){return this.v};b.prototype.getAndUnlink=function(){var c=
this.get();this.unlink();return c};b.prototype.set=function(c){if(!this.busy){var a;a=c;(this.eq?this.eq(this.v,a):this.v===a)?a=!1:(this.v=a,a=!0);!1!==a&&this.dispatch("set",arguments);return a}};b.prototype.modify=function(c){this.set(c(this.get()))};b.prototype.init=function(c){this.dispatch("set",[this.get()],c,!0)};b.prototype.dispatchCleanup=function(c){this.dispatch("set",[],c)};b.prototype.setLazy=function(c){var a=this;return function(){a.set(c)}};b.prototype.map=function(c,a){return b.lift(c,
a)(this)};b.prototype.mapValue=function(c,a){var d;return b.lift(function(a,b){"undefined"!==typeof a&&(d=c(a));return d},a)(this)};b.prototype.mapProp=function(c,a){return this.map(function(a){return a&&a[c]},a)};b.prototype.onchange=function(c,a,d){return b.onchange(c,a,d)(this)};b.prototype.once=function(c){return b.once(c)(this)};b.prototype.wait=function(c,a,b,d){function f(b){!e&&c(b)&&(e=!0,a(b),q.unlink(),clearTimeout(h))}var q=this.onchange(f,!0),e=!1,h;f(this.get());void 0!==b&&(h=setTimeout(function(){e=
!0;q.unlink();d&&d()},b));return q};b.prototype.waitConst=function(c,a){return this.wait(function(a){return a==c},a)};b.prototype.waitDeferred=function(c){var a=$.Deferred();this.wait(c||function(c){return void 0!==c},function(c){a.resolve(c)});return a};b.prototype.bridge=function(c,a,f){d(this,b.bridge(c,a,f));return this};b.prototype.linkInput=function(c,a,b){this.bridge(function(d){var f;$(c).keyup(function(c){f&&window.clearTimeout(f);f=window.setTimeout(function(){a(c.target.value)&&d(c.target.value)},
b)})},function(a){c.value=a},this.get())};b.prototype.filter=function(a){var b;return c(function(c,d){return a(c,d)?b=c:b})(this)};b.prototype.join=function(c){var a=k.newBiactorGroup();this.addBiactorGroup(a);var f=(new b).debugName("join"),q=null;f.onset=function(b,e){b==this?(q&&(f.unlinkOne(q,!!e),f.safeLinked=!1,q.removeBiactorGroup(a)),e&&(c?d(f,e,!0):f.is(e),e.addBiactorGroup(a)),q=e):f.set(e)}.bind(this);f.is(this,!0);f.addBiactorGroup(a);return f};b.prototype.bind=function(c,a){return this.map(c).join(a).debugName((h(c)||
"bind")+" of "+this.getName())};b.prototype.bindValue=function(c,a){return this.mapValue(c).join(a).debugName((h(c)||"bindValue")+" of "+this.getName())};b.prototype.bindProp=function(c,a){return this.bind(function(a){return a&&a[c]},a)};b.prototype.bindCall=function(c,a){var b=this;return function(){var a=arguments;return b.bind(function(b){return b&&b[c].apply(b,a)})}};b.prototype.collapse=function(){var c=(new b).debugName("Value.collapse",this),a=1E5*Math.random();c.onset=function(c,b){e.onThreadEnd(this.set.bind(this),
[b],"Value.collapse"+a)};c.is(this);return c};b.prototype.unR=function(){return void 0===this.v||null===this.v?this.v:this.v.unR?this.v.unR():this.v};b.prototype.sample=function(c){function a(){q&&void 0!==e.get()?(d.set(e.get()),q=!1):(f&&clearTimeout(f),f=setTimeout(function(){d.set(e.get())},c))}var d=(new b).debugName("Value.sample"),f=0,q=!0;c=c||150;var e=this;d.onset=function(c,b){a()};d.is(this);return d};b.prototype.debounce=function(c,a){var d=(new b).debugName("Value.debounce"),f=p.debounce(function(){d.set(q.get())},
c,a),q=this,e=!0;d.onset=function(){e&&void 0!==q.get()?(d.set(q.get()),e=!1):f()};d.is(this);return d};b.prototype.onset=function(){this.set.apply(this,Array.prototype.slice.call(arguments,1))};return b}(m.Reactive);m.Value=b})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(a){var k=function(){return function(){}}();a.Lift=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Value,l=a.typlib.Arrays,p=function(){function a(){}a.liftCompose=function(a){var b=function(){return l.slice(arguments,0,arguments.length/2).reduce(a)};b.cname=a.name+"_composed";return k.lift(b)};a.toggle=function(a){a.set(!a.get())};a.reduce=function(a,b,e){return void 0===e?a.reduce(k.lift(b)):a.reduce(k.lift(b),new k(e))};a.any=function(a,b){return e(b,function(b,e){return b||a(e)},!1)};a.and=a.liftCompose(function(a,b){return a&&b});a.or=a.liftCompose(function(a,
b){return a||b});a.min=a.liftCompose(function(a,b){return Math.min(a,b)});a.max=a.liftCompose(function(a,b){return Math.min(a,b)});a.add=a.liftCompose(function(a,b){return a+b});a.mul=a.liftCompose(function(a,b){return a*b});a.cond=k.lift(function(a,b,e){return a?b:e});a.not=k.lift(function(a){return!a});a.concat=k.lift(function(a){return[].concat.apply([],a)});a.toBool=k.lift(function(a){return!!a});a.undefinedWhenFalse=k.lift(function(a){return a||void 0});a.eq=k.lift(function(a,b){return a==b});
a.neq=k.lift(function(a,b){return a!=b});a.sub=k.lift(function(a,b){return a-b});a.div=k.lift(function(a,b){return a/b});a.lt=k.lift(function(a,b){return a<b});a.lte=k.lift(function(a,b){return a<=b});a.gt=k.lift(function(a,b){return a>b});a.gte=k.lift(function(a,b){return a>=b});a.inRange=k.lift(function(a,b,e){return a>=b&&a<=e});a.inArray=k.lift(function(a,b){return-1!==b.indexOf(a)});var e=a.reduce;return a}();m.Functions=p})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.blacklistedAttributes=function(a){return a.toLowerCase()in{contenteditable:!0}};a.serializeToString=function d(a,n){switch(a.nodeType){case Node.ELEMENT_NODE:var r="<"+(n?a.nodeName:a.nodeName.toLowerCase());if(a.attributes)for(var h=0;h<a.attributes.length;h++)r+=" "+d(a.attributes[h],n);var f="",c=a.childNodes;if(c)for(h=0;h<c.length;h++)f+=d(c[h],n);return r+=f?">"+f+"</"+(n?a.nodeName:a.nodeName.toLowerCase())+">":"/>";case Node.ATTRIBUTE_NODE:return p(a.nodeName)?
"":r=a.nodeName+'="'+g(a.value)+'"';case Node.TEXT_NODE:return g(a.nodeValue);case Node.CDATA_SECTION_NODE:throw Error("Couldn't create this to test. Please report.");case Node.ENTITY_REFERENCE_NODE:throw Error("Couldn't create this to test. Please report.");case Node.ENTITY_NODE:throw Error("Couldn't create this to test. Please report.");case Node.PROCESSING_INSTRUCTION_NODE:return"";case Node.COMMENT_NODE:return"\x3c!--"+a.nodeValue+"--\x3e";case Node.DOCUMENT_NODE:return d(a.documentElement,n);
case Node.DOCUMENT_TYPE_NODE:return"";case Node.DOCUMENT_FRAGMENT_NODE:throw Error("Couldn't create this to test. Please report.");case Node.NOTATION_NODE:throw Error("Couldn't create this to test. Please report.");}};a.escapeXML=function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};var p=a.blacklistedAttributes,g=a.escapeXML;return a}();a.DOMSerializer=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.setup=function(){Function.prototype.getName||(Function.prototype.getName=function(a){return this.cname||this.name})};return a}();a.Scope=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Arrays,p=a.typlib.DOMSerializer,g=function(){function a(d,b){var e;this.serializeNode=this.serializeNode.bind(this);this.serializeChildNodes=this.serializeChildNodes.bind(this);if(e=function(a,b){this.node=a;this.filter=b||function(a){return[a]}}.apply(e||this,arguments))return e}a.Document="document";a.Autosave="autosave";a.Serializer=a;a.prototype.serialize=function(d,b){for(var n=window.document.createElement("article"),r=this.node.attributes,
h=0;h<r.length;h++){var f=r.item(h).nodeName;0===f.indexOf("data-")&&n.setAttribute(f,r.item(h).nodeValue)}this.serializeChildNodes(n,this.node.childNodes,b||a.Document);d||$(n).removeAttr("data-empty");return p.serializeToString(n,!1)};a.prototype.serializeNode=function(a,b){if(a.component&&a.component&&a.component.get()&&a.component.get().serializeToXML)return a.component.get().serializeToXML(this,b);var e=a.cloneNode(!1);this.serializeChildNodes(e,a.childNodes,b);return e};a.prototype.serializeChildNodes=
function(a,b,e){return $(a).html(l.concat(l.slice(b).map(function(a){return this.filter(a,e)}.bind(this))).map(function(a){return this.serializeNode(a,e)}.bind(this)))};return a}();k.Serializer=g})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));__extends=this.__extends||function(a,m){function k(){this.constructor=a}for(var l in m)m.hasOwnProperty(l)&&(a[l]=m[l]);k.prototype=m.prototype;a.prototype=new k};
(function(a){(function(m){var k=a.reactive.Reactive,l=a.reactive.Value,p=a.typlib.Functions,g=a.typlib.LocalStorage,e=a.reactive.Functions,d=a.typlib.Arrays,b=function(a){function b(c,d){var f;f=a.call(this,c,d);if(f=function(c,a){this.list=[];this.eq=a;c&&this.insert(0,c)}.apply(f||this,arguments))return f}__extends(b,a);b.persistent=function(c,a,d,f){c="reactive-list-"+c;var e=g.get(c);void 0!==e&&(a=JSON.parse(e));var h=(new b(a,f)).name(c),n=h.toList().collapse();n.onchange(function(a){g.set(c,
JSON.stringify(a))});if(d)$(window).on("storage",function(a){a=a.originalEvent;null==a.key&&null==a.newValue&&n.v.length&&n.set([]);a.key===c&&a.newValue!=JSON.stringify(n.v)&&(a=JSON.parse(a.newValue),h.set(a))});return h};b.joinList=function(c){var a=(new b).debugName("joinList"),d=null;a.onset=function(c,b){d&&a.unlinkOne(d);b&&a.is(b,!0);d=b};a.is(c);return a};b.valueToList=function(c,a){var d=(new b).debugName("List.valueToList");d.onset=function(c,b){this.clear();void 0!==b?this.push(b):void 0!==
a&&this.push(a)};d.is(c);return d};b.unFlat=function(c){function a(c){for(var b=0,d=0,q=!1,h=0;h<f.length;h++){if(f[h]===c){q=!0;break}e[h]&&b++;d++}return q?{idx:b,validx:d}:null}var d=(new b).debugName("List.unFlat"),f=[],e=[];d.onset=function(b,h){if(b===c)f.forEach(function(c){d.unlinkOne(c)}),f=h=h||[],h.forEach(function(c){d.is(c,!0)});else{var n=a(b);null===n?console.error("Unknown sender in List.unFlat."):(e[n.validx]&&d.remove(n.idx,1),void 0!==h&&d.insert(n.idx,[h]),e[n.validx]=void 0!==
h)}};d.is(c);return d};b.fromList=function(c,a){var d=(new b([],a)).debugName("List.fromList");d.onset=function(c,a){a?this.set(a):this.clear()};d.is(c);return d};b.sequence=function(c){return(new b(c)).flat()};b.fromListBy=function(c){return function(a){return h(a,c)}};b.toListBy=function(c){return function(a){return a.toList(c)}};b.flatBy=function(c){return function(a){return a.flat(c)}};b.unflatBy=function(c){return function(a){var d=(new b([],c)).debugName("List.unflat");d.onset=function(c,a){a?
this.set(a.map(l.value)):this.clear()};d.is(a);return d}};b.fromToList=function(c,a){return l.biconnect(function(c){return c.toList()},h)(c,a)};b.splitJoin=function(c){return function(a,d){function f(c,a){var b=a+n.list.length,q=(new l(c)).debugName("splitJoin.split inner value "+b);(b=d.list[b])&&b.is(q,!0);return q}var e=k.newBiactorGroup(),h=d.flat();h.addBiactorGroup(e);h=h.mapValue(function(a){return a.join(c)});h.addBiactorGroup(e);var n=(new b).debugName("splitJoin.split");n.addBiactorGroup(e);
n.onset=function(a,b){if(b){var d=b.split(c);this.list.length>d.length&&this.remove(d.length,this.list.length-d.length);for(var q=0;q<this.list.length;q++)this.list[q].set(d[q]);d.length>this.list.length&&this.insert(this.list.length,d.slice(this.list.length).map(f))}else this.clear()};n.is(a);d.is(n,!0);d.addBiactorGroup(e);a.is(h,!0);a.addBiactorGroup(e)}};b.computeOffset=function(c,a){for(var b=0,d=0;d<c;d++)b+=a[d].list.length;return b};var h=b.fromList,f=b.computeOffset;b.List=b;b.prototype.init=
function(c){this.dispatch("insert",[0,this.list],c,!0)};b.prototype.dispatchCleanup=function(c){this.dispatch("remove",[0,this.list.length],c)};b.prototype.insert=function(c,a){if(!this.busy){var b;b=c;var d=a;b>this.list.length&&console.warn("List.insert index out of bounds.",b);if(!d.length||b>this.list.length)b=!1;else{for(var f=d.length-1;0<=f;f--)this.list.splice(b,0,d[f]);b=!0}!1!==b&&this.dispatch("insert",arguments);return b}};b.prototype.remove=function(c,a){if(!this.busy){var b;b=c;var d=
a;b+d>this.list.length&&console.warn("List.remove index out of bounds.",b,d);0===d||b>=this.list.length?b=!1:(this.list.splice(b,d||1),b=!0);!1!==b&&this.dispatch("remove",arguments);return b}};b.prototype.replace=function(c,a){if(c>this.list.length)return console.warn("List.replace index out of bounds.",c),!1;this.remove(c,a.length);this.insert(c,a);return!0};b.prototype.clear=function(c){this.remove(c||0,this.list.length)};b.prototype.push=function(c){return this.insert(this.list.length,[c])};b.prototype.pop=
function(){var c=d.last(this.list);0<this.list.length&&this.remove(this.list.length-1,1);return c};b.prototype.shift=function(){var c=this.list[0];0<this.list.length&&this.remove(0,1);return c};b.prototype.unshift=function(c){return this.insert(0,[c])};b.prototype.set=function(c){c=d.diff(this.list,c,this.eq);this.patch(c)};b.prototype.removeItem=function(c){c=this.list.indexOf(c);0<=c&&this.remove(c,1)};b.prototype.removeItemBy=function(c){for(var a=0;a<this.list.length;a++)if(c(this.list[a]))return this.remove(a,
1)};b.prototype.removeItemsBy=function(c){do{var a=this.list.length;this.removeItemBy(c)}while(a!=this.list.length)};b.prototype.length=function(){this.__memoized=this.__memoized||{};if(this.__memoized.length)return this.__memoized.length;var c=function(){var c=(new l(0)).debugName("List.length");c.oninsert=function(c,a,b){this.set(this.get()+b.length)};c.onremove=function(c,a,b){this.set(this.get()-b)};c.is(this);return c}.call(this);this.__memoized.length=c;c.cleanup&&(c.__memoizeParent=this,c.__memoizeName=
"length");return c};b.prototype.sample=function(c){function a(){f&&clearTimeout(f);f=setTimeout(function(){d.clear();d.insert(0,e.list)},c)}var d=(new b).debugName("List.sample"),f=0;c=c||150;var e=this;d.oninsert=function(c,b,d){a()};d.onremove=function(c,b,d){a()};d.is(this);return d};b.prototype.map=function(c,a){var d=(new b).debugName("List.map",c);d.oninsert=function(a,b,d){this.insert(b,d.map(function(a,d){return c(a,b+d)}))};d.onremove=function(c,b,f){if(a)for(c=0;c<f;c++){var e=d.list[b+
c];e?a(e,b+c):console.warn("No output object during map.unF.",d,b,c)}this.remove(b,f)};d.is(this);return d};b.prototype.forEach=function(c,a){var d=(new b).debugName("List.map",c,a);d.is(this);d.oninsert=function(a,b,d){d.forEach(function(a,d){c(a,b+d)});this.insert(b,d)};d.onremove=function(c,b,f){if(a)for(c=0;c<f;c++){var e=d.list[b+c];e?a(e,b+c):console.warn("No output object during forEach.onremove.",d,b,c)}this.remove(b,f)};return d};b.prototype.filter=function(c){var a=(new b).debugName("List.filter",
c),d=[0];a.oninsert=function(a,b,f){a=d[b];var e=[],q=a;f=f.filter(function(a){(a=c(a))&&q++;e.push(q);return a});Array.prototype.splice.apply(d,[b+1,0].concat(e));if(0<f.length){for(b=b+1+e.length;b<d.length;b++)d[b]+=f.length;this.insert(a,f)}};a.onremove=function(a,c,b){a=d.splice(c+1,b);a=a[a.length-1]-d[c];if(0<a)for(this.remove(d[c],a),c+=1;c<d.length;c++)d[c]-=a};a.is(this);return a};b.prototype.notNull=function(){return this.filter(function(c){return void 0!==c&&null!==c})};b.prototype.contains=
function(c){return e.not(e.eq(this.filter(c).length(),0))};b.prototype.reverse=function(){var c=(new b).debugName("List.reverse");c.oninsert=function(c,a,b){this.insert(this.list.length-a,b.slice().reverse())};c.onremove=function(a,c,b){this.remove(this.list.length-c-b,b)};c.is(this);return c};b.prototype.flat=function(c){this.__memoized=this.__memoized||{};if(this.__memoized.flat)return this.__memoized.flat;c=function(c){var a=(new l(c)).debugName("List.flat"),b=this,d=[],f=function(a){a.set(b.list.map(function(a){return a.get()}))};
a.onset=function(a,c){f(this)};a.oninsert=function(c,e,q){q.forEach(function(c){a.link(c,!0)});f(this);d=b.list.slice()};a.onremove=function(c,b,e){f(this);d.splice(b,e).forEach(function(c){a.unlinkOne(c)})};a.is(this);return a}.call(this,c);this.__memoized.flat=c;c.cleanup&&(c.__memoizeParent=this,c.__memoizeName="flat");return c};b.prototype.toList=function(a){this.__memoized=this.__memoized||{};if(this.__memoized.toList)return this.__memoized.toList;a=function(a){a=(new l(void 0,a)).debugName("List.toList");
var c=this,b=function(){this.set([].slice.apply(c.list))};a.oninsert=b;a.onremove=b;a.is(this);return a}.call(this,a);this.__memoized.toList=a;a.cleanup&&(a.__memoizeParent=this,a.__memoizeName="toList");return a};b.prototype.lift=function(a){var d=(new b).debugName("List.lift"),f=this,e=function(){this.clear();this.insert(0,a(f.list))};d.oninsert=e;d.onremove=e;d.is(this);return d};b.prototype.crush=function(a){var b=(new l).debugName("List.crush"),d=this,f=function(){this.set(a(d.list))};b.oninsert=
f;b.onremove=f;b.is(this);return b};b.prototype.append=function(a){var d=(new b).debugName("List.append"),f=this;d.oninsert=function(b,d,e){b===f?this.insert(d,e):b===a?this.insert(f.list.length+d,e):console.error("Unknown list sending to append",this,b)};d.onremove=function(b,d,e){b===f?this.remove(d,e):b===a?(b=-1<f.reactors.indexOf(this)?f.list.length:0,this.remove(b+d,e)):console.error("Unknown list sending to append",this,b)};d.is(f,!0);d.is(a,!0);return d};b.prototype.concat=function(){var a=
(new b).debugName("List.concat"),d=this,e=d.list.slice();a.oninsert=function(b,h,n){if(b===d)n.forEach(function(b){a.is(b,!0)}),e=d.list.slice();else{var g=d.list.indexOf(b);-1===g?console.error("Unknown sender in concat.",d,b):(b=f(g,d.list),this.insert(h+b,n))}};a.onremove=function(a,c,b){if(a===d)for(a=f(c,e),a=c;a<c+b;a++)this.unlinkOne(e[c]),e.splice(c,1);else{var h=e.indexOf(a);-1===h?console.error("Unknown sender in concat.",d,a):(a=f(h,e),this.remove(c+a,b))}};a.is(this);return a};b.prototype.take=
function(a){var d=this,f=(new b).debugName("List.take");f.oninsert=function(b,d,f){b=Math.min(a-d,f.length);var e=Math.min(b,f.length);e&&a-e<this.list.length&&this.remove(a-e,Math.min(e,this.list.length-a+e));b&&d<=this.list.length&&this.insert(d,f.slice(0,b))};f.onremove=function(b,f,e){(b=Math.min(a-f,e))&&f<this.list.length&&this.remove(f,b);b&&a-b<=this.list.length&&this.insert(a-b,d.list.slice(a-b,a))};f.is(this);return f};b.prototype.headL=function(){return this.take(1)};b.prototype.lastL=
function(){return this.reverse().take(1)};b.prototype.last=function(){var a=this,b=(new l).debugName("List.last");b.oninsert=function(b,f,e){f+e.length===a.list.length&&0<e.length&&this.set(d.last(e))};b.onremove=function(b,f,e){f+e>=a.list.length&&0<e&&(0<a.list.length?this.set(d.last(a.list)):this.set(void 0))};b.is(this);return b};b.prototype.head=function(){var a=this,b=(new l).debugName("List.head");b.oninsert=function(a,c,b){0===c&&0<b.length&&this.set(b[0])};b.onremove=function(b,d,f){0===
d&&0<f&&(0<a.list.length?this.set(a.list[0]):this.set(void 0))};b.is(this);return b};b.prototype.tail=function(){var a=this,d=(new b).debugName("List.tail");d.oninsert=function(b,d,f){0===d?(b=0,d=f.slice(1),a.list.length>f.length&&d.push(a.list[f.length])):(b=d-1,d=f);this.insert(b,d)};d.onremove=function(a,c,b){this.remove(0===c?0:c-1,0===c&&b>this.list.length?b-1:b)};d.is(this);return d};b.prototype.split=function(a){var f=(new b).debugName("List.split");f.oninsert=function(f,e,h){f=d.split(a,
h);h=0<this.list.length?null:-1;for(var q=0,n=0,g=0;g<this.list.length;g++){if(0===e&&0===g&&a(this.list[g].list[0])){h=-1;break}n+=this.list[g].list.length;if(e<=n){h=g;q=e-(n-this.list[g].list.length);break}}if(null===h)throw Error("Index out of bounds in split.insert.");-1<h?(this.list[h].list.length>q&&(f[f.length-1]=f[f.length-1].concat(this.list[h].list.slice(q)),this.list[h].remove(q,this.list[h].list.length-q)),0<f.length&&(!a(f[0][0])||0===q)&&(this.list[h].insert(q,f[0]),f.shift())):-1===
h&&0<this.list.length&&!a(this.list[0].list[0])&&(this.list[0].insert(0,f[f.length-1]),f.pop());this.insert(h+1,f.map(function(a){return(new b(a)).debugName("split.sublist")}))};f.onremove=function(a,c,b){var d,f,e,h=0;a=-1;for(var q=0;q<this.list.length;q++)if(h+=this.list[q].list.length,-1===a&&c<h&&(a=q,f=c-(h-this.list[q].list.length)),c+b<=h){d=q;e=c+b-(h-this.list[q].list.length);break}c=0===f&&(0<d||e===this.list[0].list.length);b=a===d&&c||d>a&&(0<a||!c||e===this.list[d].list.length);c||(h=
a===d?e-f:this.list[a].list.length-f,this.list[a].remove(f,h));var n;b&&e<this.list[d].list.length&&(n=this.list[d].list.slice(e,this.list[d].list.length));b||a===d||this.list[d].remove(0,e);e=a+(c?0:1);h=d-e+(b?1:0);0<h&&this.remove(e,h);n&&(c?this.list[a-1].insert(this.list[a-1].list.length,n):this.list[a].insert(f,n))};f.is(this);return f};b.prototype.breakAt=function(a){var d=(new b).debugName("List.breakAt.before"),f=(new b).debugName("List.breakAt.after"),e=[d,f],h=(new k).debugName("List.breakAt.coordinator");
h.oninsert=function(b,e,h){if(e>=a)f.insert(e-a,h);else{var n=a-e;b=h.slice(0,n);h=h.slice(n);d.insert(e,b);d.list.length>a&&(h=h.concat(d.list.slice(a)),d.remove(a,d.list.length-a));f.insert(0,h)}};h.onremove=function(b,e,h){if(e>=a)f.remove(e-a,h);else{b=Math.min(a-e,h);var n=Math.min(h-b,f.list.length);h=Math.min(h,f.list.length);var g=Math.min(b,f.list.length-n),n=f.list.slice(n,n+g);d.remove(e,b);d.insert(d.list.length,n);f.remove(0,h)}};h.is(this);return e};b.prototype.group=function(a){a||
(a=p.equals);var f=(new b).debugName("List.group");f.oninsert=function(f,e,h){f=d.group(h,a);h=0<this.list.length?null:-1;for(var q=0,n=0,g=0;g<this.list.length;g++){if(0===e&&0===g&&0<this.list[g].list.length&&!a(d.last(f)[0],this.list[g].list[0])){h=-1;break}n+=this.list[g].list.length;if(e<=n){h=g;q=e-(n-this.list[g].list.length);break}}if(null===h)throw"Index out of bounds in group.insert.";-1<h&&(this.list[h].list.length>q&&(e=d.last(f),a(this.list[h].list[q],e[0])?f[f.length-1]=e.concat(this.list[h].list.slice(q)):
f.push(this.list[h].list.slice(q)),0<q?this.list[h].remove(q,this.list[h].list.length-q):(this.remove(h,1),h--)),0<f.length&&this.list[h]&&0<this.list[h].list.length&&(a(this.list[h].list[0],f[0][0])||0===q)&&(this.list[h].insert(q,f[0]),q+=f[0].length,f.shift()));0<this.list.length&&this.list[h]&&this.list[h+1]&&this.list[h].list.length===q&&0<f.length&&a(d.last(f)[0],this.list[h+1].list[0])&&(this.list[h+1].insert(0,f[f.length-1]),f.pop());this.insert(h+1,f.map(function(a){return(new b(a)).debugName("group.sublist")}))};
f.onremove=function(d,f,e){var h,q,n,g=0;d=-1;for(var p=0;p<this.list.length;p++)if(g+=this.list[p].list.length,-1===d&&f<g&&(d=p,q=f-(g-this.list[p].list.length)),f+e<=g){h=p;n=f+e-(g-this.list[p].list.length);break}f=0===q&&(h>d||e===this.list[d].list.length);e=d===h&&f||h>d&&(0<d||!f||n===this.list[h].list.length);f||(g=d===h?n-q:this.list[d].list.length-q,this.list[d].remove(q,g));var l;e&&n<this.list[h].list.length&&(l=this.list[h].list.slice(n,this.list[h].list.length));e||d===h||this.list[h].remove(0,
n);n=d+(f?0:1);g=h-n+(e?1:0);0<g&&this.remove(n,g);n=f?d-1:d;d=this.list[n];l?(h=f?d.list.length:q,a(d.list[0],l[0])?d.insert(h,l):this.insert(n+1,[(new b(l)).debugName("split.sublist")])):(l=h-g+(e?1:0),(h=this.list[l])&&d&&a(h.list[0],d.list[0])&&(d.insert(d.list.length,h.list),this.remove(l,1)))};f.is(this);return f};b.prototype.sort=function(a){a||(a=p.compare);var d=(new b).debugName("List.sort"),f=[];d.oninsert=function(b,d,e){b=e.map(function(a,c){return{el:a,ix:c}}).sort(function(b,d){return a(b.el,
d.el)});for(var h=0,q=[];0<b.length;){for(;void 0!==this.list[h]&&0>a(this.list[h],b[0].el);)h++;e=1;if(void 0!==this.list[h])for(;void 0!==b[e]&&0<=a(this.list[h],b[e].el);)e++;else e=b.length;var n=b.splice(0,e);n.forEach(function(a,c){for(var b=0;b<f.length;b++)f[b]>=h+c&&f[b]++;q[a.ix]=h+c;n[c]=a.el});this.insert(h,n);h+=e+1}f.splice.apply(f,[d,0].concat(q))};d.onremove=function(a,c,b){for(a=f.splice(c,b).sort(function(a,c){return a<c?1:a==c?0:-1});0<a.length;){for(c=1;void 0!==a[c]&&1===a[c-
1]-a[c];)c++;this.remove(a[c-1],c);a.splice(0,c).forEach(function(a){for(var c=0;c<f.length;c++)f[c]>a&&f[c]--})}};d.is(this);return d};b.prototype.patch=function(a){var b=this.list.length;a.reverse().forEach(function(a){switch(a.action){case "keep":b--;break;case "remove":b-=a.count;this.remove(b,a.count);break;case "insert":this.insert(b,a.items);break;default:throw"Unknown action: "+a.action;}}.bind(this))};b.prototype.onchange=function(a){var b=new k;b.oninsert=a;b.onremove=a;b.link(this);return b};
b.prototype.unR=function(){return this.list.map(function(a){return a.unR?a.unR():a})};b.prototype.oninsert=function(){this.insert.apply(this,Array.prototype.slice.call(arguments,1))};b.prototype.onremove=function(){this.remove.apply(this,Array.prototype.slice.call(arguments,1))};return b}(m.Reactive);m.List=b})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=function(){function a(){var g;if(g=function(){this.values=k.slice(arguments)}.apply(g||this,arguments))return g}a.kill=function(a){a&&a.cleanup?a.cleanup():a instanceof Function&&a()};a.CleanupPool=a;a.prototype.cleanup=function(){this.values.forEach(a.kill);this.values=[]};a.prototype.earlyCleanup=function(g){g=this.values.indexOf(g);-1!=g&&(a.kill(this.values[g]),this.values[g]=void 0)};a.prototype.push=function(){var a=Array.prototype.slice.call(arguments,
0),a=k.notNull(a.reverse());a.forEach(function(a){a.persist&&a.persist()});return this.values.unshift.apply(this.values,a)};a.prototype.remove=function(a){k.remove(this.values,a)};return a}();m.CleanupPool=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Functions,l=function(){function a(){}a.keys=function(a){var b=[],e;for(e in a)a.hasOwnProperty(e)&&b.push(e);return b};a.values=function(a){var b=[],e;for(e in a)a.hasOwnProperty(e)&&b.push(a[e]);return b};a.keyValues=function(a){var b=[],e;for(e in a)a.hasOwnProperty(e)&&b.push([e,a[e]]);return b};a.flip=function(a){var b={},e;for(e in a)b[a[e]]=e;return b};a.filter=function(a,b){var e={},g;for(g in b)if(b.hasOwnProperty(g)){var h=b[g];a(h)&&(e[g]=h)}return e};
a.size=function(a){var b=0,e;for(e in a)a.hasOwnProperty(e)&&b++;return b};a.mapValues=function(a,b){var e={},g;for(g in a)e[g]=b(a[g],g);return e};a.mapKeys=function(a,b){var e={},g;for(g in a)e[b(g)]=a[g];return e};a.cloneObject=function(a,b){var e=b||{},g;for(g in a)e[g]=a[g];return e};a.deepClone=function(a,b){$.extend(!0,b||{},a)};a.pushToKey=function(a,b,e){a[b]?a[b].push(e):a[b]=[e]};a.deepEquals=function(){function a(b,c){return Object.prototype.toString.call(c)==="[object "+b+"]"}function b(b){if(a("String",
b))return"string";if(a("Boolean",b))return"boolean";if(a("Number",b))return isNaN(b)?"nan":"number";if("undefined"===typeof b)return"undefined";if(null===b)return"null";if(a("Array",b))return"array";if(a("Date",b))return"date";if(a("RegExp",b))return"regexp";if("object"===typeof b)return"object";if(a("Function",b))return"function"}var e,g=[],h=function(){function a(c,b){return c instanceof b.constructor||b instanceof c.constructor?b==c:b===c}return{string:a,"boolean":a,number:a,"null":a,undefined:a,
nan:function(a){return isNaN(a)},date:function(a,d){return"date"===b(a)&&d.valueOf()===a.valueOf()},regexp:function(a,d){return"regexp"===b(a)&&d.source===a.source&&d.global===a.global&&d.ignoreCase===a.ignoreCase&&d.multiline===a.multiline},"function":function(){var a=g[g.length-1];return a!==Object&&"undefined"!==typeof a},array:function(a,d){var f,h;if("array"!==b(a))return!1;h=d.length;if(h!==a.length)return!1;for(f=0;f<h;f++)if(!e(d[f],a[f]))return!1;return!0},object:function(a,b){var d,f=!0,
h=[],v=[];if(b.constructor!==a.constructor)return!1;g.push(b.constructor);for(d in b)h.push(d),e(b[d],a[d])||(f=!1);g.pop();for(d in a)v.push(d);return f&&e(h.sort(),v.sort())}}}();return e=function(){var a=Array.prototype.slice.apply(arguments);if(2>a.length)return!0;var c=a[0],d=a[1];c===d?c=!0:null===c||null===d||"undefined"===typeof c||"undefined"===typeof d||b(c)!==b(d)?c=!1:(d=[d,c],c=(c=b(c))?"function"===b(h[c])?h[c].apply(h,d):h[c]:void 0);return c&&arguments.callee.apply(this,a.splice(1,
a.length-1))}}();a.differ=function(a,b,e){e=e||[];for(var g in a)if(-1==e.indexOf(g)&&a[g]!==b[g])return!0;for(g in b)if(-1==e.indexOf(g)&&a[g]!==b[g])return!0;return!1};a.call=function(a){var b=Array.prototype.slice.call(arguments,1);return function(e){return e[a].apply(e,b)}};a.lookupIn=function(a){return function(b){return a[b]}};a.prop=function(){var a=Array.prototype.slice.call(arguments,0);return function(b){for(var e=0;e<a.length;e++)b=b&&b[a[e]];return b}};a.modProp=function(a,b){return function(e){e[a]=
b(e[a])}};a.setProp=function(a,b){return e(a,k.constant(b))};a.merge=function(a,b){var e={};g(a,e);g(b,e);return e};a.isType=function(a,b){return Object.prototype.toString.call(a)=="[object "+b+"]"};a.intersection=function(a,b){var e={},g;for(g in a)g in b&&(e[g]=a[g]);return e};a.mapToArray=function(a,b){var e=[],g;for(g in a)e.push(b(a[g],g));return e};var g=a.cloneObject,e=a.modProp;return a}();m.Objects=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Serializer,p=a.reactive.List,g=a.typlib.CleanupPool,e=a.typlib.DOMSerializer,d=a.typlib.Objects,b=function(){function a(b){var e;if(e=function(a){this.canvas=a;this.pool=new g(this.things=p.persistent("Clipboard.things",[],!0,d.deepEquals),this.activeThings=this.things.filter(function(a){return!a.evicted}),this.size=this.activeThings.length(),this.lastCut=this.activeThings.head(),this.wasLastCutPasted=this.lastCut.map(function(a){return a&&
a.pasted}));this.evictOldStuff()}.apply(e||this,arguments))return e}a.millisecondsToLive=864E5;a.numberOfItems=6;a.Clipboard=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.cut=function(b){var d=e.serializeToString(b.serializeToXML(new l),!0);b.node.remove();b.cleanup&&b.cleanup();for(this.things.unshift({serialized:d,timestamp:Date.now(),pasted:0,evicted:!1});this.things.list.length>a.numberOfItems;)this.things.pop()};a.prototype.evictOldStuff=function(){var b=Date.now();this.things.set(this.things.list.map(function(d){return $.extend({},
d,{evicted:b-d.timestamp>a.millisecondsToLive})}))};a.prototype.markAsPasted=function(a){this.things.replace(a,[$.extend({},this.things.list[a],{pasted:Date.now()})])};a.prototype.timeSinceLastCut=function(){var a=this.lastCut.get();return a?Date.now()-a.timestamp:Infinity};return a}();k.Clipboard=b})(m.editing||(m.editing={}))})(a.client||(a.client={}))})(_||(_={}));__extends=this.__extends||function(a,m){function k(){this.constructor=a}for(var l in m)m.hasOwnProperty(l)&&(a[l]=m[l]);k.prototype=m.prototype;a.prototype=new k};
(function(a){(function(m){var k=a.reactive.Value,l=a.reactive.Reactive,p=a.typlib.Objects,g=function(a){function d(b,d){var g;g=a.call(this,b,d);if(g=function(a,b){this.hashMap={};this.getMap={};this.def=b;a&&this.insert(a)}.apply(g||this,arguments))return g}__extends(d,a);d.HashMap=d;d.prototype.cleanup=function(){for(var a in p.merge(this.hashMap,this.getMap))this.get(a).unlink();this.unlink()};d.prototype.init=function(a){var d={},e;for(e in this.hashMap)d[e]=this.hashMap[e].get();this.dispatch("insert",
[d],a,!0)};d.prototype.dispatchCleanup=function(a){var d=[],e;for(e in this.hashMap)d.push(e);this.dispatch("remove",[d],a)};d.prototype.onchange=function(a){var d=new l;d.oninsert=a;d.onremove=a;d.link(this);return d};d.prototype.set=function(a,d){var e={};e[a]=d;this.insert(e)};d.prototype.unset=function(a){this.remove([a])};d.prototype.onset=function(a,d){a.__hashKey?void 0===d?this.remove([a.__hashKey]):this.set(a.__hashKey,d):console.error("Unknown sender in Reactive.HashMap.onset",a,this)};
d.prototype.get=function(a){if(a){if(!this.hashMap[a]&&!this.getMap[a]){var d=this.getMap[a]=(new k(this.def)).debugName("HashMap."+a);d.__hashKey=a;this.link(d,!0)}return this.hashMap[a]||this.getMap[a]}};d.prototype.clear=function(){var a=[],d;for(d in this.hashMap)a.push(d);a.length&&this.remove(a)};d.prototype.filter=function(a){function e(d){var f={},c;for(c in d)a(c)&&(f[c]=d[c]);return f}var g=(new d).debugName("HashMap.filter");g.oninsert=function(a,b){this.insert(e(b))};g.onremove=function(d,
f){this.remove(f.filter(a))};g.is(this);return g};d.prototype.flat=function(){this.__memoized=this.__memoized||{};if(this.__memoized.flat)return this.__memoized.flat;var a=function(){function a(){var f={},c;for(c in d)f[c]=d[c].get();b.set(f)}var b=(new k).debugName("Reactive.flat"),d=this.hashMap;b.oninsert=a;b.onremove=a;b.is(this);return b}.call(this);this.__memoized.flat=a;a.cleanup&&(a.__memoizeParent=this,a.__memoizeName="flat");return a};d.prototype.toString=function(){var a=["{ "],d=this.hashMap,
e;for(e in d)a.push(1==a.length?"":", "),a.push(e),a.push(": "),a.push(d[e].get());a.push(" }");return a.join("")};d.prototype.unR=function(){var a={},d=this.hashMap,e;for(e in d)a[e]=d[e].unR();return a};d.prototype.insert=function(a){if(!this.busy){var d;d=a;var e,h;e=!1;for(var f in d)e=this.hashMap[f],h=this.getMap[f],e?e.set(d[f]):h?(delete this.getMap[f],this.hashMap[f]=h,h.set(d[f])):(e=(new k(d[f])).debugName("HashMap."+f),e.__hashKey=f,void 0===d[f]?this.getMap[f]=e:this.hashMap[f]=e,this.link(e,
!0)),e=!0;d=e;!1!==d&&this.dispatch("insert",arguments);return d}};d.prototype.remove=function(a){if(!this.busy){var d;d=a;for(var e,h=0;h<d.length;h++)if(e=this.hashMap[d[h]])e.set(void 0),this.getMap[d[h]]=e,delete this.hashMap[d[h]];d=0!=d.length;!1!==d&&this.dispatch("remove",arguments);return d}};d.prototype.oninsert=function(){this.insert.apply(this,Array.prototype.slice.call(arguments,1))};d.prototype.onremove=function(){this.remove.apply(this,Array.prototype.slice.call(arguments,1))};return d}(m.Reactive);
m.HashMap=g})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.setup=function(){g(window);e(window)};a.fixDOMAttrModified=function(a){if("WebKit"===$.ua.engine.name){var b=a.document,e=!1,g=function(){e=!0};$(b.documentElement).bind("DOMAttrModified",g);b.documentElement.setAttribute("___TEST___",!0);b.documentElement.removeAttribute("___TEST___",!0);$(b.documentElement).unbind("DOMAttrModified",g);e||(p.DOMAttrModifiedUnsupported=!0,a.HTMLElement.prototype.__setAttribute=a.HTMLElement.prototype.setAttribute,
a.HTMLElement.prototype.setAttribute=function(e,f){var c=this.getAttribute(e);this.__setAttribute(e,f);f=this.getAttribute(e);if(f!=c){var q=b.createEvent("MutationEvent");q.initMutationEvent("DOMAttrModified",!0,!1,this,c||"",f||"",e,null==c?a.MutationEvent.ADDITION:a.MutationEvent.MODIFICATION);this.dispatchEvent(q)}},a.HTMLElement.prototype.__removeAttribute=a.HTMLElement.prototype.removeAttribute,a.HTMLElement.prototype.removeAttribute=function(e){var f=this.getAttribute(e);this.__removeAttribute(e);
var c=b.createEvent("MutationEvent");c.initMutationEvent("DOMAttrModified",!0,!1,this,f,"",e,a.MutationEvent.REMOVAL);this.dispatchEvent(c)})}};a.fixDOMSubtreeModified=function(a){if("Presto"===$.ua.engine.name){var b=a.document,e=!1;a=function(){e=!0};$(b.documentElement).bind("DOMSubtreeModified",a);b.documentElement.setAttribute("___TEST___",!0);b.documentElement.removeAttribute("___TEST___",!0);$(b.documentElement).unbind("DOMSubtreeModified",a);e||(a=function(a){var d=b.createEvent("MutationEvent");
d.initMutationEvent("DOMSubtreeModified",!0,!1,a.relatedNode,null,null,null,null);this.dispatchEvent(d)},$(b.documentElement).bind("DOMNodeInserted",a),$(b.documentElement).bind("DOMNodeRemoved",a),$(b.documentElement).bind("DOMCharacterDataModified",a),$(b.documentElement).bind("DOMAttrModified",a))}};a.DOMAttrModifiedUnsupported=!1;var p=a,g=a.fixDOMAttrModified,e=a.fixDOMSubtreeModified;return a}();a.MutationEvents=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.set=function(){for(var a={},e=0;e<arguments.length;e++)a[arguments[e]]=!0;return a};a.union=function(){return Array.prototype.reduce.call(arguments,p)};a.union_=function(a,e){var d={},b;for(b in a)d[b]=!0;for(b in e)d[b]=!0;return d};a.minus=function(a,e){var d={},b;for(b in a)d[b]=!0;for(b in e)delete d[b];return d};a.notIn=function(a){return function(e){return!(e in a)}};var p=a.union_;return a}();a.Set=k})(a.typlib||(a.typlib={}))})(_||
(_={}));(function(a){(function(m){var k=a.typlib.Set,l=a.typlib.Arrays,p=a.typlib.Objects,g=k.set,e=k.union,d=k.minus,b=k.notIn,n=a.typlib.Functions.not,k=function(){function a(){}a.init=function(){function a(c,b){var d=c.filter(n(b));return 0===d.length?null:d}h.phraseContainers=g("A","B","EM","H1","H2","H3","H4","H5","H6","I","P","CITE","SPAN","STRONG","SUB","SUP","TH","DT","U");h.emptyContainers=g("BR","HR","IMG","COLGROUP");h.openContainers=g("DIV","VIDEO","TD","DD","LI","BLOCKQUOTE","CAPTION");h.defContainers=
g("DL");h.liContainers=g("OL","UL");h.txContainers=g("TABLE");h.trContainers=g("THEAD","TBODY","TFOOT");h.tcContainers=g("TR");h.disallowedEls=g("SCRIPT");h.allKnown=e(h.phraseContainers,h.emptyContainers,h.openContainers,h.defContainers,h.liContainers,h.txContainers,h.trContainers,h.tcContainers);h.mustHaveAttrs=g("A","DIV","IMG","SPAN");h.allowEmpty=g("H1","H2","H3","H4","H5","H6","P","LI","TD","TH");h.badAttrs=g("style","_moz_abspos","_moz_dirty","class","id","width","height");h.headers=g("H1",
"H2","H3","H4","H5","H6");h.any=function(){return!0};h.checks={normalizeEmptyTextual:{pattern:h.allowEmpty,check:function(a,c){return 0==c.length?c:null},name:"Normalizing away empty textual elements"},noStrongInHeaders:{pattern:h.headers,check:function(a,c){var b=t("STRONG"),b=c.filter(b);return 0===b.length?null:b},name:"No redundant strong within headers"},phraseContent:{pattern:h.phraseContainers,check:function(c,b){return a(b,q)},name:"Only phrase content in phrase containers."},emptyContent:{pattern:h.emptyContainers,
check:function(a,c){return 0===c.length?null:c},name:"No content in empty containers."},definitions:{pattern:h.defContainers,check:function(c,b){return a(b,t("DT","DD"))},name:"Only DT and DD in DL."},listItems:{pattern:h.liContainers,check:function(c,b){return a(b,t("LI"))},name:"Only LI in UL/OL."},tables:{pattern:h.txContainers,check:function(c,b){return a(b,t("CAPTION","COLGROUP","THEAD","TBODY","TFOOT","TR"))},name:"Only CAPTION, COLGROUP, THEAD, TBODY, TFOOT, and TR in TABLE"},tableRows:{pattern:h.trContainers,
check:function(c,b){return a(b,t("TR"))},name:"Only TR in THEAD, TBODY, and TFOOT."},tableCells:{pattern:h.tcContainers,check:function(c,b){return a(b,t("TD","TH"))},name:"Only TD and TH in TR."},unrecognised:{pattern:b(h.allKnown),check:function(a,c){return[]},name:"No unrecognized elements."},nonEmpty:{pattern:b(e(h.allowEmpty,h.emptyContainers)),check:function(a,c){return s(a)?[]:null},name:"Content in nonempty elements."},mustHaveAttrs:{pattern:h.mustHaveAttrs,check:function(a,c){return 0===a.attributes.length?
[]:null},name:"Elements that must have attributes."},badAttrs:{pattern:h.any,check:function(a,c){var b=[],d;for(d in h.badAttrs)$(a).attr("contenteditable")||!a.hasAttribute(d)||"class"===d&&"Apple-style-span"===a.getAttribute("class")||b.push(a.attributes[d]);return 0===b.length?null:b},name:"Disallowed attributes."},disallowed:{pattern:h.disallowedEls,check:function(){return!1},name:"Disallowed elements."}}};a.checkElement=function(c){function b(a,c){return function(a,b){var d=0<b.length?p.isType(b[0],
"Attr")?"attribute":"childNode":"";x(c,a)&&console.warn("Integrity check '",c,"' failed on",a," ("+a.nodeName+")",(""===d?"":"which contains illegal ")+d+(2>b.length?"":"s"),0<b.length?b.map(function(a){return a.nodeName||a.toString()}):"")}}var d=[],e;for(e in a.checks){var h=a.checks[e];d.push([a.checks[e],b(h,h.name)])}f(d,c)};a.runChecks=function(a,b){return 0<$(b).closest("*[contenteditable=true]").length?c(a,b):!1};a._runChecks=function z(a,c){var b=!1;if(c.nodeType!==window.Node.ELEMENT_NODE)return b;
if(v(c))return!1;b=l.or(l.slice(c.childNodes).map(function(c){return z(a,c)}));if(c.parentNode&&"canvas"===c.parentNode.id||"canvas"===c.id||"virtualDocument"===c.id||"BODY"===c.nodeName||"HTML"===c.nodeName)return b;for(var d=0;d<a.length;d++){var e=a[d][0],f=a[d][1],h=e.pattern,q=c.nodeName;if("function"===typeof h?h(q):q in h)e=e.check(c,l.slice(c.childNodes)),null!==e&&0<e.length&&(e=e.filter(n(u)),e=0===e.length?null:e),null!==e&&(f(c,e),b=!0)}return b};a.isAllowedIn=function(a,c){var b=a.nodeName,
d=g("A","B","EM","H1","H2","H3","H4","H5","H6","I","P","SPAN","STRONG","SUB","SUP","TH","DT"),e=g("BR","HR","IMG"),f=g("DIV","VIDEO","TD","DD","LI"),h=g("DL"),n=g("OL","UL"),s=g("TABLE"),r=g("THEAD","TBODY","TFOOT"),u=g("TR");if(b in d)return q(c);if(b in e)return!1;if(b in f)return!0;if(b in h)return t("DT","DD")(c);if(b in n)return t("LI")(c);if(b in s)return t("THEAD","TBODY","TFOOT","TR")(c);if(b in r)return t("TR")(c);if(b in u)return t("TD","TH")(c);if(3==a.nodeType)return!1;console.warn("Encountered unrecognized node '"+
b+"'.")};a.isPhraseContent=function(a){var c=g("A","B","BR","EM","I","IMG","SPAN","STRONG","SUB","SUP","VIDEO","U");return 3==a.nodeType||1==a.nodeType&&a.nodeName in c};a.isEmpty=function B(a){switch(a.nodeType){case window.Node.TEXT_NODE:return u(a);case window.Node.ELEMENT_NODE:return"BR"===a.nodeName||l.all(B,l.slice(a.childNodes))&&b(d(e(h.allowEmpty,h.emptyContainers),g("BR")))(a.nodeName);default:return console.error("Unexpected element type in IntegrityCheck.isEmpty",a.nodeType),!1}};a.isInterElementWhitespace=
function(a){return a.nodeType!==window.Node.TEXT_NODE||1==a.parentNode.childNodes.length?!1:/^\s*$/.test(a.textContent)};a.isElementName=function(){Array.prototype.slice.call(arguments,0);var a=g.apply(this,arguments);return function(c){return c.nodeName in a}};a.isProtectedMarkup=function(a){return a.className&&a.className.match&&a.className.match(/\bsilk-markup\b/)};a.isFirstWarning=function(a,c){var b=!w(a,c);b&&y(a,c);return b};a.hasWarning=function(a,c){return c.__integrityCheckWarnings?-1!==
c.__integrityCheckWarnings.indexOf(a):!1};a.setWarning=function(a,c){c.__integrityCheckWarnings||(c.__integrityCheckWarnings=[]);c.__integrityCheckWarnings.push(a)};var h=a,f=a.runChecks,c=a._runChecks,q=a.isPhraseContent,s=a.isEmpty,u=a.isInterElementWhitespace,t=a.isElementName,v=a.isProtectedMarkup,x=a.isFirstWarning,w=a.hasWarning,y=a.setWarning;return a}();m.IntegrityCheck=k;k.init()})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Objects,l=function(){function a(){}a.fromRange=function(a){return{startContainer:a.startContainer,startOffset:a.startOffset,endContainer:a.endContainer,endOffset:a.endOffset,isData:!0}};a.toRange=function(a){if(a){var d=a.startContainer||a.endContainer;if(d)try{var b=d.ownerDocument.createRange();b.setStart(a.startContainer,a.startOffset);b.setEnd(a.endContainer,a.endOffset);return b}catch(n){return null}}};a.equals=function(a,d){if(!a||!d)return!1;a.isData||
(a=g(a));d.isData||(d=g(d));return!k.differ(a,d)};var g=a.fromRange;return a}();m.Range=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Range,l=function(){function a(){}a.get=function(){var a=window.getSelection();if(1===a.rangeCount)return k.fromRange(a.getRangeAt(0))};a.select=function(a){if(a){var e=this.get();k.equals(a,e)||(e=window.getSelection(),e.removeAllRanges(),a.startContainer&&a.endContainer&&(a=k.toRange(a))&&e.addRange(a),this.dispatchSelectionChange())}};a.replaceNode=function(a,e,d){if(a)return a.startContainer===e&&(a.startContainer=d),a.endContainer===e&&(a.endContainer=
d),a};a.selectNode=function(a,e,d){a&&("img"==a.nodeName.toLowerCase()&&"WebKit"===$.ua.engine.name?(d=$(a.parentNode.childNodes).get().indexOf(a),a=a.parentNode,e=d,d+=1):(e=e||0,d=d||e),this.select({startContainer:a,startOffset:e,endContainer:a,endOffset:d}))};a.selectNodeContents=function(a){a&&a.nodeType&&this.selectNode(a,0,3==a.nodeType?a.textContent.length:a.childNodes.length)};a.selectNodeStart=function(a){for(;a&&a.nodeType==window.Node.ELEMENT_NODE&&a.childNodes[0]&&"br"!==a.childNodes[0].nodeName.toLowerCase();)a=
a.childNodes[0];a&&a.nodeType&&this.selectNode(a,0,0)};a.selectNodeEnd=function(a){for(;a&&a.nodeType==window.Node.ELEMENT_NODE&&a.lastChild&&"br"!==a.lastChild.nodeName.toLowerCase();)a=a.lastChild;if(a&&a.nodeType){var e=3==a.nodeType?a.textContent.length:a.childNodes.length;this.selectNode(a,e,e)}};a.updateSelection=function(a){this.dispatchSelectionChange(a)};a.dispatchSelectionChange=function(a){var e=window.document.createEvent("CustomEvent");e.initCustomEvent("silk-selectionchange",!0,!1,null);
e.selection=window.getSelection();a&&(e.isMutation=!0);(window.getSelection().anchorNode||window.document.documentElement).dispatchEvent(e)};a.selectCanvas=function(){$("#canvas")[0].focus()};return a}();m.SelectionManager=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=a.typlib.SelectionManager,p=a.typlib.IntegrityCheck.isAllowedIn,g=function(){function a(){}a.setup=function(){y();f();m()};a.scrollIntoView=function(a){var c=!1;if(a){var b=a.parentNode,d=a.offsetTop-(a.offsetParent==b?0:b.offsetTop);d<b.scrollTop?(b.scrollTop=d,c=!0):d+a.offsetHeight>b.offsetHeight+b.scrollTop&&(b.scrollTop=d+a.offsetHeight-b.offsetHeight,c=!0)}return c};a.fixMouseWheelPropagation=function(a){a.__fixMouseWheelPropagationHandler=function(c){(0==
a.scrollTop&&0<c.wheelDelta||a.scrollTop==a.scrollHeight-a.offsetHeight&&0>c.wheelDelta)&&c.preventDefault();c.stopPropagation()};$(a).mousewheel(a.__fixMouseWheelPropagationHandler)};a.unfixMouseWheelPropagation=function(a){$(a).unmousewheel(a.__fixMouseWheelPropagationHandler);delete a.__fixMouseWheelPropagationHandler};a.replaceElement=function(a,c){for(var b=l.get(),d=a.attributes.length-1;0<=d;d--)c.setAttribute(a.attributes[d].nodeName,a.attributes[d].nodeValue);for(;a.firstChild;)c.appendChild(a.firstChild);
a.parentNode.replaceChild(c,a);b=l.replaceNode(b,a,c);l.select(b)};a.removeElement=function(a){a.parentNode.removeChild(a)};a.createLinkedStyleSheet=function(a,c){var b=(c||document).createElement("link");b.setAttribute("type","text/css");b.setAttribute("rel","stylesheet");b.setAttribute("href",a);b.setAttribute("href",""+b.href);return b};a.insertLinkedStyleSheet=function(a,c){var f=d(a,c);b(f,c);return f};a.insertScript=function(a,c){var d=c.createElement("script");d.src=a;b(d,c);return d};a.insertBase=
function(a,c,d){var f=d.createElement("base");a&&f.setAttribute("href",a);c&&f.setAttribute("target",c);b(f,d);return f};a.appendElementToHead=function(a,c){c.getElementsByTagName("head")[0].appendChild(a)};a.XMLElement2HTMLElement=function B(a,c){for(var b=c.createElement(a.nodeName),d=0;d<a.attributes.length;d++)b.setAttribute(a.attributes.item(d).name,a.attributes.item(d).value);for(d=0;d<a.childNodes.length;d++)switch(a.childNodes[d].nodeType){case 1:b.appendChild(B(a.childNodes[d],c));break;
case 3:b.appendChild(c.createTextNode(a.childNodes[d].nodeValue))}return b};a.adoptChildren=function(a,c){if(a.ownerDocument===c)return a;if("Trident"===$.ua.engine.name)return n(a,c);var b=c.adoptNode(a),d=c.createElement(a.nodeName);for(h(a,d);b.firstChild;)d.appendChild(b.firstChild);for(var b=d.querySelectorAll(":empty"),f,e,q=0;q<b.length;q++)f=b.item(q),e=c.createElement(f.nodeName),h(f,e),f.parentNode.replaceChild(e,f);d.innerHTML=d.innerHTML;return d};a.cloneElementAttributes=function(a,c){for(var b=
a.attributes,d=0;d<b.length;d++)c.__reactive?c.__reactive.attributes.set(b.item(d).nodeName,b.item(d).nodeValue):c.setAttribute(b.item(d).nodeName,b.item(d).nodeValue)};a.insertBlockElement=function(a,c){function b(){h=u(e)+(0===h?0:1);e=e.parentNode}var d=window.document.createElement(c),f=a.context.get().selectedDocumentRange();a.context.get().restoreInactiveSelection();f.collapsed||window.document.execCommand("delete",!1,null);var e=f.endContainer,h=f.endOffset,q;e.nodeType===window.Node.TEXT_NODE&&
(0<h&&h<e.textContent.length&&(q=e.textContent.substring(h),q=window.document.createTextNode(q),e.textContent=e.textContent.substring(0,h)),b());for(f=a.document.get().root;e!==f&&!p(e,d);){if(q||0<h&&h<e.childNodes.length){for(var n=window.document.createElement(e.nodeName),g=e.attributes,s=0;s<g.length;s++)"id"!==g[s].name.toLowerCase()&&n.setAttribute(g[s].name,g[s].value);for(q&&n.appendChild(q);e.childNodes[h];)n.appendChild(e.childNodes[h]);q=n}b()}f=e.childNodes[h];e.insertBefore(d,f);q&&e.insertBefore(q,
f);return d};a.ensureNewLineAtEndOfDocument=function(a){for(var c=!1,b=a.lastChild;b;)if(v(b)&&"TABLE"!=b.nodeName)b=b.lastChild;else{c=!0;break}c&&(c=a.ownerDocument.createElement("p"),c.appendChild(a.ownerDocument.createElement("br")),a.appendChild(c))};a.removeChildNodes=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};a.flashClassName=function(c,b,d){var f=a.getUniqueID(c)+"_"+b,h=RegExp(" "+b,"g");c.className=c.className.replace(h,"")+" "+b;a.__flashTOHs[f]&&window.clearTimeout(a.__flashTOHs[f]);
a.__flashTOHs[f]=window.setTimeout(function(){c.className=c.className.replace(h,"");a.__flashTOHs[f]=null}.bind(this),d)};a.getUniqueID=function(c){return c._uniqueID=c._uniqueID||c.id||"uid_"+c.nodeName+"_"+a.__uniqueID__++};a.overrideNodeToString=function(){if("undefined"!=typeof Node){var c=Node.prototype.toString;Node.prototype.toString=function(){return c()+"-"+a.getUniqueID(this)}}};a.getCommonAncestor=function(a,c){if(s(a,c))return a;do if(s(c,a))return c;while(c=c.parentNode);return null};
a.getFollowingNode=function(a){var c;if(!(c=a.firstChild)&&!(c=a.nextSibling)){a:{a=a.parentNode;do if(a.nextSibling){a=a.nextSibling;break a}while(a=a.parentNode);a=null}c=a||null}return c};a.comparePosition=function(a,c){return a&&c?a.compareDocumentPosition?a.compareDocumentPosition(c):a.contains?(a!=c&&a.contains(c)&&16)+(a!=c&&c.contains(a)&&8)+(0<=a.sourceIndex&&0<=c.sourceIndex?(a.sourceIndex<c.sourceIndex&&4)+(a.sourceIndex>c.sourceIndex&&2):1)+0:0:(console.warn("Undefined argument in comparePosition:",
a,c),1)};a.isAncestor=function(a,b){if(!a||!b)return console.error("invalid input for Html.isAncestor: aEl:",a,"dEl:",b),!1;9==a.nodeType&&(a=a.documentElement);9==b.nodeType&&(b=b.documentElement);return!!(c(a,b)&16)};a.isAncestorOrSelf=function(a,c){return(a||c)&&a===c||q(a,c)};a.isFollowing=function(a,b){return!!(c(a,b)&2)};a.getNodeOffset=function(a){for(var c=0;a=a.previousSibling;)c++;return c};a.outerHTML=function D(a){switch(a.nodeType){case 1:var c=a.ownerDocument.createElement("div");c.appendChild(a.cloneNode(!0));
return c.innerHTML;case 2:return"@"+a.nodeName+"="+a.nodeValue;case 3:return"[text]"+a.textContent+"[/text]";case window.Node.DOCUMENT_FRAGMENT_NODE:return"[fragment]"+k.concat(k.map(a.childNodes,D))+"[/fragment]"}};a.escapeHtml=function(a){var c=document.createElement("div");c.textContent=a;return c.innerHTML};a.showHTML=function(c){var b=c.ownerDocument.createElement("div");b.appendChild(c.cloneNode(!0));c=$("*",b);for(var d=0;d<c.length;d++){var f=c[d];switch(f.nodeType){case 1:f.setAttribute("id",
a.getUniqueID(f));for(var h=0;h<f.childNodes.length;h++){var q=f.childNodes[h];3==q.nodeType&&(q.nodeValue='[#text id="'+a.getUniqueID(q)+'"]'+q.nodeValue+"[#text]")}}}return b.innerHTML};a.querySelectorAllAOS=function(a,c){for(var b=[],d=a.ownerDocument.querySelectorAll(c),f=d.length-1;0<=f;f--)(d[f]==a||s(d[f],a))&&b.push(d[f]);return b};a.querySelectorAOS=function(a,c){return t(a,c)[0]||null};a.isContentEditable=function(a){3==a.nodeType&&(a=a.parentNode);for(var c;a;){if((c=a.contentEditable)&&
"inherit"!=c.toLowerCase())return"true"===a.contentEditable.toLowerCase();a=a.parentNode}return!1};a.getDisabled=function(a){for(;9!=a.nodeType;){if(a.getAttribute("disabled"))return"true"===a.getAttribute("disabled").toLowerCase();a=a.parentNode}return!1};a.getClassList=function(a){function c(a){this._element=a;this._clss=null;this._refresh()}function b(){function a(c){if(""==c)throw Error("SYNTAX_ERR");if(-1!=c.indexOf(/\s/))throw Error("INVALID_CHARACTER_ERR");return c}this._refresh=function(){var a=
this._element.getAttribute("class")||"";if(this._clss==a)return this;this._clss=a;for(var a=a.replace(/(^\s+|\s+$)/g,"").split(/\s+/),c=a.length;c<this.length;++c)delete this[c];this.length=a.length;if(0==this.length)return this;for(c=0;c<this.length;++c)this[c]=a[c];return this};this.item=function(a){return this[a]||null};this.contains=function(c){a(c);this._refresh();for(var b=0;b<this.length;++b)if(this[b]==c)return!0;return!1};this.set=function(a){this._element.setAttribute("class",a);this._clss=
void 0};this.add=function(){this._refresh();for(var c=0;c<arguments.length;c++){for(var b=a(arguments[c]),d=this.length-1;0<=d&&this[d]!=b;d--);-1==d&&this.push(b)}this._element.setAttribute("class",this.join(" "));this._clss=this._element.getAttribute("class");return this};this.remove=function(){this._refresh();for(var c=0;c<arguments.length;c++)for(var b=a(arguments[c]),d=this.length-1;0<=d;d--)this[d]==b&&this.splice(d,1);this._element.setAttribute("class",this.join(" "));this._clss=this._element.getAttribute("class");
return this};this.toggle=function(c,b){if(!0===b)return this.add(c);if(!1===b)return this.remove(c);a(c);this._refresh();for(var d=!1,f=this.length-1;0<=f;f--)this[f]==c&&(this.splice(f,1),d=!0);d||this.add(c);return this};this.setReplace=function(a,c,b){return b?this.replace(a,c):this.replace(c,a)};this.replace=function(){this._refresh();for(var c=0;c<arguments.length-1;c++)for(var b=a(arguments[c]),d=this.length-1;0<=d;d--)this[d]==b&&this.splice(d,1);return this.add(arguments[arguments.length-
1])}}b.prototype=[];c.prototype=new b;return new c(a)};a.removeClasses=function(a,c){var b=x(a);b.remove.apply(b,c)};a.noop=function(){};a.createConsole=function(){var a=!window.SILK_DEBUGGING;"undefined"==typeof window.console&&(a=!0);a&&(window.console={assert:w,clear:w,count:w,debug:w,dir:w,dirxml:w,error:w,group:w,groupCollapsed:w,groupEnd:w,info:w,log:w,msIsIndependentlyComposed:w,profile:w,profileEnd:w,select:w,time:w,timeEnd:w,trace:w,warn:w})};a.setupFixPlaceholders=function(){void 0===document.createElement("input").placeholder&&
(a.fixPlaceholders(document.documentElement),$(document.documentElement).bind("DOMNodeInserted",function(c){a.fixPlaceholders(c.target)}))};a.getInputValue=function(a){var c=a.value;c==a.getAttribute("placeholder")&&a._classList&&a._classList.contains("showingPlaceholder")&&(c="");return c};a.setInputValue=function(a,c){a.value=c;a.setAttribute("value",c);a.setPlaceholder&&a.setPlaceholder()};a.isDetached=function(a){return!(a.ownerDocument&&q(a.ownerDocument,a))};a.firstTextNode=function F(a){if(a.nodeType===
window.Node.TEXT_NODE)return a;a=a.firstChild;for(var c=null;a&&!c;)c=F(a),a=a.nextSibling;return c};a.fixPlaceholders=function(c){$("input[placeholder]",c).each(function(c,b){b.getAttribute("__placeholderFixed")||a.fixPlaceholder(b)})};a.fixPlaceholder=function(c){c._classList=a.getClassList(c);c.setAttribute("__placeholderFixed",!0);var b=function(){c.__focused||c.value&&!c._classList.contains("showingPlaceholder")||(c._classList.add("showingPlaceholder"),c.value=c.getAttribute("placeholder"))};
c.setPlaceholder=b;$(c).focus(function(){c.__focused=!0;c._classList.remove("showingPlaceholder");c.value==c.getAttribute("placeholder")&&(c.value="")});$(c).blur(function(){c.__focused=!1;b()});$(c).bind("DOMAttrModified",function(a){"placeholder"==a.attrName&&c._classList.contains("showingPlaceholder")&&b()});$(c).bind("DOMAttrModified",function(a){"value"==a.attrName&&!c.value&&c._classList.contains("showingPlaceholder")&&b()});b()};a.ensureHtml=function(a){return(a=$(a)[0])?$(g(a.documentElement||
a,document)):null};a.submitAsForm=function(a,c){var b=document.createElement("form");b.setAttribute("method","POST");b.setAttribute("action",a);for(var d in c)if(c.hasOwnProperty(d)){var f=document.createElement("input"),e=void 0===c[d]||null===c[d]?"":c[d];f.setAttribute("type","hidden");f.setAttribute("name",d);f.setAttribute("value",e);b.appendChild(f)}window.document.body.appendChild(b);b.submit()};a.__flashTOHs={};a.__uniqueID__=1;var d=a.createLinkedStyleSheet,b=a.appendElementToHead,n=a.XMLElement2HTMLElement,
g=a.adoptChildren,h=a.cloneElementAttributes,f=a.overrideNodeToString,c=a.comparePosition,q=a.isAncestor,s=a.isAncestorOrSelf,u=a.getNodeOffset,t=a.querySelectorAllAOS,v=a.isContentEditable,x=a.getClassList,w=a.noop,y=a.createConsole,m=a.setupFixPlaceholders;return a}();m.Html=g})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.HashMap,l=a.reactive.Reactive,p=a.reactive.Value,g=a.reactive.List,e=a.typlib.Arrays,d=a.typlib.CleanupPool,b=a.typlib.Html,n=a.typlib.Memoize,r=a.typlib.Objects,h=p.value,f=function(){function a(c,b,f){var e;if(e=function(a,c,b){var f,e;a&&a.nodeName?f=a:e=a;f&&f.parentNode&&(this.parentNode=f.parentNode.__reactive);if(f){if(a=f.__reactive)return c&&!a.nonReactiveChildren&&(a.setupChildren(!0),a.setupText(),a.setupAttributes()),a;this.node=f;this.node.__reactive=
this}this.reactiveNode=this.reactive=!0;this.nonReactiveChildren=b;this.setupNodeName();this.setupNodeType(e);this.setupText();this.setupAttributes();this.setupChildren(c);this.events={};this.attachedEvents={};this.fns=[];this.unfns=[];this.pool=new d}.apply(e||this,arguments))return e}a.node=function(b){if(b instanceof a)return b;b="string"===typeof b?$("#"+b)[0]:b;return new a(b)};a.Element=function(b,d,f){var e=new a(window.Node.ELEMENT_NODE,void 0,f);e.nodeName=b;d&&!f&&e.setChildren(d);return e};
a.Text=function(b){var d=new a(window.Node.TEXT_NODE);d.setText(h(b));return d};a.connectNodeLists=function(a,c,b){c.is(a.map(function(a){return a.clone(b)}))};a.toStaticNodes=function(b,d){var f=(d||document).createElement("div"),e=new a(f);a.connectNodeLists(b,e.childNodes,d);for(var e=[],h=0;h<f.childNodes.length;h++)e.push(f.childNodes[h].cloneNode(!0));return e};a.reactiveContent=function(b,d){s(new g([a.Text(d)]),f(b).childNodes)};a.getNodeOffsetReactive=function(a,c){var b=c?c.__reactive:u(a).__reactive;
return b?b.getShadowChildNodes().indexOf(a):-1};a.shadowParentNode=function(a){if(a.__reactive&&a.__reactive.parentNode)return a.__reactive.parentNode.node};a.isShadowAncestor=function(a,c){for(var b=c;b;){if(b==a)return!0;b=u(b)}return!1};a.setCleanupDisabled=function(a,c){a.__reactive.disableCleanup=c};a.isCleanupDisabled=function(a){return a.__reactive&&a.__reactive.disableCleanup};a.cloneReactiveNode=function w(a){var c=a.__reactive;if(!c)return a.cloneNode(!0);var b=a.cloneNode(!1);a.nodeType===
window.Node.TEXT_NODE&&(b.textContent=c.textContent.get());if(c.attributes){a=a.attributes.hashMap;for(var d in a)b.setAttribute(d,a[d])}c.getShadowChildNodes().forEach(function(a){b.appendChild(w(a))});return b};a.setAttributesName=function(){};var f=a.node,s=a.connectNodeLists,u=a.shadowParentNode,t=a.isCleanupDisabled,v=a.setAttributesName;a.Node=a;a.prototype.cleanup=function(a){if(!this.node||a||b.isDetached(this.node))if(!this.node||!t(this.node)){n.cleanupMemoizedReactiveProperties(this);this.disableSyncToDOM=
!0;this.pool.cleanup();switch(this.nodeType){case window.Node.ELEMENT_NODE:this.cleanupChildren(a);this.cleanupAttributes();if(this.node&&this.attachedEvents){for(var c in this.attachedEvents)$(this.node).unbind(c,this.attachedEvents[c]);for(a=0;a<this.unfns.length;a++)this.unfns[a](this.node)}break;case window.Node.TEXT_NODE:this.cleanupText();break;case window.Node.COMMENT_NODE:break;default:console.error("No node.cleanup() implemented for non-text/non-element nodes.")}this.node&&(this.node=this.node.__reactive=
void 0);delete this.__parentNode}};a.prototype.setupNodeName=function(){this.nodeName=this.node?this.node.nodeName:"#text"};a.prototype.setupNodeType=function(a){this.nodeType=this.node?this.node.nodeType:a||window.Node.TEXT_NODE};a.prototype.setupText=function(){this.nodeType==window.Node.TEXT_NODE&&(this.textContent||this.setText(new p(this.node?this.node.textContent:"")))};a.prototype.setText=function(a){this.cleanupText();this.textContent=a.name("RNode.textContent");this.textContent.parentNode=
this;if(this.node){this.node.__textContent=a;var c=this;a.onchange(function(a){c.initiatedByMe||c.disableSyncToDOM||(c.node.textContent=a)},!0)}};a.prototype.cleanupText=function(){this.textContent&&(this.textContent.unlink(),this.node&&(this.node.__textContent=void 0))};a.prototype.setupChildren=function(b){if(this.nodeType==window.Node.ELEMENT_NODE){var d=!this.childNodes||0===this.childNodes.list.length&&0<this.node.childNodes.length||0==this.childNodes.linkedTo.length&&!e.equals(this.node.childNodes,
this.getShadowChildNodes());d&&this.childNodes&&0<this.childNodes.linkedTo.length&&console.warn("Repairing children for node: %o, but children are linked to: %o",this.node,this.childNodes.linkedTo);var f=this,h=function(a){return"recursive"!==b||!a.parentNode||!a.parentNode.node||a.parentNode.node===f.node},q=this.node?e.slice(this.node.childNodes).filter(h).map(function(d){return new a(d,b)}):[];b&&q.filter(h).forEach(function(a){a.parentNode=f});d&&(this.childNodes?(this.disableSyncToDOM=!0,this.childNodes.set(q),
this.disableSyncToDOM=!1):this.setChildren(new g(q)))}};a.prototype.setChildren=function(a){this.childNodes=a.name("RNode.childNodes");a.parentNode=this;if(this.node){this.node.__childNodes=a;var c=this;a.forEach(function(a,b){if(!c.disableSyncToDOM)return a.node.insertedIn!=c.node&&(a.parentNode=c,a.node.reactiveOffset=b,c.node.insertBefore(a.node,c.node.childNodes[b]||null)),a},function(a,b){if(!c.disableSyncToDOM&&c.node.removedOffset!=b){var d=a.node;a.cleanup(!0);-1<e.indexOf(c.node.childNodes,
d)&&(d.reactiveOffset=b,c.node.removeChild(d))}}).debugName("syncChildnodesToDOM")}};a.prototype.cleanupChildren=function(a){if(this.childNodes){var c=this;this.childNodes.list.forEach(function(b){b.__rParentNode&&b.__rParentNode!==c||b.cleanup(a)});this.childNodes.unlink();this.node&&(this.node.__childNodes=void 0)}};a.prototype.setupAttributes=function(){if(this.nodeType==window.Node.ELEMENT_NODE){var a=!this.attributes||0===r.keys(r.merge(this.attributes.hashMap,this.attributes.getMap)).length&&
0<this.node.attributes.length;a&&this.attributes&&0<this.attributes.linkedTo.length&&console.warn("Repairing attributes for node: %o, but attributes are linked to: %o",this.node,this.attributes.linkedTo);a&&this.setAttributes(new k)}};a.prototype.setAttributes=function(a){this.cleanupAttributes();this.attributes=a.name("RNode.attributes");if(this.node){v(a,this.node);for(var c=this.node.attributes,b={},d=0;d<c.length;d++)b[c[d].name]=c[d].value;a.insert(b);var f=this,e=function(c){var b=a.get(c);
b.hasAttrChange||(b.onchange(function(a){void 0!==a&&f.node.setAttribute(c,a)}),b.hasAttrChange=!0)},c=(new l).debugName("syncAttributesToDOM");c.oninsert=function(a,c){if(!f.disableSyncToDOM)for(var b in c)e(b)};c.onremove=function(a,c){f.node.__removedByReactive=c;if(!f.disableSyncToDOM)for(d=0;d<c.length;d++)f.node.removeAttribute(c[d])};c.link(a)}};a.prototype.cleanupAttributes=function(){this.attributes&&this.attributes.cleanup()};a.prototype.classes=function(){this.__memoized=this.__memoized||
{};if(this.__memoized.classes)return this.__memoized.classes;var a=function(){if(this.nodeType==window.Node.ELEMENT_NODE){var a=this.attributes.get("class").get(),a=a?a.split(" "):[],a=(new g(a.map(function(a){return new p(a)}))).debugName("Node.classes"),c=a.flat().mapValue(function(a){a=e.unique(a).join(" ");a=/^ *$/.test(a)?void 0:a;return a});this.attributes.get("class").is(c);return a}}.call(this);this.__memoized.classes=a;a.cleanup&&(a.__memoizeParent=this,a.__memoizeName="classes");return a};
a.prototype.setupInnerHTML=function(){if(this.node&&this.nodeType==window.Node.ELEMENT_NODE){var a=(new p(this.node.innerHTML)).name("RNode.innerHTML"),c=this;a.onchange(function(a){c.initiatedByMe||(c.node.innerHTML=a)},!0);$(this.node).subtreemodified(function(){c.initiatedByMe=!0;a.set(c.node.innerHTML);c.initiatedByMe=!1});this.innerHTML=a}};a.prototype.addEventListener=function(a,c){this.events[a]=c};a.prototype.addNodeHandler=function(a,c){this.fns.push(a);c&&this.unfns.push(c)};a.prototype.dup=
function(){var b=new a;b.nodeName=this.nodeName;b.nodeType=this.nodeType;b.textContent=this.textContent;b.attributes=this.attributes;b.childNodes=this.childNodes;b.events=this.events;b.fns=this.fns;return b};a.prototype.dupWithNodeName=function(a){var c=this.dup();c.nodeName=a;return c};a.prototype.dupWithAttributes=function(a){var c=this.dup();c.attributes=new k(a);return c};a.prototype.clone=function(b){var d=b||document;switch(this.nodeType){case window.Node.ELEMENT_NODE:d=new a(d.createElement(this.nodeName),
void 0,this.nonReactiveChildren);d.attachedEvents=r.cloneObject(this.events);for(var f in this.events)$(d.node).bind(f,this.events[f]);d.unfns=this.unfns;this.childNodes&&a.connectNodeLists(this.childNodes,d.childNodes,b);d.attributes.is(this.attributes);for(b=0;b<this.fns.length;b++)this.fns[b](d.node);return d;case window.Node.TEXT_NODE:return d=new a(d.createTextNode("")),d.textContent.is(this.textContent),d;default:console.error("reactive.Node.clone(), unsupported nodeType:"+this.nodeType)}};
a.prototype.getShadowChildNodes=function(){return this.childNodes?this.childNodes.list.map(r.prop("node")):[]};a.prototype.getShadowAttributes=function(){return this.attributes?r.mapValues(this.attributes.hashMap,function(a){return""+a.get()}):{}};a.prototype.getShadowParents=function(){if(!this.parentNode)return[];var a=this.parentNode.getShadowParents();this.parentNode.node?a.unshift(this.parentNode.node):console.warn("reactive.Node.getShadowParents","undefined shadow node, probably the result of some bug");
return a};a.prototype.nodeName=void 0;a.prototype.nodeType=void 0;a.prototype.childNodes=void 0;a.prototype.attributes=void 0;a.prototype.innerHTML=void 0;a.prototype.textContent=void 0;a.prototype.disableSyncToDOM=!1;a.prototype.initiatedByMe=!1;a.prototype.cleanupDisabled=!1;a.prototype.__parentNode=void 0;a.prototype.__rParentNode=void 0;return a}();m.Node=f})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Node,p=function(){function a(e,d){var b;this.tag=this.tag.bind(this);if(b=function(a,b){this.category=l.node(a).attributes.get("data-tag-context");this.tagList=b;this.asTag=this.category.bind(this.tag).name("CategoryTracking.asTag")}.apply(b||this,arguments))return b}a.CategoryTracking=a;a.prototype.tag=function(a){return a&&this.tagList.findByUriR(a,!0)};a.prototype.cleanup=function(){this.asTag.unlink()};return a}();k.CategoryTracking=p})(m.model||
(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(){}a.get=function(a){if(!g[a])throw Error("No component named "+a+" in URI map");return g[a]};a.TextWidget="//silk.co/widget/text/1";a.SimpleBlock="//silk.co/block/simple/1";a.EmbedBlock="//silk.co/block/embed/1";a.Pinned="//silk.co/block/pinned/1";a.FigureBlock="//silk.co/block/figure/1";a.Image="//silk.co/widget/image/1";a.Video="//silk.co/widget/video/1";a.Gist="//silk.co/widget/gist/1";a.KeyValue="//silk.co/widget/keyvalue/1";
a.Front="//silk.co/widget/front/1";a.QueryViewer="//silk.co/widget/queryviewer/1";a.RecentDocuments="//silk.co/widget/recent-documents/1";a.TagPreview="//silk.co/widget/tag-preview/1";a.TagCounter="//silk.co/widget/tag-counter/1";a.CollectionOverview="//silk.co/widget/collection-overview/1";a.TagOverview="//silk.co/widget/tag-overview/1";a.SiteInfo="//silk.co/widget/site-info/1";a.Toc="//silk.co/widget/toc/1";a.UrlPreview="//silk.co/widget/url-preview/1";a.Upload="//silk.co/widget/upload/1";a.TwitterTimeline=
"//silk.co/widget/twitter-timeline/1";var g=a;return a}();a.ComponentURIs=l})(a.component||(a.component={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){var k=function(){return function(){}}();a.Undoable=k})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.component.ComponentURIs,p=a.reactive.List,g=a.reactive.Value,e=function(){function a(){}a.create=function(a,d,e){if(e=b(a,e))return new a(e,d.document,d.canvas)};a.createNode=function(a,b,d){var f=$("<div/>").attr("data-component-uri",a.uri);return a.configureNode?a.configureNode(f,b,d):f};a.ignore=function(a){a.serializeToXML=function(){return window.document.createTextNode("")};a.affectsDirtyState=function(){return!1}};a.ignoreContents=function(a){a.serializeToXML=
function(){return $(a.node)[0].cloneNode(!1)};a.affectsDirtyState=function(b){return b.target===$(a.node)[0]}};a.dummy=function(){return{getComponentInfo:function(){return{uncuttable:!0,unpinnable:!0}}}};a.linkToNode=function(a,b,d){a.node=$(b);b=$(b)[0];b.component?b.component.set(a):b.component=new g(a);d&&a.node.rAddClass(d)};a.remove=function(a){window.Silk.canvas.document.get().undoManager.startAction("remove");a.node.remove();a.cleanup&&a.cleanup();window.Silk.canvas.document.get().undoManager.stopAction()};
a.cleanupNode=function(a){var b;a.component&&(b=a.component.get())&&b.cleanup&&b.cleanup()};a.selectorFor=function(a,b){return"[data-component-uri='"+l.get(a)+"']"+(b?" "+b:"")};a.makeDivFor=function(a){return $("<div/>").attr("data-component-uri",l.get(a))};a.getInfo=function(a){return a.getComponentInfo?a.getComponentInfo():a.constructor.info};a.getMentionedTags=function(a){return a.getMentionedTags?a.getMentionedTags():new p};a.reinsertWithModifiedDOM=function(a,b){var d=a.node[0].cloneNode(!0);
b(d);a.node.replaceWith(d)};var b=a.createNode;return a}();k.Component=e})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(){var g;if(g=function(){}.apply(g||this,arguments))return g}a.Apply=a;a.prototype.ppr=function(){return"(apply)"};a.prototype.log=function(){console.log(this.ppr())};a.prototype.run=function(a){return a.run(a)};a.prototype.runS=function(a){return a.apply.runS(a)};a.prototype.runR=function(a){var e=a.runR(a);e._apply=a;return e};a.prototype.destructR=function(a){a._apply.destructR(a)};a.prototype.runRS=function(a){var e=a.apply.runRS(a);
e._apply=a.apply;return e};a.prototype.destructRS=function(a){a._apply.destructRS(a)};a.prototype.fmap=function(a){return this};a.prototype.reduce=function(a,e){return a};a.prototype.zipWith=function(a,e){return this};a.prototype.toString=function(){return"Apply"};return a}();a.Apply=l})(a.classes||(a.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.copy=function(a,g,e){var d={},b;for(b in a)d[b]=b==g?e:a[b];return d};a.onlyInputs=function(a){return a.map(function(a){return a.input})};a.input=function(a){return{input:a}};a.onState=function(a){return function(g){var e=a(g.input);g.input=e;return g}};return a}();a.State=k})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.List,p=a.arrow.State.copy,g=function(){function a(d,b){var e;if(e=function(a,b){this.f=a;this.unF=b}.apply(e||this,arguments))return e}a.Arr=a;a.prototype.ppr=function(){return"(arr "+(this.f&&this.f.name?this.f.name:"<anonymous>")+")"};a.prototype.log=function(){console.log(this.ppr())};a.prototype.run=function(a){return[this.f(a)]};a.prototype.runS=function(a){var b=this.f(a.input);return[p(a,"input",b)]};a.prototype.runR=function(a){return(new l([this.f(a)])).debugName("arr")};
a.prototype.destructR=function(a){this.unF&&this.unF(a.list[0]);a.clear()};a.prototype.runRS=function(a){var b=this.f(a.input);return new l([p(a,"input",b)])};a.prototype.destructRS=function(a){this.unF&&this.unF(a.list[0].input);a.clear()};a.prototype.fmap=function(a){return this};a.prototype.reduce=function(a,b){return a};a.prototype.zipWith=function(a,b){return this};a.prototype.toString=function(){return"Arr"};return a}();k.Arr=g})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.List,p=a.arrow.State.copy,g=function(){function a(d,b){var e;if(e=function(a,b){this.f=a;this.unF=b}.apply(e||this,arguments))return e}a.ArrI=a;a.prototype.ppr=function(){return"(arrI "+(this.f&&this.f.name?this.f.name:"<anonymous>")+")"};a.prototype.log=function(){console.log(this.ppr())};a.prototype.runS=function(a){return[this.f(p(a))]};a.prototype.runRS=function(a){a=this.f(p(a));return new l([a])};a.prototype.destructRS=function(a){this.unF&&
this.unF(a.list[0]);a.clear()};a.prototype.fmap=function(a){return this};a.prototype.reduce=function(a,b){return a};a.prototype.zipWith=function(a,b){return this};a.prototype.toString=function(){return"ArrI"};return a}();k.ArrI=g})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.State.copy,p=function(){function a(e,d){var b;if(b=function(a,b){this.f=a;this.unF=b}.apply(b||this,arguments))return b}a.ArrIL=a;a.prototype.ppr=function(){return"(arrIL "+(this.f&&this.f.name?this.f.name:"<anonymous>")+")"};a.prototype.log=function(){console.log(this.ppr())};a.prototype.runR=function(a){return this.f(a)};a.prototype.destructR=function(a){this.unF&&this.unF(a)};a.prototype.runRS=function(a){var d=this.f(l(a)),b=d.map(function(b){return l(a,
"input",b)});b._arrIL=d;return b};a.prototype.destructRS=function(a){this.unF&&this.unF(a._arrIL)};a.prototype.fmap=function(a){return this};a.prototype.reduce=function(a,d){return a};a.prototype.zipWith=function(a,d){return this};a.prototype.toString=function(){return"ArrIL"};return a}();k.ArrIL=p})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.State.copy,p=function(){function a(e,d){var b;if(b=function(a,b){this.f=a;this.unF=b}.apply(b||this,arguments))return b}a.ArrL=a;a.prototype.ppr=function(){return"(arrL "+(this.f&&this.f.name?this.f.name:"<anonymous>")+")"};a.prototype.log=function(){console.log(this.ppr())};a.prototype.runR=function(a){return this.f(a)};a.prototype.destructR=function(a){this.unF&&this.unF(a)};a.prototype.runRS=function(a){var d=this.f(a.input),b=d.map(function(b){return l(a,
"input",b)});b._arrL=d;return b};a.prototype.destructRS=function(a){this.unF&&this.unF(a._arrL)};a.prototype.fmap=function(a){return this};a.prototype.reduce=function(a,d){return a};a.prototype.zipWith=function(a,d){return this};a.prototype.toString=function(){return"ArrL"};return a}();k.ArrL=p})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(g,e){var d;if(d=function(a,d){this.left=a;this.right=d}.apply(d||this,arguments))return d}a.Compose=a;a.prototype.ppr=function(){return"("+this.left.ppr()+" >>> "+this.right.ppr()+")"};a.prototype.log=function(){console.group("Compose");this.left.log();this.right.log();console.groupEnd()};a.prototype.run=function(a){a=this.left.run(a);return Array.prototype.concat.apply([],a.map(this.right.run,this.right))};a.prototype.runS=function(a){a=
this.left.runS(a);return Array.prototype.concat.apply([],a.map(this.right.runS,this.right))};a.prototype.runR=function(a){a=this.left.runR(a);var e=this.right,d=a.map(function(a){return e.runR(a)},function(a){e.destructR(a)}).concat();d._compose=a;return d};a.prototype.destructR=function(a){this.left.destructR(a._compose)};a.prototype.runRS=function(a){a=this.left.runRS(a);var e=this.right,d=a.map(function(a){return e.runRS(a)},function(a){e.destructRS(a)}).concat();d._compose=a;return d};a.prototype.destructRS=
function(a){this.left.destructRS(a._compose)};a.prototype.fmap=function(g){return new a(g(this.left),g(this.right))};a.prototype.reduce=function(a,e){return e(this.left,this.right)};a.prototype.zipWith=function(g,e){return new a(g(this.left,e.left),g(this.right,e.right))};a.prototype.toString=function(){return"Compose"};return a}();a.Compose=l})(a.classes||(a.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.List,p=function(){function a(e){var d;if(d=function(a){this.condition=a}.apply(d||this,arguments))return d}a.Is=a;a.prototype.ppr=function(){return"(is "+(this.condition&&this.condition.name?this.condition.name:"<anonymous>")+")"};a.prototype.log=function(){console.log(this.ppr())};a.prototype.run=function(a){return this.condition(a)?[a]:[]};a.prototype.runS=function(a){return this.condition(a.input)?[a]:[]};a.prototype.runR=function(a){return new l(this.condition(a)?
[a]:[])};a.prototype.destructR=function(a){};a.prototype.runRS=function(a){return new l(this.condition(a.input)?[a]:[])};a.prototype.destructRS=function(a){};a.prototype.fmap=function(a){return this};a.prototype.reduce=function(a,d){return a};a.prototype.zipWith=function(a,d){return this};a.prototype.toString=function(){return"Is"};return a}();k.Is=p})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.List,p=function(){function a(e){var d;if(d=function(a){this.condition=a}.apply(d||this,arguments))return d}a.IsI=a;a.prototype.ppr=function(){return"(isI "+(this.condition&&this.condition.name?this.condition.name:"<anonymous>")+")"};a.prototype.log=function(){console.log(this.ppr())};a.prototype.runS=function(a){return this.condition(a)?[a]:[]};a.prototype.runRS=function(a){return new l(this.condition(a)?[a]:[])};a.prototype.destructRS=function(a){};
a.prototype.fmap=function(a){return this};a.prototype.reduce=function(a,d){return a};a.prototype.zipWith=function(a,d){return this};a.prototype.toString=function(){return"IsI"};return a}();k.IsI=p})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Objects,p=function(){function a(e,d){var b;if(b=function(a,b){this.f=a;this.args=l.isType(b,"Array")?b:[b];this.arrow=void 0}.apply(b||this,arguments))return b}a.Lazy=a;a.prototype.getArrow=function(){this.arrow||(this.arrow=this.f.apply(window,this.args));return this.arrow};a.prototype.ppr=function(){return"(lazy "+(this.f&&this.f.name?this.f.name:"<anonymous>")+")"};a.prototype.log=function(){console.log(this.ppr())};a.prototype.run=function(a){return this.getArrow().run(a)};
a.prototype.runS=function(a){return this.getArrow().runS(a)};a.prototype.runR=function(a){return this.getArrow().runR(a)};a.prototype.destructR=function(a){return this.getArrow().destructR(a)};a.prototype.runRS=function(a){return this.getArrow().runRS(a)};a.prototype.destructRS=function(a){return this.getArrow().destructRS(a)};a.prototype.fmap=function(a){return this};a.prototype.reduce=function(a,d){return a};a.prototype.zipWith=function(a,d){return this};a.prototype.toString=function(){return"Lazy"};
return a}();k.Lazy=p})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.State,p=a.reactive.List,g=l.copy,e=l.onlyInputs,l=function(){function a(b){var d;if(d=function(a){this.arrow=a}.apply(d||this,arguments))return d}a.List=a;a.prototype.ppr=function(){return"(list "+this.arrow.ppr()+")"};a.prototype.log=function(){console.group("List");this.arrow.log();console.groupEnd()};a.prototype.run=function(a){return[this.arrow.run(a)]};a.prototype.runS=function(a){return[g(a,"input",e(this.arrow.runS(a)))]};a.prototype.runR=
function(a){a=this.arrow.runR(a);var d=new p.List([a]);d._list=a;return d};a.prototype.destructR=function(a){this.arrow.destructR(a._list);a.clear()};a.prototype.runRS=function(a){var d=this.arrow.runRS(a);a=new p.List([g(a,"input",e(d))]);a._list=d;return a};a.prototype.destructRS=function(a){this.arrow.destructRS(a._list);a.clear()};a.prototype.fmap=function(b){return new a(b(this.arrow))};a.prototype.reduce=function(a,d){return this.arrow};a.prototype.zipWith=function(b,e){return new a(b(this.arrow,
e.arrow))};a.prototype.toString=function(){return"List"};return a}();k.List=l})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.List,p=a.arrow.State.copy,g=function(){function a(d){var b;if(b=function(a){this.arrow=a}.apply(b||this,arguments))return b}a.ListI=a;a.prototype.ppr=function(){return"(listI "+this.arrow.ppr()+")"};a.prototype.log=function(){console.group("ListI");this.arrow.log();console.groupEnd()};a.prototype.runS=function(a){return[p(a,"input",this.arrow.runS(a))]};a.prototype.runRS=function(a){var b=this.arrow.runRS(a);a=new l.List([p(a,"input",b)]);a._listI=
b;return a};a.prototype.destructRS=function(a){this.arrow.destructRS(a._listI);a.clear()};a.prototype.fmap=function(d){return new a(d(this.arrow))};a.prototype.reduce=function(a,b){return this.arrow};a.prototype.zipWith=function(d,b){return new a(d(this.arrow,b.arrow))};a.prototype.toString=function(){return"ListI"};return a}();k.ListI=g})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(g,e,d){var b;if(b=function(a,b,d){this.f=b;this.arrow=a;this.unF=d}.apply(b||this,arguments))return b}a.MapLI=a;a.prototype.ppr=function(){return"(mapLI "+(this.f&&this.f.name?this.f.name:"<anonymous>")+" "+this.arrow.ppr()+")"};a.prototype.log=function(){console.group("MapLI",this.f&&this.f.name?this.f.name:"<anonymous>");this.arrow.log();console.groupEnd()};a.prototype.runS=function(a){return this.f(this.arrow.runS(a))};a.prototype.runRS=
function(a){a=this.arrow.runRS(a);var e=this.f(a);e._mapLI=a;return e};a.prototype.destructRS=function(a){this.unF&&this.unF(a);this.arrow.destructRS(a._mapLI)};a.prototype.fmap=function(g){return new a(g(this.arrow),this.f,this.unF)};a.prototype.reduce=function(a,e){return this.arrow};a.prototype.zipWith=function(g,e){return new a(g(this.arrow,e.arrow),this.f,this.unF)};a.prototype.toString=function(){return"MapLI"};return a}();a.MapLI=l})(a.classes||(a.classes={}))})(a.arrow||(a.arrow={}))})(_||
(_={}));(function(a){(function(m){(function(k){var l=a.reactive.List,p=a.typlib.Arrays,g=function(){function a(d){var b;if(b=function(a){this.arrows=a}.apply(b||this,arguments))return b}a.Sum=a;a.prototype.ppr=function(){return"("+this.arrows.map(function(a){return a.ppr()}).join(" <+> ")+")"};a.prototype.log=function(){console.group("Sum");this.arrows.forEach(function(a){a.log()});console.groupEnd()};a.prototype.run=function(a){return Array.prototype.concat.apply([],this.arrows.map(function(b){return b.run(a)}))};
a.prototype.runS=function(a){return Array.prototype.concat.apply([],this.arrows.map(function(b){return b.runS(a)}))};a.prototype.runR=function(a){var b=this.arrows.map(function(b){return b.runR(a)}),e=(new l(b)).concat();e._sum=b;return e};a.prototype.destructR=function(a){for(var b=0;b<this.arrows.length;b++)this.arrows[b].destructR(a._sum[b])};a.prototype.runRS=function(a){var b=this.arrows.map(function(b){return b.runRS(a)}),e=(new l(b)).concat();e._sum=b;return e};a.prototype.destructRS=function(a){for(var b=
0;b<this.arrows.length;b++)this.arrows[b].destructRS(a._sum[b])};a.prototype.fmap=function(d){return new a(this.arrows.map(d))};a.prototype.reduce=function(a,b){return this.arrows.reduce(b,a)};a.prototype.zipWith=function(d,b){return new a(p.zipWith(d,this.arrows,b.arrows))};a.prototype.toString=function(){return"Sum"};return a}();k.Sum=g})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.State.copy,p=function(){function a(){var e;if(e=function(){}.apply(e||this,arguments))return e}a.Unlist=a;a.prototype.ppr=function(){return"unlist"};a.prototype.log=function(){console.log(this.ppr())};a.prototype.run=function(a){return a};a.prototype.runS=function(a){return a.input.map(function(d){return l(a,"input",d)})};a.prototype.runR=function(a){return a};a.prototype.destructR=function(a){};a.prototype.runRS=function(a){return a.input.map(function(d){return l(a,
"input",d)})};a.prototype.destructRS=function(a){};a.prototype.fmap=function(a){return this};a.prototype.reduce=function(a,d){return a};a.prototype.zipWith=function(a,d){return this};a.prototype.toString=function(){return"Unlist"};return a}();k.Unlist=p})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(){var g;if(g=function(){}.apply(g||this,arguments))return g}a.UnlistI=a;a.prototype.ppr=function(){return"unlistI"};a.prototype.log=function(){console.log(this.ppr())};a.prototype.runS=function(a){return a.input};a.prototype.runRS=function(a){return a.input};a.prototype.destructRS=function(a){};a.prototype.fmap=function(a){return this};a.prototype.reduce=function(a,e){return a};a.prototype.zipWith=function(a,e){return this};a.prototype.toString=
function(){return"UnlistI"};return a}();a.UnlistI=l})(a.classes||(a.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.State.copy,p=function(){function a(e,d,b){var n;if(n=function(a,b,d){this.f=a;this.arrow=b;this.unF=d}.apply(n||this,arguments))return n}a.Map=a;a.prototype.ppr=function(){return"(map "+(this.f&&this.f.name?this.f.name:"<anonymous>")+" "+(this.unF?this.unF.name?this.unF.name:"<anonymous>":"")+" "+this.arrow.ppr()+")"};a.prototype.log=function(){console.group("Map",this.f&&this.f.name?this.f.name:"<anonymous>",this.unF?this.unF.name?this.unF.name:
"<anonymous>":"");this.arrow.log();console.groupEnd()};a.prototype.run=function(a){return this.arrow.run(a).map(this.f)};a.prototype.runS=function(a){var d=this.f;return this.arrow.runS(a).map(function(a,e){return l(a,"input",d(a.input,e))})};a.prototype.runR=function(a){a=this.arrow.runR(a);var d=a.map(this.f,this.unF);d._map=a;return d};a.prototype.destructR=function(a){this.arrow.destructR(a._map)};a.prototype.runRS=function(a){var d=this.f,b=this.unF;a=this.arrow.runRS(a);var n=a.map(function(a,
b){return l(a,"input",d(a.input,b))},function(a){b&&b(a.input)});n._map=a;return n};a.prototype.destructRS=function(a){this.arrow.destructRS(a._map)};a.prototype.fmap=function(e){return new a(this.f,e(this.arrow),this.unF)};a.prototype.reduce=function(a,d){return this.arrow};a.prototype.zipWith=function(e,d){return new a(this.f,e(this.arrow,d.arrow),this.unF)};a.prototype.toString=function(){return"Map"};return a}();k.Map=p})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(g,e,d){var b;if(b=function(a,b,d){this.f=a;this.arrow=b;this.unF=d}.apply(b||this,arguments))return b}a.MapI=a;a.prototype.ppr=function(){return"(mapI "+(this.f&&this.f.name?this.f.name:"<anonymous>")+" "+(this.unF?this.unF.name?this.unF.name:"<anonymous>":"")+" "+this.arrow.ppr()+")"};a.prototype.log=function(){console.group("MapI",this.f&&this.f.name?this.f.name:"<anonymous>",this.unF?this.unF.name?this.unF.name:"<anonymous>":"");
this.arrow.log();console.groupEnd()};a.prototype.runS=function(a){return this.arrow.runS(a).map(this.f)};a.prototype.runRS=function(a){a=this.arrow.runRS(a);var e=a.map(this.f,this.unF);e._mapI=a;return e};a.prototype.destructRS=function(a){this.arrow.destructRS(a._mapI)};a.prototype.fmap=function(g){return new a(this.f,g(this.arrow),this.unF)};a.prototype.reduce=function(a,e){return this.arrow};a.prototype.zipWith=function(g,e){return new a(this.f,g(this.arrow,e.arrow),this.unF)};a.prototype.toString=
function(){return"MapI"};return a}();a.MapI=l})(a.classes||(a.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.State,p=l.copy,g=l.onlyInputs,l=function(){function a(d,b){var e;if(e=function(a,b){this.mapped=a;this.arrow=b}.apply(e||this,arguments))return e}a.MapA=a;a.prototype.ppr=function(){return"(mapA "+this.mapped.ppr()+" "+this.arrow.ppr()+")"};a.prototype.log=function(){console.group("MapA");this.mapped.log();this.arrow.log();console.groupEnd()};a.prototype.run=function(a){var b=this.mapped;return this.arrow.run(a).map(function(a){return b.run(a)})};
a.prototype.runS=function(a){var b=this.mapped;return this.arrow.runRS(a).map(function(a){return p(a,"input",g(b.runS(a)))})};a.prototype.runR=function(a){var b=this.mapped;a=this.arrow.runR(a);var e=a.map(function(a){return b.runR(a)},function(a){return b.destructR(a)});e._mapA=a;return e};a.prototype.destructR=function(a){this.arrow.destructR(a._mapA)};a.prototype.runRS=function(a){var b=this.mapped,e="MapA_orig"+Math.floor(1E6*Math.random());a=this.arrow.runRS(a);var r=a.map(function(a){var d=
b.runRS(a);a=p(a,"input",g(d));a[e]=d;return a},function(a){return b.destructRS(a[e])});r._mapA=a;return r};a.prototype.destructRS=function(a){this.arrow.destructRS(a._mapA)};a.prototype.fmap=function(d){return new a(d(this.mapped),d(this.arrow))};a.prototype.reduce=function(a,b){return b(this.mapped,this.arrow)};a.prototype.zipWith=function(d,b){return new a(d(this.mapped,b.mapped),d(this.arrow,b.arrow))};a.prototype.toString=function(){return"MapA"};return a}();k.MapA=l})(m.classes||(m.classes=
{}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(g,e){var d;if(d=function(a,d){this.condition=a;this.arrow=d}.apply(d||this,arguments))return d}a.Filter=a;a.prototype.ppr=function(){return"(filter "+(this.condition&&this.condition.name?this.condition.name:"<anonymous>")+" "+this.arrow.ppr()+")"};a.prototype.log=function(){console.group("Filter ",this.condition&&this.condition.name?this.condition.name:"<anonymous>");this.arrow.log();console.groupEnd()};a.prototype.run=function(a){return this.arrow.run(a).filter(this.condition)};
a.prototype.runS=function(a){var e=this.condition;return this.arrow.runS(a).filter(function(a){return e(a.input)})};a.prototype.runR=function(a){a=this.arrow.runR(a);var e=a.filter(this.condition);e._filter=a;return e};a.prototype.destructR=function(a){this.arrow.destructR(a._filter)};a.prototype.runRS=function(a){var e=this.condition;a=this.arrow.runRS(a);var d=a.filter(function(a){return e(a.input)});d._filter=a;return d};a.prototype.destructRS=function(a){this.arrow.destructRS(a._filter)};a.prototype.fmap=
function(g){return new a(this.condition,g(this.arrow))};a.prototype.reduce=function(a,e){return this.arrow};a.prototype.zipWith=function(g,e){return new a(this.condition,g(this.arrow,e.arrow))};a.prototype.toString=function(){return"Filter"};return a}();a.Filter=l})(a.classes||(a.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(g,e){var d;if(d=function(a,d){this.condition=a;this.arrow=d}.apply(d||this,arguments))return d}a.FilterI=a;a.prototype.ppr=function(){return"(filterI "+(this.condition&&this.condition.name?this.condition.name:"<anonymous>")+" "+this.arrow.ppr()+")"};a.prototype.log=function(){console.group("FilterI",this.condition&&this.condition.name?this.condition.name:"<anonymous>");this.arrow.log();console.groupEnd()};a.prototype.runS=function(a){return this.arrow.runS(a).filter(this.condition)};
a.prototype.runRS=function(a){a=this.arrow.runRS(a);var e=a.filter(this.condition);e._filterI=a;return e};a.prototype.destructRS=function(a){this.arrow.destructRS(a._filterI)};a.prototype.fmap=function(g){return new a(this.condition,g(this.arrow))};a.prototype.reduce=function(a,e){return this.arrow};a.prototype.zipWith=function(g,e){return new a(this.condition,g(this.arrow,e.arrow))};a.prototype.toString=function(){return"FilterI"};return a}();a.FilterI=l})(a.classes||(a.classes={}))})(a.arrow||(a.arrow=
{}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.State.copy,p=function(){function a(e,d,b){var n;if(n=function(a,b,d){this.f=a;this.arrow=b;this.unF=d}.apply(n||this,arguments))return n}a.PreCompose=a;a.prototype.ppr=function(){return"(precompose "+(this.f&&this.f.name?this.f.name:"<anonymous>")+" "+(this.unF?this.unF.name?this.unF.name:"<anonymous>":"")+" "+this.arrow.ppr()+")"};a.prototype.log=function(){console.group("PreCompose",this.f&&this.f.name?this.f.name:"<anonymous>",this.unF?this.unF.name?
this.unF.name:"<anonymous>":"");this.arrow.log();console.groupEnd()};a.prototype.run=function(a){return this.arrow.run(this.f(a))};a.prototype.runS=function(a){return this.arrow.runS(l(a,"input",this.f(a.input)))};a.prototype.runR=function(a){a=this.f(a);var d=this.arrow.runR(a);d._preCompose=a;return d};a.prototype.destructR=function(a){this.arrow.destructR(a);this.unF&&this.unF(a._preCompose)};a.prototype.runRS=function(a){var d=this.f(a.input);a=l(a,"input",d);a=this.arrow.runRS(a);a._preCompose=
d;return a};a.prototype.destructRS=function(a){this.arrow.destructRS(a);this.unF&&this.unF(a._preCompose)};a.prototype.fmap=function(e){return new a(this.f,e(this.arrow),this.unF)};a.prototype.reduce=function(a,d){return this.arrow};a.prototype.zipWith=function(e,d){return new a(this.f,e(this.arrow,d.arrow),this.unF)};a.prototype.toString=function(){return"PreCompose"};return a}();k.PreCompose=p})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.State.copy,p=function(){function a(e,d,b){var n;if(n=function(a,b,d){this.f=a;this.arrow=b;this.unF=d}.apply(n||this,arguments))return n}a.PreComposeI=a;a.prototype.ppr=function(){return"(precomposeI "+(this.f&&this.f.name?this.f.name:"<anonymous>")+" "+(this.unF?this.unF.name?this.unF.name:"<anonymous>":"")+" "+this.arrow.ppr()+")"};a.prototype.log=function(){console.group("PreComposeI",this.f&&this.f.name?this.f.name:"<anonymous>",this.unF?this.unF.name?
this.unF.name:"<anonymous>":"");this.arrow.log();console.groupEnd()};a.prototype.runS=function(a){return this.arrow.runS(this.f(l(a)))};a.prototype.runRS=function(a){a=this.f(l(a));var d=this.arrow.runRS(a);d._preComposeI=a;return d};a.prototype.destructRS=function(a){this.arrow.destructRS(a);this.unF&&this.unF(a._preComposeI)};a.prototype.fmap=function(e){return new a(this.f,e(this.arrow),this.unF)};a.prototype.reduce=function(a,d){return this.arrow};a.prototype.zipWith=function(e,d){return new a(this.f,
e(this.arrow,d.arrow),this.unF)};a.prototype.toString=function(){return"PreComposeI"};return a}();k.PreComposeI=p})(m.classes||(m.classes={}))})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){var k=a.arrow.classes.Arr,l=a.arrow.classes.ArrI,p=a.arrow.classes.Compose,g=a.arrow.classes.Sum,e=a.arrow.classes.Map,d=a.arrow.classes.MapI,b=a.arrow.classes.MapLI,n=a.arrow.classes.Filter,r=a.arrow.classes.FilterI,h=a.arrow.classes.Is,f=a.arrow.classes.IsI,c=a.arrow.classes.PreCompose,q=a.arrow.classes.PreComposeI,s=a.arrow.State,u=function(){function a(){}a.init=function(){var x=a.Var={};a.rules=[{pattern:new p(x,new k(null)),rewrite:function(a){return new e(a.right.f,
a.left,a.right.unF)},name:"Arr -> Map"},{pattern:new p(x,new l(null)),rewrite:function(a){return new d(a.right.f,a.left,a.right.unF)},name:"ArrI -> MapI"},{pattern:new p(x,new p(x,x)),rewrite:function(a){return new p(new p(a.left,a.right.left),a.right.right)},name:"Compose associate left"},{pattern:new p(x,new e(null,x)),rewrite:function(a){return new e(a.right.f,new p(a.left,a.right.arrow),a.right.unF)},name:"Map float out"},{pattern:new p(x,new d(null,x)),rewrite:function(a){return new d(a.right.f,
new p(a.left,a.right.arrow),a.right.unF)},name:"MapI float out"},{pattern:new e(null,new e(null,x)),guard:function(a){return!(a.unF||a.arrow.unF)},rewrite:function(a){return new e(z(a.f,a.arrow.f),a.arrow.arrow)},name:"Map fusion"},{pattern:new d(null,new d(null,x)),guard:function(a){return!(a.unF||a.arrow.unF)},rewrite:function(a){return new d(z(a.f,z(s.copy,a.arrow.f)),a.arrow.arrow)},name:"MapI fusion"},{pattern:new b(new b(x,null),null),guard:function(a){return!(a.unF||a.arrow.unF)},rewrite:function(a){return new b(a.arrow.arrow,
z(a.f,a.arrow.f))},name:"MapLI fusion"},{pattern:new e(null,new d(null,x)),guard:function(a){return!(a.unF||a.arrow.unF)},rewrite:function(a){return new d(z(s.onState(a.f),z(s.copy,a.arrow.f)),a.arrow.arrow)},name:"Map/MapI fusion"},{pattern:new d(null,new e(null,x)),guard:function(a){return!(a.unF||a.arrow.unF)},rewrite:function(a){return new d(z(a.f,z(s.copy,s.onState(a.arrow.f))),a.arrow.arrow)},name:"MapI/Map fusion"},{pattern:new p(x,new h(null)),rewrite:function(a){return new n(a.right.condition,
a.left)},name:"Is -> Filter"},{pattern:new p(x,new f(null)),rewrite:function(a){return new r(a.right.condition,a.left)},name:"IsI -> FilterI"},{pattern:new g([]),guard:function(a){return 1===a.arrows.length},rewrite:function(a){return a.arrows[0]},name:"Sum single element"},{pattern:new g([]),guard:function(a){return 0<a.arrows.filter(function(a){return a.constructor===g}).length},rewrite:u,name:"Sum flattening"},{pattern:new p(new k(null),x),rewrite:function(a){return new c(a.left.f,a.right,a.left.unF)},
name:"Arr -> PreCompose"},{pattern:new p(new e(null,x),x),rewrite:function(a){return new p(a.left.arrow,new c(a.left.f,a.right,a.left.unF))},name:"Map -> PreCompose"},{pattern:new p(new l(null),x),rewrite:function(a){return new q(a.left.f,a.right,a.left.unF)},name:"ArrI -> PreComposeI"},{pattern:new p(new d(null,x),x),rewrite:function(a){return new p(a.left.arrow,new q(a.left.f,a.right,a.left.unF))},name:"MapI -> PreComposeI"}];a.changed=!1};a.flattenSum=function(a){a=a.arrows;for(var c=0;c<a.length;){var b=
a[c];b.constructor===g?a=a.slice(0,c).concat(b.arrows).concat(a.slice(c+1)):c++}return new g(a)};a.size=function D(a){return a.fmap(D).reduce(0,function(a,c){return a+c})+1};a.optimize=function(c){var b=-1;do b++,a.changed=!1,c=x(c);while(a.changed&&10>b);a.changed&&console.warn("Exceeded optimize loop threshold.");return c};a.optimizeStep=function F(a){a.fmap||console.error("Not an arrow: "+a);return w(a.fmap(F))};a.rewriteIfMatch=function(c){for(var b=a.rules,d=0;d<b.length;d++)if(y(b[d],c))return a.changed=
!0,b[d].rewrite(c);return c};a.match=function(a,c){return m(a.pattern,c)&&(!a.guard||a.guard(c))};a.matchPat=function C(c,b){return c===a.Var?!0:c.constructor!==b.constructor?!1:c.zipWith(C,b).reduce(!0,function(a,c){return a&&c})};a.composeI=function(a,c){var b=function(b,d){return a(c(b,d),d)};b.name="composeI("+a.name+", "+c.name+")";return b};var u=a.flattenSum,x=a.optimizeStep,w=a.rewriteIfMatch,y=a.match,m=a.matchPat,z=a.composeI;return a}();m.Optimize=u;u.init()})(a.arrow||(a.arrow={}))})(_||
(_={}));(function(a){(function(m){var k=a.arrow.classes.Apply,l=a.arrow.classes.Arr,p=a.arrow.classes.ArrI,g=a.arrow.classes.ArrIL,e=a.arrow.classes.ArrL,d=a.arrow.classes.Compose,b=a.arrow.classes.Is,n=a.arrow.classes.IsI,r=a.arrow.classes.Lazy,h=a.arrow.classes.List,f=a.arrow.classes.ListI,c=a.arrow.classes.MapLI,q=a.arrow.classes.Sum,s=a.arrow.classes.Unlist,u=a.arrow.classes.UnlistI,t=a.typlib.Arrays,v=a.reactive.List,x=a.reactive.Value,w=a.typlib.Functions,y=a.reactive.Functions,A=a.arrow.Optimize,z=
a.arrow.State,B=function(){function a(){}a.arr=function(a,c){return new l(a,c)};a.arrI=function(a,c){return new p(a,c)};a.arrL=function(a,c){return new e(a,c)};a.arrIL=function(a,c){return new g(a,c)};a.effect=function(a,c){return B(function(c){a(c);return c},c)};a.effectI=function(a,c){return m(function(c){a(c);return c},c)};a.id=function(){return a.arr(function(a){return a})}();a.apply=new k;a.constA=function(a){return B(function(){return a})};a.constR=function(a){return H(L(a),R)};a.constL=function(c){return a.arrL(function(){return c instanceof
Array?new v.List(c):c})};a.zero=a.constL([]);a.compose=function(a,c){return new d(a,c)};a.seq=function(){return Array.prototype.slice.call(arguments,0).reduce(a.compose)};a.sum=function(){var a=Array.prototype.slice.call(arguments,0);return new q(a)};a.list=function(a){return new h(a)};a.listI=function(a){return new f(a)};a.toList=a.arr(function(a){return a.toList()});a.is=function(a){return new b(a)};a.isTrue=new b(w.id);a.isFalse=function(){return new b(function(a){return!a})}();a.isI=function(a){return new n(a)};
a.orElse=function(){return t.reduce(arguments,K,N)};a.orElse2=function(a,c){return H(V("orElse_tmp"),M(a),ca(function(a){return y.eq(a.length(),0)},H(U("orElse_tmp"),c),Y))};a.ifA=function(a,c,b){return I(H(P(a),c),H(Q(a),b))};a.ifAI=function(a,c,b){return I(H(J(a),c),H(W(a),b))};a.isR=function(a){return H(V("isR_tmp"),B(a),R,P(w.id),U("isR_tmp"))};a.isRI=function(a){return H(V("isR_tmp"),m(function(c){c.input=a(c);return c}),R,P(w.id),U("isR_tmp"))};a.isRC=function(a){return X(w.constant(a))};a.ifR=
function(a,c,b){return I(H(X(a),c),H(X(w.compose(y.not,a)),b))};a.ifRI=function(a,c,b){return I(H(aa(a),c),H(aa(w.compose(y.not,a)),b))};a.ifRC=function(a,c,b){return ca(w.constant(a),c,b)};a.when=function(a,c){return I(H(P(a),c,N),G)};a.whenI=function(a,c){return I(H(J(a),c,N),G)};a.whenR=function(a,c){return I(H(X(a),c,N),G)};a.whenRI=function(a,c){return I(H(aa(a),c,N),G)};a.whenRC=function(a,c){return da(w.constant(a),c)};a.isSetS=function(a){return void 0===a?!1:!0};a.isSetR=function(a){return X(function(c){return a(c).map(O)})};
a.not=function(a){return new b(w.not(a))};a.notI=function(a){return new n(w.not(a))};a.notR=function(a){return X(w.compose(y.not,a))};a.notRI=function(a){return aa(w.compose(y.not,a))};a.notAR=function(a){return H(V("notA_tmp"),M(a),E(function(a){return v.valueToList(y.cond(y.eq(a.length(),0),!0,void 0))}),U("notA_tmp"))};a.put=function(a){return m(function(c){c[a]=c.input;return c})};a.putWith=function(a,c){return m(function(b){b[a]=c(b.input);return b})};a.save=function(a,c){return m(function(b){b[a]=
c;return b})};a.saveA=function(a,c){return H(V("saveA_tmp"),c,V(a),U("saveA_tmp"))};a.unique=function(a){return m(function(c){c[a]="id"+Math.floor(1E6*Math.random());return c})};a.get=function(a){return m(function(c){c.input=c[a];return c})};a.exists=function(a){return J(function(c){return!!c[a]})};a.fromValue=function(){return a.arrL(function(a){return v.valueToList(a)})}();a.fromValueOrId=function(){return a.seq(a.arr(function(a){return x.value(a)}),a.fromValue)}();a.fromArray=a.arrL(function(a){return new v.List(a||
[])});a.head=function(a){return new c(a,function(a){return a.headL()})};a.tail=function(a){return new c(a,function(a){return a.tail()})};a.last=function(a){return new c(a,function(a){return a.lastL()})};a.sample=function(a,b){return new c(a,function(a){return a.sample(b)})};a.take=function(a,b){return new c(a,function(a){return a.take(b)})};a.sort=function(a,b){return new c(a,function(a){return a.sort(b)})};a.group=function(a,b){return new c(a,function(a){return a.group(b).map(function(a){return{input:a}})})};
a.reverse=function(a){return new c(a,function(a){return a.reverse()})};a.lift=function(a){return function(c){return H(M(c),E(function(c){return c.lift(a)}))}};a.liftI=function(a){return function(c){return H(S(c),E(function(c){return c.lift(a)}))}};a.propA=function(a){return B(function(c){return c[a]})};a.methodA=function(a){var c=[].slice.call(arguments,1);return B(function(b){return b[a].apply(b,c)})};a.lazy=function(a,c){return new r(a,c)};a.log=function(a){return B(function(c){console.log(Math.random(),
"log arrow [",a,"]",c);return c},function(c){console.log(Math.random(),"log arrow destructor [",a,"]",c)})};a.logI=function(a){return m(function(c){console.log(Math.random(),"logI arrow [",a,"]",c);return c},function(c){console.log(Math.random(),"logI arrow destructor [",a,"]",c)})};a.debug=function(){return a.arr(function(a){debugger;return a})}();a.run=function(a,c,b){b||(a=A.optimize(a));var d=a.runRS(z.input(c));c=d.map(function(a){return a.input});c.destruct=function(){a.destructRS(d)};return c};
a.unlist=new s;a.unlistI=new u;var B=a.arr,m=a.arrI,E=a.arrL,G=a.id,L=a.constA,N=a.zero,H=a.seq,I=a.sum,M=a.list,S=a.listI,P=a.is,J=a.isI,K=a.orElse2,X=a.isR,aa=a.isRI,ca=a.ifR,da=a.whenR,O=a.isSetS,Q=a.not,W=a.notI,V=a.put,U=a.get,R=a.fromValue,Y=a.unlist;return a}();m.Arrow=B})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,p=a.typlib.Objects,g=function(){function a(){}a.setup=function(a,b){window.SILK_DEBUGGING||b||(a?d.bugsense=new window.Bugsense({apiKey:a,noOnError:!0}):console.warn("No bugsense api key defined."))};a.trackUser=function(a){l.lift(function(a,d,f){b((a||d||f)&&{"User name":a,"User email":d,"User uuid":f})})(a.name,a.email,a.uuid)};a.addUserData=function(a){d.userData=p.merge(d.userData,a)};a.handleError=function(a,e){if(d.bugsense){b({Url:location.href});
var h=p.merge(d.userData,e);try{d.bugsense.notify(a,null,null,h)}catch(f){}}};a.userData={};a.bugsense=null;var d=a,b=a.addUserData;return a}();k.Bugsense=g})(m.tracking||(m.tracking={}))})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Thread,l=a.typlib.tracking.Bugsense,p=function(){function a(){}a.setup=function(b){a.Api=b;window.SILK_DEBUGGING||k.wrap(a.createErrorWrapper)};a.createErrorWrapper=function(a,r,h){if(h&&!0===h.ignoreErrors)return a;var f=function(){try{return a.apply(this,arguments)}catch(c){b(c,{source:r,name:a.name})}};return"ajax.error"===r?e(a&&f,h.url,h.ignoreErrors):"ajax.success"===r?d(a&&f,h.url):"ajax.beforeSend"===r?function(c){c.onerror=function(a){h.error(a.target,
null,null,!0)};a&&f.apply(this,arguments)}:a&&f};a.createXHRErrorWrapper=function(b,d,h){return function(f,c,e,s){if(!h||!~h.indexOf(f.status))if(a.ui)a.message=a.ui.error("Server not available. Please try again in a moment.",{uri:d,status:f.status,responseText:f.responseText});else return;if(b)return b.apply(this,arguments)}};a.createXHRSuccessWrapper=function(b,d,h){return function(d){a.message&&(a.message.discard(),a.message=null);if(b)return b.apply(this,arguments)}};a.handleError=function(b,
d){if(!window.SILK_DEBUGGING){b=b||{};var h=b.stack||"",f=b.fileName||b.sourceURL||"",c=b.lineNumber||b.line,e=b.message||b,s=d&&d.name||"",u=d&&d.source||"",t=JSON.stringify({em:e,ef:f,el:c,m:d});a.errorCache[t]?a.errorCache[t]++:(l.handleError(b,d),h={repository:window.location.host,action:s,source:u,message:""+e,fileName:f,stack:h,userAgent:navigator.userAgent,url:window.location.href,lineNumber:c},a.Api&&a.Api.Error.create(h,function(){},function(){},{ignoreErrors:!0}),a.errorCache[t]=1);a.ui&&
a.ui.error('An unknown error occurred. If refreshing the page doesn\'t get rid of this message, please <a href="https://www.silk.co/feedback" target=_blank>contact us</a>.',{html:!0})}};a.ui=null;a.message=null;a.errorCache={};a.Api=null;var e=a.createXHRErrorWrapper,d=a.createXHRSuccessWrapper,b=a.handleError;return a}();m.ErrorHandling=p})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Node,l=a.typlib.Arrays,p=a.typlib.ErrorHandling,g=k.getNodeOffsetReactive,e=function(){function a(){}a.init=function(){a.DEBUG=!1;a.EVENTS_ENABLED=!0;a.handlers={NodeInserted:[],NodeRemoved:[],CharacterDataModified:[],AttributeModified:[],MutationEventsInstalled:[]};b.observer=null;b.ignoringMutations=!1};a.installMutationEvents=function(c){for(var f=c;f;){if(f.__mutationEventsInstalled)return;f=f.parentNode}c.__mutationEventsInstalled=!0;(f=e(function(a){a.forEach(u)}))?
(a.DEBUG&&console.log("Registering mutation observers on",c),f.observe(c,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0}),b.observer=f):(a.DEBUG&&console.log("Registering DOM mutation events on",c),$(c).bind("DOMNodeInserted",w),G(c),$(c).bind("DOMCharacterDataModified",B),$(c).bind("DOMAttrModified",F));f=$.Event("MutationEventsInstalled");f.target=c;q(f)};a.uninstallMutationEvents=function(a){b.observer?b.observer.disconnect():($(a).unbind("DOMNodeInserted",
w),L(a),$(a).unbind("DOMCharacterDataModified",B),$(a).unbind("DOMAttrModified",F));a.__mutationEventsInstalled=!1};a.getMutationObserver=function(a){var c=window.MutationObserver||window.WebKitMutationObserver;if(!c||"Trident"===$.ua.engine.name)return null;a=new c(a);return"takeRecords"in a?a:null};a.register=function(c,b){a.handlers[c].push(b)};a.unregister=function(c,b){l.remove(a.handlers[c],b)};a.registerAll=function(a){r("MutationEventsInstalled",a);r("NodeInserted",a);r("NodeRemoved",a);r("AttributeModified",
a);r("CharacterDataModified",a)};a.unregisterAll=function(a){h("MutationEventsInstalled",a);h("NodeInserted",a);h("NodeRemoved",a);h("AttributeModified",a);h("CharacterDataModified",a)};a.markMutations=function(a,b,d){c();a();b();c();d()};a.ignoreMutations=function(a){f(function(){b.ignoringMutations=!0},a,function(){b.ignoringMutations=!1})};a.flush=function(){if(b.observer){var a=!1;do{var c=b.observer.takeRecords();c.forEach(u);0<c.length&&(a=!0)}while(0<c.length);return a}return!1};a.handleEvent=
function(c){b.ignoringMutations?a.DEBUG&&console.log("Not dispatching event",c):(a.DEBUG&&console.log("Dispatching event",c),a.handlers[c.type].forEach(s(c)))};a.runHandler=function(a){return function(c){try{c(a)}catch(b){p.handleError(b,{source:"reactive.Events",action:"handleEvent."+a.type+"."+c.name})}}};a.handleMutation=function(a){switch(a.type){case "attributes":t(a);break;case "characterData":v(a);break;case "childList":x(a);break;default:console.error("Unknown type in dom mutation record:",
a.type)}};a.handleAttributeMutation=function(a){a={target:a.target,attribute:a.attributeName,oldValue:a.oldValue,newValue:a.target.getAttribute(a.attributeName)};C(a)};a.handleCharacterDataMutation=function(a){D({target:a.target,oldValue:a.oldValue,newValue:a.target.textContent})};a.handleChildListMutation=function(a){l.forEach(a.addedNodes,function(c,b){y({target:c,parentNode:a.target,nextSibling:a.nextSibling,previousSibling:0===b?a.previousSibling:a.addedNodes[b-1]})});l.forEach(a.removedNodes,
function(c,b){z({target:c,parentNode:a.target,nextSibling:b===a.removedNodes.length-1?a.nextSibling:a.removedNodes[b+1],previousSibling:a.previousSibling})})};a.DOMNodeInserted=function(a){var c=a.relatedNode.childNodes,b=l.indexOf(c,a.target);y({target:a.target,parentNode:a.relatedNode,nextSibling:c[b+1],previousSibling:c[b-1]})};a.nodeInserted=function(c){var f=c.target,h=c.parentNode;"Trident"===$.ua.engine.name&&(h=f.parentNode);a.DEBUG&&console.log((new Date).getTime(),"Node inserted",f,"in",
h);var e=h.__reactive;if(a.EVENTS_ENABLED&&e&&!e.nonReactiveChildren){var q=-1<f.reactiveOffset;if(-1===e.childNodes.list.indexOf(f.__reactive)||!f.__reactive||f.__reactive.parentNode!==e||q){b.observer||G(f);var s;if(q)s=f.reactiveOffset,delete f.reactiveOffset;else{s=0;var n=e.getShadowChildNodes();c.previousSibling?s=n.indexOf(c.previousSibling)+1:c.nextSibling&&(s=n.indexOf(c.nextSibling))}c.offset=s;q||(q=new k(f,"recursive"),q.parentNode=e,q.__rParentNode=e,f.insertedIn=h,e.childNodes.insert(s,
[q]),delete f.insertedIn);c.type="NodeInserted";a.handleEvent(c)}}};a.DOMNodeRemoved=function(a){z({target:a.target,parentNode:a.relatedNode})};a.nodeRemoved=function(c){var b=c.target,f=c.parentNode;a.DEBUG&&console.log((new Date).getTime(),"Node removed",b,"from",f);if(a.EVENTS_ENABLED&&f.__reactive&&!E(f)){var h=-1<b.reactiveOffset,e=h?b.reactiveOffset:g(b,f);-1!==e&&(c.offset=e,c.type="NodeRemoved",a.handleEvent(c),h?delete b.reactiveOffset:(c=!0,b.parentNode&&b.parentNode!==f&&(c=!1),f.removedOffset=
e,delete b.__reactive.__parentNode,b.parentNode&&(b.__reactive.parentNode=b.parentNode.__reactive),f.__reactive.childNodes.remove(e,1),c&&b.__reactive.cleanup(!0),delete f.removedOffset))}};a.DOMCharacterDataModified=function(a){D({target:a.target,oldValue:a.prevValue,newValue:a.target.textContent})};a.characterDataModified=function(c){a.DEBUG&&console.log((new Date).getTime(),"Character data modified",c.target,"|",'"'+c.oldValue+'"',"to",'"'+c.newValue+'"');a.EVENTS_ENABLED&&c.target.__reactive&&
"INPUT"!=c.target.nodeName&&"TEXTAREA"!=c.target.nodeName&&(c.target.__reactive.initiatedByMe=!0,c.target.__reactive.textContent.set(c.target.textContent),c.target.__reactive.initiatedByMe=!1,c.type="CharacterDataModified",a.handleEvent(c))};a.DOMAttrModified=function(a){C({target:a.target,attribute:a.attrName,oldValue:a.prevValue,newValue:a.newValue})};a.attributeModified=function(c){var b=c.target.__removedByReactive,f=!1;b&&(f=-1!=b.indexOf(c.attribute),l.remove(b,c.attribute));if(c.oldValue!==
c.newValue&&("id"!==c.attribute||!(c.newValue&&0===c.newValue.indexOf("sizzle-")||c.oldValue&&0===c.oldValue.indexOf("sizzle-")))&&(a.DEBUG&&console.log((new Date).getTime(),"Attribute modified",c.target,"|",c.attribute,"from",c.oldValue,"to",c.newValue),a.EVENTS_ENABLED&&c.target.__reactive&&!E(c.target))){var b=c.target.__reactive.attributes,h=b.get(c.attribute).get();if(f||null!==c.newValue||void 0!==h&&null!==h)null===c.newValue?b.unset(c.attribute):b.set(c.attribute,c.newValue),c.type="AttributeModified",
a.handleEvent(c)}};a.isDetachedReactive=function(a){var c=a.__reactive&&a.__reactive.parentNode;return a.parentNode&&!c?!1:c&&(!c.__reactive||c.__reactive.childNodes&&-1!==c.__reactive.getShadowChildNodes().indexOf(a))?!1:!0};a.addNodeRemovedListeners=function H(a){$(a).bind("DOMNodeRemoved",m);a.nodeType==window.Node.TEXT_NODE&&$(a).bind("DOMCharacterDataModified",B);l.forEach(a.childNodes,H)};a.removeNodeRemovedListeners=function(a){$(a).unbind("DOMNodeRemoved",m);a.nodeType==window.Node.TEXT_NODE&&
$(a).unbind("DOMCharacterDataModified",B);l.forEach(a.childNodes,G)};var b=a,e=a.getMutationObserver,r=a.register,h=a.unregister,f=a.markMutations,c=a.flush,q=a.handleEvent,s=a.runHandler,u=a.handleMutation,t=a.handleAttributeMutation,v=a.handleCharacterDataMutation,x=a.handleChildListMutation,w=a.DOMNodeInserted,y=a.nodeInserted,m=a.DOMNodeRemoved,z=a.nodeRemoved,B=a.DOMCharacterDataModified,D=a.characterDataModified,F=a.DOMAttrModified,C=a.attributeModified,E=a.isDetachedReactive,G=a.addNodeRemovedListeners,
L=a.removeNodeRemovedListeners;return a}();m.Events=e;e.init()})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Html,l=a.reactive.Events,p=a.reactive.List,g=a.reactive.Node,e=a.typlib.ThreadEnd,d=k.isAncestorOrSelf,b=k.isDetached,k=function(){function a(){}a.select=function(a,c,q){function s(a){"MutationEventsInstalled"===a.type?a=!0:(a="NodeRemoved"==a.type?a.parentNode:a.target,a=(d(c,a)||b(a))&&!h(a));if(a)e.onThreadEnd(n,[],"updateSelected",r)}function n(){var b=$(a,c);q&&(b=b.not(q));r.set(b.get().filter(function(a){return!h(a)}).map(function(a){return new g(a)}))}
var r=(new p).debugName("select("+a+")");n();l.registerAll(s);r.unregisterSelector=function(){l.unregisterAll(s)};return r};a.forEach=function(a){var c=r(a.selector,a.contextNode,a.notSelector);c.list.forEach(a.setup);c.forEach(a.setup,a.tearDown||function(){});return c};a.inComponent=function(a){a.nodeType!=window.Node.ELEMENT_NODE&&(a=a.parentNode);for(;a&&a.parentNode;){if(a.hasAttribute("data-component-json"))return!0;a=a.parentNode}return!1};var r=a.select,h=a.inComponent;return a}();m.Selector=
k})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.List,l=a.reactive.Node,p=a.arrow.Arrow,g=a.reactive.Functions,e=a.reactive.Selector,d=a.reactive.Value,b=a.typlib.Arrays,n=p.arr,r=p.arrI,h=p.arrL,f=p.arrIL,c=p.effect,q=p.constA,s=p.seq,u=p.sum,t=p.list,v=p.is,x=p.isSetR,w=p.notAR,y=p.put,A=p.fromValue,z=p.lazy,p=function(){function a(){}a.isElem=p=v(function(a){return a.nodeType===window.Node.ELEMENT_NODE});a.isAttr=v(function(a){return a.nodeType===window.Node.ATTRIBUTE_NODE});a.isText=m=v(function(a){return a.nodeType===
window.Node.TEXT_NODE});a.setName=function(a){return n(function(c){return c.dupWithNodeName(a)})};a.withName=function(a){return v(function(c){return c.nodeName.toLowerCase()==a.toLowerCase()})};a.mkElem=function(a){return function(c){return s(t(c),n(function(c){return l.Element(a,c)},function(a){a.cleanup()}))}};a.mkElemNonReactive=function(){return n(function(a){return l.Element(a.nodeName,void 0,!0)},function(a){a.cleanup()})}();a.mkElemClass=function(a,c){var b=Array.prototype.slice.call(arguments,
2);return s(C(a)(u.apply(this,b)),S(c))};a.mkElemId=function(a,c){var b=Array.prototype.slice.call(arguments,2);return s(C(a)(u.apply(this,b)),P(c))};a.mkEmptyClass=function(a,c){return E(a,c,H(""))};a.mkEmpty=function(c){return a.mkElem(c)(a.text(""))};a.mkEmptyId=function(a,c){return G(a,c,H(""))};a.mkButton=function(a){return s(L("button"),X(a))};a.mkSubmit=function(a,c){return s(L("input"),M("value",a),M("type","submit"),X(c))};a.mkInput=function(a,c){return s(L("input"),M("value",c||""),M("placeholder",
a||""))};a.mkImg=function(){return L("img")};a.mkText=N=n(function(a){return l.Text(a)});a.text=function(c){return s(q(c),a.mkText)};a.getText=I=n(function(a){return a.textContent?a.textContent:new d});a.modText=function(a){return s(I,n(a),N)};a.getTextDeeply=function(){return s(da(m),I,A)};a.getAttr=function(a){return n(function(c){return c.attributes.get(a)})};a.setAttr=function(a,c){return n(function(b){b.attributes.set(a,c);return b},function(c){c.attributes.set(a,void 0);return c})};a.ignoreAttrs=
function(a){var c=b.slice(arguments);return n(function(a){var b=a.dup();b.attributes=a.attributes.filter(function(a){return!~c.indexOf(a)});return b})};a.setAttrFromState=function(a,c){return r(function(b){b.input.attributes.get(a).is(d.value(b[c]));return b},function(c){c.input.attributes.get(a).unlink()})};a.setClass=function(a){return n(function(c){a instanceof Array?b.any(function(a){return a instanceof d},a)?c.classes().insert(0,a.map(d.value)):c.attributes.get("class").set(a.join(" ")):a instanceof
d?c.classes().push(d.value(a)):c.attributes.get("class").set(a);return c})};a.addClass=function(a){return n(function(c){a instanceof Array?b.any(function(a){return a instanceof d},a)?c.classes().insert(0,a.map(d.value)):c.attributes.get("class").set((a+c.attributes.get("class").get().split(" ")).join(" ")):a instanceof d?c.classes().push(d.value(a)):c.attributes.get("class").set(c.attributes.get("class").get()+" "+a);return c})};a.classSwitch=function(a,b,d){return c(function(c){c.attributes.get("class").is(g.cond(a,
b,d))},function(a){a.attributes.get("class").unlink()})};a.setId=function(a){return M("id",a)};a.setRAttr=function(a,c){return n(function(b){b.attributes.get(a).is(c);return b},function(c){c.attributes.get(a).unlink()})};a.hasAttr=function(a){return s(p,v(function(c){return!!c.attributes.get(a).get()}))};a.hasAttrR=function(a){return s(p,x(function(c){return c.attributes.get(a)}))};a.hasAttrValue=function(a,c){return s(p,v(function(b){return b.attributes.get(a).get()==c}))};a.addEvent=function(a,
c){return r(function(b){b.input.addEventListener(a,function(a){return c.call(b,a,b)});return b})};a.addNodeHandler=function(a,c){return n(function(b){b.addNodeHandler(a,c);return b})};a.addNodeHandlerI=function(a,c){return r(function(b){b.input.addNodeHandler(function(c){return a(c,b)},c?function(a){return c(a,b)}:null);return b})};a.appendNonReactiveNode=function(){return s(y("appendNonReactiveNode_tmp"),a.mkElemNonReactive,a.addNodeHandlerI(function(a,c){$(a).append(c.appendNonReactiveNode_tmp)}))}();
a.nodeHandler=function(a,c){return K(a,c)};a.mousedown=function(a){return J("mousedown",a)};a.click=function(a){return J("click",a)};a.focus=function(a){return J("focus",a)};a.blur=function(a){return J("blur",a)};a.scroll=function(a){return J("scroll",a)};a.keyup=function(a){return J("keyup",a)};a.keydown=function(a){return J("keydown",a)};a.keypress=function(a){return J("keypress",a)};a.enter=function(a){return aa(function(c){13==c.keyCode&&a.call(this,c)})};a.getChildren=ca=h(function(a){var c=
(new k).debugName("getChildren");a.nodeType===window.Node.ELEMENT_NODE&&c.is(a.childNodes);return c},function(a){a.unlink()});a.dup=n(function(a){return a.dup()});a.mkDup=function(a){return s(y("mkDup_orig"),t(a),r(function(a){var c=a.mkDup_orig.dup();c.childNodes=a.input;a.input=c;return a}))};a.clone=n(function(a){return a.clone()});a.select=function(a,c){return f(function(b){var d=c;c&&c.constructor===Function&&(d=function(a,d){return c(a,d,b)});return e.select(a,b.input.node,d)},function(a){a.unregisterSelector()})};
a.selectNoComponent=function(a){return h(function(c){return e.select(a,c.node,".component "+a)},function(a){a.unregisterSelector()})};a.deep=function U(a){return u(a,s(ca,z(U,a)))};a.deepWhen=function R(a,c){return u(c,s(a,ca,z(R,[a,c])))};a.deepNoComponent=function(a){return O(w(W),a)};a.html=function(a){function c(b,f){if(3==b.nodeType&&"$"==b.textContent.get())return f;var h=new k;if(1==b.nodeType)for(var e=0;e<b.childNodes.list.length;e++){var q=c(b.childNodes.list[e],f);switch(q.constructor){case String:h.push(new k([l.Text(q)]));
break;case d:h.push(new k([l.Text(q)]));break;case k:h.push(q);break;case l:h.push(new k([q]));break;default:console.error("Unknown interpolation type '",q.constructor.name,"' in template",a)}}b.childNodes=h.concat();return b}return n(function(b){var d=window.document.createElement("div");d.innerHTML=a;return c(new l(d.firstChild),b)})};a.surround=function(a,c){return s(t(c),Q(a))};a.isComponent=a.hasAttrR("data-component-json");a.mkAnchor=function(){return C("a").apply(this,arguments)};a.mkBr=function(){return C("br").apply(this,
arguments)};a.mkDiv=function(){return C("div").apply(this,arguments)};a.mkEmph=function(){return C("em").apply(this,arguments)};a.mkH1=function(){return C("h1").apply(this,arguments)};a.mkH2=function(){return C("h2").apply(this,arguments)};a.mkH3=function(){return C("h3").apply(this,arguments)};a.mkH4=function(){return C("h4").apply(this,arguments)};a.mkH5=function(){return C("h5").apply(this,arguments)};a.mkItalic=function(){return C("i").apply(this,arguments)};a.mkLi=function(){return C("li").apply(this,
arguments)};a.mkOl=function(){return C("ol").apply(this,arguments)};a.mkPara=function(){return C("p").apply(this,arguments)};a.mkPre=function(){return C("pre").apply(this,arguments)};a.mkStrong=function(){return C("strong").apply(this,arguments)};a.mkTT=function(){return C("tt").apply(this,arguments)};a.mkTable=function(){return C("table").apply(this,arguments)};a.mkTHead=function(){return C("thead").apply(this,arguments)};a.mkTBody=function(){return C("tbody").apply(this,arguments)};a.mkTFoot=function(){return C("tfoot").apply(this,
arguments)};a.mkTd=function(){return C("td").apply(this,arguments)};a.mkTh=function(){return C("th").apply(this,arguments)};a.mkTr=function(){return C("tr").apply(this,arguments)};a.mkUl=function(){return C("ul").apply(this,arguments)};a.mkSpan=function(){return C("span").apply(this,arguments)};a.mkCode=function(){return C("code").apply(this,arguments)};a.mkLabel=function(){return C("label").apply(this,arguments)};a.mkDl=function(){return C("dl").apply(this,arguments)};a.mkDd=function(){return C("dd").apply(this,
arguments)};a.mkDt=function(){return C("dt").apply(this,arguments)};a.mkHr=function(){return C("hr").apply(this,arguments)};a.mkDivClass=function(){return E.apply(this,b.append(["div"],b.slice(arguments)))};a.mkSpanClass=function(){return E.apply(this,b.append(["span"],b.slice(arguments)))};a.mkDivId=function(){return G.apply(this,b.append(["div"],b.slice(arguments)))};a.mkSpanId=function(){return G.apply(this,b.append(["span"],b.slice(arguments)))};a.mkCheckbox=s(a.mkEmpty("input"),a.setAttr("type",
"checkbox"));a.toAnchor=a.setName("a");a.toBr=a.setName("br");a.toDiv=a.setName("div");a.toEmph=a.setName("em");a.toH1=a.setName("h1");a.toH2=a.setName("h2");a.toH3=a.setName("h3");a.toH4=a.setName("h4");a.toH5=a.setName("h5");a.toImg=a.setName("img");a.toItalic=a.setName("i");a.toLi=a.setName("li");a.toOl=a.setName("ol");a.toPara=a.setName("p");a.toPre=a.setName("pre");a.toStrong=a.setName("strong");a.toTT=a.setName("tt");a.toTable=a.setName("table");a.toTHead=a.setName("thead");a.toTBody=a.setName("tbody");
a.toTFoot=a.setName("tfoot");a.toTd=a.setName("td");a.toTh=a.setName("th");a.toTr=a.setName("tr");a.toUl=a.setName("ul");a.toButton=a.setName("button");a.toSpan=a.setName("span");a.toCode=a.setName("code");a.toDl=a.setName("dl");a.toDd=a.setName("dd");a.toDt=a.setName("dt");a.toHr=a.setName("hr");a.isAnchor=a.withName("a");a.isBr=a.withName("br");a.isDiv=a.withName("div");a.isEmph=a.withName("em");a.isH1=a.withName("h1");a.isH2=a.withName("h2");a.isH3=a.withName("h3");a.isH4=a.withName("h4");a.isH5=
a.withName("h5");a.isH6=a.withName("h6");a.isImg=a.withName("img");a.isItalic=a.withName("i");a.isLi=a.withName("li");a.isOl=a.withName("ol");a.isPara=a.withName("p");a.isPre=a.withName("pre");a.isStrong=a.withName("strong");a.isTT=a.withName("tt");a.isTable=a.withName("table");a.isTHead=a.withName("thead");a.isTBody=a.withName("tbody");a.isTFoot=a.withName("tfoot");a.isTd=a.withName("td");a.isTh=a.withName("th");a.isTr=a.withName("tr");a.isUl=a.withName("ul");a.isButton=a.withName("button");a.isSpan=
a.withName("span");a.isCode=a.withName("code");a.isDl=a.withName("dl");a.isDd=a.withName("dd");a.isDt=a.withName("dt");a.isHr=a.withName("hr");var p=a.isElem,m=a.isText,C=a.mkElem,E=a.mkElemClass,G=a.mkElemId,L=a.mkEmpty,N=a.mkText,H=a.text,I=a.getText,M=a.setAttr,S=a.setClass,P=a.setId,J=a.addEvent,K=a.addNodeHandler,X=a.click,aa=a.keypress,ca=a.getChildren,da=a.deep,O=a.deepWhen,Q=a.html,W=a.isComponent;return a}();m.Dom=p})(a.arrow||(a.arrow={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.Arrow,p=a.arrow.Dom,g=a.reactive.Events,e=a.reactive.Node,d=a.reactive.Value,b=a.typlib.Arrays,n=a.typlib.Html,r=l.effect,h=l.seq,f=l.fromValue,c=l.propA,q=l.run,l=function(){function a(c,b,d){var f;this.nodeInsertedHandler=this.nodeInsertedHandler.bind(this);this.attributeModifiedHandler=this.attributeModifiedHandler.bind(this);this.nodeRemovedHandler=this.nodeRemovedHandler.bind(this);if(f=function(a,c,b){this.canvas=a;this.document=c;this.root=
b;this.components=null;this.createReactiveComponentList();this.initializeDocument()}.apply(f||this,arguments))return f}a.register=function(c,b){a.registry[b||c.uri]=c;a.byUri[c.uri]=c};a.init=function(){a.registry={};a.byUri={}};a.registerEvents=function(a){g.register("NodeInserted",a.nodeInsertedHandler);g.register("AttributeModified",a.attributeModifiedHandler);g.register("NodeRemoved",a.nodeRemovedHandler)};a.unregisterEvents=function(a){g.unregister("NodeInserted",a.nodeInsertedHandler);g.unregister("AttributeModified",
a.attributeModifiedHandler);g.unregister("NodeRemoved",a.nodeRemovedHandler)};a.getRelevantComponentForNode=function(a){a=$(a)[0];if(a.component)return a=a.component.get(),a.getRelevantComponent?a.getRelevantComponent():a};a.Registry=a;a.prototype.cleanup=function(){this.components.list.forEach(function(a){a.cleanup&&a.cleanup()});this.components.destruct();this.components.unlink()};a.prototype.createReactiveComponentList=function(){var a=h(p.select("[data-component-uri], [data-tag-uri]"),c("node"),
r(function(a){a.component||(a.component=new d)}),c("component"),f);this.components=q(a,new e(this.root)).name("Registry.components")};a.prototype.initializeDocument=function(){this.repairSubtree(this.root,!1)};a.prototype.nodeInsertedHandler=function(a){a=a.target;a.nodeType===window.Node.ELEMENT_NODE&&this.root&&n.isAncestor(this.root,a)&&this.repairSubtree(a,!0)};a.prototype.attributeModifiedHandler=function(a){a.target.component&&a.target.component.get()||"data-tag-uri"==a.attribute&&this.createTagComponent(a.target,
!0)};a.prototype.nodeRemovedHandler=function(a){function c(a){var d=a.component&&a.component.get();d&&(d.cleanup&&d.cleanup(),a.component.set(void 0));a.childNodes&&b.forEach(a.childNodes,c)}e.isShadowAncestor(this.root,a.target)&&(e.isCleanupDisabled(a.target)||c(a.target))};a.prototype.repairSubtree=function(a,c){if(!(a.component&&a.component.get()||a.nodeType!=window.Node.ELEMENT_NODE||a.doNotRepair)){for(var b=0;b<a.childNodes.length;b++)this.repairSubtree(a.childNodes[b],c);this.createComponentFromDOM(a);
this.createTagComponent(a,c)}};a.prototype.createTagComponent=function(c,b){$(c).attr("data-tag-uri")&&a.registry.tag.createFromXML(c,this.document,this.canvas,b)};a.prototype.createComponentFromDOM=function(c){if(!c.component||!c.component.get()){var b=$(c).attr("data-component-uri");if(b){var d=a.registry[b];d?new d(c,this.document,this.canvas):console.warn("Could not bring component with uri %o alive.",b)}}};return a}();k.Registry=l;l.init()})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||
(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.client.model.CategoryTracking,g=a.client.model.Component,e=a.client.model.Registry,d=a.reactive.Events,b=a.reactive.Node,n=a.reactive.Value,r=a.typlib.CleanupPool,h=a.typlib.Objects,f=function(){function a(d,f){var h;this.makeCloneCache=this.makeCloneCache.bind(this);var q=this;this.setupPreviews=function(){var b=arguments;setTimeout(function(){a.prototype.setupPreviews.apply(q,b)},0)};if(h=function(a,c){this.type="clipboard";this.root=$("<div data-article class=clipboard-document />")[0];
this.section=$("<section class='body' />").appendTo(this.root);this.layout=$("<div class='layout content' />").appendTo(this.section);this.section.append($("<br/>"));this.canvas=a;this.cloneCache=null;this.pool=new r;this.pool.push(this.categoryTracking=new p(this.root,c),this.editing=(new n(!1)).name("ClipboardDocument.editing"));this.pool.push(this.previews=a.clipboard.activeThings.map(function(a){return(a=a&&a.serialized&&$(a.serialized))&&a[0]&&new b(a[0])}).notNull(),this.registry=new e(a,this,
this.root),this.documentTags=this.canvas.currentContentDocument.mapProp("documentTags").name("ClipboardDocument.documentTags"));this.setupEvents();this.setupPreviews()}.apply(h||this,arguments))return h}a.copyAwesomely=function u(a){for(var c=a.cloneNode(!1),b=0;b<a.childNodes.length;b++)c.appendChild(u(a.childNodes[b]));"CANVAS"==c.nodeName&&(b=c.getContext("2d"),c.width=a.width,c.height=a.height,b.drawImage(a,0,0));return c};var f=a.copyAwesomely;a.ClipboardDocument=a;a.prototype.cleanup=function(){e.unregisterEvents(this.registry);
this.pool.cleanup()};a.prototype.setupEvents=function(){e.registerEvents(this.registry);d.installMutationEvents(this.root)};a.prototype.setupPreviews=function(){var a=new b(this.layout[0]);b.connectNodeLists(this.previews,a.childNodes);this.pool.push(this.cloneCache=a.childNodes.map(this.makeCloneCache,function(a){a&&a.cleanup&&a.cleanup()}))};a.prototype.makeCloneCache=function(a){function c(a,b){h=!1;var d=f(a);d.doNotRepair=!0;return{node:d,version:e++,info:g.getInfo(a.component.get()),returnToClipboardCache:function(){this.version>=
e&&(b.clone=this)}}}function b(){h=!0}var d=a.node,h=!0,e=0,n=new r;setTimeout(function(){n.push(g.getMentionedTags(d.component.get()).map(this.documentTags.bindCall("reactiveValueForTagURI")).flat().onchange(b))}.bind(this),0);return{clone:null,get:function(){return!h&&this.clone||(this.clone=c(d,this))},cleanup:function(){n.cleanup()}}};a.prototype.makeDumbClones=function(){return this.cloneCache.list.map(h.call("get"))};a.prototype.giveBackClonesToCache=function(a){a.forEach(h.call("returnToClipboardCache"))};
return a}();l.ClipboardDocument=f})(k.document||(k.document={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Functions,p=a.reactive.Value,g=l.and,e=l.or,l=function(){function a(b,d,r){var h;if(h=function(a,c,b){this.canWrite=c.canWrite;this.canDelete=c.canWriteExplicit;this.editable=b.map(function(a){return!(!a||!a.editing)});this.canCreate=g(a.canEdit,this.canWrite).name("EditFlags.canCreate");this.canEdit=g(this.canCreate,g(this.editable)).name("EditFlags.canEdit");this.forcedEdit=(new p(!1)).name("EditFlags.forcedEdit");this.editMode=(new p(!1)).name("EditFlags.editMode");
this.editing=g(this.canEdit,e(this.editMode,this.forcedEdit)).name("EditFlags.editing")}.apply(h||this,arguments))return h}return a.EditFlags=a}();k.EditFlags=l})(m.editing||(m.editing={}))})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){var g;this.close=this.close.bind(this);if(g=function(){this.node=null;this.body=$("body");this.setupNode()}.apply(g||this,arguments))return g}a.init=function(){a.all=[]};a.registerOpen=function(g){a.all.push(g)};a.closeAll=function(){a.all.forEach(function(a){a.close()});a.all=[]};var p=a.registerOpen;a.Lightbox=a;a.prototype.cleanup=function(){this.close()};a.prototype.setupNode=function(){this.node=$("<div class=lightbox />").append($("<div class=wrapper />").append(this.box=
$("<div class=box />")))};a.prototype.open=function(a,e){p(this);var d={width:window.innerWidth,height:window.innerHeight},b={width:d.width-10,height:d.height-10};this.body.append(this.node).addClass("lightbox");this.box.append(e(d,b)).addClass("box").css("padding",5);this.node.removeClass("dark").removeClass("light").addClass(a).css("top",window.pageYOffset+"px").css("left",window.pageXOffset+"px").css("height",d.height+"px").css("width",d.width+"px")};a.prototype.openForImage=function(a,e){this.open("dark",
function(d,b){return $("<img/>").addClass("image").attr("src",a).attr("alt",e||"").css("max-width",b.width).css("max-height",b.height)});this.node.on("click",this.close)};a.prototype.close=function(){this.body.removeClass("lightbox");this.box.empty();this.node.remove();this.node.off("click",this.close)};a.prototype.box=void 0;return a}();a.Lightbox=k;k.init()})(a.ui||(a.ui={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Functions,l=a.client.editing.Clipboard,p=a.client.model.document.ClipboardDocument,g=a.reactive.Events,e=a.reactive.Node,d=a.reactive.Value,b=a.silk.editing.EditFlags,n=a.typlib.CleanupPool,r=a.ui.Lightbox,h=a.typlib.ThreadEnd,f=k.and,c=k.or,q=k.eq,k=function(){function a(h,e,s){var r;if(r=function(a,h,e){this.pool=new n(this.stashed=(new d).name("Canvas.stashed"),this.document=(new d).name("Canvas.document"),this.routerDocument=(new d).name("Canvas.routerDocument"),
this.newBusy=(new d(!1)).name("Canvas.newBusy"),this.savedWorking=(new d).name("Canvas.savedWorking"),this.currentDocType=this.document.mapProp("type").name("Canvas.currentDocType"),this.inQueryDocument=q(this.currentDocType,"query").name("Canvas.inQueryDocument"),this.currentContentDocument=this.routerDocument.map(function(a){return a&&"content"==a.type?a:void 0}).name("Canvas.currentContentDocument"),this.editFlags=new b(h,a.user,this.document),this.clipboard=new l(this),this.clipboardDocument=
new p(this,a.tagList));this.domain=a;this.setupContainer();this.setupStyleWithoutCSS(this.editFlags);f(c(this.document.bindProp("isNew"),this.document.bindProp("isEmpty")),this.editFlags.canEdit).collapse().onchange(function(a){a&&this.editFlags.editMode.set(!0)}.bind(this));"product"==e&&(a=this.document.bind(function(a){return c(a&&a.dirtyTracking&&a.dirtyTracking.dirty,!1)}),this.editFlags.forcedEdit.is(a))}.apply(r||this,arguments))return r}a.Canvas=a;a.prototype.cleanup=function(){this.pool.cleanup()};
a.prototype.setupContainer=function(){this.root=$("#canvas")[0];new e(this.root);$(this.root).append(this.clipboardDocument.root)};a.prototype.setupStyleWithoutCSS=function(a){d.lift(this.styleWithoutCSS)(a.editing)};a.prototype.styleWithoutCSS=function(a){h.onThreadEnd(function(a){try{a&&window.document.execCommand("styleWithCSS",!1,!1)}catch(c){}}.bind(this),arguments,"styleWithoutCSS",this)};a.prototype.switchDocument=function(a,c){var b=this.document.get();a!=b&&(this.document.set(a),this.routerDocument.set(b&&
c?b:a),a.editing&&a.editing.is(this.editFlags.editing),b&&(c?($(b.root).detach(),b.editing.cleanup(),this.stashed.set(b)):($(b.root).remove(),b.cleanup())),r.closeAll(),a?($(this.root).children(":not(.clipboard-document)").remove(),$(this.root).prepend(a.root),this.showContents(),g.installMutationEvents(a.root),new e(this.root,"repair")):$(this.root).html(""),$(window).scrollTop(0))};a.prototype.popStash=function(){var a=this.stashed.get();a&&(this.switchDocument(a),this.stashed.set())};a.prototype.showContents=
function(){$("#container > *").css("opacity","1")};return a}();m.Canvas=k})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Html,l=function(){function a(){}a.normalizeUri=function(a){return a.replace(/[%\\\/#\?, \(\)\[\]\{\}\xA0-]+/g,"-").replace(/(^-+)|(-+$)/g,"")};a.trimEncodedName=function(a){for(var d=0,b=0;b<a.length&&255>d;)d=32>=a.charCodeAt(b)&&127<=a.charCodeAt(b)||"%"==a.charAt(b)||"."==a.charAt(b)||"/"==a.charAt(b)?d+3:d+1,b++;return a.slice(0,b)};a.toLower=function(a){return a.toLowerCase()};a.toUpper=function(a){return a.toUpperCase()};a.smartToLower=function(a){return 0<
a.length&&a.slice(1).toLowerCase()==a.slice(1)?a.toLowerCase():a};a.encodedSize=function(a){var d=a.replace(/[^\x21-\x7E]|[%/\.]/g,"").length;return d+3*(a.length-d)};a.interpolate=function(a,d){return a.replace(/{#([^}]+)}/g,function(a,e){return d[e]||a})};a.interpolateAsHtml=function(a,d){return a.replace(/{#([^}]+)}/g,function(a,e){return k.escapeHtml(d[e])||a})};a.prettyJoin=function(a){var d=a.length;return 1==d?a[0]:a.slice(0,d-1).join(", ")+" and "+a[d-1]};a.trim=function(a){return a.replace(/(^\s*|\s*$)/g,
"")};a.isWhitespace=function(a){return!!a.match(/^\s*$/)};a.truncate=function(a,d){if(a.length<=d)return a;var b=a.lastIndexOf(" ",d-1);return a.substr(0,-1===b?d-1:b)+"…"};a.prettyCapitalize=function(a){var d="is and of or for the a on in".split(" ");return a.replace(/(^|\s)([^\s]+)/g,function(a,e,r){return e+(""==e||-1==d.indexOf(r)?r[0].toUpperCase()+r.slice(1):r)})};a.prettyEnum=function(a,d){d=d||"and";if(!a||0==a.length)return"";if(1==a.length)return a[0];var b=a.slice(0,-1),n=a[a.length-1];
return b.map(g).join(", ")+" "+d+" "+n};a.prettyEnumMaxItems=function(a,d,b,n){n=n||"and";if(!a||0==a.length)return"";if(1==a.length)return a[0];var r=a.slice(0,-1),h=a[a.length-1];a.length>d&&(r=r.slice(0,d-1),h=a.length-r.length+" "+b);return r.map(g).join(", ")+" "+n+" "+h};a.regexEscape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};a.pluralizer=function(a,d){d||(d="-s");"-"===d.charAt(0)&&(d=a+d.substr(1));return function(b){return 1===b?a:d}};a.dropPrefix=function(a,d){return 0===
d.indexOf(a)?d.substring(a.length):d};var g=a.trim;return a}();m.Strings=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Strings,l=function(){function a(){var g;if(g=function(){this.site=this.cachedJson("site");this.user=this.cachedJson("user/current");this.subscription=this.cachedJson("subscription/current");this.taglist=this.cachedXml("taglist");this.permissionSiteCurrent=this.cachedJson("permission/site/current");this.permissionUserCurrent=this.cachedJson("permission/user/current");this.userStorage=this.cachedJson("user/current/storage")}.apply(g||this,arguments))return g}
a.InitialCache=a;a.prototype.cachedJson=function(a){a=$('script[api-uri="'+a+'"]');if(a[0]&&(a=k.trim(a.html()),""!==a))return JSON.parse(a)};a.prototype.cachedXml=function(a){a=$('script[api-uri="'+a+'"]');if(a[0]&&(a=k.trim(a.html()),""!==a))return $.parseXML(a).firstChild};return a}();m.InitialCache=l})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.Title="http://silk.co/tag/title";a.Uri="http://silk.co/tag/uri";return a}();a.TagUris=k})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(p){var g=a.reactive.Value,e=a.typlib.Strings,d=a.domain.TagUris,b=function(){function a(){}a.parse=function(a,b){if(!Silk.domain.userStorage.enableTagMentionsAndPinning.get())return b;b=e.trim(b);return"~"==b?{mention:d.Title}:"~"==b[0]&&1<b.length?{mention:a.findByNameOrCreate(b.slice(1),!0).uri}:b};a.print=function(a,b){return b&&b.mention?"~"+(b.mention==d.Title?"":a.findByUriOrCreate(b.mention,!0).name):b};a.toValue=function(a,b){return b&&
b.mention?a.bindCall("reactiveValueForTagURI")(b.mention):new g(b)};return a}();p.TagMentioning=b})(l.filter||(l.filter={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.reactive.Node,g=a.typlib.CleanupPool,e=a.typlib.ThreadEnd,d=function(){function a(b,d,f){var c;this.createFrame=this.createFrame.bind(this);this.onload=this.onload.bind(this);this.edit=this.edit.bind(this);if(c=function(a,c,b){this.pool=new g;this.node=null;this.iframe=$();l.linkToNode(this,a,"gist");this.gist=p.node(this.node[0]).attributes.get("data-gist-id");this.file=p.node(this.node[0]).attributes.get("data-gist-file");
this.revision=p.node(this.node[0]).attributes.get("data-gist-revision");this.createFrame();this.pool.push(this.gist.onchange(this.createFrame,!0),this.file.onchange(this.createFrame,!0),this.revision.onchange(this.createFrame,!0))}.apply(c||this,arguments))return c}a.parseGistUrl=function(a){var b=a.match(/.*gist.github.com\/(\d+)(\.js)?(\?file=([^>"]+))?/);if(b&&b[1])return{gistId:b[1],file:b[4],revision:null};if((b=a.match(/.*gist.github.com\/.*?(\d+)(\/([0-9a-fA-F]+))?(#(.*))?/))&&b[1])return{gistId:b[1],
revision:b[3],file:b[5]}};a.configureNode=function(a,b){if(b){var f=d(b.url);if(!f)return;a.attr("data-gist-id",f.gistId);f.file&&a.attr("data-gist-file",f.file);f.revision&&a.attr("data-gist-revision",f.revision)}return a};a.uri=k.Gist;a.info={name:"embed",text:"Gist"};var d=a.parseGistUrl;a.Gist=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.createFrame=function(){e.onThreadEnd(function(){this.node.empty();var a=this.gist.get()||"",b=this.file.get()||"",d=this.revision.get()||
"";this.iframe=$("<iframe/>").attr("src","/s/gist.html?"+[a,b,d].join()).appendTo(this.node);this.iframe.load(this.onload)}.bind(this),arguments,"Gist.createFrame",this)};a.prototype.onload=function(){var a=$(this.iframe[0].contentWindow.document);a.find("a").attr("target","_blank");a=a.find("body > div").height();this.iframe.height(a)};a.prototype.edit=function(){var a=prompt("Enter a new gist URL");if(a){a=d(a);if(!a)return alert("Invalid Gist URL");this.gist.set(a.gistId);this.file.set(a.file);
this.revision.set(a.revision)}};a.prototype.serializeToXML=function(a){return this.node[0].cloneNode(!1)};a.prototype.affectsDirtyState=function(a){return a.target==this.node[0]};return a}();m.Gist=d})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(){}a.publicFileFromCDN=function(a,d,b){b=a.replace(RegExp("(https?://"+d+")?/s/api"),b);var n=/(latest|v[0-9.]*)(\/file\/id\/.*)/,r=/site\/current/,h=/site\/uri/;return n.test(b)?b.replace(n,"$1/site/uri/"+d+"$2"):r.test(b)?b.replace(r,"site/uri/"+d):h.test(b)?b:a};a.publicFileFromCDNInProduct=function(a,d,b){var n=d.uri.get();return a&&d.isPublic.get()?g(a,n,b):a};var g=a.publicFileFromCDN;return a}();a.Image=l})(a.renderui||(a.renderui=
{}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.client.renderui.Image,g=function(){function a(){}a.render=function(a,c,b){a=a.types.image.normalized;var f=window.Silk,f=a.src&&p.publicFileFromCDNInProduct(a.src,f.domain.repository,f.paths.fileCdn),q=r(f)&&h(a);a=d(a,f,q,b);(b=b.targetDocument)&&(a=n(b,a));c.append(a);return a};a.createImageElem=function x(c,d,h,q){var n=$("<img/>"),s=h?f(n,d,-c.left,-c.top,c.width,c.height,c.zoom||100):b(n,c,d),r=q.width&&q.height?a.fitImage(c,s,d,q.width,
q.height,h):s;h?n.error(function(){var a=x(c,d,!1,q);r.replaceWith(a)}):n.error(q.onError);return r};a.createContainers=function(a,c,b){a.attr("src",b);a=t(c.zoom||100).append(a);a=g(c.left,c.top).append(a);return s(c.width,c.height).append(a)};a.withLink=function(a,c){return $("<a/>").attr("href",a).append(c)};a.fitImage=function(a,c,b,d,h,q){var e=d/h,n=a.width/a.height,s=n>e,r=d/a.width,p=h/a.height,l=s?p:r,r=s?r:p,e=Math.abs(e-n)<=(s?1.5:0.1)?l:r,e=e>(s?1.4:1.1)?1:e;d=g(-(a.width*e-d)/2,-(a.height*
e-h)/2);q?(q=e*-a.left,h=e*-a.top,s=e*a.width,n=e*a.height,a=e*(a.zoom||100),"IMG"!==c[0].nodeName&&(c=c.find("img")),c=f(c,b,q,h,s,n,a),d.append(c)):d.append(t(100*e).append(c));return d};a.isInternalImage=function(a){return/\/file\/id\/[0-9,a-f,-]{36}/.test(a)};a.canProcessAtServer=function(a){return a.mimetype?-1!==["image/bmp","image/png","image/jpeg","image/gif"].indexOf(a.mimetype):!0};a.setServerSideProcessing=function(a,b,d,f,h,q,e){var n=0,r=0;0>d&&(n=-d,h-=n,d=0);0>f&&(r=-f,q-=r,f=0);c(a,
b,d,f,h,q,e);return 0<n||0<r?(a=g(n,r).append(a),s(n+h,r+q).append(a)):a};a.setServerSideProcessingHighDPR=function(a,c,b,d,f,h,e){var n=window.devicePixelRatio||1;1!=n&&(a.css("zoom",""+1/n),"Gecko"==$.ua.engine.name&&(a.css("transform","scale("+1/n+")"),a.css("transform-origin","left top")),b*=n,d*=n,f*=n,h*=n,e*=n);a.attr("src",q(c,b,d,f,h,e))};a.serverSideProcessing=function(a,c,b,d,f,h){a=new Uri(a);a.replaceQueryParam("x",""+Math.round(c));a.replaceQueryParam("y",""+Math.round(b));a.replaceQueryParam("width",
""+Math.round(d));a.replaceQueryParam("height",""+Math.round(f));a.replaceQueryParam("zoom",""+Math.round(h));return a.toString()};a.createClipContainer=function(a,c){var b=$("<div class=clip-container />");b.css("width",a+"px");b.css("height",c+"px");return b};a.createOffsetContainer=function(a,c){var b=$("<div class=offset-container />");b.css("left",a+"px");b.css("top",c+"px");return b};a.createZoomContainer=function(a){var c=$("<div class=zoom-container />");c.css("transform-origin","top left");
c.css("transform","scale("+a/100+")");return c};var d=a.createImageElem,b=a.createContainers,n=a.withLink,r=a.isInternalImage,h=a.canProcessAtServer,f=a.setServerSideProcessing,c=a.setServerSideProcessingHighDPR,q=a.serverSideProcessing,s=a.createClipContainer,g=a.createOffsetContainer,t=a.createZoomContainer;return a}();l.Image=g;l=g.render})(k.render||(k.render={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=function(){function a(){}a.fromPath=function(a){return a.map(function(a){return a.a+a.x+","+a.y}).join("")+"Z"};a.downwardTriangle=a.fromPath([{x:0,y:0,a:"M"},{x:32,y:0,a:"L"},{x:16,y:32,a:"L"}]);a.pointLeft=a.fromPath([{x:32,y:0,a:"M"},{x:32,y:32,a:"L"},{x:0,y:16,a:"L"}]);a.pointRight=a.fromPath([{x:0,y:0,a:"M"},{x:0,y:32,a:"L"},{x:32,y:16,a:"L"}]);a.hollowPoint=[{x:0,y:10,a:"M"},{x:5,y:5,a:"L"},{x:16,y:16,a:"L"},{x:27,y:5,a:"L"},{x:32,y:10,a:"L"},
{x:16,y:26,a:"L"}];a.sortDesc=a.fromPath(a.hollowPoint);a.sortAsc=function(){return a.fromPath(a.hollowPoint.map(function(a){return{x:a.x,y:32-a.y,a:a.a}}))}();a.cross=function(g){return a.fromPath([{x:0,y:g,a:"M"},{x:g,y:0,a:"L"},{x:16,y:16-g,a:"L"},{x:32-g,y:0,a:"L"},{x:32,y:g,a:"L"},{x:16+g,y:16,a:"L"},{x:32,y:32-g,a:"L"},{x:32-g,y:32,a:"L"},{x:16,y:16+g,a:"L"},{x:g,y:32,a:"L"},{x:0,y:32-g,a:"L"},{x:16-g,y:16,a:"L"}])};a.defaultCross=a.cross(5);a.settings=function(g){function e(a){return[{x:0,
y:a,a:"M"},{x:32,y:a,a:"L"},{x:32,y:a+g,a:"L"},{x:0,y:a+g,a:"L"}]}var d=[e(0),e(16-g/2),e(32-g)];return a.fromPath(k.concat(d))};a.twitter="M26.492,9.493c-0.771,0.343-1.602,0.574-2.473,0.678c0.89-0.533,1.562-1.376,1.893-2.382c-0.832,0.493-1.753,0.852-2.734,1.044c-0.785-0.837-1.902-1.359-3.142-1.359c-2.377,0-4.306,1.928-4.306,4.306c0,0.337,0.039,0.666,0.112,0.979c-3.578-0.18-6.75-1.894-8.874-4.499c-0.371,0.636-0.583,1.375-0.583,2.165c0,1.494,0.76,2.812,1.915,3.583c-0.706-0.022-1.37-0.216-1.95-0.538c0,0.018,0,0.036,0,0.053c0,2.086,1.484,3.829,3.454,4.222c-0.361,0.099-0.741,0.147-1.134,0.147c-0.278,0-0.547-0.023-0.81-0.076c0.548,1.711,2.138,2.955,4.022,2.99c-1.474,1.146-3.33,1.842-5.347,1.842c-0.348,0-0.69-0.021-1.027-0.062c1.905,1.225,4.168,1.938,6.6,1.938c7.919,0,12.248-6.562,12.248-12.25c0-0.187-0.002-0.372-0.01-0.557C25.186,11.115,25.915,10.356,26.492,9.493";
a.facebook="M25.566,2.433H6.433c-2.2,0-4,1.8-4,4v19.135c0,2.199,1.8,4,4,4h19.135c2.199,0,4-1.801,4-4V6.433C29.566,4.232,27.768,2.433,25.566,2.433zM25.309,16.916h-3.218v11.65h-4.819v-11.65h-2.409V12.9h2.409v-2.411c0-3.275,1.359-5.224,5.229-5.224h3.218v4.016h-2.011c-1.504,0-1.604,0.562-1.604,1.608L22.091,12.9h3.644L25.309,16.916z";a.invite="M20.771,12.364c0,0,0.849-3.51,0-4.699c-0.85-1.189-1.189-1.981-3.058-2.548s-1.188-0.454-2.547-0.396c-1.359,0.057-2.492,0.792-2.492,1.188c0,0-0.849,0.057-1.188,0.397c-0.34,0.34-0.906,1.924-0.906,2.321s0.283,3.058,0.566,3.624l-0.337,0.113c-0.283,3.283,1.132,3.68,1.132,3.68c0.509,3.058,1.019,1.756,1.019,2.548s-0.51,0.51-0.51,0.51s-0.452,1.245-1.584,1.698c-1.132,0.452-7.416,2.886-7.927,3.396c-0.511,0.511-0.453,2.888-0.453,2.888h26.947c0,0,0.059-2.377-0.452-2.888c-0.512-0.511-6.796-2.944-7.928-3.396c-1.132-0.453-1.584-1.698-1.584-1.698s-0.51,0.282-0.51-0.51s0.51,0.51,1.02-2.548c0,0,1.414-0.397,1.132-3.68H20.771z";
a.embed="M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM13.704,19.47l-2.338,2.336l-6.43-6.431l6.429-6.432l2.339,2.341l-4.091,4.091L13.704,19.47zM20.775,21.803l-2.337-2.339l4.092-4.09l-4.092-4.092l2.337-2.339l6.43,6.426L20.775,21.803z";a.upload="M20,3H5v26h22V9L20,3z M24,26H8V6h10v5h6V26z M14,18v5h3v-5h3l-4.5-6L11,18H14z";a.upload2="M3,0 L3,32 L29,32 L29,8.5 L20.5,0 L3,0 L3,0 Z M5,2 L5,30 L27,30 L27,10 L19,10 L19,2 L5,2 L5,2 Z M20,4 L19.875,9 L27,9 L20,2 L20,4 Z M14,26 L18,26 L18,18 L21,18 L16,13 L11,18 L14,18 L14,26 L14,26 Z";
a.linkedin="M27.25,3.125h-22c-1.104,0-2,0.896-2,2v22c0,1.104,0.896,2,2,2h22c1.104,0,2-0.896,2-2v-22C29.25,4.021,28.354,3.125,27.25,3.125zM11.219,26.781h-4v-14h4V26.781zM9.219,11.281c-1.383,0-2.5-1.119-2.5-2.5s1.117-2.5,2.5-2.5s2.5,1.119,2.5,2.5S10.602,11.281,9.219,11.281zM25.219,26.781h-4v-8.5c0-0.4-0.403-1.055-0.687-1.213c-0.375-0.211-1.261-0.229-1.665-0.034l-1.648,0.793v8.954h-4v-14h4v0.614c1.583-0.723,3.78-0.652,5.27,0.184c1.582,0.886,2.73,2.864,2.73,4.702V26.781z";a.email="M28.516,7.167H3.482l12.517,7.108L28.516,7.167zM16.74,17.303C16.51,17.434,16.255,17.5,16,17.5s-0.51-0.066-0.741-0.197L2.5,10.06v14.773h27V10.06L16.74,17.303z";
a.move=function(g,e,d){d=d||g;return a.fromPath([{x:0,y:16,a:"M"},{x:g,y:16-g,a:"L"},{x:d,y:16-e,a:"L"},{x:16-e,y:16-e,a:"L"},{x:16-e,y:d,a:"L"},{x:16-g,y:g,a:"L"},{x:16,y:0,a:"L"},{x:16+g,y:g,a:"L"},{x:16+e,y:d,a:"L"},{x:16+e,y:16-e,a:"L"},{x:32-d,y:16-e,a:"L"},{x:32-g,y:16-g,a:"L"},{x:32,y:16,a:"L"},{x:32-g,y:16+g,a:"L"},{x:32-d,y:16+e,a:"L"},{x:16+e,y:16+e,a:"L"},{x:16+e,y:32-d,a:"L"},{x:16+g,y:32-g,a:"L"},{x:16,y:32,a:"L"},{x:16,y:32,a:"L"},{x:16-g,y:32-g,a:"L"},{x:16-e,y:32-d,a:"L"},{x:16-e,
y:16+e,a:"L"},{x:d,y:16+e,a:"L"},{x:g,y:16+g,a:"L"}])};a.pencil="M3,29 L7.33333333,11.6666667 L16,3 L24.6666667,3 L16,10.5833333 L9.5,13.8333333 L7.98333333,20.3333333 L11.6666667,24.0166667 L18.1666667,22.5 L21.4166667,16 L29,7.33333333 L29,16 L20.3333333,24.6666667 L3,29 Z M14.9166667,17.0833333 L18.1666667,11.6666667 L22.5,7.32719727 L26.8333333,3 L29,5.16666667 L24.6666667,9.5 L20.3333333,13.8333333 L14.9166667,17.0833333 Z";a.scissors="M15.1257211,13.5194287 C19.9153186,11.461965 28.5244069,7.69744527 28.5244069,7.69744527 C28.5244069,7.69744527 27.4714157,6.54018421 26.5392986,6.3420566 C25.6071815,6.14392899 24.053653,5.8137163 22.6209985,6.44263707 C21.188344,7.07155784 21.4273017,6.99799607 17.1293356,8.88475886 C12.7351715,10.8137515 13.5793366,10.3082138 12.3941092,11.3008739 C12.0570032,11.5832094 11.7883288,11.8232408 11.5254585,12.0418461 C9.55719471,11.3961829 7.88583974,11.3340238 7.77407402,10.8082072 C7.64751912,10.2128129 8.89034191,9.94864283 8.38412214,7.56706607 C7.87790237,5.1854893 5.82383571,4.68865324 3.58561828,4.8532539 C1.34740084,5.01785455 0.156304442,7.02770686 0.242496249,8.98647493 C0.328688056,10.945243 2.18137128,11.9969729 3.5507491,12.3281969 C4.92012691,12.659421 6.43898301,12.5672744 8.65427692,13.4214386 C8.74045274,13.4546659 8.82378975,13.4873115 8.90444816,13.5194287 C8.82378975,13.5515459 8.74045274,13.5841915 8.65427692,13.6174188 C6.43898301,14.471583 4.92012691,14.3794364 3.5507491,14.7106605 C2.18137128,15.0418845 0.328688056,16.0936144 0.242496249,18.0523825 C0.156304442,20.0111505 1.34740084,22.0210028 3.58561828,22.1856035 C5.82383571,22.3502041 7.87790237,21.8533681 8.38412214,19.4717913 C8.89034191,17.0902146 7.64751912,16.8260445 7.77407402,16.2306502 C7.88583974,15.7048336 9.55719471,15.6426745 11.5254585,14.9970113 C11.7883288,15.2156166 12.0570032,15.455648 12.3941092,15.7379835 C13.5793366,16.7306436 12.7351715,16.2251058 17.1293356,18.1540985 C21.4273017,20.0408613 21.188344,19.9672996 22.6209985,20.5962203 C24.053653,21.2251411 25.6071815,20.8949284 26.5392986,20.6968008 C27.4714157,20.4986732 28.5244069,19.3414121 28.5244069,19.3414121 C28.5244069,19.3414121 19.9153186,15.5768924 15.1257211,13.5194287 L15.1257211,13.5194287 Z  M6.86158657,8.04308922 C7.13381795,9.32383718 6.27088476,10.5924192 4.93417134,10.8765464 C3.59745792,11.1606736 2.29315045,10.3527528 2.02091907,9.07200486 C1.74868769,7.7912569 2.61162088,6.52267492 3.9483343,6.23854771 C5.28504772,5.95442051 6.58935519,6.76234126 6.86158657,8.04308922 Z M6.86158657,18.9957682 C7.13381795,17.7150202 6.27088476,16.4464382 4.93417134,16.162311 C3.59745792,15.8781838 2.29315045,16.6861046 2.02091907,17.9668525 C1.74868769,19.2476005 2.61162088,20.5161825 3.9483343,20.8003097 C5.28504772,21.0844369 6.58935519,20.2765161 6.86158657,18.9957682 Z";
a.pin="M6.76172206,6.31906564 C6.75946535,6.31664068 6.75832989,6.31542054 6.75832989,6.31542054 C6.75832989,6.31542054 5.33586018,7.65275601 4.27038889,8.64632405 C3.20491761,9.6398921 2.71041466,10.1010236 3.24082096,10.5992835 C3.77122727,11.0975434 7.28902795,11.2011025 7.56312494,11.3490296 C7.83722192,11.4969567 12.3800528,16.931147 12.271145,17.128446 C8.7739612,23.4639934 12.5998478,26.1391685 13.2869038,26.29539 C13.7029079,26.3899802 18.5047494,21.8515242 18.7979949,21.8857963 C19.0912404,21.9200685 26.7241305,28.9608223 27.6569305,29.6665619 C28.208618,30.0839588 28.70077,30.3374849 28.9452001,30.1193847 C25.3992065,26.3244877 20.9788961,21.5836313 17.0191508,17.3339157 C20.983906,21.5782459 25.4065291,26.3169082 28.9452001,30.1193847 C29.1798196,29.890764 28.9612418,29.3821257 28.5833455,28.8026659 C27.9443938,27.8229083 21.4532345,19.7174733 21.4395016,19.4225515 C21.4257687,19.1276296 26.2881288,14.6540718 26.222788,14.2324828 C26.1148736,13.536203 23.6621717,9.58051243 17.0981062,12.6272318 C16.8936909,12.7221115 11.8405535,7.76378959 11.7121068,7.48004142 C11.5836601,7.19629325 11.7257426,3.67983783 11.2656957,3.11596671 C10.8056488,2.5520956 10.3111458,3.01322706 9.24567456,4.0067951 C8.2560215,4.92966152 6.94350623,6.15005411 6.76172208,6.31906567 L6.76172206,6.31906564 Z";
a.gear="M4.30723039,18.7098151 L1.53148627,18.2471911 C0.712367118,18.1106712 0.0483398438,17.3214545 0.0483398438,16.4991673 L0.0483398438,15.5008327 C0.0483398438,14.6719457 0.713369608,13.8891617 1.53148627,13.7528089 L4.30723039,13.2901849 C4.61188672,11.9702942 5.13427287,10.7336986 5.83452792,9.62025925 L4.1943702,7.32403844 C3.71169961,6.64829962 3.80022189,5.62070096 4.38166679,5.03925606 L5.0875959,4.33332694 C5.67370754,3.7472153 6.69746647,3.66395049 7.37237829,4.14603035 L9.68214909,5.79586664 C10.7912743,5.10769712 12.020887,4.59531545 13.332066,4.29764287 L13.8011488,1.48314643 C13.9376686,0.664027275 14.7268853,0 15.5491726,0 L16.5475071,0 C17.3763941,0 18.1591781,0.665029764 18.2955309,1.48314643 L18.768495,4.32093117 C20.0623082,4.62646544 21.2752132,5.14142908 22.3694529,5.82806501 L24.7243014,4.14603035 C25.4000402,3.66335976 26.4276389,3.75188205 27.0090838,4.33332694 L27.7150129,5.03925606 C28.3011245,5.6253677 28.3843894,6.64912663 27.9023095,7.32403844 L26.2105497,9.69250211 C26.8852358,10.7823628 27.3902998,11.9882882 27.6888883,13.2734247 L30.5651934,13.7528089 C31.3843126,13.8893288 32.0483398,14.6785455 32.0483398,15.5008327 L32.0483398,16.4991673 C32.0483398,17.3280543 31.3833101,18.1108383 30.5651934,18.2471911 L27.6888883,18.7265753 C27.3902998,20.0117118 26.8852358,21.2176372 26.2105497,22.3074979 L27.9023095,24.6759616 C28.3849801,25.3517004 28.2964578,26.379299 27.7150129,26.9607439 L27.0090838,27.6666731 C26.4229721,28.2527847 25.3992132,28.3360495 24.7243014,27.8539696 L22.3694529,26.171935 C21.2752132,26.8585709 20.0623082,27.3735346 18.768495,27.6790688 L18.2955309,30.5168536 C18.1590111,31.3359727 17.3697944,32 16.5475071,32 L15.5491726,32 C14.7202855,32 13.9375015,31.3349702 13.8011488,30.5168536 L13.332066,27.7023571 C12.020887,27.4046845 10.7912743,26.8923029 9.68214909,26.2041334 L7.37237829,27.8539696 C6.69663946,28.3366402 5.6690408,28.248118 5.0875959,27.6666731 L4.38166679,26.9607439 C3.79555515,26.3746323 3.71229033,25.3508734 4.1943702,24.6759616 L5.83452792,22.3797407 C5.13427287,21.2663014 4.61188672,20.0297058 4.30723039,18.7098151 Z M16.0483398,23 C19.9143331,23 23.0483398,19.8659932 23.0483398,16 C23.0483398,12.1340068 19.9143331,9 16.0483398,9 C12.1823466,9 9.04833984,12.1340068 9.04833984,16 C9.04833984,19.8659932 12.1823466,23 16.0483398,23 L16.0483398,23 Z";
a.arrowLeft="M22,32 L26,28 L14,16 L26,4 L22,0 L6,16 L22,32 Z";a.arrowRight="M10,32 L6,28 L18,16 L6,4 L10,0 L26,16 L10,32 L10,32 Z";a.link="M16.722665,18.4002811 C17.2411465,17.7317045 17.5483871,16.900611 17.5483871,16 C17.5483871,13.790861 15.6997564,12 13.4193548,12 L7.22580645,12 C4.9454049,12 3.09677419,13.790861 3.09677419,16 C3.09677419,18.209139 4.9454049,20 7.22580645,20 L11.4273626,20 C12.1524089,21.2142204 13.197421,22.2266988 14.4507097,22.9292362 C14.1138588,22.9758712 13.7695155,23 13.4193548,23 L7.22580645,23 L7.22580645,23 C3.23510374,23 0,19.8659932 0,16 C0,12.1340068 3.23510374,9 7.22580645,9 L7.22580645,9 L13.4193548,9 C17.4100575,9 20.6451613,12.1340068 20.6451613,16 C20.6451613,16.9177316 20.4628568,17.7942143 20.1314165,18.5973159 C19.6753838,18.8533982 19.1456871,19 18.5806452,19 C17.8835336,19 17.240221,18.7768574 16.722665,18.4002811 L16.722665,18.4002811 L16.722665,18.4002811 Z M15.2275465,13.669277 C14.709065,14.3378535 14.4018245,15.1689471 14.4018245,16.0695581 C14.4018245,18.2786971 16.2504552,20.0695581 18.5308567,20.0695581 L24.7244051,20.0695581 C27.0048066,20.0695581 28.8534374,18.2786971 28.8534374,16.0695581 C28.8534374,13.8604191 27.0048066,12.0695581 24.7244051,12.0695581 L20.5228489,12.0695581 C19.7978027,10.8553377 18.7527905,9.84285929 17.4995018,9.14032184 C17.8363527,9.09368689 18.180696,9.06955808 18.5308567,9.06955808 L24.7244051,9.06955808 C28.7151078,9.06955808 31.9502115,12.2035648 31.9502115,16.0695581 C31.9502115,19.9355513 28.7151078,23.0695581 24.7244051,23.0695581 L24.7244051,23.0695581 L18.5308567,23.0695581 C14.540154,23.0695581 11.3050503,19.9355513 11.3050503,16.0695581 C11.3050503,15.1518265 11.4873548,14.2753438 11.8187951,13.4722421 C12.2748277,13.2161599 12.8045244,13.0695581 13.3695664,13.0695581 C14.066678,13.0695581 14.7099906,13.2927007 15.2275465,13.669277 L15.2275465,13.669277 L15.2275465,13.669277 Z";
a.paragraph="M8.4375,6.15625 C8.4375,5.23957875 8.69530992,4.38802477 9.2109375,3.6015625 C9.72656508,2.81510023 10.4869741,2.1848982 11.4921875,1.7109375 C12.4974009,1.2369768 13.6874931,1 15.0625,1 C16.0833384,1 17.0286415,1.13541531 17.8984375,1.40625 C18.7682335,1.67708469 19.5078095,2.03906023 20.1171875,2.4921875 C20.7265655,2.94531477 21.1927067,3.44010148 21.515625,3.9765625 C21.8385433,4.51302352 22,5.04687234 22,5.578125 C22,5.99479375 21.8177102,6.36458172 21.453125,6.6875 C21.0885398,7.01041828 20.6770856,7.171875 20.21875,7.171875 C19.7812478,7.171875 19.4401054,7.06510523 19.1953125,6.8515625 C18.9505196,6.63801977 18.6171896,6.27344008 18.1953125,5.7578125 C17.7734354,5.24218492 17.3463563,4.84895969 16.9140625,4.578125 C16.4817687,4.30729031 15.9166702,4.171875 15.21875,4.171875 C14.4166627,4.171875 13.7786482,4.36458141 13.3046875,4.75 C12.8307268,5.13541859 12.59375,5.58333078 12.59375,6.09375 C12.59375,6.62500266 12.796873,7.08072727 13.203125,7.4609375 C13.609377,7.84114773 14.294266,8.29166406 15.2578125,8.8125 C16.221359,9.33333594 16.8593734,9.69270734 17.171875,9.890625 C18.0885462,10.4322944 18.9088505,10.9140604 19.6328125,11.3359375 C20.3567745,11.7578146 21.015622,12.2161434 21.609375,12.7109375 C22.203128,13.2057316 22.6692691,13.7786426 23.0078125,14.4296875 C23.3463559,15.0807324 23.515625,15.8437456 23.515625,16.71875 C23.515625,17.6979216 23.2500027,18.5859335 22.71875,19.3828125 C22.1874973,20.1796915 21.4166717,20.8593722 20.40625,21.421875 C21.812507,22.5885475 22.515625,23.9635338 22.515625,25.546875 C22.515625,26.2968788 22.3567724,27.005205 22.0390625,27.671875 C21.7213526,28.338545 21.2552114,28.9270808 20.640625,29.4375 C20.0260386,29.9479192 19.2968792,30.3437486 18.453125,30.625 C17.6093708,30.9062514 16.6822967,31.046875 15.671875,31.046875 C14.4531189,31.046875 13.380213,30.8828141 12.453125,30.5546875 C11.526037,30.2265609 10.7265659,29.7760445 10.0546875,29.203125 C9.38280914,28.6302055 8.88802242,28.028649 8.5703125,27.3984375 C8.25260258,26.768226 8.09375,26.1718778 8.09375,25.609375 C8.09375,25.0885391 8.28124812,24.6276062 8.65625,24.2265625 C9.03125188,23.8255188 9.49999719,23.625 10.0625,23.625 C10.2812511,23.625 10.502603,23.6692704 10.7265625,23.7578125 C10.950522,23.8463546 11.1145828,23.9531244 11.21875,24.078125 C11.7395859,24.7343783 12.1145822,25.3072892 12.34375,25.796875 C12.9479197,27.1822986 14.0156173,27.875 15.546875,27.875 C16.3906292,27.875 17.0703099,27.6484398 17.5859375,27.1953125 C18.1015651,26.7421852 18.359375,26.2135447 18.359375,25.609375 C18.359375,25.1927063 18.2135431,24.8046893 17.921875,24.4453125 C17.6302069,24.0859357 17.2109402,23.7187519 16.6640625,23.34375 C16.1171848,22.9687481 15.2812556,22.4348993 14.15625,21.7421875 C13.0312444,21.0494757 11.8906308,20.333337 10.734375,19.59375 C10.2968728,19.3020819 9.84375234,18.9921891 9.375,18.6640625 C8.90624766,18.3359359 8.49479344,17.9791686 8.140625,17.59375 C7.78645656,17.2083314 7.50781352,16.7630234 7.3046875,16.2578125 C7.10156148,15.7526016 7,15.1562534 7,14.46875 C7,12.5729072 8.09894734,11.0468808 10.296875,9.890625 C9.05728547,8.82811969 8.4375,7.58334047 8.4375,6.15625 Z M12.40625,11.625 C11.1874939,12.4062539 10.578125,13.2083292 10.578125,14.03125 C10.578125,14.4583355 10.7317693,14.8541648 11.0390625,15.21875 C11.3463557,15.5833352 11.7604141,15.9348941 12.28125,16.2734375 C12.8020859,16.6119809 13.6093695,17.1093717 14.703125,17.765625 C15.0260433,17.9531259 15.4687472,18.2161441 16.03125,18.5546875 C16.5937528,18.8932309 17.1458306,19.2083319 17.6875,19.5 C18.9270895,18.6145789 19.546875,17.8229202 19.546875,17.125 C19.546875,16.7499981 19.4375011,16.4036474 19.21875,16.0859375 C18.9999989,15.7682276 18.7031269,15.4635431 18.328125,15.171875 C17.9531231,14.8802069 17.486982,14.5651059 16.9296875,14.2265625 C16.372393,13.8880191 15.6562544,13.4687525 14.78125,12.96875 C14.0729131,12.562498 13.5416684,12.2578135 13.1875,12.0546875 C12.8333316,11.8515615 12.5729175,11.7083338 12.40625,11.625 Z";
a.image="M2.00174332,6 C0.89621101,6 0,6.90162726 0,8.00086422 L0,26.9991358 C0,28.1041826 0.889261723,29 2.00174332,29 L29.9982567,29 C31.103789,29 32,28.0983727 32,26.9991358 L32,8.00086422 C32,6.89581743 31.1107383,6 29.9982567,6 L2.00174332,6 L2.00174332,6 Z M2,9 L2,11 L30,11 L30,9 L2,9 L2,9 Z M5,4 L5,6 L8,6 L8,4 L5,4 L5,4 Z M21,3 L21,6 L28,6 L28,3 L21,3 L21,3 Z M15.8967285,26.4848633 C19.7627218,26.4848633 22.8967285,23.3508565 22.8967285,19.4848633 C22.8967285,15.61887 19.7627218,12.4848633 15.8967285,12.4848633 C12.0307353,12.4848633 8.89672852,15.61887 8.89672852,19.4848633 C8.89672852,23.3508565 12.0307353,26.4848633 15.8967285,26.4848633 L15.8967285,26.4848633 Z M15.8967285,23.4848633 C18.1058675,23.4848633 19.8967285,21.6940023 19.8967285,19.4848633 C19.8967285,17.2757243 18.1058675,15.4848633 15.8967285,15.4848633 C13.6875895,15.4848633 11.8967285,17.2757243 11.8967285,19.4848633 C11.8967285,21.6940023 13.6875895,23.4848633 15.8967285,23.4848633 L15.8967285,23.4848633 Z";
a.title="M3.03235188,0.000274658203 L3,5.00026365 L13.0372168,5.00026365 L13.0372168,32.0185767 L18.9601928,32.0185767 L18.9601928,4.97945565 L29,4.97945565 L29,0 L3.03235188,0.000274658203 Z";return a}();m.Images=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.DOMSerializer,l=function(){function a(){}a.renderIcon=function(a,d,b,n){d=d||32;b=b||32;n=n||1;var r=g("svg",{xmlns:"http://www.w3.org/2000/svg",width:d,height:b});n=g("g",{transform:"scale("+n+")"});d=g("g",{"fill-rule":"evenodd",transform:"translate("+d/2+","+b/2+")"});a=g("path",{d:a,transform:"translate(-16,-16)"});n.appendChild(a);d.appendChild(n);r.appendChild(d);return $(r)};a.mkSvgEl=function(a,d){var b=window.document.createElementNS("http://www.w3.org/2000/svg",
a),n;for(n in d)b.setAttribute(n,d[n]);return b};a.renderBackground=function(a,d){var b="data:image/svg+xml;charset=utf8,"+encodeURIComponent(k.serializeToString($(d)[0],!0));$(a).css("background-image","url('"+b+"')")};var g=a.mkSvgEl;return a}();m.Svg=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.reactive.Events,g=a.reactive.Node,e=a.typlib.Arrays,d=a.typlib.Images,b=a.typlib.Svg,n=function(){function a(b,d,c){var q;this.onDomChange=this.onDomChange.bind(this);if(q=function(a,c,b){this.canvas=b;this.document=c;if(this.hasBeenDirty=void 0!==$(a).attr("data-dirty"))this.document.dirtyTracking.pinRegionPreviouslyDirty=!0;l.linkToNode(this,a,"pinned");this.node.rAddClass("sublayout");this.setupHeader();
p.registerAll(this.onDomChange)}.apply(q||this,arguments))return q}a.findPinnedParent=function(a){return $(a).parents(l.selectorFor("Pinned"))[0]};a.uri=k.Pinned;a.Pinned=a;a.prototype.cleanup=function(){p.unregisterAll(this.onDomChange)};a.prototype.setupHeader=function(){var a=this.document.categoryTracking.asTag.get();a&&(a=$("<div/>").addClass("header").append(b.renderIcon(d.pin,16,16,0.5)).append($("<span/>").text("Pinned to all "+a.name+" pages")),this.node.prepend(a))};a.prototype.eject=function(a){window.Silk.canvas.document.get().undoManager.startAction("eject");
g.setCleanupDisabled(a[0],!0);this.node.hasClass("top")?a.insertAfter(this.node):a.insertBefore(this.node);this.onDomChange();if((a=a[0].component.get())&&a.onUnpin)a.onUnpin();window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.onDomChange=function(){0==this.node.children(".block:not(.insert-blocks)").length?this.node.hide():this.node.show()};a.prototype.serializeToXML=function(a,b){this.document.dirtyTracking.hasDirtyPinRegion()&&(this.hasBeenDirty=!0);var c=a.serializeChildNodes(this.node.clone(!1)[0],
this.node.children().get(),b);c.children(".header").remove();"autosave"==b&&this.hasBeenDirty?c.attr("data-dirty",""):c.removeAttr("data-dirty");return c};a.prototype.affectsDirtyState=function(a){var b=this.node.find("> [data-component-uri]").toArray(),c=(new g(a.target)).getShadowParents();return 0<=b.indexOf(a.target)||e.contains(b,null,function(a){return-1!=c.indexOf(a)})||$(a.target).is(".block:not(.insert-blocks)")||a.target===this.node[0]&&"class"!=a.attribute?!0:!1};a.prototype.node=null;
return a}();m.Pinned=n})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Events,p=a.reactive.Functions,g=function(){function a(d,b,n,r){var h;this.render=this.render.bind(this);this.jsonChange=this.jsonChange.bind(this);this.onMouseDown=this.onMouseDown.bind(this);this.onMouseUp=this.onMouseUp.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.zoomIn=this.zoomIn.bind(this);this.zoomOut=this.zoomOut.bind(this);this.resetZoom=this.resetZoom.bind(this);this.onStartResize=this.onStartResize.bind(this);this.onStopReize=
this.onStopReize.bind(this);this.onResize=this.onResize.bind(this);this.onResetSize=this.onResetSize.bind(this);var f=this;this.measure=function(){var c=arguments;setTimeout(function(){a.prototype.measure.apply(f,c)},0)};if(h=function(a,b,d,f){this.json=a;this.img=b;this.zoomContainer=this.img.parent();this.offsetContainer=this.zoomContainer.parent();this.clipContainer=this.offsetContainer.parent();this.widget=this.img.closest("[data-component-uri]");this.enabled=d;this.undoManager=f;this.resizing=
this.adjusting=!1;this.minHeight=90;this.geom={x:0,y:0,z:100,w:0,h:190};this.dragState={x:0,y:0};this.resizeState=0;this.setupUI();this.setupEvents();this.jsonOnchange=this.json.onchange(this.jsonChange)}.apply(h||this,arguments))return h}a.Adjusting=a;a.prototype.cleanup=function(){this.enabledOnchange.unlink();this.jsonOnchange.unlink();this.cleanupEvents()};a.prototype.setupUI=function(){this.widget.append(Resource.ImageControls);this.zoomin=this.widget.find(".controls .zoom-in");this.zoomout=
this.widget.find(".controls .zoom-out");this.zoomreset=this.widget.find(".controls .zoom-reset");this.resizeHandle=this.widget.find(".resize-handle")};a.prototype.setupEvents=function(){this.widget.rAddClass(p.cond(this.enabled,"adjustable",""));this.enabledOnchange=this.enabled.onchange(function(a){a?this.installEvents():this.cleanupEvents()}.bind(this))};a.prototype.installEvents=function(){this.img.on("mousedown",this.onMouseDown);$("body").on("mouseup",this.onMouseUp);$("body").on("mousemove",
this.onMouseMove);this.zoomin.on("click",this.zoomIn);this.zoomout.on("click",this.zoomOut);this.zoomreset.on("click",this.resetZoom);this.img.on("click",this.ignore);this.resizeHandle.on("mousedown",this.onStartResize);this.resizeHandle.on("dblclick",this.onResetSize);$("body").on("mouseup",this.onStopReize);$("body").on("mousemove",this.onResize)};a.prototype.cleanupEvents=function(){this.img.off("mousedown",this.onMouseDown);$("body").off("mouseup",this.onMouseUp);$("body").off("mousemove",this.onMouseMove);
this.zoomin.off("click",this.zoomIn);this.zoomout.off("click",this.zoomOut);this.zoomreset.off("click",this.resetZoom);this.img.off("click",this.ignore);this.resizeHandle.off("mousedown",this.onStartResize);this.resizeHandle.off("dblclick",this.onResetSize);$("body").off("mouseup",this.onStopReize);$("body").off("mousemove",this.onResize)};a.prototype.ignore=function(a){a.preventDefault()};a.prototype.serialize=function(a){a.width=this.geom.w;a.height=this.geom.h;a.left=this.geom.x;a.top=this.geom.y;
a.zoom=this.geom.z};a.prototype.deserialize=function(){var a=JSON.parse(this.json.get());a.width&&!a.zoom||this.measure(a.width,a.zoom);this.geom={w:a.width||250,h:a.height||190,x:a.left||0,y:a.top||0,z:a.zoom||100}};a.prototype.render=function(){var a={};this.serialize(a);this.json.set(JSON.stringify(a))};a.prototype.jsonChange=function(a){a&&(this.deserialize(),this.reallyRender())};a.prototype.reallyRender=function(){this.clipContainer.css("width",Math.round(this.geom.w)+"px");this.clipContainer.css("height",
Math.round(Math.max(100,this.geom.h))+"px");this.offsetContainer.css("left",Math.round(this.geom.x)+"px");this.offsetContainer.css("top",Math.round(this.geom.y)+"px");this.zoomContainer.css("zoom",this.geom.z+"%");this.zoomContainer.css("-moz-transform","scale("+this.geom.z/100+")")};a.prototype.unrender=function(){this.geom={w:parseInt(this.clipContainer[0].style.width)||250,h:parseInt(this.clipContainer[0].style.height)||190,x:parseInt(this.offsetContainer[0].style.left)||0,y:parseInt(this.offsetContainer[0].style.top)||
0,z:parseFloat(this.zoomContainer[0].style.zoom)||100}};a.prototype.measure=function(a,b){function e(){if(!a){var n=this.resetAndMeasureClipContainerWidth();n&&(this.geom.w=n,this.render())}!b&&this.img.attr("src")&&(this.img.width()>this.geom.w?this.fullSize():this.originalSize())}l.ignoreMutations(e.bind(this));this.img.load(function(){l.ignoreMutations(e.bind(this))}.bind(this))};a.prototype.resetAndMeasureClipContainerWidth=function(){this.clipContainer[0].style.width="auto";var a=this.clipContainer.width();
a&&(this.clipContainer[0].style.width=a+"px");return a};a.prototype.fixLayout=function(a){a=a||this.resetAndMeasureClipContainerWidth();var b=a/this.geom.w;this.geom.w=a;this.geom.h*=b;this.geom.z*=b;this.geom.x*=b;this.geom.y*=b;l.ignoreMutations(this.render)};a.prototype.onMouseDown=function(a){this.adjusting||(this.adjusting=!0,this.unrender(),this.undoManager.startAction("Image.drag"),this.dragState={x:a.clientX,y:a.clientY},this.widget.addClass("dragging"),a.preventDefault())};a.prototype.onMouseUp=
function(a){this.adjusting&&(this.adjusting=!1,this.undoManager.stopAction(),this.widget.removeClass("dragging"),a.preventDefault())};a.prototype.onMouseMove=function(a){this.adjusting&&(this.geom.x+=a.clientX-this.dragState.x,this.geom.y+=a.clientY-this.dragState.y,this.dragState={x:a.clientX,y:a.clientY},this.render(),a.preventDefault())};a.prototype.zoom=function(a){window.Silk.canvas.document.get().undoManager.startAction("zoom");this.unrender();var b=this.img.width(),e=this.img.height(),r=b*
this.geom.z/100,h=e*this.geom.z/100;this.geom.z*=a;a=e*this.geom.z/100;this.geom.x-=(b*this.geom.z/100-r)/2;this.geom.y-=(a-h)/2;this.render();window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.zoomIn=function(){this.zoom(1.1)};a.prototype.zoomOut=function(){this.zoom(0.9)};a.prototype.resetZoom=function(){window.Silk.canvas.document.get().undoManager.startAction("resetZoom");this.unrender();100!=this.geom.z?this.originalSize():this.fullSize();window.Silk.canvas.document.get().undoManager.stopAction()};
a.prototype.fullSize=function(){var a=this.img.width(),a=this.clipContainer.width()/a,b=this.img.height()*a;this.geom={x:0,y:0,z:100*a,h:b,w:this.geom.w};this.render()};a.prototype.originalSize=function(){this.geom.h=this.img.height();this.geom.x=(this.clipContainer.width()-this.img.width())/2;this.geom.y=0;this.geom.z=100;this.render()};a.prototype.onStartResize=function(a){this.resizing||(this.unrender(),this.undoManager.startAction("Image.resize"),this.resizing=!0,this.widget.addClass("resizing"),
a.preventDefault(),this.resizeState=a.clientY)};a.prototype.onStopReize=function(){this.resizing&&(this.resizing=!1,this.undoManager.stopAction(),this.widget.removeClass("resizing"))};a.prototype.onResize=function(a){this.resizing&&(this.geom.h+=a.clientY-this.resizeState,this.geom.h=Math.max(this.minHeight,this.geom.h),this.render(),this.resizeState=a.clientY)};a.prototype.onResetSize=function(){this.unrender();this.widget.hasClass("empty")||(this.geom.y=0,this.geom.h=this.img.height()*this.geom.z/
100,this.render())};a.prototype.enabledOnchange=void 0;a.prototype.resizeHandle=void 0;a.prototype.zoomin=void 0;a.prototype.zoomout=void 0;a.prototype.zoomreset=void 0;return a}();k.Adjusting=g})(m.image||(m.image={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.domain.TagUris,p=a.typlib.Arrays,g=a.typlib.CleanupPool,e=a.typlib.Objects,d=a.reactive.Value,b=function(){function a(){var c;if(c=function(){this.pool=new g;this.selects=[];this.byRole={};this.pool.push(this.byRole.collection=(new d([],p.equals)).name("Roles.collection"),this.byRole.column=(new d([],f)).name("Roles.column"),this.byRole.numeric=(new d([],f)).name("Roles.numeric"),this.byRole.auxnumeric=(new d([],f)).name("Roles.auxnumeric"),this.byRole.location=
(new d([],f)).name("Roles.location"),this.byRole.link=(new d([],f)).name("Roles.link"),this.byRole.distribution=(new d([],f)).name("Roles.distribution"),this.byRole.image=(new d([],f)).name("Roles.image"),this.byRole.description=(new d([],f)).name("Roles.description"),this.byRole.order=(new d([],f)).name("Roles.order"),this.byRole.group=(new d([],f)).name("Roles.group"),this.byRole.maxslices=(new d([],p.equals)).name("Roles.maxslices"),this.proxy=d.toReactiveObject(this.byRole))}.apply(c||this,arguments))return c}
a.eqTags=function(a,b){return p.equals(a,b)};a.isPageTitle=function(c){return b(c,a.PageTitle)};a.eqRelation=function(a,d){return!e.differ(a,d,["relation"])&&b(a.relation,d.relation)};a.eqRelations=function(a,b){return p.equals(a,b,h)};a.empty={collection:[],column:[],numeric:[],auxnumeric:[],location:[],link:[],distribution:[],image:[],description:[],order:[],group:[],maxslices:[]};a.tagRoles="column numeric auxnumeric location link image distribution description order group".split(" ");a.PageTitle=
[l.Title];a.PageUri=[l.Uri];var b=a.eqTags,h=a.eqRelation,f=a.eqRelations;a.Roles=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.resetAllExcept=function(){var c=p.slice(arguments),b=this.byRole;e.keys(a.empty).forEach(function(d){-1==c.indexOf(d)&&b[d].set(a.empty[d])})};a.prototype.add=function(a,b){this.set(a,this.byRole[a].get().concat([b]))};a.prototype.set=function(a,b){this.byRole[a].set(p.uniqueBy(b,h))};a.prototype.allTagRoles=function(){var c=this.proxy.get();return c?
p.concatMap(a.tagRoles,e.lookupIn(c)):[]};return a}();k.Roles=b})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.query.Roles,p=a.reactive.List,g=a.reactive.Value,e=a.typlib.Arrays,d=a.typlib.CleanupPool,b=a.typlib.Functions,n=a.typlib.Objects,r=function(){function a(c){var b;this.parseMention=this.parseMention.bind(this);this.getMentionedTagsForFilter=this.getMentionedTagsForFilter.bind(this);this.resolveMentions=this.resolveMentions.bind(this);this.resolveRange=this.resolveRange.bind(this);this.resolveValues=this.resolveValues.bind(this);if(b=function(a){this.pool=
new d;this.canvas=a;this.setupFilterParsers();this.pool.push(this.raw=new p([]));this.pool.push(this.resolved=this.raw.map(function(a){return a.bind(this.resolveMentions)}.bind(this)),this.activeUnresolved=this.raw.flat().mapValue(e.filter(s)),this.activeResolved=this.resolved.flat().mapValue(e.filter(s)),this.activeOrPinnedUnresolved=this.raw.flat().mapValue(e.filter(t)),this.activeOrPinnedResolved=this.resolved.flat().mapValue(e.filter(t)),this.mentionedTags=this.setupMentionedTags(),this.missingTags=
this.setupMissingTags(),this.noTagsMissing=this.missingTags.map(function(a){return!a||0===a.length}))}.apply(b||this,arguments))return b}a.mkFilter=function(a,c,b,d,f){a={type:a};c?a.relation=c:(a.relation=l.PageTitle,console.warn("Filters.mkFilter: didn't get a relation."));a.pin=!!b;if(void 0!==d)switch(a.type){case "range":a.from=d;a.to=f;break;case "enum":a.values=d;break;case "matches":a.values=d;break;case "equals":a.values=d;break;case "nonempty":a.enabled=d}return a};a.mkVar=function(a){a=
new g(a,v);a.modify=q;return a};a.customModify=function(a){this.set(a(n.cloneObject(this.get())))};a.mkRef=function(a,b,d,h,q){return c(f(a,b,d,h,q))};a.isActive=function(a){if(a)switch(a.type){case "range":return!(void 0===a.from&&void 0===a.to);case "enum":return!(!a.values||!a.values.length);case "matches":return!(!a.values||!a.values.length);case "equals":return!(!a.values||!a.values.length);case "nonempty":return!!a.enabled}};a.isPinned=function(a){return a&&!!a.pin};a.isUnpinnedSuggestion=function(a){return a&&
!r(a)&&!s(a)};a.isActiveOrPinned=function(a){return a&&r(a)||s(a)};a.eqFilter=function(a,c){if(!a)return!c;if(!c)return!a;if(a.type!=c.type||!e.equals(a.relation,c.relation)||a.pin!=c.pin)return!1;switch(a.type){case "range":return a.from==c.from&&a.to==c.to;case "enum":case "equals":case "matches":return e.equals(a.values,c.values);case "nonempty":return!!a.enabled==!!c.enabled}return!0};a.eqFilters=function(a,c){return e.equals(a,c,v)};a.extendBy=function(a,c){return function(){return $.extend({},
c,a.apply(null,arguments))}};var f=a.mkFilter,c=a.mkVar,q=a.customModify,s=a.isActive,r=a.isPinned,t=a.isActiveOrPinned,v=a.eqFilter,x=a.extendBy;a.Filters=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.setupMentionedTags=function(){return this.raw.map(this.getMentionedTagsForFilter).lift(b.compose(e.notNull,e.unique,e.concat))};a.prototype.setupMissingTags=function(){var a=this.canvas.domain.tagList.findByUriOrCreateWithoutSaving,c=this.canvas.currentContentDocument.bind(function(a){return a&&
a.documentTags.presentTagUris.toList()});return g.lift(function(c,d){return c&&d?c.filter(b.not(b.partial(e.contains,d))).map(a):[]})(this.mentionedTags.toList(),c)};a.prototype.setupFilterParsers=function(){var a={parse:this.resolveRange,getMentions:this.getStringsFromRange},c={parse:this.resolveValues,getMentions:this.getStringsFromValues};this.mentionResolvers={range:a,numeric:a,matches:c,equals:c,"enum":c}};a.prototype.parseMention=function(a){function c(b){return b&&b.documentTags.reactiveValueForTagURI(a.mention)}
return a&&a.mention?this.canvas.currentContentDocument.bind(c):new g(a)};a.prototype.getMentionedTags=function(){return this.mentionedTags};a.prototype.getMentionedTagsForFilter=function(a){a=a.get();var c=this.mentionResolvers[a.type];return c?e.notNull(c.getMentions(a).map(function(a){return void 0===a?void 0:a.mention})):[]};a.prototype.getStringsFromRange=function(a){return[a.from,a.to]};a.prototype.getStringsFromValues=function(a){return a.values||[]};a.prototype.resolveMentions=function(a){if(void 0!==
a){var c=this.mentionResolvers[a.type];return s(a)&&c?c.parse(a):new g(a)}};a.prototype.resolveRange=function(a){return this.extendProps(["from","to"],function(a,c){return{from:a,to:c}},a)};a.prototype.resolveValues=function(a){return this.extendArray("values",function(a){return{values:a?e.notNull(a):[]}},a)};a.prototype.extendArray=function(a,c,b){return p.sequence(b[a].map(this.parseMention)).map(x(c,b))};a.prototype.extendProps=function(a,c,d){return g.lift(x(c,d)).apply(null,a.map(b.compose(this.parseMention,
n.lookupIn(d))))};return a}();k.Filters=r})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Functions,p=function(){function a(){}a.mostInformationDense=function(a){return a.sort(e)[0]};a.compare=l.compareAsEnum("video image currency date year numeric geo textual".split(" "));a.compareAsGeo=l.compareAsEnum("geo textual video image year date numeric currency".split(" "));a.isCastableTo=function(a,b){return-1!={year:["numeric","textual"],date:["year","numeric","textual"],currency:["numeric","textual"],numeric:["textual"],geo:["textual"],
image:[],textual:[]}[a].indexOf(b)};a.isUsableIn=function(a,b){return-1!={year:["date","numeric"],date:["year"],currency:["numeric"],numeric:["currency","year"],image:["video"],video:["image"],geo:[],textual:[]}[a].indexOf(b)};var e=a.compare;return a}();k.Types=p})(m.typing||(m.typing={}))})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.domain.typing.Types,p=a.typlib.Arrays,g=a.typlib.Objects,e=a.typlib.Strings,d=function(){function a(){var b;if(b=function(){this.types={textual:{fraction:0,accuracy:1}};this.tagUris=[];this.tagNames=[];this.contexts=[]}.apply(b||this,arguments))return b}a.normalizeTagUri=function(a){function b(a){return a.replace(".silkapp.com$",".silk.co").replace(".silk$",".co")}if(!a)return"";a=a.replace(/[!'()]/g,escape).replace(/\*/g,"%2A");var d=-1==a.indexOf("/"),
c=new Uri(a.toLowerCase());c.setHost(b(c.host()));var q=!d&&!!c.host();if(!q&&c.path().match(/^\/tag\//))return c.path();if(q)return c.host()==b(window.location.host)?c.path():c.toString();if(d)return"/tag/"+c.toString();console.warn("Tag.js: tag URI not recognized as either absolute or relative URI, using it as is",a);return a};a.normalizeTagName=function(a,b){return!a||e.isWhitespace(a)?e.prettyCapitalize(decodeURIComponent(b.slice(b.lastIndexOf("/")+1))):a};a.fromNode=function(d,h){var f=new a;
f.parseFromNode(d,h);return f};a.fromTag=function(d,h,f){var c=new a;c.parseFromTag(d,h,f);return c};a.emptyContext=function(){return new a};var d=a.normalizeTagUri;a.Context=a;a.prototype.parseFromNode=function(a,b){this.parseTypes(a);this.parseTagUris(a);this.computeTagNames(a,b)};a.prototype.parseFromTag=function(a,b,d){this.types=a;this.tagUris=[b];this.tagNames=[d]};a.prototype.parseTypes=function(a){this.types={};for(var b=0;b<a.attributes.length;b++){var d=a.attributes[b].nodeName.match(/^data-normalized-(.*)/);
d&&(this.types[d[1]]=JSON.parse($(a).attr(d[0])))}};a.prototype.parseTagUris=function(a){this.tagUris=p.notNull($("div",a).get().map(function(a){return(a=$(a).attr("href"))&&d(a)}))};a.prototype.computeTagNames=function(d,h){function f(a){return window.Silk.domain.tagList.findByUriOrCreate(a,!0)}d=$(d);var c=d.text();this.tagUris.length?(c=d.children("div").get().map(function(a){return $(a).text()}),this.tagNames=p.zipWith(function(c,d){return a.normalizeTagName(c,d)},c,this.tagUris),this.contexts=
[f(this.tagUris[0]).types]):h&&"Document"==c?(h=h.map(f),this.contexts=p.mapProp(h,"types"),this.tagNames=[h.length?e.prettyEnum(p.mapProp(h,"name")):"Page"]):(this.tagNames=[c],"Last Modification Date"===c&&(this.tagUris=["modification date"]))};a.prototype.isInContext=function(a){var b=this,d=g.keys(this.types).sort(l.compare).filter(function(a){return 0.5<b.types[a].accuracy&&0.5<b.types[a].fraction}),c=d[0],d=c&&c!==a?d.filter(function(c){return l.isUsableIn(a,c)}).length?a:"textual":a;return this.inContexts(d)};
a.prototype.is=function(a){a=this.types[a];return!!(a&&0.25<a.accuracy)};a.prototype.eligibleAsNumber=function(){var a=this.types.numeric,b=a?a.fraction:0,d=a?a.accuracy:0,a=d*b,b=(d=this.types.currency)?d.fraction:0,d=d?d.accuracy:0;return Math.max(a,d*b)};a.prototype.mostLikely=function(){var a=g.keyValues(this.types).filter(function(a){return 0.5<a[1].fraction}).filter(function(a){return 0.5<a[1].accuracy}).map(p.idx(0)).sort(l.compare);return this.inContexts(a.length?a[0]:"textual")};a.prototype.inContexts=
function(a){for(var b=0;b<this.contexts.length;b++)a=this.contexts[b].isInContext(a);return a};return a}();k.Context=d})(m.typing||(m.typing={}))})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.query.Filters,p=a.client.query.Roles,g=a.domain.TagUris,e=a.domain.typing.Context,d=a.reactive.HashMap,b=a.reactive.Value,n=a.typlib.CleanupPool,r=a.typlib.Functions,h=a.typlib.Objects,f=a.typlib.Strings,c=Strict.Pickler,q=function(){function a(){var c;this.onSerializedChange=this.onSerializedChange.bind(this);this.onJsonChange=this.onJsonChange.bind(this);this.updateUri=this.updateUri.bind(this);this.onUriChange=this.onUriChange.bind(this);if(c=
function(){this.pool=new n;this.json=(new d(v())).name("Data.json");this.resolvedFilters=(new b([])).name("Data.resolvedFilters");this.uri=(new b([])).name("Data.uri");this.fullUri=(new b("")).name("Data.fullUri");this.serialized=(new b("")).name("Data.serialized");this.pool.push(this.json,this.uri,this.serialized,this.json.flat().onchange(this.onJsonChange,!0),b.onchange(this.updateUri,!0)(this.resolvedFilters,this.json.flat()),this.serialized.onchange(this.onSerializedChange,!0),this.uri.onchange(this.onUriChange,
!0))}.apply(c||this,arguments))return c}a.Views={table:"http://typlab.com/2010/components/querytable",list:"http://typlab.com/2010/components/list",grid:"http://typlab.com/2010/components/pagegrid",map:"http://typlab.com/2010/components/googleviz/map",groupby:"http://typlab.com/2010/components/groupby",barchart:"//silk.co/2014/widget/queryiew/silkviz/barchart/1",columnchart:"//silk.co/2014/widget/queryiew/silkviz/barchart/1",piechart:"//silk.co/2014/widget/queryiew/silkviz/piechart/1",donutchart:"//silk.co/2014/widget/queryiew/silkviz/donutchart/1",
linechart:"//silk.co/2014/widget/queryiew/silkviz/linechart/1",scatterplot:"//silk.co/2014/widget/queryiew/silkviz/scatterplot/1",stackchart:"//silk.co/2014/widget/queryiew/silkviz/stackchart/1"};a.ByUri={"http://typlab.com/2010/components/querytable":"table","http://typlab.com/2010/components/list":"list","http://typlab.com/2010/components/pagegrid":"grid","http://typlab.com/2010/components/googleviz/map":"map","http://typlab.com/2010/components/groupby":"groupby","//silk.co/2014/widget/queryiew/silkviz/barchart/1":"barchart",
"//silk.co/2014/widget/queryiew/silkviz/piechart/1":"piechart","//silk.co/2014/widget/queryiew/silkviz/donutchart/1":"donutchart","//silk.co/2014/widget/queryiew/silkviz/linechart/1":"linechart","//silk.co/2014/widget/queryiew/silkviz/scatterplot/1":"scatterplot","//silk.co/2014/widget/queryiew/silkviz/stackchart/1":"stackchart"};a.pView=c.bimap(h.lookupIn(a.Views),h.lookupIn(a.ByUri),c.oneOf(h.keys(a.Views)));a.pAbsoluteTag=function(){return c.guards(function(a){return 0===a.indexOf("http://")},
c.bimap(function(a){return"http://"+(-1<a[1].indexOf(".")?a[1]:a[1]+"."+Silk.paths.loginHost)+"/tag/"+encodeURIComponent(a[0])},function(a){a=a.slice(7).split("/");var c=a[0].replace(RegExp("."+f.regexEscape(Silk.paths.loginHost)+"$"),"");return[decodeURIComponent(a[2]),c]},c.tuple(c.any,c.prefixI("on",c.any))))}();a.pRelativeTag=function(){return c.bimap(function(a){return e.normalizeTagUri("/tag/"+encodeURIComponent(a))},function(a){return decodeURIComponent(a.split("/")[2]).toLowerCase()},c.any)}();
a.pTag=c.msum([a.pAbsoluteTag,a.pRelativeTag]);a.pRelation=c.sep1I("for",a.pTag);a.pAsBoolean=function(a){return c.bimap(function(){return!0},function(){return a},c.tokenI(a))};a.pRelationOrDocument=function(b){var d=c.bimap(r.constant([g.Title]),r.constant("always fails since not equal to 'document'"),c.tokenI("document"));return c.named("relation",c.msum([d,a.pRelation]),b)};a.pOrder=c.named("direction",c.oneOfI(["asc","desc"]),a.pRelationOrDocument(c.obj));a.pGroup=function(){return c.prefixI("by",
a.pRelationOrDocument(c.msum([c.prefixI("size",c.named("groupSize",c.bimap(function(a){a=parseInt(a);return isNaN(a)?10:a},function(a){return""+a},c.any),c.obj)),c.obj])))}();a.pSlice=function(){return c.withDefault(function(a){return 0==a.offset&&200==a.count},c.option({offset:0,count:200},c.bimap(function(a){var c=parseInt(a.offset);a=parseInt(a.count);c=isNaN(c)?0:c;a=isNaN(a)?200:a;return{offset:c,count:a}},function(a){return{offset:a.offset.toString(),count:a.count.toString()}},c.prefixI("slice",
c.named("offset",c.any,c.named("count",c.any,c.obj))))))}();a.pMaxslices=function(){return c.bimap(function(a){a=parseInt(a);return isNaN(a)?"all":a},function(a){return""+a},c.any)}();a.pRoles=c.named("collection",c.many(c.prefixI("collection",a.pTag)),c.named("column",c.many(c.prefixI("column",a.pRelationOrDocument(c.obj))),c.named("numeric",c.many(c.prefixI("numeric",a.pRelationOrDocument(c.obj))),c.named("auxnumeric",c.many(c.prefixI("auxnumeric",a.pRelationOrDocument(c.obj))),c.named("location",
c.many(c.prefixI("location",a.pRelationOrDocument(c.obj))),c.named("link",c.many(c.prefixI("link",a.pRelationOrDocument(c.obj))),c.named("image",c.many(c.prefixI("image",a.pRelationOrDocument(c.obj))),c.named("description",c.many(c.prefixI("description",a.pRelationOrDocument(c.obj))),c.named("distribution",c.many(c.prefixI("distribution",a.pRelationOrDocument(c.obj))),c.named("order",c.many(c.prefixI("order",a.pOrder)),c.named("group",c.many(c.prefixI("group",a.pGroup)),c.named("maxslices",c.many(c.prefixI("maxslices",
a.pMaxslices)),c.obj))))))))))));a.pOfType=function(a,b){return c.prefixI(a,c.guards(function(c){return c.type==a},c.bimap(function(c){c.type=a;return c},r.id,b)))};a.pFilterValues=c.named("values",c.sep1I("or",c.any),c.obj);a.pMatchesFilter=function(b){return a.pOfType("matches",a.pRelationOrDocument(b?a.pFilterValues:c.obj))};a.pEqualsFilter=function(b){return a.pOfType("equals",a.pRelationOrDocument(b?a.pFilterValues:c.obj))};a.pEnumFilter=function(b){return a.pOfType("enum",a.pRelationOrDocument(b?
a.pFilterValues:c.obj))};a.pNonEmptyFilter=function(b){return c.bimap(function(a){a.enabled="no"!==a.enabled;return a},function(a){return a},a.pOfType("nonempty",a.pRelationOrDocument(c.obj)))};a.pRangeFilter=function(b,d){var f=c.bimap(function(a){return{relation:a.relation,from:"-"==a.from?void 0:a.from,to:"-"==a.to?void 0:a.to}},function(a){return{relation:a.relation,from:void 0===a.from?"-":a.from.toString(),to:void 0===a.to?"-":a.to.toString()}},c.named("from",c.any,c.named("to",c.any,c.obj)));
return a.pOfType(d,a.pRelationOrDocument(b?f:c.obj))};a.pFilters=function(){function b(d){return c.prefixI("filter",c.msum([a.pRangeFilter(d,"numeric"),a.pRangeFilter(d,"range"),a.pEnumFilter(d),a.pEqualsFilter(d),a.pMatchesFilter(d),a.pNonEmptyFilter()]))}var d=c.msum([c.guards(function(a){return!l.isPinned(a)},b(!0)),c.guards(function(a){return l.isPinned(a)&&l.isActive(a)},c.bimap(function(a){a.pin=!0;return a},r.id,c.prefixI("pin",b(!0)))),c.guards(function(a){return l.isPinned(a)&&!l.isActive(a)},
c.bimap(function(a){a.pin=!0;return a},r.id,c.prefixI("suggestion",b(!1))))]);return c.many(d)}();a.pUri=c.named("view",a.pView,c.named("roles",a.pRoles,c.named("filters",a.pFilters,c.named("slice",a.pSlice,c.obj))));a.uriToJson=function(a){return c.parser(t,a,function(a){console.warn("failed to parse explore URI, expected:",c.showError(a))},r.id)};a.jsonToUri=function(a){a=$.extend(!0,v(),a);return c.printer(t,a,function(b){console.warn("failed to print explore URI, json:",a,"expected:",c.showError(b));
return[]},r.id)};a.emptyJson=function(){return{view:null,roles:$.extend(!0,{},p.empty),filters:[],slice:{offset:0,count:200}}};var q=a,t=a.pUri,v=a.emptyJson;a.Data=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.fromJson=function(a){var c=$.extend(!0,{},q.emptyJson(),a),b;for(b in a)this.json.set(b,c[b])};a.prototype.onSerializedChange=function(a){if(a){try{var c=JSON.parse(a)}catch(b){console.warn("QueryViewer.Data","unable to parse JSON",a,b)}this.fromJson(c)}};a.prototype.onJsonChange=
function(a){a&&a.view&&a.filters&&a.roles&&a.roles.collection&&this.serialized.set(JSON.stringify(a))};a.prototype.updateUri=function(a,c){if(c&&c.view&&c.roles&&c.roles.collection&&a){var b=h.merge(c,{filters:a});this.uri.set(q.jsonToUri(b))}};a.prototype.onUriChange=function(a){a&&this.fullUri.set("/"+a.map(encodeURIComponent).join("/"))};return a}();k.Data=q})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.query.Data,p=a.typlib.Arrays,g=a.typlib.Functions,e=a.typlib.Strings,d=function(){function a(){}a.allCategoriesForTag=function(a,c){return a.sortedDocLevelTags.list.filter(function(a){return q([c],a).length})};a.ofType=function(a,c){return c.filter(function(c){return c.types.is(a)})};a.notOfType=function(a,c){return c.filter(function(c){return!c.types.is(a)})};a.mostCommonOfType=function(a,c){return r(a,c).sort(function(a,c){return c.count-a.count})[0]};
a.mostLikelyOfType=function(a,c,b){return s(r(a,q(h(c),b)).slice(0,1))};a.allTagsByCount=function(a){return a.tags.list.sort(function(a,c){return c.count-a.count})};a.allInlineTagsByCount=function(a){return a.inlineLevelTags.list.sort(g.comparing(function(a){return-(a.count-a.docLevelCount.get())}))};a.allDocTagsByCount=function(a){return a.sortedDocLevelTags.list};a.tagsNotOfType=function(a,c){return a.filter(function(a){return a.types.mostLikely()!=c})};a.tagsOfType=function(a,c){return a.filter(function(a){return a.types.mostLikely()==
c})};a.uris=function(a){return a.map(function(a){return a.uri})};a.enums=function(a){a.filter(function(a){return a.isEnum()})};a.forCategory=function(a,c){return a.filter(function(a){return a.context.get(c&&c.uri)}).filter(function(a){return!a.docLevelCount.get()})};a.names=function(a){return p.unique(a.map(function(a){return e.trim(a.name)}))};a.significant=function(a){var c=a.filter(function(a){return 1<a.count});return 5<c.length?c:a};a.tagsForQueryViewType=function(a,b){var d=[],q=b.match(/\/([^\/]+)$/)[1];
b.match("silkviz/linechart")||b.match("silkviz/barchart")||b.match("silkviz/stackchart")||b.match("silkviz/scatterplot")?d=v(a):b.match("silkviz/piechart")||b.match("silkviz/donutchart")?d=p.concat(v(a),c(h(a))):0<=["map"].indexOf(q)?d=f(h(a),"geo"):0<=["querytable","list","pagegrid"].indexOf(q)&&(d=[]);return t(d)};a.defaultQueryViewData=function(a,c,b){var f=u(a,c).slice(0,1),q=c.match(/\/([^\/]+)$/)[1];b||(b=f.length?d(a,f[0])[0]:null,null==b&&0<=["querytable","list","pagegrid"].indexOf(q)&&(b=
a.sortedDocLevelTags.list[0]));a=l.emptyJson();a.view=c;a.slice="list"==q||"querytable"==q?{offset:0,count:10}:"pagegrid"==q?{offset:0,count:9}:{offset:0,count:200};b&&(a.roles.collection=[b.uri]);return a};a.defaultInlineSort=function(a){return a.sort(g.comparing(function(a){return-(a.count-a.docLevelCount.get())/a.arity}))};a.defaultNumericQuery=function(a){a=h(a);a=p.concat(["numeric","currency","year","date"].map(g.partial(f,a)));return t(a)};var d=a.allCategoriesForTag,r=a.ofType,h=a.allTagsByCount,
f=a.tagsOfType,c=a.enums,q=a.forCategory,s=a.names,u=a.tagsForQueryViewType,t=a.defaultInlineSort,v=a.defaultNumericQuery;return a}();k.Suggestions=d})(m.tagging||(m.tagging={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=a.typlib.Html,p=a.reactive.Events,g=a.reactive.Value,e=function(){function a(c){var b;this.elementMoved=this.elementMoved.bind(this);if(b=function(a){this.el=$(a);this.pos=(new g({x1:null,x2:null,w:null,y1:null,y2:null,h:null})).name("ObjectTracking.pos");this.elementMoved();e();r(this.elementMoved)}.apply(b||this,arguments))return b}a.install=function(){b.listeners||(b.listeners=[],$(window).bind("resize scroll",f),p.registerAll(f))};a.trackElement=
function(a){b.listeners.push(a)};a.removeTrackElement=function(a){k.remove(b.listeners,a)};a.elementMovedMaybe=function(){var a=arguments;b.listeners.map(function(b){b.apply(null,a)})};a.listeners=null;var b=a,e=a.install,r=a.trackElement,h=a.removeTrackElement,f=a.elementMovedMaybe;a.ObjectTracking=a;a.prototype.cleanup=function(){this.el=null;this.pos.cleanup();h(this.elementMoved)};a.prototype.elementMoved=function(){if(l.isDetached(this.el[0])||!this.el.is(":visible"))this.pos.set();else{var a=
this.el.offset(),b=Math.round(a.left),a=Math.round(a.top),d=Math.round(this.el.outerWidth()),f=Math.round(this.el.outerHeight()),h=b+d,e=a+f;this.pos.get();this.pos.set({x1:b,x2:h,w:d,y1:a,y2:e,h:f})}};return a}();m.ObjectTracking=e})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=a.reactive.ObjectTracking,p=function(){function a(b,c,d,h,e){var n;this.startShowing=this.startShowing.bind(this);this.close=this.close.bind(this);this.updateArrow=this.updateArrow.bind(this);this.position=this.position.bind(this);if(n=function(a,c,b,d,f){this.target=d;f.arrowWidth=f.arrowWidth||8;f.arrowHeight=f.arrowHeight||8;f.position=f.position||"bottom";f.padding=void 0===f.padding?30:f.padding;f.elementPadding=void 0===f.elementPadding?0:f.elementPadding;
this.container=$("<div/>").addClass("bubble-container");f.containerClass&&this.container.addClass(f.containerClass);this.content=$(a).addClass("bubble-content");this.width=c;this.height=void 0===b?50:b;this.options=f;this.arrow=$("<div/>").addClass("bubble-arrow").addClass("bubble-arrow-"+f.position);this.tracker=new l(this.target);this.onShow=f.onShow||function(){};b&&this.content.css("height",b);this.content.css("width",c);this.content.appendTo(this.container);this.arrow.appendTo(this.container);
f.delay?setTimeout(this.startShowing,f.delay):this.startShowing()}.apply(n||this,arguments))return n}a.f=function(a,c,b,d,h,e,n){a+=b;Math.round(b/2);c+=Math.round(d/2);h=a+h;b=h+e;e=h+Math.round(e/2);d=c-Math.round(n/2);n=c+Math.round(n/2);return{x1:h,xm:e,x2:b,y1:d,ym:c,y2:n}};a.fLeft=function(a,c,b,d,h,e,n){Math.round(b/2);c+=Math.round(d/2);b=a-h-e;a-=h;e=b+Math.round(e/2);h=c-Math.round(n/2);n=c+Math.round(n/2);return{x1:b,xm:e,x2:a,y1:h,ym:c,y2:n}};a.clamp=function(a,c,b){return Math.max(c,
Math.min(b,a))};a.shift=function(a,c,d,h,e,n,g){var r=$(document).scrollLeft(),l=$(document).scrollTop(),p=c.y2-c.y1;a={x1:c.x1,xm:c.xm,x2:c.x2,y1:c.y1,ym:c.ym,y2:c.y2};var k=Math.round((c.x2-c.x1)/2)-n;n=Math.round(p/2)-n;"top"==g||"bottom"==g?(h=b(-c.x1+r+e,0,k),a.x1+=h,a.x2+=h,c=b(c.x2-r-d+e,0,k),a.x1-=c,a.x2-=c):(d=b(-c.y1+l+e,0,n),a.y1+=d,a.y2+=d,c=b(c.y2-l-h+e,0,n),a.y1-=c,a.y2-=c);return a};a.transpose=function(a){return{x1:a.y1,xm:a.ym,x2:a.y2,y1:a.x1,ym:a.xm,y2:a.x2}};a.hover=function(b,
c,d,h,e,n){function r(){clearTimeout(m);m=null}function l(){clearTimeout(k);k=null;m=setTimeout(function(){p.bubble&&(p.bubble.close(),p.bubble=null)},n.stopTimeout||1200)}var p={bubble:null},k=null,m=null;$(b).hover(function(b){if(!n.predicate||n.predicate(b))r(),k=setTimeout(function(){p.bubble||(p.bubble=new a(c,d,h,e||b.target,n),$(p.bubble.container).hover(r,l))},n.startTimeout||400)},l);return p};a.click=function(a,c,b,d,e,n,g,r){r=h(c,b,d,e,n,g,r);$(a).click(function(a){n.predicate&&!n.predicate(a)||
r.startOrStop(a)});return r};a.popup=function(a,c,b,d,e,n,g){g=h(a,c,b,d,e,n,g);g.startOrStop();return g};a.create=function(b,c,d,h,e,n,r){function l(){r.bubble&&(n&&n(r.bubble),r.bubble.close(),r.bubble=null,$(window).off("click",m),$(document).off("keydown",p))}function p(a){27==a.keyCode&&l()}function m(n){if(n&&r.bubble)n=$(n.target).parents(),k.last(n)!=window.document.documentElement||n.filter(r.bubble.container).length||l();else{var t="function"==typeof b?b():b;r.bubble=new a(t,c,d,h||n.target,
e);r.close=l;setTimeout(function(){$(window).on("click",m);$(document).on("keydown",p)})}}r=r||{};r.bubble=null;r.close=null;r.startOrStop=m;return r};var e=a.f,d=a.fLeft,b=a.clamp,n=a.shift,r=a.transpose,h=a.create;a.Bubble=a;a.prototype.startShowing=function(){if(null!==this.container){var a=!0;this.tracker.elementMoved();this.tracker.pos.collapse().onchange(function(c){if(!c)return this.close();c=this.position(c);a&&this.container&&(this.onShow(),this.container.css("opacity",0),this.container.appendTo(window.document.body),
a=!1,this.animateShow(this.container,c))}.bind(this))}};a.prototype.animateShow=function(a,c){var b={opacity:1};"top"==c.pos?(a.css("top",c.top+10),b.top="-=10"):"bottom"==c.pos?(a.css("top",c.top-10),b.top="+=10"):"left"==c.pos?(a.css("left",c.left+10),b.left="-=10"):"right"==c.pos&&(a.css("left",c.left-10),b.left="+=10");this.container.animate(b)};a.prototype.close=function(){if(this.container){var a=this.container;a.animate({opacity:0},100,function(){a.detach()});this.tracker.cleanup();this.container=
null}};a.prototype.updateArrow=function(a){this.arrow.removeClass("bubble-arrow-top bubble-arrow-bottom bubble-arrow-right bubble-arrow-left");this.arrow.addClass("bubble-arrow-"+a)};a.prototype.position=function(a){if(this.container){var c=a.x1,b=a.y1,h=a.w,g=a.h,t=this.options.arrowHeight+this.options.elementPadding,v=this.width,l=this.height,p=this.options.position;"horizontally-smart"===p&&(p=c>$(window).width()-c-h?"left":"right",this.updateArrow(p));var k;"right"==p?k=e(c,b,h,g,t,v,l):"bottom"==
p?k=r(e(b,c,g,h,t,l,v)):"left"==p?k=d(c,b,h,g,t,v,l):"top"==p&&(k=r(d(b,c,g,h,t,l,v)));k=n(a,k,$(window).width(),$(window).height(),this.options.padding,this.options.arrowWidth+8,p);this.container.css("left",k.x1);this.container.css("top",k.y1);this.container.css("width",k.x2-k.x1);this.container.css("height",k.y2-k.y1);a=this.options.arrowWidth;c=this.options.arrowHeight;b=this.arrow;"right"==p?(b.css("top",k.ym-k.y1-a),b.css("left",-c),b.css("border-width",a+"px "+c+"px "+a+"px 0")):"bottom"==p?
(b.css("top",-c),b.css("left",k.xm-k.x1-a),b.css("border-width","0 "+a+"px "+c+"px "+a+"px")):"left"==p?(b.css("top",k.ym-k.y1-a),b.css("left",k.x2-k.x1),b.css("border-width",a+"px 0 "+a+"px "+c+"px")):"top"==p&&(b.css("top",k.y2-k.y1),b.css("left",k.xm-k.x1-a),b.css("border-width",c+"px  "+a+"px  0 "+a+"px"));return{left:k.x1,top:k.y1,pos:p}}};return a}();m.Bubble=p})(a.ui||(a.ui={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Arrays,p=a.typlib.Strings,g=a.typlib.Functions,e=a.reactive.Value,d=a.typlib.ThreadEnd,b=function(){function a(d,f){var c;this.defocus=this.defocus.bind(this);this.docKeydown=this.docKeydown.bind(this);this.keydown=this.keydown.bind(this);this.input=this.input.bind(this);this.documentClick=this.documentClick.bind(this);this.click=this.click.bind(this);this.mouseover=this.mouseover.bind(this);this.mouseout=this.mouseout.bind(this);this.render=this.render.bind(this);
this.position=this.position.bind(this);if(c=function s(a,c){this.area=$(a);this.mode=c||s.Popup;this.node=null;this.visible=c==b.Fixed;this.items=(new e([])).name("Selectbox.items");this.visibleItems=[];this.selection=0;this.preHoverState=null;this.maxWidth=350;this.minWidth=70;this.hOffset=this.vOffset=this.hScale=0;this.onSelect=g.nop;this.onFilter=this.filterLabelByInput.bind(this,!0);this.onHover=g.nop;this.onRender=b.renderItem;b.pickers.push(this);this.checkMode();this.setupNode();this.registerEvents()}.apply(c||
this,arguments))return c}a.init=function(){b.pickers=[]};a.renderItem=function(a,b){var c=$("<div class=item>");a.html?c.rHtml(e.value(a.html)):c.rText(e.value(a.label));return c};a.Popup="popup";a.Fixed="fixed";var b=a;a.Selectbox=a;a.prototype.checkMode=function(){this.mode!=a.Popup&&this.mode!=a.Fixed&&console.error("Selectbox: unsupported mode:",this.mode)};a.prototype.setupNode=function(){this.node=$("<div class='selectbox'/>");this.node.addClass(this.mode)};a.prototype.registerEvents=function(){this.area.on("input",
this.input);this.area.on("keydown",this.keydown);this.node.on("mousedown","div",this.click);this.node.on("mouseover","div",this.mouseover);this.node.on("mouseout","div",this.mouseout);this.node.on("keydown",this.keydown);this.mode==a.Popup&&(this.area.on("blur",this.defocus),this.area.on("focus",this.input),$(document).on("click",this.documentClick),$(window).on("resize",this.position),$(document).on("scroll",this.position),$(document).on("keydown",this.docKeydown))};a.prototype.deregisterEvents=
function(){this.area.off("input",this.input);this.area.off("keydown",this.keydown);this.node.off("mousedown","div",this.click);this.node.off("mouseover","div",this.mouseover);this.node.off("mouseout","div",this.mouseout);this.node.off("keydown",this.keydown);this.mode==a.Popup&&(this.area.off("blur",this.defocus),this.area.off("focus",this.input),$(document).off("click",this.documentClick),$(window).off("resize",this.position),$(document).off("scroll",this.position),$(document).off("keydown",this.docKeydown))};
a.prototype.cleanup=function(){this.deregisterEvents()};a.prototype.defocus=function(a){this.close()};a.prototype.docKeydown=function(a){if(this.visible)switch(a.keyCode){case 27:return a.preventDefault(),this.close()}};a.prototype.keydown=function(a){if(this.visible)switch(a.keyCode){case 38:return a.preventDefault(),this.arrowUp(a);case 40:return a.preventDefault(),this.arrowDown(a);case 13:case 9:return a.preventDefault(),this.select(a)}};a.prototype.input=function(){this.render()};a.prototype.documentClick=
function(a){a=$(a.target).parents().addBack();a.is(this.area)||a.is(this.node)||this.defocus()};a.prototype.click=function(a){this.select(a);this.close()};a.prototype.arrowUp=function(a){this.moveUpOrDown(a,-1);return!1};a.prototype.arrowDown=function(a){this.moveUpOrDown(a,1);return!1};a.prototype.moveUpOrDown=function(a,b){null!==this.selection&&(this.setSelection(this.selection+b),a.preventDefault(),this.focusSelection(this.selection))};a.prototype.mouseover=function(a){this.preHoverState={selection:this.selection,
value:this.area.val()};this.setSelection($(a.target).index());this.renderSelection();if(this.onHover)this.onHover(a.target.__item)};a.prototype.mouseout=function(a){if(this.preHoverState){if(this.onHover)this.onHover(null);this.preHoverState=null}};a.prototype.open=function(){this.visible||this.mode!=a.Popup||(b.pickers.filter(function(a){return a!=this}.bind(this)).forEach(function(a){a.close()}),$("body").append(this.node),this.visible=!0,this.node.__picker=this,this.position())};a.prototype.close=
function(){this.visible&&this.mode==a.Popup&&(this.visible=!1,this.node.detach())};a.prototype.clear=function(){this.items.set([]);this.visible&&this.render()};a.prototype.addItems=function(a){a.forEach(function(a){this.items.set(this.items.get().concat(a))}.bind(this));this.visible&&this.render()};a.prototype.addItem=function(a,b){this.items.set(this.items.get().concat({label:a,item:void 0===b?a:b}));this.visible&&this.render()};a.prototype.select=function(a){if(null!==this.selection)return this.onSelect(this.visibleItems[this.selection],
a,this),!1};a.prototype.setSelection=function(a){this.selection=this.normalizeSelection(a)};a.prototype.filterLabelByInput=function(a,b){var c=/[^\w-]+/,d=this.area.val().toLowerCase(),e=d.split(c).map(function(a){return RegExp("^"+p.regexEscape(a),"i")}),n=!1,g=b.filter(function(a){a=a.label.toLowerCase();a==d&&(n=!0);var b=a.split(c);return l.all(function(a){return l.any(function(c){return c.match(a)},b)},e)});return a&&n?[]:g};a.prototype.render=function(){d.onThreadEnd(function(){if(this.mode!=
b.Popup||window.document.activeElement==this.area[0])this.visibleItems=this.onFilter(this.items.get()),this.node.empty(),this.visibleItems.forEach(function(a,b){var c=this.onRender(a,b);c[0].__item=a;this.node.append(c)}.bind(this)),this.renderSelection(),this.position(),0==this.visibleItems.length||1==this.visibleItems.length&&this.visibleItems[0].label==this.area.val()?this.close():this.open()}.bind(this),arguments,"Selectbox.render",this)};a.prototype.renderSelection=function(){d.onThreadEnd(function(){this.node.children("div").removeClass("selected");
null!==this.selection&&(this.selection=this.normalizeSelection(this.selection),$(this.node.children("div").get(this.selection)).addClass("selected"))}.bind(this),arguments,"Selectbox.renderSelection",this)};a.prototype.normalizeSelection=function(a){return null===a?null:Math.max(0,Math.min(this.visibleItems.length-1,a))};a.prototype.focusSelection=function(a){if(a=this.node.children("div").get(this.selection)){var b=this.node.scrollTop(),c=b+this.node.height();a.offsetTop<b&&this.node.scrollTop(a.offsetTop-
4);a.offsetTop+$(a).height()>c&&this.node.scrollTop(a.offsetTop-this.node.height()+$(a).height());setTimeout(this.renderSelection.bind(this),0)}};a.prototype.position=function(){if(this.mode==a.Popup){if(!this.area.length)return this.close();var b=this.area.offset(),d=Math.min(this.maxWidth,this.area[0].offsetWidth),c=this.area.height(),e=void 0===this.hScale?parseInt(this.node.css("padding")||6,10):this.hScale;this.node.css("left",b.left-e+this.hOffset+"px");d=Math.min(this.maxWidth,d+2*e);d=Math.max(this.minWidth,
d);this.node.css("width",d+"px");var d=this.node.children("div").map(function(a,c){return $(c).height()}),d=l.sum($.makeArray(d)),d=Math.min(400,d),s=$(window).scrollTop(),e=s+$(window.document.defaultView).height(),b=b.top,c=b+c,s=b-s-50,g=e-c-50;e-c>d?(this.node.css("max-height","400px"),this.node.css("top",c+this.vOffset+"px")):g>s?(this.node.css("max-height",g+"px"),this.node.css("top",c+this.vOffset+"px")):(s>d?this.node.css("max-height",d+"px"):this.node.css("max-height",s+"px"),this.node.css("top",
b-this.node.height()-10+"px"))}};return a}();k.Selectbox=b;b.init()})(m.input||(m.input={}))})(a.ui||(a.ui={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Strings,l=function(){function a(){}a.asUTC=function(a){return a.getUTCFullYear()+"-"+e(a.getUTCMonth())+"-"+e(a.getUTCDate())+" "+e(a.getUTCHours())+":"+e(a.getUTCMinutes())+":"+e(a.getUTCSeconds())+"."+a.getUTCMilliseconds()+" UTC"};a.currentTimeInUTC=function(){return g(new Date)};a.toISOString=function(a){return a.getUTCFullYear()+"-"+e(a.getUTCMonth()+1)+"-"+e(a.getUTCDate())+" "+e(a.getUTCHours())+":"+e(a.getUTCMinutes())+":"+e(a.getUTCSeconds())+"Z"};
a.txtToStandardizedTxts=function(a,e){a=a.trim();var h=[];if(a){var f=new Date,c,q=function(a,c){var b=[];if((c=c?" "+c.toUpperCase():"")&&0==a.indexOf("'"))return b;var d=1*a.replace(/\D/g,"");!c&&100>d&&(d+=2E3,d<f.getFullYear()+5?(b.push(""+d),b.push(""+(d-100))):(b.push(""+(d-100)),b.push(""+d)));-1==a.indexOf("'")&&b.push(""+a+c);return b},s=[],g=[],t=[];if(c=a.match(/^(\'?\d\d|\d+)\s*(bc)?$/i))t=q(c[1],c[2]);else if(c=a.match(RegExp("^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)\\s+(\\'?\\d\\d|\\d+)\\s*(bc)?$",
"i")))g=d(c[1]),t=q(c[2],c[3]);else if(c=a.match(/^(01|02|03|04|05|06|07|08|09|1|2|3|4|5|6|7|8|9|10|11|12)\s*\/\s*(\'?\d\d|\d+)\s*(bc)?$/i))g=d(c[1]),t=q(c[2],c[3]);else if(c=a.match(RegExp("^(1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31)\\s+(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)\\s+(\\'?\\d\\d|\\d+)\\s*(bc)?$","i")))s=b(c[1]),g=d(c[2]),t=q(c[3],c[4]);else if(c=a.match(RegExp("^(01|02|03|04|05|06|07|08|09|1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31)\\s*-\\s*(01|02|03|04|05|06|07|08|09|1|2|3|4|5|6|7|8|9|10|11|12)\\s*-\\s*(\\'?\\d\\d|\\d+)\\s*(bc)?$",
"i")))s=b(c[1]),g=d(c[2]),t=q(c[3],c[4]);else if(c=a.match(RegExp("^(01|02|03|04|05|06|07|08|09|1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31)\\s*/\\s*(01|02|03|04|05|06|07|08|09|1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31)\\s*/\\s*(\\'?\\d\\d|\\d+)\\s*(bc)?$","i")))s=b(c[2],c[1]),g=d(c[1],c[2]),t=q(c[3],c[4]);else if(c=a.match(RegExp("^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)\\s+(1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31|1st|2nd|3rd|4th|5th|6th|7th|8th|9th|10th|11th|12th|13th|14th|15th|16th|17th|18th|19th|20th|21st|22nf|23rdh|24th|25th|26th|27th|28th|29th|30th|31st)\\s+(\\'?\\d\\d|\\d+)\\s*(bc)?$",
"i")))s=b(c[2]),g=d(c[1]),t=q(c[3],c[4]);for(c=0;c<t.length;c++)if(g.length)for(q=0;q<g.length;q++){var v=(s[q]?s[q]+" ":"")+(g[q]?g[q]+" ":"")+t[c];g[q]&&("February"!=g[q]||29>s[q]||29==(new Date(v)).getDate())&&h.push(v)}else h.push(t[c])}return h};a.pad=function(a){return 10>a?"0"+a:a};a.getMonths=function(){Array.prototype.slice.call(arguments,0);for(var a=[],b=0;b<arguments.length;b++){var d=arguments[b].toLowerCase(),f=[null,"January","February","March","April","May","June","July","August",
"September","October","November","December"],c={jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December"},e=parseInt(d);isNaN(e)?c[d]?a.push(c[d]):a.push(k.prettyCapitalize(d)):a.push(f[e])}return a};a.getDays=function(){Array.prototype.slice.call(arguments,0);for(var a=[],b=0;b<arguments.length;b++)a.push(parseInt(arguments[b].replace(/\D/g,"")));return a};var g=a.asUTC,e=a.pad,d=a.getMonths,b=a.getDays;
return a}();m.Dates=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(){}a.install=function(){for(var a=window._gaq=window._gaq||[],b=f(),d=window.location.toString().match(/:\/\/(.[^\/]+)/)[1].replace("www.",""),n,r=0;r<b.length;r++)if(0<=d.indexOf(b[r])){n=b[r];break}n||(n=d);a.push(function(){g.googleAnalyticsActivated=!0});a.push(["b._setAccount","UA-9661842-4"],["b._setAllowLinker",!0],["b._setDomainName",n]);for(r=0;r<b.length;r++)a.push(["b._addIgnoredRef",b[r]]);a.push(["b._setSiteSpeedSampleRate",
10]);e(h(window.location.pathname));(function(){var a=window.document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==window.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js";var c=window.document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c)})()};a.trackUser=function(a){a.canWrite.onchange(b)};a.trackPageview=function(a){window._gaq.push(["b._trackPageview",a])};a.trackMetrics=function(a,b){b&&a.forEach(d)};a.trackMetric=function(a){var b=
a.action.split("-");if(!(2>b.length)){a=b[0];var d=b[1],b=2<b.length?b.slice(2).join("-"):void 0;window._gaq.push(["b._trackEvent",a,d,b])}};a.trackUserType=function(a){void 0!==a&&window._gaq.push(["b._setCustomVar",1,"User Type",a?"editor":"viewer",3])};a.installGlobalLinkHandlers=function(){window._gaq.push(r)};a.isCrossDomain=function(a){if(!a)return!1;var b=f();if(!b||!b.length)return!1;a=a.match(/:\/\/(.[^\/]+)/);var d=!1;if(!a)return!1;var e=window.location.toString().match(/:\/\/(.[^\/]+)/)[1].replace("www.",
""),h=a[1].replace("www.","");if(0>e.indexOf(h))return $.each(b,function(a,c){return h.match(c)?(d=!0,!1):!0}),d};a.cleanUrl=function(){$(window).load(function(){window.history.replaceState&&window.history.replaceState({},window.document.title,h(window.location.href))})};a.linkCrossDomain=function(a,b){if(b){var d=window._gat._getTrackerByName()._getLinkerUrl(a);window.open(d,b)}else window._gaq.push(["b._link",a])};a.installLinkHandlers=function(){$(window.document.body).on("click","a",function(a){n(this.href)&&
(a=window._gat._getTrackerByName()._getLinkerUrl(this.href),!0===a&&(a=this.href),$(this).attr("href",a))})};a.gaq_StrippedUrl=function(a){a=a.replace(/__utm.*&?/,"");a.match(/\?.+/)||(a=a.replace("?",""));return a};a.gaq_CrossDomains=function(){var a=window.SILK_DEBUGGING?[(new Uri(window.location.href)).host().split(".").slice(1).join(".")]:[];return["silk.co","innovation.attentionusa.com","www.edmbase.org","data.newzoo.com"].concat(a)};a.googleAnalyticsActivated=!1;var g=a,e=a.trackPageview,d=
a.trackMetric,b=a.trackUserType,n=a.isCrossDomain,r=a.installLinkHandlers,h=a.gaq_StrippedUrl,f=a.gaq_CrossDomains;return a}();a.GoogleAnalytics=l})(a.tracking||(a.tracking={}))})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(){}a.install=function(a,d){window.ga||(function(a,d,e,h,f){a.GoogleAnalyticsObject=f;a[f]=a[f]||function(){(a[f].q=a[f].q||[]).push(arguments)};a[f].l=(new Date).getTime();var c=d.createElement(e);d=d.getElementsByTagName(e)[0];c.async=1;c.src=h;d.parentNode.insertBefore(c,d)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),window.ga("create",d,a),g.trackPageview())};a.trackPageview=function(a){window.ga&&
window.ga("send","pageview",a&&{page:a})};var g=a;return a}();a.CustomGoogleAnalytics=l})(a.tracking||(a.tracking={}))})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Dates,p=a.typlib.Objects,g=a.typlib.Strings,e=function(){function a(){}a.install=function(){window.mixpanel.init(window.SILK_DEBUGGING?"3da01913e59ad3b16b2edbc1376a4823":"49ea43cdaf406ab6a97f9f6ff5367dff");var a=window.Silk&&window.Silk.paths,b=window.location;a&&b.hostname&&a.loginHost&&!b.hostname.match(RegExp(a.loginHost+"$"))&&window.mixpanel.set_config({cross_subdomain_cookie:!1})};a.disableTracking=function(){window.SILK_DEBUGGING||(b.isTrackingDisabled=
!0)};a.trackUser=function(a,d,f,g){if(window.mixpanel&&!b.isTrackingDisabled){var t=window.mixpanel;d=d&&d.silk_signup_action;a&&a.uuid?("full"==d||"user"==d?t.alias(a.uuid):t.identify(a.uuid),t.people.set({$name:a.name,$email:a.email,$created:l.toISOString(a.created),$last_login:l.toISOString(new Date),"Last Collection":location.hostname}),t.register({$name:a.name,$email:a.email,"Last Collection":location.hostname}),t.name_tag(a.name+" ("+a.email+")"),t.register_once({$created:l.toISOString(a.created),
"Initial Landing":e()}),"www.silk.co"!=location.hostname&&t.register_once({"Initial Collection":location.hostname}),h(d,g)):t.register_once({"Initial Landing":e(),"Initial Referrer Path":r()});f&&(0===location.pathname.indexOf("/signup")?(t.track("Viewed Signup Page",{"Site only":!$("input[name='email']").length}),t.register({"Pre-signup":r()})):t.track("Viewed Website Page",{Page:location.pathname}))}};a.getLanding=function(){return location.href.split("?")[0]};a.getReferrer=function(){var a=window.document.referrer;
return a?a.split("?")[0]:null};a.trackSignupActions=function(a,b){var d="full"==a||"user"==a,f="full"==a||"site"==a;d&&window.mixpanel.track("User Signup",{site:location.host,withSite:f});f&&window.mixpanel.track("Site Created",{site:location.host,newUser:d,repository:b?b.privacy:null})};a.trackPageview=function(a){window.mixpanel&&!b.isTrackingDisabled&&window.mixpanel.track_pageview(a)};a.trackMetrics=function(a){window.mixpanel&&!b.isTrackingDisabled&&a.forEach(f)};a.trackMetric=function(a){if(window.mixpanel&&
!b.isTrackingDisabled){var d=p.cloneObject(a.parameters);d.site=a.repository;d.source=a.source;a=g.prettyCapitalize(a.action.replace(/\-/g," "));window.mixpanel.track(a,d)}};a.isTrackingDisabled=!1;var b=a,e=a.getLanding,r=a.getReferrer,h=a.trackSignupActions,f=a.trackMetric;return a}();k.Mixpanel=e})(m.tracking||(m.tracking={}))})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Objects,p=a.reactive.Value,g=function(){function a(){}a.install=function(a){a.user.uuid.onchange(function(d){d&&b(a)})};a.disableTracking=function(){window.SILK_DEBUGGING||(d.isTrackingDisabled=!0)};a.configureIntercom=function(a){if(!d.isTrackingDisabled){var b=n(a);b&&window.Intercom&&window.Intercom("boot",b);g(a)}};a.getIntercomState=function(a){var b=a.user,d=a.repository;return-1==a.user.repositories.get().map(l.prop("uri")).indexOf(d.uri.get())?
null:{app_id:window.SILK_DEBUGGING?"k5mnnhln":"natiwmt4",user_hash:b.intercomHash.get(),name:b.name.get(),"First name":b.name.get().split(/\b/)[0],email:b.email.get(),created_at:Math.floor(b.created.get().getTime()/1E3),user_id:b.uuid.get(),Sites:b.repositories.get().length,company:{id:d.uri.get(),name:d.name.get(),created_at:Math.floor(d.createdTime.get().getTime()/1E3),Pages:d.documents.get(),Members:a.repository.members.get(),Followers:a.repository.subscriptions.get(),Privacy:d.isPrivate.get()?
"Private":"Public"}}};a.trackApplicationState=function(a){var b=a.repository;p.lift(h)(a,b.uri,b.name,b.documents,b.members,b.subscriptions,b.isPrivate)};a.updateIntercomState=function(a,b,f,e,h,n,g){a=a.user;d.isTrackingDisabled||(b={app_id:window.SILK_DEBUGGING?"k5mnnhln":"natiwmt4",user_hash:a.intercomHash.get(),user_id:a.uuid.get(),company:{id:b,name:f,Pages:e,Members:h,Followers:n,Privacy:g?"Private":"Public"}},window.Intercom&&window.Intercom("update",b))};a.trackMetrics=function(a){window.Intercom&&
!d.isTrackingDisabled&&a.forEach(f)};a.trackMetric=function(a){if(window.Intercom&&!d.isTrackingDisabled){var b=a.action;if("document-created"==b||"document-saved"==b||"collection-created"==b||"new-tag"==b||"csv-import-complete"==b||"csv-import-error"==b||"invite-sent"==b)b=l.cloneObject(a.parameters),b.site=a.repository,b.source=a.source,window.Intercom("trackUserEvent",a.action,b)}};a.isTrackingDisabled=!1;var d=a,b=a.configureIntercom,n=a.getIntercomState,g=a.trackApplicationState,h=a.updateIntercomState,
f=a.trackMetric;return a}();k.Intercom=g})(m.tracking||(m.tracking={}))})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Dates,l=a.typlib.Objects,p=a.typlib.tracking.GoogleAnalytics,g=a.typlib.tracking.CustomGoogleAnalytics,e=a.typlib.tracking.Mixpanel,d=a.typlib.tracking.Intercom,b=function(){function a(){}a.init=function(){b.NO_TRACKING=!1;b.SILK_NO_NATIVE_TRACKING=!1;b.userLoggedIn=null};a.install=function(a,c,d){b.userLoggedIn=a;p.cleanUrl();p.install();c&&d&&g.install(c,d);e.install()};a.installClickTracking=function(){p.installGlobalLinkHandlers()};a.trackWithMode=function(a,
c,d){c=c||{};if(!b.NO_TRACKING){var f="starting";c.userLoggedIn=b.userLoggedIn;if(window.Silk){var e=window.Silk.canvas.document.get(),f=e&&e.type,e=e&&e.subViewType&&e.subViewType.get();"product"!=window.Silk.silkType&&(c.silkType=window.Silk.silkType);f=[f,e].filter(function(a){return!!a}).join("/");e=window.Silk.domain.user.permission.get();c.belongsToSilk=e&&e.account.user?!0:!1}h(a,f,c,d)}};a.trackWebsite=function(a,c){c=c||{};b.NO_TRACKING||h(a,"website",c,!0)};a.track=function(a,b,d,e){c([f(a,
b,d)],e)};a.trackPageview=function(a){p.trackPageview(a);g.trackPageview(a);e.trackPageview(a)};a.mkMetric=function(a,c,b){return{time:k.currentTimeInUTC(),repository:window.location.host,action:a,source:c,parameters:b||{}}};a.trackMany=function(a,c){b.SILK_NO_NATIVE_TRACKING||window.Silk.api.Metric.create({sent:k.currentTimeInUTC(),metrics:a.map(q)},void 0,void 0,void 0,{ignoreErrors:!0});e.trackMetrics(a);d.trackMetrics(a);p.trackMetrics(a,c)};a.handleLink=function(a,c){if(!p.isCrossDomain(a)||
!p.googleAnalyticsActivated)return!1;p.linkCrossDomain(a,c);return!0};a.convertParamsToStrings=function(a){var c=l.cloneObject(a);a=l.cloneObject(a.parameters);for(var b in a)a[b]=""+a[b];c.parameters=a;return c};var b=a,h=a.track,f=a.mkMetric,c=a.trackMany,q=a.convertParamsToStrings;return a}();m.Tracking=b;b.init()})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Html,p=a.typlib.Tracking,g=a.client.query.Data,e=function(){function a(){}a.createForExplore=function(a){return"/explore/"+g.jsonToUri(a).map(encodeURIComponent).join("/")};a.exploreCollection=function(a){return a||"/explore"};a.createForEmbed=function(a,b){var d="/s/embed"+a.data.fullUri.get(),f=new Uri(location.href);b.isPrivate.get()||f.setProtocol("http");f.setPath(d);return f.toString()};a.createForGlobalDashboard=function(){return location.protocol+
"//"+h()+"/dashboard"};a.createForPage=function(a,b){var d=[""];"home"!=a&&(d=["","page",a]);b&&d.push("edit");d=d.map(encodeURIComponent).join("/");""==d&&(d="/");return d};a.handleNavigationClick=function(a,d){var f=l.querySelectorAOS(d.target,"a[href], svg a");if(f&&!(d.altKey||d.ctrlKey||d.metaKey||d.shiftKey||1!=d.which||l.isContentEditable(f)&&!d.metaKey)){var h=f.getAttribute("href");if(!h||0!==h.indexOf("#")){var g=f.getAttribute("target");g||(f="http://www.w3.org/2000/svg"==f.namespaceURI?
$("<a/>").attr("href",h)[0].href:f.href,!0===e(f,g)&&(a(f),d.preventDefault(),g=new Uri(f),(new Uri(location.href)).host()==g.host()&&b()&&window.Silk.router.fromUri(g)))}}};a.canNavigate=function(){var a=$.Event("silk-beforenavigate");$(window).trigger(a);return!a.isDefaultPrevented()};a.handleExternalLink=function(a,b){var d=a.split("#");try{var f=1<d.length?decodeURIComponent(d[1]):null}catch(e){throw Error("Error parsing URI");}var d=location.protocol+"//"+location.hostname,h="http://"+location.hostname,
n;0===a.indexOf(d)?n=f||a.substring(d.length):"https:"==location.protocol&&0===a.indexOf(h)&&(n=f||a.substring(h.length));return n?!0:p.handleLink(a,b)};a.getProtocol=function(a){var b=location.protocol.replace(/:$/,"");a&&(b="https");a=location.hostname.split(".");-1<["lab","st","silk"].indexOf(a[a.length-1])&&(b="http");return b};a.getWebHost=function(){if(void 0!=window.loginHost)return"www."+window.loginHost;var a=location.hostname.split(".");2<a.length&&a.splice(0,1,"www");return a.join(".")};
a.getCurrentURI=function(a){var b=new Uri(location.href);b.anchor()&&(b.setPath(b.anchor()),b.setAnchor(""));b.setProtocol(r(a));return b.toString()};a.getWebURI=function(a,b,d){a=r(d)+"://"+h()+a;b&&(a+="?t="+encodeURIComponent(f(d)));return a};a.documentNameFromUri=function(a){return decodeURI(a.slice(6))};var b=a.canNavigate,e=a.handleExternalLink,r=a.getProtocol,h=a.getWebHost,f=a.getCurrentURI;return a}();k.NavLinks=e})(m.nav||(m.nav={}))})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.client.query.Filters,g=a.silk.nav.NavLinks,e=a.typlib.Arrays,d=a.typlib.Objects,b=function(){function a(){}a.render=function(a,c,d){c=h(a).appendTo(c);d.preserveHtml?c.text($(a.node).text()):c.html($(a.node).contents().clone());!a.href&&d.enumQueryData&&b(a,c,d.enumQueryData);return c};a.withEnumLink=function(a,c,b){if(a.tag&&a.tag.isEnum()){b=d.cloneObject(b);var h=p.mkFilter("equals",a.columnContext.tagUris,!0,[a.value]);a=b.filters.filter(function(a){return!e.equals(a.relation,
h.relation)});b.filters=a.concat(h);a=d.cloneObject(b.roles);a.column=a.column.concat(a.distribution);a.distribution=[];b.roles=a;b=g.createForExplore(b);b=$("<a/>").attr("href",b).text(c.text());c.parent().append(b);c.remove()}};a.createContainer=function(a){a.href&&a.href.match(/^\/page\/%2Fexplore%2/)&&delete a.href;return a.href?$("<a/>").attr("href",a.href):$("<a/>")};var b=a.withEnumLink,h=a.createContainer;return a}();l.Textual=b;l=b.render})(k.render||(k.render={}))})(m.query||(m.query={}))})(a.client||
(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.client.query.render.Textual,g=function(){function a(){}a.render=function(a,b,e){p.createContainer(a).appendTo(b).text($(a.node).text())};return a}();l.Currency=g;l=g.render})(k.render||(k.render={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.client.query.render.Textual,g=function(){function a(){}a.render=function(a,b,e){p.createContainer(a).appendTo(b).text($(a.node).text())};return a}();l.Date=g;l=g.render})(k.render||(k.render={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.client.query.render.Textual,g=function(){function a(){}a.render=function(a,b,e){p.createContainer(a).appendTo(b).text($(a.node).text())};return a}();l.Numeric=g;l=g.render})(k.render||(k.render={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Value,l=function(){function a(e){var d;if(d=function(a){this.rawUri=(new k(a)).name("ProtocolRelativeUri.rawUri");this.uri=this.rawUri.map(g).name("ProtocolRelativeUri.uri")}.apply(d||this,arguments))return d}a.toProtocolRelative=function(a){return"https:"==window.location.protocol?(new Uri(a)).setProtocol("https").toString():a};var g=a.toProtocolRelative;a.ProtocolRelativeUri=a;a.prototype.cleanup=function(){this.uri.cleanup();this.rawUri.cleanup()};return a}();
m.ProtocolRelativeUri=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.typlib.ProtocolRelativeUri,g=function(){function a(){}a.render=function(a,b,c){a=d(a.types.video.normalized);b.append(a)};a.createIframe=function(a){return $("<iframe />").attr("src",b(a)).attr("width",a.width+"px").attr("height",a.height+"px").attr("frameborder",0)};a.resolveEmbedUrl=function(a){switch(a.provider.toLowerCase()){case "youtube":a=g(a.src);break;case "vimeo":a=n(a.src);break;default:a=a.src}return p.toProtocolRelative(a)};
a.vimeoUrl=function(a){if(a=(new Uri(a)).queryPairs.filter(function(a){return"src"==a[0]})[0]){var b=decodeURIComponent(a[1]);if(b.match(/vimeo.com\//))return b.replace(/^(http|https):/,"")}return a};a.youtubeUrl=function(a){a=new Uri(a.replace("/watch?v=","/embed/"));a.addQueryParam("color","white");a.addQueryParam("theme","light");a.addQueryParam("hd","1");return a.toString()};var d=a.createIframe,b=a.resolveEmbedUrl,n=a.vimeoUrl,g=a.youtubeUrl;return a}();l.Video=g;l=g.render})(k.render||(k.render=
{}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.client.query.render.Textual,g=function(){function a(){}a.render=function(a,b,e){p.createContainer(a).appendTo(b).text($(a.node).text())};return a}();l.Year=g;l=g.render})(k.render||(k.render={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.client.query.render.Currency,g=a.client.query.render.Date,e=a.client.query.render.Image,d=a.client.query.render.Numeric,b=a.client.query.render.Textual,n=a.client.query.render.Video,r=a.client.query.render.Year,h=function(){function a(){}a.render=function(a,d){var f=a.mostLikely(),e=h(d,f);(c.renderers[f]||b.render)(a,e,d);return e};a.createElement=function(a,c){return(a.inline?$("<span/>"):$("<div/>")).addClass("type-"+c)};a.init=function(){c.renderers=
{image:e.render,video:n.render,numeric:d.render,textual:b.render,year:r.render,date:g.render,currency:p.render,geo:b.render};c.defaultOptions={targetDocument:void 0,editLink:!1,enumQueryData:null,rowIndex:void 0,colIndex:void 0,preserveHtml:!1,inline:!0}};var c=a,h=a.createElement;return a}();l.Item=h;l=h.render;h.init()})(k.render||(k.render={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.isNumeric=function(a){return""!==a&&null!==a&&"Infinity"!==a&&!isNaN(a)};a.addThousandsSeparators=function(a,g){g=g||",";var e=/(-?[0-9]+)([0-9]{3})/,d,b=[],b=(""+a).split(".");for(d=b[0];e.test(d);)d=d.replace(e,"$1"+g+"$2");1<b.length&&(d=d+"."+b[1]);return d};a.clamp=function(a,g,e){return Math.max(a,Math.min(g,e))};a.prettyFixed=function(a,g){var e=a.toFixed(g);if(0===g)return e;var d=e.split(".");return 0===+d[1]?d[0]:e};return a}();
a.Numbers=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.client.query.Roles,l=a.client.query.render.Item,p=a.reactive.Value,g=a.typlib.Arrays,e=a.typlib.CleanupPool,d=a.typlib.Functions,b=a.typlib.Numbers,n=a.typlib.Objects,r=a.typlib.ThreadEnd,h=function(){function a(c,b,d,f){var h;this.render=this.render.bind(this);this.fixLayout=this.fixLayout.bind(this);this.groupByLetter=this.groupByLetter.bind(this);this.groupExplicitly=this.groupExplicitly.bind(this);this.groupNumerically=this.groupNumerically.bind(this);this.groupByYear=
this.groupByYear.bind(this);if(h=function(a,c,b,d){this.pool=new e;this.document=a;this.pipeline=c;this.viewdata=b;this.tagList=d;this.table=this.node=this.list=null;this.groupSize=this.pipeline.roles.byRole.group.map(n.prop(0,"groupSize")).name("GroupBy.groupSize");this.createStructure();this.pool.push(p.onchange(this.render)(this.pipeline.output.headers,this.pipeline.output.body,this.groupSize),this.groupSize)}.apply(h||this,arguments))return h}a.migratePipeline=function(a,b){b.sliced.wanted.set(200);
var d=b.roles.byRole,d=g.concat([d.column.get(),d.numeric.get(),d.auxnumeric.get(),d.location.get(),d.description.get(),d.distribution.get()]).filter(function(a){return!k.isPageTitle(a.relation)});b.roles.resetAllExcept("collection");d=d.slice(0,1);d.groupSize=c.defaultSize;b.roles.set("group",d)};a.alphaSort=function(a){return g.sort(Object.keys(a))};a.sortByKey=function(a){return g.sortByComparing(Object.keys(a),function(c){return a[c].sortKey})};a.makeBlockInfo=function(a){a=$(a);return{height:a.height(),
node:a}};a.computeIntervals=function(a,b){b=b||{};for(var d=b.groupSize,f=b.roundedTo,e=f?c.takeRoundedRange:c.takeSizedRange,h=[];a.length;){var n=[],g=e(a,d,f,n=[]),n=c.makeIntervalDescriptor(g,n,b.addThousandsSeparators);for(h.push(n);a.length&&a[0]===g.max;)a.shift()}return h};a.makeIntervalDescriptor=function(a,b,d){a={label:c.makeIntervalLabel(a.min,a.max,d),predicate:function(a){return a>=this.min&&a<=this.max},min:a.min,max:a.max,mass:b.length};a.predicate=a.predicate.bind(a);return a};a.mergeIntervals=
function(a,b,d){if(!a.length)return[];for(var f=[a[0]],e,h,n=1;n<a.length;n++)e=f[f.length-1],h=a[n],e.mass+h.mass<=b?c.mergeTwoIntervals(e,h,d):f.push(h);return f};a.mergeTwoIntervals=function(a,b,d){a.max=b.max;a.mass+=b.mass;a.label=c.makeIntervalLabel(a.min,a.max,d)};a.takeRoundedRange=function(a,c,b,d){c=Math.floor(a[0]/b)*b;for(b=c+b-1;a.length&&a[0]<b;)d.push(a.shift());return{min:c,max:b}};a.takeSizedRange=function(a,c,b,d){b=a.slice(0,c);for(var f=b[0],e=b[b.length-1];c--;)a.shift();[].push.apply(d,
b);return{min:f,max:e}};a.makeIntervalLabel=function(a,c,d){!1!==d&&(a=b.addThousandsSeparators(a),c=b.addThousandsSeparators(c));return a==c?a:a+" – "+c};a.makeIntervalPredicate=function(a,c){return function(b){return b>=a&&b<=c}};a.assignInterval=function(a,c,b){c=b[1][0][c]();return(a=g.find(a,n.call("predicate",c)))?[{label:a.label,sortKey:a.min}]:[]};a.label="Groups";a.uri="http://typlab.com/2010/components/groupby";a.shortId="groupby";a.defaultSize=10;var c=a;a.GroupBy=a;a.prototype.cleanup=
function(){this.pool.cleanup()};a.prototype.render=function(a,b,d){r.onThreadEnd(function(a,b,d){if(b){this.list.empty();d=d||c.defaultSize;a=this.chooseGroupingMethod(a);var f=a.tactic(b,{groupSize:d});b=a.sorter(f).map(function(a){return $('<li class="group-item" />').append($("<div/>").addClass("group-heading").text(f[a].displayLabel)).append(f[a].node)});this.list.append(b);this.fixLayout()}}.bind(this),arguments,"render",this)};a.prototype.chooseGroupingMethod=function(a){if(1>=a.length)return{tactic:this.groupByLetter,
sorter:c.alphaSort};var b={numeric:{tactic:this.groupNumerically,sorter:c.sortByKey},currency:{tactic:this.groupNumerically,sorter:c.sortByKey},year:{tactic:this.groupByYear,sorter:c.sortByKey},date:{tactic:this.groupByYear,sorter:c.sortByKey}};a=a[1].mostLikely();return b[a]||{tactic:this.groupExplicitly,sorter:c.alphaSort}};a.prototype.fixLayout=function(a){r.onThreadEnd(function(a){if(0===this.list.children().length)return!0;var b=this.list,d=b.children().removeAttr("style").toArray().map($),f=
d[0].width()+60;a=f?Math.round(b.width()/f):0;var e=g.createFilled(a,0);setTimeout(function(){d.map(c.makeBlockInfo).forEach(function(a){var c=g.indexOf(e,g.min(e)),b="translate3d("+c*f+"px, "+e[c]+"px, 0)";a.node.addClass("float-item").css({webkitTransform:b,transform:b});e[c]+=a.height;return e});b.css("height",g.max(e))},0)}.bind(this),arguments,"fixLayout",this)};a.prototype.groupByLetter=function(a){return this.groupBy(a,function(a){return[{label:a[0][0].value.charAt(0)}]})};a.prototype.groupExplicitly=
function(a){a=a.filter(function(a){return 0!==a[1].length});return this.groupBy(a,function(a){return a[1].map(function(a){return{label:a.value.toLowerCase(),displayLabel:a.value}})})};a.prototype.groupNumerically=function(a,b){b=b||{};var f=b.property||"number",e=function(a){return a[1][0]&&a[1][0][f]()},h=a.filter(function(a){return void 0!==e(a)}),n=g.sortByComparing(h,e).map(e),n=c.computeIntervals(n,b);b.mergeToSize&&(n=c.mergeIntervals(n,b.mergeToSize,b.addThousandsSeparators));return this.groupBy(h,
d.partial(c.assignInterval,n,f),!0)};a.prototype.groupByYear=function(a,c){return this.groupNumerically(a,{roundedTo:5,mergeToSize:c.groupSize,addThousandsSeparators:!1,property:"year"})};a.prototype.groupBy=function(a,c,b){var d=n.cloneObject(l.defaultOptions),f={};d.targetDocument=n.prop(0,0,"href")(a);a.forEach(function(a){c(a).forEach(function(c){var e=c.label,h=$("<li/>").append(l.render(a[0][0],d));b&&a[1]&&h.append(l.render(a[1][0],d));f[e]=f[e]||{node:$("<ul />"),sortKey:c.sortKey,displayLabel:c.displayLabel||
e};f[e].node.append(h)})});return f};a.prototype.createStructure=function(){this.list=$("<ul />").addClass("grouped-list");this.node=$("<div/>").append(this.list)};return a}();m.GroupBy=h})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.query.Roles,l=a.client.query.render.Item,p=a.typlib.Arrays,g=a.typlib.Objects,e=a.typlib.ThreadEnd,d=function(){function a(b,d,e,f,c,q){var g;this.render=this.render.bind(this);if(g=function(a,c,b,d,f,e){this.tagList=b;this.document=a;this.pipeline=c;this.queryData=e;this.table=this.node=null;this.setupNode();this.setupSortability();this.rowsOnchange=this.pipeline.output.body.onchange(this.render)}.apply(g||this,arguments))return g}a.migratePipeline=function(a,
b){b.sliced.wanted.set(200);var d=b.roles.byRole,f=p.concat([d.column.get(),d.numeric.get(),d.auxnumeric.get(),d.location.get(),d.image.get(),d.description.get()]).filter(function(a){return!k.isPageTitle(a.relation)}),d=d.distribution.get();b.roles.resetAllExcept("collection","order");d&&d.length&&b.roles.set("distribution",d);f&&f.length&&b.roles.set("column",f)};a.label="Table";a.uri="http://typlab.com/2010/components/querytable";a.shortId="table";a.Table=a;a.prototype.cleanup=function(){this.rowsOnchange.cleanup()};
a.prototype.setupNode=function(){this.table=$("<table />").addClass("line-separated");this.node=$("<div/>").append(this.table)};a.prototype.setupSortability=function(){function a(d){b.toggleClass("sortable",!d||!d.length)}var b=this.table;this.pipeline.roles.byRole.distribution.onchange(a);a(null)};a.prototype.render=function(a){e.onThreadEnd(function(a){function b(){var a=c.pipeline.output.headers.get().map(function(a){return $("<th />").append(a.tagNames.map(function(a){return $("<span />").text(a)[0]})).click(function(){c.sortOnColumn(a)})[0]});
c.skipFirstColumn()&&(a=a.slice(1));return $("<thead />").append($("<tr />").append(a))}function d(){var b=g.cloneObject(l.defaultOptions);return a.map(function(a,d){for(var f=$("<tr/>"),e=c.skipFirstColumn()?1:0;e<a.length;e++){b.targetDocument=a&&a[0]&&a[0][0]&&a[0][0].href;b.rowIndex=e;b.inline=!1;b.enumQueryData=c.queryData.json.flat().get();for(var h=$("<td/>"),n=0;n<a[e].length;n++)b.colIndex=n,h.append(l.render(a[e][n],b));f.append(h[0])}return f[0]})}if(a){this.table.empty();var c=this;this.table.append(b()).append(d())}}.bind(this),
arguments,"Table.render",this)};a.prototype.skipFirstColumn=function(){return void 0!==this.node.parents("[data-component-uri]").attr("data-hide-first-table-column")};a.prototype.sortOnColumn=function(a){var b=this.pipeline.roles.byRole.distribution.get();if(!b||!b.length){a=a.tagUris.length?a.tagUris:k.PageTitle;var b=this.pipeline.roles.byRole.order,d=b.get()[0],d={direction:d&&p.equals(a,d.relation)?"asc"==d.direction?"desc":"asc":"asc",relation:a};b.set([d])}};return a}();m.Table=d})(a.component||
(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.query.render.Item,l=a.component.Table,p=a.typlib.Objects,g=function(){function a(d,b,e,g,h,f){var c;this.render=this.render.bind(this);if(c=function(a,c,b,d,f,e){this.document=a;this.pipeline=c;this.tagList=b;this.queryData=e;this.table=this.node=this.list=null;this.createStructure();this.rowsOnchange=this.pipeline.output.body.onchange(this.render)}.apply(c||this,arguments))return c}a.migratePipeline=function(a,b){l.migratePipeline(a,b)};a.label="List";a.uri=
"http://typlab.com/2010/components/list";a.shortId="list";a.List=a;a.prototype.cleanup=function(){this.rowsOnchange.cleanup()};a.prototype.render=function(a){function b(){var b=p.cloneObject(k.defaultOptions);return a.map(function(h,f){for(var c=$("<li/>"),q=0;q<h.length;q++){b.targetDocument=a&&a[0]&&a[0][0]&&a[0][0].href;b.rowIndex=q;b.enumQueryData=e.queryData.json.flat().get();b.enumQueryData.view=l.uri;for(var g=0;g<h[q].length;g++)b.colIndex=g,c.append(k.render(h[q][g],b))}return c[0]})}if(a){this.list.empty();
var e=this;this.list.append(b())}};a.prototype.createStructure=function(){this.list=$("<ul />");this.node=$("<div/>").append(this.list)};return a}();m.List=g})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.LocalStorage,p=function(){function a(){}a.init=function(){var a=l.get("geoCache");e.cache=a?JSON.parse(a):{}};a.addCache=function(a,c){e.cache[a]=c;l.set("geoCache",JSON.stringify(e.cache))};a.getCache=function(a){return e.cache[a]};a.checkQueue=function(){0===e.queue.length||e.wait||e.process()};a.process=function c(){if(0===e.queue.length)e.wait=!1,b();else{e.wait=!0;var a=e.queue.shift();a.attempts++;$.ajax({url:r(a.address),success:function(b){var n=
h(b);e.addCache(a.address,n);window.Silk.domain.user.canWrite.get()&&d(a.address,b);a.success(n);setTimeout(c,100)},error:function(b){3>a.attempts?e.queue.push(a):a.error(b);setTimeout(c,100)}})}};a.scheduleSubmitToServer=function(a,b){e.submitQueue[a]=(new XMLSerializer).serializeToString(b)};a.submitToServer=function(){$.isEmptyObject(e.submitQueue)||(window.Silk.api.Geodata.saveMany(e.submitQueue),e.submitQueue={})};a.makeReq=function(a,b,d){var h=e.getCache(a);h?b(h):(r(a),e.queue.push({address:a,
success:b,error:d,attempts:0}),e.checkQueue())};a.url=function(a){var b=new Uri("//maps.googleapis.com/maps/api/geocode/xml");b.addQueryParam("address",a);b.addQueryParam("sensor","false");b.addQueryParam("language","en");return b.toString()};a.formatGeo=function(a){if(!a)return null;a=$("result",a.documentElement);if(0==a.length)return{accuracy:0,normalized:{}};var b=a.eq(0),d=b.find("> type").map(function(a,c){return $(c).text()}).get(),e=+b.find("> geometry > location > lat").text(),b=+b.find("> geometry > location > lng").text();
return{accuracy:1,normalized:{addressTypes:d,lat:e,lng:b,resultCount:a.length}}};a.enrichRows=function(a,b,d){for(var e=0;e<a.length;++e){var h=a[e];if(h[b])for(var g=0;g<h[b].length;g++)(function(){var e=h[b][g],r=e.value,u=e.types;e.types.geo||n(r,function(b){u.geo=b;d(a)},function(a){error(a)})})()}};a.cache={};a.queue=[];a.submitQueue={};a.wait=!1;var e=a,d=a.scheduleSubmitToServer,b=a.submitToServer,n=a.makeReq,r=a.url,h=a.formatGeo;return a}();k.Geo=p;p.init()})(m.query||(m.query={}))})(a.client||
(a.client={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.rgb=function(a){return"rgb("+a.join(",")+")"};a.rgba=function(a){return"rgba("+a.join(",")+")"};a.shade=function(a,g){return[Math.round(a[0]*g),Math.round(a[1]*g),Math.round(a[2]*g),a[3]]};a.isLight=function(a){return 160<(1.1*a[0]+1.2*a[1]+a[2])/3};a.defaultColors=[[37,157,176,1],[178,212,87,1],[232,98,43,1],[255,210,48,1],[65,99,180,1],[116,184,48,1],[255,156,48,1],[232,43,89,1],[100,65,158,1],[184,102,48,1],[219,219,193,1],[94,132,70,1],
[37,123,176,1],[147,212,87,1],[232,129,44,1],[255,245,48,1],[65,71,181,1],[72,189,45,1],[255,211,107,1],[232,44,44,1],[124,65,158,1],[184,136,48,1],[207,219,171,1],[65,133,71,1]];return a}();a.Colors=k})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.silkviz.Colors,p=a.typlib.Numbers,g=function(){function a(d,b,e){var g;if(g=function(a,b,c){this.textDiv=this.div=null;this.size=50;this.value=c;this.position=a;this.normalized=b}.apply(g||this,arguments))return g}a.DomMarker=a;a.prototype.getColorFromNormalized=function(a){if(null==a||1<a||0>a||isNaN(a))return"rgb(240, 240, 240)";var b=[[232,165,43],[232,98,43]],e=b.length-1;a*=e;var g=Math.floor(a),h=b[g],f=b[g==e?g:g+1],c=a-Math.floor(a);a=[0,1,2].map(function(a){return Math.floor(h[a]+
(f[a]-h[a])*c)});return l.rgb(a)};a.prototype.textFits=function(){this.testDiv=$(".test-div")[0]||$("<div class='test-div'/>").css("padding","0px").css("margin","0px").hide().appendTo(window.document.body);return $(this.testDiv).text(this.textDiv.textContent).width()<=$(this.div).width()};a.prototype.setColor=function(a){this.div.style.background=this.getColorFromNormalized(a)};a.prototype.onAdd=function(){var a=document.createElement("div");this.div=a;this.textDiv=document.createElement("span");
a.className="map-marker-dom";a.appendChild(this.textDiv);this.hideText();this.setColor(this.normalized);this.getPanes().overlayMouseTarget.appendChild(a);if(this.map)this.onZoom(this.map.getZoom());setTimeout(function(){google.maps.event.trigger(this,"added",this)}.bind(this),0)};a.prototype.onRemove=function(){this.div.parentNode.removeChild(this.div);this.div=null};a.prototype.onZoom=function(a){var b=[10,10,15,25,25,30,30,30,35,35,40,40,50,50,50,50,60,70,80,80,100];a=b[a-1]||b[0];a!==this.size&&
this.draw();this.size=a};a.prototype.getPosition=function(){return this.position};a.prototype.hideText=function(){$(this.textDiv).hide()};a.prototype.showText=function(){$(this.textDiv).show()};a.prototype.draw=function(){var a=this.div,b=this.getProjection();if(b&&a){var e=b.fromLatLngToDivPixel(this.position),g=this.normalized,b=p.clamp(0.8*this.size,2.75*this.size,3.5*this.size*g);a.style.zIndex=(100-100*g).toFixed(0);a.style.width=a.style.height=a.style.lineHeight=b+"px";a.style.left=e.x-b/2+
"px";a.style.top=e.y-b/2+"px";this.pxPosition=e;a=this.map.getZoom();this.textDiv.textContent=3>a?"":4>a&&b<2*this.size?this.value:4===a&&b===this.size?p.prettyFixed(this.value,1):p.prettyFixed(this.value,2);setTimeout(function(){google.maps.event.trigger(this,"rendered",this)}.bind(this),0)}};return a}();k.DomMarker=g})(m.map||(m.map={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.component.map.DomMarker,p=function(){function a(e,d){var b;if(b=function(a,b){this.map=b;this.div=document.createElement("div");this.text=a;this.projection=this.listeners=this.marker=null}.apply(b||this,arguments))return b}a.Tooltip=a;a.prototype.draw=function(){};a.prototype.bindMarker=function(a){this.marker=a;(this.isDom=a instanceof l)?google.maps.event.addListenerOnce(a,"rendered",function(){google.maps.event.addDomListener(a.div,"mouseover",this.addTooltip.bind(this));
google.maps.event.addDomListener(a.div,"mouseout",this.removeTooltip.bind(this))}.bind(this)):(this.setMap(this.map),google.maps.event.addDomListener(a,"mouseover",this.addTooltip.bind(this)),google.maps.event.addDomListener(a,"mouseout",this.removeTooltip.bind(this)))};a.prototype.addTooltip=function(){var a=this.div;this.div.className="map-tooltip";this.hide();$(a).text(this.text);(this.isDom?this.marker.getPanes().floatPane:this.getPanes().floatPane).appendChild(a);this.listeners=[google.maps.event.addListener(this.isDom?
this.map:this.marker,"mousemove",this.showTooltip.bind(this))]};a.prototype.removeTooltip=function(){this.listeners&&(this.listeners.forEach(google.maps.event.removeListener),this.listeners=null,delete this.listeners);var a=this.div.parentNode;a&&a.removeChild(this.div)};a.prototype.showTooltip=function(a){this.projection=this.projection||(this.isDom?this.marker.getProjection():this.getProjection());a=this.projection.fromLatLngToDivPixel(a.latLng);var d=this.projection.fromLatLngToDivPixel(this.map.getBounds().getNorthEast()),
b=this.isDom?10:0,n=a.x+b,g=this.div.offsetWidth;g+n>d.x&&(n-=g+b);this.div.style.top=a.y+b+"px";this.div.style.left=n+"px";this.show()};a.prototype.show=function(){$(this.div).show()};a.prototype.hide=function(){$(this.div).hide()};return a}();k.Tooltip=p})(m.map||(m.map={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Arrays,p=function(){function a(){}a.fromPipeline=function(a){return{title:0,image:a.print.indices("image")[0],summary:a.print.indices("description")[0],subtitle:void 0,extra:a.print.indices("column"),link:a.print.indices("link")[0]}};a.analyseRows=function(a){var g=e(a),h=d(a),f=b(a[0].length,[0,g,h]),c=f[0];a=a.reduce(function(a,b){b[c]&&b[c][0]&&b[c][0].is("numeric")?a.numeric++:a.other++;return a},{numeric:0,other:0});c=a.other>a.numeric?c:
null;f=f.slice(null===c?0:1);return{title:0,image:g,summary:h,subtitle:c,extra:f}};a.parseRow=function(a,b){function d(a){return b[a]&&b[a][0]||null}function f(a){return b[a]||null}var c=l.notNull(a.extra.map(f)),e=b[a.image]&&b[a.image][0]&&b[a.image][0];return{title:d(a.title),image:e,summary:d(a.summary),subtitle:f(a.subtitle),extra:c,link:d(a.link)}};a.findImageIndex=function(a){for(var b=a[0].length,d=null,f=0,c=0;c<b;c++){var e=a.map(function(a){return a[c]&&a[c][0]&&a[c][0].is("image")?1:0}),
e=l.sum(e);e>f&&(d=c,f=e)}return d};a.findSummaryIndex=function(a){for(var b=a[0].length,d=null,f=40,c=0;c<b;c++){var e=a.map(function(a){return a[c]&&a[c][0]&&$(a[c][0].node).text().length}),e=l.sum(e.filter(function(a){return void 0!==a}))/a.length;e>f&&(d=c,f=e)}return d};a.remainingIndices=function(a,b){for(var d=[],f=0;f<a;f++)0<=b.indexOf(f)||d.push(f);return d};var e=a.findImageIndex,d=a.findSummaryIndex,b=a.remainingIndices;return a}();k.Analyse=p})(m.pagegrid||(m.pagegrid={}))})(a.component||
(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.query.render.Textual,p=a.client.query.render.Image,g=a.typlib.Arrays,e=function(){function a(){}a.render=function(a,d){var g=$("<div class=card />"),u=$("<a class=header />").appendTo(g).attr("href",a.link&&a.link.href?a.link.href:a.title.href),t=d.imgHeight;void 0!==t&&f(a.image,g,u,d.imgWidth,t);b(a.title,u);e(a.subtitle,g,d.enumQueryData);r(a.summary,g);h(a.extra,g,d.enumQueryData);return g};a.renderTitle=function(a,b){$("<div class=title />").text(a.value||
"").appendTo(b)};a.renderSubtitle=function(a,b,d){var f=$("<div class=subtitle />").appendTo(b);a&&a.forEach(function(a,c){0!=c&&f.append(", ");l.render(a,f,{enumQueryData:d})})};a.renderSummary=function(a,b){var d=$("<div class=summary />").appendTo(b),f=a&&a.value;if(f){if(250<f.length){d.attr("title",f);for(var f=f.split(" "),e="";250>e.length;)e+=f.splice(0,1)[0]+" ";f=e+"…"}d.text(f)}};a.renderFacts=function(a,b,d){if(a&&!(1>a.length)){a=g.uniqueBy(a,function(a,c){return g.equals(a,c,function(a,
c){return a.tagUri==c.tagUri})});var f=$("<div class=props />").appendTo(b);a.forEach(function(a){var c=a[0]&&a[0].tag;if(c){var b=$("<span class=val />");$("<div class=row/>").append($("<span class=prop />").text(c.name)).append(b).appendTo(f);a.forEach(function(a,c){0!=c&&b.append(", ");l.render(a,b,{enumQueryData:d})})}})}};a.renderImage=function(a,b,d,f,e){function h(){this&&$(this).remove();b.removeClass("has-image");b.addClass("no-image")}d=$("<div class=image-box />").appendTo(d);e&&d.height(e);
b.addClass(a?"has-image":"no-image");a&&a.types.image&&p.render(a,$("<div />"),{width:f,height:e||a.types.image.normalized.height,onError:h}).prependTo(d)};var b=a.renderTitle,e=a.renderSubtitle,r=a.renderSummary,h=a.renderFacts,f=a.renderImage;return a}();k.Card=e})(m.pagegrid||(m.pagegrid={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.query.Geo,l=a.component.map.DomMarker,p=a.component.map.Tooltip,g=a.component.pagegrid.Analyse,e=a.component.pagegrid.Card,d=a.reactive.Value,b=a.typlib.Arrays,n=a.typlib.Functions,r=a.typlib.Objects,h=a.typlib.Tracking,f=a.typlib.ThreadEnd,c=function(){function a(c,b,f,e,h,n){var g;this.create=this.create.bind(this);this.reallyResizeMap=this.reallyResizeMap.bind(this);this.resizeMap=this.resizeMap.bind(this);this.render=this.render.bind(this);this.showUnenrichedGeoWarning=
this.showUnenrichedGeoWarning.bind(this);this.setAppropriateZoomForSingleMarker=this.setAppropriateZoomForSingleMarker.bind(this);var r=this;this.centerWorldDelayed=function(){var c=arguments;setTimeout(function(){a.prototype.centerWorldDelayed.apply(r,c)},0)};this.reallyRepositionMap=function(){var c=arguments;r.__delayed_toh_repositionMap__&&clearTimeout(r.__delayed_toh_repositionMap__);r.__delayed_toh_repositionMap__=setTimeout(function(){a.prototype.reallyRepositionMap.apply(r,c);r.__delayed_toh_repositionMap__=
null},0)};if(g=function(a,c,b,f,e,h){this.tagList=b;this.document=a;this.pipeline=c;this.queryData=h;this.node=$("<div />");this.loaded=!1;this.markers=[];this.positions={};this.unEnrichedGeoData=(new d(!1)).name("Map.unEnrichedGeoData");this.missingGeoData=(new d(!1)).name("Map.missingGeoData");this.trackedUnEnrichedGeo=!1;this.createStructure();this.waitForGoogle(function(){this.create();f&&this.render(this.pipeline.output.body.get())}.bind(this));this.centerWorld();this.unEnrichedOnchange=this.unEnrichedGeoData.onchange(this.showUnenrichedGeoWarning);
this.rowsOnchange=this.pipeline.output.body.onchange(this.render,!0)}.apply(g||this,arguments))return g}a.migratePipeline=function(a,c){c.sliced.wanted.set(200);c.roles.resetAllExcept("collection","order")};a.summedValue=function(a,c){return b.sum(a.map(function(a){try{return a.data[c][0].number()}catch(b){return 0}}))};a.label="Map";a.uri="http://typlab.com/2010/components/googleviz/map";a.shortId="map";var c=a.summedValue;a.Map=a;a.prototype.cleanup=function(){this.rowsOnchange.cleanup();this.unEnrichedOnchange.cleanup();
this.node.css("height","");$(window).off("resize",this.resizeMap)};a.prototype.createStructure=function(){this.mapNode=$("<div class=map-output />");this.missingGeoDiv=$("<div/>").addClass("missing-geo").hide();this.node.append(this.mapNode,this.missingGeoDiv)};a.prototype.customStyles=function(){return[{featureType:"water",stylers:[{visibility:"on"},{color:"#b5cbe4"}]},{featureType:"landscape",stylers:[{color:"#efefef"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#83a5b0"}]},
{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#bdcdd3"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e3eed3"}]},{featureType:"administrative",stylers:[{visibility:"on"},{lightness:33}]},{featureType:"road"},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"on"},{lightness:20}]},{},{featureType:"road",stylers:[{lightness:20}]}]};a.prototype.waitForGoogle=function(a,
c){(this.google="undefined"!=typeof google&&google)&&this.google.maps&&"undefined"!=typeof this.google.maps.LatLng?a():(c=c||50,1E4>c&&setTimeout(this.waitForGoogle.bind(this,a,2*c),c))};a.prototype.create=function(){var a="content"==this.document.type,c={zoom:4,styles:this.customStyles(),center:new this.google.maps.LatLng(0,0),mapTypeId:this.google.maps.MapTypeId.ROADMAP,scrollwheel:!1,streetViewControl:!1,panControl:!1,mapTypeControl:!1,mapTypeControlOptions:void 0};a&&(c.mapTypeControlOptions=
{mapTypeIds:[this.google.maps.MapTypeId.ROADMAP,this.google.maps.MapTypeId.HYBRID],style:this.google.maps.MapTypeControlStyle.DROPDOWN_MENU});this.resizeMap();$(window).on("resize",this.resizeMap);this.map=new this.google.maps.Map(this.mapNode[0],c);this.google.maps.event.addListener(this.map,"zoom_changed",function(){var a=this.map.getZoom();this.markers.forEach(function(c){if(c instanceof l)c.onZoom(a)})}.bind(this));this.infoWindow=new this.google.maps.InfoWindow({maxWidth:400});this.loaded=!0};
a.prototype.reallyResizeMap=function(){if("embed"==window.Silk.silkType)var a=this.node.parent("[data-component-uri]").children(".filters").height()||0,c=this.node.closest("section"),b=c.width(),a=c.height()-a;else c=this.node.closest(".block"),0==c.length&&(c=this.node.parent(".component").parent()),b=c.width(),a=0.75*b;this.node.height(a);this.google.maps.event.trigger(this.mapNode[0],"resize")};a.prototype.resizeMap=function(){f.onThreadEnd(function(){this.waitForGoogle(this.reallyResizeMap)}.bind(this),
arguments,"resizeMap",this)};a.prototype.render=function(a){f.onThreadEnd(function(a){function c(a){var b=g.analyseRows(a),e=f&&this.calculateValueRange(a,d.numeric);this.positions=this.collectPositions(d,b,a);e?(this.renderNumericPositions(e,this.positions),google.maps.event.addListenerOnce(this.markers[this.markers.length-1],"rendered",this.checkTextInBounds.bind(this))):this.renderPositions(this.positions);google.maps.event.clearListeners(this.map,"bounds_changed");google.maps.event.addListener(this.map,
"bounds_changed",n.debounce(this.checkTextInBounds.bind(this),350));this.repositionMap()}if(a&&a.length&&this.loaded){$.extend(l.prototype,this.google.maps.OverlayView.prototype);$.extend(p.prototype,this.google.maps.OverlayView.prototype);this.clearMapMarkers();var b=this.pipeline.print,d={rows:b.indices("rows"),numeric:b.indices("numeric")[0],location:b.indices("location")[0]},f=void 0!==d.numeric;if(void 0===d.location)return this.centerWorldDelayed();k.enrichRows(a,d.location,n.debounce(c.bind(this),
500));c.call(this,a)}}.bind(this),arguments,"render",this)};a.prototype.calculateValueRange=function(a,c){return a.reduce(function(a,b){var d;d=b[c][0]?b[c][0].number():0;null!=d&&(d>a.max&&(a.max=d),d<a.min&&(a.min=d));return a},{index:c,max:0,min:0})};a.prototype.centerWorldDelayed=function(){this.centerWorld()};a.prototype.centerWorld=function(){this.map&&(this.map.setCenter(new google.maps.LatLng(20,0)),this.map.setZoom(3))};a.prototype.collectPositions=function(a,c,b){var d=this.unEnrichedGeoData,
f=this.missingGeoData,e={};b.forEach(function(b){var h=g.parseRow(c,b);b[a.location]&&b[a.location].forEach(function(c){c=c.types.geo;if(!c)return d.set(!0);if(!c.normalized||!c.normalized.lat)return f.set(!0);var q=(new this.google.maps.LatLng(c.normalized.lat,c.normalized.lng)).toString();(e[q]=e[q]||[]).push({pos:new this.google.maps.LatLng(c.normalized.lat,c.normalized.lng),data:{location:b[a.location],page:b[0],numeric:a.numeric?b[a.numeric]:void 0,rows:a.numeric?void 0:a.rows.map(function(a){return b[a]}),
card:h,addressTypes:c.normalized.addressTypes}})})});return e};a.prototype.showUnenrichedGeoWarning=function(a){a?(this.trackedUnEnrichedGeo||(h.trackWithMode("component-map-unenriched-values",{}),this.trackedUnEnrichedGeo=!0),a=$("<a>Close</a>").addClass("close").click(function(){this.missingGeoDiv.hide()}.bind(this)),this.missingGeoDiv.show().html("The map markers currently take a bit longer to load because the map server is a bit busy. This message will disappear once this has been resolved. ").append(a)):
this.missingGeoDiv.hide()};a.prototype.makeNormalizer=function(a,c){var b=1/(c-a);return function(d){if(null==d)return d;d=+d;return d<=a?0:d>=c?1:b*(d-c)+1}};a.prototype.addMarker=function(a,c){this.markers.push(c);c.setMap(a)};a.prototype.checkTextInBounds=function(){var a=this.map.getBounds(),c=this.markers.filter(function(c){return a.contains(c.position)});setTimeout(function(){c.forEach(function(a){a.div&&a instanceof l&&(a.textFits()?a.showText():a.hideText())})}.bind(this),100)};a.prototype.renderPositions=
function(a){for(var c in a){var b=a[c],d=b[0],f=new this.google.maps.Marker({map:this.map,position:d.pos,icon:Silk.paths.imagePath+"/components/map/map_marker_v4.png"});(new p(this.getTitle(d),this.map)).bindMarker(f);this.google.maps.event.addListener(f,"click",n.partial(this.onMarkerClick,this,b));this.addMarker(this.map,f)}};a.prototype.getNumeric=function(a){return a.data.numeric[0]&&a.data.numeric[0].value||0};a.prototype.getTitle=function(a){return a.data.page[0]&&a.data.page[0].value||a.data.location[0].value};
a.prototype.renderNumericPositions=function(a,b){var d=this,f=this.makeNormalizer(a.min,a.max),e;for(e in b){var h=b[e],q=h[0],g=c(h,"numeric"),r=new l(q.pos,f(g),g),g=1<h.length?g:this.getNumeric(q);(new p(this.getTitle(q)+" - "+g,this.map)).bindMarker(r);(function(c){google.maps.event.addListener(r,"added",function(b){google.maps.event.addDomListener(b.div,"click",n.partial(d.onMarkerClick,d,c,a).bind(b))})})(h);this.addMarker(this.map,r)}};a.prototype.clearMapMarkers=function(){this.markers.forEach(function(a){google.maps.event.clearInstanceListeners(a);
a.setMap(null)});this.markers=[]};a.prototype.onMarkerClick=function(a,b,d){function f(c){c=c.data.card;c.subtitle&&(c.extra.push(c.subtitle),delete c.subtitle);var b,d;if(c.image){var h=c.image.node.getAttribute("data-normalized-image");h&&(d=JSON.parse(h),b=d.normalized.height,d=d.normalized.width)}b={imgWidth:d,imgHeight:b,enumQueryData:a.queryData.json.flat().get()};c=e.render(c,b);c.children(":empty").hide();c.hasClass("no-image")&&c.find(".image-box").remove();g.html(c);return c}function h(a){try{return a.data.page[0].value}catch(c){return a.data.location[0].value}}
h(b[0]);var q=$("<div class=infowindow />"),n=$("<div class=menu />").appendTo(q),g=$("<div class=body />").appendTo(q);d&&1<b.length&&(d=b.filter(function(a){try{return a.data.numeric.length}catch(c){return!1}}),(d=d[0]&&d[0].data.numeric[0].tag.name)&&$("<div class=summed />").text("Total "+d+": "+c(b)).prependTo(q));1<b.length&&q.addClass("multi");1<b.length&&b.forEach(function(a,c){var b=h(a),b=$("<a href=# />").text(b).click(function(c){f(a);n.children().removeClass("selected");$(this).addClass("selected");
c.preventDefault()});n.append(0==c?"":", ",b)});var r=a.infoWindow;google.maps.event.addListener(r,"domready",function(a){r.setOptions({height:400,maxHeight:400})});f(b[0]);n.children().eq(0).addClass("selected");$("body").append(q);b=q.height();q.detach();q.css("min-height",b);r.setContent(q[0]);r.open(a.map,this)};a.prototype.fixLayout=function(){this.map&&(this.resizeMap(),this.repositionMap())};a.prototype.repositionMap=function(){this.waitForGoogle(this.reallyRepositionMap)};a.prototype.setAppropriateZoomForSingleMarker=
function(){var a=r.values(this.positions)[0][0].data.addressTypes;this.map.setZoom({street_address:13,sublocality:14,neighborhood:14,locality:8}[a[0]]||5)};a.prototype.reallyRepositionMap=function(){var a=this.map,c=new this.google.maps.LatLngBounds,b=0;this.google.maps.event.trigger(this.map,"resize");this.map.setZoom(this.map.getZoom());this.markers.forEach(function(a){c.extend(a.getPosition());b++});1===b?a.setCenter(c.getCenter()):c.isEmpty()||(a.fitBounds(c),setTimeout(function(){1>=a.getZoom()&&
a.setZoom(2)},0));switch(b){case 0:setTimeout(function(){a.setZoom(2)},0);break;case 1:setTimeout(this.setAppropriateZoomForSingleMarker,0)}};a.prototype.google=void 0;a.prototype.map=void 0;a.prototype.mapNode=void 0;a.prototype.missingGeoDiv=void 0;a.prototype.infoWindow=void 0;return a}();m.Map=c})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=a.component.pagegrid.Card,p=a.typlib.ThreadEnd,g=function(){function a(d,b,n,g){var h;this.scrolling=this.scrolling.bind(this);var f=this;this.scrollingDelayed=function(){var c=arguments;f["__delayed_toh_PageGrid.scrolling__"]&&clearTimeout(f["__delayed_toh_PageGrid.scrolling__"]);f["__delayed_toh_PageGrid.scrolling__"]=setTimeout(function(){a.prototype.scrollingDelayed.apply(f,c);f["__delayed_toh_PageGrid.scrolling__"]=null},100)};if(h=function(a,
b,d,f){this.node=a.addClass("pagegrid");this.cards=null;this.document=b;this.pipeline=d;this.queryData=f;this.imgWidth=250;this.itemSpacing=60;this.rendering=!0;this.withImage=this.segments=null}.apply(h||this,arguments))return h}a.PageGrid=a;a.prototype.cleanup=function(){this.cleanupScrolling();$(".slice-info").show()};a.prototype.setupScrolling=function(){$(window).on("scroll",this.scrolling)};a.prototype.cleanupScrolling=function(){$(window).off("scroll",this.scrolling)};a.prototype.scrolling=
function(a){a=Math.round(this.node.offset().top+this.node.height());var b=$(window).height()+($(window).scrollTop()||$(document.body).scrollTop());this.rendering&&b>a+50&&(0==this.node.find(".loading").length&&this.node.append($("<div class=loading />")),this.scrollingDelayed())};a.prototype.scrollingDelayed=function(a){this.renderMoreSegments()};a.prototype.render=function(){p.onThreadEnd(function(){this.node.empty();"query"==this.document.type&&this.setupScrolling();this.cards&&this.cards.length&&
(this.cards.filter(function(a){return a.image}),this.finalBr=$("<br style=clear:both;height:0;padding:0;margin:0; />").appendTo(this.node),this.segments=k.segments(this.cards,this.columns()),this.withImage=!!this.pipeline.roles.byRole.image.get().length,this.node.on("click",".load-more",function(){this.renderMoreSegments();"embed"==this.document.type&&$("section").scrollTop($("section").scrollTop()+100)}.bind(this)),$(".widget-box .slice-info").hide(),this.rendering=!0,this.renderMoreSegments())}.bind(this),
arguments,"PageGrid.render",this)};a.prototype.renderMoreSegments=function(){this.node.find(".loading, .load-more").remove();if(this.segments&&this.segments.length){var a=this.segments.slice(0,12).map(function(a){var d=this.withImage?this.computeImageHeight(a):void 0;return a.map(function(a){var b={imgWidth:this.imgWidth,imgHeight:d,enumQueryData:this.queryData.json.flat().get()};return l.render(a,b)[0]}.bind(this))}.bind(this));"content"!=this.document.type&&"embed"!=this.document.type||this.node.append($("<div class=load-more>Load more</div>"));
this.segments=this.segments.slice(12);this.segments.length||(this.rendering=!1,this.node.find(".loading, .load-more").remove(),$(".widget-box .slice-info").show());a=$(k.concat(a));a.insertBefore(this.finalBr);this.realign(void 0,a)}};a.prototype.fixLayout=function(){this.render()};a.prototype.realign=function(a,b){var e=this.columns(a);b=b||this.node.children();k.segments(b.get(),e).forEach(function(a){this.alignHeights(a)}.bind(this))};a.prototype.columns=function(a){return(a=void 0===a?this.node.closest(".component").parent().width():
a)?Math.max(1,Math.floor((a+2+this.itemSpacing)/(this.imgWidth+this.itemSpacing))):3};a.prototype.computeImageHeight=function(a){a=k.notNull(a.map(function(a){if(a.image)return(a=a.image.types.image)&&a.normalized.height/a.normalized.width}));var b=[120,400];return a.length?Math.min(b[1],Math.max(b[0],250*k.average(a))):b[0]};a.prototype.alignHeights=function(a){[".title",".subtitle",".summary",".props"].forEach(function(b){b=$(a).find(b);if(b.get().map(function(a){return $(a).text()}).join("").length){b.show();
b.css("height","");var e=b.get().map(function(a){return $(a).height()}),e=k.max(e);b.height(e)}else b.hide()});setTimeout(this.alignHeights.bind(this,a),2E3)};a.prototype.finalBr=void 0;return a}();m.PageGrid=g})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.query.Roles,p=a.component.PageGrid,g=a.component.pagegrid.Analyse,e=a.typlib.Arrays,d=function(){function a(b,d,e,f,c,q){var g;this.render=this.render.bind(this);if(g=function(a,c,b,d,f,e){this.node=$("<div/>");this.document=a;this.pipeline=c;this.tagList=b;this.pagegrid=new p($("<div />").appendTo(this.node),a,c,e);this.startChangeListening();this.rowsOnchange=this.pipeline.output.body.onchange(this.render)}.apply(g||this,arguments))return g}
a.migratePipeline=function(a,b){b.sliced.wanted.set(24);var d=b.roles.byRole,f=e.concat([d.column.get(),d.image.get()]).filter(function(c){return!l.isPageTitle(c.relation)&&a.findByUriOrCreate(c.relation[0],!0).types.is("image")})[0],c=d.column.get();f&&(c=c.filter(function(a){return!l.eqRelation(a,f)}));b.roles.resetAllExcept("collection","order");f&&d.image.set([f]);d.column.set(c)};a.label="Grid";a.uri="http://typlab.com/2010/components/pagegrid";a.shortId="pagegrid";a.View=a;a.prototype.cleanup=
function(){this.rowsOnchange.cleanup();this.pagegrid.cleanup();this.listener.cleanup()};a.prototype.render=function(a){if(a){this.pagegrid.node.empty();var b=g.fromPipeline(this.pipeline);a=a.map(g.parseRow.bind(null,b));this.pagegrid.cards=a;this.pagegrid.render()}};a.prototype.startChangeListening=function(){this.listener=this.pipeline.output.body.onchange(this.render)};a.prototype.fixLayout=function(a){this.pagegrid.fixLayout(a)};a.prototype.listener=void 0;return a}();k.View=d})(m.pagegrid||(m.pagegrid=
{}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.circle=function(a,g,e,d,b,n){return a.append("circle").attr("class",g).attr("cx",e).attr("cy",d).attr("r",b).attr("fill",n)};a.line=function(a,g,e,d,b,n,r,h){return a.append("line").attr("class",g).attr("x1",e).attr("y1",d).attr("x2",b).attr("y2",n).attr("stroke",r).attr("stroke-width",h)};a.rect=function(a,g,e,d,b,n,r){return a.append("rect").attr("class",g).attr("x",e).attr("y",d).attr("width",b).attr("height",n).attr("fill",r)};a.translate=
function(a,g,e){return a.attr("transform","translate("+g+","+e+")")};return a}();a.Svg=k})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.silkviz.Svg,l=a.silkviz.Colors,p=a.typlib.Arrays,g=function(){function a(){}a.defaultConfig={alternate:!0,barGap:0,groupGap:25,background:"transparent"};a.measure=function(b,d,g,h,f,c){b=g.geom;var q=h&&h.text||f&&f.text,s=h?h.area.width:0,u=f?f.area.width:0,q=Math.ceil(q?q.maxHeight/2:0);b={left:h?h.area.width:0,top:q,width:b.width-s-u,height:b.height-q-(c?c.area.height:0)};b.right=b.left+b.width;b.bottom=b.top+b.height;return{chart:b,ynum:h,yaux:f,named:c,groups:a.measureGroups(d,
g,b.width,b.height)}};a.measureGroups=function(a,d,e,h){var f={barsPerValue:a.desc.counts.num.length+a.desc.counts.aux.length};a=a.values.length;f.totalBars=a*f.barsPerValue;if(e/a<10+5*f.barsPerValue)f.mode="dense",f.barGap=0,f.groupGap=0,f.totalBars=a*f.barsPerValue,f.groupWidth=e/a,f.barWidth=f.groupWidth/f.barsPerValue,f.spare=0;else{f.mode="sparse";f.barGap=d.bars.barGap;f.groupGap=d.bars.groupGap;d=Math.floor(e/a)-f.groupGap;h=Math.floor(f.barsPerValue*h/4);f.groupWidth=Math.min(h,d);if(d<h)for(;f.groupGap&&
f.groupWidth<=2*f.groupGap;)f.barGap=Math.floor(f.barGap/2),f.groupGap=Math.floor(f.groupGap/2),f.groupWidth=Math.floor(e/a)-f.groupGap;f.barWidth=Math.max(1,Math.floor(f.groupWidth/f.barsPerValue));f.spare=(e-a*f.groupWidth-(a-1)*f.groupGap)/2}f.groupWeight=f.groupWidth/2;return f};a.render=function(a,e,g,h){var f=h.chart;a=a.svg.append("g").attr("class","bars");k.translate(a,f.left,f.top);k.rect(a,"debug",0,0,f.width,f.height,g.bars.background);f=a.append("g").attr("class","bar-groups");a=a.append("g").attr("class",
"shade-groups");e.values.forEach(d.bind(null,{bars:f,shades:a,data:e,conf:g,measurement:h}))};a.renderGroup=function(a,d,e){function h(a,b){a.forEach(function(a,d){var h=f.height/(b.maxNice-b.minNice),q=b.maxNice*h,n=a.reduce(function(a,c){return[(a[0]||0)+(c.value||0)].concat(a)},[]);p.reverse(a.slice()).forEach(function(b,d){var f=b.value||0,t=c.barWidth,v=Math.abs(n[d]*h),p=u+z*(c.barWidth+c.barGap),f=q-(0<=f?v:0)-0;"dense"==c.mode&&1==c.barsPerValue&&(2>t&&(p=Math.floor(p)),t=Math.max(2,Math.ceil(t)));
0<c.groupGap&&(p=Math.floor(p),t=Math.ceil(t));var C=l.shade(g[z],1-0.2*(a.length-1-d)-(y&&e%2?0.1:0));k.rect(m,"bar",p,f,t,v,l.rgba(C));k.rect(w,"shade",p,f,t,v,"rgba(0,0,0,1)").attr("opacity",0);A++});z++})}var f=a.measurement.chart,c=a.measurement.groups,q=a.data.ranges,g=a.conf.colors,u=c.spare+e*(c.groupWidth+c.groupGap),t=p.sum(a.data.desc.counts.num),v=p.sum(a.data.desc.counts.aux),m=a.bars.append("g").attr("class","group"),w=a.shades.append("g").attr("class","group"),y=a.conf.bars.alternate&&
0==c.groupGap&&2<=c.groupWidth&&1==t+v,A=0,z=0;h(d.num,q.num);h(d.aux,q.aux)};a.mouseover=function(a){$(a.context.svg[0][0]).find(".bars .shade-groups .group").eq(a.i).find(".shade").attr("opacity",0.25)};a.mouseout=function(a){$(a.context.svg[0][0]).find(".bars .shade-groups .group").eq(a.i).find(".shade").attr("opacity",0)};a.events={mouseover:a.mouseover,mouseout:a.mouseout};var d=a.renderGroup;return a}();m.Bars=g})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.silkviz.Svg,l=a.silkviz.Colors,p=a.typlib.Arrays,g=function(){function a(){}a.defaultConfig={marginLeft:0,marginRight:60,boxSize:20,boxMargin:10,twoSided:!0};a.measure=function(a,b,e){a=e.legend;e=p.concat(b.desc.labels.num).length;b=p.concat(b.desc.labels.aux).length;b=a.twoSided?Math.max(e,b):e+b;return{area:{left:void 0,top:void 0,width:void 0,height:b*a.boxSize+(b-1)*a.boxMargin+a.boxSize}}};a.place=function(a,b){var e=a.area;e.left=b.left;e.top=b.bottom;e.width=
b.width;e.right=e.left+e.width;e.bottom=e.top+e.height};a.render=function(a,b,e,g){function h(a,b,d){var h=a;b.forEach(function(a,b){a.forEach(function(a,b){k.rect(q,"box",d?-s:f.width,h*(u+s)+s,s,s,l.rgba(e.stacked?l.shade(c[d?0:1],1-0.2*b):c[t]));e.font(q.append("text")).text(a).attr("text-anchor",d?"start":"end").attr("x",d?u:f.width-u).attr("y",h*(s+u)+u/2-1+s).attr("dominant-baseline","hanging");h++;t++})})}var f=g.legend.area;g=e.legend;var c=e.colors,q=a.svg.append("g").attr("class","legend");
k.translate(q,f.left,f.top);k.rect(q,"debug",0,0,f.width,f.height,"transparent");var s=g.boxSize,u=g.boxMargin;a=b.desc.labels.num;b=b.desc.labels.aux;var t=0;h(0,a,!0);g.twoSided?h(0,b,!1):h(a.length,b,!1);return q};return a}();m.Legend=g})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.silkviz.Colors,l=a.silkviz.Svg,p=a.typlib.Arrays,g=function(){function a(){}a.defaultConfig={bullets:10,bulletRadius:4,line:!0,area:!1,areaColor:"rgba(0,0,0, 0.1)",thickness:2,background:"transparent"};a.measure=function(b,d,g,h,f,c){b=g.geom;var q=h&&h.text||f&&f.text;g={left:(h?h.area.width:0)+g.lines.bulletRadius,top:q?q.maxHeight/2:0,width:b.width-(h?h.area.width:0)-(f?f.area.width:0)-2*g.lines.bulletRadius,height:b.height-(q?q.maxHeight/2:0)-(c?c.area.height:
0)};g.right=g.left+g.width;g.bottom=g.top+g.height;return{chart:g,ynum:h,yaux:f,named:c,groups:a.measureGroups(d,g.width)}};a.measureGroups=function(a,d){var e=(d-0)/(a.values.length-1);return{groupWidth:e,groupGap:e-e,groupWeight:0,barWidth:0,spare:0}};a.render=function(a,e,g,h){var f=h.chart;a=a.svg.append("g").attr("class","lines");l.translate(a,f.left,f.top);l.rect(a,"debug",0,0,f.width,f.height,g.lines.background);var c={chart:a,data:e,conf:g,measurement:h},q=a.append("g").attr("class","lines-layer"),
s=a.append("g").attr("class","points-layer"),u=0;["num","aux"].forEach(function(a){e.desc.labels[a].forEach(function(b,h){b.forEach(function(b,l){var v=e.values.map(d.bind(null,c,u,s,a,h,l)),m=function(a){return void 0!==a.n},v=p.group(v,m).map(p.filter(m)),B=k.rgba(c.conf.colors[u]);v.forEach(function(a){if(a.length){var c=a.concat([{x:p.last(a).x,y:f.height},{x:p.head(a).x,y:f.height}]);if(g.lines.area)var b=c.map(function(a){return a.x+","+a.y}).join(" ");q.append("polyline").attr("points",b).attr("fill",
g.lines.areaColor);g.lines.line&&(b=a.map(function(a){return a.x+","+a.y}).join(" "));q.append("polyline").attr("points",b).attr("fill","none").attr("stroke-width",g.lines.thickness).attr("stroke",B)}})});u++})})};a.renderPerValue=function(a,d,e,h,f,c,q,g){function u(a){return v.spare+a*(v.groupWidth+v.groupGap)+("aux"==h?t.desc.counts.num.length*v.barWidth:0)+(f+0.5)*v.barWidth}var t=a.data,v=a.measurement.groups,p=a.measurement.chart;q=a.data.ranges[h];d=k.rgba(a.conf.colors[d]);a=a.conf.lines;
var m=u(g);u(g+1);p=p.height/(q.maxNice-q.minNice);c=t.values[g][h][f][c].value;q=q.maxNice*p-c*p;void 0!==c&&(v.groupWidth>a.bullets&&(l.circle(e,"outer",m,q,a.bulletRadius-1,d),l.circle(e,"inner",m,q,(a.bulletRadius-1)/2,"white")),l.circle(e,"shade",m,q,a.bulletRadius,d).attr("opacity",0).attr("data-i",g));return{n:c,x:m,y:q}};a.mouseover=function(a){$(a.context.svg[0][0]).find(".lines .points-layer").each(function(){$(this).find(".shade[data-i="+a.i+"]").attr("opacity",1)})};a.mouseout=function(a){$(a.context.svg[0][0]).find(".lines .points-layer").each(function(){$(this).find(".shade[data-i="+
a.i+"]").attr("opacity",0)})};a.events={mouseover:a.mouseover,mouseout:a.mouseout};var d=a.renderPerValue;return a}();m.Lines=g})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=function(){function a(){}a.render=function(a,e,d,b,n,r,h){function f(a,c){var d=$("<div/>").addClass(a);c.forEach(function(c,f){c.forEach(function(c,f){var e=$("<div />").addClass("info").appendTo(d);b&&(r||1<s)&&e.append($("<div />").addClass("box").css("background",b(q,f,a)));var g=void 0===c.orig?"-":c.orig;e.append($("<span/>").addClass("desc").text(c.info),$("<span/>").addClass("value").text(h?h(g):g));q++})});return d}var c=$("<div class=tri/>");
a=$("<div/>").addClass("popup").appendTo(a).append($("<div/>").append($("<a/>").addClass("label").attr("href",e.orig.href).text(e.label)),c);var q=0,s=k.concat(e.num).length+k.concat(e.aux).length;f("num",e.num).appendTo(a);f("aux",e.aux).appendTo(a);e=d(a[0].offsetWidth,a[0].offsetHeight);d=a.width();a.css("left",e.x+"px").css("top",e.y+"px").css("width",d+1+"px").on("mouseout",n);c.addClass(e.c);e.shift&&c.css("left",parseInt(c.css("left"))+e.shift+"px")};a.remove=function(a,e){return a&&0!=$(a.toElement).parents(".popup").andSelf(".popup").length?
!1:($(e).children(".popup").remove(),!0)};return a}();m.Popup=l})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.defaultFont=function(a,g){a.attr("font-family","noto").attr("font-size","14px").attr("fill","#000");return a};a.measure=function(a,g,e){var d=[],b=Infinity,n=Infinity,r=-Infinity,h=-Infinity;e.forEach(function(f){f=g(a.append("text")).text(f);var c=f[0][0].getBBox(),e=c.width,c=c.height;b=Math.min(b,e);n=Math.min(n,c);r=Math.max(r,e);h=Math.max(h,c);d.push({width:e,height:c});f.remove()});return{all:d,minWidth:b,minHeight:n,maxWidth:r,maxHeight:h}};
return a}();a.Text=k})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.silkviz.Colors,l=a.silkviz.Popup,p=a.silkviz.Svg,g=a.silkviz.Text,e=a.typlib.Arrays,d=function(){function a(){}a.measure=function(a,b,c){var d=c.namedAxis,n=e.mapProp(b.values,"label");a=g.measure(a.svg,c.font,n);c=c.geom.width/(a.maxWidth*b.values.length);b=1;0.3<c&&(b=3);0.4<c&&(b=2);1<c&&(b=1);d={left:void 0,top:void 0,width:void 0,height:Math.ceil(d.distance+d.thickness+d.tick+(d.namedAxis?b*(d.spacing+a.maxHeight):0))};return{text:a,area:d,drop:8,lines:b,space:10}};
a.place=function(a,b){var c=a.area;c.left=b.left;c.top=b.bottom;c.width=b.width;c.right=c.left+c.width;c.bottom=c.top+c.height};a.render=function(d,f,c,e,g){var n=e.named.area,r=c.namedAxis,l=d.svg.append("g").attr("class","axis named");p.translate(l,n.left,n.top);p.rect(l,"debug",0,0,n.width,n.height,"transparent");r.axisLine&&p.rect(l,"line",-r.thickness/2,r.distance,n.width+r.thickness,r.thickness,r.axisColor);a.renderLabels(l,d,f,c,e,g)};a.renderLabels=function(a,b,c,e,g,u){var t=g.chart,l=g.ynum,
k=g.yaux,m=g.named.area,y=g.groups,A=e.namedAxis,z=y.spare,B=[-Infinity,-Infinity,-Infinity,-Infinity];c.values.forEach(function(D,F){var C=z+F*(y.groupWidth+y.groupGap)+y.groupWeight,E=Math.round(C),G=A.distance+A.thickness,L=y.groupWidth<=g.named.drop,N=a.append("a").attr("xlink:href",D.orig.href),G=p.rect(N,"tick",Math.round(E-A.thickness/2),G,A.thickness,A.tick,A.tickColor).attr("opacity",L?0:1);if(A.namedAxis){for(var H=e.font(N.append("text")).attr("class","label").text(D.label).attr("text-anchor",
"middle").attr("x",E).attr("y",A.distance+A.thickness+A.tick+A.spacing+g.named.text.maxHeight),I=H[0][0].getBBox().width,M=Math.min(E,m.width-I/2),S=!0,P=0;P<g.named.lines;P++)if(M-I/2>=B[P]+g.named.space&&M-I/2>=z-(l?l.area.width:0)&&M+I/2<=m.width+(k?k.area.width:0)){B[P]=M+I/2;S=!1;H.attr("x",M).attr("y",A.distance+A.thickness+A.tick+A.spacing+g.named.text.maxHeight+P*(A.spacing+g.named.text.maxHeight));break}S&&H.remove()}C=p.rect(N,"indicator",C-A.thickness/2,-t.height,A.thickness,t.height,A.lineColor).attr("opacity",
0);N=p.rect(N,"overlay debug",Math.floor(E-y.groupWidth/2-y.groupGap/2),-t.height,Math.max(2,Math.ceil(y.groupWidth+y.groupGap)),t.height+A.distance+A.thickness+A.tick,"transparent");$(N[0][0]).add(H&&H[0][0]).on("mouseover",function(a){d(a,J)}).on("mouseout",function(a){r(a,J)});var J={data:c,geom:t,area:m,context:b,groups:y,cx:E,i:F,tick:G,indicator:C,label:H,events:u,conf:e,drop:L,orig:D.orig}})};a.mouseover=function(d,f){f.tick.attr("fill",f.conf.namedAxis.tickHover);f.tick.attr("opacity",1);
f.indicator.attr("opacity",1);f.label&&f.orig.href&&f.label.attr("text-decoration","underline");l.render(f.context.root,f.data.values[f.i],function(a,b){var d=f.area.left+f.cx-f.groups.groupWidth/2-20-a,e=f.area.left+f.cx+f.groups.groupWidth/2+20;if(e+a<=f.area.width)var d=e,e="left",h=f.area.top-b-20;else if(0<d)e="right",h=f.area.top-b-20;else var g=f.cx/f.area.width*(f.area.width-a),d=0<g?f.area.left+g:f.area.left+f.area.width/2-a/2,e="top",h=f.area.top+10,g=f.area.left+10+f.cx-d-a/2;return{x:d,
y:h,c:e,shift:g}},function(a,b,d){return k.rgba(f.conf.stacked?k.shade(f.conf.colors["num"==d?0:1],1-0.2*b):f.conf.colors[a])},function(c){return a.mouseout(c,f)});f.events.mouseover&&f.events.mouseover(f)};a.mouseout=function(a,b){l.remove(a,b.context.root)&&(b.tick.attr("fill",b.conf.namedAxis.tickColor),b.tick.attr("opacity",b.drop?0:1),b.indicator.attr("opacity",0),b.label&&b.label.attr("text-decoration","none"),b.events.mouseout&&b.events.mouseout(b))};var d=a.mouseover,r=a.mouseout;return a}();
m.Named=d})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.silkviz.Colors,l=a.silkviz.Popup,p=a.silkviz.Svg,g=a.silkviz.Text,e=a.typlib.Arrays,d=function(){function a(){}a.defaultConfig={margin:20,padding:1,labelThreshold:0.014,interactive:!0,legend:{visible:!0,position:"right",boxSize:20,spacing:10},donut:0};a.measure=function(a,c,b){if(b.pie.legend.visible)var e=d(a,c,b);a=b.pie.margin;c=b.pie.padding;var h="bottom"==b.pie.legend.position?Math.max(b.geom.width,b.geom.height):Math.min(b.geom.width,b.geom.height),h={width:h-
2*c,height:h-2*c,left:c,top:c};if(b.pie.legend.visible){if("right"==b.pie.legend.position){var g=b.geom.width-h.width-1*c-a,r=Math.floor(g/e.width);0<r?(e.height>0.3*b.geom.height&&(e.columns=r,e.columnWidth=Math.floor(g/e.columns),e.height/=e.columns),e.top=c,e.left=c+h.width+a,g=Math.max(e.height,h.height)+2*c):(e.top=h.top+h.height+a,e.left=c,h.left=(b.geom.width-h.width)/2,g=b.geom.width-2*c,e.columns=Math.max(1,Math.floor(g/e.width)),e.columnWidth=Math.floor(g/e.columns),e.height/=e.columns,
g=e.top+e.height+c)}"bottom"==b.pie.legend.position&&(e.top=h.top+h.height+a,g=b.geom.width-2*c,e.columns=Math.max(Math.floor(g/e.width),1),e.columnWidth=Math.floor(g/e.columns),e.height/=e.columns,e.left=0,g=e.top+e.height+c)}else h.left=(b.geom.width-h.width)/2;return{legend:e,chart:h,context:{height:g}}};a.measureLegend=function(a,c,b){var d=e.mapProp(c.values,"label"),h=b.pie.legend;a=g.measure(a.svg,b.font,d);a=h.boxSize+h.spacing+a.maxWidth;return{width:a,height:c.values.length*(h.boxSize+h.spacing)-
h.spacing,columns:1,columnWidth:a}};a.preprocess=function(a,c){for(var b=a.values,d=e.sum(b.map(function(a){return a.num[0][0].value||0})),h=0,g=[],n=0;n<b.length;n++){var r=b[n],l=r.num[0][0];if(void 0!==l.value)var p=l.value/d,m=h,h=h+2*p*Math.PI;var z=1-0.1*Math.min(6,Math.floor(n/c.colors.length)),z=k.shade(c.colors[n%c.colors.length],z);g.push({from:m,to:h,slice:p,value:r,n:l,rgba:z,clr:k.rgba(z)})}return g};a.render=function(d,c,e,h){var g=a.preprocess(c,e);d={elem:d.svg.append("g").attr("class",
"pie"),context:d,data:c,conf:e,processed:g,measurement:h};a.renderChart(d);e.pie.legend.visible&&a.renderLegend(d)};a.renderChart=function(a){var c=a.measurement.chart,b=c.height/2,d=a.elem.append("g").attr("class","chart");p.translate(d,c.left,c.top);p.rect(d,"debug",0,0,c.width,c.height,"transparent");a.processed.forEach(function(c,e){if(c.n.value){var g=d.append("a").attr("xlink:href",c.value.orig.href),n=d3.svg.arc().startAngle(c.from).endAngle(c.to).innerRadius(b*a.conf.pie.donut).outerRadius(b),
n=g.append("path").attr("class","slice").attr("d",n).attr("fill",c.clr).attr("stroke",c.clr).attr("stroke-width","1px").attr("transform","translate("+b+","+b+")"),l=d3.svg.arc().startAngle(c.from).endAngle(c.to).innerRadius(b-10).outerRadius(b),l=g.append("path").attr("class","shade").attr("d",l).attr("fill","transparent").attr("transform","translate("+b+","+b+")"),p=(c.from+c.to)/2-Math.PI/2,m=b-22,z=Math.round(1E3*c.slice)/10+"%";if(c.slice>=a.conf.pie.labelThreshold){var B=a.conf.font(g.append("text")).attr("font-size",
Math.floor(10+6*c.slice)+"px").text(z+"\n").attr("fill",k.isLight(c.rgba)?"rgba(0,0,0,0.8)":"rgba(255,255,255,0.8)"),g=B[0][0].getBBox();B.attr("x",b+m*Math.cos(p)-g.width/2).attr("y",b+m*Math.sin(p)+g.height/2-3)}if(a.conf.interactive)$(n[0][0]).add(l[0][0]).add(B&&B[0][0]).on("mouseover",function(a){r(a,D)}).on("mouseout",function(a){h(a,D)});var D={elem:n,context:a.context,data:a.data,shade:l,cx:b,cy:b,radius:b,slice:c,pct:z,i:e,svg:a.context.svg}}})};a.renderLegend=function(a,c){var b=a.measurement.legend,
d=a.conf.pie.legend.spacing,e=a.conf.pie.legend.boxSize,h=a.elem.append("g").attr("class","legend");p.translate(h,b.left,b.top);p.rect(h,"debug",0,0,b.width,b.height,"transparent");var g=0;a.processed.forEach(function(c,n){var r=g*b.columnWidth,l=Math.floor(n/b.columns)*(e+d);p.rect(h,"box",r,l,e,e,c.clr);r=a.conf.font(h.append("text")).text(c.value.label).attr("dominant-baseline","hanging").attr("x",r+e+d).attr("y",l+d/2)[0][0];l=r.getBBox().width;l>b.columnWidth&&(l=Math.ceil(c.value.label.length/
100*(Math.floor((l-b.columnWidth)/l*100)+5)),r.textContent=c.value.label.slice(0,c.value.label.length-l)+"...");g=(g+1)%b.columns})};a.mouseover=function(d,c){a.mouseout(void 0,c);c.shade.attr("fill","rgba(0,0,0, 0.2)");l.render(c.context.root,c.data.values[c.i],function(a,b){var d=(c.slice.from+c.slice.to)/2-Math.PI/2;return{x:c.cx+0.3*c.radius*Math.cos(d)-a/2,y:c.cy+0.3*c.radius*Math.sin(d)-b/2+21,c:"middle"}},function(a){return c.slice.clr},function(d){return a.mouseout(d,c)},!0,function(a){return a+
" ("+c.pct+")"})};a.mouseout=function(a,c){l.remove(a,c.context.root)&&c.shade.attr("fill","transparent")};var d=a.measureLegend,r=a.mouseover,h=a.mouseout;return a}();m.Pie=d})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.silkviz.Popup,l=a.silkviz.Svg,p=function(){function a(){}a.defaultConfig={size:6,color:"rgba(255,127,0,0.4)",background:"transparent",interactive:!0};a.measure=function(a,d,e,h,f){a=e.geom;e={left:f.area.width,top:Math.max(e.yaxis.labels?f.text.maxHeight/2:0,e.yaxis.thickness/2)+e.scatter.size/2,width:a.width-f.area.width-Math.max(e.xaxis.labels?h.text.maxWidth/2:0,e.yaxis.thickness/2),height:a.height-(e.yaxis.labels?f.text.maxHeight/2:0)-h.area.height-e.scatter.size/
2};e.right=e.left+e.width;e.bottom=e.top+e.height;return{chart:e,xaxis:h,yaxis:f}};a.render=function(a,g,r,h){var f=h.chart,c=a.svg.append("g").attr("class","scatter");l.translate(c,f.left,f.top);l.rect(c,"debug",0,0,f.width,f.height,r.scatter.background);h=g.ranges.num;var q=g.ranges.aux,s=f.width/(q.maxNice-q.minNice),u=f.height/(h.maxNice-h.minNice),t=q.minNice*s,v=h.minNice*u;g.values.forEach(function(h,q){var p=h.aux[0]&&h.aux[0][0],k=h.num[0]&&h.num[0][0];if(p&&void 0!==p.value&&k&&void 0!==
k.value){p={x:p.value*s-t,y:f.height-k.value*u+v};k=c.append("a").attr("xlink:href",h.orig.href);k=l.circle(k,"point",p.x,p.y,r.scatter.size,r.scatter.color);if(r.scatter.interactive)$(k[0][0]).on("mouseover",function(a){e(a,m)}).on("mouseout",function(a){d(a,m)});var m={circle:k,context:a,area:f,data:g,pos:p,i:q}}})};a.mouseover=function(b,d){a.mouseout(void 0,d);d.circle.attr("fill","red");k.render(d.context.root,d.data.values[d.i],function(a,b){var f=d.pos.x+d.area.left-a/2,c=Math.max(0,Math.min(d.area.left+
d.area.width-a+15,f));return{x:c,y:d.pos.y+d.area.top+30,c:"top",shift:f-c+10}},void 0,function(b){return a.mouseout(b,d)})};a.mouseout=function(a,d){k.remove(a,d.context.root)&&d.circle.attr("fill","rgba(255,127,0,0.4)")};var e=a.mouseover,d=a.mouseout;return a}();m.Scatter=p})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=a.typlib.Objects,p=function(){function a(){}a.interpolate=function(a){for(var d=a[0],e=[d],h=1;h<a.length;h++)e[2*h-1]=(d+a[h])/2,d=e[2*h]=a[h];return e};a.format=function(a,d){var e=3*Math.floor(a.log/3),h={6:"million",9:"billion",12:"trillion",15:"quadrillion",18:"quintillion"}[e];return h&&0!=d?d/Math.pow(10,e)+" "+h:d3.format(",")(d)};a.fromPipeline=function(b,d){var e=b.output.body.get(),h=b.output.headers.get(),f={num:d.stacked?a.stackAll:a.stackNone,
aux:d.stacked?a.stackAll:a.stackNone},c=a.process(b,h,e,f),e=a.describe(b,h,e,f),f=a.groupBulk(c,b,e),c=a.computeRanges(f),h={values:f,cols:h.length,desc:e,ranges:c,error:{num:!1,aux:!1}};h.error.num=e.total.num&&(isNaN(c.num.minNice)||isNaN(c.num.maxNice));h.error.aux=e.total.aux&&(isNaN(c.aux.minNice)||isNaN(c.aux.maxNice));return h};a.process=function(a,d,e,h){function f(a,c){return{value:a[0]&&a[0].number(),orig:a[0]&&a[0].value,info:c.tagNames.join(" for ")}}var c=a.print.indices("distribution"),
c=a.print.indices("numeric").concat(c);a=a.print.indices("auxnumeric");for(var g=[],s=0;s<e.length;s++){var u=e[s];g.push({label:u[0][0]&&u[0][0].value,orig:u[0][0],num:h.num(c.map(function(a){return f(u[a],d[a])})),aux:h.aux(a.map(function(a){return f(u[a],d[a])}))})}return g};a.groupBulk=function(a,d,e){var h=d.roles.byRole.maxslices.get(),h=h&&h[0];if(!h||2>h||1!==k.sum(k.concat(e.counts.num))||h>=a.length)return a;d=a.slice(0,h-1);a=a.slice(h-1);h=k.sum(a.map(l.prop("num",0,0,"value")));d.push({label:"("+
a.length+" other)",orig:{},aux:[],num:[[{info:"Total "+e.labels.num[0][0],value:h,orig:d3.format(",")(h==Math.floor(h)?h:h.toFixed(2))}]]});return d};a.stackAll=function(a){return a.length?[a]:[]};a.stackNone=function(a){return a.map(k.singleton)};a.describe=function(a,d,e,h){e=a.print.indices("distribution");e=h.num(a.print.indices("numeric").concat(e));a=h.aux(a.print.indices("auxnumeric"));h=e.map(k.len);var f=a.map(k.len),c=k.sum(h),g=k.sum(f);return{counts:{num:h,aux:f},total:{num:c,aux:g,all:c+
g},labels:{num:k.mapMap(e,function(a){return d[a].tagNames.join(" for ")}),aux:k.mapMap(a,function(a){return d[a].tagNames.join(" for ")})}}};a.niceRange=function(a,d){var e=Math.ceil(Math.log(Math.abs(a))/Math.log(10)),h=Math.ceil(Math.log(Math.abs(d))/Math.log(10)),e=Math.max(e,h)-1,h=Math.pow(10,e),f=Math.floor(a/h)*h,c=Math.ceil(d/h)*h;0>f&&0==c&&0.6>a/f&&(f+=h/2,h/=2);0<c&&0==f&&0.6>d/c&&(c-=h/2,h/=2);return{min:f,max:c,step:h,log:e}};a.mkRangeForArray=function(a){var d=k.notNull(a);a=k.min(d);
d=k.max(d);0<d&&0<a&&(a=0);0>d&&0>a&&(d=0);var g=e(a,d);return{min:a,max:d,minNice:g.min,maxNice:g.max,step:g.step,log:g.log}};a.computeRanges=function(a){function e(a){return k.concatMap(a,function(a){a=k.notNull(k.mapProp(a,"value"));var b=k.sum(a.filter(function(a){return 0<=a}));return[k.sum(a.filter(function(a){return 0>a})),b]})}var g=d(k.concatMap(k.mapProp(a,"num"),e));a=d(k.concatMap(k.mapProp(a,"aux"),e));if(0==g.min&&0==a.min){var h=a.max/g.max;0.5<h&&1>h&&(a=g);2>h&&1<h&&(g=a)}return{num:g,
aux:a}};var e=a.niceRange,d=a.mkRangeForArray;return a}();m.Data=p})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.silkviz.Data,l=a.silkviz.Svg,p=a.silkviz.Text,g=a.typlib.Arrays,e=function(){function a(){}a.defaultConfig={distance:5,spacing:10,tick:6,tickDiv:4,thickness:2,axisLine:!0,labels:!0,lines:!0,firstLast:!1,axisColor:"rgba(0,0,0,0.2)",tickColor:"rgba(0,0,0,0.2)",tickHover:"rgba(0,0,0,1.0)",lineColor:"rgba(0,0,0,0.03)",namedAxis:!0};a.measure=function(a,d,e,f){var c=e.yaxis;d=d.ranges[f];d=b(d,c.tickDiv).map(k.format.bind(null,d)).reverse();a=p.measure(a.svg,e.font,d);
c=Math.ceil(c.distance+(c.axisLine?c.thickness:0)+c.tick+(c.labels?c.spacing+a.maxWidth:0)+(c.namedAxis?c.spacing+a.maxHeight:0)+(c.labels||c.namedAxis?1:0));return{text:a,area:{left:"aux"==f?e.geom.width-c:0,top:void 0,width:c,height:void 0},ticks:d}};a.place=function(a,b,d){a.area.top=b.top;a.area.height=b.height};a.render=function(b,e,h,f,c,q){var s=f.area,u=f.ticks,t=h.yaxis,v="aux"==q,p=b.svg.append("g").attr("class","axis y-axis "+q);l.translate(p,s.left,s.top);l.rect(p,"debug",0,0,s.width,
s.height,"transparent");t.axisLine&&l.rect(p,"axis",v?t.distance:s.width-t.distance-t.thickness,-t.thickness/2,t.thickness,s.height+t.thickness,t.axisColor);t.namedAxis&&a.axisNames(q,p,e,h,f);u.forEach(function(a,b){var d=s.height/(u.length-1)*b,n=t.distance+t.thickness+t.tick;t.labels&&h.font(p.append("text")).text(a).attr("text-anchor",v?"start":"end").attr("x",v?n+t.spacing:s.width-n-t.spacing).attr("y",d+f.text.maxHeight/2-3);if(t.firstLast||0!=b&&b!=u.length-1){l.rect(p,"tick",v?t.distance+
t.thickness:s.width-n,Math.round(d-t.thickness/2),t.tick,t.thickness,t.tickColor);var n=g.sum(e.desc.counts.num),k=g.sum(e.desc.counts.aux),m="barchart"!=h.type&&"linechart"!=h.type;!t.lines||("num"!=q||!m&&k)&&("aux"!=q||!m&&n)||l.rect(p,"line",c.chart.left,Math.round(d-t.thickness/2),c.chart.width,t.thickness,t.lineColor)}})};a.axisNames=function(a,b,d,f,c){c=c.area;d=g.concat(d.desc.labels[a]).join(", ");b=f.font(b.append("text")).attr("text-anchor","middle").text(d);"num"==a&&b.attr("transform",
"rotate(-90)").attr("dominant-baseline","hanging").attr("y",1).attr("x",-c.height/2);"aux"==a&&b.attr("transform","rotate(90)").attr("dominant-baseline","hanging").attr("y",-c.width+1).attr("x",c.height/2)};a.buildTicks=function(a,b){var d=g.enumFromTo(a.minNice,a.maxNice,a.step);d.length<b&&(d=k.interpolate(d));return d};var b=a.buildTicks;return a}();m.Yaxis=e})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.silkviz.Data,l=a.silkviz.Svg,p=a.silkviz.Text,g=a.silkviz.Yaxis,e=function(){function a(){}a.measure=function(a,d,e,h){d=d.ranges[h];d=g.buildTicks(d,e.tickDiv).map(k.format.bind(null,d));a=p.measure(a.svg,e.font,d);e=e.xaxis;return{text:a,ticks:d,area:{left:void 0,top:void 0,width:void 0,height:e.distance+(e.axisLine?e.thickness:0)+e.tick+(e.labels?e.spacing+a.maxHeight:0)+(e.namedAxis?e.spacing+a.maxHeight:0)+(e.labels||e.namedAxis?5:0)}}};a.place=function(a,d){var e=
a.area;e.left=d.left;e.top=d.bottom;e.width=d.width;e.right=e.left+e.width;e.bottom=e.top+e.height};a.render=function(b,e,g,h,f,c){var q=h.area,s=g.xaxis,u=b.svg.append("g").attr("class","axis x-axis "+c);l.translate(u,q.left,q.top);l.rect(u,"debug",0,0,q.width,q.height,"transparent");s.axisLine&&l.rect(u,"line",-s.thickness/2,s.distance,q.width+s.thickness,s.thickness,s.axisColor);s.namedAxis&&a.axisNames(c,u,e,g,h);var t=h.ticks;t.forEach(function(a,c){var b=q.width/(t.length-1)*c;s.labels&&g.font(u.append("text")).text(a).attr("text-anchor",
"middle").attr("x",b).attr("y",s.distance+s.thickness+s.tick+s.spacing+h.text.maxHeight);0!=c&&c!=t.length-1&&(l.rect(u,"tick",b-s.thickness/2,s.distance+s.thickness,s.thickness,s.tick,s.tickColor),s.lines&&l.rect(u,"line",b-s.thickness/2,-f.chart.height,s.thickness,f.chart.height,s.lineColor))})};a.axisNames=function(a,d,e,h,f){var c=h.xaxis,g=f.area;h.font(d.append("text")).text(e.desc.labels[a][0][0]).attr("text-anchor","middle").attr("x",g.width/2).attr("y",c.distance+c.thickness+c.tick+c.spacing+
f.text.maxHeight+c.spacing+f.text.maxHeight)};return a}();m.Xaxis=e})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){var k=a.silkviz.Bars,l=a.silkviz.Colors,p=a.silkviz.Legend,g=a.silkviz.Lines,e=a.silkviz.Named,d=a.silkviz.Pie,b=a.silkviz.Scatter,n=a.silkviz.Text,r=a.silkviz.Xaxis,h=a.silkviz.Yaxis,f=function(){function a(){}a.defaultConfig={geom:{width:800,height:600},colors:$.extend(!0,[],l.defaultColors),font:n.defaultFont,bars:k.defaultConfig,lines:g.defaultConfig,pie:d.defaultConfig,scatter:b.defaultConfig,namedAxis:h.defaultConfig,xaxis:h.defaultConfig,yaxis:h.defaultConfig,legend:p.defaultConfig};
a.render=function(b,d,f,e,h,g){d.css("width",h+"px");d.css("height",g+"px");d.empty();e.geom.width=h;e.geom.height=g;d.css("position","relative");h={svg:d3.select(d[0]).append("svg").attr("width",e.geom.width).attr("height",e.geom.height).attr("class",e.debug?"debug":""),root:d[0]};var n;switch(b){case "barchart":n=a.barChart(h,f,e);break;case "linechart":n=a.lineChart(h,f,e);break;case "piechart":n=a.pieChart(h,f,e);break;case "donutchart":n=a.pieChart(h,f,e);break;case "scatterplot":n=a.scatterPlot(h,
f,e);break;case "stackchart":n=a.stackChart(h,f,e)}d.height(h.svg.attr("height"));return n};a.pieChart=function(a,c,b){if(1>c.desc.total.all||c.error.num)return"not_enough_data";if(0>c.ranges.num.min)return"negative_values_for_pie";var f=d.measure(a,c,b);d.render(a,c,b,f);f.context.height&&a.svg.attr("height",f.context.height);return"ok"};a.scatterPlot=function(a,c,d){if(2>c.desc.total.all||c.error.num||c.error.aux)return"not_enough_data";var f=r.measure(a,c,d,"aux"),e=h.measure(a,c,d,"num"),g=b.measure(a,
c,d,f,e);h.place(e,g.chart,"num");r.place(f,g.chart);var n=c.desc.counts;n.num.length&&h.render(a,c,d,e,g,"num");n.aux.length&&r.render(a,c,d,f,g,"aux");b.render(a,c,d,g);return"ok"};a.lineChart=function(b,d,f){return a.lineOrBarChart(g,b,d,f)};a.barChart=function(b,d,f){return a.lineOrBarChart(k,b,d,f)};a.stackChart=function(b,d,f){return a.lineOrBarChart(k,b,d,f)};a.lineOrBarChart=function(a,c,b,d){if(1>b.desc.total.all||b.error.num||b.error.aux)return"not_enough_data";var f=b.desc.counts,g=d.yaxis&&
0<f.aux.length,f=d.yaxis&&0<f.num.length&&h.measure(c,b,d,"num"),g=g&&h.measure(c,b,d,"aux"),n=d.namedAxis&&e.measure(c,b,d),r=a.measure(c,b,d,f,g,n),l=d.legend&&p.measure(c,b,d);r.legend=l;f&&h.place(f,r.chart,"num");g&&h.place(g,r.chart,"aux");n&&e.place(n,r.chart);l&&p.place(l,r.named.area);f&&h.render(c,b,d,f,r,"num");g&&h.render(c,b,d,g,r,"aux");a.render(c,b,d,r);n&&e.render(c,b,d,r,a.events);l&&p.render(c,b,d,r);c.svg.attr("height",d.geom.height+(l?l.area.height:0));return"ok"};return a}();
m.Chart=f})(a.silkviz||(a.silkviz={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.query.Roles,p=a.reactive.Value,g=a.silkviz.Chart,e=a.silkviz.Data,d=a.typlib.Arrays,b=a.typlib.CleanupPool,n=a.typlib.ThreadEnd,r=function(){function a(c,d,f,e,g){var q;this.render=this.render.bind(this);this.calcGeometry=this.calcGeometry.bind(this);var n=this;this.fixLayout=function(){var c=arguments;setTimeout(function(){a.prototype.fixLayout.apply(n,c)},0)};if(q=function(a,c,d,f,e){this.pool=new b;this.document=a;this.tagList=d;this.pipeline=
c;this.message=f;this.type=e;this.node=null;this.geom={width:(new p(0)).name("SilkViz.width"),height:(new p(0)).name("SilkViz.height")};this.setupNode();this.calcGeometry();this.pool.push(p.onchange(this.render)(this.geom.width,this.geom.height,this.pipeline.output.headers,this.pipeline.output.body))}.apply(q||this,arguments))return q}a.migratePipeline=function(a,c,b,f,e){var h=c.roles.byRole,g=d.concat([h.column.get(),h.numeric.get(),h.group.get()]).filter(function(c){return!l.isPageTitle(c.relation)&&
0.2<a.findByUriOrCreate(c.relation[0],!0).types.eligibleAsNumber()}),q=d.concat([h.auxnumeric.get()]),n=d.concat([h.distribution.get(),h.group.get(),h.column.get()]).filter(function(c){return!l.isPageTitle(c.relation)&&a.findByUriOrCreate(c.relation[0],!0).isEnum()}),r=h.maxslices.get()||[];c.roles.resetAllExcept("collection","order");0===f&&(g=g.concat(q));0===b&&(q=q.concat(g));e&&h.maxslices.set([r[0]||12]);if(g.length||q.length)c.roles.set("numeric",void 0===b?g:g.slice(0,b)),c.roles.set("auxnumeric",
void 0===f?q:q.concat(g.slice(b)).slice(0,f));else if(n.length)return h.distribution.set(n.slice(0,1))};a.configuration=function(a,c){var b=$.extend(!0,{},g.defaultConfig);b.type=a;b.debug=!1;b.interactive=!0;250>=c?(b.lines.bullets=100,b.legend.marginRight=0,b.legend.twoSided=!1,b.yaxis.distance=0,b.yaxis.namedAxis=!1,b.yaxis.spacing=5,b.yaxis.thickness=2,b.yaxis.tick=4,b.yaxis.tickDiv=2,b.scatter.size=3,b.scatter.color="rgba(255,127,0,0.2)",b.pie.margin=15,b.pie.labelThreshold=0.036,b.pie.legend.position=
"bottom",b.pie.legend.boxSize=20,b.pie.legend.spacing=5,b.pie.legend.visible=!0,b.namedAxis=$.extend(!0,{},b.yaxis),b.xaxis=$.extend(!0,{},b.yaxis)):800>=c&&(b.yaxis.spacing=5,b.scatter.size=4,b.pie.margin=15,b.pie.labelThreshold=0.018,b.pie.legend.boxSize=20,b.pie.legend.spacing=10,b.namedAxis=$.extend(!0,{},b.yaxis),b.xaxis=$.extend(!0,{},b.yaxis));b.stacked="stackchart"==b.type;"scatterplot"==b.type&&(b.yaxis.distance=0,b.xaxis.distance=0);if("barchart"==b.type||"stackchart"==b.type||"linechart"==
b.type)b.yaxis.axisLine=!1,b.yaxis.namedAxis=!1,b.yaxis.spacing=5,b.yaxis.firstLast=!0,b.namedAxis.axisLine=!1;"donutchart"==b.type&&(b.pie.donut=0.6);return b};a.unknonwnError=function(){return $("<div />").addClass("message").append("<div><strong>Uknown error</strong><br>Reconfigure the visualization for a better result.</div>")};a.negativeResults=function(){return $("<div />").addClass("message").append("<div><strong>Negative values in result data</strong><br>Negative values cannot be plotted on pie and donut charts. Pick another visualization for a better result.</div>")};
a.noNumericsMessage=function(){return $("<div />").addClass("message").append("<div><strong>Not enough numeric explore results available</strong><br>To show data on the chart pick a tag with numeric values or pick a tag to plot as distribution.</div>")};var f=a.configuration,c=a.unknonwnError,q=a.negativeResults,r=a.noNumericsMessage;a.SilkViz=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.setupNode=function(){this.node=$("<div/>");this.fixLayout()};a.prototype.rerender=function(){this.render(this.geom.width.get(),
this.geom.height.get(),this.pipeline.output.headers.get(),this.pipeline.output.body.get())};a.prototype.render=function(a,b,d,h){n.onThreadEnd(function(a,b,d,h){if(d&&h&&h.length&&a&&b&&this.node.parent().length)switch(d=f(this.type,a),h=e.fromPipeline(this.pipeline,d),g.render(this.type,this.node,h,d,a,b)){case "not_enough_data":return this.message.errorResult(r());case "negative_values_for_pie":return this.message.errorResult(q());case "ok":break;default:return this.message.errorResult(c())}}.bind(this),
arguments,"SilkViz.render",this)};a.prototype.fixLayout=function(a){this.calcGeometry(a)};a.prototype.calcGeometry=function(a){if(this.node.parents().length){if("embed"==this.document.type){a=$(document.body).width()-20;var c=$(document.body).height()-150}else a||(a=this.node.parents(".layout"),a.length?(c=3,a.hasClass("content")&&(c=2),a.hasClass("meta")&&(c=1),a=250*c+60*(c-1)):a=this.node.parents("[data-component-uri]").parent().width()),c=400<=a?c=0.6*a:0.8*a;this.geom.width.set(a);this.geom.height.set(c)}};
return a}();k.SilkViz=r})(m.silkviz||(m.silkviz={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.component.silkviz.SilkViz,p=function(){function a(e,d,b,g,r){var h;if(h=function(a,c,b,d,e){this.chart=new l(a,c,b,e,"barchart");this.node=this.chart.node}.apply(h||this,arguments))return h}a.migratePipeline=function(a,d){return l.migratePipeline(a,d)};a.label="Bar Chart";a.shortId="barchart";a.uri="//silk.co/2014/widget/queryiew/silkviz/barchart/1";a.multi=!0;a.aux=!0;a.BarChart=a;a.prototype.cleanup=function(){this.chart.cleanup()};a.prototype.fixLayout=
function(a){this.chart.calcGeometry(a)};return a}();k.BarChart=p})(m.silkviz||(m.silkviz={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.component.silkviz.SilkViz,p=function(){function a(e,d,b,g,r){var h;if(h=function(a,c,b,d,e){this.chart=new l(a,c,b,e,"linechart");this.node=this.chart.node}.apply(h||this,arguments))return h}a.migratePipeline=function(a,d){return l.migratePipeline(a,d)};a.label="Line Chart";a.shortId="linechart";a.uri="//silk.co/2014/widget/queryiew/silkviz/linechart/1";a.multi=!0;a.aux=!0;a.LineChart=a;a.prototype.cleanup=function(){this.chart.cleanup()};a.prototype.fixLayout=
function(a){this.chart.calcGeometry(a)};return a}();k.LineChart=p})(m.silkviz||(m.silkviz={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.CleanupPool,p=a.component.silkviz.SilkViz,g=function(){function a(b,e,g,h,f){var c;if(c=function(a,c,b,f,e){this.pool=new l;this.chart=new p(a,c,b,e,"piechart");this.node=this.chart.node;d(this.pool,c,this.chart)}.apply(c||this,arguments))return c}a.setup=function(a,d,e){a.push(e,d.roles.byRole.numeric.onchange(function(a){void 0!==a&&a.length&&d.roles.byRole.order.set([$.extend(!0,{direction:"desc"},a[0])])}),d.roles.byRole.maxslices.onchange(e.rerender.bind(e)))};
a.migratePipeline=function(a,d,e){p.migratePipeline(a,d,1,0,!0)};a.label="Pie Chart";a.shortId="piechart";a.uri="//silk.co/2014/widget/queryiew/silkviz/piechart/1";a.multi=!1;a.aux=!1;var d=a.setup;a.PieChart=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.fixLayout=function(a){this.chart.calcGeometry(a)};return a}();k.PieChart=g})(m.silkviz||(m.silkviz={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.CleanupPool,p=a.component.silkviz.SilkViz,g=a.component.silkviz.PieChart,e=function(){function a(b,d,e,h,f){var c;if(c=function(a,c,b,d,f){this.pool=new l;this.chart=new p(a,c,b,f,"donutchart");this.node=this.chart.node;g.setup(this.pool,c,this.chart)}.apply(c||this,arguments))return c}a.migratePipeline=function(a,d){p.migratePipeline(a,d,1,0,!0)};a.label="Donut Chart";a.shortId="donutchart";a.uri="//silk.co/2014/widget/queryiew/silkviz/donutchart/1";
a.multi=!1;a.aux=!1;a.DonutChart=a;a.prototype.cleanup=function(){this.chart.cleanup()};a.prototype.fixLayout=function(a){this.chart.calcGeometry(a)};return a}();k.DonutChart=e})(m.silkviz||(m.silkviz={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.component.silkviz.SilkViz,p=function(){function a(e,d,b,g,r){var h;if(h=function(a,c,b,d,e){this.chart=new l(a,c,b,e,"scatterplot");this.node=this.chart.node}.apply(h||this,arguments))return h}a.migratePipeline=function(a,d){return l.migratePipeline(a,d,1,1)};a.label="Scatter Plot";a.shortId="scatterplot";a.uri="//silk.co/2014/widget/queryiew/silkviz/scatterplot/1";a.multi=!0;a.aux=!0;a.ScatterPlot=a;a.prototype.cleanup=function(){this.chart.cleanup()};
a.prototype.fixLayout=function(a){this.chart.calcGeometry(a)};return a}();k.ScatterPlot=p})(m.silkviz||(m.silkviz={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.component.silkviz.SilkViz,p=function(){function a(e,d,b,g,r){var h;if(h=function(a,c,b,d,e){this.chart=new l(a,c,b,e,"stackchart");this.node=this.chart.node}.apply(h||this,arguments))return h}a.migratePipeline=function(a,d){return l.migratePipeline(a,d)};a.label="Stack Chart";a.shortId="stackchart";a.uri="//silk.co/2014/widget/queryiew/silkviz/stackchart/1";a.multi=!0;a.aux=!0;a.StackChart=a;a.prototype.cleanup=function(){this.chart.cleanup()};a.prototype.fixLayout=
function(a){this.chart.calcGeometry(a)};return a}();k.StackChart=p})(m.silkviz||(m.silkviz={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.component.GroupBy,p=a.component.List,g=a.component.Map,e=a.component.Table,d=a.component.pagegrid.View,b=a.component.silkviz.BarChart,n=a.component.silkviz.LineChart,r=a.component.silkviz.PieChart,h=a.component.silkviz.DonutChart,f=a.component.silkviz.ScatterPlot,c=a.component.silkviz.StackChart,q=function(){function a(){}a.byShortId=function(){return{table:e,list:p,map:g,pagegrid:d,groupby:l,piechart:r,barchart:b,linechart:n,columnchart:b,scatterplot:f,
donutchart:h,stackchart:c}};a.byUri=function(){var c={},b=a.byShortId(),d;for(d in b)c[b[d].uri]=b[d];return c};a.shortId=function(c){var b=a.byShortId(),d;for(d in b)if(b[d]==c)return d};a.find=function(c){return a.byUri()[c]};return a}();k.Registry=q})(m.queryviewer||(m.queryviewer={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.query.Data,p=a.client.query.Roles,g=a.client.tagging.Suggestions,e=a.component.queryviewer.Registry,d=a.typlib.Functions,b=function(){function a(){}a.makeTagQueryLink=function(a,d,f,e,h,g){var n=l.emptyJson();n.view=b(a.types);d&&(n.roles.collection=d);a.isEnum()?(f&&n.filters.push({type:"enum",values:[f],relation:p.PageTitle}),e&&n.filters.push({type:"enum",values:[e],relation:[a.uri]})):(f&&n.filters.push({type:"equals",values:[f],relation:p.PageTitle}),
e&&n.filters.push({type:"equals",values:[e],relation:[a.uri]}));h&&n.filters.push({type:"matches",values:[h],relation:p.PageTitle});g&&n.filters.push({type:"matches",values:[g],relation:[a.uri]});n.view.match(/chart/)?n.roles.numeric.push({relation:[a.uri]}):n.view.match(/pagegrid/)?(n.roles.image.push({relation:[a.uri]}),n.slice={offset:0,count:40}):n.roles.column.push({relation:[a.uri]});return n};a.makeContextQueryLink=function(a,d,f,e){var g=l.emptyJson();g.view=b(a.types);g.roles.collection=
[a.uri];g.roles.order.push({direction:"asc",relation:p.PageTitle});d&&(a=h(a.uri,d,e),g.view.match(/pagegrid/)&&(a.image&&g.roles.image.push({relation:[a.image]}),a.description&&g.roles.description.push({relation:[a.description]})),a.extra.forEach(function(a){g.roles.column.push({relation:[a]})}));f&&g.filters.push({type:"matches",relation:p.PageTitle,values:[f]});return g};a.typeToQueryViewType=function(a){var b=e.byShortId();switch(a.mostLikely()){case "date":return b.list.uri;case "image":return b.pagegrid.uri;
case "video":return b.pagegrid.uri;case "numeric":return b.columnchart.uri;case "currency":return b.columnchart.uri;default:return b.table.uri}};a.computeInterestingColumnSelection=function(a,b,d){var e=window.Silk.domain.tagList,h=e.findByUri(a),n=h?h.docLevelCount.get():0,h=e.getContext(a).list,r=g.mostCommonOfType("image",h);r&&(b-=1,h=h.filter(function(a){return a!=r}));var l=d&&f(e,a);l&&(b-=1,h=h.filter(function(a){return a!=l}));b=h.sort(function(b,d){return Math.abs(n-b.context.get(a)*b.count)-
Math.abs(n-d.context.get(a)*d.count)}).slice(0,Math.max(0,b)).map(function(a){return a.uri});return{description:l&&l.uri,image:r&&r.uri,extra:b}};a.getDescriptionTagForDocTag=function(a,b){return a.tags.list.filter(function(a){return a.context.get(b)}).sort(function(a,c){return d.compare(c.textLength,a.textLength)})[0]};var b=a.typeToQueryViewType,h=a.computeInterestingColumnSelection,f=a.getDescriptionTagForDocTag;return a}();k.NavQuery=b})(m.nav||(m.nav={}))})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.tagging.Suggestions,p=a.reactive.Node,g=a.reactive.Functions,e=a.typlib.Arrays,d=a.typlib.CleanupPool,b=a.typlib.Strings,n=a.ui.Bubble,r=a.ui.input.Selectbox,h=a.silk.nav.NavLinks,f=a.silk.nav.NavQuery,c=function(){function a(c,b,f,e){var h;this.cleanup=this.cleanup.bind(this);this.createBubble=this.createBubble.bind(this);this.remove=this.remove.bind(this);this.onSelect=this.onSelect.bind(this);this.onFilter=this.onFilter.bind(this);this.byUri=
this.byUri.bind(this);this.onBlur=this.onBlur.bind(this);var g=this;this.onInput=function(){var c=arguments;g["__delayed_toh_MediaTagUI.onInput__"]&&clearTimeout(g["__delayed_toh_MediaTagUI.onInput__"]);g["__delayed_toh_MediaTagUI.onInput__"]=setTimeout(function(){a.prototype.onInput.apply(g,c);g["__delayed_toh_MediaTagUI.onInput__"]=null},200)};if(h=function(a,c,b,f){this.pool=new d;this.anchor=c;this.document=b;this.tagList=f;this.tagPicker=null;this.type=a;this.show=this.tag=this.tagUri=this.label=
null;this.setupBoxes();this.setupTag();this.setupLabel();this.setupBubble()}.apply(h||this,arguments))return h}a.MediaTagUI=a;a.prototype.cleanup=function(){this.pool.cleanup();this.input.off("blur")};a.prototype.setupBoxes=function(){this.input=$("<input placeholder='not tagged yet' />");this.input.on("blur",this.onBlur);this.pool.push(this.selectbox=new r(this.input,r.Fixed));this.selectbox.onSelect=this.onSelect;this.selectbox.onFilter=this.onFilter};a.prototype.setupTag=function(){this.tagUri=
p.node(this.anchor[0]).attributes.get("data-tag-uri");this.tag=this.tagUri.map(this.byUri).name("MediaTagUI.tag");this.show=this.tag.bindProp("showAsMedia").name("MediaTagUI.show")};a.prototype.setupLabel=function(){var a=this.document.categoryTracking.category.get(),c=$("<span class=vis-icon />");c.click(function(){var a=this.tag.get();a&&(a.showAsMedia.set(!a.showAsMedia.get()),a.save())}.bind(this));var b=this.type,d=$("<a class=name data-view-mode-only tabindex=-1 />").rText(this.tag.map(function(a){return a?
a.name:"Tag this "+b})).rAttr("href",this.tag.map(function(c){var b=a?[a]:[];return c?h.createForExplore(f.makeTagQueryLink(c,b)):""}));this.label=$("<div class=tag-name />").append(d,c).rToggleClass("disabled",g.not(this.tagUri)).rSwitchClass("visible","hidden",this.tag.bindProp("showAsMedia"))};a.prototype.setupBubble=function(){var a=this.anchor.parents(".layout").hasClass("meta"),c=this.document;this.bubbleRef=n.click(this.label.find("a.name"),this.createBubble,300,void 0,this.label,{position:a?
"right":"left",elementPadding:10,predicate:function(a){var b=c.editing.get();b&&(a.preventDefault(),a.stopPropagation());return b}},void 0)};a.prototype.createBubble=function(){this.addSuggestions();var a=this.input,c=this.tag.get();a.val(c?c.name:"");a.css("width","242px");setTimeout(function(){a.focus()});$(a).on("input",this.onInput);c=$("<div class=remove></div>").click(this.remove);c.rToggleClass("disabled",g.not(this.tagUri));return $("<div class='picker-bubble media-tag-ui' />").append(c,a,
this.selectbox.node)};a.prototype.remove=function(){this.input.val("");this.selectbox.render();this.update()};a.prototype.onInput=function(){this.update()};a.prototype.update=function(){window.Silk.canvas.document.get().undoManager.startAction("update");var a=this.input.val();this.tagUri.set(a.length?this.tagList.findByNameOrCreate(a,!0).uri:void 0);window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.onSelect=function(a){this.input.val(a.item);this.selectbox.render();this.update();
this.bubbleRef.close()};a.prototype.onFilter=function(a){var c=this.input.val(),b=e.any(function(a){return a.label.toLowerCase()===c.toLowerCase()},a)||!c?[]:[{label:c,item:c}];return e.append(this.selectbox.filterLabelByInput(!1,a),b)};a.prototype.suggest=function(){var a=this.document.categoryTracking.category.get(),a=a&&l.mostLikelyOfType(this.type,this.tagList,this.tagList.findByUri(a))[0]||b.prettyCapitalize(this.type);return this.tagList.findByNameOrCreate(a)};a.prototype.addSuggestions=function(){this.document.categoryTracking.category.get();
var a=this.type,c=this.tagList.tags.list.filter(function(c){return c.types.is(a)});this.selectbox.clear();c.forEach(function(a){this.selectbox.addItem(a.name)}.bind(this))};a.prototype.byUri=function(a){return a&&this.tagList.findByUriOrCreate(a)};a.prototype.onBlur=function(){this.tag.get()&&this.tag.get().save()};a.prototype.bubbleRef=void 0;a.prototype.input=void 0;a.prototype.selectbox=void 0;return a}();k.MediaTagUI=c})(m.image||(m.image={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.parseHTMLFromString=function(a){if(a){try{if((new window.DOMParser).parseFromString("","text/html"))return(new window.DOMParser).parseFromString(a,"text/html").body.childNodes}catch(g){}var e=window.document.implementation.createHTMLDocument("");e.body.innerHTML=a;return e.body.childNodes}};return a}();a.DOMParser=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=a.typlib.DOMParser,p=function(){function a(){}a.setupUpload=function(b,d,h){return e(b,d,h).then(a.uploadUrlOrFile)};a.prepareUpload=function(a,b,d){function f(f){a.off("dragover drop");e.off("change");b.off("click");f.preventDefault();f.stopPropagation();f=this.files||f.originalEvent.dataTransfer;var g=this.files||f.files,t=0;try{t=g.length}catch(p){}if(t){if(d){var k=!1;d.forEach(function(a){k=/^\*\./.test(a)?k|!!g[0].name.match(a.substr(2)+"$"):
k|g[0].type==a});if(!k){c.reject("whitelist",g[0].type);return}}c.resolve(g[0])}else f.getData?(t=$(l.parseHTMLFromString(f.getData("text/html"))),f=t.filter("img").attr("src")||t.find("img").attr("src")||f.getData("text/uri-list")||f.getData("text/plain"),c.resolve(f)):c.reject()}var c=$.Deferred(),e=$('<input type="file" />');a.off("dragover");a.off("drop");b.off("click");e.off("change");a.on("dragover",function(a){a.stopPropagation();a.preventDefault()});a.on("drop",f);b.siblings("input[type=file]").remove();
e.hide();e.insertAfter(b);b.on("click",function(){e.click()});e.on("change",f);return c};a.uploadUrlOrFile=function(a){return a instanceof window.File?d(a):{url:b(a),name:k.last((new Uri(a)).path().split("/")),mimetype:void 0}};a.uploadSingleFile=function(a){return window.Silk.api.File.create({name:a.fileName||a.name}).then(function(d){return window.Silk.api.File.saveById(d.uuid,a,void 0,void 0,void 0,{processData:!1,beforeSend:function(b,d){d.withCredentials=!0;d.data=a}}).then(function(d){return{url:b(this.url),
name:d.name,mimetype:a.type}})}).then(void 0,function(a,b,d){return $.Deferred().reject("filesize",{xhr:a,stat:b,err:d}).promise()})};a.fileSizeAlert=function(a){console.log("uploading failed",a.xhr,a.stat,a.err);alert("Uploading failed. File size has to be smaller than 10MB.")};a.normalizeUrl=function(a,b){function d(a){return a.replace(".silkapp.com$",".silk.co").replace(".silk$",".co")}if(void 0===a||null===a)return null;var f=new Uri(a);f.setHost(d(f.host()));var c=b||window.location.host,e=f.path(),
g;if(f.host()==d(c)){if(e.match(/^\/s\/api/))return e.replace("/site/uri/"+c,"/site/current")}else if(f.host().match(/\.cloudfront.net$/)&&(g=e.match(/^\/(?:v[0-9.]+|latest)\/site\/uri\/([^\/]+)\//)))return g[1]===c?"/s/api"+e.replace("/site/uri/"+c,"/site/current"):"//api."+(window.Silk&&window.Silk.paths&&window.Silk.paths.loginHost||"silk.co")+e;return f.toString()};var e=a.prepareUpload,d=a.uploadSingleFile,b=a.normalizeUrl;return a}();m.FileUpload=p})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.client.query.render.Image,g=a.client.renderui.Image,e=a.component.Pinned,d=a.component.image.Adjusting,b=a.component.image.MediaTagUI,n=a.reactive.Functions,r=a.reactive.Node,h=a.typlib.FileUpload,f=a.ui.Lightbox,c=function(){function a(c,b,d){var e;this.setupEditingNodes=this.setupEditingNodes.bind(this);this.linkError=this.linkError.bind(this);this.imgClick=this.imgClick.bind(this);this.setSrc=this.setSrc.bind(this);
this.onSrcSet=this.onSrcSet.bind(this);var h=this;this.prepareUpload=function(){var c=arguments;setTimeout(function(){a.prototype.prepareUpload.apply(h,c)},0)};if(e=function(a,c,b){this.canvas=b;this.document=c;this.json=this.tag=this.tagUri=this.src=this.oldSrc=this.image=this.container=this.anchor=this.node=null;this.lightbox=new f;l.linkToNode(this,a,"image");this.setupNodes();this.setupTagUI();this.setupTag();this.setupUrl();this.prepareUpload();this.fixLayout()}.apply(e||this,arguments))return e}
a.configureNode=function(a,c){if(c){var b=$("<a />").appendTo(a);c.tag&&(b.attr("data-tag-uri",c.tag),a.attr("data-mentioned-tag-uri",c.tag));c.href&&b.attr("href",c.href);b=$("<div class=clip-container />").appendTo(b);b=$("<div class=offset-container />").appendTo(b);$("<div class=zoom-container />").appendTo(b).append($("<img />").attr("src",c.src||"").attr("title",c.title||""))}return a};a.uri=k.Image;a.info={name:"image",text:"Image"};var c=a;a.Image=a;a.prototype.cleanup=function(){this.editingOnChange&&
this.editingOnChange.unlink();this.image&&this.image.off("error");this.inputbox&&this.inputbox.cleanup();this.adjusting&&this.adjusting.cleanup();this.tag&&this.tag.unlink();this.lightbox&&this.lightbox.cleanup()};a.prototype.isDynamic=function(){return this.node.is("[data-mentioned-tag-uri]")||e.findPinnedParent(this.node)};a.prototype.fixLayout=function(a){this.adjusting&&this.adjusting.fixLayout(a)};a.prototype.setupNodes=function(){var a=r.node(this.node[0]).classes();a.remove(1,a.length().get()-
1);if(this.node.find("[data-image-json]").length){this.anchor=this.node.children("a");var c=r.node(this.anchor[0]);this.alt=this.anchor.text()||"";this.src=c.attributes.get("data-image-src");this.mimetype=c.attributes.get("data-image-mimetype");this.json=c.attributes.get("data-image-json");this.node.children().not("a").remove();this.setupEditingNodes()}else{try{c=JSON.parse(this.node.find("a").attr("data-normalized-image"))}catch(b){}c=c&&c.normalized||{};this.anchor=this.node.children("a");this.anchor.length||
this.node.append(this.anchor=$("<a/>"));this.alt=this.anchor.text()||"";a=window.Silk;c.src=c.src?g.publicFileFromCDNInProduct(c.src,a.domain.repository,a.paths.fileCdn):"";this.node.children().not("a").remove();this.anchor.children().remove();this.src=r.node(this.anchor[0]).attributes.get("data-image-src");this.mimetype=r.node(this.anchor[0]).attributes.get("data-image-mimetype");this.json=r.node(this.anchor[0]).attributes.get("data-image-json");this.src.set(c.src);this.mimetype.set(c.mimetype||
void 0);this.json.set(JSON.stringify(c));this.document.editing.get()?this.setupEditingNodes():this.setupVisualizationNodes(c)}};a.prototype.setupVisualizationNodes=function(a){p.render({types:{image:{normalized:a}}},this.anchor,{});this.editingOnChange=this.document.editing.onchange(this.setupEditingNodes);this.setupClick();this.setupImage()};a.prototype.setupEditingNodes=function(){this.document.editing.get()&&!this.adjusting&&(this.anchor.children().remove(),this.anchor.append(this.container=$("<div class=clip-container />").append($("<div class=offset-container />").append($("<div class=zoom-container />").append($("<img/>").attr("src",
this.src.get()).attr("alt",this.alt))))),this.setupClick(),this.setupImage(),this.setupAdjusting(),this.prepareUpload())};a.prototype.setupTagUI=function(){this.isDynamic()||(this.tagUI=new b("image",this.anchor,this.document,this.canvas.domain.tagList),this.tagUI.label.appendTo(this.node))};a.prototype.setupUrl=function(){this.src.onchange(function(a,c){this.onSrcSet(a);this.oldSrc=c}.bind(this));$(this.node).rAddClass(n.cond(this.src,"","empty"))};a.prototype.linkError=function(){this.src.get()&&
(console.log("Couldn't find valid image",this,this.src.get()),this.image[0]!=this.node.find("img")[0]&&(this.setupImage(),this.setupClick()))};a.prototype.setupImage=function(){this.image=this.node.find("img");this.image.on("error",this.linkError)};a.prototype.setupTag=function(){this.tagUri=r.node(this.anchor[0]).attributes.get("data-tag-uri");var a=window.Silk.domain.tagList;this.tag=this.tagUri.map(function(c){return c&&a.findByUriOrCreate(c,!0)}).name("Image.tag");this.node.rAddClass(n.cond(this.tagUri,
"tagged","untagged"))};a.prototype.setupClick=function(){this.anchor.children().click(this.imgClick)};a.prototype.setupAdjusting=function(){this.adjusting=new d(this.json,this.image,this.document.editing,this.document.undoManager)};a.prototype.autoTag=function(){this.isDynamic()||this.tagUri.get()||this.tagUri.set(this.tagUI.suggest().uri)};a.prototype.onPin=function(){this.tagUri.set(null);this.tagUI&&(this.tagUI.label.remove(),this.tagUI=null)};a.prototype.onUnpin=function(){this.setupTagUI()};
a.prototype.imgClick=function(){this.document.editing.get()||this.lightbox.openForImage(this.src.get(),this.alt)};a.prototype.prepareUpload=function(){function a(c,d){"whitelist"===c?alert("Uploading failed. Only images are allowed. (BMP, PNG, JPG, GIF, SVG)"):h.fileSizeAlert(d);b.prepareUpload()}function c(a){b.canvas.document.get()==b.document&&b.setSrc(a.url,a.mimetype);b.prepareUpload()}var b=this,d=$(".upload-ui, a",this.node),f=$(".upload-ui",this.node);"bookmarklet"===window.Silk.silkType&&
window.Silk.bookmarkletData.images&&window.Silk.bookmarkletData.images.length?f.click(function(){window.Silk.pickImage(b)}):h.setupUpload(d,f,["image/bmp","image/png","image/jpeg","image/gif","image/svg+xml"]).then(c,a)};a.prototype.setSrc=function(a,c){window.Silk.canvas.document.get().undoManager.startAction("setSrc");this.document.editing.get()&&(this.src.set(a),this.mimetype.set(c));window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.onSrcSet=function(a){this.document.editing.get()&&
(this.image.attr("src",a),a&&this.autoTag())};a.prototype.serializeToXML=function(a){a=l.createNode(c);var b=$("<a/>").appendTo(a);this.tagUri.get()&&b.attr("data-tag-uri",this.tagUri.get());var d=JSON.parse(this.json.get());d.src=this.src.get();d.mimetype=this.mimetype.get();b.attr("data-normalized-image",JSON.stringify({accuracy:1,manual:!0,normalized:d}));return a[0]};a.prototype.affectsDirtyState=function(a){var c=["data-tag-uri","data-image-json","data-image-src"];return a.target==this.anchor[0]&&
!a.type||a.target==this.anchor[0]&&-1!=c.indexOf(a.attribute)||a.target==this.node[0]&&"class"!=a.attribute};a.prototype.adjusting=void 0;a.prototype.alt=void 0;a.prototype.inputbox=void 0;a.prototype.tagUI=void 0;a.prototype.editingOnChange=void 0;a.prototype.mimetype=void 0;return a}();m.Image=c})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Functions,p=a.client.model.Component,g=a.typlib.Images,e=a.typlib.Svg,d=function(){function a(){}a.createUI=function(d,r,h,f){function c(c,d){$("<div class=action/>").appendTo(r).append(a.icons[c].clone()).addClass(c).click(d)}var q=a.icons=a.icons||{};q.remove=q.remove||e.renderIcon(g.cross(4),20,20,0.4);q.cut=q.cut||e.renderIcon(g.scissors,20,20,0.6);q.drag=q.drag||e.renderIcon(g.move(7,1.6,7),20,20,0.55);q.edit=q.edit||e.renderIcon(g.pencil,
20,20,0.55);q.pin=q.pin||e.renderIcon(g.pin,20,20,0.6);f||c("remove",l.partial(p.remove,d));h&&h.forEach(function(a){c(a.cls,a.handler)})};a.serialize=function(a,b){var d=a.node[0].cloneNode(!1);$(d).removeAttr("style");var f=a.node.contents().filter(function(a,b){return 0>(" "+b.className+" ").indexOf(" block-ui ")});b.serializeChildNodes(d,f);return d};return a}();k.Blocks=d})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Blocks,p=a.client.model.Component,g=a.component.Pinned,e=a.reactive.Functions,d=a.reactive.Node,b=a.typlib.CleanupPool,n=a.ui.Bubble,r=function(){function a(c,d,f){var e;this.edit=this.edit.bind(this);this.cut=this.cut.bind(this);this.fixLayout=this.fixLayout.bind(this);if(e=function(a,c,d){this.component=this.innerComponent=this.ui=null;this.document=c;this.canvas=d;this.pool=new b;p.linkToNode(this,a,"block");this.setupComponent();
this.setupBlockUI()}.apply(e||this,arguments))return e}a.makeBlockUI=function(a,b,d,e){function h(a,c,b){c&&r.push({cls:a,handler:b||function(){}})}var g=p.getInfo(b);d.find(".block-ui").remove();var n=$("<div class=block-ui />").appendTo(d),r=[];h("edit",!!b.edit,a.edit);h("cut",!g.uncuttable,a.cut);h("drag",!0);h("pin",!g.unpinnable);l.createUI(a,n,r,g.unremovable);f.setupPinUI(n,e,d)};a.setupPinUI=function(a,b,d){function f(){var a=g.findPinnedParent(d),c=$(this).attr("data-value");$(a).hasClass(c)?
a.component.get().eject(d):l.pin(d,c);h();p.close()}function h(){var a=$(g.findPinnedParent(d)),c=r.find(".option");c.removeClass("active");a&&c.filter(function(){return a.hasClass($(this).attr("data-value"))}).addClass("active")}if(a.find(".pin").length){a.find(".pin").rToggleDisplay(e.and(window.Silk.domain.userStorage.enableTagMentionsAndPinning,b.categoryTracking.category));var r=$("<div class=filter-settings/>").append($("<div class=desc><strong>Show on all pages in collection</strong></div>"),
$("<div class='option enabled' data-value=top>At the top</div>"),$("<div class='option enabled' data-value=bottom>At the bottom</div>"));r.find(".option").click(f);var l=b.pinnedComponents,p=n.click(a.find(".pin"),r,180,140,a,{position:"top",onShow:h},null);return a}};a.configureNode=function(a,b){return a.append(b)};a.uri=k.SimpleBlock;var f=a;a.SimpleBlock=a;a.prototype.cleanup=function(){this.pool.push(this.innerComponent.get());this.pool.cleanup()};a.prototype.setupComponent=function(){var a=
this.node.find("[data-component-uri]")[0];a&&(this.innerComponent=a.component,this.pool.push(this.innerComponent))};a.prototype.setupBlockUI=function(){this.innerComponent&&f.makeBlockUI(this,this.innerComponent.get(),this.node,this.document)};a.prototype.getComponentInfo=function(){return p.getInfo(this.innerComponent.get())};a.prototype.getMentionedTags=function(){return p.getMentionedTags(this.innerComponent.get())};a.prototype.edit=function(){this.innerComponent.get().edit()};a.prototype.cut=
function(){window.Silk.canvas.document.get().undoManager.startAction("cut");this.canvas.clipboard.cut(this);window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.fixLayout=function(a){this.callInnerMethod("fixLayout",a)};a.prototype.onPin=function(){this.callInnerMethod("onPin")};a.prototype.onUnpin=function(){this.callInnerMethod("onUnpin")};a.prototype.callInnerMethod=function(a,b){var d=this.innerComponent.get();if(d[a])d[a](b)};a.prototype.serializeToXML=function(a){return l.serialize(this,
a)};a.prototype.affectsDirtyState=function(a){var b=this.innerComponent.get()&&this.innerComponent.get().node[0],f=(new d(a.target)).getShadowParents();return b&&0<=f.indexOf(b)||b&&a.target===b||a.target===this.node[0]&&"class"!=a.attribute};a.prototype.node=null;return a}();m.SimpleBlock=r})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.typlib.ThreadEnd,g=function(){function a(b,d,e){var h;this.createFrame=this.createFrame.bind(this);if(h=function(a,c,b){this.canvas=b;this.document=c;this.node=null;this.iframe=$();l.linkToNode(this,a,"twitter-timeline");var d;try{d=JSON.parse(this.node.attr("data-timeline-type"))}catch(e){}d&&(this.type=d,this.createFrame())}.apply(h||this,arguments))return h}a.parseTimelineUrl=function(a){var d;if(d=
a.match(/(https?:\/\/)?(www.)?twitter.com\/([^\/]*)\/timelines\/(\d*)\/?$/))return{timeline:{user:d[3],id:d[4]}};if(d=a.match(/(https?:\/\/)?(www.)?twitter.com\/([^\/]*)\/favorites\/?$/))return{favorites:d[3]};if((d=a.match(/(https?:\/\/)?(www.)?twitter.com\/([^\/]*)\/lists\/([^\/]*)\/?$/))||(d=a.match(/(https?:\/\/)?(www.)?twitter.com\/([^\/]*)\/([^\/]*)\/?$/)))return{list:{user:d[3],name:d[4]}};if(d=a.match(/(https?:\/\/)?(www.)?twitter.com\/search\?q=(.*)$/))return null;if(d=a.match(/(https?:\/\/)?(www.)?twitter.com\/([^\/]*)\/?$/))return{user:d[3]};
if(d=a.match(/^@(.*?)$/))return{user:d[1]}};a.configureNode=function(a,e){var g;return e&&e.url?(g=d(e.url))?a.attr("data-timeline-type",JSON.stringify(g)):null:a};a.uri=k.TwitterTimeline;a.info={name:"twitter",text:"Twitter"};var d=a.parseTimelineUrl;a.TwitterTimeline=a;a.prototype.createFrame=function(){p.onThreadEnd(function(){this.node.empty();this.iframe=$("<iframe width=560 height=405 />").attr("src","/s/twitter-timeline.html?"+encodeURIComponent(JSON.stringify(this.type))).appendTo(this.node)}.bind(this),
arguments,"TwitterTimeline.createFrame",this)};a.prototype.serializeToXML=function(a){return this.node[0].cloneNode(!1)};a.prototype.affectsDirtyState=function(a){return a.target==this.node[0]};return a}();m.TwitterTimeline=g})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.model.Component,l=a.reactive.Value,p=a.typlib.DOMParser,g=a.typlib.Functions,e=a.typlib.ProtocolRelativeUri,d=function(){function a(b,d,e){var f;this.renderResult=this.renderResult.bind(this);if(f=function(a,b,d){k.linkToNode(this,a);this.canvas=d;this.url=null;this.embedlyData=(new l).name("UrlPreview.embedlyData");this.fetchData();this.render()}.apply(f||this,arguments))return f}a.checkURL=function(a,b,d,f){var c=a.match(/spotify:track:([^ ]+)/);c&&(a="http://open.spotify.com/track/"+
c[1]);b={key:"a3aeb62a9b7111e19fef4040aae4d8c9",url:a,maxwidth:b||560,words:25};$.ajax({url:"//api.embed.ly/1/oembed",type:"GET",data:b,success:function(c){d({url:a,embedlyData:JSON.stringify(c)})},error:g.partial(f,"//api.embed.ly/1/oembed",b),dataType:"json",ignoreErrors:!0})};a.configureNode=function(a,b){b&&b.data&&a.attr("data-embedly",JSON.stringify(b.data));return a};a.info={name:"embed",text:"Embed"};a.uri="//silk.co/widget/url-preview/1";a.UrlPreview=a;a.prototype.cleanup=function(){this.url.cleanup();
this.embedlyData.cleanup()};a.prototype.fetchData=function(){try{var a=JSON.parse(this.node.attr("data-embedly"));this.url=new e(a.url);this.embedlyData.set(a.embedlyData)}catch(b){}};a.prototype.render=function(){if(this.url.uri.get()&&this.embedlyData.get())try{this.renderResult(this.embedlyData.get())}catch(a){this.renderError()}else this.renderError()};a.prototype.renderURL=function(a,b){this.url.rawUri.set(a);this.embedlyData.set(JSON.stringify(b));this.renderResult(b)};a.prototype.renderResult=
function(a){this.node.empty();var b=$("<div />").addClass("container").appendTo(this.node);if(a.html){var d=p.parseHTMLFromString(a.html);1==d.length&&"IFRAME"==d[0].nodeName?(b.addClass("type-rich"),d=$("<iframe />").attr("src",$(d[0]).attr("src")).attr("width",a.width||$(d[0]).attr("width")||"100%").attr("height",a.height||$(d[0]).attr("height")||"500px").attr("frameborder",0),b.append(d),b.css({height:a.height+"px",width:a.width+"px"})):this.renderLink(a,b)}else"photo"==a.type?(b.addClass("type-photo"),
d=$("<div />").addClass("image-wrapper").css("width",Math.min(a.width,560)+"px"),d.append($("<img />").attr("src",e.toProtocolRelative(a.url))),d.append($("<a />").text(a.title||"").attr("href",this.url.uri.get())),b.append(d)):"link"==a.type&&this.renderLink(a,b)};a.prototype.renderError=function(){$("<div />").addClass("container error").text("Something went wrong rendering the external component, please try again later or reinsert this media widget.").appendTo(this.out)};a.prototype.renderLink=
function(a,b){b.addClass("type-link");var d=a.url||this.url.uri.get();a.thumbnail_url&&b.addClass("has-image").append($("<img />").attr("src",e.toProtocolRelative(a.thumbnail_url)));var f=d.replace(/https?:\/\/([^\/]+)\/.*/,"$1");b.append($("<a />").text(a.title||d).attr("href",d).addClass("title"));b.append($("<p />").text(a.description)).append($("<a />").attr("href",d).text(f))};a.prototype.serializeToXML=function(){var d=$("<div/>").attr("data-component-uri",a.uri),e={url:this.url.rawUri.get(),
embedlyData:this.embedlyData.get()};d.attr("data-embedly",JSON.stringify(e));return d[0]};a.prototype.node=void 0;return a}();m.UrlPreview=d})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.client.query.render.Video,g=a.component.Pinned,e=a.component.image.MediaTagUI,d=a.reactive.Node,b=function(){function a(b,d,f){var c;if(c=function(a,c,b){this.canvas=b;this.document=c;this.description=this.author=this.src=this.node=this.anchor=null;this.ratio=1;l.linkToNode(this,a,"video");this.setupNodes();this.parseJson();this.insertVideo();this.setupTagUI();this.autoTag()}.apply(c||this,arguments))return c}
a.configureNode=function(a,b){if(b){var d=function(a){return JSON.stringify({accuracy:1,manual:!0,normalized:a})},c=b.url||$(b.html).attr("src"),c=d({src:c,width:b.width,height:b.height,provider:b.provider_name});if(b.thumbnail_url)var e=d({src:b.thumbnail_url,width:b.thumbnail_width,height:b.thumbnail_height,zoom:100,top:0,left:0});a.append($("<a/>").text(b.title+" (by "+b.author_name+")").attr("data-normalized-video",c||"").attr("data-normalized-image",e||"").attr("data-tag-uri",b.tag));a.attr("data-mentioned-tag-uri",
b.tag)}return a};a.uri=k.Video;a.info={name:"video",text:"Video"};a.Video=a;a.prototype.cleanup=function(){};a.prototype.isDynamic=function(){return this.node.is("[data-mentioned-tag-uri]")||g.findPinnedParent(this.node)};a.prototype.setupNodes=function(){this.node.children().not("a").remove();this.anchor=this.node.children("a");this.anchor.length||(this.anchor=$("<a/>").attr("data-tag-uri",this.node.attr("data-mentioned-tag-uri")))};a.prototype.parseJson=function(){try{var a=JSON.parse(this.anchor.attr("data-normalized-video"))}catch(b){}a&&
(this.json=a.normalized);this.ratio=this.json.height/this.json.width};a.prototype.insertVideo=function(){this.json?this.node.append(p.createIframe(this.json)):this.node.html("<em>No video data found.</em>")};a.prototype.resize=function(a,b){this.json.width=a;this.json.height=b;var d=JSON.parse(this.anchor.attr("data-normalized-video"));d.normalized=this.json;this.anchor.attr("data-normalized-video",JSON.stringify(d));this.node.children("iframe").attr("width",this.json.width).attr("height",this.json.height)};
a.prototype.fixLayout=function(a){this.resize(a,a*this.ratio)};a.prototype.setupTagUI=function(){this.isDynamic()||(this.tagUI=new e("video",this.anchor,this.document,this.canvas.domain.tagList),this.tagUI.label.appendTo(this.node))};a.prototype.autoTag=function(){this.isDynamic()||this.anchor.attr("data-tag-uri")||this.anchor.attr("data-tag-uri",this.tagUI.suggest().uri)};a.prototype.onPin=function(){this.anchor.attr("data-tag-uri",null);this.tagUI&&(this.tagUI.label.remove(),this.tagUI=null)};a.prototype.onUnpin=
function(){this.setupTagUI()};a.prototype.serializeToXML=function(b){return l.createNode(a).append(this.anchor.clone())[0]};a.prototype.affectsDirtyState=function(a){return 0<=(new d(a.target)).getShadowParents().indexOf(this.anchor[0])||a.target==this.anchor[0]||a.target==this.node[0]&&"class"!=a.attribute};a.prototype.json=void 0;a.prototype.tagUI=void 0;return a}();m.Video=b})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.client.ui.queryviewer.filter.TagMentioning,g=a.component.Gist,e=a.component.Image,d=a.component.SimpleBlock,b=a.component.TwitterTimeline,n=a.component.UrlPreview,r=a.component.Video,h=a.reactive.List,f=a.reactive.Node,c=a.reactive.Value,q=a.typlib.CleanupPool,s=a.typlib.Functions,u=function(){function a(b,d,e){var g;this.parseUri=this.parseUri.bind(this);this.getMentionedTags=this.getMentionedTags.bind(this);
this.showThatUrlIsInvalid=this.showThatUrlIsInvalid.bind(this);this.setupComponent=this.setupComponent.bind(this);this.embedlySuccess=this.embedlySuccess.bind(this);this.setupUI=this.setupUI.bind(this);this.edit=this.edit.bind(this);this.cut=this.cut.bind(this);this.fixLayout=this.fixLayout.bind(this);if(g=function(a,b,d){function e(a){return a&&a.mention?[a.mention]:[]}this.document=b;this.canvas=d;this.tagList=d.domain.tagList;l.linkToNode(this,a,"block");this.node.rAddClass("embed");this.prefix=
this.node.attr("data-embed-prefix")||"";a=(new f(a)).attributes.get("data-embed-uri").map(function(a){return a&&JSON.parse(a)});b=a.bind(this.parseUri);this.pool=new q;d=this.node.find("[data-component-uri]");d[0]?(this.pool.push(this.mentionedTags=(new h).name("EmbedBlock.mentionedTags"),this.mentionedTag=this.mentionedTags.head().name("EmbedBlock.mentionedTag"),this.component=(new c).name("EmbedBlock.component")),this.component.is(d[0].component),this.setupUI(this.component.get())):this.pool.push(this.mentionedTags=
h.fromList(a.map(e)).name("EmbedBlock.mentionedTags"),this.mentionedTag=this.mentionedTags.head().name("EmbedBlock.mentionedTag"),this.component=c.lift(this.setupComponent)(b,this.mentionedTag).join())}.apply(g||this,arguments))return g}a.configureNode=function(a,c,b){return a.attr("data-embed-uri",JSON.stringify(c)).attr("data-embed-prefix",b||null)};a.uri=k.EmbedBlock;a.EmbedBlock=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.parseUri=function(a){var c=this.prefix;return p.toValue(this.canvas.currentContentDocument.mapProp("documentTags"),
a).map(function(a){if(!a||a.match(/^(?:https?:)?\/\//))return a;a.match(/^@/)&&(a=a.slice(1));return c+a})};a.prototype.getMentionedTags=function(){return this.mentionedTags};a.prototype.showThatFactIsMissing=function(a){this.node.append($("<div />").addClass("message missing-facts").append("<p><strong>This fact is missing from the page:</strong></p>").append($("<ul/>").append(function(a){return $("<li/>").text(a.name)[0]}(this.tagList.findByUriOrCreateWithoutSaving(a)))));this.setupUI(l.dummy())};
a.prototype.showThatUrlIsInvalid=function(a){this.node.append($("<div />").addClass("message").append("<p><strong>Embedding failed. The URL is: <tt></tt>.</strong></p>"));this.node.find("tt").text(a);this.setupUI(l.dummy())};a.prototype.setupComponent=function(a,c){if(a||c){this.node.empty();if(a)return this.showComponentFor(a,c);this.showThatFactIsMissing(c)}};a.prototype.showComponentFor=function(a,b){var d=(new c).name("EmbedBlock.component"),f=this.tryToCreateSpecificComponent(a);f?this.installComponent(f,
d):this.askEmbedlyAboutIt(a,d,b);return d};a.prototype.tryToCreateSpecificComponent=function(a){return l.create(g,this,{url:a})||l.create(b,this,{url:a})};a.prototype.installComponent=function(a,c){this.node.append(a.node);this.setupUI(a);c.set(a)};a.prototype.askEmbedlyAboutIt=function(a,c,b){var d=this.node.closest(".layout").is(".meta")?250:560;n.checkURL(a,d,s.partial(this.embedlySuccess,c,b),s.partial(this.showThatUrlIsInvalid,a))};a.prototype.embedlySuccess=function(a,c,b){b.embedlyData=JSON.parse(b.embedlyData);
this.tryAsImage(b.embedlyData,c,a)||this.tryAsVideo(b.embedlyData,c,a)||(c=l.create(n,this,{data:b}),this.installComponent(c,a))};a.prototype.tryAsImage=function(a,c,b){if("photo"!=a.type)return!1;c=l.create(e,this,{tag:c,src:a.url});this.installComponent(c,b);this.node.append($("<a/>").attr("href",a.url).text(a.title)," by ",$("<a/>").attr("href",a.author_url).text(a.author_name));return!0};a.prototype.tryAsVideo=function(a,c,b){if("video"!=a.type)return!1;a=$.extend({},{tag:c},a);a=l.create(r,this,
a);this.installComponent(a,b);return!0};a.prototype.setupUI=function(a){$(".block-ui",this.node).remove();d.makeBlockUI(this,a,this.node,this.document)};a.prototype.getComponentInfo=function(){return l.getInfo(this.component.get())};a.prototype.edit=function(){this.component.get().edit()};a.prototype.cut=function(){window.Silk.canvas.document.get().undoManager.startAction("cut");this.canvas.clipboard.cut(this);window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.onPin=function(){var a=
this.component.get();if(a.onPin)a.onPin()};a.prototype.onUnpin=function(){var a=this.component.get();if(a.onUnpin)a.onUnpin()};a.prototype.fixLayout=function(a){var c=this.component.get();c&&c.fixLayout&&c.fixLayout(a)};a.prototype.serializeToXML=function(a){var c=this.node[0].cloneNode(!1);this.mentionedTag.get()||a.serializeChildNodes(c,this.node.contents().not(".block-ui"));return c};a.prototype.affectsDirtyState=function(a){var c=this.mentionedTag.get()&&this.component.get()&&this.component.get().node[0],
b=(new f(a.target)).getShadowParents();return c&&0<=b.indexOf(c)||c&&a.target===c||a.target===this.node[0]&&"class"!=a.attribute};a.prototype.node=null;return a}();m.EmbedBlock=u})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.arrow.Arrow,l=a.arrow.Dom,p=a.client.component.ComponentURIs,g=a.client.model.Component,e=a.reactive.Node,d=a.reactive.Value,b=a.typlib.Arrays,n=a.typlib.CleanupPool,r=a.typlib.SelectionManager,h=a.typlib.Strings,f=function(){function a(c,b,f){var h;this.checkPlaceHolder=this.checkPlaceHolder.bind(this);this.hidePlaceholder=this.hidePlaceholder.bind(this);if(h=function(a,c,b){this.pool=new n;g.linkToNode(this,a,"text");this.pool.push(this.placeholderText=(new d($(a).attr("data-placeholder")||
"Insert paragraph here...")).name("TextWidget.placeholderText"));this.setupBlock();e.node(this.content[0]).attributes.get("contenteditable").is(b.editFlags.editing)}.apply(h||this,arguments))return h}a.cleanupContents=function(){this.nodeType==window.Node.TEXT_NODE&&(this.textContent=this.textContent.replace(/[\x00-\x08\x0b\x0c\x0e-\x19]/g,""))};a.configureNode=function(a,c,b){c=$.extend({},{tagName:"p",html:"<br/>"},c);if(b)return a;b=$("<div/>").append(c.content||s(c));c.placeholder&&a.attr("data-placeholder",
c.placeholder);c.css&&b.css(c.css);return a.append(b).addClass(c.cssClass)};a.makeContent=function(a){return $(document.createElement(a.tagName)).append(a.html)};a.uri=p.TextWidget;a.info={name:"text",text:"Text"};var f=a.cleanupContents,s=a.makeContent;a.TextWidget=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.setupBlock=function(){this.content=$("> .block-content",this.node);this.content[0]||(this.content=$("<div class=block-content />"),this.content.append(this.node.contents()).appendTo(this.node));
this.node.contents(":not(.block-content)").remove();this.placeholder=$("<div class=placeholder />");this.checkPlaceHolder();this.placeholderText.onchange(this.checkPlaceHolder);this.content.focus(this.hidePlaceholder).blur(this.checkPlaceHolder);this.setupEmptyClass()};a.prototype.setupEmptyClass=function(){var a=k.run(l.getTextDeeply(),e.node(this.content[0])).crush(b.join);this.pool.push(a.onchange(function(a){void 0!==a&&this.content.toggleClass("empty",""==h.trim(a))}.bind(this)))};a.prototype.focus=
function(a){if(a=this.content[0]){var c=window.getSelection(),c=-1<$(c.anchorNode).parents().index(a),b=$.ua.engine.version.split(".")[0];("WebKit"!==$.ua.engine.name||533<b&&537>b)&&a.focus();c||((c=$("h1",a)[0])?r.selectNodeEnd(c):r.selectNodeStart(a))}};a.prototype.checkPlaceHolder=function(){var a=""===h.trim(this.content.text()),c=!this.content.has("li")[0];!this.content.is(":focus")&&a&&c?this.placeholder.prependTo(this.node).text(this.placeholderText.get()):this.hidePlaceholder()};a.prototype.hidePlaceholder=
function(){this.placeholder.empty().detach()};a.prototype.onPin=function(){this.stripInlineTags()};a.prototype.stripInlineTags=function(){g.reinsertWithModifiedDOM(this,function(a){$("a[data-tag-uri]",a).each(function(){$(this).replaceWith($(this).contents())})})};a.prototype.serializeToXML=function(a){var c=this.node.find(".block-content"),b=c.prop("tagName"),d=c.contents().filter(function(){return this.nodeType==window.Node.TEXT_NODE&&0!==this.textContent.trim().length});0<d.length&&(console.warn("Found text nodes without wrapping tag in TextWidget"),
d.wrap("<"+b+"></"+b+">").end());if("DIV"!==b){for(var b=document.createElement("div"),d=c.get(0).attributes,e=0;e<d.length;e++)b.setAttribute(d[e].nodeName,d[e].nodeValue);$(b).html(c.html());c.remove();this.node.append(b)}c=this.node[0].cloneNode(!1);b=this.node.find(".block-content");a.serializeChildNodes(c,b.get());$(c).find("*").contents().each(f);return c};a.prototype.affectsDirtyState=function(a){return 0<=(new e(a.target)).getShadowParents().indexOf(this.content[0])||a.target===this.content[0]&&
!a.attribute||a.target==this.node[0]};return a}();m.TextWidget=f})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Blocks,p=a.client.model.Component,g=a.component.SimpleBlock,e=a.component.TextWidget,d=a.reactive.Value,b=function(){function a(b,e,f){var c;this.cut=this.cut.bind(this);this.fixLayout=this.fixLayout.bind(this);if(c=function(a,c,b){p.linkToNode(this,a,"block");this.document=c;this.canvas=b;this.visible=(new d(!0)).name("FigureBlock.visible");a=this.node.children();this.header=a.eq(0);this.content=a.eq(1);this.description=
a.eq(2);this.title=this.header.find(p.selectorFor("TextWidget"));this.figure=this.content.children();this.component=this.figure[0].component.get();this.ui=null;this.setupUI();this.setupVisibility()}.apply(c||this,arguments))return c}a.configureNode=function(a,b){b=$.extend({},{},b);return a.append($("<div class=figure-title/>").append(p.createNode(e,{placeholder:"Optional title...",html:b.title,tagName:"h5"})),$("<div class=figure-content/>").append(b.content),p.createNode(e,{cssClass:"figure-description",
placeholder:"Optional caption...",content:b.caption}))};a.uri=k.FigureBlock;a.FigureBlock=a;a.prototype.getTitleText=function(){return this.title.find(".block-content").text()};a.prototype.cleanup=function(){this.component.cleanup&&this.component.cleanup()};a.prototype.setupUI=function(){g.makeBlockUI(this,this.component,this.node,this.document)};a.prototype.setupVisibility=function(){this.header.rToggleDisplay(this.visible);this.description.rToggleDisplay(this.visible)};a.prototype.getComponentInfo=
function(){return p.getInfo(this.component)};a.prototype.getMentionedTags=function(){return p.getMentionedTags(this.component)};a.prototype.affectsDirtyState=function(a){return"style"!==a.attribute};a.prototype.cut=function(){window.Silk.canvas.document.get().undoManager.startAction("cut");this.canvas.clipboard.cut(this);window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.fixLayout=function(a){this.figure[0].component.get().fixLayout(a)};a.prototype.serializeToXML=function(a){return l.serialize(this,
a)};a.prototype.node=void 0;return a}();m.FigureBlock=b})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,p=a.typlib.Html,g=a.typlib.ErrorHandling,e=a.typlib.ThreadEnd,d=function(){function a(b){var e;this.performQuery=this.performQuery.bind(this);this.processError=this.processError.bind(this);if(e=function(a){this.enabled=a||(new l(!1)).name("Query.enabled");this.first=(new l(!0)).name("Query.first");this.busy=(new l(!1)).name("Query.busy");this.last=(new l(0)).name("Query.last");this.query=new l(d.DefaultQuery);this.error=(new l).name("Query.error");
this.query.onchange(this.performQuery)}.apply(e||this,arguments))return e}a.escape=function(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')};a.adhocQuery=function(d,e){var f=new a;f.enabled.set(!0);f.query.set(d);f.handleResult=e;return f};a.DefaultQuery="from all documents select document name";var d=a;a.Query=a;a.prototype.cleanup=function(){this.last.cleanup();this.busy.cleanup();this.first.cleanup();this.enabled.cleanup()};a.prototype.performQuery=function(){this.enabled.get()&&(this.query.get()?
this.performQueryDelayed():this.handleResult&&this.handleResult())};a.prototype.performQueryDelayed=function(){e.onThreadEnd(function(){if(this.enabled.get()){this.busy.set(!0);var a=this.last.get()+1;this.last.set(a);window.Silk.api.query(this.query.get(),this.processResult.bind(this,a),this.processError.bind(this,a));this.logQuery()}}.bind(this),arguments,"performQueryDelayed",this)};a.prototype.logQuery=function(){if(this.log&&this.log.get())try{var a=JSON.parse(this.log.get()),b={documentType:Silk.canvas.document.get().type,
queryViewData:a};window.Silk.api.QueryLog.create(JSON.stringify(b))}catch(d){g.handleError(d,{source:"client.query.Query.logQuery",json:this.log.get()})}};a.prototype.processResult=function(a,b){if(a==this.last.get()){b="Trident"===$.ua.engine.name?p.XMLElement2HTMLElement(b.documentElement,document):b.documentElement;if(!b)return this.processError(a)(b);this.handleResult&&this.handleResult(b);this.first.set(!1);this.busy.set(!1)}};a.prototype.processError=function(a,b){this.error.set(b.responseText);
this.busy.set(!1);var d="Error in query ("+b.status+"): "+b.responseText;0==b.status&&g.handleError(d,{apiUrl:window.Silk.api.contextUrl,currentUrl:window.location.href,query:this.query.get(),ajaxState:b.state(),statusText:b.statusText,source:"client.query.Query.processError"});200==b.status?(d="Query.render(): 200 response but no XML document.\nThe query was:\n"+this.query.get(),g.handleError(d,{source:"client.query.Query.processError",name:this.query.get()})):503==b.status?console.error("Unknown server error."):
504==b.status?console.error("Timeout in query."):403==b.status||500==b.status?console.error(d):g.handleError(d,{source:"client.query.Query.processError",name:this.query.get()});this.handleResult&&this.handleResult()};return a}();k.Query=d})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Component,p=a.client.query.Query,g=a.typlib.Arrays,e=a.typlib.Strings,d=function(){function a(b){var c;this.handlePageListing=this.handlePageListing.bind(this);if(c=function(a){this.tagList=a;this.pages=[];this.sections=$()}.apply(c||this,arguments))return c}a.conceptRegex=function(){return/(\s+[A-Z]\w+|\s+of|\s+for the|\s+for|\s+and)+/g};a.numericRegex=function(){return RegExp(d(r(["\\$","£","¥","€"]))+"\\s*[-+]?[0-9]*([.,]?[0-9]+)+([eE][-+]?[0-9]+)?\\s*"+
d(r("% st th nd rd hundreds? thousands? millions? billions? trillions? mm bn ,-".split(" "))),"gi")};a.optional=function(a){return"("+a+")?"};a.disj=function(a){return"("+a.map(function(a){return"("+a+")"}).reduce(function(a,b){return a+"|"+b})+")"};a.mkSuggestion=function(a){return function(c){return{value:e.trim(c),type:a}}};var d=a.optional,r=a.disj,h=a.mkSuggestion;a.Suggestions=a;a.prototype.compute=function(a){var c=a.types.is("numeric"),b=this.textLines(),d=a.getEnumValues().map(h("enum"));
if(c)a=[this.scanNumeric(b).map(h("numeric"))];else{var c=this.scanConcepts(b).map(h("concepts")),e=this.pagesPartitionedByOutTypes(a),b=e[0].map(h("page-of-type")),e=e[1].map(h("page"));a=a.isEnumAutocomplete()?[d,b,c,e]:[b,c,e]}return g.uniqueBy(g.concat(a),function(a,c){return a.value==c.value})};a.prototype.pagesPartitionedByOutTypes=function(a){var c=a.outtypes.keys().map(function(a){return this.tagList.findByUriOrCreate(a,!0).name.toLowerCase()}.bind(this));a=g.partition(this.pages,function(a){return-1!=
c.indexOf(a.type.toLowerCase())});a[0]=g.mapProp(a[0],"name");a[1]=g.mapProp(a[1],"name");return a};a.prototype.fetchPageListing=function(a){p.adhocQuery(" from all documents select document name and document type slice from 0 to 1000",this.handlePageListing.bind(this,a))};a.prototype.handlePageListing=function(a,c){c&&(this.pages=$(c).find("tbody tr").get().map(function(a){a=$(a).find("td");var c=a.last().find("a").attr("data-tag-uri");return{name:a.first().find("a").text(),type:a.last().find("a").text(),
collection:c&&c.toLowerCase()}}),a&&a(this.pages))};a.prototype.textLines=function(){return this.sections.find(l.selectorFor("TextWidget","p")).map(function(a,c){return $(c).text().match(/.*?([\.!?]\s|$)/g)}).get().filter(function(a){return!a.match(/^\s*$/)})};a.prototype.scanConcepts=function(d){var c=a.conceptRegex();d=g.concat(d.map(function(a){return a.match(c)})).map(function(a){return a&&a.replace(/^[^A-Z]+/,"").replace(/\s[^A-Z]+$/,"")}).filter(function(a){return a&&!a.match(/^\s*$/)});return g.group(d.sort()).sort(function(a,
c){return c.length-a.length}).map(function(a){return a[0]})};a.prototype.scanNumeric=function(d){var c=a.numericRegex();return g.concat(d.map(function(a){return a.match(c)})).filter(function(a){return!!a})};return a}();k.Suggestions=d})(m.keyvalue||(m.keyvalue={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.Arrow,p=a.ui.Bubble,g=a.reactive.Node.node,e=function(){function a(b,d){var e;if(e=function(a,b){function c(){if(e&&(e.close(),e=null,b.onClose))b.onClose()}function d(){b.storageKey&&r.setBoolKey(b.storageKey,"true");c()}b.containerClass=b.containerClass?[b.containerClass]:[];var e,n,r=a.domain.userStorage;a.registerEvent(b.eventName,b.eventFilter,b.storageKey);b.targetArrow&&(b.target=function(a){n=l.run(l.seq(l.head(b.targetArrow),l.propA("node"),
l.arr(a,c)),g(b.targetRoot.get()))});b.pred.onchange(function(a){a?e||b.target(function(a){var c=b.html?$("<div />").html(b.html):$("<div />").html(b.text);b.actions&&$("a[rel]",c).click(function(a){a.preventDefault();b.actions[$(this).attr("rel")]()});var h=b.noClose?$():$("<div />").addClass("close").click(d);e=new p(c.addClass("vog").addClass(b.className).append(h),b.width,b.height,a,{containerClass:["vog"].concat(b.containerClass).join(" "),position:b.position,elementPadding:b.elementPadding,
delay:b.delay});b.onShow&&b.onShow(e);return e}):(n&&n.destruct(),c())});if(b.eventName)$(a).on(b.eventName,function(){r.setBoolKey(b.storageKey,"true")})}.apply(e||this,arguments))return e}return a.VogTrigger=a}();k.VogTrigger=e})(m.ui||(m.ui={}))})(a.lib||(a.lib={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.lib.ui.VogTrigger,p=a.reactive.Functions,g=function(){function a(){}a.setup=function(a){var b=window.Silk.vog,e=window.Silk.domain,e=p.and(p.not(e.userStorage.vogDisable),p.not(e.userStorage.vogCreatedFirstKeyValueTag),a.firstTag);new l(b,{pred:e,html:"A fact is a property of your page. Tag it with<br> a description on the left, and enter its value on the right. <br><br>E.g. '<strong>Location</strong>: Times Square'<br><br>Check out the <a href='http://www.silk.co/tutorials/tagging-tutorial' target='_blank'>tagging tutorial</a> to learn more.",
target:function(b){setTimeout(function(){b(a.editing.get())})},width:320,height:154,position:"left",eventName:"keyvalue-first-tag-created",eventFilter:function(a){return 0===a},storageKey:"vogCreatedFirstKeyValueTag"});return e};return a}();k.Vog=g})(m.keyvalue||(m.keyvalue={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.arrow.Arrow,l=a.arrow.Dom,p=a.client.component.ComponentURIs,g=a.client.model.Component,e=a.client.query.Query,d=a.component.keyvalue.Suggestions,b=a.component.keyvalue.Vog,n=a.reactive.Events,r=a.reactive.List,h=a.reactive.Node,f=a.reactive.Value,c=a.silk.nav.NavLinks,q=a.silk.nav.NavQuery,s=a.typlib.Arrays,u=a.typlib.CleanupPool,t=a.typlib.Functions,v=a.typlib.Html,x=a.typlib.SelectionManager,w=a.typlib.Strings,y=a.typlib.ThreadEnd,A=a.typlib.Tracking,z=a.ui.Bubble,
B=a.ui.input.Selectbox,D=k.arr,F=k.effect,C=k.effectI,E=k.constL,G=k.seq,L=k.put,N=k.putWith,H=k.get,I=k.fromValue,M=k.run,S=l.getText,P=l.getAttr,J=l.getChildren,K=l.select,k=function(){function a(c,e,h){var q;this.startSetupPhaseDelayed=this.startSetupPhaseDelayed.bind(this);this.stopSetupPhaseDelayed=this.stopSetupPhaseDelayed.bind(this);this.stopEditing=this.stopEditing.bind(this);this.onDblClick=this.onDblClick.bind(this);this.onClick=this.onClick.bind(this);this.onInlineClick=this.onInlineClick.bind(this);
this.onBoxSelect=this.onBoxSelect.bind(this);this.closeSelectbox=this.closeSelectbox.bind(this);this.onKeyDown=this.onKeyDown.bind(this);this.onWindowMouseDown=this.onWindowMouseDown.bind(this);this.setupDragging=this.setupDragging.bind(this);this.startDragging=this.startDragging.bind(this);this.stopDragging=this.stopDragging.bind(this);this.updateCategoryRow=this.updateCategoryRow.bind(this);this.mutationChange=this.mutationChange.bind(this);this.onInput=this.onInput.bind(this);this.syncRebuild1=
this.syncRebuild1.bind(this);this.onPointerClick=this.onPointerClick.bind(this);this.onDeleteCategory=this.onDeleteCategory.bind(this);this.onDeleteManaged=this.onDeleteManaged.bind(this);this.editingChange=this.editingChange.bind(this);this.recomputeSuggestions=this.recomputeSuggestions.bind(this);this.onNewTagClick=this.onNewTagClick.bind(this);this.onPaste=this.onPaste.bind(this);var n=this;this.unsetLinkable=function(){var c=arguments;setTimeout(function(){a.prototype.unsetLinkable.apply(n,c)},
100)};this.setLinkable=function(){var c=arguments;setTimeout(function(){a.prototype.setLinkable.apply(n,c)},100)};this.handlePasteDelayed=function(){var c=arguments;setTimeout(function(){a.prototype.handlePasteDelayed.apply(n,c)},0)};this.unhighlight=function(){var c=arguments;setTimeout(function(){a.prototype.unhighlight.apply(n,c)},500)};if(q=function(a,c,e){g.linkToNode(this,a,"keyvalue");this.document=c;this.undoManager=c.undoManager;this.tagList=e.domain.tagList;this.editableUIs=this.managedUI=
this.inlineUI=this.categoryUI=this.ui=null;this.rebuilds=[];this.effects=this.tags=this.data=this.sections=this.article=null;this.manageInline=this.manageCategory=!1;this.categoryUri=this.document.categoryTracking.category;this.category=this.document.categoryTracking.asTag;this.selection=this.selectbox=this.newTag=null;this.suggestions=new d(this.tagList);this.maxSuggestions=10;this.editing=(new f).name("KeyValue.editing");this.pool=new u;this.alive=!0;this.firstTag=new f(null);this.setupPhase=!0;
this.startSetupPhaseDelayed();this.register();this.setupSection();this.setupDataTable();this.setupUITable();this.setupInlineTags();this.setupCategoryTracking();this.setupPointerDeleteUI();this.setupSynchronization();this.setupEditing();this.setupCopyPaste();this.setupSuggestions();this.setupNewTagUI();this.setupFocusBlur();this.initialBuild();this.pool.push(b.setup(this));this.stopSetupPhaseDelayed();this.setupPhase=!1}.apply(q||this,arguments))return q}a.init=function(){l.linkActiveField=(new f).name("KeyValue.linkActiveField")};
a.getRow=function(a){a=$(a);return a.length?"TR"==a[0].nodeName?a:a.closest("tr"):a};a.getCol=function(a){a=$(a);return a.length?"TD"==a[0].nodeName?a:a.closest("td"):a};a.getDiv=function(a){a=$(a);return a.length?"DIV"==a[0].nodeName?a:a.closest("div"):a};a.getField=function(a){return O(a).find("a.field")};a.getKeyCol=function(a){return k(a).find("td.key")};a.getValueCol=function(a){return k(a).find("td.value")};a.getKeyField=function(a){return W(a).find("a.field")};a.getValueFields=function(a){return V(a).find("a.field")};
a.isKeyField=function(a){return m(a).hasClass("key")};a.isValueField=function(a){return m(a).hasClass("value")};a.isEditing=function(a){return O(a).hasClass("editing")};a.isInlineRow=function(a){return k(a).hasClass("inline")};a.isCategoryRow=function(a){return k(a).hasClass("category")};a.isSuggestionRow=function(a){return k(a).hasClass("suggestion")};a.wasSuggestionRow=function(a){return k(a).hasClass("was-suggestion")};a.setVal=function na(a,c){a=$(a)[0];if(!a)return $();""==c?$(a).addClass("empty"):
$(a).removeClass("empty");if(T(a)===c)return $(a);"INPUT"==a.nodeName||"TEXTAREA"==a.nodeName?a.value=c:a.nodeType==window.Node.TEXT_NODE?a.textContent=c:a.nodeType==window.Node.ELEMENT_NODE&&(a.childNodes[0]?a.childNodes[0].textContent=c:a.textContent=c);if("TEXTAREA"==a.nodeName)y.onThreadEnd(function(){$(a).height(Math.max(25,a.scrollHeight))});var b=$(a).siblings("textarea,input");b.length&&na(b,c);return $(a)};a.getVal=function(a){return(a=$(a)[0])?"INPUT"==a.nodeName||"TEXTAREA"==a.nodeName?
a.value:a.textContent:""};a.whitespace=function(a){return!a||!!a.match(/^\s*$/)};a.setSelection=function(a,c,b){a.each(function(){c=0>c?this.value.length+c+1:c;b=0>b?this.value.length+b+1:b;if(this.setSelectionRange)this.setSelectionRange(c,b);else if(this.createTextRange){var a=this.createTextRange();a.collapse(!0);a.moveEnd("character",b);a.moveStart("character",c);a.select()}})};a.doFocus=function(a,c){a&&(a.focus(),c||a.select(),"left"==c&&ha(a,0,0),"right"==c&&ha(a,-1,-1))};a.mkField=function(a,
c){var b=ba($("<a class=field>"),a);c&&b.attr("href",c);return b};a.isSoleUrl=function(a){a=w.trim(a);if(a.match(/^https?:\/\//))return a;if(a.match(/^www\..+\..+$/))return"http://"+a};a.keyvalueness=function(a){return a.reduce(function(a,c){return a+c.length},0)/a.length};a.uri=p.KeyValue;a.info={name:"factsheet",text:"Fact Sheet",uncuttable:!0,unremovable:!0,unpinnable:!0};var l=a,k=a.getRow,m=a.getCol,O=a.getDiv,Q=a.getField,W=a.getKeyCol,V=a.getValueCol,U=a.getKeyField,R=a.getValueFields,Y=a.isKeyField,
fa=a.isValueField,ga=a.isEditing,ma=a.isInlineRow,Z=a.isCategoryRow,ea=a.isSuggestionRow,ba=a.setVal,T=a.getVal,ia=a.whitespace,ha=a.setSelection,ja=a.doFocus,ka=a.mkField,oa=a.isSoleUrl,la=a.keyvalueness;a.KeyValue=a;a.prototype.startSetupPhaseDelayed=function(){y.onThreadEnd(function(){this.setupPhase=!0}.bind(this),arguments)};a.prototype.stopSetupPhaseDelayed=function(){y.onThreadEnd(function(){this.setupPhase=!1}.bind(this),arguments)};a.prototype.cleanup=function(){this.alive=!1;this.deregister();
this.cleanupFocusBlur();this.cleanupSuggestions();this.cleanupSynchronization();this.cleanupSelectbox();this.tags&&(this.tags.cleanup(),this.effects.cleanup())};a.prototype.cleanupSuggestions=function(){this.pool.cleanup();this.categoryOnchange&&this.categoryOnchange.unlink();this.editingOnchange0&&this.editingOnchange0.unlink();this.editingOnchange1&&this.editingOnchange1.unlink()};a.prototype.register=function(){(this.document.__keyvalues=this.document.__keyvalues||[]).push(this)};a.prototype.deregister=
function(){s.remove(this.document.__keyvalues,this)};a.prototype.setupUITable=function(){this.categoryUI=$("<tbody class=category />");this.inlineUI=$("<tbody class=inline />");this.managedUI=$("<tbody class=managed />");var a=$("<thead class=category></thead>"),c=$("<thead class=inline><th colspan=2>Facts collected from tagged text on this page</th></thead>"),b=$("<thead class=managed><th colspan=2>Facts about this page</th></thead>");this.editableUIs=this.categoryUI.add(this.managedUI);this.ui=
$("<table/>").addClass("ui").append(a).append(this.categoryUI).append(c).append(this.inlineUI).append(b).append(this.managedUI).appendTo(this.node);this.setupDragging()};a.prototype.setupSection=function(){this.article=$(this.document.root);this.sections=this.node.closest("section");this.layout=this.node.closest(".layout");this.sections.prev().hasClass("header")&&(this.sections=this.sections.prev().add(this.sections));this.article.find(g.selectorFor("KeyValue")).not("[data-secondary-factsheet]").not(this.node).length&&
this.node.attr("data-secondary-factsheet","");this.node.is(":not([data-secondary-factsheet])")&&(this.manageInline=this.manageCategory=!0);this.suggestions.sections=this.sections};a.prototype.setupDataTable=function(){var a=this.node.find(".data").find("a[data-tag-uri]");this.node.empty();a.get().forEach(function(a){var c=this.tagList.findByUriOrCreate($(a).attr("data-tag-uri"),!0).name;h.node(a).attributes.get("data-key").set(c)}.bind(this));this.data=$("<div class=data />").append(a).appendTo(this.node)};
a.prototype.initialBuild=function(){this.requestRebuild("category","full","initial");this.requestRebuild("inline","full","initial");this.requestRebuild("managed","full","initial")};a.prototype.suggestionExists=function(c){function b(){return $(this).attr("data-key").toLowerCase()==c.name.toLowerCase()}var d=this.document.__keyvalues.filter(function(c){return c.constructor==a}),d=$(s.concat(d.map(function(a){return a.data.get()})));return 0!=this.data.children().filter(b).length||0!=d.children().filter(b).not("[data-suggestion]").length};
a.prototype.addSuggestion=function(a){if(!this.suggestionExists(a)){var c=this.data.children(".suggestion").last();c.length||(c=this.data.children().last());var b=$("<a/>").attr("data-tag-uri",a.uri).attr("data-key",a.name).attr("data-suggestion","");this.act(function(){c.length?b.insertAfter(c):this.data.append(b)});this.requestRebuild("managed","full","addSuggestion")}};a.prototype.newKeyValue=function(a,c,b,d,e){this.stopEditing();a=a.filter(function(a,c){return v.isAncestor(this.node[0],c)}.bind(this));
a.length||(a=this.data.children().last());var f=$("<a/>");f.attr("data-key",b);f.attr("data-tag-uri",e);f.text(d);var h=this.data;this.act(function(){if(a.length)f[c?"insertBefore":"insertAfter"](a);else h.append(f);this.firstTag.set(!1)});this.rebuildManagedFull();return this.getUIField(f)};a.prototype.setupEditing=function(){this.editingOnchange0=this.document.editing.onchange(this.stopEditing);this.editableUIs.on("click","a.field",this.onClick);this.editableUIs.on("dblclick","a.field",this.onDblClick);
this.editableUIs.on("keydown","textarea.field",this.onKeyDown)};a.prototype.stopEditing=function(){this.cleanupSelectbox();this.unsetLinkable();this.editing.set();var a=this.editableUIs.find("div.editing");if(a.length){var c=Q(a),b=this.getDataEntries(c),d=a.find("textarea"),e=d.hasClass("dirty");d.remove();a.removeClass("editing");k(c).removeClass("editing");this.cleanupWhenEmpty(c);Z(c)&&k(c).toggleClass("suggestion",ia(T(c)));if(e&&(!b.length||b.parents().length)){d=w.trim(T(c));if(Y(c)&&d||Z(c)&&
d.length)e=this.tagList.findByNameOrCreate(d,!0),e.setName(d),e.save();Y(c)&&!Z(c)&&this.setKeyText(k(c),d);var f=b.attr("data-tag-uri"),h=this.data.find("[data-suggestion]").not(b).filter(function(){return $(this).attr("data-tag-uri")==f}).remove();this.act(function(){h.remove()});fa(c)&&(this.autoLinkValue(c),this.linkValue(a,b))}}};a.prototype.startEditing=function(a,c,b,d){if(a&&a.length&&!ma(a)){var e=Y(a),f=Z(a),h=e?this.getDataEntries(R(a)):this.getDataEntries(a);if(ga(a))return a.parent().children("textarea");
d&&ea(a)&&A.trackWithMode("confirm-suggestion",{Channel:"KeyValue",IsCollection:f,KeyOrValue:e?"key":"value",UserAction:d},!0);"dblclick"==d&&A.trackWithMode("rename-key",{Channel:"KeyValue"},!0);if(e&&ea(a))return this.startEditing(R(a).first());if(!e||!f){(ea(a)||void 0!==h.attr("data-suggestion"))&&this.confirmSuggestion(a);if(!b&&e)return $();this.stopEditing();a=this.getUIField(h);e&&(a=U(k(a)));f&&(a=R(this.categoryUI.children("tr")));e||this.setLinkable(a);b=k(a).hasClass("new-tag")?"":T(a);
b=ba($("<textarea class='field undoable'>"),b);k(a).addClass("editing");O(a).addClass("editing").append(b);this.editing.set(b);this.setupSelectbox(a);ja(b,c);f&&this.updateCategoryRow();return b}}};a.prototype.unsetLinkable=function(){l.linkActiveField.set()};a.prototype.setLinkable=function(a){l.linkActiveField.set(function(){this.makeLink(a)}.bind(this))};a.prototype.onDblClick=function(a){window.Silk.canvas.document.get().undoManager.startAction("onDblClick");if(this.document.editing.get()&&!a.metaKey){var c=
$(a.target);Y(c)&&!ea(c)&&this.startEditing($(a.target),void 0,!0,"dblclick")&&(a.stopPropagation(),a.preventDefault())}window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.onClick=function(a){window.Silk.canvas.document.get().undoManager.startAction("onClick");this.document.editing.get()&&!a.metaKey&&this.startEditing($(a.target),void 0,void 0,"click")&&(a.stopPropagation(),a.preventDefault());window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.onInlineClick=
function(a){if(this.document.editing.get()&&!a.metaKey){if(fa(a.target)){var c=this.getInlineTag(Q(a.target));x.selectNodeContents(c[0]);c[0].scrollIntoView();c=c.offset().top-$(window).scrollTop();c=window.innerHeight/2-c;$(window).scrollTop($(window).scrollTop()-c)}a.preventDefault();a.stopPropagation()}};a.prototype.setupSelectbox=function(a){this.cleanupSelectbox();var c=a.parent().find("textarea.field"),b=this.selectbox=new B(c,B.Popup);b.onSelect=t.partial(this.onBoxSelect,a,c);b.onFilter=function(a){a=
b.filterLabelByInput(!1,a);b.area.val().length||(a=a.filter(function(a){return"page"!=a.item.type}));return a}.bind(this);Y(a)?this.selectboxKeySuggestions(a):Z(a)?this.selectboxCategorySuggestions(a):fa(a)&&this.selectboxValueSuggestions(a)};a.prototype.selectboxKeySuggestions=function(a){s.unique(this.findKeySuggestions(this.categoryUri.get()).map(function(a){return w.trim(a.name)})).forEach(function(a){this.selectbox.addItem(a,{value:a})}.bind(this))};a.prototype.selectboxCategorySuggestions=function(a){this.tagList.docLevelTags.list.map(function(a){return a.name}).forEach(function(a){this.selectbox.addItem(a,
{value:a})}.bind(this))};a.prototype.selectboxValueSuggestions=function(a){var c=(a=this.getDataEntries(a).attr("data-tag-uri"))&&this.tagList.findByUriOrCreate(a,!0),b=[];c&&(this.suggestions.compute(c).forEach(function(a){b[a.value]=!0;this.selectbox.addItem(a.value,a)}.bind(this)),c.isEnumAutocomplete()&&e.adhocQuery(" from all documents where (document has type "+this.categoryUri.get()+")  select "+a,function(a){var c=[];v.ensureHtml(a).find("tbody tr td a").each(function(a,d){var e=$(d).text();
b[e]||(b[e]=!0,c.push(e))});c.sort();c.forEach(function(a){this.selectbox.addItem(a,{value:a,type:"page-of-type"})}.bind(this))}.bind(this)))};a.prototype.onBoxSelect=function(a,c,b){window.Silk.canvas.document.get().undoManager.startAction("onBoxSelect");b=b.item.value;fa(a)&&this.setValueText(a,b);Y(a)&&this.setKeyText(k(a),b);this.invalidateLink(c);this.update(c);Y(a)?this.startEditing(R(a)):(ja(c,"right"),setTimeout(this.closeSelectbox,0));window.Silk.canvas.document.get().undoManager.stopAction()};
a.prototype.closeSelectbox=function(){this.selectbox&&this.selectbox.close()};a.prototype.cleanupSelectbox=function(){this.selectbox&&(this.selectbox.close(),this.selectbox.cleanup(),this.selectbox=null)};a.prototype.autoLinkValue=function(a){a=a.filter("a").first();var c=this.getDataEntries(a),b=T(a);if(b){var d=oa(b);if(d)return this.doLink(c,d,"autoLink");this.document.title.get().toLowerCase()!=b.toLowerCase()&&(this.document.isBeingModified.set(!0),e.adhocQuery(" from all documents where http://silk.co/tag/title is "+
JSON.stringify(b)+" select document name slice from 0 to 1",function(b){!b||c.attr("href")&&"enum"!=a.attr("data-href-type")||(b=v.ensureHtml(b).find("tbody tr a").attr("href"))&&b.length&&this.doLink(c,b,"autoLink");this.document.isBeingModified.set(!1)}.bind(this)))}};a.prototype.makeLink=function(a){a=Q(a);var c=this.getDataEntries(a);if(a.closest("td.value").length){var b=c.attr("href")||"",b=prompt("Please enter a link URL.",b);this.doLink(c,b,"userLink");ja(a,"none")}};a.prototype.doLink=function(a,
c,b){this.undoManager.startAction("KeyValue.doLink",!0,!1,!0);this.act(function(){var d=a.add(this.getUIField(a));d.attr("data-href-type",b);null!==c&&(c?d.attr("href",c):d.removeAttr("href"))});this.undoManager.stopAction()};a.prototype.onKeyDown=function(a){var c=$(a.target),b=a.shiftKey;if(!this.passToSelectbox(a))switch(a.keyCode){case 8:return this.backspace(c)||a.preventDefault();case 9:return this.tab(c,b)||a.preventDefault();case 13:return this.enter(a,c,b);case 27:return this.escape()||a.preventDefault();
case 37:return this.left(c)||a.preventDefault();case 39:return this.right(c)||a.preventDefault();case 38:return this.prev(c)||a.preventDefault();case 40:return this.next(c)||a.preventDefault();case 75:if(a.metaKey)return this.makeLink(c)||a.preventDefault()}};a.prototype.passToSelectbox=function(a){var c=38==a.keyCode||40==a.keyCode||13==a.keyCode,b=this.selectbox&&this.selectbox.visible&&this.selectbox.selection,d=!a.target.value.length,e=0==a.target.selectionStart&&a.target.selectionEnd==T(a.target).length;
if(b&&c&&(!e||d))return null===this.selectbox.selection&&(38==a.keyCode?this.selectbox.selection=this.selectbox.visibleItems.length-1:40==a.keyCode&&(this.selectbox.selection=-1)),!0};a.prototype.escape=function(){this.selectbox&&this.selectbox.close()};a.prototype.tab=function(a,c){window.Silk.canvas.document.get().undoManager.startAction("tab");var b=Q(a);if(!U(a).hasClass("empty")){var d=Y(b)?R(b).first():c?this.getPrev(b):this.getNext(b);d.length?this.startEditing(d):c||b.hasClass("empty")||this.createNewTag()}window.Silk.canvas.document.get().undoManager.stopAction()};
a.prototype.backspace=function(a){return T(a).length?!0:(this.left(a),!1)};a.prototype.enter=function(a,c,b){window.Silk.canvas.document.get().undoManager.startAction("enter");a.preventDefault();var d=Q(c);a=m(d);if(Z(d))b=void 0;else if(T(d).length)if(a.hasClass("key"))b=this.tab(c,b);else{if(a.hasClass("value")){a=c[0].value.length;var e=c[0].selectionStart,f=c[0].selectionEnd,e=(a=0!=e||f!=a)?c[0].value.substr(0,e):void 0;c=a?c[0].value.substr(f):void 0;a&&this.setValueText(d,e);d=this.getDataEntries(d);
f=d.attr("data-tag-uri");e=d.attr("data-key");b=this.newKeyValue(d,b,e,c,f);this.startEditing(b,a?"left":void 0,void 0,"enter")}b=void 0}else b=this.tab(c,b);window.Silk.canvas.document.get().undoManager.stopAction();return b};a.prototype.left=function(a,c){window.Silk.canvas.document.get().undoManager.startAction("left");var b;c||a[0].selectionEnd==a[0].selectionStart&&0==a[0].selectionStart?(b=this.getPrev(Q(a)),this.startEditing(b,"right"),b=!b.length):b=!0;window.Silk.canvas.document.get().undoManager.stopAction();
return b};a.prototype.right=function(a,c){window.Silk.canvas.document.get().undoManager.startAction("right");var b;c||a[0].selectionEnd==a[0].selectionStart&&a[0].selectionEnd==T(a).length?(b=this.getNext(Q(a)),this.startEditing(b,"left"),b=!b.length):b=!0;window.Silk.canvas.document.get().undoManager.stopAction();return b};a.prototype.prev=function(a){window.Silk.canvas.document.get().undoManager.startAction("prev");(0!=a[0].selectionStart||a[0].selectionEnd!=T(a).length)&&30<a.height()?a=!0:(a=
this.getPrev(Q(a)),this.startEditing(a),a=!a.length);window.Silk.canvas.document.get().undoManager.stopAction();return a};a.prototype.next=function(a){window.Silk.canvas.document.get().undoManager.startAction("next");(0!=a[0].selectionStart||a[0].selectionEnd!=T(a).length)&&30<a.height()?a=!0:(a=this.getNext(Q(a)),this.startEditing(a),a=!a.length);window.Silk.canvas.document.get().undoManager.stopAction();return a};a.prototype.getPrev=function(a){var c=this.editableUIs.find(".value a.field");a=c.get().indexOf(a[0]);
return $(c[a-1])};a.prototype.getNext=function(a){var c=this.editableUIs.find(".value a.field");a=c.get().indexOf(a[0]);return $(c[a+1])};a.prototype.setupFocusBlur=function(){$(window).on("mousedown",this.onWindowMouseDown)};a.prototype.cleanupFocusBlur=function(){$(window).off("mousedown",this.onWindowMouseDown)};a.prototype.onWindowMouseDown=function(a){!this.editing.get()||v.isDetached(a.target)||v.isAncestor(this.node[0],a.target)||(this.undoManager.startAction("KeyValue.onWindowMouseDown"),
this.stopEditing(),this.undoManager.stopAction())};a.prototype.setupDragging=function(){y.onThreadEnd(function(){var a=this.managedUI.sortable({start:this.startDragging,stop:this.stopDragging,forcePlaceholderSize:!0,placeholder:"placeholder",containment:"[data-article]",cancel:".category, .inline, .suggestion, .value",connectWith:".keyvalue tbody.managed"});this.pool.push(this.document.editing.onchange(function(c){try{c?a.sortable("enable"):a.sortable("disable")}catch(b){}}))}.bind(this),arguments)};
a.prototype.startDragging=function(a){this.stopEditing();a=k(a.toElement||a.originalEvent.target);a=R(a);this.draggingEntries=this.getDataEntries(a)};a.prototype.stopDragging=function(a){window.Silk.canvas.document.get().undoManager.startAction("stopDragging");a=function(a){A.trackWithMode("drag-row",{Channel:"KeyValue"},!0);this.draggingEntries.parent();var c=this.draggingEntries.clone();this.act(function(){this.draggingEntries.remove()});a=k(a.toElement||a.originalEvent.target);var b=a.prev(),d=
a.parents(".keyvalue").find("tbody.managed"),e=a.parents(".keyvalue").find(".data"),f=this.getDataEntries(R(b),e,d);this.act(function(){f.length?c.insertAfter(f.last()):c.prependTo(e)});this.requestRebuild("managed","full","stopDragging");this.draggingEntries=null}.call(this,a);window.Silk.canvas.document.get().undoManager.stopAction();return a};a.prototype.setupCategoryTracking=function(){if(this.manageCategory)this.categoryUri.onchange(function(){this.ignoreMutations||this.requestRebuild("category",
"shallow","categoryUri");var a=this.category.get();a&&this.categoryUI.find("a.field").attr("href",a.uri)}.bind(this))};a.prototype.updateCategoryRow=function(){var a=this.category.get(),b=a&&w.trim(a.name),d=this.categoryUI.children("tr"),e=R(d);d&&(Z(this.editing.get())?d.removeClass("suggestion"):d.toggleClass("suggestion",!b),ba(e,b||""),e.attr("href",b&&c.exploreCollection(a.uri)))};a.prototype.updateCategory=function(a){var c=this.document.categoryTracking.category,b=w.trim(T(a));this.act(function(){if(b.length){var a=
this.tagList.findByNameOrCreate(b,!0);a.setName(b);c.set(a.uri)}else c.set()})};a.prototype.setupSynchronization=function(){this.editableUIs.on("input",".field",this.onInput);n.registerAll(this.mutationChange)};a.prototype.cleanupSynchronization=function(){n.unregisterAll(this.mutationChange)};a.prototype.mutationChange=function(a){!this.ignoreMutations&&this.affectsDirtyState(a)&&(a.attribute&&a.attribute.match("^data-normalized")||this.requestRebuild("managed",a.target.nodeType==window.Node.TEXT_NODE||
"AttributeModified"==a.type||"CharacterDataModified"==a.type?"shallow":"full","mutationChange"))};a.prototype.getDataEntries=function(a,c,b){c=c||this.data;b=b||this.managedUI;var d=b.children().find("td.value a.field").map(function(c){return-1==a.get().indexOf(this)?null:c}).get();return c.children().map(function(a){return-1==d.indexOf(a)?null:this})};a.prototype.getUIField=function(a){a=this.data.children().get().indexOf(a[0]);var c=this.managedUI.children("tr").find("td.value a.field");return-1==
a?$():c.eq(a)};a.prototype.getInlineTag=function(a){a=this.inlineUI.find("td.value a.field").get().indexOf(a[0]);return 0>a?$():$(s.mapProp(this.tags.list,"node")[a])};a.prototype.onInput=function(a){this.undoManager.startAction("KeyValue.onInput",!0,void 0,!0);this.pasting||(this.invalidateLink($(a.target)),this.update($(a.target)),this.undoManager.stopAction())};a.prototype.invalidateLink=function(a){var c=Q(a),c=this.getDataEntries(c),b=T(c);a=T(a);var d=c.attr("href"),e;if(e=d)(e=!a)||(e=!(-1<
b.indexOf(a)||-1<a.indexOf(b))||/^\/page\//.test(d));e&&this.doLink(c,"","")};a.prototype.update=function(a){var c=Q(a);this.getDataEntries(c);var b=k(a);a.height("");a.height(a[0].scrollHeight);a.addClass("dirty");if(Z(a))return this.updateCategory(a),this.setValueText(c,T(a));if(Y(a))return this.setKeyText(b,T(a));if(ea(b))return this.confirmSuggestion(b);if(fa(a))return this.setValueText(c,T(a))};a.prototype.confirmSuggestion=function(a){var c=this.getDataEntries(R(a));this.act(function(){c.removeAttr("data-suggestion").attr("data-was-suggestion",
"");this.requestRebuild("managed","shallow","confirmSuggestion")})};a.prototype.setValueText=function(a,c){ba(a,c);if(!Z(a)){O(a);var b=this.getDataEntries(a);this.act(function(){b.text(a.text());b.attr("href",a.attr("href"));b.removeAttr("data-suggestion")})}};a.prototype.setKeyText=function(a,c){var b=U(a),d=U(a).next("textarea.field");ba(b,c);ba(d,c);a.toggleClass("nameless",!c.length);var e=this.getDataEntries(R(a));this.act(function(){e.attr("data-key",c.length?c:"");var a=null;c.length&&(a=
this.tagList.findByNameOrDefault(c).uri);e.attr("data-tag-uri",a)})};a.prototype.requestRebuild=function(a,c,b){var d=this.rebuilds.filter(function(c){return c.ui==a})[0];d?("full"!=d.type&&(d.type=c),-1==d.why.indexOf(b)&&d.why.push(b),c=d):c={ui:a,type:c,why:[b]};d||this.rebuilds.push(c);this.asyncRebuild()};a.prototype.asyncRebuild=function(){y.onThreadEnd(function(){this.alive&&this.syncRebuild()}.bind(this),arguments,"KeyValue.asyncRebuild",this)};a.prototype.syncRebuild=function(){this.rebuilds.forEach(this.syncRebuild1);
this.rebuilds=[];this.setEmptyState();this.setAddTagButtonText();this.rebuildTextarea()};a.prototype.syncRebuild1=function(a){switch(a.ui){case "category":return this.rebuildCategory();case "inline":return this.rebuildInline();case "managed":return this.rebuildManaged(a)}};a.prototype.rebuildCategory=function(){if(this.manageCategory){this.categoryUI.empty();var a=this.findOrCreateRow(this.categoryUI,"Collection");this.addValueToRow(a,"",null);a.addClass("category");this.updateCategoryRow()}};a.prototype.rebuildInline=
function(){if(this.manageInline){this.inlineUI.empty();s.mapProp(this.tags.list,"node").forEach(function(a,c){a=$(a);if(a.length&&a.attr("data-tag-uri")){var b=this.tagList.findByUriOrCreate(a.attr("data-tag-uri"),!0),b=this.findOrCreateRow(this.inlineUI,b.name),d=this.addValueToRow(b,a.text(),a.attr("href"));b.addClass("inline");d.find(".delete").removeClass("delete").addClass("pointer");this.linkKey(b,a.attr("data-tag-uri"));this.linkValue(d,a)}}.bind(this));var a=$("<div style=box-sizing:border-box;padding:10px /)>").text("Move this collected tag to the 'tagged facts about this page' section, and unlink the tag from the page text.");
z.hover(this.ui.find("tr.inline a.pointer"),a,200,90,null,{position:"bottom",startTimeout:200,stopTimeout:800})}};a.prototype.rebuildManaged=function(a){switch(a.type){case "full":return this.rebuildManagedFull();case "shallow":return this.rebuildManagedShallow()}};a.prototype.rebuildManagedFull=function(){this.selectionPreserving(function(){this.managedUI.empty();this.data.children().get().forEach(function(a){a=$(a);var c=void 0!==a.attr("data-suggestion"),b=this.findOrCreateRow(this.managedUI,a.attr("data-key"));
if(!c||!b.find("td.value div").length){var d=this.addValueToRow(b,a.text(),a.attr("href"));this.linkKey(b,a.attr("data-tag-uri"));this.linkValue(d,a);c&&b.addClass("suggestion")}}.bind(this))})};a.prototype.rebuildManagedShallow=function(){this.data.children().each(function(a,c){c=$(c);var b=this.getUIField(c),d=k(b);b.attr("href",c.attr("href"));d.toggleClass("suggestion",void 0!==c.attr("data-suggestion"));Z(b)?this.updateCategoryRow():(ba(U(d),c.attr("data-key")),ba(b,c.text()))}.bind(this))};
a.prototype.rebuildTextarea=function(){var a=this.editing.get(),c=Q(a),c=this.getDataEntries(c);c.length&&ba(a,c.text())};a.prototype.setEmptyState=function(){var a=!!this.category.get(),c=!!this.managedUI.children().length,b=!!this.inlineUI.children().length;this.node.toggleClass("empty",!a&&!c&&!b);this.node.toggleClass("empty-category",!a);this.node.toggleClass("empty-inline",!b);this.node.toggleClass("empty-managed",!c)};a.prototype.findOrCreateRow=function(a,c){function b(a){return $("<div>").append(ka(a))}
var d=a.find("tr").last(),e=T(U(d))||"";return d.length&&e.toLowerCase()==c.toLowerCase()?d:function(a){return $("<tr>").append($("<td class=key>").append(b(a)),$("<td class=value>"))}(c).appendTo(a)};a.prototype.addValueToRow=function(a,c,b,d,e){c=$("<div>").append(ka(c,b),$("<a class=delete></a>"));b=a.children(".value");if(d&&b.children().filter(d).length)c[e?"insertBefore":"insertAfter"](d);else c[e?"prependTo":"appendTo"](b);1<R(a).length&&a.addClass("list");return c};a.prototype.linkKey=function(a,
b){if(b){var d=this.tagList.findByUriOrCreate(b,!0),e=this.categoryUri.get();e&&(d=c.createForExplore(q.makeTagQueryLink(d,[e])),U(a).attr("href",d))}};a.prototype.linkValue=function(a,b){var d=Q(a),e=b.text(),f=this.categoryUri.get();if(!(b.attr("href")&&"enum"!=d.attr("data-href-type")||void 0!==b.attr("data-suggestion"))){var h=b.attr("data-tag-uri");(h=h&&this.tagList.findByUri(h))&&h.isEnum()&&(e=c.createForExplore(q.makeTagQueryLink(h,f?[f]:[],void 0,e,!1)),d.attr("href",e),d.attr("data-href-type",
"enum"))}};a.prototype.setupInlineTags=function(){this.manageInline&&(this.inlineUI.on("click","a.pointer",this.onPointerClick),this.inlineUI.on("click","a.field",this.onInlineClick),this.trackInlineTags())};a.prototype.trackInlineTags=function(){var a=new r(this.sections.get().map(h.node)),c=g.selectorFor("TextWidget")+" > .block-content *[data-tag-uri]";this.tags=M(G(E(a),K(c))).name("KeyValue.tags");a=this.requestRebuild.bind(this,"inline","shallow","inlineTags");c=this.requestRebuild.bind(this,
"inline","full","inlineTags");this.effects=M(G(E(this.tags),L("rnode"),N("node",function(a){return a.node}),C(c,c),P("data-tag-uri"),I,F(a,a),H("rnode"),J,S,D(function(a){return a.collapse()}),I,F(a,a)),{}).name("KeyValue.effects")};a.prototype.onPointerClick=function(a){window.Silk.canvas.document.get().undoManager.startAction("onPointerClick");a=this.getInlineTag(Q(a.target));var c=a.clone(),b=this.tagList.findByUriOrCreate($(c).attr("data-tag-uri"),!0).name;c.attr("data-key",b);a.removeAttr("data-tag-uri");
this.data.prepend(c);window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.setupPointerDeleteUI=function(){this.categoryUI.on("click","a.delete",this.onDeleteCategory);this.managedUI.on("click","a.delete",this.onDeleteManaged)};a.prototype.onDeleteCategory=function(a){window.Silk.canvas.document.get().undoManager.startAction("onDeleteCategory");A.trackWithMode("delete-tag",{Channel:"KeyValue",IsCollection:!0},!0);$(this.article).removeAttr("data-tag-context");this.categoryUI.children().addClass("suggestion");
this.stopEditing();window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.onDeleteManaged=function(a){window.Silk.canvas.document.get().undoManager.startAction("onDeleteManaged");A.trackWithMode("delete-tag",{Channel:"KeyValue",IsCollection:!1},!0);this.deleteManaged(Q(a.target));this.stopEditing();window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.deleteManaged=function(a){var c=this.getDataEntries(a);this.act(function(){c.remove();this.requestRebuild("managed",
"full","deleteManaged")})};a.prototype.cleanupWhenEmpty=function(a){if(!(Z(a)||ea(a)||ga(a)||ga(U(a)))){var c=this.getDataEntries(R(k(a)));if(s.all(function(a){return ia($(a).text())},c.get()))c.filter(function(){return $(this).attr("data-tag-uri")}).length||this.act(function(){c.remove();this.requestRebuild("managed","full","cleanupWhenEmpty")}),void 0!==c.attr("data-was-suggestion")&&this.act(function(){c.text("");c.attr("data-suggestion","");this.requestRebuild("managed","shallow","cleanupWhenEmpty")});
else{var b=this.getDataEntries(a);ia(b.text())&&this.act(function(){b.remove();this.requestRebuild("managed","full","cleanupWhenEmpty")})}}};a.prototype.setupSuggestions=function(){this.categoryOnchange=this.categoryUri.onchange(this.recomputeSuggestions);this.editingOnchange1=this.document.editing.onchange(this.editingChange)};a.prototype.editingChange=function(a){y.onThreadEnd(function(a){a&&this.suggestions.fetchPageListing()}.bind(this),arguments)};a.prototype.recomputeSuggestions=function(a,
c,b){y.onThreadEnd(function(a,c,b){if(b||this.setupPhase||!this.ignoreMutations)if(this.data.children("[data-suggestion]").not(".category").remove(),c=this.tagList.findByUri(a),!a||c)this.findKeySuggestions(a).forEach(function(a){this.data.children("[data-suggestion]").length<=this.maxSuggestions&&this.addSuggestion(a)}.bind(this)),this.requestRebuild("managed","full","recomputeSuggestions")}.bind(this),arguments)};a.prototype.findKeySuggestions=function(a){var c=this.tagList.tags.list,c=a?c.filter(function(c){return!!c.context.get(a)}):
c.sort(function(a,c){return c.count-a.count}).filter(function(a){return 0<a.count}).slice(0,10),c=c.filter(function(a){return!a.types.is("image")&&!a.types.is("video")});return c=c.sort(function(a,c){return a.index-c.index})};a.prototype.setupNewTagUI=function(){var a=$("<span>New fact</span>").click(this.onNewTagClick);this.newTag=$("<div class=new-tag />").append(a);this.node.append(this.newTag)};a.prototype.onNewTagClick=function(){window.Silk.canvas.document.get().undoManager.startAction("onNewTagClick");
this.createNewTag();window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.createNewTag=function(){A.trackWithMode("new-tag",{Channel:"KeyValue"},!0);var a=this.newKeyValue($(),!1,"","");this.setEmptyState();this.setAddTagButtonText();this.startEditing(U(a),void 0,!0)};a.prototype.setAddTagButtonText=function(){if(this.newTag){var a=this.managedUI.find("tr:not(.category)").length;this.newTag.children("span").text(a?"New fact":"Add your first fact")}};a.prototype.setupCopyPaste=function(){this.managedUI.on("paste",
".field",this.onPaste)};a.prototype.onPaste=function(a){var c=this.pasteToKeyValues(a);void 0!==c&&(a.preventDefault(),this.addPasteObject(this.getDataEntries(R($(a.target)).last()),c))};a.prototype.pasteToKeyValues=function(a){T($(a.target));var c=a.originalEvent.clipboardData&&a.originalEvent.clipboardData.getData("text/plain");if(c&&c.length)return this.pasteTextToKeyValues(c);this.pasting=!0;this.handlePasteDelayed(a.target)};a.prototype.addPasteObject=function(a,c){this.stopEditing();for(var b=
0;b<c.length;b++){var d=w.trim(c[b][0]),e=w.trim(c[b][1]),f=this.tagList.findByNameOrDefault(d).uri,d=this.newKeyValue(a,!1,d,e,f);a=this.getDataEntries(d).last()}};a.prototype.handlePasteDelayed=function(a){this.pasting=!1;var c=this.pasteTextToKeyValues(a.value);void 0===c?this.update($(a)):this.addPasteObject(this.getDataEntries(R(a).last()),c)};a.prototype.pasteTextToKeyValues=function(a){var c=a.split("\n").map(function(a){return a.split("\t")});a=a.split("\n").map(function(a){return a.split(":")});
var b=la(c),d=la(a);if(!(1.5>b&&1.5>d||(c=b>d?c:a,2>c.length))){a=[];for(b=0;b<c.length;b++)for(var d=c[b],e=1;e<d.length;e++)(1>=e||d[e].length)&&a.push([d[0],d[e]]);return a}};a.prototype.highlight=function(a){k(a).addClass("highlight");this.unhighlight(a)};a.prototype.unhighlight=function(a){k(a).removeClass("highlight")};a.prototype.act=function(a){var c=this;n.markMutations(function(){c.ignoreMutations=!0},a.bind(this),function(){c.ignoreMutations=!1})};a.prototype.serializeData=function(){var a=
$("<div class=data />");this.data.children().not("[data-suggestion]").clone().removeAttr("data-was-suggestion").appendTo(a);return a};a.prototype.serializeUI=function(){var a=this.ui.clone();a.find("tr.suggestion").remove();this.category.get()||a.find("tr.category").remove();a.find("a.delete").remove();return a};a.prototype.serializeToXML=function(a){var c=this.node[0].cloneNode(!1),b=this.serializeUI(),d=this.serializeData();b.find("tr").length||$(c).addClass("empty");a.serializeChildNodes(c,[d[0],
b[0]]);return c};a.prototype.affectsDirtyState=function(a){a=a.target===this.data[0]||a.target===this.node[0]&&!a.attribute||0<=(new h(a.target)).getShadowParents().indexOf(this.data[0])||"TEXTAREA"==a.target.nodeName&&0<=(new h(a.target)).getShadowParents().indexOf(this.managedUI[0])&&"keydown"===a.type;return!this.setupPhase&&a};a.prototype.serializeSelection=function(a){var c=O($(a.startContainer)),b=(a=Y(c))?this.getDataEntries(R(c)):this.getDataEntries(Q(c)),d=Z(c),c=c.find("textarea")[0],b=
this.data.children().get().indexOf(b[0]);if(!(!c||!d&&0>b))return this.selection={category:d,key:a,index:b,start:c.selectionStart,end:c.selectionEnd}};a.prototype.restoreSelection=function(a){if(a){if(a.category)var c=R(this.categoryUI.children());else c=this.managedUI.find("td.value a.field").eq(a.index),a.key&&(c=U(c));(c=this.startEditing(c,void 0,!0))&&ha(c,a.start,a.end);this.selection=a}};a.prototype.selectionPreserving=function(a){var c=x.get();if(c)var b=this.serializeSelection(c);a.call(this);
b&&this.restoreSelection(b)};a.prototype.node=void 0;a.prototype.categoryOnchange=void 0;a.prototype.editingOnchange0=void 0;a.prototype.editingOnchange1=void 0;a.prototype.layout=void 0;a.prototype.draggingEntries=void 0;a.prototype.ignoreMutations=!1;a.prototype.pasting=!1;return a}();m.KeyValue=k;k.init()})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.query.Roles,p=a.reactive.Value,g=a.typlib.Arrays,e=a.typlib.CleanupPool,d=a.typlib.Strings,b=function(){function a(c,b,d,f){var h;this.print=this.print.bind(this);if(h=function(a,c,b,d){this.pool=new e;this.query=a;this.roles=c.proxy;this.filters=b;this.slice=d;this.pool.push(this.selection=(new p).name("Print.selection"),this.queryString=(new p).name("Print.queryString"));this.query.query.is(this.queryString);this.setupPrinting()}.apply(h||this,
arguments))return h}a.printQuery=function(a,c,b,d){return["from all documents",f(a,c),h(a,d),m(a),w(b)].join("\n")};a.printSelectClause=function(a,c){var b=a.distribution||[],e=a.column||[],f=a.numeric||[],h=a.auxnumeric||[],g=a.location||[],q=a.link||[],n=a.image||[],r=a.description||[],s=a.group||[];if(b=b&&b.length&&"enumerate "+y(b[0]))return b;b=[{relation:l.PageTitle}];b=b.concat(e);b=b.concat(f);b=b.concat(h);b=b.concat(g);b=b.concat(q);b=b.concat(n);b=b.concat(r);b=b.concat(s);c&&c.set(b);
return d.trim("select "+b.map(y).join(" and "))};a.printWhereClause=function(a,b){b=g.append(c(a),q(b));return b.length?"where "+A(b):""};a.printCollections=function(a){a=a.collection||[];return a.length?[a.map(function(a){return"document has type "+B(a)})]:[]};a.printFilters=function(a){return g.concatMap(a,function(a){switch(a.type){case "numeric":return t(a);case "range":return t(a);case "enum":return u(a);case "matches":return s(a);case "equals":return u(a);case "nonempty":return k(a);default:return console.warn("query.Print",
"Unrecognized filter type",a.type,"in",a),[]}})};a.printMatchesFilter=function(a){return[a.values.map(function(c){return[y(a)+" contains "+z(c)]})]};a.printIsFilter=function(a){return[a.values.map(function(c){return[y(a)+" is "+z(c)]})]};a.printRangeFilter=function(a){var c=y(a);if(void 0!==a.from)var b=c+" greater than "+z(a.from);if(void 0!==a.to)var d=c+" less than "+z(a.to);return g.notNull([b,d]).map(g.singleton)};a.printNonEmpty=function(a){return[[y(a)]]};a.printOrderClause=function(a){if(a=
(a.order||[])[0])return"order "+("asc"==a.direction?"ascending":"descending")+" by "+y(a)};a.printSliceClause=function(a){return"slice from "+a.offset+" to "+(a.offset+(1>a.count?200:a.count)-1)};a.printRelation=function(a){return a.relation.map(B).join(" for ")};a.cnf=function(a){return g.map(a,function(a){return"("+a.join(" or ")+")"}).join(" and ")};a.literal=function(a){return'"'+a.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'};a.encodeUri=function(a){return a.replace(/\(/g,"%28").replace(/\)/g,
"%29")};var b=a.printQuery,h=a.printSelectClause,f=a.printWhereClause,c=a.printCollections,q=a.printFilters,s=a.printMatchesFilter,u=a.printIsFilter,t=a.printRangeFilter,k=a.printNonEmpty,m=a.printOrderClause,w=a.printSliceClause,y=a.printRelation,A=a.cnf,z=a.literal,B=a.encodeUri;a.Print=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.setupPrinting=function(){this.pool.push(p.onchange(this.print)(this.roles,this.filters.activeResolved,this.slice.map(function(a,c){return void 0===
c||void 0===a||0>c.count||a.count>c.count||a.offset<a.offset?a:c})))};a.prototype.indices=function(a){var c=this.roles.get().distribution;if("distribution"==a&&c&&c.length)return[1];var b=this.roles.get()[a];return b?g.mapMaybe(this.selection.get(),function(a,c){if(-1!==g.indexOf(b,a,l.eqRelation))return c}):[]};a.prototype.print=function(a,c,d){a&&this.queryString.set(b(a,c,d,this.selection))};return a}();k.Print=b})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.typlib.Arrays,g=a.reactive.Value,e=function(){function a(b,d){var e;if(e=function(a,b){this.query=a;this.prev=b;this.filters=(new g([])).name("Filtered.filters");this.indices=g.lift(this.computeIndices)(this.prev.headers,this.filters).name("Filtered.indices");this.headers=g.lift(this.filterHeaders)(this.indices,this.prev.headers).name("Filtered.headers");this.body=g.lift(this.filterColumns)(this.indices,this.prev.body).name("Filtered.body")}.apply(e||
this,arguments))return e}a.Filtered=a;a.prototype.cleanup=function(){this.body.cleanup();this.headers.cleanup();this.filters.cleanup();this.indices.cleanup()};a.prototype.computeIndices=function(a,d){return p.mapMaybe(a||[],function(a,b){if(p.all(function(b){return!p.equals(a.tagUris,b)},d))return b})};a.prototype.filterHeaders=function(a,d){if(a&&d)return d.filter(function(d,e){if(-1!=a.indexOf(e))return!0})};a.prototype.filterColumns=function(a,d){if(a&&d)return d.map(function(d){return d.filter(function(d,
e){if(-1!=a.indexOf(e))return!0})})};return a}();l.Filtered=e})(k.pipeline||(k.pipeline={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.domain.typing.Types,p=a.typlib.Arrays,g=a.typlib.DOMSerializer,e=a.typlib.Objects,d=function(){function a(){var c;if(c=function(){this.types={};this.pivot=this.href=this.value=this.tagUri=this.node=this.columnContext=this.staticContext=null}.apply(c||this,arguments))return c}a.fromNode=function(c,d,e){var f=new a;f.columnContext=d;f.parseFromNode(c,e);return f};a.parseDocumentHref=function(a){return decodeURIComponent(p.last(a.split("/")))};a.enrichNode=
function(a,b){window.Silk.api.enrich(g.serializeToString(a),r(a,b));h(a.textContent,f(a,b))};a.mkEnrichCallback=function(c,d){return function(e){if(c.__reactive){for(var f=e.documentElement,h=0;h<f.attributes.length;h++){var g=f.attributes[h].nodeName.match(/^data-normalized-.*/);g&&c.__reactive.attributes.get(g[0]).set($(f,e).attr(g[0]))}d(a.fromNode(c))}}};a.enrichGeo=function(a,b){var d=window.google;d&&d.maps&&d.maps.Geocoder&&(new d.maps.Geocoder).geocode({address:a},b)};a.mkGeoEnrichCallback=
function(c,d){return function(e,f){if(c.__reactive&&e){var h=e[0],g={accuracy:0,normalized:{addressTypes:h?h.types:[],resultCount:e.length}};h&&(h=h.geometry.location,g.accuracy=1,g.normalized.lat=h.lat(),g.normalized.lng=h.lng());c.isDirtFree=!0;c.__reactive.attributes.get("data-normalized-geo").set(JSON.stringify(g));d(a.fromNode(c))}}};var d=a.parseDocumentHref,r=a.mkEnrichCallback,h=a.enrichGeo,f=a.mkGeoEnrichCallback;a.Value=a;a.prototype.parseFromNode=function(a,b){this.types={};for(var e=0;e<
a.attributes.length;e++){var f=a.attributes[e].nodeName.match(/^data-normalized-(.*)/);if(f){var h=$(a).attr(f[0]);(h=h&&JSON.parse(h))&&(this.types[f[1]]=h)}}this.node=a;this.value=$(a).text();this.tagUri=$(a).attr("data-tag-uri")||this.columnContext&&this.columnContext.tagUris[0];this.document=(this.href=$(a).attr("href"))&&d(this.href);this.pivot=$(a).attr("class");if(this.tag=b||window.Silk.domain.tagList.findByUri(this.tagUri))this.staticContext=this.tag.types};a.prototype.mostLikely=function(a,
b){var d=e.keyValues(this.types).filter(function(a){return 0.5<a[1].accuracy}).map(p.idx(0)).sort(l.compare),d=d.length?d[0]:"textual";if(!a)var f=this.columnContext,d=f?f.isInContext(d):d;b||(d=(f=this.staticContext)?f.isInContext(d):d);return d};a.prototype.is=function(a){return(a=this.types[a])&&0.25<a.accuracy};a.prototype.number=function(){var a=this.types;if(a.numeric)return a.numeric.normalized;if(a.currency)return a.currency.normalized.amount;if(a.year)return a.year.normalized};a.prototype.year=
function(){var a=this.types,b;a.year?b=a.year.normalized:a.date&&(b=a.date.normalized.year);return b};a.prototype.jsDate=function(){var a=this.types.date;if(a)return new Date(a.normalized.month+"/"+a.normalized.day+"/"+a.normalized.year);if(a=this.types.year)return new Date("1/1/"+a.normalized)};return a}();k.Value=d})(m.typing||(m.typing={}))})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.reactive.Value,g=a.domain.typing.Context,e=a.domain.typing.Value,d=function(){function a(b,d){var e;this.parseHeaders=this.parseHeaders.bind(this);this.parseBody=this.parseBody.bind(this);if(e=function(a,c){this.collections=a;this.html=c;this.headers=p.lift(this.parseHeaders)(this.html).name("Parsed.header");this.body=p.lift(this.parseBody)(this.html,this.headers).name("Parsed.body")}.apply(e||this,arguments))return e}a.Parsed=a;a.prototype.cleanup=
function(){this.body.cleanup();this.headers.cleanup()};a.prototype.parseHeaders=function(a){if(a){var b=this.collections.get();return $(a).find("thead th").get().map(function(a){return g.fromNode(a,b)})}};a.prototype.parseBody=function(a,b){if(a&&b){if(!b.length)return[];for(var d=[],f,c,g=$(a).find("tbody tr").get(),s=0;s<g.length;s++){var l=$(g[s]).find("td").get();d.push(f=[]);for(var p=0;p<l.length;p++){var k=$(l[p]).find("a").get();f.push(c=[]);for(var m=0;m<k.length;m++)c.push(e.fromNode(k[m],
b[p]))}}return d}};return a}();l.Parsed=d})(k.pipeline||(k.pipeline={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.reactive.Value,g=a.typlib.ThreadEnd,e=function(){function a(b,d,e){var h;this.handle=this.handle.bind(this);if(h=function(a,c,b){this.query=a;this.enableQuery=b;this.cached=(new p(c)).name("Reactive.cached");this.input=(new p(null)).name("Reactive.input");this.output=(new p(null)).name("Reactive.output");this.query.handleResult=this.handle;this.cached.get()?this.startCached():this.startDirectly()}.apply(h||this,arguments))return h}a.Reactive=
a;a.prototype.cleanup=function(){this.output.cleanup();this.input.cleanup();this.cached.cleanup();this.query.handleResult=null};a.prototype.startCached=function(){this.output.set(this.cached.get());this.cached.set();this.enableQueryDelayed()};a.prototype.startDirectly=function(){this.enableQuery.set(!0);this.query.performQuery()};a.prototype.enableQueryDelayed=function(){g.onThreadEnd(function(){this.enableQuery.set(!0)}.bind(this),arguments)};a.prototype.handle=function(a){return this.output.set(a)};
return a}();l.Reactive=e})(k.pipeline||(k.pipeline={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.reactive.Value,g=function(){function a(b,e,g){var h;this.sliceRows=this.sliceRows.bind(this);if(h=function(a,c,b){this.query=a;this.prev=c;this.attr=b.map(d).name("Sliced.attr");this.total=c.body.mapProp("length").name("Sliced.total");this.offset=(new p(0)).name("Sliced.offset");this.wanted=(new p(-1)).name("Sliced.wanted");this.def=200;this.slice=p.toReactiveObject({offset:this.offset,count:this.wanted});this.headers=c.headers;this.body=
p.lift(this.sliceRows)(this.prev.body,this.offset,this.wanted).name("Sliced.body")}.apply(h||this,arguments))return h}a.fromAttr=function(a){if(a=$(a).attr("data-slice"))return a.split(",")};var d=a.fromAttr;a.Sliced=a;a.prototype.cleanup=function(){this.body.cleanup();this.offset.cleanup();this.wanted.cleanup();this.total.cleanup()};a.prototype.sliceRows=function(a,d,e){e<this.total.get()&&this.total.set(e);return a&&a.slice(0,0<e?e:this.def)};return a}();l.Sliced=g})(k.pipeline||(k.pipeline={}))})(m.query||
(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.client.query.Filters,g=a.client.query.Print,e=a.client.query.Query,d=a.client.query.Roles,b=a.client.query.pipeline.Filtered,n=a.client.query.pipeline.Parsed,r=a.client.query.pipeline.Reactive,h=a.client.query.pipeline.Sliced,f=a.reactive.Value,c=a.typlib.CleanupPool,q=a.reactive.Functions,s=function(){function a(b){var d;if(d=function(a){this.pool=new c;this.output=null}.apply(d||this,arguments))return d}a.raw=function(c,b){var d=new a,
h=(new f(!0)).name("Pipeline.enableQuery");d.pool.push(d.query=new e(h),d.reactive=new r(d.query,b,h),d.parsed=new n(new f([]),d.reactive.output),h);d.query.query.set(c);d.output=d.parsed;return d};a.full=function(c){var s=new a,l=(new f(!1)).name("Pipeline.enableQuery");s.pool.push(s.filters=new p(Silk.canvas),s.query=new e(q.and(l,s.filters.noTagsMissing)),s.roles=new d,s.reactive=new r(s.query,c,l),s.parsed=new n(s.roles.byRole.collection,s.reactive.output),s.sliced=new h(s.query,s.parsed,s.reactive.output),
s.filtered=new b(s.query,s.sliced),s.print=new g(s.query,s.roles,s.filters,s.sliced.slice),l);s.output=s.filtered;return s};a.Pipeline=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.getMentionedTags=function(){return this.filters.getMentionedTags()};return a}();l.Pipeline=s})(k.pipeline||(k.pipeline={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.domain.TagUris,e=a.typlib.Arrays,d=a.typlib.CleanupPool,b=a.typlib.Functions,n=a.typlib.Objects,r=a.typlib.Tracking,h=function(){function a(c,b,e,f,h){var g;this.render=this.render.bind(this);this.updateUI=this.updateUI.bind(this);this.renderValue=this.renderValue.bind(this);this.onClick=this.onClick.bind(this);this.showMoreOrLess=this.showMoreOrLess.bind(this);if(g=function(a,c,b,e,f){this.pool=new d;this.taglist=c;this.documentTags=
e;this.collections=b;this.filter=a;this.node=null;this.title=f;this.setupSuggestions()}.apply(g||this,arguments))return g}a.eligible=function(a,b){if(b){var d=a.findByUriOrCreate(b[0],!0);return!d||1>n.keyValues(d.enums).length?!1:!d.types.is("numeric")&&!d.types.is("image")&&!d.types.is("video")}};a.filterTypeName="Enum";a.Enum=a;a.prototype.cleanup=function(){this.node&&this.node.remove();this.pool.cleanup()};a.prototype.setupSuggestions=function(){this.pool.push(this.tag=this.filter.mapValue(function(a){return this.taglist.findByUriOrCreate(a.relation[0])}.bind(this)));
var a=this.tag.get();this.filter.get().values&&!a.enums[this.filter.get().values[0]]&&(a.enums[this.filter.get().values[0]]=1);this.suggestions=n.keyValues(a.enums).sort(b.flip(b.comparing(e.idx(1))));if(Silk.domain.userStorage.enableTagMentionsAndPinning.get()){var d=this.documentTags.get();d&&(a=d.generalizeTagUri(a.uri),this.documentTags.get().isTagCurrentlyPresent(a)&&this.suggestions.push([{mention:a},0]))}};a.prototype.render=function(){this.node=$("<div/>");this.list=$("<div class=list>").appendTo(this.node);
this.list.append(this.suggestions.map(this.renderValue));this.pool.push(this.filter.onchange(this.updateUI));this.more=$("<div class=more>show more</div>").hide().appendTo(this.node).click(this.showMoreOrLess);this.collapsed=!0;this.toggleCollapsedState(!0);return this.node};a.prototype.toggleCollapsedState=function(){if(this.collapsed){var a=this.suggestions.length,b=Math.max(0,this.list.children(".selected").index());if(11<a){this.more.show().text("show more");var d=Math.max(0,3-b),e=Math.max(0,
3-(a-b-1)),e=Math.max(0,Math.min(a,b-(e+3))),a=Math.max(0,Math.min(a,b+(d+3+1)));this.list.children().hide();this.list.children().slice(e,a).css("display","block")}}else this.more.show().text("show less"),this.list.children().css("display","block")};a.prototype.updateUI=function(a){if(void 0!==a){this.list.children().removeClass("selected");a=a.values||[];for(var b=0;b<a.length;b++)(a[b].mention?this.list.children("[data-mention='"+a[b].mention+"']"):this.list.children("[data-value='"+a[b].toLowerCase()+
"']")).addClass("selected")}};a.prototype.renderValue=function(a){a=a[0];var b;a.mention?(b=a.mention,b=b===g.Title?"Match current page":"This page's "+this.taglist.findByUriOrCreateWithoutSaving(b).name):b=a;b=$("<a class=suggestion/>").append($("<span class=value />").text(b));a.mention?b.attr("data-mention",a.mention):b.attr("data-value",a.toLowerCase());b.click(this.onClick.bind(this,a));return b};a.prototype.onClick=function(a,b){function d(a){return a.mention?a:a.toLowerCase()}var f=[],h=this.filter.get().values||
[],g=h.map(d),n=d(a),f=b.shiftKey?-1==g.indexOf(n)?h.concat([a]):h.filter(function(a){return d(a)!=n}):e.equals(h,[a])?[]:[a];this.filter.modify(function(a){a.values=f;return a});r.trackWithMode("explore-filter-updated",{"Filter Type":"Enum",Filter:this.tag.uri})};a.prototype.showMoreOrLess=function(a){this.collapsed=!this.collapsed;this.toggleCollapsedState()};return a}();l.Enum=h})(l.filter||(l.filter={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_=
{}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.typlib.CleanupPool,e=a.typlib.Tracking,d=function(){function a(b,d,e,f){var c;this.updateUI=this.updateUI.bind(this);this.toggle=this.toggle.bind(this);this.onCheck=this.onCheck.bind(this);if(c=function(a,c,b,d){this.pool=new g;this.taglist=c;this.collections=b;this.filter=a;this.checkbox=this.node=null}.apply(c||this,arguments))return c}a.eligible=function(a,b){if(b)return!!a.findByUriOrCreate(b[0],!0)};a.filterTypeName="NonEmpty";
a.NonEmpty=a;a.prototype.cleanup=function(){this.node&&this.node.remove();this.pool.cleanup()};a.prototype.render=function(){this.node=$("<div/>");this.checkbox=$("<input type=checkbox />");$("<label> Show only pages with this tag</label>").prepend(this.checkbox).appendTo(this.node);this.checkbox.on("click",this.onCheck);this.pool.push(this.filter.onchange(this.updateUI));return this.node};a.prototype.updateUI=function(a){void 0!==a&&this.checkbox.prop("checked",!!a.enabled)};a.prototype.toggle=function(){this.enabled.set(!this.enabled.get())};
a.prototype.onCheck=function(){var a=!0===this.checkbox.prop("checked");this.filter.modify(function(b){b.enabled=a;return b});e.trackWithMode("explore-filter-updated",{"Filter Type":"NonEmpty",Filter:this.tag&&this.tag.uri})};return a}();l.NonEmpty=d})(l.filter||(l.filter={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.filter.TagMentioning,e=a.typlib.CleanupPool,d=a.typlib.Strings,b=a.typlib.Tracking,n=function(){function a(b,c,d,h){var g;this.updateUI=this.updateUI.bind(this);this.insertCurrencySymbol=this.insertCurrencySymbol.bind(this);var n=this;this.onInput=function(){var c=arguments;n.__delayed_toh_onInput__&&clearTimeout(n.__delayed_toh_onInput__);n.__delayed_toh_onInput__=setTimeout(function(){a.prototype.onInput.apply(n,
c);n.__delayed_toh_onInput__=null},400)};if(g=function(a,c,b,d){this.pool=new e;this.taglist=c;this.collections=b;this.filter=a;this.to=this.from=this.node=null;this.tag=c.findByUriOrCreate(a.get().relation[0],!0);this.isCurrency=this.tag.types.is("currency")}.apply(g||this,arguments))return g}a.currencySymbol=function(a){return{USD:"$",EUR:"€",GBP:"£",JPY:"¥",SEK:"kr"}[a]||"€"};a.eligible=function(a,c){if(c){var b=a.findByUriOrCreate(c[0],!0);if(!b)return!1;b=b.types.mostLikely();return"numeric"==
b||"date"==b||"year"==b||"currency"==b}};a.filterTypeName="Range";var h=a.currencySymbol;a.Range=a;a.prototype.cleanup=function(){this.node&&this.node.remove();this.pool.cleanup()};a.prototype.render=function(){this.node=$("<div/>");this.from=$("<input placeholder='value' type=text class='empty from' />");this.to=$("<input placeholder='value' type=text class='empty to'   />");this.node.append($("<div class='label from'>From</div>"),$("<div class='label to'>To</div>"),this.from,this.to,$("<br/>"));
var a=this.node.find("input");a.on("input",this.onInput);this.isCurrency&&(a.on("focus",this.insertCurrencySymbol),a.on("blur",this.insertCurrencySymbol),a.on("keyup",this.insertCurrencySymbol));this.pool.push(this.filter.onchange(this.updateUI));return this.node};a.prototype.onInput=function(a){var c=this.from.val(),d=this.to.val(),e=this.taglist;this.filter.modify(function(a){a.from=""===c?void 0:g.parse(e,c);a.to=""===d?void 0:g.parse(e,d);return a});b.trackWithMode("explore-filter-updated",{"Filter Type":"Range",
Filter:this.tag.uri})};a.prototype.updateUI=function(a){void 0!==a&&(this.from.val(g.print(this.taglist,a.from)),this.to.val(g.print(this.taglist,a.to)),this.from.toggleClass("empty",void 0===a.from),this.to.toggleClass("empty",void 0===a.to))};a.prototype.insertCurrencySymbol=function(a){a=$(a.target);var c=d.trim(a.val());if(""!=c&&c.match(/^-?[\d,.]/)){var b=this.tag.distribution.minimum,e=this.tag.distribution.maximum,b=b&&b.types.currency,e=e&&e.types.currency,b=b&&b.normalized.currency;(b=(e=
e&&e.normalized.currency)||b)&&(b=h(b))&&a.val(b+" "+c)}};return a}();l.Range=n})(l.filter||(l.filter={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var p=a.client.query.pipeline.Pipeline,g=a.reactive.Value,e=a.typlib.Arrays,d=a.typlib.Objects,b=a.typlib.CleanupPool,n=a.ui.input.Selectbox,r=function(){function a(d,c,e){var h;this.setup=this.setup.bind(this);this.results=this.results.bind(this);if(h=function(a,c,d){this.pool=new b;this.input=a;this.pipeline=null;this.items=(new g([])).name("QuerySelectbox.items");this.box=null;this.onSetup=c;this.column=void 0===d?1:d;this.input.on("focus",this.setup)}.apply(h||
this,arguments))return h}a.QuerySelectbox=a;a.prototype.cleanup=function(){this.input.off("focus",this.setup);this.pool.cleanup()};a.prototype.setup=function(){this.input.off("focus",this.setup);this.setupSelectbox();this.setupPipeline();if(this.onSetup)this.onSetup(this)};a.prototype.setupPipeline=function(){this.pipeline=p.full();this.pipeline.output.body.onchange(this.results,!0)};a.prototype.setupSelectbox=function(){this.box=new n(this.input,n.Popup);this.pool.push(this.box);this.box.onFilter=
this.box.filterLabelByInput.bind(this.box,!1);this.box.items.is(this.items);this.box.vOffset=5;this.box.hScale=0};a.prototype.results=function(a){a=e.concat(e.mapProp(a,this.column)).map(function(a){return{label:a.value,item:a}});a=e.sortByComparing(a,d.prop("label"));a=e.localUniqueBy(a,function(a,b){return a.label==b.label});this.items.set(a);this.box.render()};return a}();l.QuerySelectbox=r})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.query.Roles,e=a.client.ui.queryviewer.QuerySelectbox,d=a.client.ui.queryviewer.filter.TagMentioning,b=a.typlib.CleanupPool,n=a.typlib.Tracking,r=function(){function a(d,c,e){var h;this.mkInput=this.mkInput.bind(this);this.updateUI=this.updateUI.bind(this);this.onCheck=this.onCheck.bind(this);this.onInput=this.onInput.bind(this);if(h=function(a,c,d){this.pool=new b;this.filter=a;this.taglist=c;this.querybox=null;this.collections=
d}.apply(h||this,arguments))return h}a.eligible=function(a,c){if(!c)return!0;var b=a.findByUriOrCreate(c[0],!0);if(!b)return!1;var d=b.types.is("video"),b=b.types.is("image");return d||b?!1:!0};a.filterTypeName="Textual";a.Textual=a;a.prototype.cleanup=function(){this.cleaningUp=!0;this.node&&this.node.remove();this.pool.cleanup()};a.prototype.render=function(){this.node=$("<div/>");this.inputs=$("<div/>");this.checkbox=$("<input type=checkbox />");var a=$("<label>Exact match </label>").append(this.checkbox);
this.node.append(this.inputs,a);this.node.on("input","input",this.onInput);this.checkbox.on("click",this.onCheck);this.pool.push(this.filter.onchange(this.updateUI));return this.node};a.prototype.setupQueryBox=function(a){var c=function(c,b,d){a.val(c.label);this.onInput({target:a[0]});d.close()}.bind(this),b=this.filter.get(),d=g.isPageTitle(b.relation);this.querybox=new e(a,function(a){var e=a.pipeline.roles.byRole;e.collection.set(this.collections.get());d||e.column.set([{relation:[b.relation[0]]}]);
a.box.onSelect=c}.bind(this),d?0:1)};a.prototype.mkInput=function(){var a=$("<input type=text />");a.attr("placeholder","Filter");a.addClass("empty");this.setupQueryBox(a);return a};a.prototype.updateUI=function(a){if(void 0!=a){if(this.causedByUserInput){var c=this.node.find("input[type=text]").filter(function(){return $(this).val().match(/^\s*$/)});0==c.length?this.inputs.append(this.mkInput()):1<c.length&&c.not(this.causedByUserInput).remove()}else{var b=this.inputs;this.node.find("input[type=text]").remove();
(a.values||[]).forEach(function(a){a=this.mkInput().val(d.print(this.taglist,a)).removeClass("empty");b.append(a)}.bind(this));b.append(this.mkInput())}this.checkbox.prop("checked","equals"==a.type)}};a.prototype.onCheck=function(){var a=!0===this.checkbox.prop("checked")?"equals":"matches";this.filter.modify(function(c){c.type=a;return c});var c=this.filter.get();n.trackWithMode("explore-filter-updated",{"Filter Type":"Textual",Filter:g.isPageTitle(c.relation)?"Page name":c.relation.join()})};a.prototype.onInput=
function(a){var c=this.node.find("input[type=text]"),b=c.get().filter(function(a){return!$(a).val().match(/^\s*$/)});$(c).addClass("empty");$(b).removeClass("empty");this.causedByUserInput=a.target;var e=this.taglist,h=b.map(function(a){return d.parse(e,$(a).val())});this.filter.modify(function(a){a.values=h;return a});this.causedByUserInput=!1;a=this.filter.get();n.trackWithMode("explore-filter-updated",{"Filter Type":"Textual",Filter:g.isPageTitle(a.relation)?"Page name":a.relation.join()})};return a}();
l.Textual=r})(l.filter||(l.filter={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Objects,p=a.reactive.Value,g=function(){function a(d,b){var e;this.activate=this.activate.bind(this);this.blur=this.blur.bind(this);this.keydown=this.keydown.bind(this);this.oninput=this.oninput.bind(this);if(e=function(a,b){this.options=l.merge(this.defaultOptions,b);this.target=a?$(a):$("<input />");this.node=this.target.wrap("<div class=input-box-wrapper />").parent();this.enabled=this.options.enabled;this.input=$("<input/>").addClass("input-box");
this.dirty=this.active=!1;this.activateEvent=this.options.activateEvent;this.hasStyle=!1;this.onInput=null;this.setupEvents()}.apply(e||this,arguments))return e}a.Inputbox=a;a.prototype.defaultOptions={enabled:new p(!0),activateEvent:"mousedown"};a.prototype.setupEvents=function(a){a=this.activateEvent;this.node.on(a,this.activate);this.target.on(a,this.activate);this.input.on("input",this.oninput).on("blur",this.blur).on("keydown",this.keydown)};a.prototype.cleanup=function(){var a=this.activateEvent;
this.node.off(a,this.activate);this.target.off(a,this.activate);this.input.off("input",this.oninput).off("blur",this.blur).off("keydown",this.keydown)};a.prototype.setupStyle=function(){["font-family","font-size","font-weight"].forEach(function(a){this.input.css(a,this.target.css(a))}.bind(this));this.hasStyle=!0};a.prototype.activate=function(a){this.open()&&(a.preventDefault(),a.cancelBubble=!0)};a.prototype.blur=function(){this.commit()};a.prototype.keydown=function(a){switch(a.keyCode){case 13:this.commit();
break;case 27:this.cancel()}};a.prototype.oninput=function(){this.dirty=!0;if(this.onInput)this.onInput(this.input.val(),this)};a.prototype.triggerEditEvent=function(){var a=$.Event("edit");$(this).triggerHandler(a)};a.prototype.triggerCommitEvent=function(){var a=$.Event("commit");a.value=this.input.val();$(this).triggerHandler(a)};a.prototype.triggerCancelEvent=function(){var a=$.Event("cancel");$(this).triggerHandler(a)};a.prototype.open=function(){if(this.active||!this.enabled.get())return!1;
this.hasStyle||this.setupStyle();this.active=!0;this.input.val(this.target.text());this.node.append(this.input);this.triggerEditEvent();this.input.focus().select(0);return!0};a.prototype.commit=function(){this.active&&(this.target.text(this.input.val()),this.triggerCommitEvent(),this.close())};a.prototype.cancel=function(){this.active&&(this.triggerCancelEvent(),this.close())};a.prototype.close=function(){this.dirty=this.active=!1;this.input.detach()};a.prototype.setValue=function(a){this.dirty=!0;
this.input.val(a)};return a}();k.Inputbox=g})(m.input||(m.input={}))})(a.ui||(a.ui={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,p=a.typlib.Arrays,g=a.typlib.CleanupPool,e=a.typlib.Functions,d=a.typlib.Objects,b=a.ui.Bubble,n=a.ui.input.Inputbox,r=a.ui.input.Selectbox,h=function(){function a(b,e,f){var h;this.createBubble=this.createBubble.bind(this);this.deepContext=this.deepContext.bind(this);this.onSelect=this.onSelect.bind(this);this.onRender=this.onRender.bind(this);this.onDeepClick=this.onDeepClick.bind(this);this.onDeepResetClick=this.onDeepResetClick.bind(this);
this.cleanupBubble=this.cleanupBubble.bind(this);if(h=function(a,b,e){this.pool=new g;this.node=a;this.target=b;this.options=d.merge(c,e);this.stack=(new l([])).name("PickerBubble.stack");this.setupBoxes();this.setupBubble()}.apply(h||this,arguments))return h}a.defaultOptions=function(){return{onRender:e.id,onSelect:e.nop,onCreate:e.id,onDeepClick:e.nop,onDeepResetClick:e.nop,freeTextInput:void 0,items:function(){return[]}}}();var c=a.defaultOptions;a.PickerBubble=a;a.prototype.cleanup=function(){this.pool.cleanup()};
a.prototype.setupBoxes=function(){this.pool.push(this.inputbox=new n($("<input placeholder='quick filter' />")),this.selectbox=new r(this.inputbox.target,r.Fixed));var a=this.selectbox;a.onFilter=function(c){var b=this.options.freeTextInput,d=this.inputbox.target.val();return b?p.append(b(d),a.filterLabelByInput(!1,c)):a.filterLabelByInput(!1,c)}.bind(this);a.onSelect=this.onSelect;a.onRender=this.onRender};a.prototype.setupBubble=function(){this.bubbleRef=b.click(this.node,this.createBubble,320,
null,this.target,{position:"bottom"},this.cleanupBubble)};a.prototype.createBubble=function(){this.selectbox.clear();this.resetItems();this.inputbox.open();var a=this.inputbox.target;a.css("width","283px");setTimeout(function(){a.focus()});var c=$("<div class=picker-bubble/>");0<this.selectbox.items.get().length||this.options.freeTextInput?c.append(this.deepContext(),this.inputbox.target,this.selectbox.node):c.append($("<div class=fallback />").append(this.options.fallback));return this.options.onCreate(c)};
a.prototype.deepContext=function(a){a=this.stack;var c=$("<div class=deep />"),b=$("<div class=clear>×</div>").click(this.onDeepResetClick);c.rHtml(a.map(function(a){return a.length?$("<div class=content />").append($(a.map(function(a){return $("<span class=item />").text(a.label)[0]})),b):$()}.bind(this)));return c};a.prototype.onSelect=function(a,c){(a=this.options.onSelect(a,this.stack.get(),c))?(this.bubbleRef.close(),this.stack.set([])):c.preventDefault()};a.prototype.onRender=function(a,c){var b=
r.renderItem(a,c),b=this.options.onRender(b,a,this.stack.get()),d=$("<span class=more>&nbsp;</span>").appendTo(b);a.deep&&d.text("►").mousedown(this.onDeepClick.bind(this,a));void 0!==a.count&&$("<span class=count />").text(a.count).appendTo(b);!0===a.disabled&&b.addClass("disabled");return b};a.prototype.onDeepClick=function(a,c){this.stack.set(this.stack.get().concat([a]));this.resetItems();this.selectbox.render();this.options.onDeepClick(a);this.inputbox.target.val("");c.stopPropagation();c.preventDefault()};
a.prototype.onDeepResetClick=function(a){this.stack.set([]);this.resetItems();this.options.onDeepResetClick()};a.prototype.resetItems=function(){this.selectbox.clear();this.selectbox.addItems(this.options.items(this.stack.get()))};a.prototype.cleanupBubble=function(a){this.inputbox.target.val("");this.stack.set([])};return a}();k.PickerBubble=h})(m.picker||(m.picker={}))})(a.ui||(a.ui={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,p=a.typlib.Arrays,g=a.typlib.CleanupPool,e=a.typlib.Functions,d=a.typlib.Objects,b=a.typlib.Tracking,n=a.typlib.ThreadEnd,r=function(){function a(c){var b;this.render=this.render.bind(this);this.equals=this.equals.bind(this);this.eqPill=this.eqPill.bind(this);this.eqItem=this.eqItem.bind(this);if(b=function(a){this.pool=new g;this.plusUI=this.valuesNode=this.descNode=this.node=null;this.options=d.merge(f,a);this.values=(new l([],this.equals)).name("Pills.values");
this.pool.push(this.values);this.setupNode()}.apply(b||this,arguments))return b}a.defaultOptions=function(){return{multi:!1,allowEmpty:!0,setupUI:function(){},equals:void 0}}();var f=a.defaultOptions;a.Pills=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.setupNode=function(){this.valuesNode=$("<span class=values />");this.node=$("<div class=inline-value-picker />").append(this.valuesNode);this.options.description&&(this.descNode=$("<div class=description />").rHtml(l.value(this.options.description)).prependTo(this.node));
this.pool.push(this.valuesOnChange=this.values.onchange(this.render))};a.prototype.render=function(){n.onThreadEnd(function(){this.options.readOnly&&this.node.addClass("read-only");var a=this.values.get();void 0!==a&&(this.renderValues(a),this.renderPlusButton(a))}.bind(this),arguments,"render",this)};a.prototype.renderValues=function(a){this.valuesNode.empty();this.node.toggleClass("empty",!a||!a.length);if(a)for(var b=0;b<a.length;b++){var d=$("<div class=value />").appendTo(this.valuesNode),e=
$("<div class=steps />").appendTo(d);this.valuesNode.append(" ");for(var f=a[b].slice().reverse(),h=0;h<f.length;h++){var g=$("<span class=step />").appendTo(e).toggleClass("first",0===h);f[h].html?g.rHtml(l.value(f[h].html)):g.rText(l.value(f[h].label))}$("<span/>").addClass("down").text("▾").prependTo(e);(this.options.allowEmpty||1<a.length)&&$("<div/>").addClass("del").append($("<div/>").text("×")).click(this.onDelete.bind(this,a[b])).prependTo(d.addClass("deletable"));this.setupUI(d,b,!1)}};a.prototype.renderPlusButton=
function(a){this.node.find(".plus").remove();var b=this.options.multi instanceof Function?this.options.multi():this.options.multi;if(!a.length||b)a=$("<div class=plus />").rText(l.value(this.options.addText||"Add")),$("<span/>").addClass("down").text("▾").prependTo(a),this.node.append(a),this.options.allowDeletion&&$("<div/>").addClass("del").append($("<div/>").text("×")).click(this.onDeleteUI.bind(this)).prependTo(a.addClass("deletable")),this.plusUI=this.setupUI(a,null,!0)};a.prototype.onDeleteUI=
function(a){b.trackWithMode("explore-pinned-filter-removed",{});this.options.allowDeletion();a.stopPropagation()};a.prototype.onDelete=function(a,d){b.trackWithMode("explore-columns-removed",{});this.remove(a);d.stopPropagation()};a.prototype.setupUI=function(a,b,d){if(this.options.setupUI)return this.options.setupUI(this,a,b,d)};a.prototype.equals=function(a,b){return p.equals(a,b,this.eqPill)};a.prototype.eqPill=function(a,b){return p.equals(a,b,this.eqItem)};a.prototype.eqItem=function(a,b){return(this.options.equals||
e.equals)(a.item,b.item)};a.prototype.clear=function(){var a=this.values.get();this.values.set([]);return a};a.prototype.set=function(a){this.values.set(a)};a.prototype.add=function(a){this.values.set(this.values.get().concat([a]))};a.prototype.remove=function(a){this.values.set(this.values.get().filter(function(b){return!this.eqPill(a,b)}.bind(this)))};return a}();k.Pills=r})(m.picker||(m.picker={}))})(a.ui||(a.ui={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.query.pipeline.Pipeline,e=a.client.ui.queryviewer.filter.Enum,d=a.reactive.Value,b=a.typlib.Arrays,n=a.typlib.CleanupPool,r=a.typlib.Objects,h=a.typlib.Strings,f=a.ui.picker.PickerBubble,c=a.ui.picker.Pills,q=function(){function a(c,b,f,h,g){var q;this.selectItem=this.selectItem.bind(this);this.makeItems=this.makeItems.bind(this);this.setupPicker=this.setupPicker.bind(this);this.freeTextInput=this.freeTextInput.bind(this);
var r=this;this.fetch=function(){var c=arguments;r.__delayed_toh_freeTextInput__&&clearTimeout(r.__delayed_toh_freeTextInput__);r.__delayed_toh_freeTextInput__=setTimeout(function(){a.prototype.fetch.apply(r,c);r.__delayed_toh_freeTextInput__=null},200)};if(q=function(a,c,b,f,h){this.pool=new n;this.taglist=c;this.documentTags=f;this.collections=b;this.filter=a;this.node=null;this.title=d.value(h).name("InlineTextual.title");this.queryItems=(new d([])).name("InlineTextual.queryItems");this.cache=
{};this.pills=null;this.suggestions=[];this.filter.get().relation&&e.prototype.setupSuggestions.call(this)}.apply(q||this,arguments))return q}a.mkPillItem=function(a,c,b){return{html:a.map(function(a){return a+": "+c}),item:{value:c,type:b}}};a.eligible=function(a,c){if(!c)return!0;var b=a.findByUriOrCreate(c[0],!0);return b?!b.types.is("image")&&!b.types.is("video"):!1};a.filterTypeName="InlineTextual";var q=a.mkPillItem;a.InlineTextual=a;a.prototype.cleanup=function(){this.node&&this.node.remove();
this.pool.cleanup()};a.prototype.textMapper=function(a,c){return(c?"":"Filter by ")+a};a.prototype.render=function(a){a=d.lift(this.textMapper)(this.title,a).persist();this.pool.push(this.pills=new c({multi:!1,setupUI:this.setupPicker,addText:a,allowDeletion:function(){this.filter.set(void 0)}.bind(this)}));this.pills.pool.push(a);this.setupSyncing();return this.node=$("<div/>").append(this.pills.node)};a.prototype.setupSyncing=function(){var a=this.filter,c=q.bind(this,this.title);d.biconnect(function(a){return a.map(function(a){return a&&
a.values?a.values.map(function(b){return[c(b,a.type)]}):[]})},function(c){return c.map(function(c){if(c){var d=r.cloneObject(a.get());c=b.concat(c);d.values=c.map(function(a){return a.item.value});c=c.map(function(a){return a.item.type});d.type=c[0]||"equals";return d}})})(this.filter,this.pills.values)};a.prototype.selectItem=function(a,c,b){this.pills.values.set([[q(this.title,a.item.value,a.item.type)]]);this.queryItems.set(this.cache[""]||[]);return a};a.prototype.makeItems=function(){function a(c){return{label:c,
item:{value:c,type:"equals"}}}function c(a,b){return a.label==b.label}var d=b.mapProp(this.suggestions,0).map(a),e=(this.queryItems.get()||[]).map(a),d=b.sortByComparing(d,r.prop("label")),e=b.sortByComparing(e,r.prop("label")).filter(function(a){return-1==b.indexOf(d,a,c)}),e=d.concat(e),e=e.filter(function(a){return!a.label.mention});return e=b.localUniqueBy(e,function(a,c){return h.trim(a.label.toLowerCase())==h.trim(c.label.toLowerCase())})};a.prototype.setupPicker=function(a,c){this.pickerBubble=
new f(c,c,{onSelect:this.selectItem,items:this.makeItems,freeTextInput:this.freeTextInput});this.pool.push(this.pickerBubble)};a.prototype.freeTextInput=function(a){this.fetch(a);return a.length?[{html:$("<div/>").text(a).prepend($("<strong/>").text("Matching: ")),item:{value:a,type:"matches"}}]:[]};a.prototype.fetch=function(a){if(this.lastInput!=a){this.lastInput=a;var c=this.cache[a];if(c)this.queryItems.set(c),this.pickerBubble.selectbox.items.set(this.makeItems()),this.pickerBubble.selectbox.render();
else{var c=g.full(),e=c.roles.byRole;e.collection.set(this.collections.get());if(this.filter.get()){var f=this.filter.get().relation;e.column.set([{relation:f}]);c.filters.raw.push(new d({relation:f,type:"matches",values:[a]}));c.output.body.onchange(function(c){c=b.concat(b.mapProp(c,f?1:0)).map(function(a){return a.value});this.cache[a]=c;this.queryItems.set(c);this.pickerBubble.selectbox.items.set(this.makeItems());this.pickerBubble.selectbox.render()}.bind(this),!0)}}}};return a}();l.InlineTextual=
q})(l.filter||(l.filter={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.query.Roles,e=a.typlib.Arrays,d=a.typlib.Functions,b=a.typlib.Objects,n=a.typlib.Strings,r=a.ui.picker.PickerBubble,h=function(){function a(c,d,e,f,h){var g;this.onSelect=this.onSelect.bind(this);this.items=this.items.bind(this);this.collectionItems=this.collectionItems.bind(this);this.makeRelation=this.makeRelation.bind(this);if(g=function(a,c,d,e,f){this.node=a;this.target=c;this.tagList=d;this.collections=e;this.options=
b.merge(x,f);this.picker=null}.apply(g||this,arguments))return g}a.itemsFromRelation=function(a,c,d){d=b.cloneObject(d);if(g.isPageTitle(d.relation))return delete d.relation,[{label:c,item:b.merge(d,{isDocument:!0})}];a=a.byUris(d.relation);return e.dropLast(e.tails(a)).map(function(a){return{label:a[0].name,item:b.merge(d,{relation:a})}})};a.itemToRole=function(a){a=b.cloneObject(a);a.relation&&(a.relation=a.relation.map(b.prop("uri")));a.isDocument&&(delete a.isDocument,a.relation=g.PageTitle);
return a};a.relationPredicate=function(a){return function(c){return c.relation?a(c.relation[0]):e.any(a,this.tagList.byUris(this.collections.get()))}};a.tagOfType=function(a){return function(c){return c.types.is(a)}};a.tagNoMedia=function(a){return!h("image")(a)&&!h("video")(a)};a.tagIsLink=function(a){return isNaN(a.linked)||a&&0.3<a.linked};a.tagIsEnum=function(a){return a.isEnum()};a.forCollections=function(a){return function(c){return a&&a.length?e.any(function(a){return 0<c.context.get(a)},a):
!0}};a.byCount=function(a){return-a.count};a.byArity=function(a){return a.arity};a.byEnumness=function(a){return-a.enumness()};a.eqRelation=function(a,c){var f=d.equating(b.prop("uri"));return a.isDocument&&c.isDocument?!0:a.relation&&c.relation?e.equals(a.relation,c.relation,f):!1};a.defaultOptions=function(){return{description:"Pick a tag",predicate:function(){return!0},comparing:function(a){return a.label},onCreate:d.id,onRender:d.id,docName:!1,collection:!1,fallback:"No tags available"}}();var c=
a.relationPredicate,h=a.tagOfType,l=a.tagNoMedia,k=a.tagIsLink,p=a.tagIsEnum,m=a.forCollections,x=a.defaultOptions;a.TagPicker=a;a.prototype.cleanup=function(){this.picker.cleanup()};a.prototype.setup=function(){this.picker=new r(this.node,this.target,{onRender:this.options.onRender,onSelect:this.onSelect,items:this.options.collection?this.collectionItems:this.items,onCreate:this.options.onCreate,fallback:this.options.fallback});this.inputbox=this.picker.inputbox;this.selectbox=this.picker.selectbox;
this.bubbleRef=this.picker.bubbleRef};a.prototype.onSelect=function(a,c,b){if(a&&!a.disabled)return this.options.onSelect(a,c,b)};a.prototype.items=function(a){var c=this.options,b=this.tagList.tags.list,d=c.predicate.bind(this),e=a.length?a[a.length-1].item.relation[0].outtypes.keys():this.collections.get(),f=this,c=b.filter(function(a){return m(e)(a)&&(d(f.makeRelation(a))||a.hasSubOptions())}).sort(c.comparing).map(function(a){var c=f.makeRelation(a);return{label:a.name,item:c,deep:a.hasSubOptions(),
count:void 0,disabled:!d(c)}});this.options.docName&&!a.length&&(a=(a=this.collections.get())&&a.length?n.prettyJoin(this.tagList.toNames(a)):"Page name",b={isDocument:!0},d(b)&&c.unshift({label:a,item:b,deep:!1,count:void 0,disabled:!1}));return c};a.prototype.collectionItems=function(){var a=this.collections.get();return this.tagList.docLevelTags.list.map(function(c){return{label:c.name,item:c,deep:!1,count:void 0,disabled:-1!==a.indexOf(c.uri)}})};a.prototype.makeRelation=function(a){var c=this.picker.stack.get();
return{relation:e.append(a,c.length?e.last(c).item.relation:[])}};a.prototype.ofType=function(a){return c(h(a)).bind(this)};a.prototype.isEnum=c(p);a.prototype.noMedia=c(l);a.prototype.isLink=c(k);return a}();l.TagPicker=h})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.query.Filters,e=a.client.query.Roles,d=a.client.ui.queryviewer.filter.Enum,b=a.client.ui.queryviewer.filter.NonEmpty,n=a.client.ui.queryviewer.filter.Range,r=a.client.ui.queryviewer.filter.Textual,h=a.client.ui.queryviewer.filter.InlineTextual,f=a.client.ui.queryviewer.picker.TagPicker,c=a.reactive.Value,q=a.typlib.Arrays,s=a.typlib.CleanupPool,k=a.typlib.Functions,t=a.typlib.Images,m=a.typlib.Objects,x=a.typlib.Strings,
w=a.typlib.Svg,y=a.typlib.Tracking,A=a.ui.Bubble,z=a.typlib.ThreadEnd,B=function(){function a(c,b,d,e){var f;this.computeSuggestions=this.computeSuggestions.bind(this);this.byUri=this.byUri.bind(this);this.render=this.render.bind(this);this.renderFilter=this.renderFilter.bind(this);this.createSuggestionUI1=this.createSuggestionUI1.bind(this);this.createSuggestionUI=this.createSuggestionUI.bind(this);this.renderItem=this.renderItem.bind(this);this.doesntHaveRelation=this.doesntHaveRelation.bind(this);
this.removeItem=this.removeItem.bind(this);this.changeFilterType=this.changeFilterType.bind(this);var h=this;this.addFilter=function(){var c=arguments;setTimeout(function(){a.prototype.addFilter.apply(h,c)},200)};this.addPinnedFilter=function(){var c=arguments;setTimeout(function(){a.prototype.addPinnedFilter.apply(h,c)},200)};if(f=function(a,c,b,d){this.pool=new s;this.pipeline=a;this.filters=a.filters;this.roles=a.roles;this.collections=a.roles.byRole.collection;this.storage=b;this.taglist=c;this.documentTags=
d;this.list=this.plus=this.pinnedNode=this.node=null;this.shouldCondense=a.filters.raw.flat().mapValue(function(a){return 1<a.filter(g.isPinned).length}).name("Filters.shouldCondense");this.setupNode();this.setupListHeader();this.setupPlusButtons();this.pool.push(this.collections.onchange(this.render))}.apply(f||this,arguments))return f}a.tagToUriRelation=function(a){return a.relation?a.relation.map(function(a){return a.uri}):e.PageTitle};var l=a.tagToUriRelation;a.Filters=a;a.prototype.cleanup=function(){this.pool.cleanup();
this.node.remove()};a.prototype.setupListHeader=function(){this.filterLabel=$("<p class='condensed-filter-by'>Filter by:</>").rToggleDisplay(this.shouldCondense);this.pinnedNode.find(".list").prepend(this.filterLabel)};a.prototype.setupNode=function(){this.node=$("<div class=filters />");this.list=$("<div class=list />");this.node.append(this.list);this.pinnedNode=$("<div class=filters />");this.pinnedList=$("<div class=list />");this.pinnedNode.append(this.pinnedList)};a.prototype.setupPlusButtons=
function(){this.plus=$("<div class=plus><a>Add filter</a></div>").prependTo(this.node);this.plusBubble=this.setupPlusButton(this.plus,function(){return!0},this.addFilter.bind(this));this.pinnedPlus=$("<div class=plus><a>Add inline filter</a></div>").appendTo(this.pinnedNode);this.pinnedPlusBubble=this.setupPlusButton(this.pinnedPlus,function(a){return h.eligible(this.taglist,l(a))}.bind(this),this.addPinnedFilter.bind(this));this.pinnedNode.append($("<div style=clear:both />"))};a.prototype.setupPlusButton=
function(a,c,b){var d=new f(a,a,this.taglist,this.collections,{onSelect:function(a){d.bubbleRef.close();b(a)}.bind(this),predicate:function(a){return this.doesntHaveRelation(a)&&c(a)}.bind(this),docName:!0});d.setup();return d};a.prototype.computeSuggestions=function(a,c){a=a||[];c=c||[];var b=this.filters.raw.flat().get()||[],d=q.mapMaybe(b,m.prop("relation",0));return a.filter(function(a){if(-1==d.indexOf(a.uri))return f.forCollections(c)(a)})};a.prototype.byUri=function(a){return this.taglist.findByUriOrCreate(a,
!0)};a.prototype.render=function(){z.onThreadEnd(function(){this.list.find(".plus").detach();this.list.empty();this.pinnedList.find("*").filter(function(){return $(this).hasClass("filter")}).remove();this.renderDocumentFilter();this.renderTagFilters();this.updateAndRenderSuggestions();this.plus.appendTo(this.list)}.bind(this),arguments,"render",this)};a.prototype.updateAndRenderSuggestions=function(){var a=this.computeSuggestions(this.taglist.tags.list,this.collections.get()),c=this.roles.allTagRoles(),
a=q.mapProp(a||[],"uri"),a=q.mapMaybe(a,this.createSuggestionUI1),a=this.rankAndPruneSuggestions(a).sort(k.comparing(function(a){return!q.contains(c,a.filter.get().relation,q.equals)},function(a){return a.constructor!=d},function(a){return a.constructor!=n},function(a){return a.constructor!=b},function(a){return a.constructor!=r}));this.filters.raw.removeItemsBy(function(a){a=a.get();return!e.isPageTitle(a.relation)&&g.isUnpinnedSuggestion(a)});var f=q.mapProp(a,"filter");this.filters.raw.insert(0,
f);this.list.append(a.map(this.renderItem))};a.prototype.renderDocumentFilter=function(){var a=this.filters.raw.list.filter(function(a){return e.isPageTitle(a.get().relation)})[0];if(!a){var c=g.mkRef("equals",e.PageTitle,!1);this.filters.raw.push(c)}a=a||c;a.get().pin?(a=new h(a,this.taglist,this.roles.byRole.collection,this.documentTags,this.renderTitle(a.get())),this.pinnedList.append(this.renderItem(a))):(a=new r(a,this.taglist,this.roles.byRole.collection,this.documentTags),this.list.prepend(this.renderItem(a)));
this.pool.push(a)};a.prototype.renderTagFilters=function(){this.filters.raw.list.forEach(this.renderFilter.bind(this))};a.prototype.renderFilter=function(a){var c=a.get(),f={"range/false":n,"matches/false":r,"matches/true":h,"equals/false":r,"equals/true":h,"enum/false":d,"nonempty/false":b}[c.type+"/"+!!c.pin];f?e.isPageTitle(c.relation)||(a=new f(a,this.taglist,this.collections,this.documentTags,this.renderTitle(c).get()),this.pool.push(a),c.pin?this.pinnedList.append(this.renderItem(a)):this.list.prepend(this.renderItem(a))):
console.error("Filters.renderFilter","filter type not implemented:",c.type)};a.prototype.createSuggestionUI1=function(a,c){return this.createSuggestionUI([a],c)};a.prototype.createSuggestionUI=function(a,c){if(void 0===a)return this.make(r,e.PageTitle);var f=this.make(d,a)||this.make(n,a)||this.make(r,a)||this.make(b,a,c);this.pool.push(f);return f};a.prototype.rankAndPruneSuggestions=function(a){function c(a){return q.sort(a,k.comparing(function(a){var c=a.tag.get();a=m.values(c.enums);c=c.count;
return q.sum(a)/c}))}a=q.sortAndGroupByComparing(a,function(a){return a.constructor}).map(function(a){if(a[0].constructor==d)return c(a).reverse().slice(0,2);if(a[0].constructor==n)return a.slice(0,1);if(a[0].constructor==r)return[];if(a[0].constructor==b)return a.slice(0,1)});return q.concat(a)};a.prototype.renderTitle=function(a){if(e.isPageTitle(a.relation)){var b=this;return this.collections.map(function(a){return a?x.prettyEnum(a.map(function(a){return b.byUri(a).name}),"or")||"Page":"Page"})}return c.value(q.mapProp(q.reverse(a.relation.map(this.byUri)),
"name").join(" ▸ "))};a.prototype.renderItem=function(a){var c=a.filter.get(),b=$("<div class=filter/>"),d=this.renderTitle(c),e=$("<span class=relation/>").addClass(c.relation?"relation":"document"),d=$("<div class=header/>").html(e.rText(d)),e=$("<span class=remove/>");w.renderIcon(t.defaultCross,10,10,0.3).appendTo(e);e.click(this.removeItem.bind(this,a));var f=this.setupSettings(a,b);d.append(e,f);b.addClass(a.constructor.filterTypeName).append(d);b.rToggleClass("selected",a.filter.mapValue(g.isActive));
c=c.pin?a.render(this.shouldCondense):a.render();b.append(c);a.filter.wait(function(a){return void 0===a},function(){b.remove()});return b};a.prototype.addFilterGen=function(a,c){var b,d=[];b=a.item.isDocument?e.PageTitle:q.mapProp(a.item.relation,"uri");this.filters.raw.removeItemsBy(function(a){var c=a.get();if(!g.isActive(c)&&e.eqTags(c.relation,b))return d.push(a),!0});d.forEach(function(a){a.set(void 0)});if(c){var f=this.make(h,b);this.pool.push(f);f.filter.modify(function(a){a.pin=!0;return a})}else f=
this.createSuggestionUI(b,!0);var n=this.renderItem(f);this.filters.raw.push(f.filter);return n};a.prototype.addFilter=function(a){a=this.addFilterGen(a,!1);a.insertBefore(this.plus);a.hide();a.fadeIn()};a.prototype.addPinnedFilter=function(a){a=this.addFilterGen(a,!0);this.pinnedList.append(a)};a.prototype.doesntHaveRelation=function(a){a=l(a);var c=this.filters.activeResolved.get().filter(g.isActive).map(function(a){return a.isDocument?e.PageTitle:a.relation});return-1===q.indexOf(c,a,q.equals)};
a.prototype.removeItem=function(a){var c=a.filter.get();y.trackWithMode("explore-filter-removed",{Filter:e.isPageTitle(c.relation)?"Page name":c.relation,"Active Filter":g.isActive(c)});this.filters.raw.removeItem(a.filter);a.filter.set(void 0)};a.prototype.setupSettings=function(a,c){function e(c,b,d){b=$("<div class=option />").text(b);a.constructor!=c&&(d||c.eligible(g,f.relation))&&b.click(h.bind(this,c,a)).addClass("enabled");a.constructor==c&&b.addClass("active");return b}var f=a.filter.get();
if(!f.relation)return $();c=$("<span class=settings/>");w.renderIcon(t.settings(5),10,10,0.3).appendTo(c);var h=this.changeFilterType,g=this.taglist,q=$("<div class=filter-settings/>").append($("<div class=desc><strong>Filter type<strong></h4>"),e(b,"Not empty",!0),e(r,"Text"),e(n,"Range"),e(d,"Common values")),l=q.find(".option").length;if(!l)return $();A.click(c,q,180,70+25*l,c,{position:"top"},null);return c};a.prototype.make=function(a,c,b){var d={Range:"range",Textual:"matches",Enum:"enum",NonEmpty:"nonempty",
InlineTextual:"equals"}[a.filterTypeName];if(b||a.eligible(this.taglist,c))return c=g.mkRef(d,c,!1),b=this.renderTitle(c.get()).get(),new a(c,this.taglist,this.collections,this.documentTags,b)};a.prototype.changeFilterType=function(a,c){var b=this.make(a,c.filter.get().relation);b.filter.modify(function(a){c.filter.get().pin?a.pin=!0:delete a.pin;return a});this.filters.raw.removeItem(c.filter);this.filters.raw.push(b.filter);c.node.parents(".filter").replaceWith(this.renderItem(b));this.pool.push(b)};
return a}();l.Filters=B})(l.filter||(l.filter={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Functions,l=a.reactive.Value,p=function(){function a(c,b,d){var e;this.load=this.load.bind(this);this.fetchMemberList=this.fetchMemberList.bind(this);this.fetchedMemberList=this.fetchedMemberList.bind(this);this.fetchInviteList=this.fetchInviteList.bind(this);this.fetchedInvites=this.fetchedInvites.bind(this);if(e=function(a,c,b){this.api=a;this.user=c;this.repository=b;this.members=(new l).name("Permission.members");this.admins=(new l).name("Permission.admins");
this.editors=(new l).name("Permission.editors");this.viewers=(new l).name("Permission.viewers");this.invites=(new l).name("Permission.invites")}.apply(e||this,arguments))return e}a.init=function(){e.publicLabel="public";e.privateLabel="private";e.publiclyEditableLabel="publiclyEditable"};a.privacyLabel=function(a){var c=0<a.items.filter(d).length;return 0<a.items.filter(b).length?e.publiclyEditableLabel:c?e.publicLabel:e.privateLabel};a.isPublic=function(a){return a.canRead&&a.account&&a.account.anonymous};
a.isPubliclyEditable=function(a){return a.canWrite&&a.account&&a.account.authenticated};a.isEditor=function(a){return a.canWrite&&(!a.account||!a.account.authenticated&&!a.account.anonymous&&!r(a))};a.isAdmin=function(a){return a.isAdmin};a.isViewer=function(a){return!a.canWrite&&(!a.account||a.canRead&&!a.account.authenticated&&!a.account.anonymous)};a.realUser=function(a){return!a.account.authenticated&&!a.account.anonymous};a.userName=function(a){return a.name};a.role=function(a){return a.isAdmin?
"Admin":a.canWrite?"Editor":"Viewer"};var e=a,d=a.isPublic,b=a.isPubliclyEditable,n=a.isEditor,r=a.isAdmin,h=a.isViewer,f=a.realUser,c=a.userName,q=a.role;a.Permission=a;a.prototype.load=function(){return $.when(this.fetchMemberList(),this.fetchInviteList())};a.prototype.ensureLoaded=function(){return void 0===this.members.get()?this.load():$.Deferred().resolve()};a.prototype.fetchMemberList=function(){return this.api.Permission.list(this.fetchedMemberList,this.fetchedMemberList)};a.prototype.fetchedMemberList=
function(a){a=a&&a.items?a.items.filter(f).sort(k.comparing(q,c)):[];var b=a.filter(r),d=a.filter(n),e=a.filter(h);this.admins.set(b);this.editors.set(d);this.viewers.set(e);this.members.set(a)};a.prototype.findMemberByEmail=function(a){return this.members.get().filter(function(c){return c.account.user.email==a})[0]||null};a.prototype.fetchInviteList=function(){this.api.Invite.list(this.fetchedInvites,this.fetchedInvites)};a.prototype.fetchedInvites=function(a){this.invites.set(a?a.items:[])};a.prototype.findInviteByEmail=
function(a){return this.invites.get().filter(function(c){return c.email==a})[0]||null};a.prototype.addUser=function(a,c,b,d){var e=this;this.api.Permission.saveByEmail(a,{canRead:!0,canWrite:"Viewer"!=c,isAdmin:"Admin"==c},function(){e.fetchMemberList();b()},d)};a.prototype.sendInvite=function(a,c,b,d,e){var f=this;c={canRead:!0,canWrite:"Viewer"!=c,isAdmin:"Admin"==c,email:a};b&&(c.document=b);this.api.Invite.saveByEmail(a,c,function(){f.fetchInviteList();d()},e)};a.prototype.changePrivacy=function(a,
c){function b(){d.repository.load();c()}var d=this;a==e.privateLabel?(this.api.Permission.byId("authenticated").remove(),this.api.Permission.byId("anonymous").remove(b)):a==e.publiclyEditableLabel?(this.api.Permission.saveById("anonymous",{canRead:!0,canWrite:!1,isAdmin:!1}),this.api.Permission.saveById("authenticated",{canRead:!0,canWrite:!0,isAdmin:!1},b)):a==e.publicLabel?(this.api.Permission.byId("authenticated").remove(),this.api.Permission.saveById("anonymous",{canRead:!0,canWrite:!1,isAdmin:!1},
b)):console.log("Permission.changePrivacy: Unknown privacy: ",a)};return a}();m.Permission=p;p.init()})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.typlib.Functions,g=a.typlib.Tracking,e=function(){function a(b,d,e){var h;this.resetForm=this.resetForm.bind(this);this.addUser=this.addUser.bind(this);this.sendInvite=this.sendInvite.bind(this);this.selectChange=this.selectChange.bind(this);this.checkboxChange=this.checkboxChange.bind(this);if(h=function(a,c,b){this.domain=a;this.api=c;this.form=b;this.setupValidation();$(".noconfirm",this.form).rToggleDisplay(this.domain.user.globalAdmin);
this.domain.repository.isPrivate.onchange(function(a){var c=$(".invite-role option",this.form).filter(function(a,c){return"Viewer"==$(c).text()}).remove();a&&$(".invite-role",this.form).prepend(c)});$(".invite-role",this.form).change(k.exec(this.selectChange));$("#invite-editor-checkbox",this.form).change(this.checkboxChange);this.setRole("Editor")}.apply(h||this,arguments))return h}a.Invite=a;a.prototype.getFormData=function(){return{email:this.form.find(".invite-email").val(),role:this.form.find(".invite-role").val(),
skipMessage:!!this.form.find(".noconfirm:checked")[0]}};a.prototype.resetForm=function(){this.form.removeAttr("active");this.form.find(".invite-email").val("");this.form.find(".invite-role").val("Editor");this.form.find(".invite-email").blur();this.clearFormError()};a.prototype.setFormError=function(a){return this.form.find(".msg")};a.prototype.clearFormError=function(){this.form.find(".msg").hide().text("")};a.prototype.addUser=function(){var a=this,d=this.getFormData();this.domain.permission().done(function(e){e.addUser(d.email,
d.role,this.resetForm,function(){a.setFormError(d.email+" is not a registered email address.")})}.bind(this))};a.prototype.sendInvite=function(){var a=this,d=this.getFormData(),e=window.Silk.canvas.document.get();this.resetForm();this.domain.permission().done(function(h){h.sendInvite(d.email,d.role,"content"==e.type&&e.uri.get(),function(){a.resetForm();g.trackWithMode("invite-sent",{component:"members"});$(a).trigger("sentInvite")},function(){a.setFormError("Sending invite failed.\nPlease try again later.")})})};
a.prototype.selectChange=function(){this.setRole($(".invite-role",this.form).val())};a.prototype.checkboxChange=function(){this.setRole($("#invite-editor-checkbox",this.form)[0].checked?"Editor":"Viewer")};a.prototype.setRole=function(a){$(".invite-role",this.form).val(a);$("#invite-editor-checkbox",this.form)[0].checked="Editor"===a;"Viewer"==a?$("#invite-as",this.form).text("as a:"):$("#invite-as",this.orm).text("as an:")};a.prototype.setupValidation=function(){var a=this.form;this.domain.permission().done(function(d){$.validator.addMethod("Members_alreadyUser",
function(a){return!d.findMemberByEmail(a)});$.validator.addMethod("Members_alreadyInvited",function(a){return!d.findInviteByEmail(a)});$(a).validate({rules:{"invite-email":{required:!0,email:!0,Members_alreadyUser:!0,Members_alreadyInvited:!0}},messages:{"invite-email":{required:"This field is required",email:"A valid e-mail is required",Members_alreadyUser:"This person is already a member",Members_alreadyInvited:"This person is already invited"}},submitHandler:function(){$(".noconfirm:checked",a)[0]?
this.addUser():this.sendInvite()}.bind(this)})}.bind(this))};return a}();l.Invite=e})(k.share||(k.share={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.ui.share.Invite,p=a.component.Image,g=a.reactive.Value,e=a.typlib.Images,d=a.typlib.Svg,b=a.typlib.Tracking,n=a.ui.Bubble,r=function(){function a(){}a.install=function(a,c,h,l,m,z,B){function D(a,c,b,d,e){e=e?(c-M)/2+(B||0):(c-M)/2;var f=K.bubble.content;f.find(".pick"+a).addClass("disabled").css("margin-bottom","0px");f.find(".pick:not("+a+")").css("height","0px").css("margin-bottom","0px");f.css("width",c+"px");f.css("height",b+"px");f.css("margin-left",
-e+"px");d&&f.find(".privacy-warning").slideUp({duration:200})}function F(){D(".invite",290,180,!0,!1);K.bubble.content.append(k())}function C(){$.ajax({type:"POST",url:"https://www.googleapis.com/urlshortener/v1/url",data:JSON.stringify({longUrl:J.get()}),contentType:"application/json",dataType:"json",success:function(a){D(".link",203,150,!0,!1);K.bubble.content.append(t(a.id))}})}function E(){D(".embed",430,I?304:249,void 0,!0);K.bubble.content.append(q(P.get()))}function G(){var a=f(m,l.get()),
c=": "+J.get()+" via @SilkDotCo",a=(101<a.length?a.slice(0,100)+"…":a)+c,a="http://twitter.com/intent/tweet?text="+encodeURIComponent(a);window.open(a,"_blank","width=600, height=300");b.trackWithMode("share",{Channel:"Twitter"},!0)}function L(){function a(c){return c instanceof p&&c.src.get()}var c=m.name.get(),d=f(null,l.get()),e=l.get().registry&&l.get().registry.components.list.filter(a)[0],e=e?e.src.get():window.Silk.paths.imagePath+"/logo/large.png";0===e.indexOf("//")?e="http:"+e:0!==e.indexOf("http")&&
(e=window.Silk.paths.loginProtocol+"://"+location.hostname+"/"+e);c="https://www.facebook.com/dialog/feed?app_id=483941765068421&display=popup&caption="+encodeURIComponent(c)+"&description="+encodeURIComponent(d)+"&picture="+encodeURIComponent(e)+"&link="+encodeURIComponent(J.get())+"&redirect_uri="+encodeURIComponent("https://www.silk.co/close");window.open(c,"_blank","width=640, height=400");b.trackWithMode("share",{Channel:"Facebook"},!0)}function N(){var a=m.name.get(),c=f(null,l.get()),a="http://www.linkedin.com/shareArticle?mini=true&url="+
encodeURIComponent(J.get())+"&title="+encodeURIComponent(a)+"&summary="+encodeURIComponent(c)+"&source=Silk";window.open(a,"_blank","width=520, height=570");b.trackWithMode("share",{Channel:"LinkedIn"},!0)}function H(){var a=l.get(),c=a.title.get(),a="Have a look at this page on"+(m&&m.name.get()&&m.name.get()!=a.title.get()?" the "+m.name.get():"")+" Silk%0A"+J.get();location.href="mailto:?subject="+c+"&body="+a;b.trackWithMode("share",{Channel:"Email"},!0)}var I=m.isPrivate.get(),M=I?230:170,S=
(I?300:212)-50*(4-c.length),P=h.map(function(a){return a&&"//"+location.hostname+"/s/embed"+a}),J=g.lift(function(a,c){var b="http://"+location.hostname,d;d=void 0!==a?"/explore"+a:"home"===c?"":"/page/"+encodeURIComponent(c);return b+d})(h,l.bindProp("uri")),K=n.click(a,function(){var a=$("<div/>").addClass("share-embed"),b=$("<div class='invite   pick' />").addClass("invite").click(F),f=$("<div class='twitter  pick' />").addClass("twitter").click(G),h=$("<div class='facebook pick' />").addClass("facebook").click(L),
g=$("<div class='linkedin pick' />").addClass("linkedin").click(N),n=$("<div class='email    pick' />").addClass("email").click(H),q=$("<div class='embed    pick' />").addClass("embed").click(E),l=$("<div class='link     pick' />").addClass("link").click(C);d.renderIcon(e.invite,40,40,1).appendTo(b);d.renderIcon(e.twitter,40,40,1).appendTo(f);d.renderIcon(e.facebook,40,40,1).appendTo(h);d.renderIcon(e.linkedin,40,40,1).appendTo(g);d.renderIcon(e.email,40,40,1).appendTo(n);d.renderIcon(e.embed,40,
40,1).appendTo(q);d.renderIcon(e.link,40,40,1).appendTo(l);b.append($("<span/>").text("invite"));f.append($("<span/>").text("twitter"));h.append($("<span/>").text("facebook"));g.append($("<span/>").text("linkedin"));n.append($("<span/>").text("email"));q.append($("<span/>").text("embed"));l.append($("<span/>").text("short link"));$("<div/>").append(-1==c.indexOf("invite")?void 0:b,-1==c.indexOf("embed")?void 0:q,-1==c.indexOf("twitter")?void 0:f,-1==c.indexOf("facebook")?void 0:h,-1==c.indexOf("linkedin")?
void 0:g,-1==c.indexOf("email")?void 0:n,-1==c.indexOf("link")?void 0:l).appendTo(a);I&&a.prepend(r(z));return a},M,S,a,{position:"bottom"},void 0)};a.makeShareText=function(a,c){var b=c.uri?"home"===c.uri.get():!1,d=!a||!a.name.get()||b;return(d?"":a.name.get()+" — ")+("content"===c.type?b&&!d?a.name.get():c.title.get():c.title.get().replace(/\.\s*$/,""))};a.makeCopyButton=function(a,c){var d=$("<a class='copy-button'>Copy to clipboard</a>");d.attr("data-clipboard-text",a);try{var e=new ZeroClipboard(d[0],
{moviePath:"/s/ZeroClipboard.swf"});e.on("load",function(){e.on("complete",function(){d.addClass("complete");d.text("Copied!");b.trackWithMode("share-copied",{Channel:c},!0)})});return d}catch(f){console.warn("Insufficient flash version detected.")}};a.embedDialog=function(a){var d=(new Uri(location.href)).host(),e=$("<textarea/>").addClass("code"),f=c("","Embed");b.trackWithMode("share",{Channel:"Embed"},!0);var h=$("<div/>").addClass("embed-box").append(e,"<div class='size-selector'>Embed size <select class='size'><option value='small'>Small (300x400)</option><option value='medium' selected='selected'>Medium (600x600)</option><option value='big'>Big (800x800)</option><option value='responsive'>Responsive</option></select></div>",
f),g=function(c){var b,h;"small"==c&&(b=300,h=400);"medium"==c&&(h=b=600);"big"==c&&(h=b=800);c="responsive"==c?"<div style='display: inline-block; width: 100%;'><div style='position: relative; padding-bottom: 100%; padding-top:25px; height: 0;'><iframe src='"+a+"' style='border:0;position: absolute; top:0; left:0; width: 100%;height:100%;'></iframe></div><div style='margin-top:10px;font-size:12px;color:gray;'>Data from <a href='"+d+"'>"+d+"</a></div></div>":'<iframe src="'+a+'" width="'+b+'" height="'+
h+'" style="height:'+h+"px;width:"+b+"px;border:0;\"></iframe><div style='margin-top:10px;font-size:12px;color:gray;'>Data from <a href='http://"+d+"'>"+d+"</a></div>";f.attr("data-clipboard-text",c);f.removeClass("complete");f.text("Copy to clipboard");e.html(c)};g("medium");var n=h.find("select");h.find("select.size").change(function(){g(n.find("option:selected").val())});return h};a.privacyWarning=function(a){var c=$("<div class='privacy-warning'>Warning! This site is <a class='private'>private</a>, only the <a class='members'>members</a> of this site will be able to view what you share.</div>");
a.anyAdmin.get()&&(c.find(".private").attr("href","/dashboard/settings"),c.find(".members").attr("href","/dashboard/members"));return c};a.inviteDialog=function(){var a=$(Resource.Invite),c=new l(window.Silk.domain,window.Silk.api,a);$(c).on("sentInvite",function(){$(a).addClass("invite-sent").html("Invite sent!")});a.find(".invite-email").focus();a.find(".invite-email-label").text("Email");a.find("#invite-editor-checkbox")[0].checked=!0;window.Silk.domain.repository.isPublic.get()&&(a.find("#invite-editor-checkbox")[0].disabled=
!0);return a};a.linkDialog=function(a){var b=c(a,"Short Link"),d=$("<div/>").addClass("link-box");a=$("<textarea/>").addClass("code").html(a);return d.append(a,b)};var f=a.makeShareText,c=a.makeCopyButton,q=a.embedDialog,r=a.privacyWarning,k=a.inviteDialog,t=a.linkDialog;return a}();k.Sharing=r})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.ui.Sharing,p=a.reactive.Value,g=a.typlib.Objects,e=function(){function a(b,d,e){var h;if(h=function(a,c,b){this.domain=c;this.document=p.value(b);this.queryViewer=a;this.actions=this.node=null;this.setupNode()}.apply(h||this,arguments))return h}a.Controls=a;a.prototype.cleanup=function(){};a.prototype.setupNode=function(){this.node=$("<div class=controls />").append(this.shareButton(),this.exploreButton(),this.editButton())};a.prototype.exploreButton=
function(){var a=$("<a />").text("Explore").addClass("action").addClass("explore"),d=this.queryViewer.bind(g.prop("data","fullUri")).map(function(a){return"/explore"+a});a.rAttr("href",d);return a};a.prototype.shareButton=function(){var a=$("<a />").text("Share & Embed").addClass("action").addClass("share");l.install(a,"embed twitter facebook linkedin email link".split(" "),this.queryViewer.bind(g.prop("data","fullUri")),this.document,this.domain.repository,this.domain.user);return a};a.prototype.editButton=
function(){return $("<a />").text("Edit").addClass("action").addClass("edit").click(function(){var a=this.document.get(),d=this.queryViewer.get();a.widgetEditing.editWidget(d)}.bind(this))};return a}();k.Controls=e})(m.queryviewer||(m.queryviewer={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,p=a.typlib.CleanupPool,g=function(){function a(d,b,e,g,h){var f;this.viewChange=this.viewChange.bind(this);this.updateMessage=this.updateMessage.bind(this);this.clear=this.clear.bind(this);if(f=function(a,b,d,e,f){this.pool=new p;this.node=a;this.pipeline=d;this.view=e;this.busy=f;this.document=b;this.isNoResult=(new l(!1)).name("Message.isNoResult");this.isErrorResult=(new l(!1)).name("Message.isErrorResult");this.setupStatus();this.setupClasses();
this.pool.push(l.onchange(this.updateMessage)(this.pipeline.output.body,this.pipeline.filters.missingTags),this.view.onchange(this.viewChange));void 0===this.pipeline.output.body.get()&&this.updateMessage()}.apply(f||this,arguments))return f}a.Message=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.setupStatus=function(){$("<div class=busy-indication />").appendTo(this.node)};a.prototype.setupClasses=function(){"query"==this.document.type&&($("html").rToggleClass("query-no-result",
this.isNoResult),$("html").rToggleClass("query-error-result",this.isErrorResult));this.node.rToggleClass("no-result",this.isNoResult);this.node.rToggleClass("error-result",this.isErrorResult);this.node.rToggleClass("busy",this.busy);this.node.rToggleClass("busy-visible",this.busy.sample(250))};a.prototype.viewChange=function(){this.updateMessage(this.pipeline.output.body.get(),this.pipeline.filters.missingTags.get())};a.prototype.updateMessage=function(a,b){this.clear();if(b&&b.length)return this.errorResult(this.missingTagsMessage(b));
if(!a)return this.errorResult(this.errorResultMessage());if(0==a.length)return this.noResult(this.noResultsMessage())};a.prototype.clear=function(){this.node.children(".message").remove();this.isNoResult.set(!1);this.isErrorResult.set(!1)};a.prototype.noResult=function(a){this.clear();this.isNoResult.set(!0);this.node.append(a)};a.prototype.errorResult=function(a){this.clear();this.isErrorResult.set(!0);this.node.append(a)};a.prototype.noResultsMessage=function(){return $("<div />").addClass("message no-results").append("<div><strong>No results available</strong><br>Change the selected tags or remove filters to see results here.</div>")};
a.prototype.errorResultMessage=function(){var a=$("<a class=retry>(retry)</a>");a.click(function(){this.pipeline.query.performQuery()}.bind(this));a=$("<div><strong>An error happened while performing the query</strong><br>Please try again later.</div>").append(a);return $("<div />").addClass("message").append(a)};a.prototype.missingTagsMessage=function(a){return $("<div />").addClass("message missing-facts").append("<div><strong>These facts are missing from the page:</strong></div>").append($("<ul/>").append(a.map(function(a){return $("<li/>").text(a.name)[0]})))};
return a}();k.Message=g})(m.queryviewer||(m.queryviewer={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.client.query.Data,g=a.client.query.Filters,e=a.client.query.pipeline.Pipeline,d=a.client.tagging.Suggestions,b=a.client.ui.queryviewer.filter.Filters,n=a.component.queryviewer.Controls,r=a.component.queryviewer.Message,h=a.component.queryviewer.Registry,f=a.reactive.Functions,c=a.reactive.Node,q=a.reactive.Value,s=a.typlib.Arrays,u=a.typlib.CleanupPool,t=a.typlib.ThreadEnd,v=function(){function a(c,b,d){var e;
this.setupInFigureBlock=this.setupInFigureBlock.bind(this);this.switchView=this.switchView.bind(this);if(e=function(a,c,b){this.pool=new u;this.filterUI=this.node=this.data=null;this.document=c;this.pipeline=null;this.canvas=b;this.tagList=this.canvas.domain.tagList;this.view=(new q).name("QueryViewer.view");this.viewComponent=(new q).name("QueryViewer.viewComponent");this.setupNode(a);this.setupPipeline();this.setupInitialData();this.setupDataSyncing();this.setupStatusAndMessage();this.setupInFigureBlock();
this.setupViewComponent();this.setupControls();this.setupFilterUI();this.setupClasses()}.apply(e||this,arguments))return e}a.create=function(c,b){var d=l.create(a,c);b&&b.data&&d.data.fromJson(b.data);return d};a.uri=k.QueryViewer;a.QueryViewer=a;a.prototype.cleanup=function(){this.switchView(null);this.pool.cleanup()};a.prototype.setupNode=function(a){l.linkToNode(this,a)};a.prototype.setupPipeline=function(){var a="embed"==window.Silk.silkType?$($("script[api-uri='query']").remove().text())[0]:
this.node.find(".component-output table")[0];this.node.empty();this.pool.push(this.pipeline=e.full(a))};a.prototype.setupInitialData=function(){this.data=new p;this.pool.push(this.data);var a=this.node.attr("data-component-json");if(!a){var b=this.node.attr("data-queryview-uri");b&&(a=b.split("/").map(decodeURIComponent).filter(function(a){return 0<a.length}),a=JSON.stringify(p.uriToJson(a)),c.node(this.node[0]).attributes.get("data-component-json").set(a))}this.data.serialized.set(a)};a.prototype.setupDataSyncing=
function(){var a=this.data.json,b=this.pipeline.roles,d=this.pipeline.sliced.slice,e=this.pipeline.filters;q.lens(this.view,a.get("view"));q.lens(d,a.get("slice"));q.lens(b.proxy,a.get("roles"));this.data.resolvedFilters.is(e.activeOrPinnedResolved);e.activeOrPinnedUnresolved.onchange(function(c){a.get("filters").set(c)});a.get("filters").onchange(function(a){var c={};e.raw.removeItemsBy(function(b){if(g.isUnpinnedSuggestion(b.get()))return!1;b=s.indexOf(a,b.get(),g.eqFilter);if(-1==b)return!0;c[b]=
!0;return!1});var b=a.filter(function(a,b){return!c[b]}).map(g.mkVar);e.raw.insert(0,b)});this.pipeline.query.log=this.data.serialized;q.lens(this.data.serialized,c.node(this.node[0]).attributes.get("data-component-json"))};a.prototype.setupViewComponent=function(){this.viewComponent.is(this.view.map(this.switchView));this.pool.push(this.view,this.viewComponent)};a.prototype.getComponentInfo=function(){var a=this.viewComponent.get().constructor;return{name:a.shortId,text:a.label}};a.prototype.setupStatusAndMessage=
function(){this.busy=f.or(this.viewComponent.bindProp("busy"),this.pipeline.query.busy).name("QueryViewer.busy");this.message=new r(this.node,this.document,this.pipeline,this.view,this.busy);this.pool.push(this.message)};a.prototype.setupInFigureBlock=function(){t.onThreadEnd(function(){var a=this.node.parents("[data-component-uri='//silk.co/block/figure/1']").get(0);if(a=a&&a.component&&a.component.get()){var c=this.pipeline.filters.missingTags.map(function(a){return a&&a.length});a.visible.is(f.not(c));
this.pool.push(c)}}.bind(this),arguments)};a.prototype.setupControls=function(){"product"==window.Silk.silkType?(this.controls=new n(new q(this),this.canvas.domain,this.document),this.node.prepend(this.controls.node)):this.node.prepend($("<div class='controls stub' />"))};a.prototype.computeInterestingFilter=function(a){return a.filter(function(a){return a.isEnum()}).reduce(function(a,c){return c.enumness()>a.enumness()?c:a},a[0])};a.prototype.setDefaultQueryView=function(a,c,b){var d=h.byShortId();
a.view=d.table.uri;var e=6;b&&0<b.count&&(e-=1,a.roles.image.push({relation:[b.uri]}),a.view=d.pagegrid.uri);c.filter(function(a){return 0<a.count}).filter(function(a){return 140>a.textLength}).slice(0,e).forEach(function(c){a.roles.column.push({relation:[c.uri]})});return a};a.prototype.defaultQuery=function(a){var c=a||d.uris(d.allDocTagsByCount(this.tagList))[0];a=d.allTagsByCount(this.tagList).filter(function(a){return a.context._context[c]});var b=d.mostCommonOfType("image",a);b&&(a=a.filter(function(a){return a!==
b}));var e=p.emptyJson();e.roles.collection=[c];var f=this.computeInterestingFilter(a);f&&e.filters.push({pin:!0,type:"equals",relation:[f.uri]});this.data.fromJson(this.setDefaultQueryView(e,a,b))};a.prototype.switchView=function(a){var c=this.viewComponent&&this.viewComponent.get();c&&c.cleanup();this.node.children(".output").remove();if(a){var b=h.find(a);if(!b)throw Error("Unknown query view '"+a+"'.");c&&b.migratePipeline(this.tagList,this.pipeline);a=new b(this.document,this.pipeline,this.tagList,
void 0===c,this.message,this.data);a.node.addClass("output").appendTo(this.node);return a}};a.prototype.fixLayout=function(a){var c=this.viewComponent.get();c&&c.fixLayout&&c.fixLayout(a)};a.prototype.setupFilterUI=function(){this.filterUI=new b(this.pipeline,this.tagList,this.canvas.domain.userStorage,this.canvas.currentContentDocument.mapProp("documentTags"));this.pool.push(this.filterUI);this.filterUI.pinnedNode.insertAfter(this.node.children(".controls"))};a.prototype.setupClasses=function(){this.node.attr("data-component-uri",
a.uri);this.node.rAddClass("component");this.node.rAddClass("component-queryview");this.node.rAddClass(this.viewComponent.map(function(a){return a?"component-queryview-"+h.shortId(a.constructor):""}))};a.prototype.affectsDirtyState=function(a){return this.canvas.editFlags.editing.get()&&a.target==this.node[0]?a.attribute?0<=["data-component-json"].indexOf(a.attribute):!0:!1};a.prototype.serializeToXML=function(){var c=$("<div/>").attr("data-component-uri",a.uri);if(this.data){c.attr("data-component-json",
this.data.serialized.get());var b=this.pipeline.print.queryString.get();c.attr("data-query-string",b.replace("\n"," "))}else c.attr("data-original-queryview-data",this.node.attr("data-original-queryview-data"));return c[0]};a.prototype.getMentionedTags=function(){return this.pipeline.getMentionedTags()};a.prototype.busy=void 0;a.prototype.controls=void 0;a.prototype.message=void 0;return a}();m.QueryViewer=v})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.typlib.Arrays,g=a.client.query.render.Item,e=function(){function a(){}a.render=function(a,d){return $("<ul/>").append(a.map(function(a,b){a[0]&&a[0][0]&&(d.targetDocument=a[0][0].href);return $("<li/>").append(k.concat(a.map(function(a,c){return a.map(function(a){d.rowIndex=b;d.colIndex=c;return g.render(a,d)[0]})})))[0]}))};return a}();l.List=e;l=e.render})(k.render||(k.render={}))})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||
(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.client.query.pipeline.Pipeline,g=a.client.query.render.Item,e=a.client.query.render.List,d=a.typlib.ThreadEnd,b=function(){function a(b){var d;this.render=this.render.bind(this);if(d=function(a){l.linkToNode(this,a);this.queryString="from all documents select document name order descending by modification date slice from 0 to 9";this.setupUI();this.setupPipeline()}.apply(d||this,arguments))return d}a.uri=
k.RecentDocuments;a.info={name:"recent-pages",text:"Recent Pages"};a.RecentDocuments=a;a.prototype.cleanup=function(){this.pipeline.cleanup()};a.prototype.setupPipeline=function(){var a=this.node.find(".component-output table")[0];this.node.empty();this.pipeline=p.raw(this.queryString,a);this.pipeline.output.body.onchange(this.render)};a.prototype.setupUI=function(){this.container=$("<div class=container />").appendTo(this.node)};a.prototype.render=function(a){d.onThreadEnd(function(a){a&&a.length?
this.container.empty().append($("<div class=title>Recently modified documents</div>"),e.render(a,g.defaultOptions)):this.container.html("<em>You have not added any pages yet. Once you do, they will show up here.</em>")}.bind(this),arguments,"RecentDocuments.render",this)};a.prototype.serializeToXML=function(b){return $("<div/>").attr("data-component-uri",a.uri)[0]};a.prototype.affectsDirtyState=function(a){return a.target===$(this.node)[0]};a.prototype.container=void 0;a.prototype.node=void 0;a.prototype.pipeline=
void 0;return a}();m.RecentDocuments=b})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Functions,l=a.client.component.ComponentURIs,p=a.client.model.Component,g=a.reactive.Value,e=a.typlib.Strings,d=k.and,b=k.not,k=function(){function a(b,d,e){var c;this.calculateCount=this.calculateCount.bind(this);if(c=function(a,c,b){p.linkToNode(this,a,"site-info");this.canvas=b;this.domain=b.domain;$(Resource.SiteInfo).appendTo(a);this.initiallySubscribed=this.domain.subscription.subscribedInstant.get();this.subscriptionCount=g.lift(this.calculateCount)(this.domain.repository.subscriptions,
this.domain.subscription.subscribedInstant).name("SiteInfo.subscriptionCount");this.memberCount=this.domain.repository.members.map(function(a){return void 0===a?"-":a}).name("SiteInfo.memberCount");this.renderCounts()}.apply(c||this,arguments))return c}a.uri=l.SiteInfo;a.SiteInfo=a;a.prototype.calculateCount=function(a,b){return void 0===a?null:a-(this.initiallySubscribed?1:0)+(b?1:0)};a.prototype.cleanup=function(){this.subscriptionCount.unlink();this.memberCount.unlink()};a.prototype.renderCounts=
function(){function a(c){return null===c?"":""+c}var h=$(".follower-count",this.node);h.rToggleDisplay(d(this.domain.user.canWrite,b(this.domain.repository.isPrivate)));$(".top-line",h).rText(this.subscriptionCount.map(a));$(".type",h).rText(this.subscriptionCount.map(e.pluralizer("Follower")));h=$(".member-count",this.node);h.rToggleDisplay(this.domain.user.isAdmin);$(".top-line",h).rText(this.memberCount.map(a));$(".type",h).rText(this.memberCount.map(e.pluralizer("Member")));var h=window.Silk.domain.repository.documents,
f=$(".page-count",this.node);$(".top-line",f).rText(h.map(a));$(".type",f).rText(h.map(e.pluralizer("Page")))};a.prototype.serializeToXML=function(){return $(this.node[0].cloneNode(!1)).attr("class","site-info")};a.prototype.node=void 0;return a}();m.SiteInfo=k})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.reactive.Node,g=a.silk.nav.NavLinks,e=a.typlib.CleanupPool,d=function(){function a(b){var h;this.renderEmpty=this.renderEmpty.bind(this);this.render=this.render.bind(this);if(h=function(a){l.linkToNode(this,a,"tagcounter");l.ignoreContents(this);(new p(this.node[0])).attributes.get("data-component-uri").set(d.uri);this.pool=new e;this.render()}.apply(h||this,arguments))return h}a.uri=k.TagCounter;a.info=
{name:"collection-list",text:"Collection List"};var d=a;a.TagCounter=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.renderEmpty=function(){this.node.html("<div class=empty><p>Create some pages and</p><p>they will be listed here</p></div>")};a.prototype.render=function(){if(0===window.Silk.domain.tagList.docLevelTags.list.length)return this.renderEmpty();var a=$("<table class=line-separated><thead><tr><th>Explore collection</th><th>Pages</th></tr></thead></table>"),b=window.Silk.domain.tagList.sortedDocLevelTags.map(this.toRow).map(p.node);
(new p($("<tbody />").appendTo(a)[0])).childNodes.is(b);this.node.html(a)};a.prototype.toRow=function(a){var b=$("<td />").append($("<a />").text(a.name).attr("href",g.exploreCollection(a.uri)));a=$("<td />").rText(a.docLevelCount);return $("<tr />").append(b,a)[0]};a.prototype.node=void 0;return a}();m.TagCounter=d})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,p=a.typlib.Arrays,g=a.typlib.CleanupPool,e=a.typlib.ThreadEnd,d=function(){function a(b,d,e){var f;this.switchView=this.switchView.bind(this);this.customize=this.customize.bind(this);this.updateSwitcherUI=this.updateSwitcherUI.bind(this);if(f=function(a,b,d){this.pool=new g;this.document=a;this.view=b;this.pipeline=d;this.onCustomize=void 0;this.setupNode();this.setupHasGeo()}.apply(f||this,arguments))return f}a.Configuration=a;a.prototype.cleanup=
function(){this.pool.cleanup()};a.prototype.setupNode=function(){this.node=$($.parseHTML(Resource.Configuration)[0]);this.node.find(".switcher a.customize").click(this.customize);this.node.find(".switcher a[data-view-uri]").click(this.switchView)};a.prototype.setupHasGeo=function(){this.hasGeo=this.pipeline.output.headers.map(function(a){if(!a)return!1;a=a.map(function(a){return a.mostLikely()});return p.any(function(a){return"geo"===a},a)});this.pool.push(this.hasGeo);l.onchange(this.updateSwitcherUI)(this.view,
this.hasGeo)};a.prototype.switchView=function(a){a=$(a.target).attr("data-view-uri");this.view.set("http://typlab.com/2010/components/"+a)};a.prototype.customize=function(){if(this.onCustomize)this.onCustomize(this)};a.prototype.updateSwitcherUI=function(a,b){e.onThreadEnd(function(a,b){var c=this.node.find(".switcher");c.find("a").removeClass("active");if(a){var d=a.match(/[^/]*$/)[0];"map"==d&&(d="googleviz/map");c.find("a[data-view-uri='"+d+"']").addClass("active");this.node.find(".switcher").toggleClass("no-map",
!b)}}.bind(this),arguments)};a.prototype.node=void 0;a.prototype.hasGeo=void 0;return a}();k.Configuration=d})(m.tagpreview||(m.tagpreview={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.component.QueryViewer,g=a.component.tagpreview.Configuration,e=a.reactive.Node,d=a.silk.nav.NavQuery,b=a.reactive.Value,n=a.typlib.Arrays,r=a.typlib.CleanupPool,h=function(){function a(c,b,d){var e;this.renderTag=this.renderTag.bind(this);if(e=function(a,c,b){this.document=c;this.canvas=b;this.pool=new r;this.data={};this.previews=this.node=null;l.linkToNode(this,a,"tag-preview");this.fetchData();this.setupNode();
this.render()}.apply(e||this,arguments))return e}a.uri=k.TagPreview;a.info={name:"collection-overview",text:"Collection Overview"};a.TagPreview=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.fetchData=function(){var a=this.node.find(l.selectorFor("QueryViewer")),b=this.data;a.get().forEach(function(a){var c=$(a).attr("data-component-json");try{var d=JSON.parse(c).roles.collection[0];b[d]=$(a);e.setCleanupDisabled(a,!0)}catch(f){}})};a.prototype.setupNode=function(){this.node.children().detach();
this.node.html(Resource.TagPreview);this.previews=this.node.children(".previews")};a.prototype.render=function(){if(0===window.Silk.domain.repository.documents.get())return this.node.addClass("empty");window.Silk.domain.tagList.sortedDocLevelTags.list.forEach(this.renderTag)};a.prototype.renderTag=function(a){var e=$("<div class=container/>");this.previews.append($("<div class=section />").append($("<h3/>").text(a.name),e));var f=this.data[a.uri];if(f){e.append(f);var h=f[0].component.get()}else f=
d.makeContextQueryLink(a,2),f.roles.image.length?(f.view="http://typlab.com/2010/components/pagegrid",a=a.docLevelCount.get(),a=Math.max(0,Math.floor(Math.random()*(a-12))),f.slice={offset:a,count:12}):(f.view="http://typlab.com/2010/components/querytable",f.slice={offset:0,count:-1==f.slice.count?12:Math.min(f.slice.count,12)}),h=new p(e,this.document,this.canvas),h.data.fromJson(f),h.dirty=(new b(!1)).name("TagPreview.dirty"),h.pool.push(h.data.serialized.onchange(function(){h.dirty.set(!0)},!0));
this.pool.push(h);f=new g(this.document,h.view,h.pipeline,!1);f.node.insertBefore(e);f.onCustomize=function(){this.document.widgetEditing.editWidget(h)}.bind(this);this.pool.push(f)};a.prototype.serializeToXML=function(){var a=n.mapMaybe(this.node.find(".previews .section .component").get(),function(a){if((a=a.component&&a.component.get())&&(!a.dirty||a.dirty.get()))return a.serializeToXML()});return $(this.node[0].cloneNode(!1)).attr("class","tag-preview").append(a)[0]};a.prototype.affectsDirtyState=
function(a){return"AttributeModified"==a.type&&"data-component-json"==a.attribute?!0:!1};return a}();m.TagPreview=h})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.reactive.Events,g=a.reactive.Node,e=a.reactive.Value,d=a.typlib.Arrays,b=a.typlib.CleanupPool,n=a.ui.Bubble,r=function(){function a(c,d,f){var g;this.onDomChange=this.onDomChange.bind(this);this.edit=this.edit.bind(this);var n=this;this.render=function(){var c=arguments;n.__delayed_toh_onDomChange__&&clearTimeout(n.__delayed_toh_onDomChange__);n.__delayed_toh_onDomChange__=setTimeout(function(){a.prototype.render.apply(n,
c);n.__delayed_toh_onDomChange__=null},500)};if(g=function(a,c,d){l.linkToNode(this,a,"toc");this.pool=new b;this.document=c;this.headers=null;this.depth=(new e(3)).name("Toc.depth");this.setupDepth();this.setupBlock();this.render();p.registerAll(this.onDomChange)}.apply(g||this,arguments))return g}a.uri=k.Toc;a.info={name:"table-of-contents",text:"Table of Contents"};var f=a;a.Toc=a;a.prototype.cleanup=function(){p.unregisterAll(this.onDomChange);this.pool.cleanup()};a.prototype.onDomChange=function(a){($(a.target).parents("h2,h3,h4,h5,h6").length||
$(a.target).find("h2,h3,h4,h5,h6").length)&&this.render()};a.prototype.setupDepth=function(){var a=this.node.attr("data-depth");a&&(this.depth.set(+a),g.node(this.node[0]).attributes.get("data-depth").is(this.depth),this.pool.push(this.depth))};a.prototype.setupBlock=function(){this.node.append(this.title=$("<div class=title><span>Table of Contents</span></div>"),this.toc=$("<ul/>"))};a.prototype.render=function(){var a=$("h2,h3,h4,h5,h6",this.document.root).filter(function(){return 0==$(this).parents(".insert-blocks").length&&
0!=$(this).text().length});this.toc.empty();for(var b=this.depth.get(),e=[],f=1,a=d.mapMaybe(a.get(),function(a){var c=+a.nodeName.match(/[0-9]/)[0];return c-1<=b?[$(a),c]:void 0}),h=0;h<a.length;h++){var g=a[h][0],n=a[h][1];n>f?e.push(1):(f-=n,0<f&&(e=e.slice(0,Math.max(1,e.length-f))),e[e.length-1]++);f=n;g=$("<a/>").text(g.text()).click(this.click.bind(this,a[h][0]));$("<li/>").append($("<span/>").text(e.join("."))).append(g).attr("data-level",e.length).appendTo(this.toc)}};a.prototype.click=function(a,
b){$("html, body").animate({scrollTop:$(a).offset().top-80});b.preventDefault();b.stopPropagation()};a.prototype.edit=function(){if(this.bubbleRef&&this.bubbleRef.bubble)return this.bubbleRef.bubble.close();var a=$("<input type=text />").val(this.depth.get()),b=$("<div class=toc-settings><p>Maximum depth:</p></div>");b.append($("<p/>").append(a));a.on("input",function(){if(!a.val().match(/^[0-9]+$/))return a.addClass("err");a.removeClass("err");this.depth.set(+a.val());this.render()}.bind(this));
this.bubbleRef=n.popup(b,180,90,this.title.find("span"),{position:"horizontally-smart",elementPadding:15},null)};a.prototype.affectsDirtyState=function(a){return a.target!=this.node[0]?!1:a.attribute?0<=["data-depth"].indexOf(a.attribute):!0};a.prototype.serializeToXML=function(){var a=$("<div/>").attr("data-component-uri",f.uri);a.attr("data-depth",this.depth.get());return a[0]};a.prototype.bubbleRef=void 0;a.prototype.node=void 0;a.prototype.title=void 0;a.prototype.toc=void 0;return a}();m.Toc=
r})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){var k=a.client.component.ComponentURIs,l=a.client.model.Component,p=a.reactive.Functions,g=a.reactive.Node,e=a.reactive.Value,d=a.typlib.FileUpload,b=a.typlib.Images,n=a.typlib.Svg,r=function(){function a(b,c,d){var h;this.uploadFailure=this.uploadFailure.bind(this);this.setHref=this.setHref.bind(this);if(h=function(a,c,b){this.canvas=b;this.document=c;this.href=this.link=this.ui=this.node=null;this.name=(new e("")).name("Upload.name");l.linkToNode(this,a,"upload");this.setupNodes();
this.prepareUpload()}.apply(h||this,arguments))return h}a.uri=k.Upload;a.fileIcon="M20,3H5v26h22V9L20,3z M24,26H8V6h10v5h6V26z";a.info={name:"file",text:"File"};a.Upload=a;a.prototype.setupNodes=function(){this.link=$("a",this.node);this.link.length||(this.link=$("<a target=_blank>Download</a>").appendTo(this.node));var b=n.renderIcon(a.fileIcon,32,32,1).attr("fill","#999");n.renderBackground(this.link,b);this.href=(new g(this.link[0])).attributes.get("href");this.name.set(this.link.text());this.link.rText(this.name);
this.node.rAddClass(p.cond(this.href,"","empty"));this.node.append(Resource.Upload);this.node.parent().rAddClass(p.cond(this.href,"non-empty-upload",""));this.node.parent().rAddClass("upload")};a.prototype.prepareUpload=function(){var a=$(".upload-ui",this.node),c=$(".upload-ui",this.node),e=n.renderIcon(b.upload,32,32,1).attr("fill","#ACBEBC");n.renderBackground(a,e);d.setupUpload(a,c).then(this.setHref,this.uploadFailure)};a.prototype.uploadFailure=function(a,c){d.fileSizeAlert(c);this.prepareUpload()};
a.prototype.setHref=function(a){window.Silk.canvas.document.get().undoManager.startAction("setHref");this.document.editing.get()&&(this.href.set(a.url),this.name.set(a.name));window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.serializeToXML=function(){var b=$("<div/>").attr("data-component-uri",a.uri)[0];b.appendChild(this.link[0].cloneNode(!0));return b};a.prototype.affectsDirtyState=function(a){return 0<=(new g(a.target)).getShadowParents().indexOf(this.link[0])||a.target==
this.link[0]||a.target==this.node[0]&&"class"!=a.attribute};return a}();m.Upload=r})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.query.Query,p=a.client.query.Print,g=a.typlib.Functions,e=function(){function a(b,d){var c;if(c=function(a,c){this.category=a;this.repository=c}.apply(c||this,arguments))return c}a.removeDocumentsInCategory=function(a,b){var c=new l;c.enabled.set(!0);c.query.set("from all documents where document has type "+p.encodeUri(a.uri)+" select document name");var d=$.Deferred(),g=$.Deferred();d.done(function(c){e(a,b,c).done(function(){g.resolve()}).fail(function(){g.reject()})}).fail(function(){g.reject()});
c.handleResult=function(a){d.resolve(a)};c.error.onchange(function(a){d.reject(a)});return g};a.removeDocuments=function(a,d,c){var e={},g=0;$("td a",c).each(function(){var a=decodeURIComponent(this.getAttribute("href").substring(6));e[a]=[];g++});var n=$.Deferred();window.Silk.api.Page.removeMany(e).done(function(){a.docLevelCount.set(a.docLevelCount.get()-g);d.documents.set(d.documents.get()-g);var e=c.getAttribute("data-slice").split(",");parseInt(e[2])-1>e[1]?b(a,d).done(function(){n.resolve()}).fail(function(){n.reject()}):
n.resolve()}).fail(function(){n.reject()});return n};a.unmarkTagAsDocLevel=function(a){a.docLevelTag.set(!1);return a.save().then(function(){return window.Silk.domain.tagList.load(!0)})};var b=a.removeDocumentsInCategory,e=a.removeDocuments,r=a.unmarkTagAsDocLevel;a.CollectionRemover=a;a.prototype.remove=function(){var a=this.category.get();if(a)return 0<a.docLevelCount.get()?b(a,this.repository).then(g.partial(r,a)):r(a)};return a}();k.CollectionRemover=e})(m.editing||(m.editing={}))})(a.client||
(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.IntegrityCheck,l=a.typlib.Arrays,p=function(){function a(){var e;this.checkIntegrity=this.checkIntegrity.bind(this);var d=this;this.check=function(){var b=arguments;d.__delayed_toh_check__&&clearTimeout(d.__delayed_toh_check__);d.__delayed_toh_check__=setTimeout(function(){a.prototype.check.apply(d,b);d.__delayed_toh_check__=null},0)};if(e=function(){}.apply(e||this,arguments))return e}a.IntegrityMonitor=a;a.prototype.installMonitor=function(){};a.prototype.cleanup=
function(){};a.prototype.checkDocument=function(){};a.prototype.checkIntegrity=function(a){a=$(a.target);a=$("#canvas").parents("*[contenteditable=true]").length?a.attr("contenteditable")?a:a.parent():$("#canvas section [contenteditable=true]");this.checkNodes=this.checkNodes.concat(a.get());this.check()};a.prototype.check=function(){l.unique(this.checkNodes).forEach(k.checkElement);this.checkNodes=[]};return a}();m.IntegrityMonitor=p})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Arrays,l=a.reactive.Node,p=function(){function a(){}a.fromNode=function(a,b){for(var c=[];a&&a!==b;){var d={position:r(a),nodeName:a.nodeName};-1===d.position&&console.warn("Path position -1:",d);c.unshift(d);a=l.shadowParentNode(a)}if(!a)throw Error("Node not a descendant of root element in DOMPath.fromNode.");return c};a.toNode=function(a,b){for(var c=b,d,e,g,r=0;r<a.length;r++){d=c;c=a[r];e=c.position;g=c.nodeName;c=n(d,e);if(!c)return console.error("DOMPath.toNode: Couldn't find child",
e,"of node",d),null;if(c.nodeName!==g)return console.error("DOMPath.toNode: Node",c,"doesn't have correct node name",g),null}return c};a.toNodeFuzzy=function(a,b){for(var c=b,d,e=0;e<a.length;e++)if(d=c,c=a[e],c=c.position,c=n(d,c),!c)return d;return c};a.equal=function(a,b){return k.equals(a,b,e)};a.equalPathItems=function(a,b){return a.position===b.position&&a.nodeName===b.nodeName};a.getComponentDeep=function(a){if(a){var d=(new l(a)).getShadowParents();d.unshift(a);for(a=0;a<d.length;a++){var c=
b(d[a]);if(c)return c}}else console.warn("undefined node in getComponentDeep, probably a bug.")};a.getComponent=function(a){return a.component&&a.component.get()};a.findAffectingChild=function(a,e){for(var c=d(a),g=0,n=!0,r=0;r<a.childNodes.length;r++){var l=a.childNodes[r];if(n=(n=b(l)||c)&&n.affectsDirtyState?n.affectsDirtyState({target:l}):!0){if(g===e)return l;g++}}return null};a.affectingPosition=function(a){for(var e=l.shadowParentNode(a),c=d(e),g=0,n=!0,e=(new l(e)).getShadowChildNodes(),r=
0;r<e.length;r++){var k=e[r];if(k&&(n=(n=b(k)||c)&&n.affectsDirtyState?n.affectsDirtyState({target:k}):!0)){if(k===a)return g;g++}}return-1};var e=a.equalPathItems,d=a.getComponentDeep,b=a.getComponent,n=a.findAffectingChild,r=a.affectingPosition;return a}();m.DOMPath=p})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.DOMPath,l=a.reactive.Events,p=a.reactive.Functions,g=a.reactive.List,e=a.reactive.Node,d=a.typlib.Arrays,b=a.typlib.Functions,n=a.typlib.Objects,r=a.typlib.SelectionManager,h=a.typlib.Tracking,f=function(){function a(b){var d;this.keydown=this.keydown.bind(this);this.undoEvent=this.undoEvent.bind(this);this.redoActionNow=this.redoActionNow.bind(this);this.redoEvent=this.redoEvent.bind(this);this.addEvent=this.addEvent.bind(this);this.addNodeEvent=this.addNodeEvent.bind(this);
this.addTextEvent=this.addTextEvent.bind(this);this.addAttrEvent=this.addAttrEvent.bind(this);this.startWorking=this.startWorking.bind(this);this.stopWorking=this.stopWorking.bind(this);this.undoActionNow=this.undoActionNow.bind(this);this.startUpdateLastAction=this.startUpdateLastAction.bind(this);this.stopUpdateLastAction=this.stopUpdateLastAction.bind(this);this.undo=this.undo.bind(this);this.redo=this.redo.bind(this);var e=this;this.stopTypingDelayed=function(){var b=arguments;e.__delayed_toh_stopTyping__&&
clearTimeout(e.__delayed_toh_stopTyping__);e.__delayed_toh_stopTyping__=setTimeout(function(){a.prototype.stopTypingDelayed.apply(e,b);e.__delayed_toh_stopTyping__=null},500)};this.stopTyping=function(){var b=arguments;e.__delayed_toh_stopTyping__&&clearTimeout(e.__delayed_toh_stopTyping__);a.prototype.stopTyping.apply(e,b)};if(d=function(a){this.undoStack=(new g).name("UndoManager.undoStack");this.redoStack=(new g).name("UndoManager.redoStack");this.eventStack=(new g).name("UndoManager.eventStack");
this.nextRevision=1;this.undoSize=p.add(this.undoStack.length(),p.min(this.eventStack.length(),1)).name("UndoManager.undoSize");this.redoSize=this.redoStack.length();this.actions=[];this.working=!1;this.document=a;this.node=this.document.root;this.startingSelection=null;this.typing=!1;this.installEventHandlers()}.apply(d||this,arguments))return d}a.affectsRegion=function(a,c){return 0<$(a).add(c).parents().andSelf().filter("[data-component-uri='//silk.co/block/pinned/1']").length?"pin":"document"};
var f=a.affectsRegion;a.UndoManager=a;a.prototype.cleanup=function(){this.unregisterEvents()};a.prototype.installEventHandlers=function(){this.nodeInsertedHandler=this.attributeModifiedHandler=this.nodeRemovedHandler=this.characterDataModifiedHandler=this.addEvent;$(this.node).keydown(this.keydown)};a.prototype.affectsDirtyState=function(a){var c=a.target;if(c===this.node)return a.attribute&&-1===a.attribute.toLowerCase().indexOf("data-normalized-")&&-1===["data-title","data-new"].indexOf(a.attribute.toLowerCase());
if(!e.isShadowAncestor(this.node,c))return!1;for(c=c.__reactive;c&&c.node!==this.node;){var b=c.node&&c.node.component&&c.node.component.get();if(b&&b.affectsDirtyState&&!1===b.affectsDirtyState(a))return!1;c=c.parentNode}return!0};a.prototype.unregisterEvents=function(){$(this.node).unbind("keydown",this.keydown)};a.prototype.startAction=function(a,c,b,d){"Unknown"!==a&&l.flush();d||this.stopTyping();0<this.actions.length&&!c&&(console.warn("UndoManager: current action already defined as",this.actions.join(),
"when setting to",a),this.stopAction());0===this.actions.length&&"Unknown"!==a&&(this.startingSelection=b||this.getCurrentSelection());-1==this.actions.indexOf(a)&&this.actions.push(a)};a.prototype.stopAction=function(a){l.flush();if(0!==this.actions.length){var c=this.actions[0];a?this.actions=[]:this.actions.pop();0===this.actions.length&&(this.eventLength()&&(a=this.eventStack.list.slice(),c={name:c,events:a,preSelection:this.startingSelection,postSelection:this.getCurrentSelection(),id:this.nextRevision++,
affectsRegion:d.unique(d.mapProp(a,"affectsRegion"))},this.pushUndo(c),this.eventStack.clear()),this.actions=[],this.startingSelection=null)}};a.prototype.getState=function(){0<this.undoLength()&&(this.actions.length?this.node.normalize():(l.markMutations(this.startUpdateLastAction,function(){this.node.normalize()}.bind(this),this.stopUpdateLastAction),this.node.normalize(),this.updateLastAction=!1));this.stopAction(!0);return{undoStack:this.undoStack.list.slice(),redoStack:this.redoStack.list.slice()}};
a.prototype.setState=function(a){this.stopAction(!0);this.undoStack.set(a.undoStack);this.redoStack.set(a.redoStack)};a.prototype.clear=function(){this.undoStack.clear();this.redoStack.clear();this.saveIndex=0};a.prototype.undoLength=function(){return this.undoStack.list.length};a.prototype.redoLength=function(){return this.redoStack.list.length};a.prototype.eventLength=function(){return this.eventStack.list.length};a.prototype.pushUndo=function(a){this.undoStack.push(a)};a.prototype.popUndo=function(){return this.undoStack.pop()};
a.prototype.pushRedo=function(a){this.redoStack.push(a)};a.prototype.popRedo=function(){return this.redoStack.pop()};a.prototype.resetRedoStack=function(){this.redoStack.clear()};a.prototype.keydown=function(a){switch(a.keyCode){case 13:this.stopTyping();this.typeCharacter(a);break;case 9:this.stopTyping();this.typeCharacter(a);break;case 37:case 38:case 39:case 40:this.stopTyping();break;default:this.typeCharacter(a)}};a.prototype.typeCharacter=function(a){if(!this.typing){var c=k.getComponentDeep(a.target);
if(c&&c.affectsDirtyState&&!c.affectsDirtyState(a))return;this.startAction("typing",!0);this.typing=!0}this.stopTypingDelayed()};a.prototype.stopTypingDelayed=function(){this.stopTyping()};a.prototype.stopTyping=function(){this.typing&&(this.stopAction(!0),this.typing=!1)};a.prototype.addUndoEvent=function(a){this.resetRedoStack();if(this.updateLastAction){var c=d.last(this.undoStack.list).events,b=this.mergeUndoEvent(a,c);b&&c.unshift(a)}else{if(!this.actions.length){console.warn("Undo event without current action, starting new action. This will lead to broken selections on undo.");
this.startAction("Unknown");var e=this;window.setTimeout(function(){e.stopAction()})}(b=this.mergeUndoEvent(a,this.eventStack.list))&&this.eventStack.unshift(a)}};a.prototype.mergeUndoEvent=function(a,c){var b=!0;if(-1<["AttributeModified","CharacterDataModified"].indexOf(a.type)&&a.oldValue&&a.newValue)for(var d=0;d<c.length;d++){var e=c[d];if(a.type===e.type&&a.newValue&&a.attribute===e.attribute&&k.equal(a.target,e.target))e.newValue=a.newValue,b=!1;else break}return b};a.prototype.undoAction=
function(a){this.withWorking(b.partial(this.undoActionNow,a))};a.prototype.withWorking=function(a){l.markMutations(this.startWorking,a,this.stopWorking)};a.prototype.undoEvent=function(a){switch(a.type){case "NodeInserted":this.removeNodeFromEvent(a);break;case "NodeRemoved":this.insertNodeFromEvent(a);break;case "CharacterDataModified":this.setTextContentFromEvent(a,a.oldValue);break;case "AttributeModified":var c=k.toNode(a.target,this.node);c?void 0===a.oldValue||null===a.oldValue?c.removeAttribute(a.attribute):
c.setAttribute(a.attribute,a.oldValue):console.error("UndoManager: target not found in undoEvent",a);break;default:console.error("Unknown event type in UndoManager.undoEvent:",a)}l.flush()};a.prototype.redoAction=function(a){this.withWorking(b.partial(this.redoActionNow,a))};a.prototype.redoActionNow=function(a){for(var c=a.events.length-1;0<=c;c--)this.redoEvent(a.events[c]);this.select(a.postSelection)};a.prototype.redoEvent=function(a){switch(a.type){case "NodeInserted":this.insertNodeFromEvent(a);
break;case "NodeRemoved":this.removeNodeFromEvent(a);break;case "CharacterDataModified":this.setTextContentFromEvent(a,a.newValue);break;case "AttributeModified":var c=k.toNode(a.target,this.node);c?void 0===a.newValue||null===a.newValue?c.removeAttribute(a.attribute):c.setAttribute(a.attribute,a.newValue):console.error("UndoManager: target not found in redoEvent",a);break;default:console.error("Unknown event type in UndoManager.redoEvent:",a)}l.flush()};a.prototype.insertNodeFromEvent=function(a){var c=
k.toNode(a.parentNode,this.node);c?c.insertBefore(a.node.cloneNode(!0),k.findAffectingChild(c,a.offset)):console.error("UndoManager: parentNode not found in insertNodeFromEvent",a)};a.prototype.removeNodeFromEvent=function(a){var c=k.toNode(a.parentNode,this.node);c?c.removeChild(k.findAffectingChild(c,a.offset)):console.error("UndoManager: parentNode not found in removeNodeFromEvent",a)};a.prototype.setTextContentFromEvent=function(a,c){var b=k.toNode(a.target,this.node);b?b.textContent=c:console.error("UndoManager: target not found in setTextContentFromEvent",
a)};a.prototype.getCurrentSelection=function(){var a={startContainer:null,startOffset:0,endContainer:null,endOffset:0},c=r.get();if(!c)return a;var b=k.getComponentDeep(c.startContainer);if(b&&b.serializeSelection){if(b!==k.getComponentDeep(c.endContainer)){console.warn("UndoManager: start and end of selection are in different components. I'm confused.");return}c.componentSelection=b.serializeSelection(c);c.componentNode=k.fromNode(b.node[0],this.node);c.startContainer=null;c.endContainer=null}else{if(this.node&&
c.startContainer){if(b&&b.affectsDirtyState&&!b.affectsDirtyState({target:c.startContainer}))return console.warn("UndoManager: unable to serialize selection in component",b),a;c.startContainer=e.isShadowAncestor(this.node,c.startContainer)&&k.fromNode(c.startContainer,this.node)}if(this.node&&c.endContainer){if(b&&b.affectsDirtyState&&!b.affectsDirtyState({target:c.endContainer}))return console.warn("UndoManager: unable to serialize selection in component",b),a;c.endContainer=e.isShadowAncestor(this.node,
c.endContainer)&&k.fromNode(c.endContainer,this.node)}}return c};a.prototype.select=function(a){if(a)if(a=n.cloneObject(a),a.componentSelection){if(a.component)var c=a.component;else c=k.toNode(a.componentNode,this.node),c=c.component&&c.component.get();c.restoreSelection?c.restoreSelection(a.componentSelection):console.warn("UndoManager: restoring component selection, but no restoreSelection found.",c)}else a.startContainer&&(a.startContainer=k.toNode(a.startContainer,this.node)),a.endContainer&&
(a.endContainer=k.toNode(a.endContainer,this.node)),r.select(a)};a.prototype.addEvent=function(a){if(!this.working&&this.document&&this.affectsDirtyState(a))switch(a.type){case "NodeInserted":case "NodeRemoved":this.addNodeEvent(a);break;case "CharacterDataModified":this.addTextEvent(a);break;case "AttributeModified":this.addAttrEvent(a);break;default:console.error("Unknown event type in UndoManager.addEvent:",a.type)}};a.prototype.addNodeEvent=function(a){this.addUndoEvent({type:a.type,parentNode:k.fromNode(a.parentNode,
this.node),offset:k.affectingPosition(a.target),node:e.cloneReactiveNode(a.target),affectsRegion:f(a.target,a.parentNode)})};a.prototype.addTextEvent=function(a){this.addUndoEvent({type:a.type,target:k.fromNode(a.target,this.node),oldValue:a.oldValue,newValue:a.newValue,affectsRegion:f(a.target)})};a.prototype.addAttrEvent=function(a){this.addUndoEvent({type:a.type,target:k.fromNode(a.target,this.node),oldValue:a.oldValue,newValue:a.newValue,attribute:a.attribute,affectsRegion:f(a.target)})};a.prototype.startWorking=
function(){this.working=!0};a.prototype.stopWorking=function(){this.working=!1};a.prototype.undoActionNow=function(a){a.events.forEach(this.undoEvent);this.select(a.preSelection)};a.prototype.startUpdateLastAction=function(){this.updateLastAction=!0};a.prototype.stopUpdateLastAction=function(){this.updateLastAction=!1};a.prototype.undo=function(){this.stopTyping();this.stopAction(!0);if(0<this.undoSize.get()){h.trackWithMode("undo",{Channel:"UndoManager"},!0);var a=this.popUndo();this.undoAction(a);
this.pushRedo(a)}else console.warn("No undo-history available.")};a.prototype.redo=function(){l.flush();if(0<this.redoLength()){h.trackWithMode("redo",{Channel:"UndoManager"},!0);var a=this.popRedo();this.redoAction(a);this.pushUndo(a)}else console.warn("No redo-history available.")};return a}();m.UndoManager=f})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Serializer,p=a.reactive.Value,g=a.typlib.Functions,e=function(){function a(b,e,g){var h;this.revisionChanged=this.revisionChanged.bind(this);this.autosaveDone=this.autosaveDone.bind(this);this.autosaveFailed=this.autosaveFailed.bind(this);var f=this;this.autosave=function(){var c=arguments;f.__delayed_toh_autosave__&&clearTimeout(f.__delayed_toh_autosave__);f.__delayed_toh_autosave__=setTimeout(function(){a.prototype.autosave.apply(f,c);
f.__delayed_toh_autosave__=null},0)};this.autosaveLater=function(){var c=arguments;f.__delayed_toh_autosave__&&clearTimeout(f.__delayed_toh_autosave__);f.__delayed_toh_autosave__=setTimeout(function(){a.prototype.autosaveLater.apply(f,c);f.__delayed_toh_autosave__=null},1200)};this.cancelAutosave=function(){var c=arguments;f.__delayed_toh_autosave__&&clearTimeout(f.__delayed_toh_autosave__);a.prototype.cancelAutosave.apply(f,c)};this.deleteAutosave=function(){var c=arguments;f.__delayed_toh_autosave__&&
clearTimeout(f.__delayed_toh_autosave__);a.prototype.deleteAutosave.apply(f,c)};if(h=function(a,b,d){this.document=a;this.editing=d;this.dirtyTracking=b;this.autosaving=(new p(!1)).name("Autosaver.autosaving");this.autosaveRevision=(new p(void 0)).name("Autosaver.autosaveRevision");this.hasAutosave=this.autosaveRevision.map(function(a){return void 0!==a}).name("Autosaver.hasAutosave");this.watch()}.apply(h||this,arguments))return h}a.Autosaver=a;a.prototype.watch=function(){this.needsAutosave=p.lift(this.calculateNeedsAutosave)(this.dirtyTracking.actionRunning,
this.dirtyTracking.currentRevision,this.dirtyTracking.savedRevision,this.autosaveRevision).name("AutoSaver.needsAutosave");this.watching=p.onchange(this.revisionChanged)(this.dirtyTracking.currentRevision,this.dirtyTracking.savedRevision).name("Autosaver.currentRevisionChanged")};a.prototype.cleanup=function(){this.watching.unlink();this.needsAutosave.unlink();this.hasAutosave.unlink();this.autosaveRevision.unlink();this.autosaving.unlink()};a.prototype.revisionChanged=function(a,d,e,h){void 0!==
e&&(a===d&&void 0!==a?this.deleteAutosave():a!==e&&this.autosaveLater())};a.prototype.calculateNeedsAutosave=function(a,d,e,h){return a||h!==d&&e!==d};a.prototype.autosave=function(a){var d=this.document,e=d.uri.get();null!==e&&(a||this.editing.get()&&this.needsAutosave.get()&&!d.saver.saving.get())&&(a=this.dirtyTracking.currentRevision.get(),window.Silk.api.Page(e).Autosave.saveCurrent(d.serializer.serialize(null,l.Autosave),g.partial(this.autosaveDone,a),this.autosaveFailed),this.autosaving.set(!0))};
a.prototype.autosaveLater=function(){this.autosave()};a.prototype.cancelAutosave=function(){};a.prototype.autosaveDone=function(a){this.autosaving.set(!1);this.autosaveRevision.set(a)};a.prototype.autosaveFailed=function(){this.autosaving.set(!1);console.warn("Autosaving failed!")};a.prototype.deleteAutosave=function(){var a=this.document.uri.get();null!==a&&(window.Silk.api.Page(a).Autosave.current().remove(void 0,void 0,void 0,{ignoreErrors:[404]}),this.autosaveRevision.set(void 0))};return a}();
k.Autosaver=e})(m.editing||(m.editing={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.List,p=function(){function a(e,d){var b;this.process=this.process.bind(this);this.error=this.error.bind(this);var n=this;this.check=function(){var b=arguments;n.__delayed_toh_check__&&clearTimeout(n.__delayed_toh_check__);a.prototype.check.apply(n,b)};this.delayedCheck=function(){var b=arguments;n.__delayed_toh_check__&&clearTimeout(n.__delayed_toh_check__);n.__delayed_toh_check__=setTimeout(function(){a.prototype.delayedCheck.apply(n,b);n.__delayed_toh_check__=
null},5E3)};if(b=function(a,b){this.uri=a;this.editing=b;this.editors=(new l([])).name("ConcurrentEditors.concurrentEditors");this.watch()}.apply(b||this,arguments))return b}a.ConcurrentEditors=a;a.prototype.check=function(a){(a||this.editing.get())&&null!==this.uri&&window.Silk.api.Page(this.uri).Autosave.list(this.process,this.error,void 0,{ignoreErrors:!0})};a.prototype.delayedCheck=function(){this.check()};a.prototype.process=function(a){if(a){var d=[];a=a.items.map(function(a){return a.owner});
for(var b=0;b<a.length;b++)a[b].uuid!=window.Silk.domain.user.uuid.get()&&d.push(a[b].name);this.editors.set(d);this.delayedCheck()}else this.error()};a.prototype.error=function(){this.delayedCheck()};a.prototype.watch=function(){this.watching=this.editing.onchange(this.check).name("ConcurrentEditors.editingOnchange")};a.prototype.cleanup=function(){this.editors.unlink();this.watching.unlink()};return a}();k.ConcurrentEditors=p})(m.editing||(m.editing={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,p=function(){function a(e){var d;this.remove=this.remove.bind(this);this.removeDone=this.removeDone.bind(this);this.removeFailed=this.removeFailed.bind(this);if(d=function(a){this.removing=(new l(!1)).name("Remover.removing");this.document=a}.apply(d||this,arguments))return d}a.Remover=a;a.prototype.cleanup=function(){this.removing.unlink()};a.prototype.remove=function(a,d){var b=this.document.uri.get();if(null!==b)return this.removing.set(!0),
$(this).trigger("removing"),window.Silk.api.Page(b).remove().done(this.removeDone).fail(this.removeFailed)};a.prototype.removeDone=function(){$(this).trigger("done");this.removing.set(!1)};a.prototype.removeFailed=function(){$(this).trigger("failed");this.removing.set(!1)};return a}();k.Remover=p})(m.editing||(m.editing={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,p=a.typlib.ErrorHandling,g=a.typlib.Functions,e=function(){function a(){var b;this.save=this.save.bind(this);this.documentSaveDone=this.documentSaveDone.bind(this);this.saveDone=this.saveDone.bind(this);this.saveFailed=this.saveFailed.bind(this);if(b=function(a,b,d,e,c,g,k){this.saving=(new l(!1)).name("Saver.saving");this.conflicted=(new l(!1)).name("Saver.conflicted");this.uri=a;this.isNew=b;this.dirtyTracking=k;this.docBeingModified=
d;this.serializer=e;this.pinnedComponents=c;this.integrityMonitor=g}.apply(b||this,arguments))return b}a.Saver=a;a.prototype.cleanup=function(){this.conflicted.unlink();this.saving.unlink()};a.prototype.save=function(a,d,e,h,f){var c=this.uri.get();if(null!==c){this.conflicted.set(!1);this.saving.set(!0);var q=window.setTimeout(function(){this.docBeingModified.set(!1);p.handleError("Exceeded wait timeout",{source:"client.editing.Saver",action:"save"})}.bind(this),3E3);this.docBeingModified.wait(g.is(!1),
function(){window.clearTimeout(q);!0!==f&&$(this).trigger("saving");window.Silk.api.Page.save(c,this.serializer.serialize(h),function(){this.documentSaveDone(d,e,f)}.bind(this),function(a){this.saveFailed(a,e)}.bind(this),a?{force:""}:{})}.bind(this));this.integrityMonitor&&this.integrityMonitor.checkDocument()}};a.prototype.documentSaveDone=function(a,d,e){var h=this.dirtyTracking.hasDirtyPinRegion();this.pinnedComponents&&h?this.pinnedComponents.save(function(){this.saveDone(a,e)}.bind(this),function(a){this.saveFailed(a,
d)}.bind(this)):this.saveDone(a,e)};a.prototype.saveDone=function(a,d){this.saving.set(!1);this.isNew.set(!1);!0!==d&&$(this).trigger("done");a&&a(this)};a.prototype.saveFailed=function(a,d){this.saving.set(!1);$(this).trigger("failed");409==a.status?this.conflicted.set(!0):d&&d(this)};return a}();k.Saver=e})(m.editing||(m.editing={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Arrays,p=a.typlib.Functions,g=function(){function a(){}a.run=function(a){var b=a.makeItem,c=a.makeHole,e=a.makeRow,g=0;return d(a.columns,a.itemCount).map(function(a){return e(a.map(function(a){var d=a?g++:null;return a?b(d):c()}))})};a.niceBooleanMatrix=function(a,d){var c=Math.ceil(d/a),e=p.partial(3>=a?b:g,a,c,d),k=p.partial(r,a),e=p.compose(k,e);return l.range(0,c).map(e)};a.calculateRowWidthFillingRows=function(a,b,c,d){return(c%=a)&&d===
b-1?c:a};a.calculateRowWidthFillingColumns=function(a,b,c,d){a=Math.floor(c/b);return a+(d<c-b*a?1:0)};a.centeredRowOfOnes=function(a,b){var c=(a-b)/2,d=Math.floor(c),c=Math.ceil(c);return l.concat([l.createFilled(d,0),l.createFilled(b,1),l.createFilled(c,0)])};var d=a.niceBooleanMatrix,b=a.calculateRowWidthFillingRows,g=a.calculateRowWidthFillingColumns,r=a.centeredRowOfOnes;return a}();k.SemiRectangularLayout=g})(m.component||(m.component={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.component.SemiRectangularLayout,p=a.client.model.Component,g=a.client.tagging.Suggestions,e=a.client.ui.queryviewer.filter.TagMentioning,d=a.component.EmbedBlock,b=a.component.FigureBlock,n=a.component.Image,r=a.component.KeyValue,h=a.component.QueryViewer,f=a.component.RecentDocuments,c=a.component.SimpleBlock,q=a.component.TagCounter,m=a.component.TagPreview,u=a.component.TextWidget,t=a.component.Toc,v=a.component.Upload,x=a.reactive.Functions,
w=a.reactive.Value,y=a.typlib.Arrays,A=a.typlib.CleanupPool,z=a.typlib.Functions,B=a.typlib.LocalStorage,D=a.typlib.Strings,F=function(){function a(c,b,d){var e;this.getClipboardWidgets=this.getClipboardWidgets.bind(this);this.setupClipboardWidget=this.setupClipboardWidget.bind(this);this.makeWidgetSection=this.makeWidgetSection.bind(this);this.makeWidget=this.makeWidget.bind(this);this.shouldWidgetBeVisible=this.shouldWidgetBeVisible.bind(this);this.toggleWidget=this.toggleWidget.bind(this);this.outsideClick=
this.outsideClick.bind(this);this.clickWidget=this.clickWidget.bind(this);this.insertPageTitle=this.insertPageTitle.bind(this);this.insertTextBlock=this.insertTextBlock.bind(this);this.insertMedia=this.insertMedia.bind(this);var f=this;this.setupClipboardWidget=function(){var c=arguments;setTimeout(function(){a.prototype.setupClipboardWidget.apply(f,c)},0)};if(e=function(a,c,b){this.canvas=b;this.document=c;this.tagList=b.domain.tagList;this.pool=new A(this.expanded=(new w(!1)).name("InsertBlocksBlock.expanded"),
this.detailExpanded=(new w(!1)).name("InsertBlocksBlock.detailExpanded"),this.widgetSectionsExpanded=x.not(this.detailExpanded).name("InsertBlocksBlock.widgetSectionsExpanded"),this.fadeIn=(new w(!0)).name("InsertBlocksBlock.fadeIn"));p.linkToNode(this,a,"block");p.ignore(this);this.layout=$(this.node).closest(".layout");this.isWide=this.layout[0]?!this.layout.hasClass("meta"):!0;a.html($(Resource.InsertBlocksBlock).html()).rAddClass(this.isWide?"wide":"narrow").rAddClass("insert-blocks").rToggleClass("fade-in",
this.fadeIn);setTimeout(function(){this.fadeIn.set(!1)}.bind(this));this.setupBlock();this.setupClasses();this.setupUI();this.setupClipboardAnimation()}.apply(e||this,arguments))return e}a.widgetSectionSpecification=[{header:"Content",widgets:[{name:"text",text:"Text"},{name:"image",text:"Image"},{name:"video",text:"Video"},{name:"audio",text:"Audio"},{name:"embed",text:"Embed"},{name:"pagetitle",text:"Page Title"},{name:"factsheet",text:"Fact Sheet"},{name:"file",text:"File"},{name:"twitter",text:"Twitter"}]},
{header:"Visualization",extraClass:"widget-section-visualization",widgets:[{name:"table",text:"Table"},{name:"list",text:"List"},{name:"grid",text:"Grid"},{name:"group-by",text:"Groups"},{name:"map",text:"Map"},{name:"pie-chart",text:"Pie Chart"},{name:"bar-chart",text:"Bar Chart"},{name:"line-chart",text:"Line Chart"},{name:"donut-chart",text:"Donut Chart"},{name:"scatter-plot",text:"Scatter Plot"},{name:"stack-chart",text:"Stack Chart"}]},{header:"Overview",widgets:[{name:"collection-list",text:"Collection List"},
{name:"recent-pages",text:"Recent Pages"},{name:"table-of-contents",text:"Table of Contents"},{name:"collection-overview",text:"Collection Overview"}]},{header:"Clipboard",widgetMethod:"getClipboardWidgets",extraClass:"widget-section-clipboard"}];var k=a;a.InsertBlocksBlock=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.layoutWidgetBlocks=function(){this.node.find(".widget-sections").empty().append(k.widgetSectionSpecification.map(this.makeWidgetSection))};a.prototype.getClipboardWidgets=
function(){var a=0,c=this.canvas.clipboard.activeThings.list,b=this.canvas.clipboardDocument.makeDumbClones();this.currentClones=b;return y.zipWith(function(c,b){var d=a++;return{name:b.info.name,text:b.info.text,setup:z.partial(this.setupClipboardWidget,c,b),click:function(){this.insertPaste(c,d)}}}.bind(this),c,b)};a.prototype.setupClipboardWidget=function(a,c,b){$(b).hover(function(){$(b).closest(".widget-section").addClass("has-paste-preview")},function(){$(b).closest(".widget-section").removeClass("has-paste-preview")});
a=$("<div class=paste-preview/>").append(c.node).appendTo(b);c=a.height();500<=c&&a.addClass("very-tall");a.css({position:"absolute",top:-(0.75*c+48),left:-100})};a.prototype.setupClipboardAnimation=function(){this.pool.push(this.canvas.clipboard.size.sample().onchange(function(a,c){if(a>c){var b=$(".insert-blocks .add-button",document.root);b.addClass("glow");setTimeout(function(){b.removeClass("glow")},800)}}))};a.prototype.makeWidgetSection=function(a){var c=a.widgetMethod?this[a.widgetMethod].call():
a.widgets,b=c.filter(this.shouldWidgetBeVisible);if(0===b.length)return null;c=l.run({columns:this.isWide?6:3,itemCount:b.length,makeHole:function(){return $('<div class="widget none"/>')},makeRow:function(a){return $("<div class=row/>").append(a)},makeItem:function(a){return this.makeWidget(b[a])}.bind(this)});return $("<div class=widget-section />").addClass(a.extraClass).append($("<div class=ibb-header  />").append(a.header)).append($("<div class=widgets />").append(c))};a.prototype.makeWidget=
function(a){var c=$("<div/>").addClass("widget").addClass(a.name).append($("<div class=img/>")).append($("<div class=label/>").append(a.text));a.setup&&a.setup(c);a.click&&c.data("click-handler",a.click.bind(this));return c};a.prototype.shouldWidgetBeVisible=function(a){var c={pagetitle:function(){return 0==$(this.document.root).find("h1").length},factsheet:function(){return B.get("multipleKeyValueComponents")}};return c[a.name]?c[a.name].call(this):!0};a.prototype.setupBlock=function(){this.node.click(function(a){if(a.target==
this.node[0]||a.target==this.node.children(".add-button")[0])this.detailExpanded.get()?this.hideDetail():this.toggleWidget()}.bind(this));var a=this;this.node.delegate(".widget","click",function(c){a.clickWidget(this,c)})};a.prototype.setupClasses=function(){var a=this.node;a.rSwitchClass("expanded","minimized",this.expanded);a.find(".detail").rToggleClass("expanded",this.detailExpanded);a.rToggleClass("show-detail",this.detailExpanded);a.find(".widget-sections").rSwitchClass("expanded","minimized",
this.widgetSectionsExpanded)};a.prototype.setupUI=function(){var a=this;this.node.delegate(".widget-section .ibb-header","click",function(){a.headerClick(this)})};a.prototype.toggleWidget=function(){this.expanded.get()?this.hideWidget():this.showWidget()};a.prototype.showWidget=function(){var a=this;this.layoutWidgetBlocks();this.node.find(".widgets").each(function(a,c){var b=$(c).find(".row").length;$(c).addClass("num-rows-"+b)});this.expanded.set(!0);this.node.find(".widget-sections").css("height",
0).animate({height:45*k.widgetSectionSpecification.length},function(){a.node.find(".widget-sections").css("height","auto");var c=a.canvas.clipboard,c=1E4>c.timeSinceLastCut()&&!c.wasLastCutPasted.get()?a.node.find(".widget-section-clipboard")[0]:a.node.find(".ibb-header")[0];a.headerClick(c)});setTimeout(function(){$(window).on("click",a.outsideClick)},0)};a.prototype.outsideClick=function(a){-1!=$(a.target).parents().index(this.node)||$(a.target).parents(".vog").length||this.hideWidget()};a.prototype.hideWidget=
function(){$(window).off("click",this.outsideClick);var a=this;this.detailExpanded.set(!1);this.node.find(".widget-section").removeClass("expanded").addClass("minimized");var c=this.node.find(".widget-sections");setTimeout(function(){c.animate({height:0},{duration:100,easing:"linear",complete:function(){a.expanded.set(!1)}})},190);this.currentClones&&(this.canvas.clipboardDocument.giveBackClonesToCache(this.currentClones),this.currentClones=null)};a.prototype.hideDetail=function(){this.detailExpanded.set(!1);
this.node.find(".ibb-header").show();this.node.find(".ibb-header.detail").hide().text("")};a.prototype.headerClick=function(a){this.node.find(".widget-section").removeClass("expanded").addClass("minimized");$(a).closest(".widget-section").addClass("expanded").removeClass("minimized")};a.prototype.clickWidget=function(a,c){var b=$(a).data("click-handler");return b?b():this.clickNormalWidget(a,c)};a.prototype.clickNormalWidget=function(a,c){function b(a){return function(){h.insertQueryViewer(a)}}function d(a){return function(){h.insertWidget(a)}}
var e=$(a),h=this,g={text:z.nullary(this.insertTextBlock),pagetitle:this.insertPageTitle,image:function(a){return function(){h.insertFigure(a)}}(n),embed:this.insertMedia("media"),audio:this.insertMedia("audio"),video:this.insertMedia("video"),twitter:this.insertMedia("twitter"),file:d(v),"recent-pages":d(f),"table-of-contents":d(t),"collection-list":d(q),"collection-overview":d(m),factsheet:d(r),map:b("http://typlab.com/2010/components/googleviz/map"),"pie-chart":b("//silk.co/2014/widget/queryiew/silkviz/piechart/1"),
"line-chart":b("//silk.co/2014/widget/queryiew/silkviz/linechart/1"),"bar-chart":b("//silk.co/2014/widget/queryiew/silkviz/barchart/1"),"donut-chart":b("//silk.co/2014/widget/queryiew/silkviz/donutchart/1"),"scatter-plot":b("//silk.co/2014/widget/queryiew/silkviz/scatterplot/1"),"stack-chart":b("//silk.co/2014/widget/queryiew/silkviz/stackchart/1"),table:b("http://typlab.com/2010/components/querytable"),grid:b("http://typlab.com/2010/components/pagegrid"),list:b("http://typlab.com/2010/components/list"),
"group-by":b("http://typlab.com/2010/components/groupby")};if(e.hasClass("none"))return!1;for(var l in g)if(e.hasClass(l))return g[l].call(a,c);console.warn("No handler for",a)};a.prototype.insertBlock=function(a){a.insertBefore(this.node);this.hideWidget()};a.prototype.insertPaste=function(a,c){window.Silk.canvas.document.get().undoManager.startAction("insertPaste");var b=function(a,c){a=$(a.serialized).insertBefore(this.node);this.canvas.clipboard.markAsPasted(c);this.hideWidget();setTimeout(function(){var c=
a[0].component.get();c.fixLayout&&c.fixLayout()})}.call(this,a,c);window.Silk.canvas.document.get().undoManager.stopAction();return b};a.prototype.insertSimpleBlock=function(a){window.Silk.canvas.document.get().undoManager.startAction("insertSimpleBlock");this.insertBlock(p.createNode(c,a));window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.insertFigureBlock=function(a,c){window.Silk.canvas.document.get().undoManager.startAction("insertFigureBlock");this.insertBlock(p.createNode(b,
$.extend({},c,{content:a})));window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.insertWidget=function(a,c){this.insertSimpleBlock(p.createNode(a,c))};a.prototype.insertFigure=function(a,c){this.insertFigureBlock(p.createNode(a,c))};a.prototype.insertQueryViewer=function(a){this.canvas.document.get().undoManager.startAction("insertQueryViewer");a=h.create(this,{data:g.defaultQueryViewData(this.tagList,a)});this.insertFigureBlock(a.node);this.document.widgetEditing.editWidget(a,
!0)};a.prototype.insertPageTitle=function(){var a=this.document.hasNewUri.get()?null:this.document.title.get();return this.insertTextBlock({tagName:"h1",cssClass:"header",placeholder:"Insert title here...",html:a})};a.prototype.insertTextBlock=function(a){a=p.create(u,this,a);this.insertSimpleBlock(a.node);a.focus(!0)};a.prototype.insertEmbedBlock=function(a,c){window.Silk.canvas.document.get().undoManager.startAction("insertEmbedBlock");var b=p.createNode(d,e.parse(this.tagList,a),c);this.insertBlock(b);
window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.insertMedia=function(a){var c=this;return function(b){function d(){var a=$(c.document.root).find("[data-tag-uri]").filter(function(){var a=$(this).attr("data-key");return a&&"twitter"==a.toLowerCase()})[0];a&&e.find(".text").val($(a).text())[0].select()}var e=$(b.target).closest(".insert-blocks").find(".detail");c.detailExpanded.set(!0);e.removeClass("error");e.find(".text").val("");b=e.find(".ibb-header");"twitter"==a&&d();"twitter"==
a?b.text("Enter a Twitter URL or handle"):b.text("Paste a link to "+a);b.show();e.find(".form").off("submit").submit(function(b){b.preventDefault();b=D.trim(e.find(".text").val());"twitter"==a?b.match("https?://")?c.insertEmbedBlock(b,void 0):"@"==b[0]?(b="//twitter.com/"+b.slice(1),c.insertEmbedBlock(b,void 0)):"~"==b[0]?c.insertEmbedBlock(b,"//twitter.com/"):c.insertEmbedBlock("//twitter.com/"+b,void 0):c.insertEmbedBlock(b,void 0)});e.find(".form input[type=text]").eq(0).focus()}};return a}();
k.InsertBlocksBlock=F})(m.component||(m.component={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.Arrow,p=a.arrow.Dom,g=a.client.component.InsertBlocksBlock,e=a.reactive.Node,d=a.reactive.Selector,b=a.typlib.CleanupPool,n=a.typlib.Functions,r=a.typlib.Objects,h=a.typlib.ThreadEnd,f=function(){function a(d,e,f){var h;this.makeLayoutFixer=this.makeLayoutFixer.bind(this);this.fixInsertBlocks=this.fixInsertBlocks.bind(this);var g=this;this.teardown=function(){var b=arguments;setTimeout(function(){a.prototype.teardown.apply(g,b)},0)};if(h=function(a,
c,d){this.document=a;this.canvas=c;this.enabled=d;this.pool=new b;this.setupEditingBlocks()}.apply(h||this,arguments))return h}a.BlockInsertion=a;a.prototype.cleanup=function(){this.teardown()};a.prototype.setupEditingBlocks=function(){this.enabled.onchange(function(a){a?this.install():this.teardown()}.bind(this))};a.prototype.install=function(){this.pool.push(l.run(this.makeLayoutArrow(),new e(this.document.root)))};a.prototype.makeLayoutArrow=function(){return l.seq(p.select(".layout"),l.arr(this.makeLayoutFixer,
r.call("cleanup")))};a.prototype.makeLayoutFixer=function(a){var c=$(a.node);a=d.select("> .block",a.node,".insert-blocks");a.onchange(n.partial(this.fixInsertBlocks,c));setTimeout(function(){this.fixInsertBlocks(c)}.bind(this),0);return a};a.prototype.ensureFixup=function(){var a=this;$(".layout",this.document.root).each(function(){a.fixInsertBlocks($(this))})};a.prototype.fixInsertBlocks=function(a){h.onThreadEnd(function(){(function(){for(var c;0<(c=a.find(".insert-blocks + .insert-blocks")).length;)c.remove()})();
a.find(b).each(function(){var a=$(this);0==a.prev(".insert-blocks").length&&(a=$("<div/>").insertBefore(a),new g(a,c.document,c.canvas))});(function(){var b=a.children().last(),d=b.is(".block:not(.insert-blocks)"),e=b.is(".pinned.top");if(!b[0]||d||e)b=$("<div/>").appendTo(a),new g(b,c.document,c.canvas)})()},[],"fixInsertBlocks",a[0]);var c=this,b="> .block:not(.insert-blocks), > .pinned.bottom"};a.prototype.teardown=function(){this.pool.cleanup();this.removeInsertBlocksBlock()};a.prototype.removeInsertBlocksBlock=
function(){$(".block.insert-blocks",this.document.root).remove()};return a}();k.BlockInsertion=f})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,p=a.reactive.Functions,g=a.typlib.Tracking,e=function(){function a(b){var d;this.onDocumentSaveStarted=this.onDocumentSaveStarted.bind(this);this.onDocumentSaveFinished=this.onDocumentSaveFinished.bind(this);if(d=function(a){this.undoManager=a;this.savedRevision=(new l(0)).name("DirtyTracking.savedRevision");this.currentRevision=p.or(a.undoStack.last().mapProp("id"),0).name("DirtyTracking.currentRevision");this.actionRunning=p.toBool(a.eventStack.length()).name("DirtyTracking.actionRunning");
this.dirty=p.or(this.actionRunning,p.not(p.eq(this.savedRevision,this.currentRevision))).name("DirtyTracking.dirty");this.pinRegionPreviouslyDirty=!1;this.trackDirtyMetric()}.apply(d||this,arguments))return d}a.listenToSaver=function(a,d){$(a).on("saving.DirtyTracking",d.onDocumentSaveStarted);$(a).on("done.DirtyTracking",d.onDocumentSaveFinished)};a.stopListeningToSaver=function(a){$(a).off(".DirtyTracking")};a.DirtyTracking=a;a.prototype.cleanup=function(){this.dirty.unlink()};a.prototype.onDocumentSaveStarted=
function(){this.undoManager.stopAction(!0);this.lastSavedRevision=this.currentRevision.get()};a.prototype.onDocumentSaveFinished=function(){this.savedRevision.set(this.lastSavedRevision)};a.prototype.trackDirtyMetric=function(){this.edited||(this.edited=(new l(!1)).name("DirtyTracking.edited"));var a=this.edited;this.dirty.onchange(function(d,e){!d&&e&&a.set(!1)});this.actionRunning.onchange(function(d,e){!d||e||a.get()||(a.set(!0),g.trackWithMode("document-modified",{}))})};a.prototype.hasDirtyDocumentRegion=
function(){return this.hasDirtyRegion("document")};a.prototype.hasDirtyPinRegion=function(){return this.pinRegionPreviouslyDirty||this.hasDirtyRegion("pin")};a.prototype.hasDirtyRegion=function(a){var d=this.savedRevision.get();return 0<this.undoManager.undoStack.list.filter(function(e){return e.id>d&&-1!=e.affectsRegion.indexOf(a)}).length};return a}();k.DirtyTracking=e})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Html,l=function(){function a(){}a.wrapRange=function(a,b){var c=a.commonAncestorContainer.ownerDocument.createElement(b),d=$.Event("silk-mutation");d.mutationType="wrapped-range";["startContainer","endContainer","startOffset","endOffset"].forEach(function(c){d[c]=a[c]});d.newContainer=c;a.surroundContents(c);$(c).trigger(d);return c};a.removeNodeWrapper=function(a){if(a.parentNode){var b=k.getNodeOffset(a),c=a.parentNode;c.removeChild(a);for(var d=0<b?c.childNodes[b-
1]:void 0,e=c.childNodes[b];b=a.firstChild;)if(b.nodeType===window.Node.TEXT_NODE&&d&&d.nodeType===window.Node.TEXT_NODE){var g=$.Event("silk-mutation");g.mutationType="joined-textnodes";g.removedNode=b;g.existingNode=d;g.existingOffset=d.nodeValue.length;d.nodeValue+=b.nodeValue;a.removeChild(b);$(c).trigger(g)}else c.insertBefore(b,e),d=b;e&&e.nodeType===window.Node.TEXT_NODE&&d&&d.nodeType===window.Node.TEXT_NODE&&(d.nodeValue+=e.nodeValue,c.removeChild(e))}};a.updateRangeWithSilkMutationEvent=
function(a,b){"wrapped-range"==b.mutationType?n(a,b):"joined-textnodes"==b.mutationType&&r(a,b)};a.updateWrappedTextForward=function(a,b,c){var d=a.length;if(b<d)return[a,b];a=c.childNodes[0];var e=a.length;return b>=d+e?[c.nextSibling,b-d-e]:[a,b-d]};a.updateWrappedTextBackward=function(a,b,c){if(a==c.previousSibling)return g(a,b,c);c=c.lastChild;var d=c.length;return b<=d?[c,b]:[a,b-d]};a.updateWrappedNode=function(a,b,c,d){d=k.getNodeOffset(c);if(b<d)return[a,b];var e=c.childNodes.length;return b>=
a.childNodes.length+e?[a,b-e-1]:[c,b-d]};a.updateWrapped=function(a,b,c,n){return a.nodeType==Node.TEXT_NODE?n?e(a,b,c):g(a,b,c):d(a,b,c,n)};a.updateWrappedRange=function(a,d){if(a.startContainer==d.startContainer){var c=b(a.startContainer,a.startOffset,d.newContainer,!1);a.startContainer=c[0];a.startOffset=c[1]}a.endContainer==d.endContainer&&(c=b(a.endContainer,a.endOffset,d.newContainer,!0),a.endContainer=c[0],a.endOffset=c[1]);c=$(a.endContainer).contents().index(d.endContainer);0<=c&&(a.endOffset+=
c+d.startOffset)};a.updateJoinedTextnodes=function(a,b){a.startContainer==b.removedNode&&(a.startContainer=b.existingNode,a.startOffset+=b.existingOffset);a.endContainer==b.removedNode&&(a.endContainer=b.existingNode,a.endOffset+=b.existingOffset)};var g=a.updateWrappedTextForward,e=a.updateWrappedTextBackward,d=a.updateWrappedNode,b=a.updateWrapped,n=a.updateWrappedRange,r=a.updateJoinedTextnodes;return a}();m.DOMMutation=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(e,d){var b;this.update=this.update.bind(this);if(b=function(a,b){this.parent=$(b).parent();this.overlay=$("<div class=selection-overlay />").addClass(a).appendTo(this.parent);$(window).on("resize",this.update)}.apply(b||this,arguments))return b}a.normalizeEnd=function(a){for(;a.endContainer.nodeType==window.Node.ELEMENT_NODE&&0<a.endOffset;){var d=a.endContainer.childNodes[a.endOffset-1];a.setEnd(d,d.nodeType==window.Node.ELEMENT_NODE?d.childNodes.length:
d.length)}};a.normalizeStart=function(a){for(;a.startContainer.nodeType==window.Node.ELEMENT_NODE&&a.startOffset<a.startContainer.childNodes.length;)a.setStart(a.endContainer.childNodes[a.startOffset],0)};var k=a.normalizeEnd,g=a.normalizeStart;a.DrawSelection=a;a.prototype.drawSelection=function(a){function d(a,d){if(a.childNodes&&0<a.childNodes.length&&1>=d&&!$(a).parent().hasClass("block"))return!0}for(this.range=a=a.cloneRange();d(a.endContainer,a.endOffset);)a.setEndBefore(a.endContainer);this.update()};
a.prototype.update=function(){this.overlay.empty();this.range&&("WebKit"===$.ua.engine.name?this.drawWebkitSelection(this.range):this.drawFirefoxSelection(this.range))};a.prototype.drawRect=function(a,d,b,g){var r=this.parent.offset().top,h=$(document).scrollTop(),f=this.parent.offset().left,c=$(document).scrollLeft();$("<div />").css({top:a-r+h+"px",left:d-f+c+"px",width:b+"px",height:g+"px"}).appendTo(this.overlay)};a.prototype.drawFirefoxSelection=function(a){var d=a.cloneRange();d.collapse(!1);
var b=d.getClientRects()[0],g=this;$(a.getClientRects()).each(function(a,d){b&&(d.bottom>b.bottom||b.bottom==d.bottom&&d.right>b.right)||g.drawRect(d.top,d.left,d.width,d.height)})};a.prototype.drawWebkitSelection=function(a){var d=$(a.commonAncestorContainer).closest(".block"),b=a.getBoundingClientRect();if(0!==b.width&&0!==b.height){var n=a.cloneRange();n.collapse(!1);k(n);n=n.getClientRects()[0];if(d[0])var r=d.outerWidth(),d=d.offset().left+parseInt(d.css("padding-left"));else r=this.overlay.width(),
d=0;a=a.cloneRange();a.collapse(!0);g(a);if((a=a.getClientRects()[0])||n){if(!a){var h=Math.max(n.top-b.top,0);a={left:b.left,width:b.width,top:b.top,height:h}}n||(h=b.height-Math.max(a.bottom-b.top,0),n={top:a.bottom,right:b.right,height:h});n.bottom==a.bottom&&n.top==a.top?this.drawRect(a.top,a.left,n.right-a.left,a.height):(this.drawRect(a.top-3,a.left,r-a.left+d,a.height+3),this.drawRect(a.bottom,d,r,n.top-a.bottom-7),this.drawRect(n.top-7,d,n.right-d,n.height+7))}else b&&this.drawRect(b.top,
b.left,b.width,b.height)}};a.prototype.clearHighlight=function(){this.range=null;this.update()};a.prototype.cleanup=function(){this.clearHighlight();this.overlay.remove()};return a}();a.DrawSelection=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.getStructuralRange=function(a){if(a){var b=a.startContainer,e=a.endContainer,r=a.commonAncestorContainer;if(b==e||b.parentNode==r&&e.parentNode==r)return g(a);for(;b&&b!=r&&b.parentNode!=r;)b=b.parentNode;for(;e&&e!=r&&e.parentNode!=r;)e=e.parentNode;var h=a.cloneRange(),f=a.startContainer,f=f.replaceData?f.length==a.startOffset:f.childNodes.length==a.startOffset;3!=b.nodeType||f?r!=b&&h.setStart(r,k(b)+(f?1:0)):h.setStart(b,a.startOffset);
b=0==a.endOffset;3!=e.nodeType||b?r!=e&&h.setEnd(r,k(e)+(b?0:1)):h.setEnd(e,a.endOffset);return g(h)}};a.getNodeOffset=function(a){for(var b=0;a=a.previousSibling;)b++;return b};a.normalize=function(a){return e(a.cloneRange())};a.normalize_=function(a){if(a.startContainer.nodeType===window.Node.ELEMENT_NODE&&a.startContainer===a.endContainer&&1===a.endOffset-a.startOffset){var b=a.startContainer.childNodes[a.startOffset];if(b.nodeType===window.Node.ELEMENT_NODE&&b.childNodes.length)return a.selectNodeContents(b),
g(a)}return a};var k=a.getNodeOffset,g=a.normalize,e=a.normalize_;return a}();a.StructuralSelect=k})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.client.StructuralSelect,l=function(){function a(){}a.getSelectionOrWordRange=function(a){if(a){var d=a.startContainer;if(a.collapsed&&d&&d.nodeType===Node.TEXT_NODE){a=g(d.textContent,a.startOffset);var b=d.ownerDocument.createRange();b.setStart(d,a.s);b.setEnd(d,a.e);b.isWordRange=!0;return b}return a}};a.isRangeEqualToNodeContent=function(a,d){a=k.getStructuralRange(a);var b=a.commonAncestorContainer;return b==d&&3==d.nodeType?0==a.startOffset&&a.endOffset==d.textContent.length:
b==d?0==a.startOffset&&a.endOffset==d.childNodes.length:1===a.endOffset-a.startOffset?b.childNodes[a.startOffset]&&b.childNodes[a.startOffset]===d:!1};a.checkSelectionAncestors=function(a){for(var d=window.getSelection().getRangeAt(0).commonAncestorContainer;d;){if(a(d))return d;d=d.parentNode}return null};a.isInlineRange=function(a){if(3==a.startContainer.nodeType)return!0;a=a.startContainer.childNodes[a.startOffset];return 3==a.nodeType||0==window.getComputedStyle(a,null).getPropertyValue("display").indexOf("inline")?
!0:!1};a.getWordFromPosition=function(a,d){for(var b=a.split(/\s|[\.,!\?](?=\B)|[()]/g),g=0,r=0,h=0;h<b.length;h++){r+=b[h].length+1;if(d<r&&d>=g||d<g)return 0<h&&1>b[h].replace(/\W/g,"").length?{w:b[h-1],s:g-b[h-1].length-1,e:g-1}:{w:b[h],s:g,e:r-1};g=r}return null};var g=a.getWordFromPosition;return a}();m.ContextMarkup=l})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Component,p=a.reactive.List,g=a.reactive.Value,e=a.typlib.Arrays,d=a.typlib.Functions,b=a.typlib.Objects,n=a.typlib.Range,r=a.typlib.Html,h=a.typlib.DOMMutation,f=a.typlib.DrawSelection,c=a.client.StructuralSelect,q=a.client.ContextMarkup,m=function(){function a(b,e,h){var r;this.handleSelectionChange=this.handleSelectionChange.bind(this);this.handleSilkMutation=this.handleSilkMutation.bind(this);if(r=function(a,b,e){this.root=a;this.editing=
b;$(this.root.ownerDocument).on("silk-selectionchange",this.handleSelectionChange);$(this.root).on("silk-mutation",this.handleSilkMutation);this.selection=(new g).name("DocumentContext.selection");this.structuralSelection=this.selection.map(d.compose(c.getStructuralRange,n.toRange)).name("DocumentContext.structaralSelection");this.structuralSelectionOrWordRange=this.structuralSelection.map(q.getSelectionOrWordRange).name("DocumentContext.structuralSelectionOrWordRange");this.element=this.selection.map(this.anchorElement).name("contextElement");
this.inactiveSelection=new f("inactive",e);this.taggableSelection=new f("taggable",e);this.tags=(new p([])).name("tags");this.editable=g.lift(this.isEditable)(this.editing,this.element).name("DocumentContext.editable");this.ignoring=!1;this.showingTaggableSelection=0}.apply(r||this,arguments))return r}a.DocumentContext=a;a.prototype.cleanup=function(){this.cleanedUp=!0;this.inactiveSelection.cleanup();this.taggableSelection.cleanup();$(this.root.ownerDocument).off("silk-selectionchange",this.handleSelectionChange);
$(this.root).off("silk-mutation",this.handleSilkMutation)};a.prototype.handleSelectionChange=function(a){a.originalEvent.isMutation&&(this.mutationOccurred=!0);this.updateSelection()};a.prototype.handleSilkMutation=function(a){var c=b.cloneObject(this.selection.get());h.updateRangeWithSilkMutationEvent(c,a);this.selection.set(c)};a.prototype.isEditable=function(a,c){return a&&c&&$(c).closest(l.selectorFor("TextWidget")).length};a.prototype.anchorElement=function(a){if(a&&a.startContainer)return a.startContainer.nodeType===
window.Node.ELEMENT_NODE?a.startContainer:a.startContainer.parentNode};a.prototype.updateSelection=function(){if(!this.cleanedUp){var a=window.getSelection(),c=this.mutationOccurred;this.mutationOccurred=!1;var b=a.rangeCount&&a.getRangeAt(0),d=b&&b.startContainer||window.document.activeElement;if(!r.isAncestorOrSelf(this.root,d))return this.showInactiveSelection();if(1!=a.rangeCount||!a.anchorNode)return this.restoreInactiveSelection();this.hideTaggableSelection();this.hideInactiveSelection();if($(d).closest(l.selectorFor("TextWidget")).length){if(a=
n.fromRange(b),b=this.selection.get(),c||!n.equals(a,b))this.selection.set(a),this.updateTags(c)}else this.selection.set(),this.updateTags(c)}};a.prototype.updateTags=function(a){var c=this.element.get();if(a||this.lastStartNode!=c){this.lastStartNode=c;a=this.root;for(var b=[];c&&c!=a;)1!=c.nodeType||!c.getAttribute("data-tag-uri")&&"a"!==c.nodeName.toLowerCase()||b.unshift(c.__reactive),c=c.parentNode;c==a&&b.unshift(c.__reactive);e.equals(b,this.tags.list)||this.tags.set(b)}};a.prototype.selectedDocumentRange=
function(){var a=n.toRange(this.selection.get());if(!a||!a.startContainer){var a=this.root,c=this.root.ownerDocument.createRange();c.selectNode(a);c.collapse();return c}return a};a.prototype.hideInactiveSelection=function(){this.showingInactiveSelection&&(this.showingInactiveSelection=!1,this.inactiveSelection.clearHighlight())};a.prototype.showInactiveSelection=function(){if(!this.showingInactiveSelection){var a=this.selection.get();if(a){this.showingInactiveSelection=!0;var c=n.toRange(a);c?this.showingTaggableSelection||
this.inactiveSelection.drawSelection(c):console.warn("Unable to deserialize range for showInactiveSelection: %o",a)}}};a.prototype.restoreStoredSelection=function(){var a=this.selection.get();if(a)if(a=n.toRange(a)){var c=window.getSelection();c.removeAllRanges();c.addRange(a)}else console.warn("Unable to restore selection to: %o",this.selection.get())};a.prototype.restoreInactiveSelection=function(){this.hideInactiveSelection();this.restoreStoredSelection()};a.prototype.hideTaggableSelection=function(a){void 0===
a&&(a=this.showingTaggableSelection-1);0!==this.showingTaggableSelection&&(this.showingTaggableSelection=Math.min(a,--this.showingTaggableSelection),0===this.showingTaggableSelection&&(this.taggableSelection.clearHighlight(),this.restoreStoredSelection()))};a.prototype.showTaggableSelection=function(){0===this.showingTaggableSelection&&(this.hideInactiveSelection(),window.getSelection().removeAllRanges(),this.taggableSelection.drawSelection(n.toRange(this.structuralSelectionOrWordRange.get())));return this.showingTaggableSelection++};
return a}();k.DocumentContext=m})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.Arrow,p=a.arrow.Dom,g=a.client.model.Component,e=a.domain.TagUris,d=a.domain.typing.Context,b=a.reactive.List,n=a.reactive.Node,r=a.reactive.Selector,h=a.reactive.Value,f=a.typlib.Arrays,c=a.typlib.CleanupPool,q=a.typlib.Strings,m=function(){function a(b){var d;this.reactiveValueForTagURI=this.reactiveValueForTagURI.bind(this);if(d=function(a){function b(a){return k(a[0])}this.document=a;this.pool=new c;this.pool.push(this.tags=this.setupTagSelector(this.document).name("DocumentTags.tags"),
this.allTagUris=this.tags.map(b).name("DocumentTags.allTagUris"),this.presentTagUris=this.tags.filter(function(a){return a[1]}).map(b).name("DocumentTags.presentTagUris"),this.collectionTagUri=this.document.categoryTracking.category)}.apply(d||this,arguments))return d}a.normalize=function(a){return d.normalizeTagUri(a)};var k=a.normalize;a.DocumentTags=a;a.prototype.setupTagSelector=function(a){var c=a.root,d=n.node(c);return function(){var a=g.selectorFor("KeyValue",".data > a"),d=g.selectorFor("TextWidget",
"a[data-tag-uri]"),a=[a,d].join(", "),a=r.select(a,c);return b.fromList(a.map(function(a){var c=l.run(p.getTextDeeply(),a).crush(f.join);a=a.attributes.get("data-tag-uri");return h.transpose(a.map(k),c)}).flat()).filter(function(a){return""!=q.trim(a[1])})}().append(function(){return b.fromList(d.attributes.get("data-title").map(function(a){return[[e.Title,a]]}))}())};a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.reactiveValueForTagURI=function(a){a=k(a);return this.tags.filter(function(c){return c[0]===
a&&c[1]}).debugName("reactiveValueForTagURI("+a+")").head().mapProp(1).sample()};a.prototype.isTagCurrentlyPresent=function(a){return-1!=this.allTagUris.list.indexOf(k(a))};a.prototype.generalizeTagUri=function(a){if(a)return k(a)===this.collectionTagUri.get()?e.Title:a};return a}();k.DocumentTags=m})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.typlib.Strings,g=a.typlib.Functions,e=function(){function a(){}a.createNewRegularPage=function(a,b,c){var d=$(Resource.NewPage);c&&!e(a)&&d.find("h1").text(c||a);b&&d.attr("data-tag-context",b);return d};a.createNewEmptyPage=function(a,d,c){return b(a,d,c).removeAttr("data-new").attr("data-empty","")};a.createNewHomePage=function(a){var b=$(Resource.NewHomepage);b.find("site-name").parent().text(a);return b};a.newPageUri=function(a){return"new-"+
(a?a+"-":"")+Math.round(1E6*Math.random()).toString()};a.isNewPageUri=function(a){return a.match(/^new-(?:(.+?)-)?\d+$/)};a.getNewPageCategoryName=function(a){return(a=e(a))&&a[1]};a.documentUriAvailable=function(a,b,c){window.Silk.api.Page(a).get(g.partial(c,"exists"),b,void 0,{ignoreErrors:[404]})};a.validatePageTitle=function(b,e,c){b=k.trim(b);var g=r(b);return g?256<=k.encodedSize(g)?c("toolong"):a.documentUriAvailable(g,function(){e(g,b)},c):c("required")};a.pageUriErrors=function(a){return{required:"Please enter a page name",
toolong:"The name is too long",exists:"A page with this name already exists"}[a]};a.formatPageUri=function(a){return k.normalizeUri(a)};var b=a.createNewRegularPage,e=a.isNewPageUri,r=a.formatPageUri;return a}();l.NewPage=e})(k.newPage||(k.newPage={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.IntegrityCheck,l=a.typlib.DOMMutation,p=function(){function a(){}a.cleanupNode=function(a){var g=[[k.checks.normalizeEmptyTextual,function(a){$(a).remove()}],[k.checks.noStrongInHeaders,function(a,b){$(b).contents().unwrap()}],[k.checks.disallowed,function(a){a.parentNode&&a.parentNode.removeChild(a)}],[k.checks.nonEmpty,function(a){a.parentNode&&a.parentNode.removeChild(a)}],[k.checks.emptyContent,function(a,b){b.forEach(a.removeChild)}],[k.checks.unrecognised,
function(a){l.removeNodeWrapper(a)}],[k.checks.badAttrs,function(a,b){b.forEach(function(c){a.__reactive?a.__reactive.attributes.unset(c.name):a.removeAttribute(c.name)})}],[k.checks.mustHaveAttrs,function(a){l.removeNodeWrapper(a)}],[k.checks.phraseContent,d],[k.checks.definitions,b("DD")],[k.checks.listItems,b("LI")],[k.checks.tables,b("TR")],[k.checks.tableRows,b("TR")],[k.checks.tableCells,b("TD")]];e(g,a,10)};a.runChecksUntilFixpoint=function(a,b,d){for(var e=0,c=!0;c&&e<d;)c=k.runChecks(a,b),
e++;e===d&&console.warn("No fixpoint reached while running checks.")};a.cleanupPhraseContent=function(a,b){for(var d=a.cloneNode(!1),e=b.shift(),c;c=a.firstChild;)if(c===e){0<d.childNodes.length&&(a.parentNode.insertBefore(d,a),d=a.cloneNode(!1));if(k.isPhraseContent(a)){for(;e=c.firstChild;)d.appendChild(e);c.appendChild(d);a.parentNode.insertBefore(c,a);d=a.cloneNode(!1)}else a.parentNode.insertBefore(c,a);e=b.shift()}else k.isInterElementWhitespace(c)?(0<d.childNodes.length&&(a.parentNode.insertBefore(d,
a),d=a.cloneNode(!1)),a.parentNode.insertBefore(c,a)):d.appendChild(c);0<d.childNodes.length&&a.parentNode.insertBefore(d,a);a.parentNode.removeChild(a)};a.wrapChildrenIn=function(a){return function(b,d){for(var e=b.ownerDocument,c,g=e.createElement(a),l=[];c=b.firstChild;)!k.isPhraseContent(c)&&0<g.childNodes.length&&(l.push(g),g=e.createElement(a)),k.isInterElementWhitespace(c)||g.appendChild(c);0<g.childNodes.length&&l.push(g);l.forEach(function(a){b.appendChild(a)})}};var e=a.runChecksUntilFixpoint,
d=a.cleanupPhraseContent,b=a.wrapChildrenIn;return a}();m.Cleanup=p})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Node,p=a.reactive.Value,g=a.typlib.DOMMutation,e=a.client.model.Registry,d=a.domain.typing.Value,b=a.reactive.Events,n=a.reactive.List,r=a.typlib.Arrays,h=a.typlib.Cleanup,f=a.typlib.Html,c=a.typlib.Objects,q=l.node,m=p.value,u=function(){function a(c,b,e){var f;this.removeDataNormalizedAttributesHandler=this.removeDataNormalizedAttributesHandler.bind(this);var h=this;this.enrichTag=function(){var c=arguments;h["__delayed_toh_enrich-tag__"]&&
clearTimeout(h["__delayed_toh_enrich-tag__"]);h["__delayed_toh_enrich-tag__"]=setTimeout(function(){a.prototype.enrichTag.apply(h,c);h["__delayed_toh_enrich-tag__"]=null},1E3)};if(f=function(a,c,b){this.node=a;this.rNode=new l(this.node);this.rNode.attributes.unset("class");this.rNode.attributes.unset("style");a.component?a.component.set(this):a.component=new p(this);this.tagUri=m(c).name("TagComponent.tagUri");this.rNode.attributes.get("data-tag-uri").is(this.tagUri);this.tagClassBase=m("tag").name("TagComponent.tagClassBase");
this.rNode.classes().push(this.tagClassBase);this.type=m(d.fromNode(this.node)).name("TagComponent.type");this.setupDataNormalizedReset();b||this.enrichTag()}.apply(f||this,arguments))return f}a.fromRange=function(a,c){return D(c,void 0,a)};a.fromRangeOrTagNode=function(b,d){if(d instanceof l){var e=d.node.component;(e=e&&e.get())?e.tagUri.set(b.uri):new a(d.node,b.uri)}else{if(c.isType(d,"Range"))return k(b,d);throw Error("rngOrNode is not a range or node");}};a.tagNode=function(a,c){var b=$("<a/>").attr("data-tag-uri",
a.uri);b.appendTo(c.parentNode);$(c).appendTo(b);return b};a.createFromXML=function(c,b,d,e){return new a(c,c.getAttribute("data-tag-uri"),!e)};a.init=function(){e.register(a,"tag")};a.getRangeOrTagContext=function(a,c,b){if(c===b)return a&&!a.collapsed?a:void 0;if(a&&!a.collapsed&&!a.isWordRange&&(b=a.commonAncestorContainer,"a"!==(1!=b.nodeType?b.parentNode:b).nodeName.toLowerCase()))return a;if(c&&c.node)return c};a.getRangeOrTagFromContext=function(a){return w(a.get().structuralSelectionOrWordRange.get(),
a.get().tags.last().get(),a.get().tags.head().get())};a.getRangeOrTagContextList=function(a){var c=a.bind(function(a){return a&&a.tags.head()}),b=a.bind(function(a){return a&&a.tags.last()});return n.valueToList(p.lift(w)(a.bindProp("structuralSelectionOrWordRange"),b,c))};a.remove=function(a){a.attributes.remove(["data-tag-uri"]);a.node.component.get().cleanup();h.cleanupNode(a.node.parentNode)};a.tagContext=function(a,c){var b=y(a);return u(c,b)};a.linkContextPreEncoded=function(a,c){var b=y(a);
b instanceof l?F(c,b):D(b,c)};a.removeDataNormalizedAttributes=function(a){for(var c=[],b=0;b<a.attributes.length;b++)a.attributes[b].nodeName.match(/^data-normalized-.*/)&&c.push(a.attributes[b].name);for(b=0;b<c.length;b++)$(a).removeAttr(c[b])};a.normalizeRange=function(a){for(a=a.cloneRange();0===a.startOffset&&(a.endContainer.nodeType===window.Node.ELEMENT_NODE&&a.endOffset===a.endContainer.childNodes.length||a.endOffset===a.endContainer.textContent.length);)a.setStart(a.startContainer.parentNode,
f.getNodeOffset(a.startContainer)),a.setEnd(a.endContainer.parentNode,f.getNodeOffset(a.endContainer)+1);return a};a.anchorsFromRange=function(a){var c=[],b=a.startContainer.nodeType===window.Node.ELEMENT_NODE?a.startContainer.childNodes[a.startOffset]:a.endContainer!==a.startContainer?a.startContainer:null;for(a=a.endContainer.nodeType===window.Node.ELEMENT_NODE?a.endOffset:f.getNodeOffset(a.endContainer);b&&f.getNodeOffset(b)<a;)"A"===b.nodeName&&c.push(b),r.pushMany(c,$("a",b).get()),b=b.nextSibling;
return c};a.createLinkAndTag=function(c,b,d){var e=B(z(c)),f=e[0];(d=d&&d.uri)||f&&f.component&&f.component.tagUri.get();b||(b=f&&f.getAttribute("href"));c=g.wrapRange(c,"a");b&&F(b,c);d&&new a(c,d);e.forEach(g.removeNodeWrapper);return c};a.setHref=function(a,c){q(c).attributes.set("href",a)};var k=a.fromRange,u=a.fromRangeOrTagNode,w=a.getRangeOrTagContext,y=a.getRangeOrTagFromContext,A=a.removeDataNormalizedAttributes,z=a.normalizeRange,B=a.anchorsFromRange,D=a.createLinkAndTag,F=a.setHref;a.TagComponent=
a;a.prototype.setupDataNormalizedReset=function(){b.register("NodeInserted",this.removeDataNormalizedAttributesHandler);b.register("NodeRemoved",this.removeDataNormalizedAttributesHandler);b.register("CharacterDataModified",this.removeDataNormalizedAttributesHandler)};a.prototype.unregisterDataNormalizedReset=function(){b.unregister("NodeInserted",this.removeDataNormalizedAttributesHandler);b.unregister("NodeRemoved",this.removeDataNormalizedAttributesHandler);b.unregister("CharacterDataModified",
this.removeDataNormalizedAttributesHandler)};a.prototype.removeDataNormalizedAttributesHandler=function(a){f.isAncestorOrSelf(this.node,a.target)&&(A(this.node),this.enrichTag())};a.prototype.affectsDirtyState=function(a){if(a.attribute&&a.attribute.match(/^data-normalized-/))try{var c=JSON.parse(a.newValue);if(c&&!c.manual)return!1}catch(b){}return!0};a.prototype.enrichTag=function(){if(this.node&&null===this.node.getAttribute("data-suggestion")){for(var a=0;a<this.node.attributes.length;a++)if(this.node.attributes[a].nodeName.match(/^data-normalized-.*/))return;
var c=this.type;d.enrichNode(this.node,function(a){c.set(a)})}};a.prototype.cleanup=function(){this.node?(this.unregisterDataNormalizedReset(),A(this.node),this.tagClassBase.set(void 0),this.rNode.attributes.get("data-tag-uri").unlink(),this.node.component.set(void 0),this.node=void 0):console.warn("TagComponent.cleanup: this.node is undefined.")};a.prototype.serializeToXML=function(){var a=this.node.cloneNode(!0);a.removeAttribute("class");return a};return a}();k.TagComponent=u;u.init()})(m.tagging||
(m.tagging={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.Arrow,p=a.arrow.Dom,g=a.client.model.newPage.NewPage,e=a.client.tagging.TagComponent,d=a.reactive.Node,b=a.typlib.Strings,n=l.constA,r=l.constR,h=l.seq,f=l.isTrue,c=l.orElse,q=l.ifRC,m=l.fromValue,u=l.head,t=l.run,v=p.isText,x=p.getText,w=p.selectNoComponent,y=p.deep,l=function(){function a(b,e){var g;this.fillEmptyTitleBlock=this.fillEmptyTitleBlock.bind(this);this.setTitle=this.setTitle.bind(this);this.removeDataNormalizedAttributes=this.removeDataNormalizedAttributes.bind(this);
if(g=function(a,b){this.document=a;this.enabled=b;var e=h(u(w("h1")),y(h(v,x)),m,f),e=c(e,q(this.document.hasNewUri,n("(Untitled)"),r(this.document.uri)));this.title=t(e,d.node(this.document.root)).crush(function(a){return a.join("")});this.document.title.is(this.title);d.node(this.document.root).attributes.get("data-title").is(this.title);this.titleOnchange=this.title.onchange(this.removeDataNormalizedAttributes)}.apply(g||this,arguments))return g}a.makeTitle=function(a,c){return a||!g.isNewPageUri(c)&&
k(c)};a.suggestTitle=function(a){return b.trim(a.replace(/-/g," "))||a};var l=a.makeTitle,k=a.suggestTitle;a.DocumentTitle=a;a.prototype.fillEmptyTitleBlock=function(){var a=$("h1:first",this.document.root);""===$.trim(a.text())&&this.document.undoManager.withWorking(this.setTitle)};a.prototype.cleanup=function(){this.title.unlink();this.titleOnchange.unlink()};a.prototype.setTitle=function(a){$("h1:first",this.document.root).text(l(a,this.document.uri))};a.prototype.removeDataNormalizedAttributes=
function(){var a=this.document.root;this.enabled.get()&&a&&e.removeDataNormalizedAttributes(a)};return a}();k.DocumentTitle=l})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Events,p=function(){function a(e,d){var b;this.nodeInsertedHandler=this.nodeInsertedHandler.bind(this);this.nodeRemovedHandler=this.nodeRemovedHandler.bind(this);this.attributeModifiedHandler=this.attributeModifiedHandler.bind(this);this.characterDataModifiedHandler=this.characterDataModifiedHandler.bind(this);if(b=function(a,b){this.undoManager=a;this.registry=b;this.registerEvents()}.apply(b||this,arguments))return b}a.EventCoordinator=a;a.prototype.registerEvents=
function(){l.register("NodeInserted",this.nodeInsertedHandler);l.register("AttributeModified",this.attributeModifiedHandler);l.register("NodeRemoved",this.nodeRemovedHandler);l.register("CharacterDataModified",this.characterDataModifiedHandler)};a.prototype.cleanup=function(){l.unregister("NodeInserted",this.nodeInsertedHandler);l.unregister("AttributeModified",this.attributeModifiedHandler);l.unregister("NodeRemoved",this.nodeRemovedHandler);l.unregister("CharacterDataModified",this.characterDataModifiedHandler)};
a.prototype.handleEvent=function(a,d,b){a.forEach(function(a){if(a&&a[d])a[d](b)})};a.prototype.nodeInsertedHandler=function(a){this.handleEvent([this.registry,this.undoManager],"nodeInsertedHandler",a)};a.prototype.nodeRemovedHandler=function(a){this.handleEvent([this.undoManager,this.registry],"nodeRemovedHandler",a)};a.prototype.attributeModifiedHandler=function(a){this.handleEvent([this.registry,this.undoManager],"attributeModifiedHandler",a)};a.prototype.characterDataModifiedHandler=function(a){this.handleEvent([this.registry,
this.undoManager],"characterDataModifiedHandler",a)};return a}();k.EventCoordinator=p})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Component,p=a.component.Image,g=a.component.SimpleBlock,e=a.component.TextWidget,d=function(){function a(){}a.makeBlock=function(){return $("<div class='block'></div>")};a.makeBlockWithUri=function(a){return d().attr("data-component-uri",a)};a.makeTextBlock=function(a,c){return l.createNode(g,l.createNode(e))};a.makeImageBlock=function(){return l.createNode(g,l.createNode(p))};a.makeSection=function(){return $("<section/>")};a.makeTextSection=
function(){return h().prepend(r())};var d=a.makeBlock,r=a.makeTextBlock,h=a.makeSection;return a}();k.SectionUtils=d})(m.component||(m.component={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.component.SectionUtils,p=a.client.model.Component,g=function(){function a(b,d){var e;this.toggle=this.toggle.bind(this);if(e=function(a,b){this.enabled=a;this.doc=b;this.root=$(this.doc.root);this.root.on("dblclick","h1",this.toggle)}.apply(e||this,arguments))return e}a.nextUntilContains=function(a,d,e){var h=$();for(a=a.children(d).first();a[0];){h=h.add(a[0]);if(a.find(e)[0])break;a=a.next()}return h};var d=a.nextUntilContains;a.HeaderPromotion=
a;a.prototype.cleanup=function(){this.root.off("dblclick","h1",this.toggle)};a.prototype.toggle=function(a){if(a.metaKey&&this.enabled.get())if(a=$(a.target).parents("section"),a.hasClass("body")){var e=l.makeSection().addClass("header");$("<div class=layout />").appendTo(e).append(d(a.find(".meta.layout"),".block",p.selectorFor("Image")).not(".insert-blocks"));e.insertBefore(a)}else a.hasClass("header")&&(e=a.find(".block").not(".insert-blocks"),a.next().find("div.meta").prepend(e),a.remove())};
return a}();k.HeaderPromotion=g})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Component,p=function(){function a(e,d){var b,n=this;this.focus=function(){var b=arguments;setTimeout(function(){a.prototype.focus.apply(n,b)},0)};if(b=function(a,b){this.node=a;this.enabled=b;this.enabledOnchange=this.enabled.onchange(this.focus,!0)}.apply(b||this,arguments))return b}a.InitialFocus=a;a.prototype.cleanup=function(){this.enabledOnchange.unlink()};a.prototype.focus=function(a){if(a){a=window.getSelection();var d=l.selectorFor("TextWidget"),
b,g;a.anchorNode&&(b=$(a.anchorNode).closest(d));b||(b=$(d,this.node).filter(function(){return 0==$(this).parents(".pinned").length}).first(),b.find("h1")&&""!==b.find("h1").text()&&(b=$(d,this.node).not(function(){return $(".header",this).length})));(g=b[0]&&b[0].component)&&g.get()&&g.get().focus()}};return a}();k.InitialFocus=p})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Html,p=function(){function a(e){var d;this.insert=this.insert.bind(this);this.insertComponent=this.insertComponent.bind(this);if(d=function(a){this.content=$(l.ensureHtml(a.content));this.root=a.root;this.selector=a.selector;this.undoManager=a.undoManager}.apply(d||this,arguments))return d}a.insertProperly=function(a,d){var b=a.is(".bottom")?"append":"prepend";d[b](a)};a.PinnedOverlay=a;a.prototype.insert=function(){this.content.find(this.selector).get().map($).forEach(this.insertComponent)};
a.prototype.insertComponent=function(e){var d=e.parents().get().reverse().slice(1).map(function(a){var d=$(a).attr("class");return a.nodeName.toLowerCase()+(d?"."+d.split(" ").join("."):"")}).join(" > ");a.insertProperly(e,this.root.find(d))};return a}();k.PinnedOverlay=p})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.component.ComponentURIs,p=a.client.model.Component,g=a.client.model.PinnedOverlay,e=a.client.model.Serializer,d=a.component.Pinned,b=a.reactive.Node,n=a.typlib.DOMSerializer,r=function(){function a(b,c,d){var e;this.save=this.save.bind(this);this.documentLoaded=this.documentLoaded.bind(this);if(e=function(a,c,b){this.document=a;this.root=$(a.root);this.category=a.categoryTracking.category;this.undoManager=a.undoManager;this.pinApi=b;this.setupSerialization(a.serializer);
this.setupCategoryTracking(a.categoryTracking);c&&this.documentLoaded($(c).detach())}.apply(e||this,arguments))return e}a.PinnedComponents=a;a.prototype.setupSerialization=function(a){a.name="Document";a.filter=function(a,b){return b==e.Autosave?[a]:$(a).attr("data-component-uri")!=l.Pinned?[a]:[]};this.serializer=new e(this.root[0]);this.serializer.name="Pinned"};a.prototype.setupCategoryTracking=function(a){var c=a.asTag.get();a.asTag.debounce(1E3,!0).onchange(function(a){a&&c&&a.uri===c.uri||(c=
a,this.tearDown(),a&&this.pinApi.byCollection(a.getCanonicalName()).get(this.documentLoaded))}.bind(this),!0)};a.prototype.save=function(a,c){var b=this.category.get();if(b){var b=decodeURIComponent(b.match(/[^\/]+$/)[0]),d=$(this.serializer.serialize()),d=$("<article data-pinned-components data-format=1 />").append(d.children());this.removeBranchesNotContainingPins(d);this.pinApi.saveByCollection(b,n.serializeToString(d[0]),a,c)}else a&&a()};a.prototype.removeBranchesNotContainingPins=function c(a){var b=
p.selectorFor("Pinned");a.children().each(function(){var a=$(this);a.is(b)||(0==a.find(b).length?a.remove():c(a))})};a.prototype.tearDown=function(){this.root.find(p.selectorFor("Pinned")).remove()};a.prototype.documentLoaded=function(a){(new g({content:a,root:this.root,selector:p.selectorFor("Pinned"),undoManager:this.undoManager})).insert()};a.prototype.pin=function(a,e){window.Silk.canvas.document.get().undoManager.startAction("pin");var h=$(a),n=h.parents(".layout").first(),l=n.find(p.selectorFor("Pinned")).filter("."+
e),r=h[0].component.get();b.setCleanupDisabled(h[0],!0);l[0]?h.appendTo(l[0]):(h=p.createNode(d).addClass(e).append(h),g.insertProperly(h,n));if(r.onPin)r.onPin();window.Silk.canvas.document.get().undoManager.stopAction()};return a}();k.PinnedComponents=r})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,p=a.typlib.ThreadEnd,g=function(){function a(d,b,e,g){var h;this.beforeSave=this.beforeSave.bind(this);this.beforeRemove=this.beforeRemove.bind(this);this.whenUpdated=this.whenUpdated.bind(this);this.updateFailed=this.updateFailed.bind(this);if(h=function(a,c,b,d){this.tagList=a;this.repository=c;this.saver=b;this.remover=d;this.status=this.setupStatus();this.setupEvents()}.apply(h||this,arguments))return h}a.Statistics=a;a.prototype.setupEvents=
function(){$(this.saver).on("saving.Statistics",this.beforeSave);$(this.saver).on("done.Statistics",this.whenUpdated);$(this.saver).on("failed.Statistics",this.updateFailed);$(this.remover).on("removing.Statistics",this.beforeRemove);$(this.remover).on("done.Statistics",this.whenUpdated);$(this.remover).on("failed.Statistics",this.updateFailed)};a.prototype.cleanup=function(){$(this.saver).off(".Statistics");$(this.remover).off(".Statistics")};a.prototype.setupStatus=function(){return l.lift(function(a,
b){return[a,b]})(this.tagList.status,this.repository.status).name("Statistics.status")};a.prototype.beforeSave=function(){this.saver.isNew.get()&&this.repository.documents.set(this.repository.documents.get()+1);this.invalidate()};a.prototype.beforeRemove=function(){this.saver.isNew.get()||this.repository.documents.set(this.repository.documents.get()-1);this.invalidate()};a.prototype.invalidate=function(){this.tagList.status.set("invalidated");this.repository.status.set("invalidated")};a.prototype.whenUpdated=
function(){p.onThreadEnd(function(){this.tagList.load(!0);this.repository.load()}.bind(this),arguments)};a.prototype.updateFailed=function(){this.tagList.status.set("loaded");this.repository.status.set("loaded")};a.prototype.wait=function(a){this.status.wait(function(a){return a&&"loaded"==a[0]&&"loaded"==a[1]},a)};return a}();k.Statistics=g})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Component,p=a.reactive.Events,g=a.reactive.Node,e=function(){function a(b){var d;this.checkPlaceHolderInBlock=this.checkPlaceHolderInBlock.bind(this);if(d=function(a){this.enabled=a;this.setupEvents()}.apply(d||this,arguments))return d}a.TextSuggestion=a;a.prototype.setupEvents=function(){p.register("CharacterDataModified",this.checkPlaceHolderInBlock);p.register("NodeInserted",this.checkPlaceHolderInBlock);p.register("NodeRemoved",this.checkPlaceHolderInBlock)};
a.prototype.cleanup=function(){p.unregister("CharacterDataModified",this.checkPlaceHolderInBlock);p.unregister("NodeInserted",this.checkPlaceHolderInBlock);p.unregister("NodeRemoved",this.checkPlaceHolderInBlock)};a.prototype.checkPlaceHolderInBlock=function(a){a=$(a.target).add((new g(a.target)).getShadowParents());var d=a.filter(l.selectorFor("TextWidget"))[0];(d=d&&d.component&&d.component.get())&&a.filter(d.content)[0]&&d.checkPlaceHolder()};return a}();k.TextSuggestion=e})(m.model||(m.model=
{}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Events,p=a.reactive.Node,g=a.reactive.Selector,e=function(){function a(b){var d;if(d=function(a){this.document=a;this.selector=this.setupDragging()}.apply(d||this,arguments))return d}a.WidgetDragging=a;a.prototype.cleanup=function(){this.selector.cleanup()};a.prototype.setupDragging=function(){function a(c){c.toggleClass("very-tall",c[0].scrollHeight>c[0].offsetHeight)}function d(a){a.removeClass("dragging very-tall");a.closest("[data-article]").find("section").removeClass("dragging").removeAttr("style");
f=null;h.undoManager.stopAction();h.blockInsertion.ensureFixup();setTimeout(function(){p.setCleanupDisabled(a[0],!1)},0)}function e(c,d){var f=d.closest(".layout"),h=3;f.is(".meta")&&(h=1);f.is(".content")&&(h=2);f=250*h+60*(h-1);c.css("width",f+6+60+"px");c[0].component.get().fixLayout(f);setTimeout(function(){d.height(c.innerHeight());a(c)})}var h=this.document,f=null;return g.forEach({selector:".layout, .pinned",contextNode:this.document.root,setup:function(c){var g=$(c.node);c=g.is(".pinned")?
".pinned":".layout";g.sortable({items:"> .block",cancel:".insert-blocks",handle:".action.drag",connectWith:c,tolerance:"pointer",revert:!0,scroll:!0,scrollSensitivity:100,scrollSpeed:40,opacity:0.8,zIndex:5E3,placeholder:"block-drag-placeholder",explicitHelperHeight:"auto",revert:250,beforeStart:function(c,d){var e=d.item;h.undoManager.startAction("Dragging block");e.addClass("dragging").closest("[data-article]").find("section").addClass("dragging");a(e);l.flush();p.setCleanupDisabled(e[0],!0)},start:function(a,
c){c.placeholder.height(c.item.innerHeight())},stop:function(a,c){d(c.item)},create:function(){g.removeClass("ui-sortable")},change:function(a,c){var b=c.placeholder[0].parentNode;b!==f&&(f=b,e(c.item,c.placeholder))}})}})};return a}();k.WidgetDragging=e})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(g,e,d){var b;if(b=function(a,b,d){this.dirtyTracking=a;this.queryViewer=b;this.collection=d}.apply(b||this,arguments))return b}a.CollectionViewSaver=a;a.prototype.load=function(){var a=this.collection.get().viewData;if(a)return this.queryViewer.data.fromJson(a),!0;this.dirtyTracking.dirty.set(!1);return!1};a.prototype.save=function(){var a=this.queryViewer.data.json.flat().get(),e=this.collection.get();e.viewData=a;e.save();this.dirtyTracking.dirty.set(!1)};
return a}();a.CollectionViewSaver=l})(a.model||(a.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Arrays,p=a.typlib.Objects,g=a.typlib.Tracking,e=function(){function a(){}a.setup=function(a,d,e,h){return function(f,c,q,k){c=a(c);c.options.onRender=function(a,c,b){l.contains(f.values.get().map(l.idx(0)).map(p.prop("item")),c.item,f.options.equals)&&(c.disabled=!0);return a};c.options.onSelect=function(a,c,b){a&&!a.disabled&&(c=h(a.item),a=a&&a.item&&(a.item.relation?a.item.relation[0].uri:"document"),k?(g.trackWithMode("explore-columns-add",
{Column:a,Type:d}),f.options.multi?e.set(e.get().concat(c)):e.set([c])):f.options.addOnShift&&b.shiftKey?(g.trackWithMode("explore-columns-add",{Column:a,Type:d,"Using Shift Key":!0}),e.set(e.get().concat(c))):(g.trackWithMode("explore-columns-switch",{Column:a,Type:d}),b=e.get().slice(),b[q]=c,e.set(b)))};c.setup();return c}};return a}();k.PickerPill=e})(m.picker||(m.picker={}))})(a.ui||(a.ui={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.query.Roles,e=a.client.ui.queryviewer.picker.TagPicker,d=a.typlib.Arrays,b=a.typlib.Functions,n=a.typlib.Objects,r=a.ui.picker.PickerPill,h=a.ui.picker.Pills,f=function(){function a(){}a.create=function(a,c,d,g){var l=d.roles.byRole.collection;g=new h({description:g.description||"Collection",multi:!1,allowEmpty:!1,addOnShift:!0,setupUI:r.setup(function(a){return new e(a,a,c,l,{predicate:b.id,collection:!0,comparing:b.comparing(e.byCount,
e.byArity),fallback:"No collections available"})},"Collection",l,n.prop("uri")),addText:g.addText||"Add collection",equals:k});a.push(g,l.onchange(f.bind(this,g,c)),g.values.onchange(p.bind(this,d.roles,d.filters,c),!0));return g};a.onRolesChange=function(a,c,d){d&&a.set(d.map(b.partial(l,c)))};a.itemFromUri=function(a,c){var b=a.findByUriOrCreate(c,!0);return[{label:b.name,item:b}]};a.eqCollections=b.equating(n.prop("uri"));a.onValuesChange=function(a,c,b,e,f){function h(a){if(g.isPageTitle(a.relation))return!0;
var c=b.findByUriOrCreate(a.relation[0],!1);return d.any(function(a){return 0<c.context.get(a)},l)}if(e){var l=e.map(n.prop(0,"item","uri"));a.byRole.collection.set(l);g.tagRoles.map(function(c){c=a.byRole[c];c.set(c.get().filter(h))});c.raw.removeItemsBy(function(a){return!h(a.get())})}};var f=a.onRolesChange,l=a.itemFromUri,k=a.eqCollections,p=a.onValuesChange;return a}();l.Collection=f})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||
(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.picker.TagPicker,e=a.typlib.Arrays,d=a.typlib.Functions,b=a.typlib.Objects,n=a.ui.picker.PickerPill,r=a.ui.picker.Pills,h=function(){function a(){}a.create=function(a,b,f,h){a=f.roles.byRole.column;var l=new r({description:h.description||"Column",multi:void 0===h.multi?!0:h.multi,setupUI:n.setup(function(a){return new g(a,a,b,f.roles.byRole.collection,{predicate:h.exclude?function(a){a=e.mapProp(a.relation,
"uri");var c=h.exclude.values.get(),c=e.mapMap(c,function(a){return a.item.relation[0].uri});return-1==e.indexOf(c,a,e.equals)}:d.id,comparing:d.comparing(g.byCount,g.byArity),fallback:"No tags available"})},"Column",a,g.itemToRole),addText:h.addText||"Add column",equals:g.eqRelation});c(l,a,b);return l};a.connect=function(a,c,b){a.pool.push(c.onchange(h.bind(this,a,b)),a.values.onchange(l.bind(this,c),!0))};a.onRolesChange=function(a,c,b){b&&a.set(e.mapMaybe(b,d.partial(g.itemsFromRelation,c,null)))};
a.onValuesChange=function(a,c){if(c){var d=c.map(function(a){return{relation:a.map(b.prop("item","relation",0,"uri"))}});a.set(d)}};var c=a.connect,h=a.onRolesChange,l=a.onValuesChange;return a}();l.Column=h})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.picker.Column,e=a.client.ui.queryviewer.picker.TagPicker,d=a.typlib.Functions,b=a.ui.picker.PickerPill,n=a.ui.picker.Pills,r=function(){function a(){}a.create=function(a,c,h,l){a=h.roles.byRole.description;l=new n({description:"Description",multi:!1,setupUI:b.setup(function(a){return new e(a,a,c,h.roles.byRole.collection,{predicate:d.apply("ofType","textual"),comparing:d.comparing(function(a){return-a.textLength}),
fallback:"No description tags available"})},"Column",a,e.itemToRole),addText:l.addText||"Pick description",equals:e.eqRelation});g.connect(l,a,c);return l};return a}();l.Description=r})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.picker.Column,e=a.client.ui.queryviewer.picker.TagPicker,d=a.typlib.Functions,b=a.ui.picker.PickerPill,n=a.ui.picker.Pills,r=function(){function a(){}a.create=function(a,c,h,l){a=h.roles.byRole.distribution;l=new n({description:l.description||"Distribution",multi:!1,allowEmpty:!1,setupUI:b.setup(function(a){return new e(a,a,c,h.roles.byRole.collection,{predicate:d.apply("noMedia"),comparing:d.comparing(e.byEnumness,
e.byCount,e.byArity),fallback:"No distribution tags available"})},"Column",a,e.itemToRole),addText:l.addText||"Pick distribution",equals:e.eqRelation});g.connect(l,a,c);return l};return a}();l.Distribution=r})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.picker.TagPicker,e=a.component.GroupBy,d=a.typlib.Arrays,b=a.typlib.Functions,n=a.typlib.Objects,r=a.ui.picker.PickerPill,h=a.ui.picker.Pills,f=function(){function a(){}a.create=function(a,c,f,l){function k(a,c,e){e&&a.set(d.mapMaybe(e,b.partial(g.itemsFromRelation,c,null)))}function p(a,c){if(c){var b=c.map(function(a){return{relation:a.map(n.prop("item","relation",0,"uri")),groupSize:a.map(n.prop("item",
"groupSize"))}});a.set(b)}}var m=f.roles.byRole.group;a=new h({description:"Group by",multi:!1,setupUI:r.setup(function(a){return new g(a,a,c,f.roles.byRole.collection,{predicate:b.apply("noMedia"),comparing:b.comparing(function(a){return-Math.max(0.4,a.enumness())},b.not(g.tagOfType("year")),b.not(g.tagOfType("numeric")),b.not(g.tagOfType("currency")),g.byEnumness,g.byCount,g.byArity),fallback:"No tags available to group by"})},"Column",m,function(a){a=g.itemToRole(a);a.groupSize=n.prop(0,"groupSize")(m.get())||
e.defaultSize;return a}),addText:l.addText||"Pick a tag",equals:g.eqRelation});(function(a,c,b){a.pool.push(c.onchange(k.bind(this,a,b)),a.values.onchange(p.bind(this,c),!0))})(a,m,c);return a};return a}();l.GroupBy=f})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){(function(a){(function(a){var k=function(){function a(e){var d;this.other=this.other.bind(this);if(d=function(a){this.setter=a.setter;this.choices=a.choices;this.question=a.question;this.node=null;this.setupNode()}.apply(d||this,arguments))return d}a.Choice=a;a.prototype.setupNode=function(){this.node=$("<div class=queryviewer-slice />");var a=$("<div class=list />").appendTo(this.node);this.choices.forEach(function(d){$("<div class=slice />").text(d).appendTo(a).click(this.setter.bind(this,
d))}.bind(this));$("<div class='slice other' />").text("other...").appendTo(a).click(this.other)};a.prototype.other=function(){this.setter(prompt(this.question))};return a}();a.Choice=k})(a.queryviewer||(a.queryviewer={}))})(a.ui||(a.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.Choice,e=a.reactive.Value,d=a.ui.Bubble,b=a.ui.picker.Pills,n=function(){function a(h){var f;this.onValuesChange=this.onValuesChange.bind(this);if(f=function(a){this.setter=a.setter;this.choices=a.choices;this.question=a.question;this.description=a.description;var f=a.pool,h=new g({setter:this.setter,choices:this.choices,question:this.question}),n=$("<div/>").append(h.node).css("padding","10px");this.pills=
new b({description:this.description,multi:!1,allowEmpty:!1,setupUI:function(b,e){return d.click(e,n,70,25*(1+a.choices.length)+15,e,{position:"bottom"},null,this.bubbleRef)},addText:"Pick"});f.push(this.pills,e.onchange(this.onValuesChange)(this.pills.values))}.apply(f||this,arguments))return f}a.Choice=a;a.prototype.onValuesChange=function(a){a&&a[0]&&a[0][0]&&this.setter(a[0][0].item)};a.prototype.update=function(a,b){this.pills.set([[{label:b,item:a}]])};return a}();l.Choice=n})(l.picker||(l.picker=
{}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.picker.Choice,e=a.typlib.Functions,d=a.typlib.Objects,b=function(){function a(){}a.create=function(a,b,f,c){var n=new g({pool:a,setter:function(a){var c=parseInt(a,10);isNaN(c)||(c=d.cloneObject(f.roles.byRole.group.get()[0]),c.groupSize=a,f.roles.byRole.group.set([c]))},choices:[5,10,15,20,25,50,100],question:"How many items per group?",description:"Group size"});a.push(f.roles.byRole.group.map(d.prop(0,
"groupSize")).onchange(function(a){n.update(a,a+" items per group")}));n.pills.node.rToggleDisplay(f.output.headers.map(function(a){return a&&a[1]&&e.isOneOf("numeric","year","currency")(a[1].mostLikely())}));return n.pills};return a}();l.GroupSize=b})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.picker.Column,e=a.client.ui.queryviewer.picker.TagPicker,d=a.typlib.Functions,b=a.ui.picker.PickerPill,n=a.ui.picker.Pills,r=function(){function a(){}a.create=function(a,c,h,l){a=h.roles.byRole.image;l=new n({description:"Image",multi:!1,setupUI:b.setup(function(a){return new e(a,a,c,h.roles.byRole.collection,{predicate:d.apply("ofType","image"),comparing:d.comparing(d.not(e.tagOfType("image"))),fallback:"No image tags available"})},
"Column",a,e.itemToRole),addText:l.addText||"Pick image",equals:e.eqRelation});g.connect(l,a,c);a=e.forCollections(h.roles.byRole.collection.get());a=c.tags.list.filter(a).filter(e.tagOfType("image"));1==a.length&&h.roles.byRole.image.set([{relation:[a[0].uri]}]);return l};return a}();l.Image=r})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.query.Roles,e=a.client.ui.queryviewer.picker.TagPicker,d=a.typlib.Functions,b=a.typlib.Strings,n=a.ui.picker.PickerPill,r=a.ui.picker.Pills,h=function(){function a(){}a.create=function(a,d,f,l){var k=f.roles.byRole.collection,p=f.roles.byRole.location,m=new r({description:"Location",multi:!1,allowEmpty:!1,setupUI:n.setup(function(a){return new e(a,a,d,k,{predicate:c,comparing:h,docName:!0,fallback:"No location tags available"})},
"Column",p,e.itemToRole),addText:l.addText||"Add location",equals:e.eqRelation}),A=k.map(function(a){return a&&a.length?b.prettyJoin(d.toNames(a)):"Page name"}).name("Location.collection");a.push(m,p.onchange(function(a){a&&a.length?(a=e.itemsFromRelation(d,A,a[0]),m.set([a])):m.set([])}),m.values.onchange(function(a){if(a){var c=a[0];if(!a.length)return f.roles.byRole.location.set([]);a={};a.relation=1==c.length&&c[0].item.isDocument?g.PageTitle:c.map(function(a){return a.item.relation[0].uri});
f.roles.byRole.location.set([a])}},!0),A);return m};a.predicate=function(a){return this.noMedia(a)};a.comparing=function(a,c){return d.comparing(e.tagOfType("numeric"),function(a){var c=a.types.types.num,c=c?c.fraction:0;a=a.types.types.geo;return-((a?a.fraction:0)-c)})(a,c)};var c=a.predicate,h=a.comparing;return a}();l.Location=h})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.picker.TagPicker,e=a.typlib.Arrays,d=a.typlib.Functions,b=a.typlib.Objects,n=a.ui.picker.PickerPill,r=a.ui.picker.Pills,h=function(){function a(){}a.create=function(a,b,e,f){a=e.roles.byRole.link;f=new r({description:f.description||"Use as link",multi:!1,setupUI:n.setup(function(a){return new g(a,a,b,e.roles.byRole.collection,{predicate:k,comparing:d.comparing(g.byCount,g.byArity),fallback:"No tags available"})},
"Link",a,g.itemToRole),equals:g.eqRelation,addText:"Pick a tag"});c(f,a,b);return f};a.connect=function(a,c,b){a.pool.push(c.onchange(h.bind(this,a,b)),a.values.onchange(l.bind(this,c),!0))};a.onRolesChange=function(a,c,b){b&&a.set(e.mapMaybe(b,d.partial(g.itemsFromRelation,c,null)))};a.onValuesChange=function(a,c){if(c){var d=c.map(function(a){return{relation:a.map(b.prop("item","relation",0,"uri"))}});a.set(d)}};a.predicate=function(a){return this.isLink(a)};var c=a.connect,h=a.onRolesChange,l=
a.onValuesChange,k=a.predicate;return a}();l.Link=h})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.picker.Choice,e=function(){function a(){}a.create=function(a,d,e,h){var f=new g({pool:a,setter:function(a){var b=parseInt(a,10);isNaN(b)||0===b||"all"==a?e.roles.byRole.maxslices.set([]):e.roles.byRole.maxslices.set([b])},choices:[4,6,8,10,12,24,"all"],question:"How many slices at most?",description:"Maximum number of slices"});a.push(e.roles.byRole.maxslices.onchange(function(a){a&&a[0]?f.update(a[0],"max "+
a[0]+" slices"):f.update(0,"all slices")}));return f.pills};return a}();l.MaxSlices=e})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.picker.Column,e=a.client.ui.queryviewer.picker.TagPicker,d=a.ui.picker.PickerPill,b=a.ui.picker.Pills,n=function(){function a(){}a.create=function(a,n,l,r){r=r||{};a=r.isAux?l.roles.byRole.auxnumeric:l.roles.byRole.numeric;var k=new b({description:r.description||"Number",multi:r.multi,allowEmpty:void 0===r.allowEmpty?!1:r.allowEmpty,setupUI:d.setup(function(a){var c=r.exclude&&r.exclude();return new e(a,
a,n,l.roles.byRole.collection,{predicate:function(a){if(c)for(var b=c.values.get(),d=0;d<b.length;d++)if(e.eqRelation(a,b[d][0].item))return!1;return e.relationPredicate(f)(a)},comparing:h,fallback:"No numeric tags available"})},"Column",a,e.itemToRole),addText:r.addText||"Add numeric tag",equals:e.eqRelation});g.connect(k,a,n);return k};a.comparing=function(a,b){return b.types.eligibleAsNumber()-a.types.eligibleAsNumber()};a.tagEligibleAsNumber=function(a){return 0.2<a.types.eligibleAsNumber()};
var h=a.comparing,f=a.tagEligibleAsNumber;return a}();l.Numeric=n})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.query.Roles,e=a.client.ui.queryviewer.picker.TagPicker,d=a.reactive.Value,b=a.typlib.Arrays,n=a.typlib.Functions,r=a.typlib.Images,h=a.typlib.Objects,f=a.typlib.Strings,c=a.typlib.Svg,q=a.typlib.ThreadEnd,k=a.ui.picker.PickerPill,m=a.ui.picker.Pills,t=function(){function a(){}a.itemToRole=function(a){a=e.itemToRole(a);a.direction="asc";return a};a.eqRelation=function(a,c){return a.direction===c.direction&&e.eqRelation(a,
c)};a.create=function(a,t,z,B){function v(a){var b=$("<div />").addClass("queryviewer-sort-direction").click(function(a){a.stopPropagation();F()});c.renderIcon("asc"===a?r.sortAsc:r.sortDesc,24,20,0.4).appendTo(b);return b}function F(a){var c=h.cloneObject(C.get()[0]);c.direction=void 0!==a?a:"asc"===c.direction?"desc":"asc";C.set([c])}var C=z.roles.byRole.order,E=new m({description:"Sort by",multi:!1,setupUI:k.setup(function(a){return new e(a,a,t,z.roles.byRole.collection,{predicate:n.apply("noMedia"),
comparing:n.comparing(e.byCount,e.byArity),docName:!0})},"Sort",C,l),addText:B.addText||"Pick a tag",equals:p}),G=z.roles.byRole.collection.map(function(a){return a&&a.length?f.prettyJoin(t.toNames(a)):"Page name"}).name("Order.collection");a.push(E,C.onchange(function(a,c){if(a){if(!a.length)return E.set([]);var f=a[0],h=e.itemsFromRelation(t,G,f),g=c&&c.length==[]?h[0].item.relation&&0.3<h[0].item.relation[0].types.eligibleAsNumber()?"desc":"asc":f.direction;b.last(h).html=d.value(b.last(h).label).map(function(a){return $("<span/>").append(v(g),
a)}).name("Ordering");q.onThreadEnd(function(){F(g)});E.set([h])}}),E.values.onchange(function(a){if(a){if(!a.length)return C.set([]);a=a[0];var c={direction:C.get()[0].direction};c.relation=1==a.length&&a[0].item.isDocument?g.PageTitle:a.map(function(a){return a.item.relation[0].uri});C.set([c])}}),G);return E};var l=a.itemToRole,p=a.eqRelation;return a}();l.Order=t})(l.picker||(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){(function(l){var g=a.client.ui.queryviewer.picker.Choice,e=function(){function a(){}a.create=function(a,d,e,h){var f=new g({pool:a,setter:function(a){a=parseInt(a,10);isNaN(a)||(e.sliced.offset.set(0),e.sliced.wanted.set(a))},choices:[5,10,20,50,100,150,200,500,1E3],question:"How many items to show at most?",description:"Maximum items"});a.push(e.sliced.wanted.onchange(function(a){f.update(a,a+" at most")}));return f.pills};return a}();l.Slice=e})(l.picker||
(l.picker={}))})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.client.ui.queryviewer.picker.Collection,g=a.client.ui.queryviewer.picker.Column,e=a.client.ui.queryviewer.picker.Description,d=a.client.ui.queryviewer.picker.Distribution,b=a.client.ui.queryviewer.picker.GroupBy,n=a.client.ui.queryviewer.picker.GroupSize,r=a.client.ui.queryviewer.picker.Image,h=a.client.ui.queryviewer.picker.Location,f=a.client.ui.queryviewer.picker.Link,c=a.client.ui.queryviewer.picker.MaxSlices,q=a.client.ui.queryviewer.picker.Numeric,
m=a.client.ui.queryviewer.picker.Order,u=a.client.ui.queryviewer.picker.Slice,t=a.reactive.Functions,v=a.reactive.Value,x=a.typlib.CleanupPool,w=a.ui.Bubble,y=a.typlib.ThreadEnd,A=function(){function a(c,b,d,e){var f;this.viewChange=this.viewChange.bind(this);this.setupTable=this.setupTable.bind(this);this.setupList=this.setupList.bind(this);this.setupPageGrid=this.setupPageGrid.bind(this);this.setupMap=this.setupMap.bind(this);this.setupChart=this.setupChart.bind(this);this.setupScatterPlot=this.setupScatterPlot.bind(this);
this.setupGroupBy=this.setupGroupBy.bind(this);var h=this;this.openBubbleWhenNoValue=function(){var c=arguments;setTimeout(function(){a.prototype.openBubbleWhenNoValue.apply(h,c)},100)};if(f=function(a,c,b,d){this.pool=new x;this.subPool=new x;this.viewComponent=a;this.pipeline=c;this.tagList=b;this.advanced=d;this.extra=this.main=null;this.setupNodes();this.setupMapping();this.pool.push(this.subPool);this.pool.push(a.onchange(this.viewChange))}.apply(f||this,arguments))return f}a.Configuration=a;
a.prototype.cleanup=function(){this.pool.cleanup();this.cleanupCurrent()};a.prototype.setupNodes=function(){this.main=$("<div class=view-specific-main />");this.extra=$("<div class=view-specific-extra />");this.main.append("<div class=content />");this.extra.append("<div class=content />");this.main.append($("<br/>"));this.extra.append($("<br/>"))};a.prototype.setupMapping=function(){this.mapping={"http://typlab.com/2010/components/list":this.setupList,"http://typlab.com/2010/components/querytable":this.setupTable,
"http://typlab.com/2010/components/pagegrid":this.setupPageGrid,"http://typlab.com/2010/components/googleviz/map":this.setupMap,"http://typlab.com/2010/components/groupby":this.setupGroupBy,"//silk.co/2014/widget/queryiew/silkviz/barchart/1":this.setupChart,"//silk.co/2014/widget/queryiew/silkviz/piechart/1":this.setupChart,"//silk.co/2014/widget/queryiew/silkviz/donutchart/1":this.setupChart,"//silk.co/2014/widget/queryiew/silkviz/linechart/1":this.setupChart,"//silk.co/2014/widget/queryiew/silkviz/stackchart/1":this.setupChart,
"//silk.co/2014/widget/queryiew/silkviz/scatterplot/1":this.setupScatterPlot}};a.prototype.cleanupCurrent=function(){this.subPool.cleanup();this.main.children(".content").empty();this.extra.children(".content").empty()};a.prototype.viewChange=function(a,c){y.onThreadEnd(function(a,c){this.cleanupCurrent();if(a){var b=this.mapping[a.constructor.uri];b&&b(this.main.children(".content"),this.extra.children(".content"),a,c)}}.bind(this),arguments,"Configuration.viewChange",this)};a.prototype.mk=function(a,
c){var b=a.create(this.pool,this.tagList,this.pipeline,c||{});this.subPool.push(b);return b};a.prototype.toggle=function(a,c,b,d,e){var f=this.pipeline.roles.byRole.distribution.get(),h=(new v(!!f&&0<f.length)).name("hasDist");this.subPool.push(h);var g=!1;h.onchange(function(){g=!0;setTimeout(function(){g=!1},2E3);this.openBubbleWhenNoValue(h.get()?a:c)}.bind(this));e=$("<div/>").text(e);f={position:"top",startTimeout:500,stopTimeout:700,containerClass:"pill-toggle-explanation",predicate:function(){return!g}};
w.hover(a.descNode.find("a"),e,190,72,void 0,f);w.hover(c.descNode.find("a"),e,190,72,void 0,f);e=a.descNode.add(c.descNode);e.find("a").click(function(){h.get()?c.values.set(a.clear().slice(0,d)):a.values.set(c.clear().slice(0,d));h.set(!h.get())});e.parent().addClass("toggle");a.node.rToggleDisplay(h);c.node.rToggleDisplay(t.not(h));b&&b.node.rToggleDisplay(t.not(h))};a.prototype.openBubbleWhenNoValue=function(a){!a.values.get().length&&a.plusUI&&a.plusUI.bubbleRef.startOrStop()};a.prototype.setupTable=
function(a,c){var b=$("<div/>").append($("<span>").text("Column"),$("<a>").text("(Distribution)")),e=$("<div/>").append($("<span>").text("Distribution"),$("<a>").text("(Column)")),f=this.mk(k),b=this.mk(g,{description:b}),e=this.mk(d,{description:e}),h=this.mk(m),n=this.mk(u);this.toggle(e,b,h,!0,"Toggle between showing tags as columns or a value distribution of a tag.");a.append(f.node,b.node,e.node);c.append(h.node,n.node)};a.prototype.setupList=function(a,c){var b=$("<div/>").append($("<span>").text("Item"),
$("<a>").text("(Distribution)")),e=$("<div/>").append($("<span>").text("Distribution"),$("<a>").text("(Item)")),f=this.mk(k),b=this.mk(g,{description:b,addText:"Add item"}),e=this.mk(d,{description:e}),h=this.mk(m),n=this.mk(u);this.toggle(e,b,h,!0,"Toggle between showing tags as list items or a value distribution of a tag.");a.append(f.node,b.node,e.node);c.append(h.node,n.node)};a.prototype.setupPageGrid=function(a,c,b,d){b=this.mk(k);var h=this.mk(r),n=this.mk(e),l=this.mk(m),q=this.mk(u),t=this.mk(g,
{description:"Additional items",addText:"Add a tag"}),z=this.mk(f);this.openBubbleWhenNoValue(h);d&&this.pipeline.roles.byRole.column.get().length&&this.advanced.set(!0);a.append(b.node,h.node,n.node);c.append(l.node,t.node,z.node,q.node)};a.prototype.setupMap=function(a,c){var b=this.mk(k),d=this.mk(h),e=this.mk(q,{description:"Number plot",allowEmpty:!0}),f=this.mk(g,{description:"Show on popup",addText:"Add a tag",exclude:e}),n=this.mk(m),l=this.mk(u);this.openBubbleWhenNoValue(d);a.append(b.node,
d.node);c.append(e.node,f.node,n.node,l.node)};a.prototype.setupChart=function(a,b,e){var f="Number";switch(e.constructor.label){case "Bar Chart":f="Bars";break;case "Line Chart":f="Lines";break;case "Pie Chart":f="Slice";break;case "Donut Chart":f="Slice"}var h=$("<div/>").append($("<span>").text(f),$("<a>").text("(Distribution)")),g=$("<div/>").append($("<span>").text("Distribution"),$("<a>").text("("+f+")")),n=(f=e.constructor.multi)?"Add numeric tag":"Pick numeric tag",l=this.mk(k),g=this.mk(d,
{description:g}),r=this.mk(u),t=this.mk(q,{multi:f,description:h,addText:n,exclude:function(){return z}});if(e.constructor.aux)var z=this.mk(q,{isAux:!0,multi:f,allowEmpty:!0,description:"Secondary numeric axis",addText:n,exclude:function(){return t}});if("Pie Chart"!=e.constructor.label&&"Donut Chart"!=e.constructor.label)var v=this.mk(m);if("Pie Chart"==e.constructor.label||"Donut Chart"==e.constructor.label)var y=this.mk(c);this.toggle(g,t,v,!1,"Toggle between plotting a numeric tag or plotting the value distribution of a tag.");
this.openBubbleWhenNoValue(t);a.append(l.node,t.node,g.node);b.append(v?v.node:$(),z?z.node:$(),y?y.node:$(),r.node);this.advanced.set(!0)};a.prototype.setupScatterPlot=function(a,c,b){b=this.mk(k);var d=this.mk(m),e=this.mk(u),f=this.mk(q,{multi:!1,description:"Y-Axis",addText:"Pick numeric tag",exclude:function(){return g}}),h=$("<a>").text("(swap axes)").on("click",function(){var a=g.values.get(),c=f.values.get();g.values.set(c);f.values.set(a)}),h=$("<div/>").append($("<span>").text("X-Axis"),
h),g=this.mk(q,{isAux:!0,multi:!1,description:h,addText:"Pick numeric tag",exclude:function(){return f}});this.pipeline.roles.byRole.auxnumeric.get().length&&this.advanced.set(!0);this.openBubbleWhenNoValue(g);a.append(b.node,g.node,f.node);c.append(d.node,e.node)};a.prototype.setupGroupBy=function(a,c){var d=this.mk(k),e=this.mk(b),f=this.mk(u),h=this.mk(n);a.append(d.node,e.node);c.append(f.node,h.node)};return a}();l.Configuration=A})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||
(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.reactive.Value,g=function(){function a(d){var b;if(b=function(a){this.sliced=a;this.node=null;this.setupNodes()}.apply(b||this,arguments))return b}a.SliceInfo=a;a.prototype.cleanup=function(){};a.prototype.setupNodes=function(){this.node=$("<div class=slice-info />");$("<span/>").appendTo(this.node).rText(k.lift(function(a,b){if(void 0===b||void 0===a)return"";var e=parseInt(b[2]);if(0==a)return"";if(a>=e)return 1==a?"Showing the only result":
"Showing all "+a+" results";var g="Showing only "+a+(1==a?" result":" results");if(b[2].match(/\+$/)){var h=Math.pow(10,Math.floor(Math.log(e)/Math.LN10)),f=[a/h,(e+1)/h],c=Math.floor(f[1]),l=0.5*Math.floor(f[1]/0.5),k=0.1*Math.floor(f[1]/0.1);c>f[0]&&(e=h*c);l>f[0]?e=h*l:k>f[0]&&(e=h*k);return g+" of more than "+Math.floor(e)+" in total"}return g+" of "+e+" in total"})(this.sliced.total,this.sliced.attr))};return a}();l.SliceInfo=g})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||
(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.client.query.Roles,g=a.reactive.Value,e=a.typlib.Arrays,d=a.typlib.Strings,b=a.typlib.CleanupPool,n=a.typlib.ThreadEnd,r=function(){function a(d,c,e,h){var n;this.render=this.render.bind(this);this.mention=this.mention.bind(this);this.relation=this.relation.bind(this);this.name=this.name.bind(this);if(n=function(a,c,d,e){this.pool=new b;this.title=new g($());this.tagList=a;this.pool.push(g.onchange(this.render)(c,d,e.activeUnresolved))}.apply(n||
this,arguments))return n}a.views={"http://typlab.com/2010/components/querytable":"Table","http://typlab.com/2010/components/list":"List","http://typlab.com/2010/components/pagegrid":"Grid","http://typlab.com/2010/components/googleviz/map":"Map","http://typlab.com/2010/components/groupby":"GroupBy","//silk.co/2014/widget/queryiew/silkviz/barchart/1":"Chart","//silk.co/2014/widget/queryiew/silkviz/donutchart/1":"Chart","//silk.co/2014/widget/queryiew/silkviz/linechart/1":"Chart","//silk.co/2014/widget/queryiew/silkviz/piechart/1":"Chart",
"//silk.co/2014/widget/queryiew/silkviz/scatterplot/1":"Chart","//silk.co/2014/widget/queryiew/silkviz/stackchart/1":"Chart"};a.Title=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.render=function(b,c,d){n.onThreadEnd(function(c,b,d){if(b&&d){var e=a.views[c];if(b.distribution&&b.distribution.length)this.renderDistributionTitle(e,b,d,c);else switch(e){case "Chart":this.renderChartTitle(e,b,d);break;case "Map":this.renderMapTitle(e,b,d);break;case "GroupBy":this.renderGroupByTitle(e,
b,d);break;default:this.renderDefaultTitle(e,b,d)}}}.bind(this),arguments,"render",this)};a.prototype.renderDefaultTitle=function(a,c,b){this.title.set($("<span/>").append(this.collection(c),this.filters(b)))};a.prototype.renderMapTitle=function(a,c,b){this.title.set($("<span/>").append(this.mapNumeric(c),this.collection(c),this.filters(b),this.location(c)))};a.prototype.renderDistributionTitle=function(a,c,b,d){this.title.set($("<span/>").append("//silk.co/2014/widget/queryiew/silkviz/piechart/1"==
d?"":"Number of ",this.collection(c),this.filters(b)," grouped by ",this.numberOrDistribution(c)))};a.prototype.renderChartTitle=function(a,c,b){this.title.set($("<span/>").append(this.numberOrDistribution(c),c.distribution.length||c.numeric.length?" of ":"",this.collection(c),this.filters(b)))};a.prototype.renderGroupByTitle=function(a,c,b){this.title.set($("<span/>").append(this.collection(c)," grouped by ",c.group.length?d.prettyEnum(c.group.map(this.relation)):"first letter"))};a.prototype.collection=
function(a){return a.collection&&a.collection.length?d.prettyJoin(a.collection.map(this.name))+" pages":"pages"};a.prototype.numberOrDistribution=function(a){if(a.distribution.length)return d.prettyEnum(a.distribution.map(this.relation));a=a.numeric.concat(a.auxnumeric);return d.prettyEnum(a.map(this.relation))};a.prototype.location=function(a){return a.location.length?" mapped by "+this.relation(a.location[0]):""};a.prototype.columns=function(a){a=[].concat(a.image,a.numeric,a.auxnumeric,a.location,
a.column,a.distribution,a.description);return a.length?" with "+d.prettyEnumMaxItems(a.map(this.relation),3,"other columns")+"":""};a.prototype.mapNumeric=function(a){a=a.numeric.concat(a.auxnumeric);return a.length?d.prettyEnumMaxItems(a.map(this.relation),3,"other")+" of ":""};a.prototype.mention=function(a){return a?a.mention?"this page's "+this.name(a.mention):a:a};a.prototype.mentions=function(a){return a.map(this.mention)};a.prototype.filters=function(a){return a.length?" with "+d.prettyEnumMaxItems(a.map(function(a){var b=
k.isPageTitle(a.relation)?"name":this.relation(a);if("enum"==a.type||"matches"==a.type||"equals"==a.type)return"<span class=value>"+(a.values?d.prettyEnum(this.mentions(a.values),"or"):this.mention(a.value))+"</span> "+("matches"==a.type?"in ":"as ")+b;if("nonempty"==a.type)return b;if("range"==a.type||"numeric"==a.type){var e=[" below "," over "," between "],f=this.tagList&&!k.isPageTitle(a.relation)&&this.tagList.findByUri(a.relation[0]);f&&f.types&&f.types.types&&(f=f.types.types,f.date&&0.6<f.date.accuracy?
e=[" before "," after "," between "]:f.year&&0.6<f.year.accuracy?e=[" before "," after "," between "]:f.currency&&0.6<f.currency.accuracy&&(e=[" below "," over "," between "]));var f=this.mention(a.from),h=this.mention(a.to);return void 0!==f&&void 0!==h?b+e[2]+f+" and "+h:void 0!==a.from?b+e[1]+f:void 0!==a.to?b+e[0]+h:b}}.bind(this)),3,"additional filters")+"":""};a.prototype.relation=function(a){return"<span class=relation>"+(k.isPageTitle(a.relation)?"page name":e.map(a.relation,this.name).join(" for "))+
"</span>"};a.prototype.name=function(a){return this.tagList.findByUriOrCreate(a,!0).name};return a}();l.Title=r})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.component.queryviewer.Registry,g=a.typlib.Arrays,e=a.typlib.Objects,d=a.ui.Bubble,b=function(){function a(b,d){var e;this.bubbleContent=this.bubbleContent.bind(this);this.switchView=this.switchView.bind(this);if(e=function(a,b){this.view=a;this.viewComponent=b;this.bubbleRef=this.label=this.point=this.icon=this.box=this.node=null;this.setupNodes()}.apply(e||this,arguments))return e}a.ViewSwitcher=a;a.prototype.cleanup=function(){};a.prototype.setupNodes=
function(){this.node=$("<div class=view-switcher />");this.box=$("<div class=container />").appendTo(this.node);this.icon=$("<div class=icon />").appendTo(this.box);this.point=$("<div class=point>▾</div>").appendTo(this.box);this.label=$("<div class=label />").appendTo(this.box);var a=this.viewComponent.map(e.prop("constructor","shortId"));this.icon.rAddClass(a);a=this.viewComponent.map(function(a){return a&&g.last(a.constructor.label.split(/\s+/))});this.label.rText(a);this.makeBubble()};a.prototype.makeBubble=
function(){this.bubbleRef={};var a="table list pagegrid groupby map barchart donutchart linechart scatterplot piechart stackchart".split(" ");d.click(this.box,this.bubbleContent.bind(this,a),180,42*a.length+10,this.box,{position:"bottom"},null,this.bubbleRef)};a.prototype.bubbleContent=function(a){var b=$("<div class=view-switcher-menu />");a.forEach(this.mkButton.bind(this,b));return b};a.prototype.mkButton=function(a,b){var d=k.byShortId()[b];$("<div/>").addClass("button "+b).prepend($("<div/>").addClass(b)).append($("<span/>").text(d.label)).appendTo(a).click(this.switchView.bind(this,
d.uri))};a.prototype.switchView=function(a,b){this.view.set(a);this.bubbleRef.close()};return a}();l.ViewSwitcher=b})(k.queryviewer||(k.queryviewer={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.client.model.CategoryTracking,g=a.client.model.CollectionViewSaver,e=a.client.ui.queryviewer.Configuration,d=a.client.ui.queryviewer.SliceInfo,b=a.client.ui.queryviewer.Title,n=a.client.ui.queryviewer.ViewSwitcher,r=a.component.QueryViewer,h=a.reactive.Functions,f=a.reactive.Value,c=a.typlib.CleanupPool,q=a.typlib.Images,m=a.typlib.Svg,u=a.typlib.Tracking,t=a.typlib.ThreadEnd,v=function(){function a(b,d,e,h){var g;this.toggleFullWidth=this.toggleFullWidth.bind(this);
this.setupUri=this.setupUri.bind(this);var n=this;this.fixLayout=function(){var c=arguments;setTimeout(function(){a.prototype.fixLayout.apply(n,c)},400)};this.startDirtyTracking=function(){var c=arguments;setTimeout(function(){a.prototype.startDirtyTracking.apply(n,c)},0)};if(g=function(a,b,d,e){this.type="query";this.canvas=a;this.pool=new c;this.mode=(new f(d||"explore")).name("QueryDocument.mode");this.fullWidth=(new f("widget"!=d)).name("QueryDocument.fullWidth");this.advanced=(new f("widget"==
d)).name("QueryDocument.advanced");this.newWidget=(new f(!!e)).name("QueryDocument.newWidget");this.collection=(new f).name("QueryDocument.collection");this.title=null;this.editing=(new f(b||!1)).name("QueryDocument.editing");this.widget=this.widgetBox=this.contentBox=this.filterBox=this.root=this.categoryTracking=this.viewSaver=this.queryViewer=this.uri=null;this.setupMode();this.setupDocumentStructure();this.setupQueryViewer();this.setupContent();this.setupTitleBar();this.setupTitle();this.setupCollection();
this.setupLayout();this.setupUri();this.setupDirtyTracking();this.setupViewSavingAndLoading();u.trackWithMode("query-document-open",{})}.apply(g||this,arguments))return g}a.openWithCollection=function(c){var b=new a(window.Silk.canvas,!1);b.queryViewer.pipeline.roles.byRole.collection.set([c]);b.viewSaver.load()||b.queryViewer.defaultQuery(c);return b};a.QueryDocument=a;a.prototype.cleanup=function(){this.pool.cleanup();this.mode.set(void 0);this.newWidget.set(void 0)};a.prototype.setupMode=function(){$("html").rToggleClass("widget-editing",
h.eq(this.mode,"widget"));$("html").rToggleClass("exploring",h.eq(this.mode,"explore"));$("html").rToggleClass("widget-editing-new",h.eq(this.newWidget,!0))};a.prototype.setupDocumentStructure=function(){this.root=$("<div class=explore />")[0];this.filterBox=$("<div class=filter-box />").appendTo(this.root);this.contentBox=$("<div class=content-box />").appendTo(this.root);this.topConfig=$("<div class=top-config />").appendTo(this.contentBox);this.extraConfig=$("<div class=extra-config />").appendTo(this.contentBox);
this.widgetBox=$("<div class=widget-box />").appendTo(this.contentBox);$("<br />").appendTo(this.root)};a.prototype.setupQueryViewer=function(){this.queryViewer=r.create({document:this,canvas:this.canvas});this.pool.push(this.queryViewer);this.queryViewer.node.appendTo(this.widgetBox)};a.prototype.setupContent=function(){var a=this.queryViewer.pipeline,c=this.queryViewer.viewComponent,b=this.canvas.domain.tagList;this.pool.push(this.viewSwitcher=new n(this.queryViewer.view,c),this.viewSpecific=new e(c,
a,b,this.advanced),this.sliceInfo=new d(a.sliced));this.queryViewer.filterUI.node.appendTo(this.filterBox);this.viewSwitcher.node.appendTo(this.topConfig);this.viewSpecific.main.appendTo(this.topConfig);this.viewSpecific.extra.appendTo(this.extraConfig);this.sliceInfo.node.appendTo(this.widgetBox)};a.prototype.setupTitleBar=function(){this.pool.push(this.titleBar=new b(this.canvas.domain.tagList,this.queryViewer.view,this.queryViewer.pipeline.roles.proxy,this.queryViewer.pipeline.filters));$("<div class=queryviewer-title />").rHtml(this.titleBar.title).insertBefore(this.queryViewer.node)};
a.prototype.setupTitle=function(){this.title="widget"==this.mode.get()?new f("Edit widget"):this.titleBar.title.map(function(a){return $(a).text()});this.title.name("QueryDocument.title")};a.prototype.getTitle=function(){return $(this.titleBar.title.get()).text()};a.prototype.setupCollection=function(){this.collection.is(this.queryViewer.pipeline.roles.byRole.collection);$(this.root).rAttr("data-tag-context",this.collection.mapProp(0));this.pool.push(this.categoryTracking=new k(this.root,this.canvas.domain.tagList))};
a.prototype.setupLayout=function(){var a=this.queryViewer.pipeline.filters.activeResolved.mapProp("length");$("<div class=filter-toggle />").prependTo(this.root).rHtml(f.lift(function(a,c){var b=c?c+" active filter"+(1==c?"":"s"):"Filter",d=$("<div class=icon />");m.renderIcon(q.settings(6),28,28,0.5).appendTo(d);return $(a?[d[0],$("<span/>").text(b)[0]]:[$("<span>Filters</span>")[0],d[0]])})(this.fullWidth,a)).click(this.toggleFullWidth);$(this.root).rSwitchClass("wide","narrow",this.fullWidth);
var c=this.advanced;$("<div class=open-close />").rText(c.map(function(a){return a?"hide":"more"})).appendTo(this.topConfig).click(function(){u.trackWithMode("explore-toggle-advanced",{Action:c.get()?"Hide":"Show"});c.set(!c.get())});$(this.root).rSwitchClass("with-extra-config","without-extra-config",this.advanced);this.fullWidth.onchange(this.fixLayout)};a.prototype.toggleFullWidth=function(){t.onThreadEnd(function(){if(!this.toggleFullWidthBusy){var a=this.fullWidth,c=a.get();this.toggleFullWidthBusy=
!0;var b=this.queryViewer.pipeline.filters.activeResolved.get().length;u.trackWithMode("explore-toggle-filters",{Action:c?"Show":"Hide","Active Filters":b});c?($(".filter-box").show(),setTimeout(function(){a.set(!c);this.toggleFullWidthBusy=!1}.bind(this))):(a.set(!c),setTimeout(function(){$(".filter-box").hide();this.toggleFullWidthBusy=!1}.bind(this),500))}}.bind(this),arguments,"QueryDocument.toggleFullWidth",this)};a.prototype.fixLayout=function(a){a?this.queryViewer.fixLayout(870):this.queryViewer.fixLayout(600)};
a.prototype.setupDirtyTracking=function(){this.dirtyTracking={dirty:(new f(!1)).name("QueryDocument.dirty")};this.startDirtyTracking()};a.prototype.startDirtyTracking=function(){var a=this.dirtyTracking.dirty;this.queryViewer.data.fullUri.onchange(function(){a.set(!0)})};a.prototype.setupViewSavingAndLoading=function(){var a=this.canvas.domain.tagList;this.viewSaver=new g(this.dirtyTracking,this.queryViewer,this.collection.map(function(c){return c&&c.length&&a.findByUriOrCreate(c[0],!0)}));this.pool.push(this.viewSaver)};
a.prototype.setupUri=function(){this.pool.push(this.uri=f.lift(function(a){return["explore"].concat(a)})(this.queryViewer.data.uri))};return a}();l.QueryDocument=v})(k.document||(k.document={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Component,p=a.client.model.document.QueryDocument,g=a.typlib.Functions,e=a.typlib.Strings,d=function(){function a(d,e){var h;this.existingOnSave=this.existingOnSave.bind(this);this.newOnCancel=this.newOnCancel.bind(this);this.existingOnCancel=this.existingOnCancel.bind(this);var f=this;this.fix=function(){var c=arguments;setTimeout(function(){a.prototype.fix.apply(f,c)},0)};if(h=function(a,b){this.activeComponent=a;this.canvas=b;this.onCancel=
this.onSave=null}.apply(h||this,arguments))return h}a.WidgetEditing=a;a.prototype.cleanup=function(){};a.prototype.save=function(){var a=this.canvas.document.get().queryViewer.data.serialized.get();if(this.onSave)this.onSave(a);this.canvas.popStash();this.cleanupTempCallbacks()};a.prototype.cancel=function(){var a=this.canvas.stashed.get();a.activeComponent.get();a.activeComponent.set();if(this.onCancel)this.onCancel();this.canvas.popStash();this.cleanupTempCallbacks()};a.prototype.editWidget=function(a,
b){this.activeComponent.set(a);var d=new p(this.canvas,!0,"widget",b);d.queryViewer.data.serialized.set(a.data.serialized.get());this.canvas.switchDocument(d,!0);var f=a.node.closest(l.selectorFor("FigureBlock"))[0];setTimeout(function(){var a=f&&f.component&&e.trim(f.component.get().getTitleText())!=e.trim(d.getTitle());this.onSave=g.partial(this.existingOnSave,b||!a,d)}.bind(this),0);this.onCancel=b?this.newOnCancel.bind(this,a):this.existingOnCancel};a.prototype.existingOnSave=function(a,b,d){var e=
this.canvas.stashed.get();if(e){var c=e.activeComponent.get();if(c){e.activeComponent.get().data.serialized.set(d);e.activeComponent.set();if(a){a=c.node.closest(l.selectorFor("FigureBlock"));if(!a[0])return;a.find(".figure-title .block-content > div > *").text(b.getTitle());a.find(".figure-title > div")[0].component.get().hidePlaceholder()}this.fix(c)}}};a.prototype.newOnCancel=function(a){a.node.parents("[data-component-uri$='/figure/1']").remove()};a.prototype.existingOnCancel=function(){};a.prototype.cleanupTempCallbacks=
function(){this.onCancel=this.onSave=null};a.prototype.fix=function(a){a.fixLayout();a.filterUI.render();a.node[0].scrollIntoView()};return a}();k.WidgetEditing=d})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Component,p=a.reactive.DOMPath,g=a.typlib.Cleanup,e=a.typlib.SelectionManager,d=function(){function a(d){var e;this.handleEvent=this.handleEvent.bind(this);this.doWebkitDragOver=this.doWebkitDragOver.bind(this);this.doWebkitDropText=this.doWebkitDropText.bind(this);var h=this;this.doWebkitDropText=function(){var d=arguments;h["__delayed_toh_PasteMonitor.doWebkitDropText__"]&&clearTimeout(h["__delayed_toh_PasteMonitor.doWebkitDropText__"]);
h["__delayed_toh_PasteMonitor.doWebkitDropText__"]=setTimeout(function(){a.prototype.doWebkitDropText.apply(h,d);h["__delayed_toh_PasteMonitor.doWebkitDropText__"]=null},50)};if(e=function(a){this.connect(a);this.el=a}.apply(e||this,arguments))return e}a.PasteMonitor=a;a.prototype.connect=function(a){a=$(a);a.on("paste.PasteMonitor",this.handleEvent);if("WebKit"===$.ua.engine.name)a.on("dragover.PasteMonitor",this.doWebkitDragOver);else a.on("drop.PasteMonitor",this.handleEvent)};a.prototype.cleanup=
function(){$(this.el).off(".PasteMonitor")};a.prototype.handleEvent=function(a){a=$(a.target);var b=$(a.parents().andSelf().get().reverse()),d=b.filter("[contenteditable]")[0];d&&setTimeout(function(){try{var a=e.get(),c=a&&p.fromNode(a.startContainer,d),l=a&&p.fromNode(a.endContainer,d)}catch(n){return}for(var k=0;k<b.length;k++)if(b[k].parentNode){k=$(b[k]);k=k.attr("contenteditable")?k:k.parent();g.cleanupNode(k[0]);e.select({startContainer:c&&p.toNodeFuzzy(c,d),startOffset:a&&a.startOffset,endContainer:l&&
p.toNodeFuzzy(l,d),endOffset:a&&a.endOffset});break}},0)};a.prototype.doWebkitDragOver=function(a){(a.originalEvent.dataTransfer.types||-1!=a.originalEvent.dataTransfer.types.indexOf("text/plain"))&&this.doWebkitDropText(a)};a.prototype.doWebkitDropText=function(a){$(a.target).closest(l.selectorFor("TextWidget"))[0]&&this.handleEvent(a)};return a}();k.PasteMonitor=d})(m.monitoring||(m.monitoring={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Html,p=a.typlib.IntegrityCheck,g=a.typlib.SelectionManager,e=function(){function a(b){var d;this.handleKeypress=this.handleKeypress.bind(this);if(d=function(a){this.connect(a)}.apply(d||this,arguments))return d}a.scrollIntoView=function(a){e(a)||a.scrollIntoView()};a.elementInViewport=function(a){for(var b=a.offsetTop,d=a.offsetLeft,c=a.offsetWidth,e=a.offsetHeight,g=a;g.offsetParent;)g=g.offsetParent,b+=g.offsetTop,d+=g.offsetLeft;a=a.ownerDocument.defaultView;
return b>=a.pageYOffset&&d>=a.pageXOffset&&b+e<=a.pageYOffset+a.innerHeight&&d+c<=a.pageXOffset+a.innerWidth};var b=a.scrollIntoView,e=a.elementInViewport;a.ReturnKeyMonitor=a;a.prototype.connect=function(a){$(a).on("keypress",this.handleKeypress)};a.prototype.disconnect=function(){};a.prototype.handleKeypress=function(a){if(13===a.which){var d=this.handleEnter();d&&(a.preventDefault(),b(d))}};a.prototype.handleEnter=function(){var a=window.getSelection();if(a.focusNode&&a.anchorNode){var b=l.isFollowing(a.focusNode,
a.anchorNode)?a.focusNode:a.anchorNode,d=b===a.focusNode?b===a.anchorNode?Math.max(a.focusOffset,a.anchorOffset):a.focusOffset:a.anchorOffset,c=a.focusNode===b?a.anchorNode:a.focusNode,e=d===a.focusOffset?a.anchorOffset:a.focusOffset,n=b.nodeType===window.Node.TEXT_NODE&&d===b.textContent.length&&!(b.nextSibling&&b.nextSibling.nodeType===window.Node.TEXT_NODE)||b.nodeType===window.Node.ELEMENT_NODE&&d===b.childNodes.length||b.nodeType===window.Node.ELEMENT_NODE&&0===d&&"BR"===b.childNodes[0].nodeName;
if(a=0===e){for(;0===e&&p.isPhraseContent(c);)e=l.getNodeOffset(c),c=c.parentNode;for(;(b.nodeType==window.Node.ELEMENT_NODE?d==b.childNodes.length:b.nodeType==window.Node.TEXT_NODE&&d==b.length)&&p.isPhraseContent(b);)d=l.getNodeOffset(b)+1,b=b.parentNode;g.select({startContainer:c,startOffset:e,endContainer:b,endOffset:d})}if(n){if(c!==b||e!==d)return window.document.execCommand("delete",!1,null),this.handleEnter();for(c=function(a){if(a.nodeType===window.Node.TEXT_NODE)return a.textContent.length;
if(a.nodeType===window.Node.ELEMENT_NODE)return a.childNodes.length;console.error("Unknown node type in CanvasMonitor.endIdx.");return 0};p.isPhraseContent(b)&&d===c(b);)d=l.getNodeOffset(b)+1,b=b.parentNode;if(d===c(b)){e=d;c=b;d=b.nodeName;if(-1!=="H1 H2 H3 H4 H5 H6 P".split(" ").indexOf(d))return d=window.document.createElement("p"),a=window.document.createElement("br"),d.appendChild(a),a=b.parentNode.childNodes[l.getNodeOffset(b)+1],b.parentNode.insertBefore(d,a),g.selectNode(d),d;if(-1!==["LI"].indexOf(d)&&
a){d=window.document.createElement("p");a=window.document.createElement("br");d.appendChild(a);a=b.parentNode;if(c=b.nextSibling){for(e=a.cloneNode(!1);c=b.nextSibling;)e.appendChild(c);a.parentNode.insertBefore(e,a.nextSibling)}a.parentNode.insertBefore(d,a.nextSibling);g.selectNode(d);a.removeChild(b);0===a.childNodes.length&&a.parentNode.removeChild(a);return d}}}}};return a}();k.ReturnKeyMonitor=e})(m.monitoring||(m.monitoring={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.SelectionManager,p=function(){function a(e){var d;this.handleKeyUp=this.handleKeyUp.bind(this);this.handleMouseUp=this.handleMouseUp.bind(this);this.handleContextMenu=this.handleContextMenu.bind(this);this.handleMutation=this.handleMutation.bind(this);this.checkSelection=this.checkSelection.bind(this);this.checkSelectionDelayed=this.checkSelectionDelayed.bind(this);var b=this;this.handleMutation=function(){var d=arguments;b["__delayed_toh_SelectionMonitor.handleMutation__"]&&
clearTimeout(b["__delayed_toh_SelectionMonitor.handleMutation__"]);b["__delayed_toh_SelectionMonitor.handleMutation__"]=setTimeout(function(){a.prototype.handleMutation.apply(b,d);b["__delayed_toh_SelectionMonitor.handleMutation__"]=null},0)};this.checkSelectionDelayed=function(){var d=arguments;b["__delayed_toh_SelectionMonitor.checkSelectionDelayed__"]&&clearTimeout(b["__delayed_toh_SelectionMonitor.checkSelectionDelayed__"]);b["__delayed_toh_SelectionMonitor.checkSelectionDelayed__"]=setTimeout(function(){a.prototype.checkSelectionDelayed.apply(b,
d);b["__delayed_toh_SelectionMonitor.checkSelectionDelayed__"]=null},0)};if(d=function(a){this.connect(a)}.apply(d||this,arguments))return d}a.SelectionMonitor=a;a.prototype.connect=function(a){var d=$(document.documentElement);d.bind("keyup",this.handleKeyUp);d.bind("mouseup",this.handleMouseUp);d.bind("contextmenu",this.handleContextMenu);$(a).bind("DOMSubtreeModified",this.handleMutation)};a.prototype.disconnect=function(){};a.prototype.updateSelection=function(a){l.updateSelection(a)};a.prototype.handleKeyUp=
function(a){this.checkSelection()};a.prototype.handleMouseUp=function(a){this.checkSelectionDelayed()};a.prototype.handleContextMenu=function(a){this.checkSelection();this.checkSelectionDelayed()};a.prototype.handleMutation=function(a){this.updateSelection(!0)};a.prototype.checkSelection=function(){this.updateSelection()};a.prototype.checkSelectionDelayed=function(){this.checkSelection()};return a}();k.SelectionMonitor=p})(m.monitoring||(m.monitoring={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Events,p=a.client.model.Component,g=function(){function a(b,d){var e;this.initDocument=this.initDocument.bind(this);this.nodeRemoved=this.nodeRemoved.bind(this);if(e=function(a,b){this.node=a;this.editing=b;this.editingOnchange=this.editing.onchange(this.initDocument);l.register("NodeRemoved",this.nodeRemoved)}.apply(e||this,arguments))return e}a.findBlock=function(a){return $(a.__reactive&&a.__reactive.parentNode&&a.__reactive.parentNode.node).parents().addBack().filter(p.selectorFor("TextWidget",
".block-content"))};a.ensureEmptyLastParagraph=function(a){setTimeout(function(){g(a)})};a.addLastParagraph=function(a){l.ignoreMutations(function(){a.children().length||$("<p />").append("<br/>").appendTo(a)})};var d=a.findBlock,b=a.ensureEmptyLastParagraph,g=a.addLastParagraph;a.FinalEmptyParagraph=a;a.prototype.cleanup=function(){l.unregister("NodeRemoved",this.nodeRemoved);this.editingOnchange.unlink()};a.prototype.initDocument=function(a){this.editing.get()&&$(p.selectorFor("TextWidget",".block-content"),
this.node).each(function(a,d){b($(d))})};a.prototype.nodeRemoved=function(a){this.editing.get()&&a.target.__reactive&&(a=d(a.target),a.length&&b(a))};return a}();k.FinalEmptyParagraph=g})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.arrow.Arrow,g=a.arrow.Dom,e=a.reactive.Node,d=a.typlib.Objects,b=a.reactive.Functions,n=k.arr,r=k.id,h=k.constR,f=k.constL,c=k.zero,q=k.seq,m=k.sum,u=k.is,t=k.isTrue,v=k.ifA,x=k.ifR,w=k.ifRC,y=k.put,A=k.putWith,z=k.get,B=k.fromValue,D=k.run,F=g.mkText,C=g.text,E=g.setAttr,G=g.setAttrFromState,L=g.mkAnchor,N=g.mkSpanClass,k=function(){function a(c,b,d){var e;if(e=function(a,c,b){"bookmarklet"!=window.Silk.silkType&&(this.document=a.document,
this.stashed=a.stashed,this.repository=c,this.imagePath=b,this.node=null,this.setupNode(),this.createBreadCrumb())}.apply(e||this,arguments))return e}a.InPageBar=a;a.prototype.cleanup=function(){this.output&&this.output.cleanup();this.node.remove()};a.prototype.setupNode=function(){this.node=$($.parseHTML(Resource.InPageBar));$("#content").prepend(this.node)};a.prototype.createBreadCrumb=function(){var a=$("#breadcrumb",this.node)[0];$(a).empty();this.output=D(this.transformation(),null).name("ActionBar.output");
a=(new e(a)).childNodes;e.connectNodeLists(this.output,a)};a.prototype.transformation=function(){function a(c){return c.type&&"content"!==c.type||c.uri&&"home"!==c.uri.get()}var e=N("separator",c),g=u(a),l=x(function(c){return b.and(a(c),b.not(window.Silk.canvas.editFlags.editing))},q(L(C("Home")),E("href","/")),L(C("Home"))),k=q(L(C("Dashboard")),E("href","/dashboard")),l=v(function(a){return"dashboard"===a.type||"import"===a.type},k,l),k=q(g,n(function(a){return a.categoryTracking}),t,n(d.prop("asTag")),
B,A("name",d.prop("name")),A("link",d.prop("uri")),m(e,q(L(q(z("name"),F)),w(window.Silk.canvas.editFlags.editing,r,G("href","link"))))),e=q(g,n(function(a){return a.title}),B,y("title"),m(e,L(q(z("title"),F))));return q(h(this.document),t,m(l,k,q(f([this.stashed,this.document]),B,e)))};return a}();l.InPageBar=k})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Node,l=a.typlib.Arrays,p=a.typlib.Objects,g=function(){function a(d){var b;this.checkNode=this.checkNode.bind(this);var g=this;this.loop=function(){var b=arguments;setTimeout(function(){a.prototype.loop.apply(g,b)},500)};if(b=function(a){this.node=a;this.active=!1;this.start()}.apply(b||this,arguments))return b}a.Check=a;a.prototype.start=function(){this.active=!0;this.loop()};a.prototype.stop=function(){this.active=!1};a.prototype.loop=function(){this.active&&
window.SILK_DEBUGGING&&(this.check(),this.loop())};a.prototype.check=function(){this.checkNode(this.node)};a.prototype.checkNode=function(a){a=new k(a);var b=a.node;this.checkParent(a,b);this.checkChildren(a,b);this.checkAttributes(a,b);this.checkText(a,b)};a.prototype.checkParent=function(a,b){var e=b==this.node?!0:a.parentNode&&b.parentNode==a.parentNode.node;e||b.__reactiveParentInvalid===b.parentNode.nodeName?e&&b.__reactiveParentInvalid&&(console.warn("Parent and reactive parent equal again for:",
b),delete b.__reactiveParentInvalid):(console.warn("Parent and reactive parent not equal for:",b),b.__reactiveParentInvalid=b.parentNode.nodeName)};a.prototype.checkChildren=function(a,b){if(a.childNodes&&!a.nonReactiveChildren){var e=a.getShadowChildNodes(),g=l.slice(b.childNodes),h=l.equals(g,e);h||b.__reactiveChildrenInvalid===b.innerHTML?h&&b.__reactiveChildrenInvalid&&(console.warn("DOM and reactive DOM childNodes equal again for:",b),delete b.__reactiveChildrenInvalid):(console.warn("childNodes: %o and reactive childNodes: %o not equal for: %o.",
g,e,b),b.__reactiveChildrenInvalid=b.innerHTML);g.forEach(this.checkNode)}};a.prototype.checkAttributes=function(a,b){if(a.attributes){for(var e=a.getShadowAttributes(),g={},h=b.attributes,f=0;f<h.length;f++){var c=h[f];g[c.name]=c.value}h=!p.differ(g,e);h||b.__reactiveAttributesInvalid&&!p.differ(b.__reactiveAttributesInvalid,g)?h&&b.__reactiveAttributesInvalid&&(console.warn("Attributes and reactive attributes equal again for:",b),delete b.__reactiveAttributesInvalid):(console.warn("Attributes and reactive attributes not equal for:",
b,e,g),b.__reactiveAttributesInvalid=g)}};a.prototype.checkText=function(a,b){if(a.textContent){var e=""+a.textContent.get(),g=b.textContent;e!==g&&b.__reactiveTextInvalid!==b.textContent?(console.warn("Text content and reactive text content not equal for:",b,e,g),b.__reactiveTextInvalid=b.textContent):e===g&&b.__reactiveTextInvalid&&(console.warn("Text content and reactive text content equal again for:",b),delete b.__reactiveTextInvalid)}};return a}();m.Check=g})(a.reactive||(a.reactive={}))})(_||
(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.client.IntegrityMonitor,g=a.client.UndoManager,e=a.client.editing.Autosaver,d=a.client.editing.ConcurrentEditors,b=a.client.editing.Remover,n=a.client.editing.Saver,r=a.client.model.BlockInsertion,h=a.client.model.CategoryTracking,f=a.client.model.DirtyTracking,c=a.client.model.DocumentContext,q=a.client.model.DocumentTags,m=a.client.model.DocumentTitle,u=a.client.model.EventCoordinator,t=a.client.model.HeaderPromotion,v=a.client.model.InitialFocus,
x=a.client.model.PinnedComponents,w=a.client.model.Registry,y=a.client.model.Serializer,A=a.client.model.Statistics,z=a.client.model.TextSuggestion,B=a.client.model.WidgetDragging,D=a.client.model.WidgetEditing,F=a.client.model.newPage.NewPage,C=a.client.monitoring.PasteMonitor,E=a.client.monitoring.ReturnKeyMonitor,G=a.client.monitoring.SelectionMonitor,L=a.client.ui.FinalEmptyParagraph,N=a.client.ui.bars.InPageBar,H=a.reactive.Check,I=a.reactive.Functions,M=a.reactive.Node,S=a.reactive.Value,P=
a.typlib.CleanupPool,J=function(){function a(l,M,J,K,O,Q,W){var V;if(V=function(a,l,W,Q,M,J,V){this.pool=new P;this.type="content";this.uri=(new S(a)).name("ContentDocument.uri");this.title=(new S).name("ContentDocument.title");this.root=$(l)[0];this.editing=(new S(J||!1)).name("ContentDocument.editing");"article"===this.root.nodeName.toLowerCase()&&(this.root=$("<div data-article='' />").html($(this.root).children())[0]);this.fixArticleAttributes(l);this.isNew=(new S(void 0!==l.attr("data-new"))).name("ContentDocument.isNew");
this.isEmpty=(new S(void 0!==l.attr("data-empty"))).name("ContentDocument.isEmpty");l=new S(F.isNewPageUri(this.uri.get()));this.hasNewUri=I.and(this.isNew,l).name("ContentDocument.hasNewUri");this.activeComponent=(new S).name("ContentDocument.activeComponent");this.isBeingModified=(new S(!1)).name("ContentDocument.isBeingModified");this.pool.push(this.uri,this.title,this.editing,this.isNew,this.isEmpty,this.hasNewUri,this.activeComponent,this.isBeingModified);this.pool.push(this.categoryTracking=
new h(this.root,Q),this.documentTags=new q(this,Q),this.integrityMonitor=new k(this),this.serializer=new y(this.root),this.remover=new b(this),this.pinnedComponents=new x(this,V,W.domain.api.Pin),this.undoManager=new g(this),this.dirtyTracking=new f(this.undoManager),this.saver=new n(this.uri,this.isNew,this.isBeingModified,this.serializer,this.pinnedComponents,this.integrityMonitor,this.dirtyTracking),this.context=new c(this.root,this.editing,W.root),this.concurrentEditors=new d(a,this.editing),
this.autosaver=new e(this,this.dirtyTracking,this.editing),this.documentTitle=new m(this,this.editing),this.headerPromotion=new t(this.editing,this),this.textSuggestion=new z(this.editing,this),this.initialFocus=new v(this.root,this.editing),this.checker=new H(this.root),this.finalEmptyParagraph=new L(this.root,this.editing),this.pasteMonitor=new C(this.root),this.returnKeyMonitor=new E(this.root),this.selectionMonitor=new G(this.root),this.registry=new w(W,this,this.root),this.eventCoordinator=new u(this.undoManager,
this.registry),this.blockInsertion=new r(this,W,this.editing),this.statistics=new A(Q,M,this.saver,this.remover),this.widgetEditing=new D(this.activeComponent,W),this.inPageBar=new N(W,W.domain.repository,window.Silk.paths.imagePath),this.widgetDragging=new B(this),this.setupDirtyTrackingWithSaver())}.apply(V||this,arguments))return V}a.ContentDocument=a;a.prototype.cleanup=function(){this.pool.cleanup();(new M(this.root)).cleanup(!0)};a.prototype.setupDirtyTrackingWithSaver=function(){f.listenToSaver(this.saver,
this.dirtyTracking);return function(){f.stopListeningToSaver(this.saver)}.bind(this)};a.prototype.fixArticleAttributes=function(a){$(this.root).attr("data-article","");$(this.root).attr("data-tag-context",a.attr("data-tag-context"));$(this.root).attr("data-tag-uri",a.attr("data-tag-uri"));$(this.root).attr("data-tag-title",a.attr("data-tag-title"));$(this.root).attr("data-empty",a.attr("data-empty"));$(this.root).attr("data-format","1")};return a}();l.ContentDocument=J})(k.document||(k.document={}))})(m.model||
(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.document.ContentDocument,m=a.client.model.newPage.NewPage,g=function(){function a(d,b,e){var g;this.tryAddPage=this.tryAddPage.bind(this);this.addPage=this.addPage.bind(this);this.clearAddPageError=this.clearAddPageError.bind(this);this.savingDone=this.savingDone.bind(this);this.savingFailed=this.savingFailed.bind(this);if(g=function(a,b,c){this.parent=b;this.form=$(a);this.rTag=c;this.inputField=null;this.form.toggleClass("no-collection",
!c)}.apply(g||this,arguments))return g}a.AppendUI=a;a.prototype.install=function(){this.form.on("submit",this.tryAddPage);this.inputField=$("input[type=text]",this.form);this.inputField.on("input",this.clearAddPageError)};a.prototype.tryAddPage=function(a){a.preventDefault();a.stopPropagation();this.form.hasClass("loading")||(this.clearAddPageError(),a=this.inputField.val(),this.disableForm(),m.validatePageTitle(a,function(a,d){this.inputField.focus();this.addPage(a,this.rTag&&this.rTag.get().uri,
d)}.bind(this),function(a){this.enableForm();this.setAddPageError(m.pageUriErrors(a))}.bind(this)))};a.prototype.addPage=function(a,b,e){function g(a){return function(b){a(h);h.cleanup();f.enableForm()}}var h=new l(a,m.createNewEmptyPage(a,b,e),window.Silk.canvas,window.Silk.domain.tagList,window.Silk.domain.repository),f=this;h.saver.save(!1,g(this.savingDone),g(this.savingFailed),!0,!0)};a.prototype.setAddPageError=function(a,b){$(".form-error",this.form).text(a);$(this.form).addClass("has-error");
b&&this.enableForm()};a.prototype.clearAddPageError=function(){this.setAddPageError("");$(this.form).removeClass("has-error")};a.prototype.enableForm=function(){this.form.removeClass("loading");$("input",this.form).prop("disabled",!1)};a.prototype.disableForm=function(){this.form.addClass("loading");$("input",this.form).prop("disabled",!0)};a.prototype.hide=function(){this.form.hide()};a.prototype.show=function(){this.form.css("display","")};a.prototype.savingDone=function(a){this.parent.addedPage(a.uri.get(),
a.title.get());this.enableForm();this.inputField.val("")};a.prototype.savingFailed=function(a){this.setAddPageError("There was an error creating the page '"+a.uri.get()+"'.",!0)};return a}();k.AppendUI=g})(m.tagoverview||(m.tagoverview={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Component,m=function(){function a(d,b){var e;this.addRow=this.addRow.bind(this);this.openDeleteBox=this.openDeleteBox.bind(this);var k=this;this.showSpinner=function(){var b=arguments;setTimeout(function(){a.prototype.showSpinner.apply(k,b)},1E3)};if(e=function(a,b){this.table=this.node=null;this.showDeleteUI=b;l.linkToNode(this,a);this.node.addClass("table")}.apply(e||this,arguments))return e}a.relativeTime=function(a){return window.vagueTime.get({to:a,
from:Date.now(),units:"ms"})};var e=a.relativeTime;a.PageSectionList=a;a.prototype.cleanup=function(){};a.prototype.calculateTableHeight=function(a){return 28*a-1+"px"};a.prototype.showPlaceholder=function(a){$(".loading",this.node).css("height",this.calculateTableHeight(a));this.showSpinner()};a.prototype.showSpinner=function(){$(".loading .indicator",this.node).addClass("visible")};a.prototype.renderTable=function(a){var b=this.table=$("<table class=line-separated />");$(this.node).html(b);a.forEach(this.addRow);
setTimeout(function(){b.addClass("visible")},0)};a.prototype.addRow=function(a,b){var g=$("<tr />");!0===b?g.prependTo($("table",this.node)):g.appendTo($("table",this.node));var l=$("<td class=page-name />").appendTo(g);$("<a />").attr("href",a.href).text(a.document).appendTo(l);var h=[];a.isHome&&h.push("homepage");a.isNew&&h.push("new");h.length&&l.append($("<a/>").addClass("table-row-action").text("("+h.join(", ")+")"));$("<td class=mod-date />").text(e(a.date)).appendTo(g);if(a.deletion)(l=this.mkDeleteUI())&&
l.click(this.openDeleteBox.bind(this,a,g)).appendTo(g);else debugger};a.prototype.mkDeleteUI=function(){var a=$("<a class=cross />"),b=$("<span class=message>Sure?</span>"),e=$("<a class=ok>Delete</a>"),g=$("<a class=cancel>Cancel</a>");return $("<td class=delete />").append(b,e,g,a)};a.prototype.openDeleteBox=function(a,b){function e(b){h.removeClass("deleting");g.find(".ok").off("click",a.ok);g.find(".cancel").off("click",e);b.stopPropagation()}if(!this.table.hasClass("deleting")){var g=b.find("td.delete"),
h=this.table.add(b).add(g);h.addClass("deleting");g.find(".message").text("Delete "+a.type+"?");g.find(".ok").on("click",function(f){a.deletion(a,b,function(){e(f);b.remove()})});g.find(".cancel").on("click",e)}};return a}();k.PageSectionList=m})(m.tagoverview||(m.tagoverview={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.ui.input.Inputbox,m=a.typlib.Strings,g=a.typlib.Tracking,e=a.reactive.Value,d=function(){function a(b,d,g){var f;this.toggleRename=this.toggleRename.bind(this);this.startRename=this.startRename.bind(this);this.confirmRename=this.confirmRename.bind(this);this.cancelRename=this.cancelRename.bind(this);if(f=function(a,b,d){this.tag=a;this.tagName=(new e(a.name)).name("TagRenamer.tagName");this.node=$(b);this.prefix=d;this.renaming=(new e(!1)).name("TagRenamer.renaming");
this.setup()}.apply(f||this,arguments))return f}a.TagRenamer=a;a.prototype.cleanup=function(){this.tagName.cleanup();this.renaming.cleanup()};a.prototype.setup=function(){this.node.addClass("tag-renamer-text");this.root=this.node.wrap("<div class=tag-renamer></div>").parent();this.renameInput=new l(this.node,{activateEvent:"dblclick"});$(this.renameInput).on("edit",this.startRename).on("commit",this.confirmRename).on("cancel",this.cancelRename)};a.prototype.toggleRename=function(){this.root.hasClass("renaming")?
this.renameInput.commit():this.renameInput.open()};a.prototype.startRename=function(){$(this.root).addClass("renaming");this.renaming.set(!0);this.track("rename-show-UI")};a.prototype.confirmRename=function(a){$(this.root).removeClass("renaming");this.renaming.set(!1);var b=this.tag.get();a=a.value;m.isWhitespace(a)||b.name===a?(this.track("rename-cancel"),this.node.text(b.name)):(b.setName(a),b.save(),this.tagName.set(a),this.track("renamed"))};a.prototype.cancelRename=function(){$(this.root).removeClass("renaming");
this.renaming.set(!1);this.track("rename-cancel")};a.prototype.track=function(a){g.trackWithMode(this.prefix+"-"+a,{component:"tag-renamer"})};a.prototype.root=void 0;a.prototype.renameInput=void 0;return a}();k.TagRenamer=d})(m.tagoverview||(m.tagoverview={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.editing.CollectionRemover,m=a.client.model.Component,g=a.client.query.Query,e=a.client.query.Print,d=a.component.tagoverview.AppendUI,b=a.component.tagoverview.PageSectionList,n=a.component.tagoverview.TagRenamer,r=a.domain.typing.Value,h=a.reactive.Functions,f=a.reactive.Value,c=a.silk.nav.NavLinks,q=a.typlib.Functions,s=a.typlib.Objects,u=a.typlib.Strings,t=a.typlib.Tracking,v=function(){function a(c,b,d,e,g){var h;this.addedPage=this.addedPage.bind(this);
this.fetchDocumentsFail=this.fetchDocumentsFail.bind(this);this.fetchDocumentsDone=this.fetchDocumentsDone.bind(this);this.fetchAutosaves=this.fetchAutosaves.bind(this);this.autosavesDone=this.autosavesDone.bind(this);this.deletePage=this.deletePage.bind(this);this.autosavesFail=this.autosavesFail.bind(this);this.removeEmptyTagOrConfirm=this.removeEmptyTagOrConfirm.bind(this);this.removeTag=this.removeTag.bind(this);this.abortRemoveTag=this.abortRemoveTag.bind(this);this.remove=this.remove.bind(this);
this.removeFailed=this.removeFailed.bind(this);this.removeNode=this.removeNode.bind(this);if(h=function(a,c,b,d,e){m.linkToNode(this,a);this.canvas=b;this.domain=b.domain;this.document=c;this.data=d;this.repository=b.domain.repository;this.mode=d.mode;this.isInteractive=d.isInteractive;this.showDeleteUI=d.showDeleteUI;this.sectionHasTags=d.hasTags;this.size=(new f).name("PageSection.size");this.deleteStatus=(new f("")).name("PageSection.deleteStatus");this.displayedPages=new f(0);this.otherCount=
this.draftCount=this.tag=null;this.setupRendering();switch(this.mode){case "with-collection":this.setupWithCollection();break;case "no-collection":this.setupNoCollection();break;case "unsaved-drafts":this.setupDrafts();break;default:console.warn("PageSection: unknown mode:",this.mode)}this.setupInteraction()}.apply(h||this,arguments))return h}a.parseDate=function(a){a=a.split(/[ \-:.]/).slice(0,7).map(function(a){return parseInt(a,10)});a[6]=a[6]?Math.floor(parseInt(a[6])/1E3):0;a[1]-=1;return Date.UTC.apply(Date,
a)};var k=a.parseDate;a.PageSection=a;a.prototype.cleanup=function(){this.deleteStatus.unlink()};a.prototype.setupWithCollection=function(){this.tag=this.domain.tagList.findByUriR(this.data.tagUri);this.remover=new l(this.tag,this.repository);this.renderWithCollection();this.fetchDocuments(this.tag.get())};a.prototype.setupNoCollection=function(){this.renderNoCollection();this.fetchDocuments()};a.prototype.setupDrafts=function(){this.node.hide();this.renderDrafts();this.domain.repository.documents.onchange(this.fetchAutosaves)};
a.prototype.setupRendering=function(){$(this.node).append(Resource.PageSection);$(this.node).addClass(this.mode);this.list=new b($(".table",this.node),this.showDeleteUI)};a.prototype.renderWithCollection=function(){this.displayedPages.set(Math.min(10,this.tag.get().docLevelCount.get()));this.list.showPlaceholder(this.displayedPages.get());$(this.node).toggleClass("appendable",this.isInteractive);$("h2",this.node).rText(this.tag.map(s.prop("name")));$(".tag-link",this.node).rToggleDisplay(h.lt(0,this.tag.bindProp("docLevelCount"))).rAttr("href",
this.tag.map(function(a){return a?c.exploreCollection(a.uri):"/"}));$(".tag-empty",this.node).rToggleDisplay(h.eq(0,this.tag.bindProp("docLevelCount")));this.renderCount(this.tag.bind(s.prop("docLevelCount")),function(a){return $($.parseHTML(u.pluralizer("page")(a)+" in<br>this collection"))})};a.prototype.renderNoCollection=function(){$("h2",this.node).html(this.sectionHasTags?"Other pages":"Pages");this.otherCount=this.domain.tagList.pagesWithoutCollection.count;this.renderCount(this.otherCount,
function(a){a=u.pluralizer("page")(a);return $($.parseHTML(this.sectionHasTags?"other<br>"+a:a+"<br>&nbsp;"))}.bind(this))};a.prototype.renderDrafts=function(){$("h2",this.node).html("Your drafts");this.draftCount=(new f(0)).name("PageSection.draftCount");this.renderCount(this.draftCount,function(a){return $($.parseHTML("unsaved<br>"+u.pluralizer("draft")(a)))})};a.prototype.renderCount=function(a,b){var d=a.map(function(a){return 1E4<a?Math.floor(a/1E3)+"k":a});$(".page-count .counter",this.node).rText(d);
$(".page-count .description",this.node).rHtml(a.map(b));$(this.node).rToggleClass("is-empty",a.map(function(a){return 0===a}));if(this.tag){var e=this.tag.map(function(a){return a?c.exploreCollection(a.uri):"/"}),d=f.lift(function(a,c){return a-c})(a,this.displayedPages);this.node.find(".more-pages").rToggleClass("visible",d.map(function(a){return 0<a}));this.node.find(".more-pages .num-pages").rText(d);this.node.find(".explore-more").rAttr("href",e);this.node.find(".page-count .counter").addClass("clickable").click(function(){e.onchange(function(a){window.location=
a})})}};a.prototype.calculateTableHeight=function(){return this.list.calculateTableHeight()};a.prototype.renderTable=function(a){this.list.renderTable(a)};a.prototype.addedPage=function(a,c){this.displayedPages.modify(function(a){return a+1});this.list.addRow({href:"/page/"+encodeURIComponent(a),type:"page",document:c,date:Date.now(),uri:a,deletion:this.deletePage},!0);if(this.tag&&this.tag.get()){var b=this.tag.get().docLevelCount;b.set(b.get()+1)}t.trackWithMode("document-created",{component:"tag-overview",
uri:a});window.Silk.vog.event("document-created")};a.prototype.renderError=function(a,c){console.log("PageSection: Error fetching documents: %o",c);var b=$("<div />").addClass("error").text(a);b.css("height",this.calculateTableHeight());$(".table",this.node).html(b)};a.prototype.fetchDocuments=function(a){a=a?"type "+e.encodeUri(a.uri):"no type";g.adhocQuery(" from all documents where (document has "+e.encodeUri(a)+") select document name and modification date order descending by modification date slice from 0 to 9",
this.fetchDocumentsDone).error.onchange(this.fetchDocumentsFail)};a.prototype.fetchDocumentsFail=function(){this.size.set(0);this.renderTable([])};a.prototype.fetchDocumentsDone=function(a){if(!a)return this.fetchDocumentsFail();var c=$(a).attr("data-slice").split(",")[2];if(-1===c.indexOf("+"))switch(this.mode){case "with-collection":this.tag.get().docLevelCount.set(+c);break;case "no-collection":this.otherCount.set(+c);break;case "unsaved-drafts":console.error("PageSection: should never enter fetchDocumentsDone in draft mode.")}a=
$("tbody tr",a).get().map(function(a){var c=$("td:first-child a:first-child",a);return{document:"/page/home"==c.attr("href").toLowerCase()?"Homepage":c.text(),uri:r.parseDocumentHref(c.attr("href")),date:k($("td",a).eq(1).find("a").eq(0).text()),href:c.attr("href")||"",type:"page",deletion:this.deletePage}}.bind(this));this.size.set(a.length);this.renderTable(a)};a.prototype.fetchAutosaves=function(){window.Silk.api.User.current().Autosave.list(this.autosavesDone,this.autosavesFail)};a.prototype.autosavesDone=
function(a){if(!a||!a.items)return this.closeSection();var c=this.domain.repository.uri.get();a=a.items.filter(function(a){return!(a.stub&&("(untitled)"==a.title.toLowerCase()||u.isWhitespace(a.title)))&&a.repository==c}).sort(q.flip(q.comparing(s.prop("modified")))).map(function(a){return{document:a.documentTitle||a.title,date:k(a.modified),uri:a.document,href:"/page/"+a.document,isNew:!!a.stub,isHome:"home"==a.document,type:"draft",deletion:this.deletePage}}.bind(this));this.size.set(a.length);
a.length?(this.draftCount.set(a.length),this.renderTable(a),6<a.length&&this.renderCollapsedDrafts(a.length),this.node.show()):this.closeSection()};a.prototype.renderCollapsedDrafts=function(a){this.node.find(".header").add(this.node.find(".table"));this.node.find(".table tr").slice(4).hide();var c=$("<a/>").addClass("show-drafts").text("Show all"),b=$("<div/>").append("You have "+(a-4)+" more unsaved drafts. ",c);c.click(function(){this.node.find(".table tr").show();b.hide();this.node.removeClass("collapsed-drafts")}.bind(this));
this.node.append(b).addClass("collapsed-drafts")};a.prototype.deletePage=function(a,c,b){"draft"==a.type&&window.Silk.api.Page(a.uri).Autosave.current().remove(void 0,void 0,void 0,{ignoreErrors:[404]}).done(function(){this.draftCount.set(this.draftCount.get()-1);0==this.draftCount.get()&&this.closeSection();b()}.bind(this));"page"==a.type&&window.Silk.api.Page(a.uri).remove(function(){this.displayedPages.modify(function(a){return a-1});b()}.bind(this),void 0,void 0,{ignoreErrors:[404]}).done(function(){var a=
this.domain.repository.documents;a.set(a.get()-1);(a=this.tag&&this.tag.get())?a.docLevelCount.modify(q.subtract(1)):(this.otherCount.modify(q.subtract(1)),0==this.otherCount.get()&&this.closeSection());b()}.bind(this))};a.prototype.autosavesFail=function(a){this.renderError("There was an error retrieving the drafts.",a)};a.prototype.setupInteraction=function(){$(this.node).toggleClass("interactive",this.isInteractive).rAddClass(this.deleteStatus);this.isInteractive?(this.appendUI=new d($("form",
this.node),this,this.tag),this.appendUI.install(),this.setupTagRenamer()):$("form",this.node).remove();if(this.showDeleteUI){$(".delete",this.node).click(this.removeEmptyTagOrConfirm);$(".delete-confirm .ok",this.node).click(this.removeTag);$(".delete-confirm .cancel",this.node).click(this.abortRemoveTag);var a=$(".delete-failed .feedback-link")[0];a&&(a.href=c.getWebURI("/feedback"))}else $(".delete",this.node).remove()};a.prototype.setupTagRenamer=function(){if("with-collection"==this.mode){var a=
new n(this.tag,$("h2",this.node),"page-section");$("<div class=rename />").attr("title","Rename collection").appendTo(a.root).click(a.toggleRename)}};a.prototype.closeSection=function(){this.node.slideUp(200,this.removeNode)};a.prototype.removeEmptyTagOrConfirm=function(a){if(a=this.tag.get())0<a.docLevelCount.get()?(this.deleteStatus.set("deleting"),t.trackWithMode("collection-delete-show-UI",{component:"tag-overview"})):this.removeTag()};a.prototype.removeTag=function(){var a=this.tag.get();a&&
(a=a.docLevelCount.get(),this.deleteStatus.set("delete-working"),this.remover.remove().done(this.remove).fail(this.removeFailed),t.trackWithMode("collection-deleted",{component:"tag-overview",pagesInCollection:a}))};a.prototype.abortRemoveTag=function(a){this.deleteStatus.set("");t.trackWithMode("collection-delete-cancel",{component:"tag-overview"})};a.prototype.remove=function(){this.triggerRemoveEvent();this.closeSection()};a.prototype.removeFailed=function(){this.deleteStatus.set("delete-failed");
t.trackWithMode("collection-delete-failed",{component:"tag-overview"})};a.prototype.removeNode=function(){this.cleanup();this.node.remove()};a.prototype.triggerRemoveEvent=function(){var a=$.Event("remove");$(this).triggerHandler(a)};a.prototype.node=void 0;a.prototype.remover=void 0;a.prototype.list=void 0;a.prototype.appendUI=void 0;return a}();k.PageSection=v})(m.tagoverview||(m.tagoverview={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.vaguerTime=function(a){var e=k.times;a=Date.now()-a.getTime();return 2<=a/e.year?[14,"in the last years"]:0.9<=a/e.year?[13,"last year"]:3<=a/e.month?[12,"this year"]:1.5<=a/e.month?[11,"in the last months"]:0.9<=a/e.month?[10,"last month"]:7<=a/e.day?[9,"this month"]:2<=a/e.day?[8,"this week"]:0.9<=a/e.day?[7,"yesterday"]:2<=a/e.hour?[6,"today"]:0.9<=a/e.hour?[5,"in the last hour"]:15<=a/e.minute?[4,"this hour"]:2<=a/e.minute?[3,"in the last minutes"]:
0.9<=a/e.minute?[2,"last minute"]:15<=a/e.second?[1,"this minute"]:[0,"in the last few seconds"]};a.ago=function(a){return new Date(Date.now()-a)};a.times={year:315576E5,month:26298E5,week:6048E5,day:864E5,hour:36E5,minute:6E4,second:1E3};var k=a;return a}();a.VaguerTime=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.silk.nav.NavLinks,m=a.silk.nav.NavQuery,g=a.typlib.Arrays,e=a.typlib.Functions,d=a.typlib.Objects,b=a.typlib.Strings,n=a.typlib.VaguerTime,r=a.reactive.Functions.or,h=function(){function a(){}a.renderUserList=function(a,c){c.items.map(function(c){a.append(O($("<li/>"),h(c,!0)))})};a.renderRepoList=function(a,c,b,e){a=$(a);a.addClass("feed");a.delegate(".expand","click",function(a){var c=$(a.target).siblings().filter(function(a,c){return $(c).hasClass("subevents")});
"none"==c.css("display")?($(a.target).text("hide"),c.show()):($(a.target).text("expand"),c.hide())});C(10,a,c.items.slice(0,b),function(a){var c=$("<div/>").addClass("feeditem"),b=d.values(a)[0].modifiedTime;return O(h(c,a),ca(b))},e)};a.recentChanges=function(a){function c(a){return new Date(d.values(a)[0].createdTime)}var b=n.vaguerTime(c(g.last(a.items.slice(0,10))));return a.items.reduce(function(a,d){return n.vaguerTime(c(d))[0]<=b[0]?a+1:a},0)+" events occurred "+b[1]};a.f=function(a,c){if(c.document)return k(a,
c.document);if(c.import)return u(a,c.import);if(c.invite)return t(a,c.invite);if(c.multiDocument)return v(a,c.multiDocument);if(c.permission)return x(a,c.permission);if(c.siteCreation)return w(a,c.siteCreation);if(c.siteName)return y(a,c.siteName);if(c.sitePrivacy)return A(a,c.sitePrivacy);if(c.siteWipe)return z(a,c.siteWipe);if(c.subscription)return B(a,c.subscription);console.warn("f: missing event handling for",c)};a.documentEvent=function(a,b,d){var f=e.partial(c.pageLink,b.effect,b.documentName),
h=function(){if(d)return"home"==b.documentName?f("homepage"):b.diff.title.updated?[" renamed to ",f(E(b.diff.title))," from ",K(b.diff.title.updated.old)]:f(E(b.diff.title));var a=function(){var a=b.diff.collection;if(a.same||a.empty)return[""];if(a.added&&"created"==b.effect)return[" created in ",I(a.added)," "];if(a.added)return[" and added to ",I(a.added)," "];if(a.removed&&"deleted"==b.effect)return[""];if(a.removed)return[" removed from ",I(a.removed)," "];if(a.updated)return[" was moved to ",
I(a.updated["new"])," from ",I(a.updated.old)," "];console.warn("Unhandled diff collection",b.diff.collection,b)}();return"home"==b.documentName?["The ",f("homepage")," was ",D(b.effect),a," by ",b.actor]:b.diff.title.updated?[f(E(b.diff.title))," was renamed from ",K(b.diff.title.updated.old),a," by ",b.actor]:[f(E(b.diff.title))," was ",g.equals(a,[""])?D(b.effect):a," by ",b.actor]}();return O(a.addClass("document"),[h,N(b.diff)])};a.importEvent=function(a,c){var b;c.collectionUri?(b=Silk.domain.tagList.findByUriOrCreate(c.collectionUri,
!0).name,b=[c.pages," pages were imported to the collection ",b," by ",c.actor]):b=[c.pages," pages were imported by ",c.actor];return O(a.addClass("import"),b)};a.inviteEvent=function(a,c){var b=function(){if("inviteAccepted"==c.effect)return[K(c.actor)," joined the site as ",J(c.newState)," ",K(c.newState)];if("inviteSent"==c.effect)return[K(c.recipientEmail)," was invited as ",J(c.newRole)," ",K(c.newRole)," by ",c.actor];if("inviteDeleted"==c.effect)return["The invite for ",K(c.recipientEmail),
" was deleted by ",c.actor];if("inviteUpdated"==c.effect)return[K(c.recipientEmail),"'s invite ",S(c.oldRole,c.newRole)," by ",c.actor];if("inviteResent"==c.effect)return[K(c.recipientEmail)," was reinvited by ",c.actor];"inviteEmpty"==c.effect?console.warn("empty invite should have been discarded"):console.warn("InviteEvent: unhandled event: ",c.effect,c)}();return O(a.addClass("invite"),b)};a.multiDocumentEvent=function(a,c){return O(a.addClass("document-multi"),[K(c.documents[0].actor)," ",D(c.documents[0].effect),
" ",c.documents.length," pages",$("<a/>").addClass("expand").text("expand"),F(c.documents)])};a.permissionEvent=function(a,c){var b="none"==c.newRole?c.actor==c.recipient?[K(c.recipient)," left the site"]:[K(c.recipient)," was removed from the site by ",c.actor]:c.recipient==c.actor&&"none"==c.oldRole?[K(c.recipient)," joined the site as ",J(c.newRole)," ",K(c.newRole)]:[K(c.recipient)," ",S(c.oldRole,c.newRole)," by ",c.actor];return O(a.addClass("permission"),b)};a.siteCreationEvent=function(a,
c){return O(a.addClass("site-name"),["The site ",K(c.name)," was created by ",c.actor])};a.siteNameEvent=function(a,c){return O(a.addClass("site-name"),["The site name was changed to ",K(c.newName)," from ",c.oldName," by ",c.actor])};a.sitePrivacyEvent=function(a,c){return O(a.addClass("site-privacy"),["The site's privacy was changed to ",K(da(c.newPrivacy))," from ",da(c.oldPrivacy)," by ",c.actor])};a.siteWipeEvent=function(a,c){return O(a.addClass("site-wipe"),["The site was wiped by ",c.actor])};
a.subscriptionEvent=function(a,c){K(c.actor);var b=O,d=a.addClass("subscription"),e=K(c.actor),f;"subscribed"==c.effect?f=" is now following the site":"unsubscribed"==c.effect?f=" is no longer following the site":(console.warn("missing event handling for subscription effect: ",c.effect,c),f=void 0);return b(d,[e,f])};a.documentEventEffect=function(a){if("updated"==a)return"updated";if("created"==a)return"created";if("deleted"==a)return"deleted";if("restored"==a)return"restored";console.warn("DocumentEvent: unhandled effect ",
a);return"unhandled"};a.pageLink=function(a,c,d){return"deleted"==a?X(b.truncate(c,40)):aa(l.createForPage(c),b.truncate(d,40))};a.expandEvents=function(a){var c=$("<div/>").addClass("subevents").css("display","none"),b=$("<img src='"+(window.Silk.paths.imagePath+"/ajax-loader.gif")+"'>").addClass("spinner").appendTo(c);C(1,c,a,function(a){return k($("<li/>"),a,!0)},function(){b.remove()});return c};a.appendMappedWithYielding=function(a,c,b,d,e){function f(){for(var l=0;l<a&&h<=g;l++,h++)c.append(d(b[h]));
h<=g?setTimeout(f):e&&e()}var h=0,g=b.length-1;setTimeout(f)};a.titleDiffName=function(a){var c;a.updated?c=a.updated["new"]:a.same?c=a.same:a.removed?c=a.removed:a.added?c=a.added:console.warn("titleDiffName: unhandled case: ",a);return c};a.groupTagDiffs=function(a){var c={updated:{},removed:{},added:{},empty:{},same:{}};d.keyValues(a).forEach(function(a){var b=a[0];a=a[1];a.updated?c.updated[b]=a.updated:a.removed?c.removed[b]=a.removed:a.added?c.added[b]=a.added:a.same||a.empty||console.warn("groupTagDiffs: Missing case for ",
b,a)});return c};a.tagTemplate=function(a,c,b,d,e){function f(a){return $("<li/>").text(I(a))}function h(a,c,b){return 0===c.length?null:0===b.length?a.attr("colspan","3"):a}var g=$("<td/>").addClass("icon");a?g.addClass("first").append($("<div/>").addClass("text").text(H(c))):g.addClass("sub");c=$("<td/>").addClass("color").addClass(c);var l=$("<td/>").addClass("prevlabel");a&&0<e.length&&l.append($("<div/>").addClass("has-text").text("from"));var n=1<d.length?O($("<ul/>").addClass("list"),d.map(f)):
1==d.length?O($("<div/>").addClass("single"),I(d[0])):null,k=1<e.length?O($("<ul/>").addClass("list"),e.map(f)):1==e.length?O($("<div/>").addClass("single"),I(e[0])):null,q=$("<tr/>").addClass("row");a&&q.addClass("first");return O(q,[g,c,$("<td/>").addClass("key").html(b),h($("<td/>").addClass("newval").html(n),d,e),d.length&&e.length?l:null,h($("<td/>").addClass("oldval").html(k),e,d)])};a.diff=function(a){if(!a)return $();var c=$("<table/>").addClass("keyvalue");a=d.filter(function(a){return 0<
d.size(a)},G(a.tags));var b=!0;a=g.sortByComparing(d.keyValues(a),function(a){var c=-1,c="added"==a[0]?0:"updated"==a[0]?1:"removed"==a[0]?2:-1,b=-1,b=(a=window.Silk.domain.tagList.findByUri(d.keys(a[1])[0]))?a.index:-1;return[c,b]}).map(function(a){var c=a[0],e=a[1];a=$("<tbody/>").addClass("group").addClass(c);b&&(b=!1,a.addClass("first"));var f=!0,e=d.keyValues(e).filter(function(a){return a[1]instanceof Array&&g.any(function(a){return a},a[1])||"string"==typeof a[1]||"new"in a[1]&&"old"in a[1]}).map(function(a){function c(a){return!!a}
return a&&a[1]&&a[1].old?[a[0],{"new":a[1]["new"].filter(c),old:a[1].old.filter(c)}]:a}).filter(function(a){return!(a&&a[1]&&a[1].old&&0===a[1]["new"].length&&0===a[1].old.length)}).map(function(a){var b=a[0],d;a[1]["new"]&&a[1].old?(d=a[1].old||[],a=a[1]["new"]||[]):(a=[].concat(a[1]),d=[]);var e=!1;f&&(e=!0,f=!1);a=a.filter(function(a){return!!a});d=d.filter(function(a){return!!a});return L(e,c,I(b),a,d)});return O(a,e)});return c.append(a)};a.groupText=function(a){if("updated"==a)return"Changed";
if("added"==a)return"New";if("removed"==a)return"Removed";console.warn("groupText: unhandled case: ",a);return"unhandled"};a.linkTagMay=function(a){if(!/^\/tag\/[^\/]+$/.test(a))return b.trim(a);var c=window.Silk.domain.tagList.findByUri(a);return c?(a=l.createForExplore(m.makeTagQueryLink(c,c.context.keys(),void 0,null,!1)),aa(a,b.trim(c.name))):(c=window.Silk.domain.tagList.findByUriOrCreate(a,!0))?b.trim(c.name):b.trim(a)};a.time=function(a){return window.vagueTime.get({from:new Date,to:new Date(a)})};
a.promdemS=function(a,c){return"none"==a?["was made ",J(c)," ",K(c)]:["was ",P(a,c)," to ",K(c)," from ",a]};a.promdem=function(a,c){return"none"==a||"administrator"==c||"editor"==c&&"viewer"==a?"promoted":"demoted"};a.plural=function(a){return/^[aoeuiy]/i.test(a)?"an":"a"};a.b=function(a){return $("<strong/>").text(a)};a.i=function(a){return $("<em/>").text(a)};a.t=function(a){return $(document.createTextNode(a))};a.ahttp=function(a,c){return aa("http://"+a,c||a)};a.a=function(a,c){return $("<a/>").attr("href",
a).text(c||a)};a.mkTimestamp=function(a){return $("<div/>").addClass("timestamp").text(M(a))};a.privacyText=function(a){if(a.publiclyEditable)return"publicly editable";if(a["private"])return"private";if(a["public"])return"public";if(a.other)return"a custom privacy";console.warn("unhandled privacy",a)};a.countDocumentEvents=function(a){var c=0;a.items.forEach(function(a){a.document&&c++;a.multiDocument&&(c+=a.multiDocument.documents.length)});return c};a.unwrapMultiDocuments=function(a){var c={offset:a.offset,
count:a.count,items:[]};a.items.forEach(function(a){a.multiDocument?a.multiDocument.documents.forEach(function(a){c.items.push({document:a})}):c.items.push(a)});return c};a.canView=function(){return r(window.Silk.domain.user.globalAdmin,window.Silk.domain.user.canRead.get())};a.append=function(a,c){return a.append(g.flatten(c).map(function(a){return"string"===typeof a?document.createTextNode(a):a}))};var c=a,h=a.f,k=a.documentEvent,u=a.importEvent,t=a.inviteEvent,v=a.multiDocumentEvent,x=a.permissionEvent,
w=a.siteCreationEvent,y=a.siteNameEvent,A=a.sitePrivacyEvent,z=a.siteWipeEvent,B=a.subscriptionEvent,D=a.documentEventEffect,F=a.expandEvents,C=a.appendMappedWithYielding,E=a.titleDiffName,G=a.groupTagDiffs,L=a.tagTemplate,N=a.diff,H=a.groupText,I=a.linkTagMay,M=a.time,S=a.promdemS,P=a.promdem,J=a.plural,K=a.b,X=a.i,aa=a.a,ca=a.mkTimestamp,da=a.privacyText,O=a.append;return a}();k.Feed=h})(m.tagoverview||(m.tagoverview={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.reactive.Functions,g=a.reactive.Value,e=a.silk.nav.NavLinks,d=a.typlib.CleanupPool,b=a.typlib.ErrorHandling,n=a.typlib.FileUpload,r=a.typlib.Functions,h=a.typlib.Images,f=a.typlib.Objects,c=a.typlib.Svg,q=a.typlib.Tracking,m=a.ui.Bubble,u=a.ui.picker.Pills,t=k.eq,v=k.inArray,k=function(){function a(c,b,e){var f;this.uploadUrl=this.uploadUrl.bind(this);this.prepareUpload=this.prepareUpload.bind(this);this.uploadDrop=this.uploadDrop.bind(this);
this.uploadSheets=this.uploadSheets.bind(this);this.reprepareUpload=this.reprepareUpload.bind(this);this.uploadProgress=this.uploadProgress.bind(this);this.fakeUploadProgress=this.fakeUploadProgress.bind(this);this.completeUploadProgress=this.completeUploadProgress.bind(this);this.uploadError=this.uploadError.bind(this);this.uploadSuccess=this.uploadSuccess.bind(this);this.previewImport=this.previewImport.bind(this);this.showDuplicates=this.showDuplicates.bind(this);this.setTitle=this.setTitle.bind(this);
this.setField=this.setField.bind(this);this.startDragging=this.startDragging.bind(this);this.stopDragging=this.stopDragging.bind(this);this.renderPage=this.renderPage.bind(this);this.saveSettings=this.saveSettings.bind(this);this.startImport=this.startImport.bind(this);this.abortImport=this.abortImport.bind(this);this.cancelImport=this.cancelImport.bind(this);this.resetImport=this.resetImport.bind(this);this.progressLoop=this.progressLoop.bind(this);this.updateProgress=this.updateProgress.bind(this);
this.showComplete=this.showComplete.bind(this);this.showErrored=this.showErrored.bind(this);this.showAborted=this.showAborted.bind(this);var h=this;this.uploadUrl=function(){var c=arguments;setTimeout(function(){a.prototype.uploadUrl.apply(h,c)},0)};this.renderPage=function(){var c=arguments;setTimeout(function(){a.prototype.renderPage.apply(h,c)},0)};if(f=function(a,c,b){this.alive=!0;this.pool=new d;this.previewPool=new d;this.pagePool=new d;this.canvas=a;this.tagList=a.domain.tagList;this.type=
"import3";this.root=$(Resource.ImportDocument3)[0];this.saveVersion=0;this.title=(new g("Import Documents")).name("ImportDocument3.title");this.viewState=(new g("loading")).name("ImportDocument3.viewState");this.import_=(new g).name("ImportDocument3.import");this.settings=this.import_.mapProp("settings").name("ImportDocument3.settings");this.pages=this.import_.mapProp("preview").name("ImportDocument3.pages");this.pageCount=this.import_.mapProp("pageCount").name("ImportDocument3.pageCount");this.currentPageNumber=
(new g(0)).name("ImportDocument3.currentPageNumber");this.uploadRatio=(new g(0)).name("ImportDocument3.uploadRatio");this.currentPage=g.lift(function(a,c){return a&&a[c]})(this.pages,this.currentPageNumber).name("ImportDocument3.currentPage");this.pool.push(this.currentPage.onchange(this.renderPage));this.pool.push(this.title,this.viewState,this.import_,this.settings,this.pages,this.pageCount,this.currentPageNumber,this.currentPage,this.uploadRatio);this.setupUI();this.setupOptions();q.trackWithMode("import-open",
null,!0);b?b.url?this.uploadUrl(b.url):b.file?this.uploadDrop(b.file):this.uploadError(b.reason,b.data):c?p(function(a,c){a&&"new"in c?this.previewImport(a):a&&("inProgress"in c||"queued"in c)?(this.previewImport(a),this.updateProgress(c)):this.prepareUpload()}.bind(this)):this.prepareUpload()}.apply(f||this,arguments))return f}a.whitelist=function(){return["text/csv","*.csv","*.xlsx","*.xls"]};a.loadImport=function(a){Silk.api.Import.latest().get(function(c){Silk.api.Import.byId(c.importId).getProgress(function(b){"new"in
b||"inProgress"in b||"queued"in b?a(c,b):a(null,null)},function(c){console.warn("error finding latest progress",c);a(null,null)})},function(c){a(null,null)})};a.decodeTitleFormat=function(a){a instanceof Array||(a=[a]);var c=[],b="";a.forEach(function(a){"text"in a&&(b=a.text);"column"in a&&(a.separator=b,c.push(a))});return c};var l=a,k=a.whitelist,p=a.loadImport;a.ImportDocument3=a;a.prototype.cleanup=function(){this.alive=!1;this.pagePool.cleanup();this.previewPool.cleanup();this.pool.cleanup();
clearTimeout(this.progressTimeout)};a.prototype.setupUI=function(){$(".step-loading",this.root).rToggleDisplay(t(this.viewState,"loading"));$(".step-upload",this.root).rToggleDisplay(t(this.viewState,"upload"));$(".step-uploading",this.root).rToggleDisplay(t(this.viewState,"uploading"));$(".step-upload-error",this.root).rToggleDisplay(t(this.viewState,"upload-error"));$(".step-preview",this.root).rToggleDisplay(t(this.viewState,"preview"));$(".step-running",this.root).rToggleDisplay(t(this.viewState,
"running"));$(".step-complete",this.root).rToggleDisplay(t(this.viewState,"complete"));$(".step-aborted",this.root).rToggleDisplay(t(this.viewState,"aborted"));$(".step-errored",this.root).rToggleDisplay(t(this.viewState,"errored"));$(".cancel-import-button",this.root).click(this.cancelImport).rToggleDisplay(v(this.viewState,["preview","complete"]),"inline-block").rText(this.viewState.map(function(a){return{preview:"Cancel Import",complete:"New Import"}[a]}));$(".start-import-button",this.root).click(this.startImport).rToggleDisplay(t(this.viewState,
"preview"),"inline-block");var a=c.renderIcon(h.pointRight,8,8,0.25).attr("fill","white");$(".start-import-button",this.root).append(a);a=c.renderIcon(h.upload,48,48,1.5);$(".step-upload .upload-icon",this.root).append(a);var a=c.renderIcon(h.upload,48,48,1.5),b=c.mkSvgEl("defs"),d=c.mkSvgEl("linearGradient",{id:"grad",x1:"0",x2:"0",y1:"1",y2:"0"}),e=c.mkSvgEl("stop",{offset:"0%",id:"filled"}),f=c.mkSvgEl("stop",{offset:"0%",id:"unfilled"});b.appendChild(d);d.appendChild(e);d.appendChild(f);a.append(b);
$(".step-uploading .upload-icon",this.root).append(a);this.pool.push(this.uploadRatio.onchange(this.setUploadProgress));$(".step-upload .gsheets input",this.root).on("paste",this.uploadUrl.bind(this,void 0)).on("keydown",function(a){13==a.keyCode&&this.uploadUrl()}.bind(this));this.canvas.domain.userStorage.enableGoogleSheetsImport.get()||$(".step-upload .secret-feature",this.root).hide();$(".step-uploading .sheet-list",this.root).hide();$(".step-upload-error .reprepare-button",this.root).click(this.reprepareUpload);
$(".step-upload-error .get-help-button",this.root).click(function(){});$(".title-selector-title .warning .duplicate-count",this.root).click(this.showDuplicates);$(".current-page",this.root).rText(this.currentPageNumber.map(function(a){return a+1}));$(".preview-total",this.root).rText(this.import_.mapProp("pageCount"));a=c.renderIcon(h.arrowLeft,12,12,0.375).attr("fill","white");b=c.renderIcon(h.arrowRight,12,12,0.375).attr("fill","white");$(".prev-button",this.root).click(this.changePage.bind(this,
-1)).append(a);$(".next-button",this.root).click(this.changePage.bind(this,1)).append(b);$(".step-running .import-collectionname",this.root).rText(this.settings.mapProp("collection"));$(".abort-import-button",this.root).click(this.abortImport);$(".start-new-button",this.root).click(this.cancelImport);$(".retry-button",this.root).click(this.resetImport)};a.prototype.uploadUrl=function(a){if(a=a||$(".gsheets input",this.root).val())a.match(/^https?:\/\//)||(a="http://"+a),this.viewState.set("uploading"),
this.fakeUploadProgress(),$(".upload-filename",this.root).text(a),Silk.api.Import.uploadSheetsUrl({url:a},this.uploadSheets.bind(this,null),this.uploadError.bind(this,"upload")),q.trackWithMode("import-paste-url",null,!0)};a.prototype.prepareUpload=function(){this.viewState.set("upload");this.uploadRatio.set(0);var a=$(".drop-area",this.root),c=$(".click-area",this.root);n.prepareUpload(a,c,k()).then(this.uploadDrop,this.uploadError)};a.prototype.uploadDrop=function(a){if(a instanceof window.File){this.viewState.set("uploading");
$(".upload-filename",this.root).text(a.name);var c="upload";a.name.match(/\.xlsx?$/)&&(c="uploadSheets");var b=a.name.replace(/\.(csv|xlsx?)$/,"");Silk.api.Import[c](a,"uploadSheets"==c?this.uploadSheets.bind(this,b):this.uploadSuccess.bind(this,b),this.uploadError.bind(this,"upload"),void 0,{processData:!1,ignoreErrors:[400],xhr:function(){var c=$.ajaxSettings.xhr();c.withCredentials=!0;c.data=a;c.upload&&c.upload.addEventListener("progress",this.uploadProgress,!1);return c}.bind(this)});q.trackWithMode("import-drop",
null,!0)}else this.prepareUpload()};a.prototype.uploadSheets=function(a,c){var b=c.sheets,d=c.fileId;a=c.collection||a;var e=function(c){Silk.api.Import.selectSheet({fileId:d,sheetIndex:c,collection:a},this.uploadSuccess.bind(this,null),this.uploadError.bind(this,"upload"),void 0,{ignoreErrors:[400]});$(".step-uploading .sheet-list",this.root).hide();return!1}.bind(this),b=b.filter(function(a){return a.valid});if(1<b.length){this.uploadRatio.set(1);$(".step-uploading .sheet-list",this.root).show();
var f=$(".step-uploading .sheet-list-list",this.root).empty();b.forEach(function(a){a&&$("<a>").appendTo($("<div>").appendTo(f)).click(e.bind(this,a.index)).text(a.name).attr("href","#")}.bind(this))}else 1==b.length?e(b[0].index):this.uploadError("upload",{status:400,reason:{customReason:{parseError:{}}}})};a.prototype.reprepareUpload=function(){this.canvas.switchDocument(new a(this.canvas))};a.prototype.uploadProgress=function(a){a&&a.total&&(this.uploadRatio.set(1*a.loaded/a.total*0.9),a.loaded==
a.total&&this.fakeUploadProgress())};a.prototype.fakeUploadProgress=function(){var a=this.uploadRatio.get();this.uploadRatio.set(1-0.95*(1-a));this.progressTimer=setTimeout(this.fakeUploadProgress,250)};a.prototype.completeUploadProgress=function(a){var c=this.uploadRatio.get()||0;1<c?setTimeout(a,250):(this.uploadRatio.set(c+0.05),setTimeout(this.completeUploadProgress.bind(this,a),1E3/60))};a.prototype.setUploadProgress=function(a){$(".step-uploading stop",this.root).attr("offset",Math.round(100*
(a||0))+"%")};a.prototype.uploadError=function(a,c){clearTimeout(this.progressTimer);this.viewState.set("upload-error");var d=null;"whitelist"===a&&(d=this.canvas.domain.userStorage.enableGoogleSheetsImport.get()?"Only CSV and Excel files are supported":"Only CSV files are supported");if("upload"==a&&(0==c.status&&(d="Network connection error"),413==c.status&&(d="Your file has to be smaller than 10mb"),400==c.status))try{var e=JSON.parse(c.responseText);if(e.customReason){a=e.customReason.jobError||
e.customReason.urlError||e.customReason;if(a.parseError||a.fileError&&a.fileError.parseError)d="Could not parse the uploaded file";a.invalidUrl&&(d="Invalid URL");a.unauthorized&&(d="We could not access the Google Sheet. Please use the 'Share' button to change the sharing settings to \"Anyone with the link can view\".");a.unauthorized||a.fileError||b.handleError("Importer upload url error",{source:"client.model.document.ImportDocument3.uploadError",response:c.responseText,url:$(".gsheets input",this.root).val()})}e.inputError&&
"File too large"==e.inputError.parseError&&(d="Your file has to be smaller than 500kb",q.trackWithMode("import-filesize-exceeded",null,!1))}catch(f){b.handleError("Could not parse JSON response",{source:"client.model.document.ImportDocument3.uploadError",response:c.responseText})}d||(console.error("Upload",a,c),d="Unknown error",b.handleError("Unknown upload error",{source:"client.model.document.ImportDocument3.uploadError",response:c&&c.responseText,status:c&&c.status,reason:a}));$(".step-upload-error .error-description",
this.root).text(d);q.trackWithMode("import-drop-error",null,!0)};a.prototype.uploadSuccess=function(a,c){clearTimeout(this.progressTimer);var b=this.previewImport.bind(this,c);if("Import"==c.settings.collection&&a){var d={};f.deepClone(c.settings,d);d.collection=a;Silk.api.Import.saveById(c.importId,d,function(a){b=this.previewImport.bind(this,a);this.completeUploadProgress(b)}.bind(this),function(){this.completeUploadProgress(b)}.bind(this))}else this.completeUploadProgress(b)};a.prototype.changePage=
function(a){var c=this.currentPageNumber.get(),b=this.pages.get().length;this.currentPageNumber.set((c+a+b)%b)};a.prototype.previewImport=function(a){this.alive&&(this.previewPool.cleanup(),this.import_.set(a),this.processSettings(),this.setupTitle(),this.viewState.set("preview"))};a.prototype.mkTitlePill=function(a,b,d,e){var f={},g=$("<div class=config-settings />");g.append($("<div class=desc>").text("Select title column"));a.forEach(function(a){var c=$("<div class=option />").addClass("enabled").text(a).appendTo(g);
c.click(function(){d({separator:b?b.separator:" - ",column:a});f.close()});b&&a==b.column&&c.addClass("active")}.bind(this));var l=$("<div class='picker-bubble title-picker-bubble'/>").append(g);a=new u({multi:!1,allowEmpty:!1,setupUI:function(a,g){var k=b?g.children():g;m.click(k,l,320,null,k,{position:"bottom"},null,f);if(e){g.addClass("deletable");$("<div/>").addClass("del").append($("<div class=title-del>").text("×")).click(d.bind(this,void 0)).appendTo(g);var n={},q=$("<div class=config-settings>").append($("<div class=desc>").text("Join title using"));
[{separator:" (",title:"Parentheses"},{separator:" - ",title:"Hyphen"},{separator:" ",title:"Space"}].forEach(function(a){var c=$("<div class=option>").appendTo(q).addClass("enabled").text(a.title).click(function(){d({separator:a.separator,column:b.column});n.close()});a.separator==b.separator&&c.addClass("active")});k=c.renderIcon(h.gear,14,14,0.4);k=$("<div class=title-gear/>").append(k);m.click(k,q,150,null,k,{position:"bottom"},null,n);$("<div/>").addClass("del").append(k).appendTo(g)}},addText:"Pick another column to disambiguate"});
b&&a.set([[{label:b.column,item:b.column}]]);this.previewPool.push(a);return $("<div class=title-selector>").append(a.node)};a.prototype.showDuplicates=function(a){var c=this.import_.get().warnings.duplicates,c=Object.keys(c).sort(),b=$("<div class='title-duplicate-bubble vog'>");c.forEach(function(a){$("<div class=title>").append($("<span>").text(a)).appendTo(b)});m.popup(b,320,null,a.target,{position:"bottom",containerClass:"vog"},null,null);return!1};a.prototype.setupTitle=function(){var a=this.import_.get().warnings.duplicates;
this.titleFormat=l.decodeTitleFormat(this.settings.get().title);var c=this.import_.get().columns;$(".title-selector-bar",this.root).empty();for(var b in this.titleFormat)$(".title-selector-bar",this.root).append(this.mkTitlePill(c,this.titleFormat[b],this.setTitle.bind(this,b),0<b)),c=c.filter(r.not(r.is(this.titleFormat[b].column)));$(".title-selector-title .warning").hide();a&&(0<c.length&&$(".title-selector-bar",this.root).append(this.mkTitlePill(c,null,this.setTitle.bind(this,this.titleFormat.length))),
a=Object.keys(a).length,$(".title-selector-title .warning .duplicate-count").text(""+a+(1<a?" titles":" title")),setTimeout(function(){$(".title-selector-title .warning").css("left",$(".title-selector:nth(0)",this.root).width()+45+"px").show()}.bind(this)),this.showedDisambiguateBubble||(this.showedDisambiguateBubble=!0,setTimeout(function(){var a=$("<div>").append($("<div>There are multiple pages with the same title.</div><br/>")).append($("<div>Choose a different title column or disambiguate them above.</div>"));
m.popup(a,250,null,$(".title-selector:first",this.root),{position:"bottom",containerClass:"title-duplicate-alert-bubble"},null,null)}.bind(this))))};a.prototype.setTitle=function(a,c){(this.titleFormat[a]=c)&&this.titleFormat.splice(a+1);var b=[];this.titleFormat.forEach(function(a){a&&(a.separator&&b.push({text:a.separator}),b.push({column:a.column})," ("==a.separator&&b.push({text:")"}))});var d=this.settings.get().title;if(1==d.length||d.column)if(d=this.findField("ignore",d.column||d[0].column))d.type=
"fact",d.text={column:d.__column};1==b.length&&(d=this.findField("fact",b[0].column))&&(d.type="ignore");this.settings.get().title=b;this.settings.get().uri=b;this.saveSettings();this.trackEditAction("title")};a.prototype.isTitleColumn=function(a){return a&&1==this.titleFormat.length&&this.titleFormat[0].column==a};a.prototype.setField=function(a,c){var b=this.fields[a],d;for(d in b)0==d.indexOf("__")&&(c[d]=b[d]);this.fields[a]=c};a.prototype.setupOptions=function(){var a=this;this.gearOptions=[{title:function(a){return"Column: "+
a.__column}},{title:"Use as fact",isActive:function(a){return"fact"==a.type&&!a.url&&!a.pageUrl},onClick:function(c,b){a.setField(b,{type:"fact",tag:c.tag,text:{column:c.__column}});a.trackEditAction("fact")}},{title:"Link to page",isActive:function(a){return"fact"==a.type&&a.pageUrl},onClick:function(c,b){a.setField(b,{type:"fact",tag:c.tag,text:{column:c.__column},pageUrl:{column:c.__column}});a.trackEditAction("page")}},{title:"Use as external link",isActive:function(a){return"fact"==a.type&&a.url},
onClick:function(c,b){a.setField(b,{type:"fact",tag:c.tag,text:{column:c.__column},url:{column:c.__column}});a.trackEditAction("url")}},{title:"Use as image",isActive:function(a){return"image"==a.type},onClick:function(c,b){a.setField(b,{type:"image",tag:c.tag,url:{column:c.__column},placement:c.placement||"leftColumn"});a.trackEditAction("image")}},{title:"Use as paragraph",isActive:function(a){return"paragraph"==a.type},onClick:function(c,b){a.setField(b,{type:"paragraph",tag:c.tag,text:{column:c.__column},
placement:c.placement||"mainColumn"});a.trackEditAction("paragraph")}},{title:"Use as title",isActive:function(c){return"ignore"==c.__subtype&&a.isTitleColumn(c.__column)},onClick:function(c){a.setTitle(0,{column:c.__column,separator:""});a.trackEditAction("title")}},{title:"Ignore",isActive:function(c){return"ignore"==c.type&&!a.isTitleColumn(c.__column)},onClick:function(c,b){a.setField(b,{type:"ignore"});a.trackEditAction("delete")}},{title:""},{title:"Split on commas",isActive:function(a){return","==
a.__split},onClick:function(c){c.__split=","==c.__split?void 0:",";a.trackEditAction("split")}},,{title:"Split on other characters",isActive:function(a){return a.__split&&","!=a.__split},onClick:function(c){c.__split=c.__split&&","!=c.__split?void 0:prompt("Character to split on:");a.trackEditAction("split")}}];this.placementOptions=[{title:"Use on sidebar",isActive:function(a){return"leftColumn"==a.placement},onClick:function(c){c.placement="leftColumn";a.trackEditAction("placement")}},{title:"Use on main column",
isActive:function(a){return"mainColumn"==a.placement},onClick:function(c){c.placement="mainColumn";a.trackEditAction("placement")}}];this.canvas.domain.userStorage.enableImportHeaderSection.get()&&this.placementOptions.push({title:"Use on header",isActive:function(a){return"header"==a.placement},onClick:function(c){c.placement="header";a.trackEditAction("placement")}})};a.prototype.mkOption=function(a,c,b,d){var e="function"==typeof a.title?a.title(c):a.title;if(!a.isActive)return $("<div class=desc>").text(e);
e=$("<div class=option>").text(e).click(function(){a.onClick(c,b,d);this.saveSettings();d.close()}.bind(this)).addClass("enabled");a.isActive(c)&&e.addClass("active");return e};a.prototype.settingsClick=function(a,c,b){var d=this.fields[c],e={},f=$("<div class=config-settings/>"),h;for(h in a)f.append(this.mkOption(a[h],d,c,e));m.popup(f,220,null,b.target,{position:"bottom"},null,e)};a.prototype.findField=function(a,c){var b=this.fields.filter(function(b){return b.__subtype==a&&b.tag==c&&b.__column==
c});return 1==b.length?b[0]:null};a.prototype.changeLinkTextColumn=function(a,c){var b=this.findField("ignore",a.text.column);b&&(b.type="fact",b.text={column:b.__column});a.text.column=c;c!=a.__column&&(b=this.findField("fact",c))&&(b.type="ignore");this.saveSettings();this.trackEditAction("link-text")};a.prototype.linkSettingsClick=function(a,c){var b=this.fields[a],d=$("<div class=config-settings/>").append($("<div class=desc>").text("Select column for link text")),e={};this.import_.get().columns.forEach(function(a){var c=
$("<div class=option>").addClass("enabled").text(a).click(function(){this.changeLinkTextColumn(b,a);e.close()}.bind(this));b.text.column==a&&c.addClass("active");d.append(c)}.bind(this));m.popup(d,220,null,c.target,{position:"bottom"},null,e)};a.prototype.mkRow=function(a,b,d,e,f,g){var l=$("<tr>").addClass(d);l.append($("<td class=key>")["string"==typeof a?"text":"append"](a),$("<td class=value>").append(b));a=$("<td class=gear>").appendTo(l);g="ignore"==d&&this.isTitleColumn(g);if(f||g)d=g?"title":
d,b=g?0.4:0.5,$("<div class=other>").addClass(d).attr("title",g?"Title":null).click(f).append(c.renderIcon(h[d],16,16,b)).appendTo(a);e&&$("<div class=gear>").click(e).append(c.renderIcon(h.gear,16,16,0.5)).appendTo(a);return l};a.prototype.mkTag=function(a){var c=$("<div>"),b=$("<div>").text(a.tag).appendTo(c),d=$("<input type=text>").val(a.tag).appendTo(c).hide();b.on("mouseup",function(){b.hide();d.show();d[0].focus();d[0].select()});d.blur(function(){""==d.val()&&d.val(a.tag);d.val()!=a.tag&&
(a.tag=d.val(),this.saveSettings(),this.trackEditAction("tag"));b.text(d.val());b.show();d.hide()}.bind(this)).keyup(function(c){27==c.keyCode&&d.val(a.tag);13!=c.keyCode&&27!=c.keyCode||d.blur()});return c};a.prototype.mkCollectionFact=function(a){function c(){f.empty();h.filter(function(a){return!e.val()||-1!==a.toLowerCase().indexOf(e.val().toLowerCase())}).forEach(function(a){$("<div class=option>").text(a).click(function(){d(a);e.val(a);e.blur()}).appendTo(f)})}var b={},d=function(a){$("tr.collection span.step.first",
this.root).text(a)},e=$("<input type=text>").blur(function(){e.val()&&e.val()!=a&&(this.settings.get().collection=e.val(),this.saveSettings(),this.trackEditAction("collection"));e.val("");b.close&&b.close()}.bind(this)).keyup(function(b){13==b.keyCode?e.blur():(d(e.val()?e.val():a),c())}),f=$("<div class=selectbox>"),h=this.tagList.tags.list.filter(function(a){return a.docLevelCount.get()}).sort(r.comparing(function(a){return a.name.toLowerCase()})).map(function(a){return a.name});-1==h.indexOf(a)&&
h.unshift(a);c();var g=$("<div class='collection-bubble'>").append(e).append(f),l=new u({multi:!1,allowEmpty:!1,setupUI:function(a,c){var d=m.click(c,g,320,null,c,{position:"bottom"},null,b);c.click(function(){e.focus().select()});return d}});this.pagePool.push(l);l.set([[{label:a,item:a}]]);return this.mkRow("Collection",l.node,"collection")};a.prototype.renderItem=function(a){if("image"==a.type)return $("<div class='image value'>").text(a.href);if("paragraph"==a.type)return $("<div class='paragraph value'>").text(a.text);
if(a.link)return $("<div class='link value'>").append($("<a>").attr("href",a.link).attr("title",a.link).click(function(){return!1}).text(a.text));if(a.text)return $("<div class='fact value'>").text(a.text)};a.prototype.renderItems=function(a){if(!a)return"";if(1==a.length)return this.renderItem(a[0]);var c=$("<div class=list>");a.forEach(function(a){c.append($("<div class=item>").append(this.renderItem(a)))}.bind(this));return c};a.prototype.rebuildFactSheet=function(a){var c=$(".factsheet",this.root);
c.empty();var b=$("<tbody class=unsortable>").appendTo(c),c=$("<tbody class=sortable>").appendTo(c);b.append(this.mkCollectionFact(this.settings.get().collection));var d={};a.facts.concat(a.leftColumn,a.mainColumn,a.header).forEach(function(a){d[a.index]||(d[a.index]=[]);d[a.index].push(a)});var e={facts:[],leftColumn:[],mainColumn:[],header:[],ignore:[]};this.fields.forEach(function(a,c){var b=this.settingsClick.bind(this,this.gearOptions,c),f=null;if("image"==a.__subtype||"paragraph"==a.__subtype)f=
this.settingsClick.bind(this,this.placementOptions,c);"link"==a.__subtype&&(f=this.linkSettingsClick.bind(this,c));var h=$("<div>").text(a.tag);-1!==["fact","link","pageLink","image"].indexOf(a.__subtype)&&(h=this.mkTag(a));b=this.mkRow(h,this.renderItems(d[c]),a.__subtype,b,f,a.__column);b.data("fieldPos",c);e[a.__section].push(b)}.bind(this));b.append($("<tr class=title><td colspan=3>Facts</td></tr>").data("section","facts"));c.append(e.facts).append($("<tr class=title><td colspan=3>Sidebar</td></tr>").data("section",
"leftColumn")).append(e.leftColumn).append($("<tr class=title><td colspan=3>Main column</td></tr>").data("section","mainColumn")).append(e.mainColumn);e.header.length&&c.append($("<tr class=title><td colspan=3>Header</td></tr>").data("section","header")).append(e.header);e.ignore.length&&c.append($("<tr class=title><td colspan=3>Unused</td></tr>").data("section","ignore")).append(e.ignore);$(".sortable",this.root).sortable({start:this.startDragging,stop:this.stopDragging,cancel:".title, input"})};
a.prototype.startDragging=function(a){this.dragging=$(a.toElement||a.originalEvent.target).closest("tr")};a.prototype.stopDragging=function(a){a=this.dragging;for(var c=a.data("fieldPos"),b=this.fields[c],d="facts",e=a.parent().children(),f=0;f<e.length&&e[f]!=a[0];f++)d=$(e[f]).data("section")||d;if(b.__section!=d){"facts"==d&&this.setField(c,{type:"fact",tag:b.tag,text:{column:b.__column}});if("leftColumn"==d||"mainColumn"==d||"header"==d)b.placement?b.placement=d:this.setField(c,{type:"paragraph",
tag:b.tag,text:{column:b.__column},placement:d});"ignore"==d&&(b.type="ignore")}this.saveSettings();this.trackEditAction("drag-and-drop")};a.prototype.rebuildColumn=function(a,c){a.empty();c.forEach(function(c){var b=$("<div class=import-block>");"image"==c.type&&b.append($("<img>").attr("src",c.href));"paragraph"==c.type&&b.text(c.text);a.append(b)})};a.prototype.renderPage=function(a){a&&(this.pagePool.cleanup(),$(".title",this.root).text(a.title),this.rebuildFactSheet(a),this.rebuildColumn($(".header",
this.root),a.header),this.rebuildColumn($(".left-column",this.root),a.leftColumn),this.rebuildColumn($(".right-column",this.root),a.mainColumn))};a.prototype.processField=function(a){var c={};f.deepClone(a,c);c.__subtype=c.type;c.__section=c.placement||"facts";"image"==c.type&&(c.__column=c.url.column,c.__split=c.url.split);"fact"==c.type&&(c.__column=c.text.column,c.__split=c.text.split,c.url&&(c.__column=c.url.column,c.__subtype="link"),c.pageUrl&&(c.__column=c.pageUrl.column,c.__subtype="pagelink"));
"paragraph"==c.type&&(c.__column=c.text.column,c.__split=c.text.split,c.tag=c.text.column);return c};a.prototype.unprocessField=function(a){var c={};f.deepClone(a,c);c.text&&(c.text.split=c.__split);c.url&&(c.url.split=c.__split);c.pageUrl&&(c.pageUrl.split=c.__split);for(var b in c)0==b.indexOf("__")&&delete c[b];return c};a.prototype.processSettings=function(){this.fields=this.settings.get().fields.map(this.processField);var a={};this.fields.forEach(function(c){a[c.__column]=!0});this.import_.get().columns.forEach(function(c){a[c]||
this.fields.push({type:"ignore",__subtype:"ignore",__column:c,__section:"ignore",tag:c})}.bind(this))};a.prototype.saveSettings=function(){var a=[];$("tbody.sortable tr:not(.title)",this.root).each(function(c,b){var d=$(b).data("fieldPos"),d=this.fields[d];"ignore"!=d.type&&a.push(this.unprocessField(d))}.bind(this));this.settings.get().fields=a;this.saveVersion++;Silk.api.Import.saveById(this.import_.get().importId,this.settings.get(),this.saveGuard(this.previewImport),this.saveGuard(function(a){400==
a.status&&Silk.api.Import.byId(this.import_.get().importId).get(this.previewImport)}.bind(this)))};a.prototype.saveGuard=function(a){return function(c){c==this.saveVersion&&a.apply(this,Array.prototype.slice.call(arguments,1))}.bind(this,this.saveVersion)};a.prototype.trackEditAction=function(a){q.trackWithMode("import-edit",{action:a},!0)};a.prototype.startImport=function(){var a=this.import_.get().warnings&&this.import_.get().warnings.pageLimitExceeded,c=this.import_.get().warnings&&this.import_.get().warnings.existing;
if(c&&0<c.length||a){var b={};if(a){var d=$("<div class=import-warning><strong>Error</strong>: This import exceeds the <span class=num-pages></span> page limit. <a href='mailto:support@silk.co'>Contact Silk</a> for help.</div>");$(".num-pages",d).text(""+a.pageLimit)}else{var d=$("<div class=import-warning><strong>WARNING</strong>: <span class=num-existing></span> pages in this site will be overwritten.</div>"),e=$("<div class=warning-actions>").appendTo(d),f=$("<div class=warning-cancel>Cancel</div>").appendTo(e),
e=$("<div class=warning-continue>Continue</div>").appendTo(e);$(".num-existing",d).text(""+c.length);f.click(function(){b.close()});e.click(function(){b.close();this.reallyStartImport()}.bind(this))}m.popup(d.addClass("vog"),a?270:220,null,$(".start-import-button",this.root),{position:"bottom",containerClass:"vog"},null,b)}else this.reallyStartImport()};a.prototype.reallyStartImport=function(){this.saveVersion++;Silk.api.Import.byId(this.import_.get().importId).start({overrideExisting:!0},this.progressLoop,
this.showErrored);this.updateProgressUI(null);$(".abort-import-button",this.root).text("Abort Import");q.trackWithMode("import-start",null,!0)};a.prototype.abortImport=function(){Silk.api.Import.byId(this.import_.get().importId).remove();$(".abort-import-button",this.root).text("Aborting...");return!1};a.prototype.cancelImport=function(){Silk.api.Import.byId(this.import_.get().importId).remove();this.canvas.switchDocument(new a(this.canvas));return!1};a.prototype.resetImport=function(){var a=this.previewImport.bind(this,
this.import_.get());Silk.api.Import.byId(this.import_.get().importId).reset(a,a);return!1};a.prototype.progressLoop=function(){this.alive&&Silk.api.Import.byId(this.import_.get().importId).getProgress(this.updateProgress,function(){this.progressTimeout=setTimeout(this.progressLoop,1E3)}.bind(this))};a.prototype.updateProgress=function(a){this.alive&&a&&("complete"in a&&this.showComplete(!1),"errored"in a&&this.showComplete(!0),"aborted"in a&&this.showAborted(),"new"in a||"queued"in a||"inProgress"in
a)&&(this.updateProgressUI(a.inProgress),this.progressTimeout=setTimeout(this.progressLoop,1E3),window.Silk.ui.importProgress.update({status:{inProgress:a.inProgress},collection:this.settings.get().collection,user:this.canvas.domain.user.uuid.get()}))};a.prototype.updateProgressUI=function(a){"preview"==this.viewState.get()&&this.viewState.set("running");var c,b,d;a&&a.total?(b=a.imported+a.errored,c=Math.round(100*b/a.total)+"%",b=b+" of "+a.total+" ("+c+")",a.errored&&(d="Warning: "+a.errored+" page"+
(1<a.errored?"s":"")+" failed to import.")):(c="0%",b="Starting...");$(".step-running .progress",this.root).width(c);$(".step-running .progress-text",this.root).text(b);$(".step-running .progress-errored-text",this.root).text(d)};a.prototype.showComplete=function(a){this.viewState.set("complete");var c=this.settings.get().collection,b=this.tagList.findOrReload(c);$(".showtagpages a",this.root).unbind("click").bind("click",function(){b.then(function(a){window.location.href=a?e.exploreCollection(a.uri):
"/dashboard"});return!1});b.then(function(a){window.Silk.ui.importProgress.update({status:{complete:{}},collection:c,tag:a,user:this.canvas.domain.user.uuid.get()});$(".showtagpages a",this.root).unbind("click").attr("href",a?e.exploreCollection(a.uri):"/dashboard")}.bind(this));$(".showtagpages .tagname",this.root).text(c);a?($(".step-complete .complete",this.root).hide(),q.trackWithMode("csv-import-error",{"document-count":this.pageCount.get()},!0)):($(".step-complete .errored",this.root).hide(),
q.trackWithMode("csv-import-complete",{"document-count":this.pageCount.get()},!0))};a.prototype.showErrored=function(a){this.viewState.set("errored");q.trackWithMode("csv-import-error",{"document-count":this.pageCount.get()},!0)};a.prototype.showAborted=function(){this.viewState.set("aborted");q.trackWithMode("csv-import-canceled",{"document-count":this.pageCount.get()},!0)};return a}();l.ImportDocument3=k})(k.document||(k.document={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_=
{}));(function(a){(function(m){(function(k){var l=a.client.component.ComponentURIs,m=a.client.model.Component,g=a.component.tagoverview.PageSection,e=a.typlib.Arrays,d=a.typlib.CleanupPool,b=a.typlib.Strings,n=a.typlib.Tracking,r=a.component.tagoverview.Feed,h=a.typlib.Svg,f=a.typlib.Images,c=a.typlib.FileUpload,q=a.client.model.document.ImportDocument3,s=function(){function a(c,b,e){var f;this.tagListFailed=this.tagListFailed.bind(this);this.tagListLoaded=this.tagListLoaded.bind(this);this.generateYoutubeEmbed=
this.generateYoutubeEmbed.bind(this);this.videoOpen=this.videoOpen.bind(this);this.renderSection=this.renderSection.bind(this);this.addSection=this.addSection.bind(this);this.sectionRemoved=this.sectionRemoved.bind(this);this.addAddSection=this.addAddSection.bind(this);this.prepareUpload=this.prepareUpload.bind(this);this.uploadDrop=this.uploadDrop.bind(this);this.uploadError=this.uploadError.bind(this);this.uploadUrl=this.uploadUrl.bind(this);this.addImporterSection=this.addImporterSection.bind(this);
this.fadeIn=this.fadeIn.bind(this);var h=this;this.uploadUrl=function(){var c=arguments;setTimeout(function(){a.prototype.uploadUrl.apply(h,c)},0)};this.fadeIn=function(){var c=arguments;setTimeout(function(){a.prototype.fadeIn.apply(h,c)},0)};if(f=function(a,c,b){this.tags=[];this.canvas=b;this.tagList=b.domain.tagList;this.repository=b.repository;this.document=c;this.pool=new d;this.hasBeenLoaded=!1;m.linkToNode(this,a,"collection-overview");this.node.empty();this.isInteractive="dashboard"==this.document.type&&
b.editFlags.canCreate.get();this.canDelete="dashboard"==this.document.type&&b.editFlags.canDelete.get();this.usesSections="dashboard"==this.document.type;this.initSections();this.prepareInitialFlow()}.apply(f||this,arguments))return f}a.uri=l.CollectionOverview;a.CollectionOverview=a;a.prototype.serializeToXML=function(){return $(this.node[0].cloneNode(!1)).attr("class","collection-overview")[0]};a.prototype.affectsDirtyState=function(a){return a.target===this.node[0]&&"class"!==a.attribute};a.prototype.cleanup=
function(){this.pool.cleanup()};a.prototype.initSections=function(){this.feedContainer=$("<a />").addClass("feed-teaser").appendTo(this.node).attr("href","/dashboard/feed")[0];this.sectionsContainer=$("<div />").appendTo(this.node)[0]};a.prototype.prepareInitialFlow=function(){this.showBusyState();var a=this.tagList.status;this.pool.push(a.waitConst("failed",this.tagListFailed));this.pool.push(a.waitConst("loaded",this.tagListLoaded))};a.prototype.tagListFailed=function(){this.hasBeenLoaded||(this.hideBusyState(),
this.showErrorState())};a.prototype.tagListLoaded=function(){var a=!this.tagList.docLevelTags.list.length;this.hasBeenLoaded=!0;this.hideBusyState();this.renderFeedTeaser();this.isInteractive&&this.renderAddButton();a&&(this.addAddSection(!0),this.addImporterSection());this.updateSections()};a.prototype.renderFeedTeaser=function(){if(r.canView().get()){var a=this;window.Silk.api.Feed.list(function(c){5>r.countDocumentEvents(c)||(c=r.recentChanges(r.unwrapMultiDocuments(c)),$(a.feedContainer).css("visibility",
"visible").append($("<div>").addClass("text").text(c),$("<a>").addClass("link").attr("href","/dashboard/feed").addClass("feed-link").text("Visit the feed to see more »")))})}};a.prototype.newSection=function(){return $(this.usesSections?"<section />":"<div />").addClass("collection-overview-section")};a.prototype.generateYoutubeEmbed=function(a){return'<iframe width="640" height="360" src="https://www.youtube.com/embed/'+a+'?rel=0&vq=hd720&hd=1&autoplay=1&autohide=1&showinfo=0&controls=0" frameborder="0" allowfullscreen></iframe>'};
a.prototype.videoOpen=function(a,c,b){b=this.generateYoutubeEmbed(b);$(".video-footer-details").hide();$(".video-content",this.node).html("");$(".collection-section-video-footer").show();a.slideUp();c.slideDown();c.find(".video-content").html(b)};a.prototype.newSectionWithVideo=function(a,c,b){var d=$("<div/>").addClass("collection-section-video-wrapper"),e=$("<div/>").addClass("collection-section-video-content"),f=$("<div/>").addClass("collection-section-video-footer").addClass("active"),h=$("<div class='video-footer-details'><div><div class='video-content' /></div></div>");
d.append(e);d.append(f);d.append(h);f.append("<p>"+a+" <strong>"+c+"</strong></p>");f.append($("<div>").addClass("thumbnail"));f.click(function(){this.videoOpen(f,h,b)}.bind(this));return d};a.prototype.renderSection=function(a,c,b){var d=this.newSection();c=!0===c?"unsaved-drafts":a?"with-collection":"no-collection";b=new g(d,this.document,this.canvas,{isInteractive:this.isInteractive&&"unsaved-drafts"!==c,showDeleteUI:this.canDelete&&this.isInteractive&&"with-collection"===c,mode:c,tagUri:a,hasTags:b},
this.repository);this.tags.push(a);this.pool.push(b);$(b).on("remove",this.sectionRemoved);$(d).appendTo(this.sectionsContainer);return b};a.prototype.updateSections=function(){var a=this.tags,c=this.tagList.sortedDocLevelTags.list.slice(),b=c.map(function(a){return a.uri}).filter(function(c){return-1===a.indexOf(c)});this.renderSection(null,!0);b.forEach(this.renderSection);0<this.tagList.pagesWithoutCollection.count.get()&&this.renderSection(null,!1,0<a.length||0<c.length)};a.prototype.renderAddButton=
function(){var a=function(){this.addAddSection(!1)}.bind(this);$("<div class=add-section />").append($("<div class=add-section-button />"),$("<div class=add-section-text />").text("Add another collection")).click(a).appendTo(this.node)};a.prototype.addSection=function(a){a.preventDefault();a=$(a.target).closest(".new-collection");var c=b.trim($("input[type=text]",a).val());if(0==c.length)$("form .form-error",a).text("Please enter a new collection name."),$("form",a).addClass("has-error"),$("input[type=text]",
a).focus();else{var d=this.tagList.findByNameOrCreate(c,!0);if(d.isDocLevel().get())$("form .form-error",a).text("That collection already exists"),$("form",a).addClass("has-error"),$("input[type=text]",a).focus();else{var e=this.tagList.docLevelTags.length().get();d.docLevelTag.set(!0);d.save();n.trackWithMode("collection-created",{component:"collection-overview",collectionCount:e,name:c});window.Silk.vog.event("collection-created",e);c=this.renderSection(d.uri).node;a.before(c).remove();$("input[type=text]",
c).focus();$(".add-section",this.node).show()}}};a.prototype.sectionRemoved=function(a){a=a.target;this.pool.remove(a);(a=a.tag.get())&&e.remove(this.tags,a.uri);0===this.tags.length&&this.addAddSection(!0)};a.prototype.addAddSection=function(a){var c=this.node.children(".new-collection");if(c.length)return c.show();n.trackWithMode("collection-create-show-input",{component:"collection-overview",collectionCount:this.tagList.docLevelTags.length().get()});$(".add-section",this.node).hide();a=a?"Create your first collection":
"Add another collection";var b=$("<form><div class='description-top'/><input type=submit  class='add' value=Add><input placeholder='ex: employees, restaurants, planets' class='long' type=text><div class=form-error></div></form>").submit(this.addSection);$(".description-top",b).text(a);$("input[type=text]",b).on("input",function(){b.removeClass("has-error");$(".form-error",b).text("")});a=this.newSectionWithVideo("Learn more about","collections","QW3C9z6UaMQ");$(".collection-section-video-content",
a).append(b).find("input[type=text]").focus();a.addClass("new-collection").insertBefore($(".add-section",this.node)).hide().fadeIn(1E3)};a.prototype.prepareUpload=function(){var a=$(".step-upload",this.node),b=$(".step-upload .drop",this.node);c.prepareUpload(a,b,q.whitelist()).then(this.uploadDrop,this.uploadError)};a.prototype.uploadDrop=function(a){this.canvas.switchDocument(new q(this.canvas,!1,{file:a}))};a.prototype.uploadError=function(a,c){this.canvas.switchDocument(new q(this.canvas,!1,{reason:a,
data:c}))};a.prototype.uploadUrl=function(){var a=$(".step-upload .gsheets input",this.node).val();this.canvas.switchDocument(new q(this.canvas,!1,{url:a}))};a.prototype.addImporterSection=function(){var a=this.newSectionWithVideo("Watch a short video about","importing spreadsheets","9npdRnu9aEk");a.find(".collection-section-video-content").html(Resource.ImporterSection);a.prepend('<div class="intermediate">or</div>');this.node.append(a);var c=h.renderIcon(f.upload,48,48,1.5);$(".step-upload .upload-icon",
a).append(c);this.prepareUpload();$(".step-upload .gsheets input",a).on("paste",this.uploadUrl).on("keydown",function(a){13==a.keyCode&&this.uploadUrl()}.bind(this));this.canvas.domain.userStorage.enableGoogleSheetsImport.get()||$(".step-upload .secret-feature",a).hide()};a.prototype.showErrorState=function(){this.node.empty();$(this.node).children(".collection-overview-error").length||($(this.node).addClass("error"),$("<div class=collection-overview-error><div class=heading>Oops!</div><p>Sorry, the dashboard is currently unavailable</p></div>").appendTo(this.node),
this.fadeIn(".collection-overview-error"))};a.prototype.showBusyState=function(){$(this.node).rAddClass("busy");var a=this.isInteractive?"Loading the dashboard...":"Loading...";$("<div class=collection-overview-busy />").append($("<div class=heading />").text(a)).appendTo(this.node);this.fadeIn(".collection-overview-busy")};a.prototype.fadeIn=function(a){$(this.node).children(a).addClass("load")};a.prototype.hideBusyState=function(){$(this.node).removeClass("busy");$(this.node).find(".collection-overview-busy").remove()};
a.prototype.node=void 0;a.prototype.feedContainer=void 0;a.prototype.sectionsContainer=void 0;return a}();k.CollectionOverview=s})(m.tagoverview||(m.tagoverview={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.Registry,m=a.component.EmbedBlock,g=a.component.FigureBlock,e=a.component.Gist,d=a.component.Image,b=a.component.KeyValue,n=a.component.Pinned,r=a.component.QueryViewer,h=a.component.RecentDocuments,f=a.component.SimpleBlock,c=a.component.SiteInfo,q=a.component.TagCounter,s=a.component.TagPreview,u=a.component.TextWidget,t=a.component.Toc,v=a.component.TwitterTimeline,x=a.component.Upload,w=a.component.UrlPreview,y=a.component.Video,A=a.component.tagoverview.CollectionOverview,
z=function(){function a(){}a.setup=function(){l.register(A);l.register(m);l.register(e);l.register(d);l.register(b);l.register(n);l.register(r);l.register(h);l.register(f);l.register(c);l.register(q);l.register(s);l.register(g);l.register(u);l.register(t);l.register(v);l.register(x);l.register(w);l.register(y)};return a}();k.Components=z})(m.component||(m.component={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,m=function(){function a(e,d){var b;if(b=function(a,b){this.loader=a;this.document=b;this.savedWorking=(new l).name("Discard.savedWorking");this.busy=(new l(!1)).name("Discard.busy")}.apply(b||this,arguments))return b}a.Discarder=a;a.prototype.discard=function(a){var d=this.document.get(),b=d.uri.get(),g=d.autosaver;d.dirtyTracking.dirty.get()&&(this.busy.set(!0),this.savedWorking.set({uri:b,data:d.serializer.serialize(),undoState:d.undoManager.getState(),
savedRevision:d.dirtyTracking.savedRevision.get()}),d=function(){this.busy.set(!1);g.deleteAutosave();a&&a()}.bind(this),this.loader.loadAndRender(b,"skip-autosave").done(d))};a.prototype.undoDiscard=function(){var a=this.document.get().uri.get(),d=this.savedWorking.get();d&&d.uri==a&&(this.busy.set(!0),this.loader.loadFromString(a,d.data,function(a){a.undoManager.setState(d.undoState);a.dirtyTracking.savedRevision.set(d.savedRevision)}),this.savedWorking.set(),this.busy.set(!1))};return a}();k.Discarder=
m})(m.editing||(m.editing={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.reactive.Value,g=function(){function a(){}a.hack=function(a){if("edmbase"!=window.Silk.domain.repository.template.get())return!1;a.children(".disclaimer").remove();var e=d();e[0].component=new k({serializeToXML:function(){}});a.append(e);return!0};a.disclaimer=function(){return $("<p class=disclaimer/>").append("You can contribute to the EDMbase by editing this page or by adding new ","DJ's or companies from the top of this page. For questions about EDMbase, ",
"changes or feedback about our service please contact ",$("<a href=mailto:support@edmbase.org>support@edmbase.org</a>"),". ","For legal terms, copyright notice and other details concerning this data check ",$("<a href=http://www.edmbase.org/page/disclaimer>the disclaimer</a>"),".")};var d=a.disclaimer;return a}();l.EdmbaseSpecificDisclaimer=g})(k.migrate||(k.migrate={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){(function(a){(function(a){var k=function(){function a(){}a.migrateBlockUIInData=function(a){a=a.find(".block-ui");return 0<a.length?(a.remove(),!0):!1};return a}();a.BlockUIInData=k})(a.migrate||(a.migrate={}))})(a.model||(a.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.client.model.Component,g=a.component.FigureBlock,e=a.component.SimpleBlock,d=a.typlib.Arrays,b=a.typlib.Functions,n=function(){function a(){}a.migrateToFigureBlocks=function(a){var c=["QueryViewer","Image"].map(b.unary(k.selectorFor)).join(", ");return d.or(a.find(c).map(h).get())};a.migrateSingle=function(a,c){var b=$(c);return b.parent().attr("data-component-uri")===e.uri?(b.parent().replaceWith(k.createNode(g,{content:b})),!0):!1};var h=
a.migrateSingle;return a}();l.FigurifyWidgets=n})(k.migrate||(k.migrate={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.typlib.Arrays,g=a.component.silkviz.BarChart,e=a.component.silkviz.LineChart,d=a.component.silkviz.PieChart,b=function(){function a(){}a.migrateGoogleVizToSilkViz=function(a,c){var d=$(a).find("[data-component-uri$='queryviewer/1']").get().map(b.bind(this,c));return k.or(d)};a.migrateTagsGoogleVizToSilkViz=function(a,c){var b=a.find("view-data");if(!b.length)return!1;try{var e=JSON.parse(b.text());e.view=h(e.view);if(e.view==d.uri){e.roles.maxslices=
[12];var g=e.roles.numeric[0];g&&(e.roles.order=[$.extend(!0,{direction:"desc"},g)])}b.text(JSON.stringify(e))}catch(l){return!1}return!0};a.migrateComponent=function(a,c){c=$(c);try{var b=JSON.parse(c.attr("data-component-json"));b.view=h(b.view);if(b.view==d.uri){b.roles.maxslices=[12];var e=b.roles.numeric[0];e&&(b.roles.order=[$.extend(!0,{direction:"desc"},e)]);c.children(".component-output").remove()}c.attr("data-component-json",JSON.stringify(b))}catch(g){return!1}return!0};a.mapView=function(a){return{"http://typlab.com/2010/components/googleviz/barchart":g.uri,
"http://typlab.com/2010/components/googleviz/columnchart":g.uri,"http://typlab.com/2010/components/googleviz/linechart":e.uri,"http://typlab.com/2010/components/googleviz/piechart":d.uri}[a]||a};var b=a.migrateComponent,h=a.mapView;return a}();l.GoogleVizToSilkViz=b})(k.migrate||(k.migrate={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.typlib.Arrays,g=function(){function a(){}a.migrateHeaders=function(a){return k.or(a.find("h5, h6").map(d).get())};a.migrateSingle=function(a,d){d=$(d);d.replaceWith($("<h4/>").html(d.html()));return!0};var d=a.migrateSingle;return a}();l.NoMoreSubSubHeaders=g})(k.migrate||(k.migrate={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.client.query.Roles,g=a.typlib.Arrays,e=function(){function a(){}a.migrateDocument=function(a,d){var e=$(a).find("[data-component-uri$='queryviewer/1']").get().map(b);return g.or(e)};a.migrateTag=function(a,b){var d=a.find("view-data");if(!d.length)return!1;var c=e(d.text());d.text(c.jsonText);return c.changed};a.migrateComponent=function(a){a=$(a);var b=e(a.attr("data-component-json"));a.attr("data-component-json",b.jsonText);return b.changed};
a.migrateJson=function(a){function b(a){a.isDocument&&(d=!0,delete a.isDocument,a.relation=k.PageTitle)}var d=!1;try{var c=JSON.parse(a),e;for(e in c.roles)"collection"!==e&&c.roles[e].forEach(b);c.filters.forEach(b)}catch(g){}return{changed:d,jsonText:JSON.stringify(c)}};var b=a.migrateComponent,e=a.migrateJson;return a}();l.PageTitleTag=e})(k.migrate||(k.migrate={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.typlib.Arrays,g=function(){function a(){}a.migrateWrongEnumLinks=function(a){return k.or(a.find("a[data-tag-uri]").map(d).get())};a.migrateSingle=function(){var a=$(this);return a.attr("href")&&a.attr("href").match(/^\/explore/)?(a.removeAttr("href"),!0):!1};var d=a.migrateSingle;return a}();l.WrongEnumLinks=g})(k.migrate||(k.migrate={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.client.model.migrate.BlockUIInData,g=a.client.model.migrate.FigurifyWidgets,e=a.client.model.migrate.GoogleVizToSilkViz,d=a.client.model.migrate.NoMoreSubSubHeaders,b=a.client.model.migrate.PageTitleTag,n=a.client.model.migrate.WrongEnumLinks,m=a.typlib.Arrays,h=a.typlib.Objects,f=function(){function a(){}a.migrate=function(a,c,b,d,e,g){c=$(c);var l=f.migrations[b];if(!l)throw Error("Unknown type in Migrate.migrate: "+b);b=e?l[e]:m.concat(h.values(l));
return m.or(b.map(function(b){var e=b(c,d,a,g);if(!0!==e&&!1!==e)throw Error("Migration "+b.name+" must return boolean to indicate if the document was modified.");return e}))};a.migrations={document:{"wrong-enum-links":[n.migrateWrongEnumLinks],"figurify-widgets":[g.migrateToFigureBlocks],"no-more-sub-sub-headers":[d.migrateHeaders],"googleviz-to-silkviz":[e.migrateGoogleVizToSilkViz],"block-ui-in-data":[k.migrateBlockUIInData],"page-title-tag":[b.migrateDocument]},tag:{"googleviz-to-silkviz":[e.migrateTagsGoogleVizToSilkViz],
"page-title-tag":[b.migrateTag]}};var f=a;return a}();l.Migrate=f;l=f.migrate})(k.migrate||(k.migrate={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.DocumentTitle,m=a.ui.Lightbox,g=function(){function a(){}a.normalizePath=function(a){return"/"==a?"/home":a};a.show=function(a){var e=new Uri(a);a=d(e.uriParts.path);var g=a.split("/").map(decodeURIComponent).filter(function(a){return a&&a.length}),h=d(window.location.pathname),e=e.uriParts.host==window.location.host;if(a!=h||!e){if("page"==g[0]&&"home"==g[1])var f="Loading homepage";else if("page"==g[0])f="Loading "+l.suggestTitle(g[1]);
else if("tag"==g[0])f="Loading visualization";else if("explore"==g[0])f="Loading visualization";else if("dashboard"==g[0]){if(h.match(/\/dashboard/)&&e)return;f="Opening dashboard"}else f="Loading";(new m).open("light",function(){return $("<div class=nav-status />").append($("<div/>").addClass("loading"),$("<div/>").addClass("message").text(f))})}};var d=a.normalizePath;return a}();k.NavStatus=g})(m.nav||(m.nav={}))})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.DocumentTitle,m=a.client.model.document.ContentDocument,g=a.client.model.migrate.EdmbaseSpecificDisclaimer,e=a.client.model.migrate.Migrate,d=a.client.model.newPage.NewPage,b=a.reactive.Value,n=a.typlib.Functions,r=a.typlib.Html,h=a.typlib.Strings,f=a.typlib.Tracking,c=a.silk.nav.NavStatus,q=function(){function a(c,d,e,f,h){var g;this.loadAndRenderNew=this.loadAndRenderNew.bind(this);if(g=function(a,c,d,e,f){this.canvas=a;this.tagList=e;
this.repository=f;this.loading=new b(!1);this.pageApi=c;this.pinApi=d}.apply(g||this,arguments))return g}a.Loader=a;a.prototype.loadAndRender=function(a,b,d){c.show("/page/"+encodeURIComponent(a));var e=function(){return this.loadDocument(a,d).then(function(a){this.canvas.switchDocument(a)}.bind(this),n.partial(this.loadAndRenderNew,a,null,null,d))}.bind(this);return!1===this.canvas.editFlags.canWrite.get()||b?e():this.loadAutosave(a,d).then(function(a){this.canvas.switchDocument(a)}.bind(this),e)};
a.prototype.loadAndRenderNew=function(a,c,b,e){function f(h){h=g.makeContentDocument(k,"home"==a?d.createNewHomePage(g.repository.name.get()):d.createNewRegularPage(k,c,l.makeTitle(b,k)),e,h);g.canvas.switchDocument(h);return $.Deferred().resolve(null)}var g=this;a=a||"home";var k=h.trimEncodedName(a);if("home"!==a&&!c){var q=d.getNewPageCategoryName(k);q&&(c=this.tagList.findByNameOrCreate(q).uri)}return this.loadPinned(c).then(f,n.nullary(f))};a.prototype.loadFromString=function(a,c,b){a=this.makeContentDocument(a,
c);this.canvas.switchDocument(a);b&&b(a)};a.prototype.loadDocument=function(a,c){this.loading.set(!0);return this.pageApi(a).getPinned(void 0,void 0,void 0,{ignoreErrors:[404]}).then(function(c){var b=$(c.documentElement);c=b.children(":not([data-pinned-components])");b=b.children("[data-pinned-components]");c=this.makeContentDocument(a,c,!1,b);f.trackWithMode("document-open",{uri:a,"is-new":c.isNew.get(),"is-empty":c.isEmpty.get(),"has-new-uri":!!c.hasNewUri.get(),editing:c.isNew.get()||c.isEmpty.get()});
(c.isNew.get()||c.isEmpty.get())&&f.trackWithMode("document-edit",{uri:a,"is-new":!0});return c}.bind(this)).always(function(){this.loading.set(!1)}.bind(this))};a.prototype.loadAutosave=function(a,c){var b=function(b){if(!b||!b.documentElement)return $.Deferred().reject();b=this.makeContentDocument(a,b,c);b.dirtyTracking.savedRevision.set(void 0);b.autosaver.autosaveRevision.set(0);return b}.bind(this);return this.pageApi(a).Autosave.current().get(void 0,void 0,void 0,{ignoreErrors:[404]}).then(b)};
a.prototype.makeContentDocument=function(a,c,b,d){c=$(r.ensureHtml(c));d&&(d=$(r.ensureHtml(d)));e.migrate(this.canvas.domain.tagList.cache,c,"document",this.repository.uri.get()||location.hostname);d&&e.migrate(this.canvas.domain.tagList.cache,d,"document",this.repository.uri.get()||location.hostname);g.hack(c);return new m(a,c,this.canvas,this.tagList,this.repository,b,d&&d[0])};a.prototype.loadPinned=function(a){return a?this.pinApi.byCollection(this.tagList.findByUriOrCreateWithoutSaving(a).getCanonicalName()).get():
$.Deferred().resolve(null)};return a}();k.Loader=q})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Html,m=function(){function a(){}a.setup=function(){a.focusEl=null;a.connectedEls={};a.id=1;var e=$(window.document.documentElement);e.bind("mouseup",a.doMouse);e.bind("mouseover",a.doMouse);e.bind("keydown",a.doKeyDown);$(window).bind("resize",a.doResize)};a.doMouse=function(e){var d=l.querySelectorAOS(e.target,".focusable");d&&"mouseup"==e.type&&l.getClassList(d).contains("toggleFocus")?l.getClassList(d).contains("focused")?a.removeFocusFromElement(d):
a.focusElement(d):d!=a.focusEl&&("mouseover"!=e.type||d&&!l.getClassList(d).contains("clickable"))&&(!a.focusEl||d&&l.isAncestor(a.focusEl,d)||a.removeFocus(),d&&!l.getDisabled(d)&&a.focusElement(d))};a.doResize=function(e){a.removeFocus()};a.doKeyDown=function(e){if(a.focusEl&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&"INPUT"!=e.target.nodeName&&"TEXTAREA"!=e.target.nodeName)switch(e.keyCode){case 38:"block"==$(a.focusEl).css("display")&&a.goPreviousSibling();e.preventDefault();break;case 40:"block"==$(a.focusEl).css("display")&&
(a.goDeeper()||a.goNextSibling());e.preventDefault();break;case 27:a.removeFocus();e.preventDefault();break;case 13:var d=window.document.createEvent("MouseEvents");d.initMouseEvent("mouseup",!0,!0,window,0,-1,-1,-1,-1,!1,!1,!1,!1,0,null);a.focusEl.dispatchEvent(d);e.preventDefault();break;default:if(d=String.fromCharCode(e.keyCode).toLowerCase()){var b=a.focusEl.querySelectorAll(".focusable.keyfocusable");0==b.length&&(b=a.focusEl.parentNode.children);for(var k=0;k<b.length;k++)if(l.getClassList(b[k]).contains("keyfocusable")&&
0==b[k].textContent.toLowerCase().indexOf(d)){a.focusElement(b[k]);e.preventDefault();break}for(k=0;k<b.length;k++)if(l.getClassList(b[k]).contains("keyfocusable")&&-1!=b[k].textContent.toLowerCase().indexOf(d)){a.focusElement(b[k]);e.preventDefault();break}}}};a.connectElements=function(){a.id++;for(var e=0;e<arguments.length;e++)a.connectedEls[l.getUniqueID(arguments[e])]=[a.id,arguments[e]]};a.focusElement=function(e,d){e.onRemoveFocus=d;e!=a.focusEl&&(a.removeFocus(),a.setFocus(e))};a.removeFocusFromElement=
function(e){a.focusEl==e&&a.removeFocus()};a.delayedRemoveFocus=function(e){window.setTimeout(a.removeFocus,0)};a.removeFocus=function(){if(a.focusEl){var e=a.focusEl;a.focusEl=null;var d=l.querySelectorAllAOS(e,".focusable.focused");d[0]!=e&&d.unshift(e);for(e=0;e<d.length;++e)l.getClassList(d[e]).remove("focused"),a.focusConnectedElements(d[e],!1),d[e].onRemoveFocus&&(d[e].onRemoveFocus(),delete d[e].onRemoveFocus)}};a.focusConnectedElements=function(e,d){var b=l.getUniqueID(e);if(a.connectedEls[b]){var b=
a.connectedEls[b][0],k;for(k in a.connectedEls){var m=a.connectedEls[k];m[0]==b&&(d?l.getClassList(m[1]).add("focused"):l.getClassList(m[1]).remove("focused"))}}};a.setFocus=function(e){var d=l.querySelectorAllAOS(e,".focusable, .hoverable");d[0]!=e&&d.unshift(e);for(var b=0;b<d.length;++b)l.getClassList(d[b]).add("focused"),a.focusConnectedElements(d[b],!0);a.focusEl=e};a.goPreviousSibling=function(){for(var e=a.focusEl;e=e.previousElementSibling;)if(!l.getDisabled(e)&&l.getClassList(e).contains("focusable"))return a.focusElement(e),
!0;return!1};a.goNextSibling=function(){for(var e=a.focusEl;e=e.nextElementSibling;)if(!l.getDisabled(e)&&l.getClassList(e).contains("focusable"))return a.focusElement(e),!0;return!1};a.goShallower=function(){var e=l.querySelectorAllAOS(a.focusEl,".focusable.focused")[1];e?a.focusElement(e):a.removeFocus()};a.goDeeper=function(){for(var e=a.focusEl.querySelectorAll(".focusable"),d=0;d<e.length;++d){var b=e[d];if(!l.getDisabled(b))return a.focusElement(b),!0}return!1};return a}();k.FocusManager=m})(m.ui||
(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Value,m=a.typlib.Objects,g=function(){function a(d,b,e,g){var h;this.load=this.load.bind(this);this.loaded=this.loaded.bind(this);if(h=function(a,c,b,d){this.api=a;this.vogCreatedCollection=(new l).name("Storage.vogCreatedCollection");this.vogCreatedPage=(new l).name("Storage.vogCreatedPage");this.vogDisable=(new l).name("Storage.vogDisable");this.vogAlwaysEnable=(new l).name("Storage.vogAlwaysEnable");this.vogEditedPage=(new l).name("Storage.vogEditedPage");
this.vogCreatedFirstKeyValueTag=(new l).name("Storage.vogCreatedFirstKeyValueTag");this.vogCreatedVisualization=(new l).name("Storage.vogCreatedVisualization");this.vogFirstEditSessionFlow=(new l([],m.deepEquals)).name("Storage.vogFirstEditSessionFlow");this.enableTagMentionsAndPinning=(new l).name("Storage.enableTagMentionsAndPinning");this.enableGoogleSheetsImport=(new l).name("Storage.enableGoogleSheetsImport");this.enableImportHeaderSection=(new l).name("Storage.enableImportHeaderSection");void 0!==
c?this.loaded(c):"embed"!==b&&d.anonymous.wait(function(a){return!a},this.load)}.apply(h||this,arguments))return h}a.Storage=a;a.prototype.load=function(){window.Silk.api.User.current().Storage.list(this.loaded,function(a){404===a.status&&this.loaded(null)}.bind(this),void 0,{ignoreErrors:[404]})};a.prototype.loaded=function(a){var b={};a&&a.items.forEach(function(a){b[a.key]=a.value});this.vogCreatedCollection.set("true"==b.vogCreatedCollection);this.vogCreatedPage.set("true"==b.vogCreatedPage);
this.vogDisable.set("true"==b.vogDisable);this.vogAlwaysEnable.set("true"==b.vogAlwaysEnable);this.vogEditedPage.set("true"==b.vogEditedPage);this.vogCreatedFirstKeyValueTag.set("true"==b.vogCreatedFirstKeyValueTag);this.vogCreatedVisualization.set("true"==b.vogCreatedVisualization);this.enableTagMentionsAndPinning.set("true"==b.enableTagMentionsAndPinning);this.enableGoogleSheetsImport.set(!0);this.enableImportHeaderSection.set("true"==b.enableImportHeaderSection);this.loadFirstEditSessionFlow(b)};
a.prototype.loadFirstEditSessionFlow=function(a){var b=a.vogFirstEditSessionFlow;try{b=JSON.parse(b)}catch(e){b={}}b.constructor!=Object&&(b={});this.vogFirstEditSessionFlow.set(b[window.location.hostname]||[]);var g=this.api.User.current().Storage;this.vogFirstEditSessionFlow.onchange(function(a){b[window.location.hostname]=a;g.saveByKey("vogFirstEditSessionFlow",JSON.stringify(b))})};a.prototype.setBoolKey=function(a,b){this[a].get()!==("true"===b)&&(this.api.User.current().Storage.saveByKey(a,
b),this[a].set("true"==b))};return a}();k.Storage=g})(m.user||(m.user={}))})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Value,l=function(){function a(g,e){var d;this.loadFromJson=this.loadFromJson.bind(this);this.loadError=this.loadError.bind(this);var b=this;this.checkFormatLoop=function(){var d=arguments;setTimeout(function(){a.prototype.checkFormatLoop.apply(b,d)},5E3)};if(d=function(a,b){this.api=a;this.uri=(new k).name("Repository.uri");this.name=(new k).name("Repository.name");this.documents=(new k).name("Repository.documents");this.members=(new k).name("Repository.members");
this.subscriptions=(new k).name("Repository.subscriptions");this.template=(new k).name("Repository.template");this.format=(new k).name("Repository.format");this.privacy=(new k).name("Repository.privacy");this.isPrivate=(new k).name("Repository.isPrivate");this.isPublic=(new k).name("Repository.isPublic");this.isPubliclyEditable=(new k).name("Repository.isPubliclyEditable");this.createdTime=(new k).name("Repository.createdTime");this.customAnalytics=(new k).name("Repository.customAnalytics");this.status=
(new k("unloaded")).name("Repository.status");b&&this.loadFromJson(b)}.apply(d||this,arguments))return d}a.Repository=a;a.prototype.load=function(){this.status.set("loading");this.api.get(this.loadFromJson,this.loadError)};a.prototype.checkFormatLoop=function(a,e){this.load();this.format.get()==a?this.checkFormatLoop(a,e):e()};a.prototype.ensureLoaded=function(){"unloaded"===this.status.get()&&this.load()};a.prototype.loadFromJson=function(a){void 0!==a.uri&&this.uri.set(a.uri);void 0!==a.name&&this.name.set(a.name);
void 0!==a.documents&&this.documents.set(a.documents);void 0!==a.members&&this.members.set(a.members);void 0!==a.subscriptions&&this.subscriptions.set(a.subscriptions);void 0!==a.template&&this.template.set(a.template);void 0!==a.created&&this.createdTime.set(new Date(a.created));void 0!==a.customAnalytics&&this.customAnalytics.set(a.customAnalytics);this.format.set(a.format||0);a.privacy&&this.privacy.set(a.privacy);a.privacy&&this.isPrivate.set("private"==a.privacy);a.privacy&&this.isPublic.set("public"==
a.privacy||"publiclyEditable"==a.privacy);a.privacy&&this.isPubliclyEditable.set("publiclyEditable"==a.privacy);this.status.set("loaded")};a.prototype.loadError=function(a,e,d){this.status.set("failed");console.error("Error retrieving repository information. "+e+": "+d)};a.prototype.toJson=function(){return{name:this.name.get(),template:this.template.get()}};a.prototype.update=function(a,e,d){var b=this.toJson(),l;for(l in b)void 0!==a[l]&&(b[l]=a[l]);this.api.Site.saveByUri(this.uri.get(),b,this.siteUpdated(b,
e),d)};a.prototype.siteUpdated=function(a,e){return function(){this.loadFromJson(a);e&&e()}.bind(this)};return a}();m.Repository=l})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Functions,l=a.reactive.Value,p=function(){function a(e,d){var b;this.withBusy=this.withBusy.bind(this);this.subscriptionObtained=this.subscriptionObtained.bind(this);this.toggleSubscription=this.toggleSubscription.bind(this);this.toggleFrequency=this.toggleFrequency.bind(this);this.unsubscribe=this.unsubscribe.bind(this);this.setUnsubscribed=this.setUnsubscribed.bind(this);this.subscribe=this.subscribe.bind(this);this.subscribeOk=this.subscribeOk.bind(this);
this.subscribeError=this.subscribeError.bind(this);if(b=function(a,b){this.api=a;this.frequency=(new l).name("Subscription.frequency");this.frequencyInstant=(new l).name("Subscription.frequencyInstant");this.subscribed=k.toBool(this.frequency).name("Subscription.subscribed");this.subscribedInstant=k.toBool(this.frequencyInstant).name("Subscription.subscribedInstant");this.busy=(new l(!1)).name("Subscription.busy");this.loaded=!1;void 0!==b&&this.subscriptionObtained(b)}.apply(b||this,arguments))return b}
a.Subscription=a;a.prototype.withBusy=function(a){this.busy.set(!0);a.apply(this).always(function(){this.busy.set(!1)}.bind(this))};a.prototype.load=function(){this.withBusy(function(){return this.api.Subscription.current().get(this.subscriptionObtained,function(a){404===a.status&&this.subscriptionObtained(null)}.bind(this),void 0,{ignoreErrors:[404]})})};a.prototype.ensureLoaded=function(){this.loaded||this.load()};a.prototype.subscriptionObtained=function(a){this.frequency.set(a?a.frequency:void 0);
this.frequencyInstant.set(a?a.frequency:void 0);this.loaded=!0};a.prototype.toggleSubscription=function(a){(a?this.subscribedInstant:this.subscribed).get()?this.unsubscribe():this.subscribe("daily")};a.prototype.toggleFrequency=function(a,d){(d?this.frequencyInstant:this.frequency).get()===a?this.unsubscribe():this.subscribe(a)};a.prototype.unsubscribe=function(){this.frequencyInstant.set(void 0);var a=this.api;this.withBusy(function(){return a.Subscription.current().remove(this.setUnsubscribed,this.setUnsubscribed)})};
a.prototype.setUnsubscribed=function(){this.frequency.set(void 0)};a.prototype.subscribe=function(a){this.frequencyInstant.set(a);var d=this.api;this.withBusy(function(){return d.Subscription.saveCurrent(a,this.subscribeOk,this.subscribeError)})};a.prototype.subscribeOk=function(a){this.frequency.set(a.frequency)};a.prototype.subscribeError=function(){this.frequencyInstant.set(this.frequency.get())};return a}();m.Subscription=p})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.domain.typing.Context,m=a.typlib.Objects,g=function(){function a(){var d;if(d=function(){this._context={};this._other=0}.apply(d||this,arguments))return d}a.TagNumberMapping=a;a.prototype.get=function(a){return a?this._context[a.toLowerCase()]||0:this.other()};a.prototype.set=function(a,b){a?this._context[a.toLowerCase()]=b:this._other=b};a.prototype.modify=function(a,b){a?this._context[a.toLowerCase()]=b(this.get(a)):this._other=b(this._other)};a.prototype.keys=
function(){return m.keys(this._context)};a.prototype.values=function(){return m.values(this._context)};a.prototype.keyValues=function(){return m.keyValues(this._context)};a.prototype.other=function(){return this._other};a.prototype.parse=function(a){var b=this;a.children("item").each(function(){b.set(l.normalizeTagUri($(this).text()),+$(this).attr("fraction"))})};return a}();k.TagNumberMapping=g})(m.domain||(m.domain={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.client.domain.TagNumberMapping,l=a.reactive.Value,p=a.typlib.CleanupPool,g=function(){function a(){var d;if(d=function(){this.pool=new p;this.pool.push(this.count=(new l(0)).name("PagesWithoutCollection.count"));this.revcontext=new k}.apply(d||this,arguments))return d}a.PagesWithoutCollection=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.parse=function(a){this.count.set(+a.children("count").text());this.revcontext.parse(a.find("revcontext"))};
return a}();m.PagesWithoutCollection=g})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Value,l=a.client.domain.TagNumberMapping,p=a.domain.typing.Context,g=a.domain.typing.Value,e=a.reactive.Functions,d=a.typlib.Arrays,b=a.typlib.Objects,n=a.typlib.Strings,r=a.typlib.DOMSerializer,h=k.value,f=function(){function a(c,b,d){var e;this.parse=this.parse.bind(this);if(e=function(a,c,b){this.name=this.uri=null;this.setUri(a);this.setName(c);this.fuzzy=b||c&&c.toLowerCase()||"";this.style=h("").name("tag.style");this.count=0;this.docLevelCount=(new k(0)).name("Tag.docLevelCount");
this.docLevelTag=(new k(!1)).name("Tag.docLevelTag");this.showAsMedia=(new k(!1)).name("Tag.showAsMedia");this.arity=0;this.textLength=null;this.context=new l;this.revcontext=new l;this.outtypes=new l;this.types=p.emptyContext();this.distribution={};this.enums={}}.apply(e||this,arguments))return e}a.getClassNameFromUri=function(a){return"tag_"+a.replace(/\W/g,"_")};a.uriPrefix=function(){return"/tag/"};a.nameToUri=function(a){return m()+encodeURIComponent(n.normalizeUri(a.toLowerCase()))};var f=a.getClassNameFromUri,
m=a.uriPrefix;a.Tag=a;a.prototype.cleanup=function(){this.docLevelCount.unlink();this.docLevelTag.unlink();this.style.unlink()};a.prototype.setUri=function(a){this.uri=p.normalizeTagUri(a)};a.prototype.setName=function(a){this.name=p.normalizeTagName(a,this.uri)};a.prototype.getCanonicalName=function(){return decodeURIComponent(this.uri.slice(5))};a.prototype.parse=function(a,c,b,d){function e(c){return a.find("> metadata > "+c).text()}a=$(a);b($(d),a,"tag",c||location.hostname);this.setName(a.find("> name").text());
this.fuzzy=a.find("> fuzzy").text()||this.name;this.count=+a.find("> as-tag").text();this.arity=+a.find("> arity").text();this.index=+a.find("> document-index").text();this.textLength=+a.find("> average-length").text();c=a.find("> linked");this.linked=c.length?+c.text():NaN;this.boardImage=e("board-image");c=e("view-data");try{this.viewData=c&&JSON.parse(e("view-data"))}catch(f){console.warn("Failed to parse viewData",e("view-data"))}this.docLevelCount.set(+a.find("> as-context").text());c=a.find("> metadata > doc-level-tag");
this.docLevelTag.set(0<c.length&&!c.text().match(/^false$/i));this.showAsMedia.set("true"==a.find("> metadata > show-as-media").text().toLowerCase());this.style.set(e("style"));var h=this,g={};this.context.parse(a.find("context"));this.revcontext.parse(a.find("revcontext"));this.outtypes.parse(a.find("outtypes"));a.find("types      > type").each(function(){g[$(this).text()]={fraction:+$(this).attr("fraction"),accuracy:+$(this).attr("accuracy")}});a.find("enum > item").each(function(){var a=$(this).text();
n.isWhitespace(a)||(h.enums[$(this).text()]=+$(this).attr("count"))});this.types=p.fromTag(g,this.uri,this.name);this.parseDistribution(a);return this};a.prototype.parseDistribution=function(a){var c=a.find("distribution > minimum > a")[0];a=a.find("distribution > maximum > a")[0];this.distribution={minimum:c&&g.fromNode(c,this.types,this),maximum:a&&g.fromNode(a,this.types,this)}};a.prototype.isDocLevel=function(){return e.or(this.docLevelCount,this.docLevelTag)};a.prototype.getLocalUri=function(){return decodeURIComponent(this.uri.substring(this.uri.lastIndexOf("/")+
1))};a.prototype.isEnum=function(){return 0.1<this.enumness()};a.prototype.isEnumAutocomplete=function(){var a=this.types.is("numeric"),c=this.types.is("year"),b=this.types.is("date");return this.isEnum()&&!a&&!c&&!b};a.prototype.enumness=function(){return d.sum(b.values(this.enums))/this.count};a.prototype.save=function(){if(!this.uri)throw Error("Cannot save a tag without a uri.");var a=r.serializeToString(this.toXml());return window.Silk.api.Tag.save(this.getLocalUri(),a,function(){},function(){},
{dataType:"xml"})};a.prototype.remove=function(){if(!this.uri)throw Error("Cannot remove a tag without a uri.");window.Silk.api.Tag(this.getLocalUri()).remove()};a.prototype.getClassName=function(){return f(this.uri)};a.prototype.toXml=function(){var a=$("<tag />").append($("<name />").text(n.trim(this.name))).append($("<style />").text(this.style.get()));this.boardImage&&$("<board-image />").text(this.boardImage).appendTo(a);this.docLevelTag.get()&&$("<doc-level-tag />").appendTo(a);this.viewData&&
$("<view-data />").text(JSON.stringify(this.viewData)).appendTo(a);$("<show-as-media />").text(this.showAsMedia.get()?"true":"false").appendTo(a);return a[0]};a.prototype.getReferences=function(){return d.notNull(this.outtypes.keys().map(function(a){return window.Silk.domain.tagList.findByUri(a)}))};a.prototype.getEnumValues=function(){var a=[],c;for(c in this.enums)a.push({value:c,count:this.enums[c]});return a.sort(function(a,c){return c.count-a.count}).map(function(a){return a.value})};a.prototype.countDocumentReferences=
function(){return d.sum(this.getReferences().map(function(a){return a.docLevelCount.get()}))};a.prototype.matchAtStart=function(a){a=RegExp("^"+n.regexEscape(a),"i");return this.name.match(a)||this.fuzzy.match(a)};a.prototype.matchAfterSpace=function(a){a=RegExp("\\s"+n.regexEscape(a),"i");return this.name.match(a)||this.fuzzy.match(a)};a.prototype.hasSubOptions=function(){return 0<d.sum(this.outtypes.values())||!!this.docLevelCount.get()};return a}();m.Tag=f})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){var k=a.arrow.Arrow,l=a.domain.PagesWithoutCollection,p=a.domain.Tag,g=a.domain.typing.Context,e=a.reactive.Functions,d=a.reactive.List,b=a.reactive.Value,n=a.typlib.Functions,r=function(){function a(c,e,f,h){var g;this.findByUriOrCreateWithoutSaving=this.findByUriOrCreateWithoutSaving.bind(this);this.findByUri=this.findByUri.bind(this);this.done=this.done.bind(this);this.fail=this.fail.bind(this);if(g=function(a,c,e,f){this.api=a;this.repository=c;this.migrate=f||function(){};
this.cache=null;this.status=(new b("unloaded")).name("TagList.status");this.tags=(new d).name("TagList.tags");this.docLevelTags=this.createDocLevelTagList();this.inlineLevelTags=this.createInlineTagList();this.sortedDocLevelTags=this.docLevelTags.sort(function(a,c){return c.docLevelCount.get()-a.docLevelCount.get()}).name("TagList.sortedDocLevelTags");this.pagesWithoutCollection=new l;this.initialLoad(e)}.apply(g||this,arguments))return g}a.decodedUriPath=function(a){return decodeURIComponent(a.slice(5).toLowerCase())};
a.compareUriTag=function(a){var c=g.normalizeTagUri(a);return function(a){return a.uri==c}};a.getNameOrFallback=function(a,c){return a?a.name:g.normalizeTagName(null,c)};var f=a.compareUriTag,c=a.getNameOrFallback;a.TagList=a;a.prototype.initialLoad=function(a){if(a)this.cache=a,this.parseTags(a),this.status.set("loaded");else{a=this.repository.documents.get();var c=Math.round((new Date-this.repository.createdTime.get())/1E3);0==a&&60>c&&this.status.set("loaded")}};a.prototype.createDocLevelTagList=
function(){var a=k.seq(k.unlist,k.isR(function(a){return a.isDocLevel()}));return k.run(a,this.tags).name("TagList.docLevelTags")};a.prototype.createInlineTagList=function(){var a=k.seq(k.unlist,k.isR(function(a){return e.not(a.isDocLevel())}));return k.run(a,this.tags).name("TagList.inlineLevelTags")};a.prototype.create=function(a,c,b){var d=this.findByUri(a);d?d.name!==c&&(d.setName(c),b||d.save()):(d=new p(a,c),b||d.save(),this.tags.push(d));return d};a.prototype.createFromName=function(a,c){if(a)return this.create(this.generateUniqueUri(a),
a,c)};a.prototype.createFromUri=function(a,c){if(a)return this.create(a,null,c)};a.prototype.findByName=function(a){var c=a.toLowerCase();a=this.tags.list.filter(function(a){return a.name.toLowerCase()==c});return 0!=a.length?a[0]:null};a.prototype.findByUriOrCreate=function(a,c){var b=this.findByUri(a);b||(b=this.createFromUri(a,c));return b};a.prototype.findByUriOrCreateWithoutSaving=function(a){return this.findByUriOrCreate(a,!0)};a.prototype.findByNameOrCreate=function(a,c){var b=this.findByName(a);
b||(b=this.createFromName(a,c));return b};a.prototype.findByNameOrDefault=function(a){var c=this.findByName(a);c||(c=new p(this.generateUniqueUri(a),a));return c};a.prototype.findOrReload=function(a){var c=function(){return this.findByUri(a)||this.findByName(a)}.bind(this),b=$.Deferred(),d=c();d?b.resolve(d):this.load(!0).then(function(){"failed"==this.status.get()&&b.resolve(null);"loaded"==this.status.get()&&b.resolve(c())}.bind(this));return b.promise()};a.prototype.generateUniqueUri=function(a){for(var c=
1;;c++){var b=p.nameToUri(a+(1<c?"-"+c:""));if(!this.findByUri(b))return b}};a.prototype.findByUri=function(a){if(!a)return null;a=this.tags.list.filter(f(a));return 0!=a.length?a[0]:null};a.prototype.findByUriR=function(a){return this.tags.filter(f(a)).head().map(function(c){return c||new p(a)})};a.prototype.getNameRWithFallback=function(a){return this.findByUriR(a).map(function(b){return c(b,a)})};a.prototype.toUriOrSelf=function(a){var c=a&&this.findByName(a);return c?c.uri:a};a.prototype.toNameOrSelf=
function(a){return c(this.findByUri(a),a)};a.prototype.toNameOrSelfR=function(a){return this.findByUriR(a).map(function(b){return c(b,a)})};a.prototype.byUris=function(a){return a.map(function(a){return this.findByUriOrCreate(a,!0)}.bind(this))};a.prototype.toNames=function(a){return this.byUris(a).map(function(a){return a.name})};a.prototype.updateStatistics=function(a){var c,b=(a.category||a.oldCategory)&&a.category!==a.oldCategory;a.oldCategory&&b&&(c=this.findByUri(a.oldCategory))&&(c.count--,
c.docLevelCount.set(c.docLevelCount.get()-1));a.category&&b&&(c=this.findByUriOrCreate(a.category),c.count++,c.docLevelCount.set(c.docLevelCount.get()+1));a.tags.forEach(function(c){var d=this.findByUri(c.uri);d&&(d.count+=c.diff,a.oldCategory&&b&&d.context.modify(a.oldCategory,n.subtract(c.oldCount)),a.category&&d.context.modify(a.category,n.add(b?c.count:c.diff)))}.bind(this))};a.prototype.load=function(a){this.status.set("loading");return this.api.Taglist().get(this.done,this.fail,a?{force:""}:
{})};a.prototype.ensureLoaded=function(){"unloaded"===this.status.get()&&this.load()};a.prototype.done=function(a,c,b){this.cache=(new DOMParser).parseFromString(b.responseText,"text/xml");this.parseTags(this.cache);this.status.set("loaded")};a.prototype.parseTags=function(a){this.clear();var c=this.tags;$("tags > tag",a).map(function(b,d){var e=$(d).attr("uri"),e=new p(e);e.parse(d,this.repository.uri.get(),this.migrate,a);c.push(e)}.bind(this));this.pagesWithoutCollection.parse($("tags > pages-without-collection",
a))};a.prototype.clear=function(){var a=this.tags;a.list.forEach(function(a){a.cleanup()});a.clear()};a.prototype.fail=function(a,c,b){console.error("Something error happen in TagList.load: "+b+", "+a.responseText);this.status.set("failed")};a.prototype.getContext=function(a){return this.tags.filter(function(c){return!!c.context.get(a)})};a.prototype.getRevContext=function(a){return this.tags.filter(function(c){return!!c.revcontext.get(a)})};a.prototype.getOutTypes=function(a){return this.tags.filter(function(c){return!!c.outtypes.get(a)})};
return a}();m.TagList=r})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Value,l=a.reactive.Functions,p=k.lift,g=function(){function a(c,e,s,u){var t;this.logout=this.logout.bind(this);this.load=this.load.bind(this);if(t=function(a,c,e,q){this.api=a;this.data=(new k(c)).name("User.data");this.permission=(new k(e)).name("User.permission");this.name=p(b("name","anonymous"))(this.data).name("User.name");this.email=p(b("email"))(this.data).name("User.email");this.intercomHash=p(b("hash"))(this.data).name("User.intercomHash");this.globalAdmin=
p(g("admin"))(this.data).name("User.globalAdmin");this.created=p(m("created"))(this.data).name("User.created");this.anonymous=p(f)(this.data).name("User.anonymous");this.canRead=p(h("canRead"))(this.permission).name("User.canRead");this.canWrite=p(h("canWrite"))(this.permission).name("User.canWrite");this.isAdmin=p(h("isAdmin"))(this.permission).name("User.isAdmin");this.uuid=p(b("uuid"))(this.data).name("User.uuid");this.sitePermissions=(new k(q?q.items:[])).name("User.sitePermissions");this.repositories=
this.sitePermissions.map(function(a){return a.map(function(a){return a.repository})});this.explicitRights=p(d)(this.permission).name("User.explicitRights");this.canReadExplicit=l.and(this.explicitRights,this.canRead).name("User.canReadExplicit");this.canWriteExplicit=l.and(this.explicitRights,this.canWrite).name("User.canWriteExplicit");this.anyAdmin=l.or(this.isAdmin,this.globalAdmin)}.apply(t||this,arguments))return t}a.hasExplicitRights=function(a){return a&&!a.account.authenticated&&!a.account.anonymous};
a.stringProp=function(a,b){return function(d){return f(d)?b||"":d[a]}};a.boolProp=function(a){return function(b){return f(b)?!1:b[a]}};a.dateProp=function(a){return function(b){b=b&&b[a];try{return b&&new Date(b)}catch(d){return null}}};a.tristateProp=function(a){return function(b){if(b)return f(b)?!1:b[a]}};a.isAnonymous=function(a){return!a};var d=a.hasExplicitRights,b=a.stringProp,g=a.boolProp,m=a.dateProp,h=a.tristateProp,f=a.isAnonymous;a.User=a;a.prototype.logout=function(){this.api.User.current().signout(function(){window.location=
window.location})};a.prototype.load=function(){var a=this.data,b=this.permission;void 0===a.get()&&this.api.User.current().get(function(b){a.set(b)},function(b){404===b.status&&a.set(null)},void 0,{ignoreErrors:[404]});b.get()||this.api.Permission.current().get(function(a){b.set(a)})};a.prototype.ensureLoaded=function(){this.data.get()||this.load()};return a}();m.User=g})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(m){var k=a.domain.user.Storage,l=a.domain.Permission,p=a.domain.Repository,g=a.domain.Subscription,e=a.domain.TagList,d=a.domain.User,b=function(){function a(b,h,f,c){var l;if(l=function(a,c,b,f){this.api=a;this.user=new d(a,c.user,c.permissionSiteCurrent,c.permissionUserCurrent);this.subscription=new g(a,c.subscription);this.repository=new p(a,c.site);this.tagList=new e(a,this.repository,c.taglist,f);this.userStorage=new k(a,c.userStorage,b,this.user);this.apiHelpers=this.createApiHelpers(a)}.apply(l||
this,arguments))return l}a.Domain=a;a.prototype.permission=function(){this.__memoized=this.__memoized||{};if(this.__memoized.permission)return this.__memoized.permission;var a=function(){var a=new l(this.api,this.user,this.repository);return a.load().then(function(b){return a}.bind(this))}.call(this);this.__memoized.permission=a;a.cleanup&&(a.__memoizeParent=this,a.__memoizeName="permission");return a};a.prototype.createApiHelpers=function(a){return{documentExists:function(b,d,c){a.Page(b).get(d,
c,void 0,{ignoreErrors:[404]})}}};a.prototype.update=function(a){this.tagList.load(a);this.repository.load()};a.prototype.ensureLoaded=function(){this.user.ensureLoaded();this.subscription.ensureLoaded();this.repository.ensureLoaded();this.tagList.ensureLoaded()};return a}();m.Domain=b})(a.domain||(a.domain={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(g){var e;this.registerEvent=this.registerEvent.bind(this);this.event=this.event.bind(this);if(e=function(a){this.domain=a;this.events=[]}.apply(e||this,arguments))return e}a.Vog=a;a.prototype.registerEvent=function(a,e,d){this.events.push({ev:a,filter:e,storageKey:d})};a.prototype.event=function(a,e){var d=this;this.events.filter(function(b){return a==b.ev&&(!b.filter||b.filter(e))}).forEach(function(a){d.domain.userStorage.setBoolKey(a.storageKey,
"true")})};return a}();a.Vog=l})(a.ui||(a.ui={}))})(a.lib||(a.lib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.browser=function(){var a=$.ua.engine.name,g=$.ua.engine.version&&$.ua.engine.version.split(".")[0],g="WebKit"===a&&530<=g||"Gecko"===a&&2<=g||"Presto"===a&&11<=g||"Trident"===a&&5<=g;return{canView:g,canEdit:g&&!("Presto"===a||"Trident"===a),canUpgrade:"IE"===$.ua.browser.name&&6<=$.ua.browser.major&&8>=$.ua.browser.major}}();return a}();a.BrowserCheck=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.get=function(a){try{return window.sessionStorage&&window.sessionStorage[a]}catch(g){}};a.set=function(a,g){try{window.sessionStorage&&(window.sessionStorage[a]=g)}catch(e){}};return a}();a.SessionStorage=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.install=function(){var a=$.ui.sortable.prototype._mouseStart,g=$.ui.sortable.prototype._createHelper;$.widget("ui.sortable",$.extend({},$.ui.sortable.prototype,{_mouseStart:function(e){this._trigger("beforeStart",e,this._uiHash());return a.apply(this,arguments)},_createHelper:function(){var a=g.apply(this,arguments);void 0!==this.options.explicitHelperHeight&&a.height(this.options.explicitHelperHeight);return a}}))};return a}();a.jQueryUISortableKludge=
k})(a.ui||(a.ui={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Functions,l=a.reactive.Value,p=a.arrow.Dom,g=a.lib.ui.VogTrigger,e=a.typlib.BrowserCheck,d=a.typlib.Html,b=a.typlib.SessionStorage,n=a.ui.jQueryUISortableKludge,r=k.and,h=k.or,f=k.not,c=k.eq,q=k.lt,s=k.gte,k=function(){function a(){}a.setupPaths=function(){var a=$("meta[name='client-cdn']").attr("content"),a={loginHost:$("meta[name='login-host']").attr("content"),loginProtocol:$("meta[name='login-protocol']").attr("content"),clientCdn:a,templatesCdn:$("meta[name='templates-cdn']").attr("content"),
fileCdn:$("meta[name='file-cdn']").attr("content"),template:$("meta[name='template']").attr("content"),bugsenseApiKey:$("meta[name='bugsense-api-key']").attr("content"),imagePath:a+"/images"};window.loginHost=a.loginHost;return a};a.setupBrowser=function(){var a=e.browser;"?e"==location.search&&(a.canEdit=a.canView);return a};a.setupApi=function(a){var c=window.location.host+"/s/api";a=new SilkApi(window.location.protocol+"//"+c,(a||"http")+"://"+c);var c=a.Site.byUri(window.location.host),b;for(b in c)"contextUrl"!==
b&&(a[b]=c[b]);return a};a.setupGoogleMap=function(a,c){c.SILK_CLIENT_UI_CHROME_setupFrame_callback=function(){c.google.load("maps","3.10",{packages:["corechart"],other_params:"libraries=geometry",callback:function(){}})};d.insertScript("https://www.google.com/jsapi?callback=SILK_CLIENT_UI_CHROME_setupFrame_callback",a)};a.prepareSilk=function(){0<=window.document.cookie.indexOf("silkLiveCSS=on")&&($(window.document.head).append('<link class="noscript" rel="stylesheet" href="/s/tools/livecss.css">'),
$(window.document.head).append('<script src="/s/tools/livecss.js">\x3c/script>'));$("html").addClass("component-preload-hide")};a.setupFirebugCheck=function(a){var c=window.SILK_DEBUGGING||b.get("doNotShowFirebugWarning");(console.firebug||window.document.getUserData&&window.document.getUserData("firebug-Token"))&&!c&&a.error("<strong>Firebug</strong> is known to make Silk slow, please turn Firebug off for better performance.",{closeCallback:function(){b.set("doNotShowFirebugWarning","true")},html:!0,
allowInViewMode:!0})};a.setupBetterPopupBlockerCheck=function(a){window.getSelection&&window.scrollTo||a.error("The <strong>Better Popup Blocker</strong> Chrome extension is known to break Silk. Please turn it off.",{html:!0,allowInViewMode:!0})};a.setupViewerOnlyCheck=function(a,c,d,e){function f(c,d,e){c||!d||"content"!==e&&"dashboard"!=e||a.notice("Your browser cannot be used to edit Silks. To edit pages, please install <a href='https://www.google.com/chrome'>Chrome</a> or <a href='http://www.getfirefox.com/'>Firefox</a>.",
{closeCallback:function(){b.set("doNotShowNoEditWarning","true")},html:!0,allowInViewMode:!0})}b.get("doNotShowNoEditWarning")||l.lift(f)(c.canEdit,d.canWrite,e.mapProp("type"))};a.setupOldWebkitCheck=function(a,c,d){function e(c,d){c&&d&&a.error("This browser has bugs that break Silk's editing functionality. For a better experience, please upgrade your browser.",{closeCallback:function(){b.set("doNotShowOldWebkitCheck","true")},html:!0,allowInViewMode:!0})}b.get("doNotShowOldWebkitCheck")||"WebKit"===
$.ua.engine.name&&536>$.ua.engine.version.split(".")[0]&&l.lift(e)(c.canEdit,d.canWrite)};a.setupWindowTitle=function(a,c,b){l.onchange(function(a,c,d,e,f){c="home"==c;if(!c||e)window.document.title=(c?e:d||"")+(f&&"content"==a.type?" [draft]":"")+" - "+(c?b:e||"")})(a,a.bindProp("uri"),a.bindProp("title"),c.name,a.mapProp("dirtyTracking").bindProp("dirty"))};a.setupVogTriggers=function(a,b,d){var e=d.document,l=e.mapProp("root"),k=e.mapProp("type"),n=e.bindProp("subViewType"),e=e.bindProp("editing");
new g(a,{pred:r(c("content",k),q(b.repository.documents,3),e,h(r(f(b.userStorage.vogCreatedVisualization),f(b.userStorage.vogDisable)),b.userStorage.vogAlwaysEnable)),text:"<strong>Visualizations</strong> make sense of the <a href='http://www.silk.co/tutorials/tagging-tutorial' target='_blank'>tagged data</a> on your site. Add a few pages with tagged facts to your site to get the most out of them.",targetArrow:p.select(".widget-section-visualization.expanded div.header"),targetRoot:l,delay:200,width:300,
height:100,position:"bottom",eventName:"visualization-created",storageKey:"vogCreatedVisualization"});new g(a,{pred:r(c("dashboard",k),c("collectionOverview",n),c(b.tagList.docLevelTags.length(),1),c(b.repository.documents,0),h(r(f(b.userStorage.vogCreatedPage),f(b.userStorage.vogDisable)),b.userStorage.vogAlwaysEnable)),text:"Enter the title of a new page here.",targetArrow:p.select(".collection-overview-section.is-empty .text"),targetRoot:l,delay:100,width:260,height:45,eventName:"document-created",
storageKey:"vogCreatedPage",containerClass:"small"});new g(a,{pred:r(c("dashboard",k),c("collectionOverview",n),s(b.repository.documents,3),h(r(f(b.userStorage.vogEditedPage),f(b.userStorage.vogDisable)),b.userStorage.vogAlwaysEnable)),text:"You can edit a page by clicking its title.",targetArrow:p.select(".collection-overview-section.with-collection .table.not-empty .page-name a"),targetRoot:l,onShow:function(a){var b=$(".collection-overview-section.with-collection")[0];b&&(b=b.component.get(),a.container.rToggleDisplay(r(f(c(b.deleteStatus,
"deleting")),f(c(b.deleteStatus,"delete-working")),f(c(b.deleteStatus,"delete-failed")))))},delay:100,width:300,height:45,eventName:"editing-page",storageKey:"vogEditedPage",containerClass:"small",position:"right",elementPadding:5});r(c("content",d.document.mapProp("type")),b.userStorage.vogCreatedCollection,b.userStorage.vogCreatedPage).onchange(function(c){c&&a.event("editing-page")})};a.setupJQueryUISortableKludge=function(){n.install()};return a}();m.BootMisc=k})(a.silk||(a.silk={}))})(_||(_=
{}));(function(a){(function(m){var k=a.typlib.Functions,l=a.reactive.Value,p=function(){function a(e,d){var b;this.getPickerOptions=this.getPickerOptions.bind(this);this.makeMarklet=this.makeMarklet.bind(this);if(b=function(a,b){this.type="bookmarkletAddToSite";this.title=new l("Bookmarklet");this.root=a;var d=$(this.root).find("#category");this.siteUri=$(this.root).find("#siteUri");this.collection="";this.bookmarkButton=$(this.root).find("#bookmark");$("<option/>").val("").text("<No Collection>").appendTo(d);
this.getPickerOptions().map(function(a){$("<option/>").attr("value",a.uri).text(a.name).appendTo(d)});$(d).on("change",k.partial(function(a){var c=$(this).val()||"";a.collection=c&&window.Silk.domain.tagList.findByUri(c);a.makeMarklet()},this));this.bookmarkButton.bind("click",function(a){a.preventDefault();alert("To use the bookmarklet, drag it onto your bookmark bar.");return!1});this.makeMarklet()}.apply(b||this,arguments))return b}a.BookmarkletDocument=a;a.prototype.cleanup=function(){};a.prototype.getPickerOptions=
function(){return window.Silk.domain.tagList.docLevelTags.list.sort(k.comparing(function(a){return-a.docLevelCount.get()}))};a.prototype.makeMarklet=function(){var a=this.siteUri.val(),d=(this.collection||null)&&JSON.stringify(this.collection.getLocalUri());this.bookmarkButton.attr("href","javascript:(function(){function%20loader(siteUri,category){var%20doc=document;var%20scr=doc.createElement('scr'+'ipt');var%20body=doc.body;var%20loc=doc.location;function%20loadMarklet(){marklet(siteUri,category);body.markletLoaded=true;}if(body.markletLoaded)loadMarklet();else{scr.setAttribute('src',loc.protocol+'//'+siteUri+'/dashboard/bookmarklet/add-to-site/bookmarklet.js');body.appendChild(scr);scr.onreadystatechange=function(){if(this.readyState=='complete')loadMarklet();};scr.onload=loadMarklet;}void(0);};"+
('loader("'+a+'"'+(d?","+d:"")+");")+"})();")};return a}();m.BookmarkletDocument=p})(a.bookmarklet||(a.bookmarklet={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.typlib.CleanupPool,g=a.component.tagoverview.Feed,e=a.typlib.Tracking,d=a.reactive.Functions.eq,b=function(){function a(b,e,f){var c;this.load=this.load.bind(this);if(c=function(a,c,b){this.pool=new k;this.repository=a;this.api=c;this.node=b;this.node.addClass("feed");$("<h2/>").addClass("header").text("News for this site").appendTo(this.node);this.spinner=$("<img src='"+(window.Silk.paths.imagePath+"/ajax-loader.gif")+"'>").addClass("spinner").hide().appendTo(this.node);
this.error=$("<div/>").hide().addClass("error").append($("<span>There was a problem loading the feed, </span>")).append($("<a>please try again</a>").click(this.load)).appendTo(this.node);this.emptyFeed=$("<div/>").hide().addClass("empty").append("<span>There's nothing to show yet, check back later!</span>").appendTo(this.node);this.pool.push(this.taglistLoaded=d(window.Silk.domain.tagList.status,"loaded").name("FeedDocument.taglistLoaded"),this.taglistLoaded.onchange(function(a){a&&this.load()}.bind(this)))}.apply(c||
this,arguments))return c}a.FeedDocument=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.load=function(){var a=this;this.spinner.show();this.error.hide();window.Silk.api.Site.byUri(this.repository.uri.get()).Feed.list(function(b){0==b.count?(a.spinner.hide(),a.emptyFeed.show()):(a.emptyFeed.hide(),g.renderRepoList(a.node,b,void 0,function(){a.spinner.hide()}))},function(){a.error.show();a.spinner.hide();e.trackWithMode("feed-load-failed",{component:"Feed"})})};return a}();l.FeedDocument=
b})(k.dashboard||(k.dashboard={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.domain.Permission,g=a.client.ui.share.Invite,e=a.reactive.Value,d=a.silk.nav.NavLinks,b=a.typlib.Functions,n=k.isViewer,m=k.userName,h=k.role,k=function(){function a(c,b,d,f){var h;this.update=this.update.bind(this);this.updateActive=this.updateActive.bind(this);this.updatePending=this.updatePending.bind(this);if(h=function(a,c,b,d){this.domain=a;this.api=c;this.container=b;this.resentInvites=[];this.last=null;this.domain.permission().done(function(a){e.onchange(this.updateActive)(a.members,
a.admins);e.onchange(this.updatePending)(a.invites,a.admins)}.bind(this));this.invite=new g(a,c,d)}.apply(h||this,arguments))return h}a.Members=a;a.prototype.cleanup=function(){};a.prototype.update=function(){this.domain.permission().done(function(a){a.fetchMemberList();a.fetchInviteList()})};a.prototype.updateActive=function(a,d){this.renderItems(a.sort(b.comparing(h,m)),!1,$("tbody.active",this.container),d)};a.prototype.updatePending=function(a,d){this.renderItems((a||[]).sort(b.comparing(h)),
!0,$("tbody.pending",this.container),d)};a.prototype.renderItems=function(a,b,d,e){var f=this.domain.repository.isPublic.get(),g=this.domain.repository.isPubliclyEditable.get(),l=Resource["Members-row"],k=$("table.users",this.container);a.length&&k.find("tbody.empty").addClass("hidden");d.html("");for(k=0;k<a.length;k++){var m=a[k],r=b?m:m.account.user,p=$(l);p.find(".role").addClass(h(m).toLowerCase());p.find(".role select").val(h(m));r.email==this.domain.user.email.get()?p.find(".role select").change(this.mkChangeRoleActionConfirmation(p,
m)):p.find(".role select").change(this.mkChangeRoleAction(m));b?(-1!=this.resentInvites.indexOf(m.email)?(p.find(".resend").addClass("sent"),p.find(".resend").text("Invite sent!")):p.find(".resend .resend-link").click(this.mkResendInviteCallback(p,m)),p.find("td.buttons .ok").click(this.mkDeleteCallback(p,m))):(p.find(".name").text(r.name),p.find("td.buttons .ok").click(this.mkDeleteUserCallback(p,m)));p.find(".email").text(r.email);p.find("td.remove .delete").click(this.mkConfirmDeleteUserCallback(p,
m,r));p.find("td.buttons .cancel").click(this.mkCancelCallback(p));!f&&!g||n(m)||p.find(".change-role option").filter(function(a,c){return"Viewer"==$(c).text()}).remove();r.email==this.domain.user.email.get()&&1==e.length&&(p.find(".remove *").css("display","none"),p.find(".role select").css("display","none"),p.find(".role span").css("display","none"));this.last==r.email&&(this.highlightNew(p.find("td").filter(function(a,c){return!$(c).hasClass("buttons")})),this.last=null);d.append(p)}};a.prototype.highlightNew=
function(a){a.addClass("new");setTimeout(function(){a.removeClass("new")},2E3)};a.prototype.mkChangeRoleAction=function(a,b,d){var e=this;return function(f){f.preventDefault();a.code?(a.canWrite="Viewer"!=$(this).val(),a.isAdmin="Admin"==$(this).val(),e.api.Invite.saveByEmail(a.email,a,function(){e.last=a.email;e.update();d&&d()})):e.api.Permission.saveById(a.account.user.uuid,{canRead:!0,canWrite:"Viewer"!=$(b||this).val(),isAdmin:"Admin"==$(b||this).val()},function(){e.last=a.account.user.email;
e.update();d&&d()});return!1}};a.prototype.mkResendInviteCallback=function(a,b){var d=this,e=a.find(".resend");return function(a){a.preventDefault();d.api.Invite.byEmail(b.email).resend(function(){d.resentInvites.push(b.email);$(d).trigger("sentInvite");d.last=b.email;e.addClass("sent");e.text("Invite sent!");d.update()},function(){e.addClass("failed");e.text("Sending failed.");d.update()});return!1}};a.prototype.mkChangeRoleActionConfirmation=function(a,b){var e=this;return function(f){f.preventDefault();
console.log(b);a.addClass("confirm");f=a.find(".buttons");f.find(".message").text("Are you sure you want to change your permissions? This will redirect you to the dashboard.");f.find(".ok").text("Change").off("click").click(function(f){e.mkChangeRoleAction(b,a.find(".change-role"),function(){location.href=d.createForGlobalDashboard()})(f)});f.find(".cancel").off("click").click(function(b){a.find(".role .change-role").val("Admin");e.mkCancelCallback(a)(b)})}};a.prototype.mkConfirmDeleteUserCallback=
function(a,b,e){return function(f){f.preventDefault();var h=e.email==this.domain.user.email.get();f=h?"Are you sure you want to remove yourself? You will be redirected to the dashboard.":"Are you sure you want to remove this user?";a.addClass("confirm");var g=a.find(".buttons");g.find(".message").text(f);g.find(".ok").text("Remove").off("click").click(this.mkDeleteUserCallback(a,b,function(){h&&(location.href=d.createForGlobalDashboard())}))}.bind(this)};a.prototype.mkConfirmCallback=function(a){return function(b){b.preventDefault();
a.addClass("confirm");return!1}};a.prototype.mkCancelCallback=function(a){return function(b){b&&b.preventDefault();a.removeClass("confirm");return!1}};a.prototype.mkDeleteUserCallback=function(a,b,d){var e=this;return function(f){function h(){a.addClass("deleted");setTimeout(function(){e.update()},2E3);d&&d()}f.preventDefault();a.removeClass("confirm");a.addClass("deleting");b.account?e.api.Permission.byId(b.account.user.uuid).remove(h):e.api.Invite.byEmail(b.email).remove(h);return!1}};a.prototype.mkDeleteCallback=
function(a,b){var d=this;return function(e){e.preventDefault();a.removeClass("confirm");a.addClass("deleting");d.api.Invite.byEmail(b.email).remove(function(){a.addClass("deleted");setTimeout(function(){d.update()},2E3)});return!1}};return a}();l.Members=k})(k.dashboard||(k.dashboard={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.reactive.Value,g=a.silk.nav.NavLinks,e=a.typlib.Strings,d=a.typlib.Functions,b=a.reactive.Functions.eq,n=function(){function a(b,d){var c;this.incorrectPassword=this.incorrectPassword.bind(this);if(c=function(a,c){this.container=a;this.cancelCallback=c;this.state=new k("hidden");this.domain=window.Silk.domain;this.api=window.Silk.api;this.setupContents();this.setupStyles();this.setupFormEvents();this.setupDeletion();this.state.set("form");
this.container.css("height",0);this.container.animate({height:"175"},"slow")}.apply(c||this,arguments))return c}a.DeleteSiteDialog=a;a.prototype.setupContents=function(){var a=$(e.interpolateAsHtml(Resource.DeleteSiteDialog,{siteURL:e.truncate(this.siteURL(),35)}));a.validate({rules:{password:{required:!0}},messages:{password:{required:"This field is required"}},submitHandler:function(a){var c=$(".password",a).val();$(".keep-domain",a)[0].checked?this.wipeRepo(c):this.deleteRepo(c)}.bind(this)});
this.container.html(a)};a.prototype.setupStyles=function(){$(".actions",this.container).rToggleDisplay(b(this.state,"form"));$(".before-delete-message",this.container).rToggleDisplay(b(this.state,"form"));$(".after-wipe-message",this.container).rToggleDisplay(b(this.state,"after-wipe"));$(".after-delete-message",this.container).rToggleDisplay(b(this.state,"after-delete"));var a=$(".delete-or-wipe",this.container),e=$(".keep-domain",this.container);e.change(d.exec(function(){a.html(e[0].checked?"Wipe":
"Delete")}))};a.prototype.setupFormEvents=function(){var a=this;$("a.cancel",this.container).click(function(b){b.preventDefault();a.container.animate({height:0},"slow","swing",function(){a.container.html("");a.cancelCallback()})})};a.prototype.setupDeletion=function(){$(".delete-or-wipe",this.container).click(function(a){a.preventDefault();$("form",this.container).submit()}.bind(this))};a.prototype.incorrectPassword=function(){$(".password-container .error",this.container).text("Authorization failed, please try again").show()};
a.prototype.deleteRepo=function(a){var b=function(){this.state.set("after-delete");setTimeout(function(){location.href=g.createForGlobalDashboard()},3E3)}.bind(this);this.api.remove(a,b,this.incorrectPassword,null,{ignoreErrors:[401]})};a.prototype.wipeRepo=function(a){var b=function(){this.resetStatistics();this.state.set("after-wipe")}.bind(this);this.api.wipe(a,b,this.incorrectPassword,null,{ignoreErrors:[401]})};a.prototype.resetStatistics=function(){this.domain.repository.documents.set(0);this.domain.tagList.clear()};
a.prototype.siteURL=function(){return window.location.host};return a}();l.DeleteSiteDialog=n})(k.manage||(k.manage={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.client.ui.manage.DeleteSiteDialog,g=a.typlib.Strings,e=function(){function a(b,e,g){var h;this.updatePrivacy=this.updatePrivacy.bind(this);this.templateChanged=this.templateChanged.bind(this);this.siteNameChanged=this.siteNameChanged.bind(this);this.changePrivacyAction=this.changePrivacyAction.bind(this);var f=this;this.changeTemplate=function(){var c=arguments;f.__delayed_toh_changeTemplate__&&clearTimeout(f.__delayed_toh_changeTemplate__);
f.__delayed_toh_changeTemplate__=setTimeout(function(){a.prototype.changeTemplate.apply(f,c);f.__delayed_toh_changeTemplate__=null},500)};this.changeSiteName=function(){var c=arguments;f.__delayed_toh_changeSiteName__&&clearTimeout(f.__delayed_toh_changeSiteName__);f.__delayed_toh_changeSiteName__=setTimeout(function(){a.prototype.changeSiteName.apply(f,c);f.__delayed_toh_changeSiteName__=null},500)};if(h=function(a,b,d){this.domain=a;this.api=b;this.container=d;this.setupInformation();this.domain.repository.privacy.onchange(this.updatePrivacy)}.apply(h||
this,arguments))return h}a.Settings=a;a.prototype.cleanup=function(){};a.prototype.setupInformation=function(){var a=this;this.domain.repository.uri.onchange(function(d){$(".siteuri",a.container).text(d)});this.domain.repository.name.onchange(function(d){$(".sitename input",a.container).not(".changed").val(d)});this.domain.repository.template.onchange(function(d){$(".template input",a.container).not(".changed").val(d)});$(".privacy input:radio",this.container).change(this.changePrivacyAction);$(".sitename input",
this.container).on("input",this.changeSiteName);$("#delete-site",this.container).click(function(a){var b=$(this);b.hasClass("active")||(a.preventDefault(),b.addClass("active"),new k($("#delete-site-content",this.container),function(){b.removeClass("active")}))});this.setupAdmin()};a.prototype.setupAdmin=function(){$(".template",this.container).parents("tr").rToggleDisplay(this.domain.user.globalAdmin,"");$(".privacy .publiclyEditable",this.container).rToggleVisible(this.domain.user.globalAdmin);$(".template input",
this.container).bind("input",this.changeTemplate)};a.prototype.updatePrivacy=function(a){$(".privacy input:radio",this.container).filter(function(d,e){return $(e).val()==a}).each(function(a,b){$(b)[0].checked=!0})};a.prototype.changeTemplate=function(){$(".template",this.container).parents("tr").find("td").removeClass("new");var a=$(".template input",this.container).addClass("changed").val();this.domain.repository.update({template:a},this.templateChanged)};a.prototype.templateChanged=function(){$(".template",
this.container).parents("tr").find("td").addClass("new")};a.prototype.changeSiteName=function(){$(".sitename",this.container).parents("tr").find("td").removeClass("new");var a=g.trim($(".sitename input",this.container).addClass("changed").val());""!=a&&this.domain.repository.update({name:a},this.siteNameChanged,this.changeSiteNameFailed)};a.prototype.siteNameChanged=function(){$(".sitename",this.container).parents("tr").find("td").addClass("new")};a.prototype.changePrivacyAction=function(a){a.preventDefault();
var d=$(a.target).parents("tr").find("td");d.removeClass("new");this.domain.permission().done(function(e){e.changePrivacy($(a.target).val(),function(){d.addClass("new")})})};return a}();l.Settings=e})(k.dashboard||(k.dashboard={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.client.model.Component,l=a.component.tagoverview.Feed,p=a.reactive.Value,g=a.silk.nav.NavLinks,e=a.typlib.Tracking,d=a.reactive.Functions.eq,b=function(){function a(b,d,c){var e;this.renderSites=this.renderSites.bind(this);this.renderSitesList=this.renderSitesList.bind(this);if(e=function(a,c,b){this.canvas=b;this.document=c;this.domain=window.Silk.domain;k.linkToNode(this,a);this.node.addClass("yoursites");this.render()}.apply(e||this,arguments))return e}a.mkLink=
function(a,b,c,d){return $("<li />").append($("<a />").attr("href",b||"javascript:void(0);").text(a)).rToggleDisplay(c).rToggleClass("current",d||new p(!1))};var b=a.mkLink;a.YourSites=a;a.prototype.cleanup=function(){};a.prototype.render=function(){var a=$(Resource.YourSites);this.node.append(a);$(".new-site-container",this.node).hide();$(".dashboard-footer",this.node).hide();$(".new-site-button",this.node).attr("href",g.getWebURI("/signup")).click(function(){e.trackWithMode("new-site-button");return!0});
$(".tutorials-button",this.node).attr("href",g.getWebURI("/tutorials")).click(function(){e.trackWithMode("tutorials-button");return!0});$(".discover-button",this.node).attr("href",g.getWebURI("/home")).click(function(){e.trackWithMode("discover-button");return!0});this.table=$(".site-list .table",this.node);this.renderSites();this.renderFooter()};a.prototype.renderFooter=function(){var a=$(".dashboard-footer",this.node);a.append("<span class=intro>&copy; Silk</span> &mdash; ");[[["Feedback","/feedback"],
["About","/about"],["Blog","http://blog.silk.co"],["Twitter","http://www.twitter.com/silkdotco"],["Facebook","http://www.facebook.com/silkdotco"]]].forEach(function(b){b.forEach(function(c,b){var d="/"==c[1][0]?g.getWebURI(c[1]):c[1];0<b&&a.append("<span class=divider> </span>");a.append($("<a />").attr("href",d).text(c[0]))});a.append("<br>")})};a.prototype.renderSites=function(){var a=this.domain.user.repositories.get(),b=this.domain.repository.uri.get();this.sites=a.filter(function(a){return b==
a.uri}).concat(a.filter(function(a){return b!=a.uri}));this.renderSitesList();$(".new-site-container",this.node).show();$(".dashboard-footer",this.node).show()};a.prototype.renderSitesList=function(){function a(h){var l=$("<div class=site/>").appendTo(m),A=$("<a/>").attr("href","http://"+h.uri+"/dashboard").text(h.name).appendTo(l);h.uri===e&&(l.addClass("current"),A.rText(c),l.prev().addClass("before-current"),l.append($("<ul/>").addClass("current-links").append(b("Dashboard","/dashboard",new p(!0),
d(v.subViewType,"collectionOverview")),b("Feed","/dashboard/feed",x,d(v.subViewType,"feed")),b("Tags","/dashboard/tags",k,d(v.subViewType,"tags")),b("Members","/dashboard/members",g,d(v.subViewType,"members")),b("Settings","/dashboard/settings",g,d(v.subViewType,"settings")),b("Import spreadsheet","/dashboard/import",n),b("Bookmarklet","/dashboard/bookmarklet",k,d(v.subViewType,"bookmarklet")))))}var e=this.domain.repository.uri.get(),c=this.domain.repository.name;if(this.sites&&e){var g=this.domain.user.isAdmin,
k=this.domain.user.canWrite,n=this.domain.user.canWriteExplicit,m=this.table,v=this.document,x=l.canView();this.sites.forEach(a);this.node.addClass("loaded")}};return a}();m.YourSites=b})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.component.ComponentURIs,m=a.client.model.Component,g=a.component.tagoverview.TagRenamer,e=a.reactive.Value,d=a.silk.nav.NavLinks,b=a.silk.nav.NavQuery,n=a.typlib.CleanupPool,r=a.typlib.Functions,h=a.ui.Bubble,f=function(){function a(c,b,d){var e;this.renderCollection=this.renderCollection.bind(this);this.renderNoCollection=this.renderNoCollection.bind(this);this.renderTag=this.renderTag.bind(this);if(e=function(a,c,b){this.canvas=b;this.document=
c;this.pool=new n;this.tagList=b.domain.tagList;this.setupNode(a);this.renderUI()}.apply(e||this,arguments))return e}a.uri=l.TagOverview;a.TagOverview=a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.setupNode=function(a){m.linkToNode(this,a,"tag-overview");this.node.empty()};a.prototype.renderUI=function(){this.node.append();this.table=this.node.find("table.tags.used tbody");this.renderPerCollection();this.renderNoCollection()};a.prototype.renderPerCollection=function(){this.tagList.tags.list.filter(function(a){return 0<
a.docLevelCount.get()}).sort(r.comparing(function(a){return a.docLevelCount.get()})).reverse().forEach(this.renderCollection)};a.prototype.renderCollection=function(a){var c=this.tagList.tags.list.filter(function(c){return 0<c.context.get(a.uri)}).sort(r.comparing(function(a){return a.name.toLowerCase()}));if(c.length){var b=$(Resource.TagOverview);this.node.append(b);var d=b.find("h2").text(a.name),f=new g(new e(a),d,"tag-overview-collection");$("<div class=rename />").attr("title","Rename collection").appendTo(f.root).click(f.toggleRename);
this.pool.push(f.renaming.onchange(function(a){d.parents(".header").toggleClass("renaming",a)},!0));c.forEach(this.renderTag.bind(this,b.find("tbody"),a))}};a.prototype.renderNoCollection=function(){var a=this.tagList.tags.list.filter(function(a){return 0<a.context.get("")}).sort(r.comparing(function(a){return a.name.toLowerCase()}));if(a.length){var c=$(Resource.TagOverview);this.node.append(c);c.addClass("no-collection");c.find("h2").text("Tags used in pages without a collection");a.forEach(this.renderTag.bind(this,
c.find("tbody"),null))}};a.prototype.renderTag=function(a,c,f){var l=c&&c.uri,k=this.tagList,n=f.context.keys().filter(function(a){return a.length}).map(function(a){return k.findByUriOrCreate(a,!0)}).filter(function(a){return a.uri!=l});c=n.map(function(a){return $("<a/>").attr("href",a.uri).text(a.name)});c=$("<td class=collections/>").append(c);var m=d.createForExplore(b.makeTagQueryLink(f,l&&[l])),r=$("<a/>").attr("href",m).text(f.name),p=$("<td class=name/>").append(r),m=$("<td class=rename/>").append($("<div/>")),
z=$("<tr/>").attr("data-tag-uri",f.uri).append(m,p,c).appendTo(a);a=new g(new e(f),r,"tag-overview");m.attr("title","Rename tag").click(a.toggleRename);var B=this.node;this.pool.push(a.tagName.onchange(function(a){B.find("tr[data-tag-uri='"+f.uri+"'] .name a").text(a)},!0));var D=null;this.pool.push(a.renaming.onchange(function(a){z.toggleClass("renaming",a);a&&0<n.length?(a=$("<div class=vog style=padding:10px />").text("Be careful, renaming will also affect tags in other collections."),D=new h(a,
420,40,p,{position:"top",containerClass:"vog"})):D&&D.close()},!0))};a.prototype.serializeToXML=function(){return $(this.node[0].cloneNode(!1)).attr("class","tag-overview")[0]};a.prototype.affectsDirtyState=function(a){return a.target===this.node[0]&&"class"!==a.attribute};a.prototype.node=void 0;a.prototype.table=void 0;return a}();k.TagOverview=f})(m.tagoverview||(m.tagoverview={}))})(a.component||(a.component={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.getHash=function(){return k().anchor()};a.getPath=function(){return k().path()};a.getHref=function(){return location.href};a.getHost=function(){return k().host()};a.getURI=function(){return new Uri(location.href)};var k=a.getURI;return a}();a.Location=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.bookmarklet.BookmarkletDocument,g=a.client.model.Component,e=a.client.ui.dashboard.FeedDocument,d=a.client.ui.dashboard.Members,b=a.client.ui.dashboard.Settings,n=a.component.SiteInfo,m=a.component.YourSites,h=a.component.tagoverview.CollectionOverview,f=a.component.tagoverview.Feed,c=a.component.tagoverview.TagOverview,q=a.reactive.Node,s=a.reactive.Value,u=a.typlib.Location,t=a.typlib.Strings,v=a.typlib.Tracking,x=a.typlib.CleanupPool,
w=function(){function a(c,b){var d;this.renderSubView=this.renderSubView.bind(this);this.renderMembers=this.renderMembers.bind(this);if(d=function(a,c){this.pool=new x;this.type="dashboard";this.title=new s("Your dashboard");this.canvas=a;this.document=this;this.root=$("<div class=dashboard />")[0];this.pool.push(this.subViewType=(new s).name("DashboardDocument.subViewType"),this.subViewType.onchange(this.renderSubView,!0));this.render(a,c)}.apply(d||this,arguments))return d}a.go=function(c,b){b=
b||"collectionOverview";var d=c.document.get();d&&"dashboard"==d.type?d.subViewType.set(b):c.switchDocument(new a(c,b))};a.DashboardDocument=a;a.prototype.cleanup=function(){this.pool.cleanup();(new q(this.root)).cleanup(!0)};a.prototype.switchView=function(a){this.pool.earlyCleanup(this.subView);this.pool.push(this.subView=a)};a.prototype.render=function(a,c){this.renderStructure();this.siteInfo=g.create(n,this);this.topColumn.append(this.siteInfo.node);this.pool.push(this.siteInfo);this.renderWelcome(a);
this.subViewType.set(c)};a.prototype.renderSubView=function(a,c){if(void 0!==a)if(c&&v.trackWithMode("dashboard-view-"+("collectionOverview"==a?"collections":a),{component:"dashboard"}),this.subViewType.set(a),"collectionOverview"==a)this.renderCollectionOverview();else if("tags"==a)this.renderTagOverview();else if("members"==a)this.renderMembers();else if("settings"==a)this.renderSettings();else if("bookmarklet"==a)this.renderBookmarklet();else if("feed"==a)this.renderFeed();else{debugger;console.warn("DashboardDocument: Unknown sub view: "+
a)}};a.prototype.renderStructure=function(){this.topColumn=$("<div class='layout dashboard-top' />");this.wideColumn=$("<div class='layout dashboard-wide' />");this.sideColumn=$("<div class='layout dashboard-side' />");$(this.root).append(this.topColumn,this.sideColumn,this.wideColumn).append("<br class=clear />")};a.prototype.renderMembers=function(){var a=$(Resource.Invite),c=$(Resource.Members).append(Resource.Members_users).append(a);this.wideColumn.html(c);this.switchView(new d(window.Silk.domain,
window.Silk.api,c,a))};a.prototype.renderSettings=function(){var a=$(Resource.Settings);this.wideColumn.empty();this.wideColumn.append(a);this.switchView(new b(window.Silk.domain,window.Silk.api,a))};a.prototype.renderBookmarklet=function(){var a={siteUrl:u.getHost(),siteName:window.Silk.domain.repository.name.get()},a=$(t.interpolateAsHtml(Resource.BookmarkletDocument,a))[0];this.wideColumn.html(a);this.switchView(new k(a,window.Silk.domain.repository))};a.prototype.renderFeed=function(){if(f.canView().get()){var a=
$($("<section/>"));this.wideColumn.html(a);this.switchView(new e(window.Silk.domain.repository,window.Silk.api,a))}else console.log("dashboard..."),location.href="/dashboard"};a.prototype.renderCollectionOverview=function(){this.switchView(g.create(h,this));this.wideColumn.html(this.subView.node)};a.prototype.renderTagOverview=function(){this.switchView(g.create(c,this));this.wideColumn.html(this.subView.node)};a.prototype.renderWelcome=function(a){$('<div class="tutorial-vog">Welcome! If you want help getting started, <a href="http://www.silk.co/tutorials">check out our tutorials</a>.</div>').appendTo(this.topColumn);
var c=$("<div class=your-sites/>").appendTo(this.sideColumn);this.yourSites=new m(c[0],this,a);this.pool.push(this.yourSites)};a.prototype.siteInfo=void 0;a.prototype.topColumn=void 0;a.prototype.wideColumn=void 0;a.prototype.sideColumn=void 0;a.prototype.subView=void 0;a.prototype.yourSites=void 0;return a}();l.DashboardDocument=w})(k.document||(k.document={}))})(m.model||(m.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.model.migrate.GoogleVizToSilkViz,m=a.client.query.Data,g=a.client.query.Roles,e=a.typlib.Arrays,d=a.typlib.Functions,b=a.typlib.Objects,n=a.typlib.Strings,r=function(){function a(){}a.oldJsonToQueryviewData=function(a,b){var d=m.emptyJson();d.view=a.view||"http://typlab.com/2010/components/querytable";if(a.view.match(/googleviz/))d=k(a,d);else if(a.view.match(/querytable$/)||a.view.match(/list$/)||a.view.match(/pagegrid$/))d=r(a,d);a.view.match(/googleviz\/map/)&&
(d=c(a,d,b));a.view.match(/pagegrid/)&&(d=f(a,d,b));return d};a.findProperImgRelation=function(a,c,b){c.roles.column.slice().map(function(a,d){var f=e.last(a.relation);0<b.children("tag[uri='"+f+"']").find("types type").filter(function(a,c){return"image"==$(c).text()}).length&&(c.roles.column.splice(d,1),c.roles.image.push(a))});return c};a.findProperGeoRelation=function(a,c,f){function h(a){return f.children().filter(function(c,b){return $(b).attr("uri")&&$(b).attr("uri").toLowerCase()==a.toLowerCase()})[0]}
function l(a){return a.children("types").children().filter(function(a,c){return"geo"==$(c).text()}).map(function(a,c){return 1*$(c).attr("fraction")}).get()}function k(a){return a.children("types").children().filter(function(a,c){return"numeric"==$(c).text()}).map(function(a,c){return 1*$(c).attr("accuracy")}).get()}function n(a){return a.children("types").children().filter(function(a,c){return"image"==$(c).text()||"video"==$(c).text()}).map(function(a,c){return 1*$(c).attr("accuracy")}).get()}var m=
a.query.filters.filter(function(a){return"type"==a[0]}).map(function(a){return a[1].toLowerCase()}),r=$(e.notNull(m.map(h)));(m=a.viewdata&&a.viewdata.address)?e.equals(m,["document name"])?c.roles.location=[{relation:g.PageTitle}]:c.roles.location=[{relation:m}]:(m=a.query.relations.map(function(a){var c=a[a.length-1];if("document name"==c)return[a,e.sum(l(r))];var b=$(h(c)),c=k(b)[0]||0,d=l(b)[0]||0,b=n(b)[0]||0;return d>c&&d>b?[a,d,0-c]:[a,0,0-c]}),m=e.last(m.sort(d.comparing(b.prop(1),b.prop(2),
function(a){a=e.last(a[0]);return a.match(/location/)||a.match(/address/)||a.match(/city/)||a.match(/street/)}))),!m||0==m[1]||e.equals(m[0],["document name"])?c.roles.location=[{relation:g.PageTitle}]:c.roles.location=[{relation:m[0]}]);c.roles.numeric.length||(a=v(a.viewdata&&a.viewdata.values),c.roles.numeric=a&&a.length?[{relation:a[0]}]:[]);c.roles.distribution=[];return c};a.multichart=function(a,c){var b=e.partition(a.query.filters||[],function(a){return"type"==a[0]}),d=a.query.orders||[],
f=b[0],h=a.viewdata||{};c.view=l.mapView(c.view);c.slice={offset:0,count:200};c.roles.collection=f.map(e.idx(1));c.roles.numeric=e.notNull((h.values||[]).map(v)).map(x);c.roles.order=u(d);c.roles.column=[];d=v(h.enumrelation);c.roles.distribution=d?d.map(e.singleton).map(x):[];c.roles.location=[];c.filters=t(b[1]);return c};a.tableOrList=function(a,c){var b=e.partition(a.query.filters,function(a){return"type"==a[0]}),d=a.query.relations||[],f=a.query.orders||[],h=b[0],g=(a.viewdata||{}).tablefilters||
[];c.slice={offset:0,count:a.queryslice||200};c.roles.order=u(f);c.roles.collection=h.map(e.idx(1));a.view.match(/pagegrid$/)?c.roles.column=d.filter(function(a){return!e.equals(a,["document name"])}).map(x):c.roles.column=d.filter(function(a){return!e.equals(a,["document name"])&&-1==e.indexOf(g,a,e.equals)}).map(x);c.roles.distribution=[];c.roles.location=[];c.roles.numeric=[];c.filters=t(b[1]);return c};a.convertOrders=function(a){return a.map(function(a){return w(a[1],{direction:a[0]?"asc":"desc"})})};
a.convertFilters=function(a){a=a.map(function(a){var c=a[1].split(",").map(n.trim);switch(a[0]){case "is":return w(a[2],{type:"equals",values:c});case "contains":return w(a[2],{type:"matches",values:c});case "less than":return w(a[2],{type:"range",to:a[1]});case "greater than":return w(a[2],{type:"range",from:a[1]});default:console.error("unrecognized filter",a[0])}});return e.group(a,function(a,c){return a.type==c.type&&(g.isPageTitle(a.relation)&&g.isPageTitle(c.relation)||e.equals(a.relation,c.relation))}).map(function(a){if(1==
a.length)return a[0];if("range"==a[0].type){var c=e.notNull(e.mapProp(a,"from")),b=e.notNull(e.mapProp(a,"to"));return{from:c[0],to:b[0],type:a[0].type,relation:a[0].relation}}if("matches"==a[0].type||"equals"==a[0].type)return{values:e.concat(e.mapProp(a,"values")),type:a[0].type,relation:a[0].relation}})};a.whenProperRelation=function(a){if(a instanceof Array&&e.all(function(a){return a&&a.constructor==String},a))return a};a.mkRelation=function(a){return e.equals(a,["document name"])?{relation:g.PageTitle}:
{relation:a}};a.withRelation=function(a,c){c.relation=1==a.length&&"document name"==a[0]?g.PageTitle:a;return c};var f=a.findProperImgRelation,c=a.findProperGeoRelation,k=a.multichart,r=a.tableOrList,u=a.convertOrders,t=a.convertFilters,v=a.whenProperRelation,x=a.mkRelation,w=a.withRelation;return a}();k.OldViewData=r})(m.query||(m.query={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Value,l=a.typlib.Arrays,p=a.typlib.Objects,g=function(){function a(b,d,e){var c;this.cleanupPopping=this.cleanupPopping.bind(this);this.fromUriServer=this.fromUriServer.bind(this);this.fromUri=this.fromUri.bind(this);this.go=this.go.bind(this);if(c=function(a,c,b){c=c||new k;this.history=a;this.doc=c;this.tracking=b;this.routes=[];this.currentVars=this.currentRoute=null;this.isPopping=!1;this.currentVarsPreset=null;this.isUnlinking=!1;this.history&&a.addOnpopstate(function(){this.isPopping=
!0;this.fromUri(this.history.getCurrentUri())}.bind(this));c.onchange(function(a,c){for(var b=0;b<this.routes.length;b++){var d=this.routes[b],e=d.docP&&d.docP(this.doc),f=e&&e.get();e.cleanup();if(f)return this.fromDoc(d,this.doc)}}.bind(this))}.apply(c||this,arguments))return c}a.location=function(a,b){return"/"+l.concatMap(a.uriPattern,function(a){if("constant"==a.type)return[a.name];if("variable"==a.type||"optional"==a.type)return[b[a.name].get()];if("multiple"==a.type||"enum"==a.type)return b[a.name].get();
if("bool"==a.type)return b[a.name].get()?[a.name]:[];throw Error("Unhandled case in location: "+b+" "+a);}).filter(function(a){return null!==a&&void 0!==a}).map(encodeURIComponent).join("/")};a.varsFromPattern=function(a,b){var d={};a.filter(function(a){return"constant"!==a.type}).forEach(function(a){d[a.name]=new k(b?b[a.name]:null)});return d};a.varType=function(a){if(":"==a)return"variable";if("<"==a)return"optional";if("-"==a)return"bool";if("@"==a)return"multiple";if("|"==a)return"enum";if(!a)return"constant";
throw Error("varType: unhandled case: "+a);};var d=a.location,b=a.varsFromPattern,g=a.varType;a.Router=a;a.prototype.addRouteServer=function(a,b,d){d||(d=["GET"]);d=d.map(function(a){return a.toUpperCase()});l.contains(d,"GET")&&!l.contains(d,"HEAD")&&(d=d.concat(["HEAD"]));a={uriPatternString:a,uriPattern:this.makePattern(a),fromUri:b,onDepart:function(){},docP:function(){return new k(!1)},fromDoc:function(){},methods:d};this.routes.push(a)};a.prototype.addRoute=function(a,b,d,c,e){b=b||function(){console.warn("empty fromUri for "+
a)};d=d||function(){};c=c||function(){return new k(!1)};e=e||function(){};var g={uriPatternString:a,uriPattern:this.makePattern(a),fromUri:b,onDepart:d,docP:c,fromDoc:e};this.routes.push(g);c(this.doc).onchange(function(a){a&&!this.currentRoute&&this.fromDoc(g,this.doc)}.bind(this));!this.currentRoute&&this.uriMatchesPattern(this.history.getCurrentUri(),g.uriPattern)&&this.fromUri(this.history.getCurrentUri())};a.prototype.cleanupPopping=function(){this.isPopping=!1};a.prototype.fromUriServer=function(a,
b,d,c,e){var g=!1,l=this.routes.filter(function(c){var d=this.uriMatchesPattern(a,c.uriPattern);g=g||d;return d&&this.matchesMethod(b,c.methods)}.bind(this));l.length?(d=l[0],this.currentVarsPreset=this.uriMatchesPattern(a,d.uriPattern),d.fromUri(this.currentVarsPreset,this.doc.get(),e)):g?c(e):d(e)};a.prototype.fromUri=function(a){var b=this.routes.filter(function(b){return this.uriMatchesPattern(a,b.uriPattern)}.bind(this));b.length?(b=b[0],this.currentVarsPreset=this.uriMatchesPattern(a,b.uriPattern),
b.fromUri(this.currentVarsPreset,this.doc.get())):console.warn("Router: could not find matching route for: "+a.path())};a.prototype.fromDoc=function(a){var e=this.currentRoute,f;this.currentVarsPreset?(f=this.currentVarsPreset,this.currentVarsPreset=null):f=p.mapValues(this.currentVars,function(a){return a.get()});f=b(a.uriPattern,f);a.fromDoc(f,this.doc.get(),this.go);var c=d(a,f);e&&(this.unlinkVars(this.currentVars),e.onDepart());this.currentRoute=a;this.isPopping||!e?(this.isPopping=!1,this.go("replace",
c)):this.go("push",c);this.setCurrentVars(f)};a.prototype.unlinkVars=function(a){this.isUnlinking=!0;for(var b in a)a[b].unlink();this.isUnlinking=!1};a.prototype.go=function(a,b){(new Uri(b)).toString()!=this.history.getCurrentUri().toString()&&("push"==a?(this.history.push(b),this.tracking&&this.tracking.trackPageview()):"replace"==a?this.history.replace(b):console.warn("Router.go: m = "+a+", did nothing"))};a.prototype.matchesMethod=function(a,b){return l.contains(b,a.toUpperCase())};a.prototype.uriMatchesPattern=
function(a,b){var d=a.path().slice(1).split("/").map(decodeURIComponent);l.equals(d,[""])&&d.pop();for(var c={},e=0;e<Math.max(d.length,b.length);e++){var g=d[e],k=b[e];if(!k||"constant"==k.type&&k.name!==g)return!1;if("variable"==k.type)c[k.name]=g;else if("optional"==k.type)c[k.name]=""==g?null:g;else if("bool"==k.type){if(void 0!==g&&""!==g&&g!=k.name)return!1;c[k.name]=!!g}else if("enum"==k.type){if(-1==k.opts.indexOf(g))return!1;c[k.name]=g}else if("multiple"==k.type){c[k.name]=d.slice(e);break}}return c};
a.prototype.makePattern=function(a){if("/"===a)return[];/^\/(.+)$/.test(a)&&(a=RegExp.$1);return a.split("/").map(function(a){if(a.match(/\|/)){a=a.split("|");var b=a[0].split(":"),c=b[0];a[0]=b[1];return{type:g("|"),name:c,opts:a}}b=a.match(/^([:<@-]?)([^:<]+)$/);b[2]||console.warn("Could not find name of component",a);return{type:g(b[1]),name:b[2]}}.bind(this))};a.prototype.setCurrentVars=function(a){this.currentVars=a;for(var b in this.currentVars)this.currentVars[b].onchange(function(){this.isUnlinking||
this.currentVars!==a||this.isPopping||this.history.replace(d(this.currentRoute,this.currentVars))}.bind(this))};return a}();m.Router=g})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(g,e,d){var b;if(b=function(a,b,d){this.location=a;this.history=b;this.addOnpopstate=d;this.supportsHistoryState=k.supportsHistoryState()}.apply(b||this,arguments))return b}a.supportsHistoryState=function(){return"function"===typeof history.pushState&&"function"===typeof history.replaceState};var k=a;a.History=a;a.prototype.redirect=function(a){this.location.href=a};a.prototype.push=function(a){this.supportsHistoryState?this.history.pushState(null,
"",a):this.setHashedURI(a,!1)};a.prototype.replace=function(a){a!=this.getCurrentUri().toString()&&(this.supportsHistoryState?this.history.replaceState(null,"",a):this.setHashedURI(a,!0))};a.prototype.getCurrentUri=function(){var a=new Uri(this.location.href);return new Uri(a.anchor()||a.path())};a.prototype.setHashedURI=function(a,e){this.getCurrentUri().anchor()!=a&&(this.location.hash=a)};return a}();a.History=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Functions,l=a.client.model.document.DashboardDocument,p=a.client.model.document.ImportDocument3,g=a.client.model.document.QueryDocument,e=a.client.query.Data,d=a.client.query.OldViewData,b=a.domain.typing.Context,n=a.typlib.Router,r=a.typlib.History,h=a.typlib.Tracking,f=k.and,c=k.eq,k=function(){function a(){}a.onpopstate=function(a){var c=!1;"WebKit"==$.ua.engine.name&&(c=!0);return a?function(a){$(window).on("load",function(){setTimeout(function(){c=!1},
0)});$(window).on("popstate",function(){c?c=!1:a()})}:function(a){$(window).hashchange(a)}};a.install=function(a,k,m,q,x,w,y,A){function z(a){return function(b){return c(a,b.mapProp("type"))}}function B(a){function c(){m.editFlags.editMode.set(a.edit)}m.editFlags.editMode.set(a.edit);a.widget=!1;var b=m.stashed.get();if(m.stashed.get())F.cleanupPopping(),b.widgetEditing.cancel();else{var b=a.name||"home",d=m.document.get();d&&d.uri&&d.uri.get()==b||(w?(m.switchDocument(q.makeContentDocument(b,w,a.edit,
A)),c(),w=null):q.loadAndRender(b,void 0,a.edit).done(c))}}function D(a,c,b){a.edit.is(m.editFlags.editing);c.activeComponent.onchange(function(c){var d=a.name&&a.name.get(),d=d?"/page/"+d:"";void 0===c?b("push",d+"/edit"):b("push",d+"/edit/widget")});y&&(y=!1,c.dirtyTracking.savedRevision.set(void 0),c.autosaver.autosaveRevision.set(0))}var F=new n(new r(window.location,window.history,this.onpopstate(r.supportsHistoryState())),x,h);F.addRoute("/dashboard/import",function(a,c){m.switchDocument(new p(m,
!0))},function(){},z("import3"),function(a,c,b){});F.addRoute("/dashboard/import/<step",function(a,c){window.location.href="/dashboard/import"});F.addRoute("/dashboard/<subViewType",function(a,c){l.go(m,a.subViewType)},function(){},z("dashboard"),function(a,c,b){c.subViewType.onchange(function(c){c="collectionOverview"==c?null:c;b("push","/dashboard"+(c?"/"+c:""));a.subViewType.set(c)},!0)});F.addRoute("/type:explore|tag/@uri",function(a){if("tag"==a.type)var c=b.normalizeTagUri("/tag/"+encodeURIComponent(a.uri)),
c=g.openWithCollection(c);if("explore"==a.type){var c=new g(m,!1,"explore"),f;a:{try{f=JSON.parse(decodeURIComponent(a.uri[0]))}catch(l){f=void 0;break a}h.trackWithMode("migrate-old-explore-uri",{uri:f},!0);f=d.oldJsonToQueryviewData(f,$(window.Silk.domain.tagList.cache))}(a=f||a.uri.length&&e.uriToJson(a.uri))?c.queryViewer.data.fromJson(a):c.queryViewer.defaultQuery()}m.switchDocument(c)},function(){},function(a){return c(a.mapProp("type"),"query")},function(a,c){a.type.is(c.uri.map(function(a){return a&&
a[0]}));a.uri.is(c.uri.map(function(a){return a&&a.slice(1)}))});F.addRoute("/-edit/-widget",B,function(){},function(a){return f(c("content",a.mapProp("type")),c("home",a.bindProp("uri")))},function(a,c,b){D(a,c,b)});F.addRoute("/page/:name/-edit/-widget",B,function(){},z("content"),function(a,c,b){D(a,c,b);a.name.is(c.uri)});F.addRoute("/page",function(){window.location.href="/page"});return F};return a}();m.SilkRouter=k})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(l){var k=a.client.model.document.DashboardDocument,g=a.reactive.Functions,e=a.silk.nav.NavLinks,d=a.typlib.Tracking,b=function(){function a(b,d,e){var c;this.showDeleteConfirmation=this.showDeleteConfirmation.bind(this);this.hideDeleteConfirmation=this.hideDeleteConfirmation.bind(this);this.deletePage=this.deletePage.bind(this);if(c=function(a,c,b){this.loader=c;this.document=a;this.canDelete=b;this.node=$("#bottom-page-bar");this.setupUI();this.setupActions();
this.setupVisibility()}.apply(c||this,arguments))return c}a.BottomPageBar=a;a.prototype.setupUI=function(){this.node.find(".item-name").rText(this.document.map(function(a){switch(a&&a.type){case "content":return"page";case "tag":return"collection";default:return"item"}}))};a.prototype.setupActions=function(){this.node.find(".feedback").attr("href",e.getWebURI("/feedback"));this.node.find(".delete-page").click(this.showDeleteConfirmation);this.node.find(".delete-page-confirm").click(this.deletePage);
this.node.find(".delete-page-cancel").click(this.hideDeleteConfirmation)};a.prototype.setupVisibility=function(){var a=function(a,c){c.onchange(function(c){c?a.show():a.hide()})}.bind(this),b=this.document,d=b.mapProp("remover"),c=b.mapProp("type"),e=g.eq(c,"dashboard"),c=g.eq(c,"content"),l=this.canDelete,k=g.eq(b.bindProp("uri"),"home");a(this.node,g.or(e,c));a(this.node.find(".feedback"),g.not(e));a(this.node.find(".delete-page"),g.and(d,l));a(this.node.find(".home-text"),k);a(this.node.find(".other-text"),
g.not(k));b.onchange(this.hideDeleteConfirmation)};a.prototype.showDeleteConfirmation=function(a){this.node.find(".delete-page-confirmation").addClass("visible")};a.prototype.hideDeleteConfirmation=function(a){this.node.find(".delete-page-confirmation").removeClass("visible")};a.prototype.deletePage=function(a){a.preventDefault();var b=this;this.node.addClass("loading");this.document.get().remover.remove().done(function(){b.node.removeClass("loading");b.hideDeleteConfirmation();d.trackWithMode("document-deleted",
{component:"bottom-page-bar"});"home"===b.document.get().uri.get()?window.Silk.loader.loadAndRender("home",!0):k.go(window.Silk.canvas)}).fail(function(){b.node.removeClass("loading")})};return a}();l.BottomPageBar=b})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Functions,m=function(){function a(){}a.init=function(){e.shortcutKeys={}};a.isOs=function(b){return function(d){return a.Os===b?d:null}};a.isBrowser=function(b){return function(d){return a.Browser===b?d:null}};a.combo=function(a,b){return{key:b,modifiers:a}};a.first=function(a){return a.reduce(function(a,c){return null===a?c:a},null)};a.shortcut=function(a,b,c){a instanceof window.Array&&(a=d(a));return{combo:a,action:b,applies:c}};a.keyStrings=
function(){var b=a.Os===a.Mac,d=a.Os===a.Windows;return{ctrl:b?"⌃":"Ctrl+",alt:b?"⌥":"Alt+",shift:b?"⇧":"Shift+",meta:b?"⌘":d?"Win+":"Meta+",esc:b?"⎋":"Esc",space:"Space",tab:b?"⇥":"Tab",enter:b?"↩":"Enter",backspace:b?"⌫":"Backspace"}}();a.showCombo=function(e){e instanceof window.Array&&(e=d(e));var f="",c=e.modifiers;c&a.Ctrl&&(f+=b.ctrl);c&a.Alt&&(f+=b.alt);c&a.Shift&&(f+=b.shift);c&a.Meta&&(f+=b.meta);return f+=" "===e.key?b.space:e.key};a.addShortcut=function(a){var b=a.combo;if(b){var c=e.shortcutKeys,
d=c[b.key];d||(d=c[b.key]=[]);d[b.modifiers]&&console.warn("ShortcutKeys.addShortcut: combo",k(b),"already bound to",d[b.modifiers],"when binding to",a.action);d[b.modifiers]={action:a.action,applies:a.applies||l.constant(!0)}}else console.warn("ShortcutKeys: shortcut without combo",a.action)};a.setupShortcutKeys=function(a){e.editing=window.Silk.canvas.editFlags.editing;$(document.documentElement).keydown(m.bind(e))};a.doKeyDown=function(a){var b=e.shortcutKeys[String.fromCharCode(a.which)];b&&(b=
b[a.ctrlKey*e.Ctrl+a.altKey*e.Alt+a.shiftKey*e.Shift+a.originalEvent.metaKey*e.Meta])&&b.applies(a.target)&&(b.action("shortcut"),a.preventDefault())};a.Windows={};a.Mac={};a.Linux={};a.OtherOs={};a.Os=function(){var b=navigator.platform;return-1<b.indexOf("Win")?a.Windows:-1<b.indexOf("Mac")?a.Mac:-1<b.indexOf("Linux")?a.Linux:a.OtherOs}();a.Ctrl=1;a.Alt=2;a.Shift=4;a.Meta=8;a.MetaCtrl=a.Os===a.Mac?a.Meta:a.Ctrl;a.IE={};a.Firefox={};a.Chrome={};a.Safari={};a.Opera={};a.OtherBrowser={};a.Browser=
function(){switch($.ua.browser.name){case "IE":return a.IE;case "Firefox":return a.Firefox;case "Opera":return a.Opera;case "Chrome":return a.Chrome;case "Safari":return a.Safari;default:return a.OtherBrowser}}();a.windows=a.isOs(a.Windows);a.mac=a.isOs(a.Mac);a.linux=a.isOs(a.Linux);a.ie=a.isBrowser(a.IE);a.firefox=a.isBrowser(a.Firefox);a.chrome=a.isBrowser(a.Chrome);a.safari=a.isBrowser(a.Safari);a.opera=a.isBrowser(a.Opera);var e=a,d=a.first,b=a.keyStrings,k=a.showCombo,m=a.doKeyDown;return a}();
k.ShortcutKeys=m;m.init()})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.getOffsetRectForNode=function(a){return k(a.getBoundingClientRect(),a.ownerDocument)};a.getAbsoluteRectForNode=function(a){return g(a.getBoundingClientRect(),a.ownerDocument)};a.getOffsetRect=function(a,b){return d(n,a,b)};a.getAbsoluteRect=function(a,b){return e(n,a,b)};a.getAbsoluteRects=function(a,d){return e(b,a,d)};a.getAbsolute=function(a,b,d){if(d=d.defaultView.frameElement){try{var c=d.getBoundingClientRect()}catch(e){return b}return a(b,
c.top,c.left)}return b};a.getOffset=function(a,b,d){return a(b,d.defaultView.pageYOffset,d.defaultView.pageXOffset)};a.shiftRectsByOffset=function(a,b,d){for(var c=[],e=0;e<a.length;e++)c.push(n(a[e],b,d));return c};a.shiftRectByOffset=function(a,b,d){return{top:a.top+b,bottom:a.bottom+b,left:a.left+d,right:a.right+d,height:a.height,width:a.width}};var k=a.getOffsetRect,g=a.getAbsoluteRect,e=a.getAbsolute,d=a.getOffset,b=a.shiftRectsByOffset,n=a.shiftRectByOffset;return a}();a.Rects=k})(a.typlib||
(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.typlib.Html,g=function(){function a(d,b){var g;this.doMouseDownPillBox=this.doMouseDownPillBox.bind(this);this.doClickPillBox=this.doClickPillBox.bind(this);var k=this;this.delayedAdjustAnchorPadding=function(){var b=arguments;setTimeout(function(){a.prototype.delayedAdjustAnchorPadding.apply(k,b)},0)};if(g=function(a,b){this.picker=a;this.inputEl=b;this.createPillBox();this.refocusPickerInput=!0;this.popClickedPill=!1}.apply(g||this,arguments))return g}
a.Pills=a;a.prototype.push=function(a){this.createPill(a);this.fit()};a.prototype.pop=function(a){this.ignorePop||(this.pillBox.removeChild(this.pillBox.firstChild),this.fit(),a&&(this.ignorePop=!0,this.picker.decreaseCurLevel(!1,!0),this.ignorePop=!1))};a.prototype.reset=function(){for(;this.pillBox.lastChild;)this.pillBox.removeChild(this.pillBox.lastChild);this.fit()};a.prototype.createPillBox=function(){this.pillBox=window.document.createElement("div");this.pillBox._classList=m.getClassList(this.pillBox);
this.pillBox._classList.add("pillBox");this.pillBox.unselectable="on";this.inputEl.parentNode.insertBefore(this.pillBox,this.inputEl);$(this.pillBox).mousedown(this.doMouseDownPillBox);$(this.pillBox).click(this.doClickPillBox)};a.prototype.doMouseDownPillBox=function(a){this.picker.focusInputEl()};a.prototype.doClickPillBox=function(a){a=a.target;if(a._classList.contains("pill")){for(;this.pillBox.firstChild!=a;)this.pop(!0);this.popClickedPill&&this.pop(!0)}this.refocusPickerInput&&this.picker.focusInputEl()};
a.prototype.createPill=function(a){a=a.replace(/<[^>]+>/gi,"");var b=window.document.createElement("div");b._classList=m.getClassList(b);b._classList.add("pill");b.unselectable="on";b.unselectable="on";b.innerHTML=a;b.title=a;this.pillBox.insertBefore(b,this.pillBox.firstChild)};a.prototype.fit=function(){var a=this.pillBox.childNodes.length;this.pillBox.style.display=a?"block":"none";if(a){for(var b=0;b<a;b++)this.pillBox.childNodes[b].style.display="",this.pillBox.childNodes[b].innerHTML=this.pillBox.childNodes[b].title;
for(var e=this.inputEl.offsetWidth-70;this.pillBox.offsetWidth>e;){for(var g=this.pillBox.lastChild,h=g.offsetWidth,b=a-1;1<=b;b--)this.pillBox.childNodes[b].offsetWidth>=h&&(g=this.pillBox.childNodes[b],h=g.offsetWidth);this.pillBox.childNodes[0].offsetWidth>2*h&&(g=this.pillBox.childNodes[0]);if(!this.shorten(g))break}for(;this.pillBox.offsetWidth>e&&100<this.pillBox.lastChild.offsetWidth;)this.shorten(this.pillBox.firstChild);for(b=a-1;1<=b;b--)this.pillBox.offsetWidth>e&&(this.pillBox.childNodes[b].style.display=
"none")}this.delayedAdjustAnchorPadding()};a.prototype.shorten=function(a){var b=a.innerHTML,e=b,g=e.length;if(1<g){var g=Math.floor(g/2),h=e.indexOf("…"),e=-1==h?e.substring(0,g)+"…"+e.substring(g+1):h<g?e.substring(0,h+1)+e.substring(h+2):e.substring(0,h-1)+e.substring(h);a.innerHTML=e}return e!=b};a.prototype.delayedAdjustAnchorPadding=function(){this.inputEl.style.paddingLeft=this.pillBox.offsetWidth?this.pillBox.offsetWidth+8+"px":"";if("Trident"===$.ua.engine.name){var a=this.inputEl.value;
this.inputEl.value=a+" ";this.inputEl.value=a}};return a}();k.Pills=g})(k.Picker||(k.Picker={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.typlib.Html,g=function(){function a(d){var b;this.doMouseDownStackBox=this.doMouseDownStackBox.bind(this);this.doClickStackBox=this.doClickStackBox.bind(this);if(b=function(a){this.picker=a;this.popClickedStackItem=!0}.apply(b||this,arguments))return b}a.Stack=a;a.prototype.push=function(a){this.init();this.createStackItem(a)};a.prototype.pop=function(a){this.init();this.ignorePop||(this.stackBox.removeChild(this.stackBox.lastChild),a&&(this.ignorePop=
!0,this.picker.decreaseCurLevel(!1,!0),this.ignorePop=!1))};a.prototype.reset=function(){for(this.init();this.stackBox.lastChild;)this.stackBox.removeChild(this.stackBox.lastChild)};a.prototype.init=function(){this.initialized||this.createStackBox();this.initialized=!0};a.prototype.createStackBox=function(){this.stackBox=window.document.createElement("div");this.stackBox._classList=m.getClassList(this.stackBox);this.stackBox._classList.add("stackBox");this.stackBox.unselectable="on";this.picker.bodyEl.insertBefore(this.stackBox,
this.picker.bodyEl.firstChild);$(this.stackBox).mousedown(this.doMouseDownStackBox);$(this.stackBox).click(this.doClickStackBox)};a.prototype.doMouseDownStackBox=function(a){this.picker.focusInputEl()};a.prototype.doClickStackBox=function(a){a=a.target;if(a._classList.contains("stackItem")){for(;this.stackBox.lastChild!=a;)this.pop(!0);this.popClickedStackItem&&this.pop(!0)}this.refocusPickerInput&&this.picker.focusInputEl()};a.prototype.createStackItem=function(a){a=a.replace(/<[^>]+>/gi,"");var b=
window.document.createElement("div");b._classList=m.getClassList(b);b._classList.add("stackItem");b.unselectable="on";b.unselectable="on";b.innerHTML=a;b.title=a;this.stackBox.appendChild(b)};return a}();k.Stack=g})(k.Picker||(k.Picker={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Arrays,m=a.typlib.Dates,g=a.typlib.Functions,e=a.typlib.Html,d=a.typlib.Strings,b=a.client.ui.Picker.Pills,n=a.client.ui.Picker.Stack,r=a.typlib.Rects.getAbsoluteRectForNode,h=function(){function a(c,b,d){var h;this.show=this.show.bind(this);this.cancelHide=this.cancelHide.bind(this);this.cancelableHide=this.cancelableHide.bind(this);this.hide=this.hide.bind(this);this.doKeyUp=this.doKeyUp.bind(this);this.doKeyUpNow=this.doKeyUpNow.bind(this);
this.doResize=this.doResize.bind(this);this.doMouseWheelInputEl=this.doMouseWheelInputEl.bind(this);this.doHideEvent=this.doHideEvent.bind(this);this.doScrollEvent=this.doScrollEvent.bind(this);this.doKey=this.doKey.bind(this);this.executeIncreaseCurLevel=this.executeIncreaseCurLevel.bind(this);this.doChange=this.doChange.bind(this);this.showLoadingState=this.showLoadingState.bind(this);var k=this;this.delayedShow=function(){var c=arguments;setTimeout(function(){a.prototype.delayedShow.apply(k,c)},
0)};this.delayedCancelableHide=function(){var c=arguments;setTimeout(function(){a.prototype.delayedCancelableHide.apply(k,c)},50)};this.delayedExecuteOption=function(){var c=arguments;setTimeout(function(){a.prototype.delayedExecuteOption.apply(k,c)},300)};this.executeExecuteCallback=function(){var c=arguments;setTimeout(function(){a.prototype.executeExecuteCallback.apply(k,c)},0)};this.delayedFocusInputEl=function(){var c=arguments;setTimeout(function(){a.prototype.delayedFocusInputEl.apply(k,c)},
100)};this.doDelayedChange=function(){var c=arguments;setTimeout(function(){a.prototype.doDelayedChange.apply(k,c)},0)};this.delayedHighlightOption=function(){var c=arguments;setTimeout(function(){a.prototype.delayedHighlightOption.apply(k,c)},80)};this.startScrollingState=function(){var c=arguments;k.__delayed_toh_isScrolling__&&clearTimeout(k.__delayed_toh_isScrolling__);a.prototype.startScrollingState.apply(k,c)};this.stopScrollingStateNow=function(){var c=arguments;k.__delayed_toh_isScrolling__&&
clearTimeout(k.__delayed_toh_isScrolling__);a.prototype.stopScrollingStateNow.apply(k,c)};this.stopScrollingStateDelayed=function(){var c=arguments;k.__delayed_toh_isScrolling__&&clearTimeout(k.__delayed_toh_isScrolling__);k.__delayed_toh_isScrolling__=setTimeout(function(){a.prototype.stopScrollingStateDelayed.apply(k,c);k.__delayed_toh_isScrolling__=null},200)};if(h=function(a,c,b){var d=$("#"+b)[0];if(b&&d&&(d=d.__picker__,d.headless==c))return d.anchorEl!=a&&(d.hide(),d.setInputValue(d.inputEl==
d.anchorEl?d.__valueAtStart:""),d.setAnchorEl(a)),d;if(a.__picker__)return a.__picker__;a.__picker__=this;this.neverShown=this.cancelOnBlur=!0;this.hasExecuted=!1;this.id=b;this.dataType="text";this.isScrolling=!1;this.executeAfterLoading=this.loadDepth=0;this.anchorEl=a;this.headless=!!c;this.cbPreview={};this.cbCreate={};this.cbSelect={};this.initialized=!0;this.visible=!1;this._clearValue=!0;this.curLevel=0;this.optionsEls=[];this.optionEls=[];this.defaultOptions=[];this.options=[];this.curOptionIdx=
[];this.optionContexts=[];this.optionContextsOptions=[];this.curInputValue="";this.hAlign="alignCenter";this.vAlign="alignBottom";this.showTime=0;this.emptyWarningMessage="No options available";this.reqID=1;this.deepMode="";this.formatCreateOption=g.id;this.allowEmptySelect=!1;this.typingDelay=-1;this.delaySelect=this.blink=!0;this.onChange=null;this.assimilate();this.pickerEl._classList=e.getClassList(this.pickerEl);this.numVisibleOptions=7;this.cbGetOptionsForDataType={date:this.getDateOptions};
this.setDeepMode("stack")}.apply(h||this,arguments))return h}a.Picker=a;a.prototype.createOption=function(a,b,d,e,f,g,h){return{display:a,type:b||this.defaultOptionType,value:d,deep:!!e,create:!!f,noaction:!!g,selected:!!h}};a.prototype.setCancelOnBlur=function(a){this.cancelOnBlur=a};a.prototype.setTypingDelay=function(a){this.typingDelay=a};a.prototype.setGetOptionsCallback=function(a){this.cbGetOptions=a};a.prototype.setClearValue=function(a){this._clearValue=a};a.prototype.setShowCallback=function(a){this.cbShow=
a};a.prototype.setHideCallback=function(a){this.cbHide=a};a.prototype.setIncreaseLevelCallback=function(a){this.cbIncreaseLevel=a};a.prototype.setDecreaseLevelCallback=function(a){this.cbDecreaseLevel=a};a.prototype.setDefaultOptionType=function(a){this.defaultOptionType=a};a.prototype.setEmptyWarningMessage=function(a){this.emptyWarningMessage=a;this.emptyWarningEl&&(this.emptyWarningEl.innerHTML=a)};a.prototype.setEmptiness=function(a,b){this.pickerEl._classList.toggle("emptyHide",a&&!!this.cbCreate||
!!b);this.pickerEl._classList.toggle("empty",a&&!this.cbCreate)};a.prototype.setDataType=function(a){this.pickerEl._classList.remove("dataType-"+this.dataType);this.dataType=a;this.pickerEl._classList.add("dataType-"+this.dataType);this.cbGetOptionsForDataType[a]&&this.setGetOptionsCallback(this.cbGetOptionsForDataType[a]);"date"==a&&this.setEmptyWarningMessage("Please enter a date. Try:<br><ul><li>January 2007</li><li>9/30/1986</li><li>2001</li><li>June 2nd 2005 </li><li>4/1975</li><li>44 BC</li></ul>")};
a.prototype.setPreviewCallback=function(a,b,d,e){this.setCallback("cbPreview",a,arguments)};a.prototype.setCreateCallback=function(a,b,d,e){this.setCallback("cbCreate",a,arguments)};a.prototype.setSelectCallback=function(a,b,d,e){this.setCallback("cbSelect",a,arguments)};a.prototype.setAllowEmptySelect=function(a){this.allowEmptySelect=a};a.prototype.removePreviewCallbacks=function(){this.cbPreview={}};a.prototype.removeCreateCallbacks=function(){this.cbCreate={}};a.prototype.removeSelectCallbacks=
function(){this.cbSelect={}};a.prototype.setDeepMode=function(a){this.pickerEl._classList.replace("deepMode-"+this.deepMode,"deepMode-"+a);this.deepMode=a;switch(this.deepMode){case "stack":this.pills=new n(this,this.inputEl);break;case "pills":this.pills=new b(this,this.inputEl)}};a.prototype.sortOptions=function(a){a.sort(this.sortMethod)};a.prototype.sortMethod=function(a,b){a=a.display;b=b.display;var d=a.toLowerCase(),e=b.toLowerCase();return d>e?1:d<e?-1:a>b?1:a<b?-1:0};a.prototype.setSelectedOptionValue=
function(a){for(var b=this.options[this.curLevel],d=0;d<b.length;d++)b[d].selected=b[d].value==a;this.redrawOptions()};a.prototype.afterLevelChange=function(){};a.prototype.afterRedrawOptions=function(){};a.prototype.getDateOptions=function(a){a=m.txtToStandardizedTxts(a);if(0<a.length)for(var b=0;b<a.length;b++)a[b]=this.createOption(a[b],this.defaultOptionType,a[b],!1,!1,!1,!1);return a};a.prototype.setCallback=function(a,b,d){if(1==d.length)this[a]["*"]=b;else for(var e=1;e<d.length;e++)this[a][d[e]]=
b};a.prototype.resizePicker=function(a){for(var b=0;b<this.optionsEls.length;b++)this.optionsEls[b].style.height=this.optionsEls[b].style.maxHeight=30*a+2+"px"};a.prototype.setAnchorEl=function(a){var b=this.inputEl==this.anchorEl;this.autoOpen&&($(this.anchorEl).unbind("focus",this.delayedShow),$(this.anchorEl).unbind("click",this.delayedShow));b&&this.unbindInputElement();this.anchorEl=a;b&&(this.inputEl=this.anchorEl,this.bindInputElement());this.autoOpen&&($(this.anchorEl).bind("focus",this.delayedShow),
$(this.anchorEl).bind("click",this.delayedShow))};a.prototype.setInputValue=function(a,b){b&&(this.curInputValue=a);e.setInputValue(this.inputEl,a)};a.prototype.setAutoOpen=function(){this.autoOpen=!0;$(this.anchorEl).bind("focus",this.delayedShow);$(this.anchorEl).bind("click",this.delayedShow)};a.prototype.delayedShow=function(){this.show()};a.prototype.show=function(a){this.visible||(this.visible=!0,this.showTime=+new Date,this.hasExecuted=!1,this.resetCurLevel(),this.__valueAtStart=e.getInputValue(this.inputEl),
this._clearValue&&this.setInputValue("",!0),this.neverShown&&($(document).bind("scroll",this.doScrollEvent),this.neverShown=!1),this.cbShow&&this.cbShow(),this.showUI(),this.anchorEl.setAttribute("pickerVisible",!0),this.setEmptiness(!0,!0),this.updateOptions(),a||this.delayedFocusInputEl(),this.positionPicker(!0))};a.prototype.cancelHide=function(){this.hiding=!1;var a=this;window.setTimeout(function(){a.hiding=!1},0)};a.prototype.cancelableHide=function(){this.hiding=!0;this.cancelOnBlur?this.delayedCancelableHide():
this.hide()};a.prototype.delayedCancelableHide=function(){this.hiding&&this.hide()&&this.setInputValue(this.inputEl==this.anchorEl?this.__valueAtStart:"",!0);this.cancelHide()};a.prototype.hide=function(a){this.hiding=!1;if(this.visible){this.visible=!1;if(this.cbHide&&!1===this.cbHide()&&!0!==a)return this.positionPicker(!0),this.delayedFocusInputEl(),!1;this.visible=!1;this.hideUI();this.resetCurLevel();window.getSelection().anchorNode==this.inputEl&&this.inputEl.blur();this.vAlign="alignBottom";
this.anchorEl.setAttribute("pickerVisible",!1);this.stopLoading(!0,!0)}this._clearValue&&this.setInputValue("",!0);return!0};a.prototype.showUI=function(){this.pickerEl._classList.replace("hidden","visible")};a.prototype.hideUI=function(){this.pickerEl._classList.replace("visible","hidden")};a.prototype.resetPrefix=function(){this.setInputValue("",!0)};a.prototype.getInputText=function(){return this.curInputValue};a.prototype.setInputText=function(a,b){this.setInputValue(a,!0);if(b){var d=this;window.setTimeout(function(){d.select()},
500)}};a.prototype.doClickOption=function(a,b,d,e){if(!(250>+new Date-this.showTime)){var f=this.options[this.curLevel][d];if(b==this.curLevel&&e&&f&&f.deep)"click"==a.type&&this.increaseCurLevel();else if(b==this.curLevel)this.executeOptionByIdx(d);else if("click"==a.type)for(;this.curLevel>b;)this.decreaseCurLevel()}};a.prototype.executeOptionByIdx=function(a){a=this.options[this.curLevel][a];this.getExecuteCallback(a)?a?(this.blinkCurrentOption(),this.delaySelect?this.delayedExecuteOption(a):this.executeOptionNow(a)):
this.showError():a.deep&&this.increaseCurLevel()};a.prototype.delayedExecuteOption=function(a){this.executeOptionNow(a)};a.prototype.executeOptionNow=function(a,b){a.noaction?a.deep?(this.increaseCurLevel(),this.doChange()):this.showError():(this._clearValue?this.setInputText(""):(this.__valueAtStart=a.display,this.setInputValue(a.display)),b||this.hideUI(),this.executeExecuteCallback(a))};a.prototype.executeExecuteCallback=function(a){this.hasExecuted||(this.hasExecuted=!0,this.getExecuteCallback(a).call(this,
a,this.optionContextsOptions,this.anchorEl));this.hide()};a.prototype.getExecuteCallback=function(a){return a.create?this.cbCreate[a.type]||this.cbCreate["*"]:this.cbSelect[a.type]||this.cbSelect["*"]};a.prototype.showError=function(){var a=this.pickerEl;a._classList.add("error1");window.setTimeout(function(){a._classList.replace("error1","error2")},80);window.setTimeout(function(){a._classList.replace("error2","error1")},160);window.setTimeout(function(){a._classList.replace("error1","error2")},
240);window.setTimeout(function(){a._classList.remove("error1","error2")},320)};a.prototype.assimilate=function(){this.pickerEl=this.anchorEl.ownerDocument.createElement("div");this.id&&(this.pickerEl.id=this.id);this.pickerEl.className="picker shallow level0 hidden"+(this.headless?" headless":"");this.pickerEl.__picker__=this;$("#documentOverlay")[0].appendChild(this.pickerEl);this.anchorEl.setAttribute("pickerVisible",!1);if("INPUT"==this.anchorEl.nodeName)this.inputEl=this.anchorEl;else{var a=
this.anchorEl.ownerDocument.createElement("div");a.className="head";this.pickerEl.appendChild(a);this.inputEl=this.anchorEl.ownerDocument.createElement("input");this.inputEl.setAttribute("type","search");this.inputEl.setAttribute("spellcheck",!1);this.inputEl.setAttribute("autocapitalize","off");this.inputEl.setAttribute("autocorrect","off");this.inputEl.setAttribute("autocomplete","off");a.appendChild(this.inputEl)}$(this.anchorEl.ownerDocument).bind("mousedown",this.doHideEvent);$(this.anchorEl.ownerDocument).bind("keyup",
this.doHideEvent);$(window).bind("resize",this.doHideEvent);$(window).bind("resize",this.doResize);this.bindInputElement();a=this.bodyEl=this.anchorEl.ownerDocument.createElement("div");a.className="body";this.emptyWarningEl=a.ownerDocument.createElement("div");this.emptyWarningEl.className="emptyWarning";this.emptyWarningEl.innerHTML=this.emptyWarningMessage;a.appendChild(this.emptyWarningEl);this.pickerEl.appendChild(a);this.createOptionsEls()};a.prototype.bindInputElement=function(){"Gecko"===
$.ua.engine.name?$(this.inputEl).bind("keypress",this.doKey):$(this.inputEl).bind("keydown",this.doKey);$(this.inputEl).bind("keyup",this.doKeyUp);$(this.inputEl).bind("cut",this.doDelayedChange);$(this.inputEl).bind("paste",this.doDelayedChange);$(this.inputEl).bind("click",this.doChange);$(this.inputEl).bind("blur",this.doHideEvent);$(this.inputEl).mousewheel(this.doMouseWheelInputEl)};a.prototype.unbindInputElement=function(){"Gecko"===$.ua.engine.name?$(this.inputEl).unbind("keypress",this.doKey):
$(this.inputEl).unbind("keydown",this.doKey);$(this.inputEl).unbind("keyup",this.doKeyUp);$(this.inputEl).unbind("cut",this.doDelayedChange);$(this.inputEl).unbind("paste",this.doDelayedChange);$(this.inputEl).unbind("click",this.doChange);$(this.inputEl).unbind("blur",this.hide);$(this.inputEl).unmousewheel(this.doMouseWheelInputEl)};a.prototype.doKeyUp=function(){this.keyupTOH&&(clearTimeout(this.keyupTOH),this.keyupTOH=null);this.loadDepth&&0<=this.typingDelay&&""!=e.getInputValue(this.inputEl)?
this.keyupTOH=setTimeout(this.doKeyUpNow,this.typingDelay):this.doChange();this.executePendingActions()};a.prototype.doKeyUpNow=function(){this.keyupTOH=null;this.doChange();this.executePendingActions()};a.prototype.doResize=function(){if(this.visible&&this.options[this.curLevel]){var a=this.options[this.curLevel].length,b=r(this.pickerEl.ownerDocument.body);if(!this.headless){var d=r(this.anchorEl),d="alignBottom"==this.vAlign?b.height-d.bottom-20:d.top-20;"stack"==this.deepMode&&(d-=32*this.curLevel);
this.options.length&&(a=Math.max(1,Math.min(this.options[this.curLevel].length,this.numVisibleOptions,Math.floor(d/30))))}this.resizePicker(a);this.headless&&(a=r(this.bodyEl),a.bottom>b.bottom-20&&(this.bodyEl.style.marginTop=parseInt(this.bodyEl.style.marginTop||0)-(a.bottom-b.bottom+20)+"px"))}};a.prototype.doMouseWheelInputEl=function(a,b){this.optionsEls[this.curLevel].scrollTop-=("Gecko"===$.ua.engine.name?10:1)*b};a.prototype.doHideEvent=function(a){this.visible&&("blur"===a.type?setTimeout(function(){"BODY"!==
a.target.ownerDocument.activeElement.nodeName&&this.cancelableHide()}.bind(this),0):e.isAncestorOrSelf(this.pickerEl,a.target)||e.isAncestorOrSelf(this.inputEl,a.target)||this.cancelableHide())};a.prototype.doScrollEvent=function(a){this.positionPicker(!0)};a.prototype.createOptionsEls=function(){if(this.curLevel==this.optionEls.length){var a=this.anchorEl.ownerDocument.createElement("div");a.className="options level"+this.curLevel+" "+(0==this.optionEls.length?"visible":"hidden");a._classList=e.getClassList(a);
this.optionsEls.push(a);this.optionEls.push([]);this.bodyEl.appendChild(a)}};a.prototype.createOptionEl=function(a,b){var d=this.anchorEl.ownerDocument.createElement("div");d.className="option visible type-unkown";d._classList=e.getClassList(d);d.appendChild(d.ownerDocument.createElement("span"));var f=d.ownerDocument.createElement("div");f.className="arrow";f._classList=e.getClassList(f);d.appendChild(f);var g=this;$(d).mouseover(function(){g.isScrolling||a!=g.curLevel||g.setCurOptionIdx(d._classList.contains("canhover")?
b:-1)});$(d).bind("mousedown",function(a){a.preventDefault()});$(d).bind("click",function(d){g.doClickOption(d,a,b,$(d.target).hasClass("arrow"))});return d};a.prototype.delayedFocusInputEl=function(){this.visible&&this.focusInputEl()};a.prototype.focusInputEl=function(){this.cancelHide();this.inputEl.focus();this.inputEl.select()};a.prototype.doKey=function(a){switch(a.keyCode){case 33:this.loadDepth||(this.decreaseCurOptionIdx(this.numVisibleOptions),this.inputEl.selectionStart=this.inputEl.value.length);
a.preventDefault();break;case 34:this.loadDepth||(this.increaseCurOptionIdx(this.numVisibleOptions),this.inputEl.selectionStart=this.inputEl.value.length);a.preventDefault();break;case 38:this.loadDepth||(this.decreaseCurOptionIdx(),this.inputEl.selectionStart=this.inputEl.value.length);a.preventDefault();break;case 40:this.loadDepth||(this.increaseCurOptionIdx(),this.inputEl.selectionStart=this.inputEl.value.length);a.preventDefault();break;case 8:0==this.inputEl.selectionStart&&this.inputEl.selectionStart==
this.inputEl.selectionEnd&&(this.decreaseCurLevel(!0),a.preventDefault());break;case 37:0==this.inputEl.selectionStart&&""==e.getInputValue(this.inputEl)&&(this.decreaseCurLevel(),a.preventDefault());break;case 39:this.inputEl.selectionStart==e.getInputValue(this.inputEl).length&&(this.loadDepth?this.executeAfterLoading=2:this.increaseCurLevel(),a.preventDefault());break;case 9:!this.loadDepth&&(a=e.getInputValue(this.inputEl))&&(a=this.findOptionIndexByTypeAndDisplay(this.options[this.curLevel],
"*",a,!0),-1!=a&&this.executeOptionNow(this.options[this.curLevel][a],!0));break;case 13:this.loadDepth?this.executeAfterLoading=1:this.doEnterOption();a.preventDefault();break;case 27:this.setInputValue(this.inputEl==this.anchorEl?this.__valueAtStart:"",!0),this.hide()}};a.prototype.doEnterOption=function(){var a=this.curOptionIdx[this.curLevel],b=this.options[this.curLevel],b=b&&b[a],d=this.optionEls[this.curLevel],d=(d=d&&d[a])&&$("a",d)[0];b&&"link"==b.type&&d?(a=window.document.createEvent("MouseEvents"),
a.initMouseEvent("click",!0,!0,window,0,-1,-1,-1,-1,!1,!1,!1,!1,0,null),d.dispatchEvent(a)):-1!=a?this.executeOptionByIdx(a):this.allowEmptySelect&&this.executeOptionNow(this.createOption("",this.defaultOptionType,""))};a.prototype.resetCurLevel=function(){for(this.reqID++;this.curLevel;)this.decreaseCurLevel(!1,!0);this.inputEl!=this.anchorEl&&this.setInputValue("");this.pills.reset();this.setCurOptionIdx(-1)};a.prototype.increaseCurLevel=function(){var a=this.getCurrentOption();a&&a.deep?(this.reqID++,
this.blinkCurrentOption(!0),this.optionContextsOptions.push(a),this.optionContexts.push({txt:e.getInputValue(this.inputEl)}),this.setInputValue("",!0),this.curLevel++,this.createOptionsEls(),this.pills.push(a.displayDeep||a.display),this.__callBeforeProcessOptions=this.executeIncreaseCurLevel,this.updateOptions(),this.cbIncreaseLevel&&this.cbIncreaseLevel(a)):this.showError()};a.prototype.executeIncreaseCurLevel=function(){var a=this.optionsEls[this.curLevel-1];a._classList.replace("visible","hidden");
a=this.optionsEls[this.curLevel];a._classList.replace("hidden","visible");this.positionPicker();this.afterLevelChange()};a.prototype.decreaseCurLevel=function(a,b){if(0<this.curLevel){this.__callBeforeProcessOptions&&(this.__callBeforeProcessOptions(),delete this.__callBeforeProcessOptions);this.reqID++;this.stopLoading(!0,!0);this.optionContextsOptions.pop();var d=this.optionContexts.pop();this.setInputValue(a?"":d.txt,!0);if(!b){var e=this.inputEl;e.select();window.setTimeout(function(){e.select()},
500)}var f=this.optionsEls[this.curLevel];f._classList.replace("visible","hidden");this.curOptionIdx[this.curLevel]=-1;this.curLevel--;var g=this.curOptionIdx[this.curLevel];a&&(this.options[this.curLevel]=this.defaultOptions[this.curLevel],""!=d.txt&&(g=0));f=this.optionsEls[this.curLevel];f._classList.replace("hidden","visible");this.pills.pop();this.pickerEl._classList.toggle("empty",!1);this.redrawOptions();this.setCurOptionIdx(g);this.positionPicker();this.afterLevelChange();this.cbDecreaseLevel&&
this.cbDecreaseLevel()}else this.showError()};a.prototype.positionPickerElement=function(){if(this.visible){var a=r(this.pickerEl.parentNode),b=r(this.anchorEl);this.pickerEl.style.top=b.top-a.top+b.height+"px";this.pickerEl.style.left=b.left-a.left+"px";this.pickerEl.style.width=b.width+"px";this.pickerEl.style.height="1px";if(!this.headless&&this.bodyEl.offsetWidth>b.width){a=(b.width-this.bodyEl.offsetWidth)/2;this.bodyEl.style.left=a+"px";var b=a,d=r(this.bodyEl);10>=d.left&&(b+=10-d.left);d.right>=
window.document.documentElement.clientWidth-25&&(b-=d.right-(window.document.documentElement.clientWidth-25));b!=a&&(this.bodyEl.style.left=b+"px")}}};a.prototype.positionPicker=function(a){r(this.pickerEl.parentNode);var b=r(this.anchorEl);a&&this.positionPickerElement();this.pickerEl._classList.add("calcMode");r(this.pickerEl);a=r(this.bodyEl);this.pickerEl._classList.remove("calcMode");if(this.headless&&this.options[this.curLevel]){for(a=b=0;a<this.options[this.curLevel].length;a++)if(this.options[this.curLevel][a].selected){b=
this.optionEls[this.curLevel][a].offsetTop;break}this.bodyEl.style.marginTop=-b+"px"}else"alignTop"!=this.vAlign&&b.bottom+a.height>window.document.documentElement.clientHeight-10&&(this.vAlign="alignTop"),"alignBottom"!=this.vAlign&&(10>b.top-a.height||b.bottom+a.height<=window.document.documentElement.clientHeight-10)&&(this.vAlign="alignBottom"),this.pickerEl._classList.replace("alignTop","alignBottom",this.vAlign);this.doResize()};a.prototype.doDelayedChange=function(){this.doChange()};a.prototype.doChange=
function(){var a=e.getInputValue(this.inputEl);if(a!=this.curInputValue){this.curInputValue=a;if(this.onChange)this.onChange();this.updateOptions()}};a.prototype.updateOptions=function(){if(this.cbGetOptions){var a=e.getInputValue(this.inputEl),b=++this.reqID,d={val:!1};this.options[this.curLevel]&&this.getCurrentOption();this.startLoading();var f=this.cbGetOptions(a,this.optionContextsOptions,this.createOptionsCallback(b,d));f&&(b==this.reqID?this.getOptionsCallback(f,a,this.curLevel,b,d):this.stopLoading())}};
a.prototype.createOptionsCallback=function(a,b){var d=this,f=this.curLevel,g=e.getInputValue(this.inputEl);return function(e){d.getOptionsCallback(e,g,f,a,b)}};a.prototype.getOptionsCallback=function(a,b,f,g,h){if(this.reqID==g){a=l.clone(a);for(var k=0;k<a.length;k++)a[k].txt=a[k].display.replace(/<[^>]+>/g,"").toLowerCase();a.reqID=g;this.options[f]=a;""==b&&(this.defaultOptions[f]=a);this.__callBeforeProcessOptions&&(this.__callBeforeProcessOptions(),delete this.__callBeforeProcessOptions);b=e.getInputValue(this.inputEl);
if(0<d.trim(b).length){f=[];for(var m in this.cbCreate)f.push(m);for(k=0;k<f.length;k++)if(m=f[k],"*"==m&&(m=this.defaultOptionType),-1==this.findOptionIndexByTypeAndDisplay(a,m,b,!1)){for(g=0;a[g]&&f.indexOf(a[g].type)<k;)g++;a.splice(g,0,this.createOption(this.formatCreateOption(b),m,b,!1,!0,!1))}}this.redrawOptions()}h.val||(this.stopLoading(!0,!1),h.val=!0)};a.prototype.findOptionIndexByTypeAndDisplay=function(a,b,d,e){d=d.toLowerCase();for(var f=0;f<a.length;f++)if(!(e&&a[f].create||"*"!=b&&
a[f].type!=b||a[f].txt!=d))return f;return-1};a.prototype.redrawOptions=function(){var a=this.options[this.curLevel];if(a){for(var b=!1,d=!0,f=this.optionsEls[this.curLevel],g=0;g<f.childNodes.length||g<a.length;g++){var h=this.optionEls[this.curLevel][g];h||(h=this.createOptionEl(this.curLevel,g),this.optionEls[this.curLevel].push(h),f.appendChild(h));var k=a[g];if(k){var b=b||k.deep,l=$("<div />").html(k.display).text();h.firstChild.setAttribute("title",l||k.display);k.create?h.firstChild.textContent=
k.display:h.firstChild.innerHTML=k.display;h._classList.set(h.className.replace(/ (type-\S*|new|last|deep|selected|current|noaction|canhover)(\b|$)/g,"")+" type-"+k.type+(k.create?" new":"")+(k.deep?" deep":"")+(k.selected?" selected":"")+(k.noaction?" noaction":"")+(k.deep||!k.noaction?" canhover":"")+(g==a.length-1?" last":""))}k=g<a.length;h._classList.setReplace("hidden","visible",k);d=d&&!k;this.afterRedrawOptions()}this.setEmptiness(d);0==this.curLevel&&""==e.getInputValue(this.inputEl)&&this.pickerEl._classList.replace("shallow",
"deep",b?"deep":"shallow");this.curOptionIdx[this.curLevel]=-1;this.setCurOptionIdx(this.getDefaultOptionIndex(a));this.positionPicker();f.scrollTop=0}};a.prototype.getDefaultOptionIndex=function(a){for(var b=e.getInputValue(this.inputEl).toLowerCase(),d=0,f=0,g=0;g<a.length;g++)if(!a[g].noaction){var h=0;a[g].type==this.defaultOptionType&&(h+=1);a[g].create||(h+=2,a[g].displayDeep&&a[g].displayDeep.toLowerCase()==b&&(h+=4),a[g].display&&a[g].display.toLowerCase()==b&&(h+=8));h>f&&(d=g,f=h)}return d};
a.prototype.blinkCurrentOption=function(a){if(this.blink){var b=this.getCurrentOption();!b||b.noaction&&!b.deep||(this.toggleCurrentOptionCN(this.curLevel,this.curOptionIdx[this.curLevel],!1),this.delayedHighlightOption(2,this.curLevel,this.curOptionIdx[this.curLevel],!1,a))}};a.prototype.delayedHighlightOption=function(a,b,d,e,f){this.highlightOption(b,d,e,f);a--&&this.delayedHighlightOption(a,b,d,!e,!e&&f&&a)};a.prototype.highlightOption=function(a,b,d,e){e=!!e;if(a=this.optionEls[a][b])a._classList.toggle("highlight",
d),(d=$(".arrow",a)[0])&&d._classList.toggle("highlight",e)};a.prototype.toggleCurrentOptionCN=function(a,b,d){var e=this.optionEls[a][b];e&&("tablet"===$.ua.device.type?setTimeout(function(){e._classList.toggle("current",d)},0):e._classList.toggle("current",d))};a.prototype.increaseCurOptionIdx=function(a){this.setCurOptionIdx(this.curOptionIdx[this.curLevel]+(a?a:1))};a.prototype.decreaseCurOptionIdx=function(a){a=-1==this.curOptionIdx[this.curLevel]?this.options[this.curLevel].length-1:Math.max(0,
this.curOptionIdx[this.curLevel]-(a?a:1));this.setCurOptionIdx(a)};a.prototype.setCurOptionIdx=function(a){if(a!=this.curOptionIdx[this.curLevel]){var b=this.options[this.curLevel];b&&-1!=a&&(a=Math.max(0,Math.min(b.length-1,a)));if(a!=this.curOptionIdx[this.curLevel]){this.toggleCurrentOptionCN(this.curLevel,this.curOptionIdx[this.curLevel],!1);if(b&&b.length&&-1!=a){if(b[a].noaction&&!b[a].deep){for(var d=(a-this.curOptionIdx[this.curLevel])/Math.abs(a-this.curOptionIdx[this.curLevel]),f=a+d;b[f]&&
b[f].noaction&&!b[f].deep;f+=d);if(!b[f]||b[f].noaction&&!b[f].deep)for(f=a-d;b[f]&&b[f].noaction&&!b[f].deep;f-=d);a=f;a>=b.length&&(a=-1)}this.curOptionIdx[this.curLevel]=a;-1!=a&&(this.toggleCurrentOptionCN(this.curLevel,this.curOptionIdx[this.curLevel],!0),(d=this.cbPreview[b[a].type]||this.cbPreview["*"])&&d.call(this,b[a],this.optionContextsOptions))}else this.curOptionIdx[this.curLevel]=-1;if(a=this.getCurrentOptionEl())this.startScrollingState(),e.scrollIntoView(a)?this.stopScrollingStateDelayed():
this.stopScrollingStateNow()}}};a.prototype.startScrollingState=function(){this.isScrolling=!0};a.prototype.stopScrollingStateNow=function(){this.isScrolling=!1};a.prototype.stopScrollingStateDelayed=function(){this.isScrolling=!1};a.prototype.startLoading=function(){this.loadDepth++;1==this.loadDepth&&(this.showLoadingStateTOH=setTimeout(this.showLoadingState,1E3))};a.prototype.showLoadingState=function(){this.pickerEl._classList.add("loading")};a.prototype.hideLoadingState=function(){this.pickerEl._classList.remove("loading")};
a.prototype.stopLoading=function(a,b){a&&(this.loadDepth=0);b&&(this.executeAfterLoading=0);this.loadDepth=Math.max(0,this.loadDepth-1);0==this.loadDepth&&(this.hideLoadingState(),this.executePendingActions(),clearTimeout(this.showLoadingStateTOH))};a.prototype.executePendingActions=function(){if(0==this.loadDepth&&this.executeAfterLoading&&!this.keyupTOH){var a=this.executeAfterLoading;this.executeAfterLoading=0;switch(a){case 1:this.doEnterOption();break;case 2:this.increaseCurLevel()}}};a.prototype.getCurrentOption=
function(){return this.options[this.curLevel]?this.options[this.curLevel][this.curOptionIdx[this.curLevel]]:null};a.prototype.getCurrentOptionEl=function(){return this.optionEls[this.curLevel]?this.optionEls[this.curLevel][this.curOptionIdx[this.curLevel]]:null};return a}();k.Picker=h})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.reactive.Value,g=function(){function a(){}a.onFieldsReadyCallback=function(a,b,e,g){g=g||[];m.lift(function(a,d,c){if(c)return b(g.concat([{display:"Instant navigation is temporarily unavailable. Please use our <a href='/page'>static page listing</a>.",type:"error",noaction:!0}]));if(!d&&a){if(!a.length||!a[0].length)return b(g);b(g.concat(e(a)))}})(a.output.body,a.query.first,a.query.error)};return a}();k.PickerQuery=g})(k.bars||(k.bars=
{}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.client.model.document.QueryDocument,g=a.client.query.Print,e=a.client.query.pipeline.Pipeline,d=a.client.tagging.Suggestions,b=a.client.ui.Picker,n=a.client.ui.bars.PickerQuery,r=a.component.queryviewer.Registry,h=a.domain.TagList,f=a.silk.nav.NavLinks,c=a.silk.nav.NavQuery,q=a.typlib.Arrays,s=a.typlib.Functions,u=a.typlib.Html,t=a.typlib.Objects,v=a.typlib.Strings,x=a.typlib.Tracking,w=function(){function a(){var b;this.commitLookup=this.commitLookup.bind(this);
this.getOptionsDelayed=this.getOptionsDelayed.bind(this);this.getOptionsOrNothing=this.getOptionsOrNothing.bind(this);this.getOptions=this.getOptions.bind(this);this.createDocumentOption=this.createDocumentOption.bind(this);var c=this;this.getOptionsDelayed=function(){var b=arguments;c["__delayed_toh_Navigator.getOptionsDelayed__"]&&clearTimeout(c["__delayed_toh_Navigator.getOptionsDelayed__"]);c["__delayed_toh_Navigator.getOptionsDelayed__"]=setTimeout(function(){a.prototype.getOptionsDelayed.apply(c,
b);c["__delayed_toh_Navigator.getOptionsDelayed__"]=null},250)};if(b=function(a,b,c,d){this.id=a;this.repository=b.repository;this.tagList=b.tagList;this.loader=c;this.el=d;this.setupPlaceholder();this.setupPicker();this.setupTracking()}.apply(b||this,arguments))return b}a.getValue=function(b,c){var d=a.getType(b,c),e=u.escapeHtml(b.value);switch(d){case "numeric":break;default:""==e&&b.node.firstChild&&"img"==b.node.firstChild.localName&&(e='<img src="'+b.node.firstChild.attributes[0].value+'"/>')}return e};
a.getType=function(a,b){return a.mostLikely(b)};a.getTypeClass=function(b,c){var d=a.getType(b,c),e=c&&a.getType(b)!=d?"":" inColumnContext";return d+e};a.isNoContext=function(a){return"entity"!==a.pivot||-1===a.value.indexOf("/")};a.isInternalOption=function(a){a=decodeURIComponent(a);return!(a&&(0===a.indexOf("http://")||0===a.indexOf("https://")))};var k=a.isNoContext,l=a.isInternalOption;a.Navigator=a;a.prototype.setupPlaceholder=function(){var a=d.allDocTagsByCount(this.tagList),a=a.slice(0,
2);a.length&&(a=q.mapProp(a,"name").join(", "),$(this.el).attr("placeholder","Search "+a+" and other pages"))};a.prototype.setupPicker=function(){this.picker=new b(this.el,!1,this.id);this.picker.setAutoOpen();this.picker.setDefaultOptionType("document");this.picker.setSelectCallback(this.commitLookup);this.picker.setGetOptionsCallback(this.getOptionsOrNothing);this.picker.numVisibleOptions=this.maxNavigatorOptions;this.picker.setEmptyWarningMessage("No matching pages found");this.picker.setDeepMode("pills");
this.picker.setTypingDelay(250)};a.prototype.setupTracking=function(){this.picker.setIncreaseLevelCallback(function(a){x.trackWithMode("navigate-navigator-godeep",{type:a.type})});this.picker.setDecreaseLevelCallback(function(){x.trackWithMode("navigate-navigator-goback",{})});$("#navigator").mousedown(function(){this.__picker__.visible||x.trackWithMode("navigator-open")})};a.prototype.commitLookup=function(a){function b(a){var c=new m(window.Silk.canvas);c.queryViewer.data.fromJson(a);window.Silk.canvas.switchDocument(c)}
function d(a){a=m.openWithCollection(a.uri);window.Silk.canvas.switchDocument(a)}if(f.canNavigate())switch(x.trackWithMode("navigator-navigate-go",{target:a.type}),a.type){case "document":this.loader.loadAndRender(a.value);break;case "link":location.href=decodeURIComponent(a.value);break;case "explore":!a.value.searchString&&0<a.value.tag.isDocLevel().get()?d(a.value.tag):b(c.makeContextQueryLink(a.value.tag,3,a.value.searchString));break;case "tag":var e=a.value,g=e.incoming?e.nameFilter:e.filter,
e=e.incoming?e.filter:e.nameFilter;b(c.makeTagQueryLink(a.value.tag,a.value.tag.context.keys(),e,g,g?a.value.searchString:void 0,g?void 0:a.value.searchString))}};a.prototype.getOptionsDelayed=function(a,b,c){return this.getOptionsOrNothing(a,b,c,!0)};a.prototype.getOptionsOrNothing=function(a,b,c,d){return this.getOptions(a,b,function(a){a.length?c(a):c([{display:"<em>No results available</em>",noaction:!0}])},d)};a.prototype.getOptions=function(a,b,c,d){var e=!b||!b.length;if(a&&!d&&(e||!q.last(b).staticLookup))return this.getOptionsDelayed(a,
b,c);if(e){d=this.getExploreOptions(a,this.maxExploreTypeOptions);var e=this.getTagOptions(a,Math.min(this.maxExploreTypeOptions,this.maxExploreOptions-d.length)),f=this.getEnumOptions(a,this.maxExploreOptions-d.length-e.length);b=[].concat(d,e,f);if(a&&0<=a.length||2E3>this.repository.documents.get())d=this.getDocumentOptions(a,this.maxNavigatorOptions-d.length-e.length-f.length),n.onFieldsReadyCallback(d,c,function(a){return a.map(s.compose(this.createDocumentOption,q.idx(0),q.idx(0)))}.bind(this),
b);else return b}else if(d=b[b.length-1].type,"document"==d){b=b[b.length-1];var g=b.deepValue||b.value;b=b.val||b.display;d="Homepage"==b?"":" page";var h=[this.picker.createOption("Open <strong>"+u.escapeHtml(b)+"</strong>"+d,"document",g,!1)];d=this.getDoc(g);n.onFieldsReadyCallback(d,c,function(b){var c=b[0][1]?b[0][1].filter(this.matchTag(a)).map(this.getDeepOption(g,!0)):[],d=this.maxNavigatorOptions-h.length,e=Math.max(Math.ceil(d/2),d-c.length);b=b[0][0].filter(this.matchTag(a)).filter(k).map(this.getDeepOption(g));
var f=q.group(b,s.equating(t.prop("tagUri"))).length,l=s.comparing(function(a){return"value"===a.type?2:"taggroup"===a.type?1:0},t.prop("name"),t.prop("tagUri"),t.prop("incoming"),t.prop("val"));return a||b.length+c.length<=d||2>f?(b=b.slice(0,e),b.concat(c.slice(0,d-b.length)).sort(l)):b=q.group(b.concat(c).sort(s.comparing(t.prop("tagUri"),t.prop("incoming"))),s.equating(t.prop("tagUri"),t.prop("incoming"))).map(this.makeTagGroup(g)).sort(l).slice(0,d)}.bind(this),h)}else if("tag"==d){d=b[b.length-
1].value;b=d.tag.uri;var e=-1<["numeric","currency","date"].indexOf(d.tag.types.mostLikely()),l=d.filter||null,m=[this.createTagExploreOption(d,a)];m.map(t.setProp("deep",!1));d=this.getQuery(b,l,a,this.maxNavigatorOptions-m.length,e);n.onFieldsReadyCallback(d,c,function(b){return q.concat(b.map(this.createDeepTagOptions(a,l))).slice(0,this.maxNavigatorOptions-m.length)}.bind(this),m)}else if("explore"===d)d=b[b.length-1].value,b=d.tag.uri,m=[this.createContextExploreOption(d,a)],m.map(t.setProp("deep",
!1)),d=this.getDocQuery(b,a,this.maxNavigatorOptions-m.length),n.onFieldsReadyCallback(d,c,function(a){return a.map(s.compose(this.createDocumentOption,q.idx(0),q.idx(0)))}.bind(this),m);else if("taggroup"===d)return d=b[b.length-1].value,d[0].tag.nameFilter=b[b.length-1].docUri,d[0].tag.incoming=b[b.length-1].incoming,m=[this.createTagExploreOption(d[0].tag,a)],m.map(t.setProp("deep",!1)),m.concat(d.map(function(a){a.displayDeep=a.val||a.ref;"value"===a.type&&(a.type="document");return a}).filter(this.matchTag(a))).slice(0,
this.maxNavigatorOptions);return null};a.prototype.makeTagGroup=function(a){return function(b){var c=b[0];if(1===b.length)return c;b=b.sort(s.comparing(t.prop("val")));var d=c.name+(c.incoming?" for":""),e=b.reduce(function(a,b){return(a.val||a)+", "+b.val});return{display:"<span class='firstColumn'>"+d+":</span> <span>"+e+"</span>",displayDeep:d,type:"taggroup",value:b,deep:!0,noaction:!0,staticLookup:!0,name:d,tagUri:c.tagUri,incoming:c.incoming,docUri:a}}};a.prototype.getQuery=function(a,b,c,d,
f){var h=b||c?[]:[a];b=b?[a+" is "+g.literal(b)]:[];c=c?["(  document name  contains "+g.literal(c)+" and "+a,"   or "+a+" contains "+g.literal(c),")"].join("\n"):[];a=["from all entities","where "+[].concat(h,b,c).join(" \nand "),"select document name and "+g.encodeUri(a),f?"order descending by "+g.encodeUri(a):"order ascending by document name","slice from 0 to "+(d-1)].join("\n");return e.raw(a)};a.prototype.getDocQuery=function(a,b,c){b=b?" and document name contains "+g.literal(b):"";a=["from all entities",
"where document has type "+g.encodeUri(a),b,"select document name ","slice from 0 to "+(c-1)].join("\n");return e.raw(a)};a.prototype.getDoc=function(a){var b="d|"+a;this.currentQueryKey!=b&&(a="from all documents where document name is "+g.literal(a)+" select all document tags and all incoming document tags",this.currentQueryKey=b,this.currentQuery=e.raw(a));return this.currentQuery};a.prototype.getDeepOption=function(b,c){return function(d){var e=d.href;e&&0===e.indexOf("/page/")&&(e=decodeURIComponent(e.substring(6)));
var f=a.getValue(d,!0),g=a.getTypeClass(d,!0),k=h.getNameOrFallback(d.tag,d.tagUri),m=l(e),n="tag"===d.pivot&&m,g=c?"<span class='firstColumn'>"+u.escapeHtml(k)+" for:</span> <span class='"+g+"'>"+f+"</span>":"<span class='firstColumn'>"+u.escapeHtml(k)+":</span> <span class='"+g+"'>"+f+"</span>",m=(n=!n&&e&&e!=b)&&m;return{display:g,displayDeep:k+(c?" for":"")+": "+d.value,type:n?m?"document":"link":"value",value:e||b,deep:m,noaction:!n,name:k,incoming:!!c,tagUri:d.tagUri,val:f,ref:e,tag:d}}};a.prototype.createDeepTagOptions=
function(b,c){return function(d){var e=b&&RegExp("\\b"+v.regexEscape(b),"i"),f=d[0][0],g=f.value.split("/"),h=g[0],k=void 0!==g[1],m=decodeURIComponent(q.last(f.href.split("/"))),n=[];d[1].forEach(function(b){var f=a.getValue(b,!1),g=a.getTypeClass(b,!1),p=c?d[0][0].href:b.href,p=("entity"===b.pivot||c)&&l(p),g="<span class='firstColumn'>"+(k&&d[0][0].parentTag?d[0][0].parentTag.name+" for ":"")+h+":</span> <span class='"+g+"'>"+f+"</span>",r=c?h:f,t=c?m:b.href&&decodeURIComponent(q.last(b.href.split("/")));
e&&!(e.test(m)||e.test(t)||e.test(f))||c&&c.toLowerCase()!==b.value.toLowerCase()||n.push({display:g,displayDeep:r,type:"document",value:m,deepValue:t,deep:p,val:c?r:f})});return n}};a.prototype.getExploreOptions=function(a,b){var c=RegExp("(^|\\s)"+v.regexEscape(a),"i");return this.tagList.sortedDocLevelTags.list.filter(function(a){return a.fuzzy.match(c)}).map(this.createContextExploreOption).slice(0,b)};a.prototype.getTagOptions=function(a,b){var c=RegExp("(^|\\s)"+v.regexEscape(a),"i");return this.tagList.tags.list.filter(function(a){return!a.docLevelCount.get()}).filter(function(a){return a.fuzzy.match(c)}).filter(function(a){return 0<
a.count}).sort(s.flip(s.comparing(function(a){return q.sum(a.outtypes.values())}))).map(this.createTagExploreOption).slice(0,b)};a.prototype.getDocumentOptions=function(a,b){var c=a.toLowerCase()=="homepage".substring(0,a.length),c=["from all documents","where document name contains "+g.literal(a),c?'or document name is "home"':"","select document name"].join("\n");return e.raw(c)};a.prototype.getEnumOptions=function(a,b){var c=RegExp("(^|\\s)"+v.regexEscape(a),"i");this.enumOptions||(this.enumOptions=
this.computeEnumOptions().sort(function(a,b){return b.count-a.count}));for(var d=[],e=0;e<this.enumOptions.length&&d.length<b;e++)this.enumOptions[e].filter.match(c)&&d.push(this.enumOptions[e]);return d.map(this.createTagExploreOption)};a.prototype.computeEnumOptions=function(){for(var a=[],b=this.tagList.tags.list,c=0;c<b.length;c++){var d=b[c].enums,e;for(e in d)a.push({tag:b[c],filter:e,count:d[e]})}return a};a.prototype.createDocumentOption=function(a){var b=decodeURIComponent(q.last(a.href.split("/")));
a="home"==b?"Homepage":u.escapeHtml(a.value);return this.picker.createOption(a,"document",b,!0)};a.prototype.createTagExploreOption=function(a,b){b="string"===typeof b&&b;a={tag:a.tag||a,searchString:b,incoming:a.incoming,filter:a.filter,nameFilter:a.nameFilter};a.searchString=b;var d=r.byUri()[c.typeToQueryViewType(a.tag.types)],d=d?d.label.toLowerCase():"table",e=a.incoming?a.nameFilter:a.filter,f=a.incoming?a.filter:a.nameFilter,f=e?"pages with <strong>"+u.escapeHtml(e)+"</strong> as <strong>"+
u.escapeHtml(a.tag.name)+"</strong>":"<strong>"+u.escapeHtml(a.tag.name)+"</strong> tags"+(f?" for "+u.escapeHtml(f):"");return{display:"Explore "+d+" of "+f+(b?(e?",":"")+' matching "'+u.escapeHtml(b)+'"':""),displayDeep:a.filter?a.filter+" "+a.tag.name:a.tag.name,type:"tag",value:a,deep:!0}};a.prototype.createContextExploreOption=function(a,b){b="string"===typeof b&&b;a={tag:a.tag||a,searchString:b};var c=a.tag.viewData&&a.tag.viewData.view,c=c?r.byUri()[c].label.toLowerCase():"table",d=a.tag.name;
return{display:"Explore "+c+" of <strong>"+u.escapeHtml(d)+"</strong> pages"+(b?' matching "'+u.escapeHtml(b)+'"':""),displayDeep:d,type:"explore",value:a,deep:!0}};a.prototype.matchTag=function(a){return function(b){var c=a&&RegExp("\\b"+v.regexEscape(a),"i");return!c||c.test(h.getNameOrFallback(b.tag,b.tagUri))||c.test(b.value)}};a.prototype.maxExploreTypeOptions=3;a.prototype.maxExploreOptions=5;a.prototype.maxNavigatorOptions=20;a.prototype.enumOptions=void 0;a.prototype.picker=void 0;a.prototype.currentQueryKey=
void 0;a.prototype.currentQuery=void 0;return a}();k.Navigator=w})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.client.ui.ShortcutKeys,g=a.client.ui.bars.Navigator,e=a.silk.nav.NavLinks,d=a.typlib.Html,b=a.typlib.Tracking,n=m.combo,r=m.shortcut,h=m.addShortcut,f=m.MetaCtrl,m=function(){function a(b,c,k,l){var m;this.doClickShowNavigator=this.doClickShowNavigator.bind(this);this.doClickHideNavigator=this.doClickHideNavigator.bind(this);this.doHoverHideNavigator=this.doHoverHideNavigator.bind(this);if(m=function(a,b,c,k){this.inQueryDocument=c.inQueryDocument;
c=$("#navigator")[0];new g("navigatorPicker",a,b,c);h(r(n(f,"O"),c.focus.bind(c)));d.setInputValue(c,"");$("#nb-showNavigator").click(this.doClickShowNavigator);$("#nb-hideNavigator").click(this.doClickHideNavigator);$("#nb-hideNavigator").hover(this.doHoverHideNavigator);$("#navigator-fallback").remove();$("#navigator").show();$("#nb-feedback")[0]&&$("#nb-feedback")[0].attr("href",e.getWebURI("/feedback"))}.apply(m||this,arguments))return m}a.NavBar=a;a.prototype.doClickShowNavigator=function(a){b.trackWithMode("navigator-resize-expand");
$("#navBar").toggleClass("showNavigator");a.preventDefault()};a.prototype.doClickHideNavigator=function(a){b.trackWithMode("navigator-resize-collapse");this.inQueryDocument.get()&&$("#navBar").toggleClass("showNavigator");a.preventDefault()};a.prototype.doHoverHideNavigator=function(a){$("#nb-hideNavigator")[0].title=this.inQueryDocument.get()?"Hide Navigator":""};return a}();k.NavBar=m})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.reactive.Value,g=a.typlib.Tracking,e=a.reactive.Functions.cond,d=function(){function a(b,d,g){var f;this.toggleVisibility=this.toggleVisibility.bind(this);this.dismissDocumentNotifications=this.dismissDocumentNotifications.bind(this);this.dismiss=this.dismiss.bind(this);if(f=function(a,b,d){this.editing=a;this.document=b;this.node=$("#notice-bar");this.visible=(new m(!1)).name("visible");this.type=null;this.stack=[];this.allowInViewMode=
(new m(!1)).name("allowInViewMode");this.allowInEditMode=(new m(!0)).name("allowInEditMode");this.document.onchange(this.dismissDocumentNotifications);m.lift(this.toggleVisibility)(this.visible,this.editing,this.allowInViewMode,this.allowInEditMode,this.document);this.setupDismiss();d.addPageClass(e(this.visible,"notification","no-notification"),!0)}.apply(f||this,arguments))return f}a.NoticeBar=a;a.prototype.toggleVisibility=function(a,b,d,e,c){b=c&&"content"==c.type&&b;a&&(d||b)&&(e||!b)&&c?this.node.addClass("visible"):
this.node.removeClass("visible")};a.prototype.setupDismiss=function(){$(".dismiss",this.node).click(this.dismiss)};a.prototype.showMessage=function(a){var b=this.stack[this.stack.length-1];if(!b||b.type!=a.type||b.msg!=a.msg)return this.type&&this.node.removeClass(this.type),this.node.addClass(a.type),this.type=a.type,$(".message",this.node)[a.html?"html":"text"](a.msg),$(".action",this.node).text(""),a.action&&($(".action",this.node).text(a.action),$(".action",this.node).click(function(b){a.callback();
this.dismiss(b)}.bind(this))),this.stack.push(a),this.visible.set(!0),this.allowInViewMode.set(void 0===a.allowInViewMode?!1:a.allowInViewMode),this.allowInEditMode.set(void 0===a.allowInEditMode?!0:a.allowInEditMode),g.trackWithMode("noticebar-shown",{"Notice Type":a.type,"Notice Message":a.msg,"Failed url (ajax)":a.uri,"Response status (ajax)":a.status,"Response text (ajax)":a.responseText,Visible:this.node.hasClass("visible")},!0),a.discard=function(){var b=this.stack.indexOf(a);0>b||(b==this.stack.length-
1&&this.dismiss(),this.stack.splice(b,1))}.bind(this),a};a.prototype.dismissDocumentNotifications=function(a,b){for(var d=[],e=[],c=0;c<this.stack.length;c++){var g=this.stack[c];g.document===b?d.unshift(g):e.unshift(g)}d.forEach(function(a){a.closeCallback&&a.closeCallback()});this.stack=e;this.showLastOrHide()};a.prototype.dismiss=function(a){a&&a.preventDefault();(a=this.stack.pop())&&a.closeCallback&&a.closeCallback();this.showLastOrHide()};a.prototype.showLastOrHide=function(){var a=this.stack.pop();
a?this.showMessage(a):this.visible.set(!1)};a.prototype.error=function(a,b){b=b||{};b.type="error";b.msg=a;return this.showMessage(b)};a.prototype.warning=function(a,b){b=b||{};b.type="warning";b.msg=a;return this.showMessage(b)};a.prototype.notice=function(a,b){b=b||{};b.type="notice";b.msg=a;return this.showMessage(b)};return a}();k.NoticeBar=d})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(d){var b;this.dismiss=this.dismiss.bind(this);this.destroy=this.destroy.bind(this);if(b=function(a){this.createDialog(a)}.apply(b||this,arguments))return b}a.showOverlay=function(){var a=$("#dialogOverlay");a&&0!=a.length||(a=$("<div id=dialogOverlay>").appendTo("body"));a.addClass("show")};a.hideOverlay=function(){$("#dialogOverlay").removeClass("show")};var g=a.showOverlay,e=a.hideOverlay;a.ModalDialog=a;a.prototype.createDialog=
function(a){this.node=$("<div/>").addClass("modalDialog").addClass(a).append("<div class=close-modal>x</div>");this.contentNode=$("<div class=inside-border />").appendTo(this.node);this.node.hide();$("body").append(this.node)};a.prototype.setContent=function(a){this.contentNode.empty();this.contentNode.html(a)};a.prototype.setPosition=function(a,b){this.node.css("left",a);this.node.css("top",b)};a.prototype.setWidth=function(a){this.node.css("width",a)};a.prototype.setHeight=function(a){this.node.css("height",
a)};a.prototype.centerPosition=function(){var a=$("body"),b=this.node,e=Math.round((a.height()-b.height())/2),a=Math.round((a.width()-b.width())/2);this.setPosition(a,e)};a.prototype.showCloseButton=function(a){this.node.addClass("showCloseButton");$(".close-modal",this.node).click(a)};a.prototype.show=function(a){this.node.show();this.node.addClass();a&&g();this.destroyHook=window.Silk.canvas.document.onchange(this.destroy,!0).name("ModalDialog.destroyHook")};a.prototype.dismiss=function(){this.node?
(e(),this.node.hide()):console.warn("Dialog does not exist")};a.prototype.destroy=function(){this.destroyHook.unlink(!0);this.dismiss();this.node&&this.node.remove();this.node=null};a.prototype.$=function(a){return jQuery(a,this.contentNode)};a.prototype.node=void 0;a.prototype.contentNode=void 0;a.prototype.destroyHook=void 0;return a}();a.ModalDialog=l})(a.ui||(a.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.ui.ModalDialog,m=a.typlib.Tracking,g=a.client.model.newPage.NewPage,e=function(){function a(b){var d;this.validate=this.validate.bind(this);this.hideError=this.hideError.bind(this);this.showError=this.showError.bind(this);this.cancel=this.cancel.bind(this);this.destroy=this.destroy.bind(this);if(d=function(a){this.dialog=new l("namePageDialog");this.dialog.showCloseButton(this.cancel);this.pageError=null;this.callback=a;this.setupDialogContent();
this.setupFormEvents();this.dialog.show();this.errorContainer=this.dialog.$(".error");this.dialog.node.addClass("editing");this.pageNameInput.focus()}.apply(d||this,arguments))return d}a.NamePageDialog=a;a.prototype.setupDialogContent=function(){this.dialog.setContent(Resource.NamePageDialog);this.pageNameInput=$("input[name=pageName]",this.dialog.contentNode)};a.prototype.validate=function(a,d){g.validatePageTitle(this.pageNameInput.val(),a,d)};a.prototype.setupFormEvents=function(){var a=!0,d=this;
$("a.cancel",this.dialog.node).click(function(a){a.preventDefault();d.cancel()});$("form",this.dialog.node).submit(function(a){a.preventDefault();d.validate(function(a,b){d.callback(a,b)},d.showError)});$(this.dialog.node).keydown(function(a){27==a.keyCode&&d.cancel()});this.pageNameInput.keyup(function(){a&&""==d.pageNameInput.val()?a=!1:d.validate(d.hideError,d.showError)})};a.prototype.hideError=function(){this.errorContainer.hide()};a.prototype.showError=function(a){this.errorContainer.text(g.pageUriErrors(a)).show()};
a.prototype.cancel=function(){m.trackWithMode("editor-addpage-cancel");this.dialog.destroy()};a.prototype.destroy=function(){this.dialog.destroy()};return a}();k.NamePageDialog=e})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.reactive.Value,g=a.reactive.Functions,e=a.typlib.Images,d=a.typlib.Svg,b=function(){function a(d,e,c){var g;this.hideIfOutsideMenu=this.hideIfOutsideMenu.bind(this);if(g=function(a,c,d){this.toggle=this.list=this.main=this.top=this.node=null;this.noSplit=c;this.title=d;this.open=(new m(!1)).name("Menu.open");this.anyItems=(new m(!1)).name("Menu.anyItems");this.setupNode(a);this.setupToggle();b(this.toggle);$("body").on("click",this.hideIfOutsideMenu)}.apply(g||
this,arguments))return g}a.fromHtml=function(b,d,c){var e=new a(b.attr("class"),d,c);c=b.children().first();var g=null;d?g=b.children():(e.setMainItem(c.text(),c.attr("class")),g=b.children().slice(1));g.each(function(a,b){e.addItem($(b).contents(),$(b).attr("class"))});return e};a.renderToggle=function(a){d.renderIcon(e.downwardTriangle,20,30,0.23).appendTo(a)};var b=a.renderToggle;a.Menu=a;a.prototype.cleanup=function(){$("body").off("click",this.hideIfOutsideMenu)};a.prototype.hideIfOutsideMenu=
function(a){$(a.target).parents().andSelf().filter(this.node).length||this.open.set(!1)};a.prototype.setupNode=function(a){this.node=$("<div class='toolbar-menu item' />");this.main=$("<span class='toolbar-button top-option' />").appendTo(this.node);this.top=$("<a class=top-option-item />").appendTo(this.main);this.toggle=$("<a class=top-option-arrow />").appendTo(this.main);this.list=$("<div class=toolbar-menu-options />").appendTo(this.node);this.node.addClass(a)};a.prototype.setupToggle=function(){var a=
function(){g.toggle(this.open)}.bind(this);this.toggle.click(a);this.noSplit&&(this.toggle.addClass("no-split"),this.top.click(a),this.top.text(this.title));this.list.rToggleDisplay(this.open);this.toggle.rToggleDisplay(this.anyItems,"inline");this.node.rToggleClass("open",this.open)};a.prototype.setMainItem=function(a,b){this.top.text(a).addClass(b)};a.prototype.addItem=function(a,b){var c=$("<div/>").append(a).addClass("toolbar-button").addClass(b);this.list.append(c);this.anyItems.set(!0)};return a}();
k.Menu=b})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){(function(k){var g=a.arrow.Arrow,e=a.arrow.Dom,d=a.client.model.newPage.NewPage,b=a.reactive.Functions,l=a.reactive.Node,m=a.reactive.Value,h=a.typlib.Functions,f=a.typlib.Objects,c=a.typlib.Tracking,q=g.arr,s=g.constR,u=g.zero,t=g.seq,v=g.sum,x=g.isTrue,w=g.orElse,y=g.isRI,A=g.ifRI,z=g.notRI,B=g.put,D=g.putWith,F=g.fromValue,C=g.unlist,E=e.mkText,G=e.text,L=e.setClass,N=e.click,H=e.mkAnchor,I=e.mkDivClass,M=e.mkSpanClass,e=function(){function a(b,
c,d,e,f){var g;this.toggleMenu=this.toggleMenu.bind(this);this.newPage=this.newPage.bind(this);this.hideIfOutsideMenu=this.hideIfOutsideMenu.bind(this);if(g=function(a,b,c,d,e){this.loader=a;this.node=b;this.canvas=c;this.tagList=e;this.populateMenu(b,d,e);$(window.document.body).click(this.hideIfOutsideMenu)}.apply(g||this,arguments))return g}a.NewPageMenu=a;a.prototype.populateMenu=function(a,b,c){b=g.run(this.menu(b),c.docLevelTags);l.connectNodeLists(b,(new l(a)).childNodes)};a.prototype.menu=
function(a){var c=h.flip(h.comparing(function(a){return a.docLevelCount.get()})),d=function(c){var d=c.input;return a.bind(function(a){var e=b.eq(c["top-tag"].map(f.prop("uri")),d.uri);return a&&(a.categoryTracking&&b.cond(a.categoryTracking.asTag,b.eq(a.categoryTracking.asTag.map(f.prop("uri")),d.uri),e)||a.tagUri&&new m(a.tagUri===d.uri)||e)})},e=t(B("tag"),H(t(q(function(a){return"New "+a.name}),E)),N(this.newPage)),g=t(C,y(d),e,L("top-option-item")),k=t(s(a),q(function(a){return a&&(a.categoryTracking&&
a.categoryTracking.asTag||a.tag)}),x,F,e,L("top-option-item")),l=t(H(G("New page")),N(this.newPage),L("toolbar-button")),n=t(H(u),L("top-option-arrow-old"),N(this.toggleMenu)),d=v(t(C,z(d),e,L("toolbar-button")),l),g=t(q(function(a){return a.sort(c)}),D("top-tag",function(a){return a.head()}),v(M(["toolbar-button","top-option"],w(g,k),n),I("toolbar-menu-options",d)));return t(D("num-categories",function(a){return a.length()}),A(f.prop("num-categories"),g,l))};a.prototype.toggleMenu=function(){$(".toolbar-menu-options",
this.node).toggle();$(this.node).toggleClass("open")};a.prototype.newPage=function(a,b){function e(){window.Silk.canvas.editFlags.editMode.set(!0);f.removeClass("waiting")}var f=$(this.node),g=function(){var a=b.tag&&b.tag.uri,f=this.tagList.findByUri(a),f=f&&f.name;c.trackWithMode("document-created",{component:"new-page-menu"});this.loader.loadAndRenderNew(d.newPageUri(f),a).done(e)}.bind(this);f.addClass("waiting");this.canvas.document.get().statistics?this.canvas.document.get().statistics.wait(g):
g()};a.prototype.hideIfOutsideMenu=function(a){$(a.target).parents(".new-page-menu").length||($(".toolbar-menu-options",this.node).hide(),$(this.node).removeClass("open"))};return a}();k.NewPageMenu=e})(k.productbar||(k.productbar={}))})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.reactive.Functions,g=a.arrow.Dom,e=a.client.model.Component,d=a.client.model.document.ContentDocument,b=a.client.model.newPage.NewPage,n=a.client.ui.NamePageDialog,r=a.client.ui.Sharing,h=a.client.ui.ShortcutKeys,f=a.client.ui.bars.Menu,c=a.client.ui.bars.productbar.NewPageMenu,q=a.component.FigureBlock,s=a.component.QueryViewer,u=a.lib.ui.VogTrigger,t=a.reactive.Value,v=a.silk.nav.NavLinks,x=a.typlib.Arrays,w=a.typlib.Functions,y=a.typlib.Images,
A=a.typlib.Objects,z=a.typlib.Svg,B=a.typlib.Tracking,D=m.and,F=m.or,C=m.cond,E=m.not,G=m.eq,m=function(){function a(){var b;this.savePageShortcut=this.savePageShortcut.bind(this);this.savePage=this.savePage.bind(this);this.performSave=this.performSave.bind(this);this.saveSuccess=this.saveSuccess.bind(this);this.saveFailed=this.saveFailed.bind(this);this.resetTagPage=this.resetTagPage.bind(this);this.saveTagView=this.saveTagView.bind(this);this.saveQueryToExistingHomePage=this.saveQueryToExistingHomePage.bind(this);
this.saveQueryToNewHomePage=this.saveQueryToNewHomePage.bind(this);this.saveQueryDoc=this.saveQueryDoc.bind(this);this.saveQueryHome=this.saveQueryHome.bind(this);this.saveQuery=this.saveQuery.bind(this);this.copyVisualization=this.copyVisualization.bind(this);this.saveWidget=this.saveWidget.bind(this);this.cancelWidget=this.cancelWidget.bind(this);this.editDocument=this.editDocument.bind(this);this.stopEditing=this.stopEditing.bind(this);this.discard=this.discard.bind(this);this.afterDiscarding=
this.afterDiscarding.bind(this);this.undoDiscard=this.undoDiscard.bind(this);this.cancel=this.cancel.bind(this);this.close=this.close.bind(this);var c=this;this.resetSaveTagViewMenu=function(){var b=arguments;c.__delayed_toh_resetSaveTagViewMenu__&&clearTimeout(c.__delayed_toh_resetSaveTagViewMenu__);c.__delayed_toh_resetSaveTagViewMenu__=setTimeout(function(){a.prototype.resetSaveTagViewMenu.apply(c,b);c.__delayed_toh_resetSaveTagViewMenu__=null},1500)};this.resetCopyVisualizationMenu=function(){var b=
arguments;c.__delayed_toh_resetCopyVisualizationMenu__&&clearTimeout(c.__delayed_toh_resetCopyVisualizationMenu__);c.__delayed_toh_resetCopyVisualizationMenu__=setTimeout(function(){a.prototype.resetCopyVisualizationMenu.apply(c,b);c.__delayed_toh_resetCopyVisualizationMenu__=null},1500)};if(b=function(a,b,c,d,e,f,g){this.canvas=a;this.loader=e;this.discarder=f;this.user=b.user;this.silkType=c;this.tagList=b.tagList;this.domain=b;this.repository=b.repository;this.pageApi=d;this.bookmarklet=new t("bookmarklet"===
c);this.editFlags=a.editFlags;this.root=$("#product-bar");this.setupActions(a,e,b.tagList);this.installSharingMenus();this.setupVisibility(a,a.editFlags,f,b.user,c);this.setupContent(a,b.tagList,f);this.setupKeyboardShortcuts(a,a.editFlags);this.setupDraftWarning(a.document,g,a.editFlags)}.apply(b||this,arguments))return b}a.init=function(){k.saveKeyCombo=h.combo(h.MetaCtrl,"S");k.editKeyCombo=h.combo(h.MetaCtrl,"E")};var k=a;a.ProductBar=a;a.prototype.setupActions=function(a,b,d){"product"==this.silkType&&
b&&(new c(b,this.root.find(".new-page-menu")[0],a,a.document,d),this.makeExploreMenu());this.root.find(".save-query").click(this.saveQuery);this.root.find(".save-query-home").click(this.saveQueryHome);this.root.find(".copy-visualization").click(this.copyVisualization);this.root.find(".edit-widget-ok").click(this.saveWidget);this.root.find(".edit-widget-cancel").click(this.cancelWidget);this.root.find(".save-page").click(this.savePage);this.root.find(".save-tag-view").click(this.saveTagView);this.root.find(".edit-homepage").click(this.editDocument);
this.root.find(".edit-page").click(this.editDocument);this.root.find(".stop-editing").click(this.stopEditing);this.root.find(".discard").click(this.discard);this.root.find(".undo-discard").click(this.undoDiscard);this.root.find(".cancel").click(this.cancel);this.root.find(".close").click(this.close)};a.prototype.installSharingMenus=function(){var a=this.domain.user.isAdmin.get()?["invite"]:[];r.install(this.root.find(".share-embed"),"embed twitter facebook linkedin email link".split(" "),this.canvas.document.bind(A.prop("queryViewer",
"data","fullUri")),this.canvas.document,this.repository,this.domain.user);r.install(this.root.find(".share"),["twitter","facebook","linkedin","email","link"].concat(a),new t,this.canvas.document,this.repository,this.domain.user)};a.prototype.makeExploreMenu=function(){var a=this.root.find(".explore-menu");this.exploreMenu=f.fromHtml(a,!0,"Save visualization");a.replaceWith(this.exploreMenu.node)};a.prototype.setupVisibility=function(a,b,c,d,e){function f(a,b){a.rToggleDisplay(b)}var g=a.document,
h=g.mapProp("type"),k=g.bindProp("mode");a=G(h,"content");d=G(h,"import");e=G(h,"query");var l=G(h,"dashboard"),h=G(h,"import2"),m=b.editing;E(m);var n=G(g.bindProp("uri"),"home"),p=!!c,r=g.mapProp("dirtyTracking").bindProp("dirty");c=p?G(c.savedWorking.mapProp("uri"),g.bindProp("uri")):!1;b=b.canCreate;var q=this.bookmarklet,s=q.get()?window.Silk.bookmarkletData.isMinimized:new t(!1),g=g.bindProp("isNew"),v=D(e,F(G(k,"explore"),G(k,"collection"))),k=D(e,G(k,"widget")),u=G(this.repository.documents,
0);this.canSave=D(a,C(q,E(s),D(m,r)));var z=this.user.permission.map(function(a){return a&&a.account&&a.account.user});f(this.root,F(a,e,d,l,h));f(this.root.find(".goto-homepage"),l);f(this.root.find(".goto-dashboard"),D(z,F(E(m),v,h),E(q),E(l)));f(this.root.find(".new-page-menu"),D(b,F(v,E(m)),F(a,l,v),E(u),E(q)));f(this.root.find(".edit-homepage"),D(b,E(m),n));f(this.root.find(".edit-page"),D(b,E(m),E(n),a,E(q)));f(this.root.find(".undo-discard"),D(p,E(r),F(E(m),g),c,E(e),E(l),E(d),E(h)));f(this.root.find(".stop-editing"),
D(a,E(g),m,E(r)));f(this.root.find(".delete-new"),D(g,E(r),E(q)));f(this.root.find(".discard"),D(p,a,m,r,E(q)));f(this.root.find(".save-page"),D(a,this.canSave));f(this.root.find(".cancel"),D(q,m,r,E(s)));f(this.root.find(".close"),D(q,E(m)));f(this.root.find(".explore-menu"),D(e,b,v));f(this.root.find(".explore"),D(a,E(m),E(q)));f(this.root.find(".edit-widget-title"),k);f(this.root.find(".edit-widget-ok"),k);f(this.root.find(".edit-widget-cancel"),k);f(this.root.find(".permissions"),(new t(!0)).name("ProductBar.permissions"));
f(this.root.find(".site"),(new t(!0)).name("ProductBar.site"));f(this.root.find(".share"),D(a,E(m),E(q)));f(this.root.find(".share-embed"),D(e,E(k)))};a.prototype.setupContent=function(a,b,c){this.root.find(".save-page").rText(a.document.bind(function(a){return a&&a.saver&&a.saver.saving}).map(function(a){return a?"Saving...":"Save Page"}).name("ProductBar.saveText"));c&&this.root.find(".discard").rText(c.busy.map(function(a){return a?"Discarding...":"Discard Changes"}).name("ProductBar.discardText"));
a.document.bindProp("collection").onchange(function(a){a&&1==a.length?(this.exploreMenu.anyItems.set(!0),this.root.find(".save-tag-view span").text(b.findByUriOrCreate(a[0],!0).name)):this.exploreMenu.anyItems.set(!1)}.bind(this));this.root.find(".edit-widget-title span").rText(this.canvas.stashed.bindProp("title"));var d=x.last(x.sortByComparing(this.tagList.tags.list.filter(function(a){return 0<a.docLevelCount.get()}),function(a){return a.docLevelCount.get()}));this.root.find(".explore").rAttr("href",
this.canvas.document.bind(A.prop("categoryTracking","category")).map(function(a){return v.exploreCollection(a||d&&d.uri)}));a=h.showCombo(k.saveKeyCombo);c=h.showCombo(k.editKeyCombo);this.root.find(".save-page").attr("title","Save page "+a);this.root.find(".edit-page").attr("title","Edit page "+c);this.root.find(".edit-homepage").attr("title","Edit page "+c);this.root.find(".stop-editing").attr("title","Edit page "+c);a=this.root.find(".share");c=this.root.find(".share-embed");var e=$("<div class=facebook />").append(z.renderIcon(y.facebook,
24,24,0.65));$("<div class=twitter  />").append(z.renderIcon(y.twitter,24,24,0.77)).prependTo(a).clone().prependTo(c);e.prependTo(a).clone().prependTo(c)};a.prototype.setupKeyboardShortcuts=function(a,b){h.setupShortcutKeys(a);h.addShortcut(h.shortcut(k.editKeyCombo,function(){var a=this.canvas.document.get(),a=a&&a.dirtyTracking?a.dirtyTracking.dirty.get():!1,c=b.editMode.get();c?c&&!a&&b.editMode.set(!1):b.editMode.set(!0)}.bind(this)));h.addShortcut(h.shortcut(k.saveKeyCombo,this.savePageShortcut,
function(){return b.editing.get()}))};a.prototype.savePageShortcut=function(){this.canSave.get()&&this.savePage()};a.prototype.setupDraftWarning=function(a,b,c){this.bookmarklet.get()||new u(b,{pred:D(G("content",a.mapProp("type")),E(c.editMode),c.forcedEdit),text:"You are working on a saved draft.<br><a href=# rel=save>Save</a> or <a href=# rel=discard>discard</a> your changes.",actions:{save:this.savePage,discard:this.discard},targetArrow:g.select("#product-bar .save-page"),targetRoot:t.value($("#page-bars-container")[0]),
width:260,height:65})};a.prototype.savePage=function(){var a=this.canvas.document.get();if(a.dirtyTracking.dirty.get()){var c=function(b){a.uri.set(b);this.performSave(this.performSave);this.pageApi(e).remove();this.pageApi(e).Autosave.current().remove()}.bind(this),d=function(a,b){2===b?a=a+"-"+String(b):2<b&&(a=a.replace(/\d+$/,String(b)));this.domain.apiHelpers.documentExists(a,d.bind(this,a,b+1),w.partial(c,a))}.bind(this),e=a.uri.get();if(a.hasNewUri.get()){var f=b.formatPageUri(a.title.get());
if("(Untitled)"!==a.title.get())B.trackWithMode("document-auto-name",{component:"product-bar"}),d(f,1);else{B.trackWithMode("document-name-dialog",{component:"product-bar"});var g=new n(function(b,d){g.destroy();a.documentTitle.setTitle(d);c(b)})}}else B.trackWithMode("document-saved",{component:"product-bar",uri:a.uri.get()}),this.performSave(this.savePage)}};a.prototype.performSave=function(a){var b=this.canvas.document.get();$(b.root).removeAttr("data-new");b.isNew.set(!1);b.saver.save(!1,this.saveSuccess,
w.partial(this.saveFailed,a))};a.prototype.saveSuccess=function(){this.savingFailedMessage&&this.savingFailedMessage.discard();this.editFlags.editMode.set(!1)};a.prototype.saveFailed=function(a){this.savingFailedMessage&&this.savingFailedMessage.discard();this.savingFailedMessage=window.Silk.ui.noticeBar.error("Saving failed. Your internet connection might be down or our servers might be under stress.",{html:!0,callback:a,action:"Try again.",document:this.canvas.document.get()})};a.prototype.resetTagPage=
function(){var a=this.canvas.document.get();a.viewSaver.load();a.mode.set("collection");a.dirtyTracking.dirty.set(!1);a.queryViewer.fixLayout()};a.prototype.saveTagView=function(){this.canvas.document.get().viewSaver.save();var a=this.root.find(".save-tag-view").contents();this.root.find(".save-tag-view").html("<span>Saved<span>");this.resetSaveTagViewMenu(a)};a.prototype.resetSaveTagViewMenu=function(a){this.root.find(".save-tag-view").html(a);this.exploreMenu.open.set(!1)};a.prototype.saveQueryToExistingHomePage=
function(a,b){this.loader.loadDocument("home",!0).then(function(c){this.saveQueryDoc(c,a,b)}.bind(this))};a.prototype.saveQueryToNewHomePage=function(a,c){var d=this.loader.makeContentDocument("home",b.createNewHomePage(this.loader.repository.name.get()),!0,!1);this.saveQueryDoc(d,a,c)};a.prototype.saveQueryDoc=function(a,b,c){this.canvas.switchDocument(a);this.editFlags.editMode.set(!0);var d=e.create(s,{document:a,canvas:this.canvas});b=e.createNode(q,{content:d.node,title:b.getTitle()});d.data.fromJson(c);
c=$("section.header > .layout").children().first();c.length?c.after(b):(c=$("#canvas .body"),b=$("<div class='layout content'></div>").append(b),c.append(b));a.autosaver.autosave(!0);a.dirtyTracking.savedRevision.set(void 0);a.autosaver.autosaveRevision.set(0)};a.prototype.saveQueryHome=function(){var a=this.canvas.document.get(),b=a.queryViewer.data.json.flat().get();this.pageApi("home").get(function(){this.saveQueryToExistingHomePage(a,b)}.bind(this),function(c){404==c.status&&this.saveQueryToNewHomePage(a,
b)}.bind(this))};a.prototype.saveQuery=function(){var a=this.canvas.document.get(),c=a.queryViewer.data.json.flat().get(),f=b.newPageUri(),g=b.createNewRegularPage(f,null,null),f=new d(f,g,this.canvas,this.tagList,this.repository);this.canvas.switchDocument(f);var h=e.create(s,{document:f,canvas:this.canvas}),a=e.createNode(q,{content:h.node,title:a.getTitle()});h.data.fromJson(c);g.find(e.selectorFor("KeyValue")).parent().after(a);f.autosaver.autosave(!0);f.dirtyTracking.savedRevision.set(void 0);
f.autosaver.autosaveRevision.set(0)};a.prototype.copyVisualization=function(){var a=this.canvas.document.get(),b=a.queryViewer.data.json.flat().get(),c={document:this.canvas.clipboardDocument,canvas:this.canvas},b=s.create(c,{data:b}),a=e.create(q,c,{content:b.node,title:a.getTitle()});this.canvas.clipboard.cut(a);a=this.root.find(".copy-visualization");c=a.contents();a.html("<span>Copied to clipboard</span>");this.resetCopyVisualizationMenu(c)};a.prototype.resetCopyVisualizationMenu=function(a){this.root.find(".copy-visualization").html(a);
this.exploreMenu.open.set(!1)};a.prototype.saveWidget=function(){this.canvas.stashed.get().widgetEditing.save()};a.prototype.cancelWidget=function(){this.canvas.stashed.get().widgetEditing.cancel()};a.prototype.editDocument=function(){B.trackWithMode("document-edit",{component:"product-bar"});this.editFlags.editMode.set(!0)};a.prototype.stopEditing=function(){B.trackWithMode("document-edit-cancel",{component:"product-bar"});this.editFlags.editMode.set(!1)};a.prototype.discard=function(){var a=this.canvas.document.get(),
a=a&&a.dirtyTracking?a.dirtyTracking.dirty.get():!1;B.trackWithMode("document-edit-discard",{component:"product-bar"});a?this.discarder.discard(this.afterDiscarding):this.afterDiscarding()};a.prototype.afterDiscarding=function(){this.canvas.document.get().isNew.get()||this.editFlags.editMode.set(!1)};a.prototype.undoDiscard=function(){this.discarder.undoDiscard();B.trackWithMode("document-undo-discard",{component:"product-bar"});this.editFlags.editMode.set(!0)};a.prototype.cancel=function(){B.trackWithMode("bookmarklet-cancel",
{component:"product-bar"});window.Silk.cancelBookmarklet()};a.prototype.close=function(){B.trackWithMode("bookmarklet-close",{component:"product-bar"});window.Silk.cancelBookmarklet()};a.prototype.exploreMenu=void 0;a.prototype.canSave=void 0;a.prototype.savingFailedMessage=void 0;return a}();k.ProductBar=m;m.init()})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){(function(k){var g=a.reactive.Functions,e=a.typlib.Images,d=a.typlib.Svg,b=function(){function a(b,d){var e;this.toggleVisibility=this.toggleVisibility.bind(this);this.toggleMenu=this.toggleMenu.bind(this);this.setToggleText=this.setToggleText.bind(this);this.toggleSubscription=this.toggleSubscription.bind(this);this.clickOtherOption=this.clickOtherOption.bind(this);this.selectFrequency=this.selectFrequency.bind(this);this.hideIfOutsideMenu=this.hideIfOutsideMenu.bind(this);
if(e=function(a,b){this.node=a;this.domain=b;this.setupVisibility();this.setupArrow();this.setupToggleSubscription();this.setupOtherOptions();$(window.document.body).click(this.hideIfOutsideMenu)}.apply(e||this,arguments))return e}a.FollowMenu=a;a.prototype.setupVisibility=function(){g.not(this.domain.user.anonymous).onchange(this.toggleVisibility)};a.prototype.toggleVisibility=function(a){$(this.node).toggle(a)};a.prototype.setupArrow=function(){var a=$(".top-option-arrow",this.node).click(this.toggleMenu);
d.renderIcon(e.downwardTriangle,20,20,0.2).appendTo(a)};a.prototype.toggleMenu=function(){$(this.node).toggleClass("expanded")};a.prototype.hideMenu=function(){$(this.node).removeClass("expanded")};a.prototype.setupToggleSubscription=function(){this.domain.subscription.subscribedInstant.onchange(this.setToggleText);$(".top-option-item",this.node).click(this.toggleSubscription)};a.prototype.setToggleText=function(a){$(".top-option",this.node).toggleClass("selected",a)};a.prototype.toggleSubscription=
function(){this.domain.subscription.toggleSubscription(!0)};a.prototype.setupOtherOptions=function(){this.domain.subscription.frequencyInstant.onchange(this.selectFrequency);$(".toolbar-menu-options a",this.node).click(this.clickOtherOption)};a.prototype.clickOtherOption=function(a){this.toggleFrequency(a.target);this.hideMenu()};a.prototype.selectFrequency=function(a){$(".toolbar-menu-options a",this.node).removeClass("selected");a&&$(".follow-"+a,this.node).addClass("selected")};a.prototype.toggleFrequency=
function(a){a=a.className.split(" ").filter(function(a){return 0===a.indexOf("follow-")}).map(function(a){return a.substring(7)})[0];this.domain.subscription.toggleFrequency(a,!0)};a.prototype.hideIfOutsideMenu=function(a){$(a.target).parents("#follow-site-menu").length||this.hideMenu()};return a}();k.FollowMenu=b})(k.topbar||(k.topbar={}))})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){(function(k){var g=a.client.model.document.ImportDocument3,e=a.silk.nav.NavLinks,d=a.typlib.Svg,b=a.ui.Bubble,l=a.domain.Tag,m=function(){function a(b,c,d){var e;this.reset=this.reset.bind(this);this.loop=this.loop.bind(this);this.update=this.update.bind(this);this.renderBubble=this.renderBubble.bind(this);if(e=function(a,b,c){b.user.canWriteExplicit.get()&&(this.node=a,this.domain=b,this.canvas=c,this.setupBubble(),this.reset(),this.loop())}.apply(e||
this,arguments))return e}a.ImportProgress=a;a.prototype.reset=function(){this.status=this.data=null;this.node.hide();this.bubbleRef.bubble&&this.bubbleRef.close();clearTimeout(this.loopTimeout)};a.prototype.setupBubble=function(){this.bubbleContent=$("<div class=topbar-import-bubble>");this.bubbleRef={};b.click(this.node,this.bubbleContent,250,null,this.node,{position:"bottom",onShow:this.renderBubble},null,this.bubbleRef)};a.prototype.loop=function(){clearTimeout(this.loopTimeout);Silk.api.Site.byUri(this.domain.repository.uri.get()).getImportStatus(function(a){a?
this.domain.tagList.findOrReload(l.uriPrefix()+a.collectionUri).then(function(b){a.tag=b;a.collection=b?b.name:a.collectionUri;"inProgress"in a.status?this.update(a):(b=new Date,(new Date(a.finished)).getTime()+18E5>b.getTime()?this.update(a):this.reset())}.bind(this)):this.reset()}.bind(this))};a.prototype.update=function(a){clearTimeout(this.loopTimeout);this.data=a;this.status&&"inProgress"in this.status&&!("inProgress"in a.status)&&(this.domain.tagList.load(!0),this.domain.repository.load());
this.status=a.status;"inProgress"in a.status&&(this.loopTimeout=setTimeout(this.loop,2E3));this.updateUI(a)};a.prototype.updateUI=function(a){var b=null;if("errored"in a.status||"complete"in a.status)b=this.renderIcon(1,"rgb(95,208,46)","rgb(95,208,46)");"inProgress"in a.status&&(b=a.status.inProgress,b=this.renderIcon(b&&b.total?(b.imported+b.errored)/b.total:0,"rgb(150,223,233)","rgb(40,186,208)"));"aborted"in a.status&&(b=this.renderIcon(1,"rgb(232,98,43)","rgb(232,98,43)"));b&&(this.node.show().empty().append(b),
this.bubbleRef.bubble&&this.renderBubble())};a.prototype.renderBubble=function(){this.bubbleContent.empty();if(this.data){if("errored"in this.data.status||"complete"in this.data.status){"errored"in this.data.status?this.bubbleContent.append("<p>The import '<span class=import-collection></span>' is complete, however some pages failed to import.</p>"):this.bubbleContent.append("<p>The import '<span class=import-collection></span>' is ready!</p>");this.bubbleContent.append("<p><a class=explore-link href=#>Explore pages in the collection</a></p>");
var a=this.data.tag?e.exploreCollection(this.data.tag.uri):"/dashboard";$(".explore-link",this.bubbleContent).attr("href",a);this.bubbleContent.addClass("vog");this.bubbleContent.parent().addClass("vog")}else this.bubbleContent.removeClass("vog"),this.bubbleContent.parent().removeClass("vog");if("inProgress"in this.data.status&&(this.bubbleContent.append("<p><strong>Importing:</strong> <span class=import-collection></span></p>"),this.bubbleContent.append("<p><strong>Progress:</strong> <span class=progress-text>Calculating...</span></p>"),
this.data.user===this.domain.user.uuid.get()&&this.bubbleContent.append("<p><a href='/dashboard/import'>View import status</a></p>"),(a=this.data.status.inProgress)&&a.total)){var b=a.imported+a.errored,d=Math.round(100*b/a.total)+"%";$(".progress-text",this.bubbleContent).text(b+" of "+a.total+" ("+d+")")}"aborted"in this.data.status&&(this.bubbleContent.append("<p>The import '<span class=import-collection></span>' was aborted.</p>"),this.data.user===this.domain.user.uuid.get()&&this.bubbleContent.append("<p><a class=new-import-link href=#>Start a new import</a></p>"),
$(".new-import-link",this.bubbleContent).click(function(){this.canvas.switchDocument(new g(this.canvas));return!1}.bind(this)));$(".import-collection",this.bubbleContent).text(this.data.collection);$("a",this.bubbleContent).click(function(){this.bubbleRef.close()}.bind(this))}};a.prototype.renderIcon=function(a,b,e){var g=d.mkSvgEl("svg",{xmlns:"http://www.w3.org/2000/svg",width:32,height:32}),h=this.drawRing(12.16,9.6,16,16);a=this.drawPie(8,a,16,16);g.appendChild(d.mkSvgEl("path",{d:h,fill:b}));
g.appendChild(d.mkSvgEl("path",{d:a,fill:e}));return $(g)};a.prototype.drawPie=function(a,b,d,e){1==b&&(b=0.9999);var g=2*-b*Math.PI+Math.PI/2,h=Math.cos(g)*a,g=-Math.sin(g)*a+a;return["M"+d+","+e,"l0,"+-a,"a"+a+","+a+" 0 "+(0.5<b?1:0)+",1 "+h+","+g,"Z"].join(" ")};a.prototype.drawRing=function(a,b,d,e){return["M"+d+","+e,"m0,"+-b,"a"+b+","+b+" 0 1,0 0.001,0","m0,"+(b-a),"a"+a+","+a+" 0 1,1 -0.001,0","Z"].join(" ")};return a}();k.ImportProgress=m})(k.topbar||(k.topbar={}))})(k.bars||(k.bars={}))})(m.ui||
(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.List,m=a.typlib.Strings.prettyJoin,g=function(){function a(d,b,e){var g;this.checkConflicts=this.checkConflicts.bind(this);this.checkConcurrentEditors=this.checkConcurrentEditors.bind(this);if(g=function(a,b,c){this.doc=a;this.noticeBar=b;this.errorMessage=null;this.doc.bind(function(a){return a&&a.saver&&a.saver.conflicted}).onchange(this.checkConflicts);this.concurrentEditingWarning=!1;l.joinList(this.doc.mapValue(function(a){return a&&a.concurrentEditors&&
a.concurrentEditors.editors})).onchange(this.checkConcurrentEditors)}.apply(g||this,arguments))return g}a.DocumentStatusCheck=a;a.prototype.checkConflicts=function(a){a&&(this.draftMessage&&this.draftMessage.discard(),a=this.getDocumentConflictMessage(this.noticeBar),this.draftMessage=this.noticeBar.warning(a,{html:!0}))};a.prototype.checkConcurrentEditors=function(a){a&&(a=a.list,a.length&&!this.concurrentEditingWarning?(this.errorMessage=this.noticeBar.error("This document is also being edited by <strong>"+
m(a)+"</strong>. You might have conflicting changes.",{html:!0,document:this.doc.get()}),this.concurrentEditingWarning=!0):!a.length&&this.concurrentEditingWarning&&(this.errorMessage.discard(),this.concurrentEditingWarning=!1))};a.prototype.getDocumentConflictMessage=function(){var a=$("<span>This document has been modified by another user. Either <a>override</a> those changes or <a>revert</a> to the latest version.</span>"),b=$("a",a);$(b[0]).click(function(a){this.doc.get().saver.save(!0);this.noticeBar.dismiss(a)}.bind(this));
$(b[1]).click(function(a){this.silk.discarder.discard();this.noticeBar.dismiss(a)}.bind(this));return a};return a}();k.DocumentStatusCheck=g})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){return function(){}}();a.Action=l})(a.model||(a.model={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.tagging.TagComponent,m=a.reactive.Node,g=a.silk.nav.NavLinks,e=a.typlib.Cleanup,d=a.typlib.Html,b=a.typlib.Tracking,n=a.typlib.MutationEvents,r=a.typlib.SelectionManager,h=function(){function a(b){var c;if(c=function(a){this.canvas=a;this.document=this.canvas.document;this.context=this.canvas.document.mapProp("context");this.selection=this.context.bindProp("selection").name("Editing.selection");this.element=this.context.bindProp("element").name("Editing.element");
this.setupContextStyles()}.apply(c||this,arguments))return c}a.getFontFamily=function(a){a=$(a).css("font-family");if(!a)return"(Font)";"serif"==a&&(a="Georgia");a=a.match(/^[^,]*/)[0];a=a.replace(/[^\w\d\s]/g,"");a=a.replace(/_/g," ");return a=a.replace(/(^.|\s.)/g,function(a){return a.toUpperCase()})};a.getFontSize=function(a){return parseFloat($(a).css("font-size"))};a.getParagraphStyle=function(a){return(a=a&&d.querySelectorAOS(a,"p, h1, h2, h3, h4, h5, h6"))?{P:"Paragraph",H1:"Title",H2:"Heading 1",
H3:"Heading 2",H4:"Heading 3"}[a.nodeName]:"(Style)"};a.getTextAlign=function(a){return $(a).css("text-align")};a.getStateForElement=function(a,b){return function(e){if(!e)return!1;switch(a){case "fontname":return c(e)==b;case "fontsize":return+$(e).css("font-size").replace(/\D/g,"")==+b;case "indent":case "outdent":case "removeformat":return!1;case "justifyleft":return"auto"==$(e).css("text-align");case "justifycenter":return"center"==$(e).css("text-align");case "justifyright":return"right"==$(e).css("text-align");
case "justifyfull":return"justify"==$(e).css("text-align");case "paragraphstyle":return(e=d.querySelectorAOS(e,"p, h1, h2, h3, h4, h5, h6"))&&e.nodeName.toLowerCase()==b;case "link":return 0<$(e).parents().addBack().filter("*[href]").length;default:try{return d.isContentEditable(e)&&e.ownerDocument.queryCommandState(a)}catch(f){return!1}}}};a.getBlockStateForElement=function(a){return function(b){return null!=d.querySelectorAOS(b,a)}};a.getDeepestLink=function(a){return $(a).parents().addBack().filter("a[href]").last().get(0)};
a.getDeepestTag=function(a){return $(a).parents().addBack().filter("a[data-tag-uri]").last().get(0)};a.getLinkStateFromSelection=function(a){if(!a)return!1;var b=x(a.startContainer);a=x(a.endContainer);return b&&a&&b===a};a.getTagStateFromSelection=function(a){if(!a)return!1;var b=w(a.startContainer);a=w(a.endContainer);return b&&a&&b===a&&!!b.component};var c=a.getFontFamily,h=a.getFontSize,k=a.getParagraphStyle,u=a.getTextAlign,t=a.getStateForElement,v=a.getBlockStateForElement,x=a.getDeepestLink,
w=a.getDeepestTag,y=a.getLinkStateFromSelection,A=a.getTagStateFromSelection;a.Editing=a;a.prototype.setupContextStyles=function(){this.contextFontFamily=this.element.map(c).name("Editing.contextFontFamily");this.contextFontSize=this.element.map(h).name("Editing.contextFontSize");this.contextParagraphStyle=this.element.map(k).name("Editing.contextParagraphStyle");this.contextTextAlign=this.element.map(u).name("Editing.contextTextAlign")};a.prototype.format=function(){var a=arguments,b=this;return function(c){return function(a,
b){window.Silk.canvas.document.get().undoManager.startAction("format");var c=function(a,b){var c,e=!1;switch(a){case "insertorderedlist":c=c||"OL";case "insertunorderedlist":c=c||"UL";var f=r.get(),f=window.getSelection(),g=d.isFollowing(f.focusNode,f.anchorNode)?f.focusNode:f.anchorNode,h=f.focusNode===g?f.anchorNode:f.focusNode;h.nodeName===c&&(h=h.firstChild);g.nodeName===c&&(g=g.lastChild);var k=$(h).parents("ul, ol").get(0);if(k&&k.nodeName!==c){e=!0;break}for(var l=$(h).parents(c).length,h=
$(h).filter("li").add($(h).parents("LI")).get(0),g=$(g).filter("li").add($(g).parents("LI")).get(0),k=h,m=!1;!m&&h;){k===g&&(m=!0);var n=window.document.createElement("b");for(n.setAttribute("class","__insertunorderedlist_wrapper");k.firstChild;)n.appendChild(k.firstChild);k.appendChild(n);k=k.nextSibling}r.select(f)}window.document.execCommand(a,!1,b||null);switch(a){case "fontsize":f=window.getSelection();h=d.isFollowing(f.focusNode.parentNode,f.anchorNode.parentNode)?f.anchorNode:f.focusNode;g=
d.isFollowing(f.focusNode.parentNode,f.anchorNode.parentNode)?f.focusNode:f.anchorNode;3==h.nodeType&&(h=h.parentNode);for(;h!=g;)1==h.nodeType&&((c=h.getAttribute("style"))?(c=c.replace(/font-size:\s*[\w\d\-]+/,"font-size:"+b),c!=h.getAttribute("style")&&h.setAttribute("style",c)):"FONT"==h.nodeName&&h.getAttribute("size")&&(h.removeAttribute("size"),h.setAttribute("style","font-size: "+b))),h=d.getFollowingNode(h);break;case "insertorderedlist":case "insertunorderedlist":if(e)break;f=window.getSelection();
e=f.focusNode;e=e.nodeName===c?e.firstChild:e;f=$(e).parents(c);e=$(".__insertunorderedlist_wrapper",e.ownerDocument).get();if(f.length>l)for(l=f.get(0),f=l.parentNode,"P"===f.nodeName&&(1===f.childNodes.length?(f.parentNode.insertBefore(l,f),f.parentNode.removeChild(f)):console.warn("P around inserted "+c+" has multiple children.",f));0<e.length;){c=e.pop();for(l=c.parentNode;c.firstChild;)l.appendChild(c.firstChild);l.removeChild(c)}else f.length<l?e.forEach(function(a){for(var b=window.document.createElement("p");a.firstChild;)b.appendChild(a.firstChild);
a.parentNode.insertBefore(b,a);a.parentNode.removeChild(a);(a=b.nextSibling)&&"BR"===a.nodeName&&a.parentNode.removeChild(a)}.bind(this)):console.error("No change in "+c+" number during "+a+".")}}.call(this,a,b);window.Silk.canvas.document.get().undoManager.stopAction();return c}.apply(b,a)}};a.prototype.justify=function(){var a=arguments,b=this;return function(c){return function(a){window.Silk.canvas.document.get().undoManager.startAction("justify");for(var b=window.getSelection(),b=b.focusNode&&
b.anchorNode?d.isAncestor(b.focusNode,b.anchorNode)?b.focusNode:b.anchorNode:b.focusNode||b.anchorNode;b&&-1==="SECTION NAV ARTICLE ASIDE H1 H2 H3 H4 H5 H6 HGROUP HEADER FOOTER ADDRESS P DIV PRE BLOCKQUOTE LI TD TH DD DT OL UL DL CAPTION".split(" ").indexOf(b.nodeName);)b=b.parentNode;if(b){var c=b.getAttribute("style");b.style.textAlign=a;a=b.getAttribute("style");if(n.DOMAttrModifiedUnsupported){var e=b.ownerDocument,f=e.defaultView,e=e.createEvent("MutationEvent");e.initMutationEvent("DOMAttrModified",
!0,!1,b,c,a,"style",null==c?f.MutationEvent.ADDITION:f.MutationEvent.MODIFICATION);b.dispatchEvent(e)}}else console.warn("No node formatBlock candidate found in Editing.justify.");window.Silk.canvas.document.get().undoManager.stopAction()}.apply(b,a)}};a.prototype.getFormatState=function(a,b){return this.element.map(t(a,b))};a.prototype.getState=function(a,b){var c=this.element.get();return t(a,b)(c)};a.prototype.formatBlock=function(){var a=arguments,b=this;return function(c){return function(a){window.Silk.canvas.document.get().undoManager.startAction("formatBlock");
var b=d.querySelectorAOS(this.element.get(),"p, h1, h2, h3, h4, h5, h6, div, li, pre");b&&b!=this.document.get().root&&"LI"!=b.nodeName?b.nodeName!=a&&d.replaceElement(b,window.document.createElement(a)):window.document.execCommand("formatblock",!1,a);window.Silk.canvas.document.get().undoManager.stopAction()}.apply(b,a)}};a.prototype.getFormatBlockState=function(a){return this.element.map(v(a))};a.prototype.getBlockState=function(a){return v(a)(this.element.get())};a.prototype.getLinkState=function(){return this.selection.map(y)};
a.prototype.getTagState=function(){return this.selection.map(A)};a.prototype.doLink=function(){var a=arguments,c=this;return function(d){return function(a){window.Silk.canvas.document.get().undoManager.startAction("doLink");a:{b.trackWithMode("editor-linkmenu-viamenu");var c=this.selection.get();if(y(c))a=x(c.startContainer),a.removeAttribute("href"),e.cleanupNode(a.parentNode);else{c=l.getRangeOrTagFromContext(this.context);if(!c){a=void 0;break a}var d;c=c instanceof m?(d=c.attributes.get("href").get())?
g.documentNameFromUri(d):c.node.textContent:(d=(d=l.anchorsFromRange(c)[0])&&d.getAttribute("href"))?g.documentNameFromUri(d):c.toString();a(c)}a=void 0}window.Silk.canvas.document.get().undoManager.stopAction();return a}.apply(c,a)}};a.prototype.doTag=function(){var a=arguments,c=this;return function(d){return function(a){window.Silk.canvas.document.get().undoManager.startAction("doTag");b.trackWithMode("editor-linkmenu-viamenu");var c=this.selection.get();A(c)?(a=w(c.startContainer),l.remove(new m(a))):
a();window.Silk.canvas.document.get().undoManager.stopAction()}.apply(c,a)}};return a}();k.Editing=h})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Rects.getAbsoluteRects,l=function(){function a(){}a.fromRange=function(a){var d=g(a);return k(d,a.commonAncestorContainer.ownerDocument)};a.localFromRange=function(a){if(a.getClientRects)return a.getClientRects();for(a=a.commonAncestorContainer;a.nodeType!==window.Node.ELEMENT_NODE;)a=a.parentNode;return a.getClientRects()};var g=a.localFromRange;return a}();m.ClientRects=l})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.ClientRects,m=a.client.ui.FocusManager,g=a.typlib.Html.getClassList,e=function(){function a(b,d,e,g,f){var c;if(c=function(a,b,c,d,e){e=e||{};e.useOverlay=void 0===e.useOverlay?!0:e.useOverlay;e.inwardArrow=void 0===e.inwardArrow?!1:e.inwardArrow;e.shift=void 0===e.shift?!0:e.shift;e.arrowDirection=void 0===e.arrowDirection?null:e.arrowDirection;e.hideArrow=void 0===e.hideArrow?!1:e.hideArrow;this.options=e;this.createDialog(a,d);this.sizeDialog(b,
c);this.hideDialog()}.apply(c||this,arguments))return c}a.InlineDialog=a;a.prototype.createDialog=function(a,d){function e(a,b){var c=$("<div/>").addClass(a);b&&c.appendTo(b);return c[0]}var g=this.options.useOverlay?$("#overlay")[0]:$("body")[0],f=this.dialog=e("inline-dialog"+(d?" "+d:""),g),c=this.content=e("inline-dialog-content",f);$(c).append(a);this.useOverlay&&(this.dialogCtx=e("inline-dialog-context",g));this.options.inwardArrow||(this.dialogArrow=e("inline-dialog-arrow",f));return f};a.prototype.showCompactDialogAtRange=
function(a,d){var e=l.fromRange(a);if(e.length){var g=e[e.length-1];this.showCompactDialogAtRect(g,e[1]&&!e[0].width?e[1]:e[0]);d&&this.showContext(g.bottom-5,g.left-1,g.width+2)}};a.prototype.showCompactDialogAtRect=function(a,d,e){this.showDialog();this.reflowDialog();e=e&&e.anchorX||0.5;var g=this.getDialogShift(a.left+a.width/2,a.bottom,e,0);0>g.shiftY?(d&&(a=d),g=this.getDialogShift(a.left+a.width/2,a.top,e,1),this.setArrow("down",g.arrX)):this.setArrow("up",g.arrX);this.positionDialog(g)};a.prototype.showSideDialogAtRect=
function(a){this.showDialog();this.reflowDialog();var d=a.top+a.height/2,e=this.getDialogShift(a.right,d,0,0.2);0>e.shiftX?(e=this.getDialogShift(a.left,d,1,0.3),this.setArrow("right",e.arrY)):this.setArrow("left",e.arrY);this.positionDialog(e)};a.prototype.showSideDialogAtPoint=function(a,d){this.showSideDialogAtRect({top:d,bottom:d,left:a,right:a,width:0,height:0})};a.prototype.hideOnBlur=function(a){var d=this;this.dialog.getAttribute("class");g(this.dialog).add("focusable");m.focusElement(this.dialog,
function(){d.hide();a&&a()})};a.prototype.hide=function(){this.hideDialog();this.hideContext();m.removeFocusFromElement(this.dialog)};a.prototype.showDialog=function(){this.dialog.style.display="block"};a.prototype.focusDialog=function(){var a=this.dialog.querySelector("input,textarea");a&&(a.focus(),a.select())};a.prototype.positionDialog=function(a){this.dialog.style.top=a.y+"px";this.dialog.style.left=a.x+"px"};a.prototype.sizeDialog=function(a,d){this.width=a;this.height=d;this.reflowDialog()};
a.prototype.reflowDialog=function(){if(this.width&&this.height)this.content.style.width=this.width+"px",this.content.style.height=this.height+"px";else{var a=this.content.getBoundingClientRect();this.content.style.width=a.width+"px"}};a.prototype.hideDialog=function(){this.dialog.style.display="none";this.content.style.width="";this.content.style.height=""};a.prototype.setArrow=function(a,d){this.options.arrowDirection&&(a=this.options.arrowDirection);var e={up:[d+"px 0","0","auto","0","auto","9px",
"100%","9px 0 0 0"],down:[d+"px 0","auto","0","0","auto","9px","100%","0 0 9px 0"],left:["0 "+d+"px","0","auto","0","auto","100%","9px","0 0 0 9px"],right:["0 "+d+"px","0","auto","auto","0","100%","9px","0 9px 0 0"]}[a],g=this.dialog.style;if(this.options.hideArrow){var f=this.dialogArrow.style;f.display="none"}else this.options.inwardArrow?(f=this.content.style,f.backgroundImage="url('"+window.Silk.paths.imagePath+"/inlinedialog/arrow-inward-"+a+".png')",f.backgroundPosition=this.options.arrowPosition||
e[0],f.backgroundRepeat="no-repeat",g.padding=0):(f=this.dialogArrow.style,f.display="inline",f.backgroundImage="url('"+window.Silk.paths.imagePath+"/inlinedialog/arrow-"+a+".png')",f.backgroundPosition=this.options.arrowPosition||e[0],f.top=e[1],f.bottom=e[2],f.left=e[3],f.right=e[4],f.height=e[5],f.width=e[6],g.padding=e[7])};a.prototype.showContext=function(a,d,e){var g=this.dialogCtx.style;g.top=a+"px";g.left=d+"px";g.width=e+"px";g.opacity=0.98};a.prototype.hideContext=function(){this.dialogCtx&&
(this.dialogCtx.style.opacity=0,this.dialogCtx.style.top="-100000px",this.dialogCtx.style.left="-100000px")};a.prototype.getDialogShift=function(a,d,e,g){var f=window.document.documentElement.clientHeight-15,c=window.document.documentElement.clientWidth-15,k=this.dialog.offsetWidth,l=this.dialog.offsetHeight,m=a-k*e,p=0;15>m?p=15-m:m+k>c&&(p=c-m-k);e=k*e-6-p;g=0<g?Math.min(l-0-6,Math.max(32,l*g)):l*g;c=d-g;k=0;15>c?k=15-c:c+l>f&&(k=f-c-l);return{x:this.options.shift?m+p:a,y:this.options.shift?c+k:
d,arrX:e,arrY:g-6-k,shiftX:p,shiftY:k}};a.prototype.dialog=void 0;a.prototype.height=void 0;a.prototype.width=void 0;a.prototype.content=void 0;a.prototype.dialogArrow=void 0;a.prototype.dialogCtx=void 0;return a}();k.InlineDialog=e})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.arrow.Arrow,m=a.reactive.List,g=a.client.query.pipeline.Pipeline,e=a.client.query.Query,d=a.client.tagging.TagComponent,b=a.client.ui.InlineDialog,n=a.client.ui.Picker,r=a.client.ui.bars.PickerQuery,h=a.typlib.Arrays,f=a.typlib.Functions,c=a.typlib.Html,q=a.typlib.Objects,s=a.typlib.Strings,u=a.typlib.Tracking,t=l.arrI,v=l.constL,x=l.seq,w=l.isI,y=l.put,A=l.get,z=l.sort,B=function(){function a(c,d){var e;this.showUniversal=this.showUniversal.bind(this);
this.showLinkBar=this.showLinkBar.bind(this);this.previewGeneric=this.previewGeneric.bind(this);this.previewLink=this.previewLink.bind(this);this.previewTag=this.previewTag.bind(this);this.previewMailto=this.previewMailto.bind(this);this.doShowPicker=this.doShowPicker.bind(this);this.getTagOptions=this.getTagOptions.bind(this);this.createTagOption=this.createTagOption.bind(this);this.getLinkOptionsAsync=this.getLinkOptionsAsync.bind(this);this.createDocumentMatchOption=this.createDocumentMatchOption.bind(this);
this.getTypedOptions=this.getTypedOptions.bind(this);this.createTypedOptions=this.createTypedOptions.bind(this);this.createLinkOption=this.createLinkOption.bind(this);this.createMailOption=this.createMailOption.bind(this);this.fetchTagOptions=this.fetchTagOptions.bind(this);this.fetchLinkOptions=this.fetchLinkOptions.bind(this);this.fetchAllOptions=this.fetchAllOptions.bind(this);this.tagCurrentSelection=this.tagCurrentSelection.bind(this);this.linkCurrentSelection=this.linkCurrentSelection.bind(this);
this.doHidePicker=this.doHidePicker.bind(this);if(e=function(a,c){this.undoManager=a.document.mapProp("undoManager");this.context=a.document.mapProp("context");this.tagList=c;this.createUbar();this.dialog=new b(this.model,300,36);this.selectionId=null}.apply(e||this,arguments))return e}a.searchFuzzy=function(a,b){var c=(a?window.Silk.domain.tagList.tags:l.run(l.seq(l.unlist,C(window.Silk.domain.tagList.tags,b.mapProp("tags"))),d.getRangeOrTagContextList(b))).list,c=c.filter(function(a){return a.count}),
e=c.filter(function(b){return b.matchAtStart(a)}),c=c.filter(function(b){return b.matchAfterSpace(a)});return e.concat(c)};a.rank=function(a,b){var c=m.valueToList(b.bind(function(a){return a&&a.head()}).bind(function(a){if(a)return a.attributes.get("data-tag-context")}),"").name("Suggestions.rank.pageTag"),d=t(function(b){function c(a){e.rank=e.docLevelCount.get();a=$("> * *[data-tag-uri]",a).map(function(a,b){return b.getAttribute("data-tag-uri")});h.unique(a).forEach(function(a){var b=e.revcontext.get(a);
b&&(e.rank+=10*b*a.count)})}function d(){var b=a.list.reduce(function(a,b){return a+b.count},0);e.rank=(b+e.count)/b;0===e.count&&(e.rank=-Infinity);var c;q.isType(f,"Range")?c=f.toString():f.node&&((c=f.node.getAttribute("data-tag-uri"))&&c===e.uri&&(e.rank=Infinity),c=f.node.textContent);0<e.count&&(b=e.types.numeric&&e.types.fraction,isNaN(c)||(e.rank*=1.5*b+0.5),c=e.context.get(g))&&(e.rank*=1.5*c+0.5)}var e=b.tag,f=b.elem,g=b.pageTag;f.node&&f.node.parentNode&&"canvas"===f.node.parentNode.id?
c(f.node.parentNode):d();return b});return x(z(x(y("elem"),v(c),y("pageTag"),v(a),y("tag"),d,A("tag")),function(a,b){return a.input.rank<b.input.rank?1:a.input.rank==b.input.rank?0:-1}),w(function(a){return-Infinity<a.input.rank}))};var k=a.searchFuzzy,C=a.rank;a.Ubar=a;a.prototype.showUniversal=function(){this.tagPicker.setDefaultOptionType("tag");this.tagPicker.setGetOptionsCallback(this.fetchAllOptions);this.tagPicker.removePreviewCallbacks();this.tagPicker.setPreviewCallback(this.previewTag,"tag");
this.tagPicker.setPreviewCallback(this.previewLink,"document");this.tagPicker.setPreviewCallback(this.previewLink,"link");this.tagPicker.setPreviewCallback(this.previewMailto,"mailto");this.tagPicker.removeSelectCallbacks();this.tagPicker.setSelectCallback(this.tagCurrentSelection,"tag");this.tagPicker.setSelectCallback(this.linkCurrentSelection,"document");this.tagPicker.setSelectCallback(this.linkCurrentSelection,"link");this.tagPicker.setSelectCallback(this.linkCurrentSelection,"mailto");this.tagPicker.removeCreateCallbacks();
this.tagPicker.setCreateCallback(this.tagCurrentSelection,"tag");this.tagPicker.setCreateCallback(this.linkCurrentSelection,"document");this.tagPicker.setClearValue(!0);0===this.tagList.tags.length().get()?this.actionSpan.textContent="Create tag":this.actionSpan.textContent="Tag as";var a=this.context.get().structuralSelectionOrWordRange.get();a&&this.dialog.showCompactDialogAtRange(a);this.actionInput.focus();this.actionInput.select()};a.prototype.showLinkBar=function(a){this.tagPicker.setDefaultOptionType("document");
this.tagPicker.setGetOptionsCallback(this.fetchLinkOptions);this.tagPicker.removePreviewCallbacks();this.tagPicker.setPreviewCallback(this.previewLink,"document");this.tagPicker.setPreviewCallback(this.previewLink,"link");this.tagPicker.setPreviewCallback(this.previewMailto,"mailto");this.tagPicker.removeSelectCallbacks();this.tagPicker.setSelectCallback(this.linkCurrentSelection,"document");this.tagPicker.setSelectCallback(this.linkCurrentSelection,"link");this.tagPicker.setSelectCallback(this.linkCurrentSelection,
"mailto");this.tagPicker.removeCreateCallbacks();this.tagPicker.setCreateCallback(this.linkCurrentSelection);this.tagPicker.setClearValue(!1);this.actionSpan.textContent="Link to";var b=this.context.get().structuralSelectionOrWordRange.get();b&&this.dialog.showCompactDialogAtRange(b);a&&this.tagPicker.setInputText(a);this.actionInput.focus();this.actionInput.select()};a.prototype.createUbar=function(){var a=this.model=window.document.createElement("div");a.className="ubar";var b=this.actionSpan=window.document.createElement("span");
b.textContent="Tag as";a.appendChild(b);b=this.actionInput=window.document.createElement("input");b.setAttribute("type","search");c.setInputValue(b,"");b.className="immediateCancel";a.appendChild(b);this.tagPicker=new n(b,!1,"ubarPicker");this.tagPicker.setAutoOpen();this.tagPicker.setHideCallback(this.doHidePicker);this.tagPicker.setShowCallback(this.doShowPicker)};a.prototype.previewGeneric=function(a){this.showingSuggestion&&a.display!=this.showingSuggestion&&(this.tagPicker.getInputText()==this.showingSuggestion&&
this.tagPicker.setInputText("",!0),this.showingSuggestion="")};a.prototype.previewLink=function(a){this.previewGeneric(a);this.actionSpan.textContent=a.create?"Create link":"Link to"};a.prototype.previewTag=function(a){this.previewGeneric(a);this.actionSpan.textContent=a.create?"Create tag":"Tag as"};a.prototype.previewMailto=function(a){this.previewGeneric(a);this.actionSpan.textContent="Link to e-mail"};a.prototype.doShowPicker=function(){this.selectionId&&this.hideSelect();this.selectionId=this.context.get().showTaggableSelection();
this.suggestionCanceled=!1};a.prototype.getTagOptions=function(a){return k(a,this.context).map(this.createTagOption)};a.prototype.createTagOption=function(a){return this.tagPicker.createOption(c.escapeHtml(a.name),"tag",a)};a.prototype.getLinkOptionsAsync=function(a,b,c){function d(b){return 0===b[0][0].value.toLowerCase().indexOf(a.toLowerCase())?0:1}var k=["from all documents",'where document name contains "'+e.escape(a)+'"',"select document name\nslice from 0 to 20"].join("\n"),k=g.raw(k),l=this;
r.onFieldsReadyCallback(k,b,function(b){return b.sort(f.comparing(d)).reverse().map(f.compose(l.createDocumentMatchOption(a),h.idx(0),h.idx(0)))},c)};a.prototype.createDocumentMatchOption=function(a){var b=this;return function(c){return b.tagPicker.createOption(c.value.replace(RegExp("("+s.regexEscape(a)+")","i"),"<em>$1</em>"),"document",c.href)}};a.prototype.getTypedOptions=function(a,b){return a?this.createTypedOptions(a,b):[]};a.prototype.createTypedOptions=function(a,b){var c=[],d=this.createLinkOption(a);
d&&c.push(d);(d=this.createMailOption(a))&&c.push(d);if(c.length)for(var d={tag:["tag"],link:["document"],universal:["tag","document"]}[b],e=0;e<d.length;e++)c[0].type!=d[e]&&c.push(this.tagPicker.createOption(a,d[e],a,!1,!0));return c};a.prototype.createLinkOption=function(a){if(a){if(a.match(/^\w+\:\/\//i))return this.tagPicker.createOption(a,"link",a);if(a.match(/^www\.[A-Z0-9.-]+\.[A-Z]{2,4}/i))return this.tagPicker.createOption(a,"link","http://"+a);if(a.match(/^\//))return this.tagPicker.createOption(a,
"link",a)}return null};a.prototype.createMailOption=function(a){if(a){if(a.match(/^mailto:/))return this.tagPicker.createOption(a,"mailto",a);if(a.match(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i))return this.tagPicker.createOption(a,"mailto","mailto:"+a)}return null};a.prototype.fetchTagOptions=function(a,b){a=s.trim(a);var c=this.getTypedOptions(a,"tag"),d=this.getTagOptions(a),c=c.concat(d);a&&this.tagPicker.sortOptions(c);return null};a.prototype.fetchLinkOptions=function(a,b,c){a=s.trim(a);
b=this.getTypedOptions(a,"link");a&&this.tagPicker.sortOptions(b);this.getLinkOptionsAsync(a,c,b);return null};a.prototype.fetchAllOptions=function(a,b,c){b=this.getTypedOptions(a,"universal");var d=this.getTagOptions(a);b=b.concat(d);a&&this.tagPicker.sortOptions(b);this.getLinkOptionsAsync(a,c,b);return null};a.prototype.tagCurrentSelection=function(a){window.Silk.canvas.document.get().undoManager.startAction("tagCurrentSelection");this.undoManager.get();a.create?(a.value=this.tagList.createFromName(a.display),
0===a.value.count&&(a.value.count=1),u.trackWithMode("editor-tagword-keyboard-new",{},!0)):u.trackWithMode("editor-tagword-keyboard-existing",{},!0);d.tagContext(this.context,a.value);this.context.get().restoreInactiveSelection();window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.linkCurrentSelection=function(a){window.Silk.canvas.document.get().undoManager.startAction("linkCurrentSelection");this.undoManager.get();a.create?"document"===a.type?(a="/page/"+encodeURI(a.display),
u.trackWithMode("editor-createlink-internal-new")):(a=a.display,u.trackWithMode("editor-createlink-unknown")):(a=a.value,a.match(/\/page\//)?u.trackWithMode("editor-createlink-internal-existing"):u.trackWithMode("editor-createlink-external"));a=a.replace(RegExp("^https?://"+window.location.host.replace(/(\.)/g,"\\."),"i"),"");d.linkContextPreEncoded(this.context,a);this.context.get().restoreInactiveSelection();window.Silk.canvas.document.get().undoManager.stopAction()};a.prototype.doHidePicker=function(){this.context.get().restoreInactiveSelection();
this.hideSelect();this.dialog.hide()};a.prototype.hideSelect=function(){this.context.get().hideTaggableSelection(this.selectionId);this.selectionId=null};a.prototype.hide=function(){this.tagPicker.hide()};a.prototype.showingSuggestion=void 0;a.prototype.tagPicker=void 0;a.prototype.actionInput=void 0;a.prototype.actionSpan=void 0;a.prototype.model=void 0;return a}();k.Ubar=B})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.reactive.Value,g=a.reactive.Functions,e=a.reactive.Node,d=a.typlib.Html,b=a.client.ui.FocusManager,n=a.client.ui.ShortcutKeys,r=a.typlib.Tracking,h=m.value,f=g.cond,c=g.undefinedWhenFalse,q=e.node,s=e.reactiveContent,g=function(){function a(){}a.buttonGroup=function(a){return g("buttongroup",a)};a.group=function(a,b){var c=window.document.createElement("span");c.className=a;for(var d=0;d<b.length;d++)c.appendChild(b[d].node||b[d]);return c};
a.selectButton=function(a,b,c,d,f,g){var h=window.document.createElement("div");h.setAttribute("unselectable","on");$(h).on("mousedown",function(a){a.preventDefault()});var l=new e(h);b&&("string"==typeof b?h.title=b:l.attributes.get("title").is(b));l.classes().push(new m("value"));l.classes().push(c);s(h,c);return k(a,null,"selectbutton",h,d,f,g)};a.comboButton=function(a,b,c,d,e){var f=window.document.createElement("input");f.type="text";$(f).on("mousedown",function(a){a.preventDefault()});b&&("string"==
typeof b?f.title=b:q(f).attributes.get("title").is(b));q(f).attributes.get("value").is(c);return k(a,null,"combobutton",f,d,e)};a.listButton=function(a,d,e,f,g,h,k){var l=window.document.createElement("div");l.id=a;l.className=e+" focusable clickable";l.setAttribute("unselectable","on");$(l).on("mousedown",function(a){a.preventDefault()});d&&("string"==typeof d?l.title=d:q(l).attributes.get("title").is(d));l.appendChild(f);h&&q(l).attributes.get("disabled").is(c(h));a=window.document.createElement("div");
a.className="buttonoptions";a.setAttribute("unselectable","on");l.appendChild(a);for(d=0;d<g.length;d++)if(a.appendChild(g[d].node),0==d){var m=g[d];k&&n.addShortcut(n.shortcut(k.combo,function(){b.focusElement(m.node)},k.applies))}return l};a.optionButton=function(a,b,c,d,e,f){return l("option focusable keyfocusable",a,b,null,c,d,null,e,f)};a.iconButton=function(a,b,c,d,e,f,g){return l("iconbutton",a,null,b,c,d,e,f,g)};a.textButton=function(a,b,c,d,e,f,g,h){return l("textbutton",a,b,c,d,e,f,g,h)};
a.button=function(a,g,k,l,m,p,q,t,v){var u=new e(window.document.createElement("div"));u.classes().push(h(a));u.classes().push(h("command-"+g));u.attributes.set("unselectable","on");p&&u.classes().push(f(p,"checked",""));q&&u.attributes.get("disabled").is(c(q));v&&u.classes().push(v);t&&t.combo&&(l=(l?l+"   ":"")+n.showCombo(t.combo));l&&u.attributes.set("title",l);k&&s(u,k);$(u.node).on("mousedown",function(a){a.preventDefault()});m&&$(u.node).click(function(a){d.getDisabled(u.node)||(r.trackWithMode("editor-toolbar-"+
g),m("toolbar-button"),b.delayedRemoveFocus(u.node))});t&&n.addShortcut(n.shortcut(t.combo,function(){d.flashClassName(u.node,"hover",250);m()},t.applies));return u};var g=a.group,k=a.listButton,l=a.button;return a}();k.EditbarElements=g})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.reactive.Functions,g=a.client.ui.bars.EditbarElements,e=a.client.ui.ShortcutKeys,d=a.client.component.ComponentURIs,b=a.component.KeyValue,n=a.reactive.Value.lift,r=m.not,h=m.eq,f=g.buttonGroup,c=g.group,q=g.selectButton,s=g.optionButton,u=g.iconButton,t=g.textButton,v=e.combo,x=e.Ctrl,w=e.Shift,y=e.Meta,A=e.MetaCtrl,z=e.mac,B=e.opera,m=function(){function a(){}a.createEditbar=function(a,b,c,d){a.insertBefore(e(b,c,d),a.lastChild)};a.defineEditbar=
function(a,e,g){function k(a){return $(a).parents().map(function(){return $(this).attr("data-component-uri")})[0]}function l(b){b=k(b);return a.editFlags.editing.get()&&b===d.TextWidget}function m(){return{combo:v.apply(this,arguments),applies:l}}function p(b){return a.editFlags.editing.get()&&0===$(b).closest("input,textarea").not(".undoable").length}var F=a.document,D=r(a.document.bind(function(a){return a&&a.context&&a.context.editable})),P=function(a,b,c){return u(a,b,e.format(a),e.getFormatState(a),
D,c)},J=F.mapProp("undoManager"),F=J.bindProp("undoSize"),K=J.bindProp("redoSize"),X=n(function(a,b){return a&&!b})(D,b.linkActiveField);return c("editing",[f([u("undo","Undo",function(){return J.get()&&J.get().undo()},void 0,h(F,0),{combo:v(A,"Z"),applies:p}),u("redo","Redo",function(){return J.get()&&J.get().redo()},void 0,h(K,0),{combo:[B(v(A,"Y")),z(v(y+w,"Z")),v(A,"Y")],applies:p})]),q("paragraphStyleSelector","Choose a paragraph style",e.contextParagraphStyle,[s("formatblock-p","Paragraph",
e.formatBlock("p"),e.getFormatState("paragraphstyle","p"),m(x,"0")),s("formatblock-h1","Title",e.formatBlock("h1"),e.getFormatState("paragraphstyle","h1"),m(x,"1")),s("formatblock-h2","Heading 1",e.formatBlock("h2"),e.getFormatState("paragraphstyle","h2"),m(x,"2")),s("formatblock-h3","Heading 2",e.formatBlock("h3"),e.getFormatState("paragraphstyle","h3"),m(x,"3")),s("formatblock-h4","Heading 3",e.formatBlock("h4"),e.getFormatState("paragraphstyle","h4"),m(x,"4"))],D),f([P("bold","Bold",m(A,"B")),
P("italic","Italic",m(A,"I")),P("underline","Underline",m(A,"U")),u("createlink","Create link",function(){var a=b.linkActiveField.get();a?a():e.doLink(g.ubar.showLinkBar)()},e.getLinkState(),X,m(A,"K"))]),f([t("createtag","Tag","Tag text",e.doTag(g.ubar.showUniversal),e.getTagState(),D,m(A+w," "))]),q("alignmentSelector","Text alignment",e.contextTextAlign,[s("justifyleft","Justify left",e.justify("left"),e.getFormatState("justifyleft")),s("justifycenter","Justify center",e.justify("center"),e.getFormatState("justifycenter")),
s("justifyright","Justify right",e.justify("right"),e.getFormatState("justifyright")),s("justifyfull","Justify full",e.justify("justify"),e.getFormatState("justifyfull"))],D),f([P("outdent","Decrease indent"),P("indent","Increase indent")]),f([P("insertorderedlist","Numbered list",m(x,"7")),P("insertunorderedlist","Bullet list",m(x,"8"))])])};var e=a.defineEditbar;return a}();k.Editbar=m})(k.bars||(k.bars={}))})(m.ui||(m.ui={}))})(a.client||(a.client={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.ui.DocumentStatusCheck,m=a.client.ui.Editing,g=a.client.ui.Ubar,e=a.client.ui.bars.Editbar,d=a.typlib.SelectionManager,b=function(){function a(b,d,e,c,g){var k;this.warnDirtyUnload=this.warnDirtyUnload.bind(this);if(k=function(a,b,c,d,e){this.ui=a;this.tagList=b;this.canvas=c;this.editing=c.editFlags.editing;this.noticeBar=d;this.ubar=this.setupUBar();"product"===e&&(this.setupToolBar(),this.setupEditbarScrolling());this.draftCheck=new l(this.canvas.document,
this.noticeBar,this.editing);this.setupRestoreEditSelection();this.setWarnDirtyUnload()}.apply(k||this,arguments))return k}a.Editor=a;a.prototype.setupUBar=function(){var a=new g(this.canvas,this.tagList);this.editing.onchange(function(){a.hide()});return a};a.prototype.setupToolBar=function(){var a=new m(this.canvas);e.createEditbar($("#edit-bar")[0],this.canvas,a,this)};a.prototype.setupEditbarScrolling=function(){var a=$("#page-bars-container"),b=a.offset().top;$(window).scroll(function(){var d=
$(window).scrollTop();a.toggleClass("floating",d>b)})};a.prototype.setupRestoreEditSelection=function(){$(document.documentElement).keydown(function(a){var b=a.target;27==a.keyCode&&"INPUT"==b.nodeName&&(""==b.value||~b.className.indexOf("immediateCancel")?d.selectCanvas():b.value="",a.preventDefault())})};a.prototype.setWarnDirtyUnload=function(){window.onbeforeunload=this.warnDirtyUnload};a.prototype.warnDirtyUnload=function(a){if(a=this.canvas.document.get()){if(a.saver&&a.saver.saving.get()||
a.autosaver&&a.autosaver.autosaving.get())return"This document is currently being saved. Are you sure you want to leave this document while this operation is still pending?";if(a.autosaver&&a.autosaver.needsAutosave.get())return"You have unsaved changes in document '"+a.uri.get()+"'."}};return a}();k.Editor=b})(m.ui||(m.ui={}))})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.setup=function(a){g();k();$("nav#top-bar .site-name").rToggleClass("private",a.isPrivate).find("a").rText(a.name)};a.trackCurrentUri=function(){var a=$("nav#top-bar a.anonymous.signin");a.click(function(d){d.preventDefault();d=a.attr("href").replace(/t=.*$/,"t="+encodeURIComponent(window.location.href));window.location.href=d})};a.installUserMenu=function(){$("nav#top-bar .user.logged-in").click(e);$(window.document.body).click(d);$(window.document.body).keyup(d);
$(window).blur(d)};a.toggleUserMenu=function(a){$("nav .user").toggleClass("show-user-menu")};a.doEvtOutsideUserMenu=function(a){$(a.target).parents("div.user").length||$(a.target).parents("div.menu").length||$("nav .user").removeClass("show-user-menu")};var k=a.trackCurrentUri,g=a.installUserMenu,e=a.toggleUserMenu,d=a.doEvtOutsideUserMenu;return a}();a.TopBar=k})(a.ui||(a.ui={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.client.ui.bars.BottomPageBar,m=a.client.ui.bars.NavBar,g=a.client.ui.bars.NoticeBar,e=a.client.ui.bars.ProductBar,d=a.client.ui.bars.topbar.FollowMenu,b=a.client.ui.bars.topbar.ImportProgress,n=a.silk.ui.Editor,r=a.typlib.ErrorHandling,h=a.ui.TopBar,f=function(){function a(c){var f;if(f=function(a,c,f,k,q,s,A,z,B){this.noticeBar=new g(a.editFlags.editing,a.document,q);r.ui=this.noticeBar;this.importProgress=new b($("nav#top-bar #import-progress"),c,a);
new d($("nav#top-bar #follow-site-menu")[0],c);h.setup(c.repository);this.navbar=new m(c,A,a,s);this.sitePageBar=new e(a,c,f,k,A,s,B);this.bottomPageBar=new l(a.document,A,a.editFlags.canDelete);a.editFlags.editing.onchange(function(b){b&&!this.editor&&(this.editor=new n(this,c.tagList,a,this.noticeBar,f))}.bind(this))}.apply(f||this,arguments))return f}return a.Chrome=a}();k.Chrome=f})(m.ui||(m.ui={}))})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.reactive.Node,m=a.reactive.Value,g=a.reactive.Functions.cond,e=function(){function a(b,d,e){var f;if(f=function(a,b,d){this.pageClass=this.setupPageClass();this.setupDebugClass();this.setupBrowserClass(b);this.setupPageClasses(a.document,a.editFlags,d);a.editFlags&&this.setupEditClasses(a.editFlags)}.apply(f||this,arguments))return f}a.formatClass=function(a){return a?a.replace(/ /g,"-").toLowerCase().replace(/[^a-z0-9-]/g,""):"unknown"};var b=a.formatClass;
a.HtmlClass=a;a.prototype.setupPageClass=function(){var a=l.node(document.documentElement).classes();a.clear();return a};a.prototype.setupDebugClass=function(){for(var a=["show-hidden-sections"],b=0;b<a.length;b++)-1!=document.location.search.indexOf(a[b])&&this.addPageClass(new m(a[b]))};a.prototype.addPageClass=function(a){this.pageClass.push(a)};a.prototype.setupBrowserClass=function(a){this.addPageClass(new m("engine-"+b($.ua.engine.name)));this.addPageClass(new m("browser-"+b($.ua.browser.name)));
this.addPageClass(new m("platform-"+b($.ua.os.name)))};a.prototype.setupEditClasses=function(a){this.addPageClass(g(a.canWrite,"userCanWrite",""));this.addPageClass(g(a.editing,"editing","viewing"));this.addPageClass(g(a.canEdit,"canEdit","cannotEdit"));this.addPageClass(g(a.canCreate,"canCreate","cannotCreate"))};a.prototype.setupPageClasses=function(a,b,d){b=a.mapProp("type");a=a.mapProp("model");this.addPageClass(b.map(function(a){return a&&a+"Document"}));this.addPageClass(new m(d));d=a.bind(function(a){return a&&
a.attributes.get("data-tag-context")});this.addPageClass(m.lift(function(a){return a?"data-tag-context-"+a.replace(/.+tag\//,""):""})(d))};return a}();k.HtmlClass=e})(m.ui||(m.ui={}))})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.reactive.ObjectTracking,g=function(){function a(){var d;if(d=function(){this.bottom=this.right=this.left=this.top=null;this.setupNodes()}.apply(d||this,arguments))return d}a.FocusOverlay=a;a.prototype.cleanup=function(){this.close()};a.prototype.setupNodes=function(){this.body=$("body");this.top=$("<div class='focusoverlay top'    />");this.left=$("<div class='focusoverlay left'   />");this.right=$("<div class='focusoverlay right'  />");
this.bottom=$("<div class='focusoverlay bottom' />");this.topLeft=$("<div class='focusoverlay topLeft'     />");this.topRight=$("<div class='focusoverlay topRight'    />");this.bottomLeft=$("<div class='focusoverlay bottomLeft'  />");this.bottomRight=$("<div class='focusoverlay bottomRight' />");this.shades=this.top.add(this.left.add(this.right.add(this.bottom.add(this.topLeft.add(this.topRight.add(this.bottomLeft.add(this.bottomRight)))))))};a.prototype.open=function(a){0==this.shades.parents().length&&
(this.shades.insertAfter($("#container")),setTimeout(function(){this.shades.css("opacity","1")}.bind(this),200))};a.prototype.close=function(){this.tracker&&this.tracker.cleanup();this.tracker=null;this.shades.css("opacity","0");setTimeout(function(){this.shades.detach()}.bind(this),400)};a.prototype.positionOnElement=function(a,b,e,g){this.tracker&&this.tracker.cleanup();g?this.repositionPulse(a,b):this.reposition(a,b);e&&(this.tracker=new m(a),this.tracker.pos.collapse().onchange(this.reposition.bind(this,
a,b)))};a.prototype.reposition=function(a,b){b=b||0;var e=a.offset();e&&a[0].offsetWidth&&a[0].offsetHeight&&this.positionHole(Math.round(e.left)-b,Math.round(e.top)-b,a[0].offsetWidth+2*b,a[0].offsetHeight+2*b)};a.prototype.repositionPulse=function(a,b){this.reposition(a,b);setTimeout(this.reposition.bind(this,a,b+10),200);setTimeout(this.reposition.bind(this,a,b),400)};a.prototype.positionHole=function(a,b,e,g){this.topLeft.css("height",b+"px");this.top.css("height",b+"px");this.topRight.css("height",
b+"px");this.left.css("top",b+"px");this.right.css("top",b+"px");this.topLeft.css("width",a+"px");this.left.css("width",a+"px");this.bottomLeft.css("width",a+"px");this.top.css("left",a+"px");this.bottom.css("left",a+"px");this.topRight.css("left",a+e+"px");this.right.css("left",a+e+"px");this.bottomRight.css("left",a+e+"px");this.top.css("width",e+"px");this.bottom.css("width",e+"px");this.bottomLeft.css("top",b+g+"px");this.bottom.css("top",b+g+"px");this.bottomRight.css("top",b+g+"px");this.left.css("height",
g+"px");this.right.css("height",g+"px")};return a}();k.FocusOverlay=g})(k.tutorial||(k.tutorial={}))})(m.ui||(m.ui={}))})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(m){(function(k){(function(k){var m=a.arrow.Arrow,g=a.arrow.Dom,e=a.lib.ui.VogTrigger,d=a.reactive.Functions,b=a.reactive.Node,n=a.reactive.Value,r=a.silk.ui.tutorial.FocusOverlay,h=a.typlib.SelectionManager,f=a.typlib.Arrays,c=a.typlib.CleanupPool,q=a.typlib.Tracking,s=a.typlib.ThreadEnd,u=function(){function a(){var b;this.proceed=this.proceed.bind(this);this.back=this.back.bind(this);this.cancel=this.cancel.bind(this);var d=this;this.stop=function(){var b=arguments;setTimeout(function(){a.prototype.stop.apply(d,
b)},1E3)};if(b=function(){this.pool=new c;this.vog=window.Silk.vog;this.domain=window.Silk.domain;this.canvas=window.Silk.canvas;this.document=window.Silk.canvas.document;this.progress=this.domain.userStorage.vogFirstEditSessionFlow;this.steps=(new n([])).name("FirstEditSession.steps");this.busy=!1;this.description=null;this.numberOfDocuments=2;this.version="initial-test-version";this.focusOverlay=new r;this.focusOverlay.positionOnElement($("#canvas"),10)}.apply(b||this,arguments))return b}a.FirstEditSession=
a;a.prototype.cleanup=function(){this.pool.cleanup()};a.prototype.start=function(a){0<$(".keyvalue").length?this.startReady():(a=a||200,2E3<a||setTimeout(this.start.bind(this,2*a),a))};a.prototype.startReady=function(){if(!this.busy&&"content"==this.document.get().type){var a=this.domain.repository.documents.get();if(window.location.search.match(/reset-tutorial/))return this.progress.set([]);if(-1==this.progress.get().indexOf("cancel")&&-1==this.progress.get().indexOf("done")&&!(a>=this.numberOfDocuments))if(window.location.search.match(/start-tutorial/)){if(0==
a||this.progress.get().length)this.progress.set([]),this.startFlow()}else this.progress.get().length&&this.startFlow()}};a.prototype.startFlow=function(){this.busy=!0;this.focusOverlay.open();this.setupUI();this.setupCommonTriggers();this.setupSteps()};a.prototype.setupUI=function(){this.description=$("<div class='tutorial-description' />").append($("<div/>").append($("<span/>").html("Welcome to your new Silk!<br> Follow the instructions to get started."),$("<a/>").text("Skip instructions").click(this.cancel))).appendTo(document.body)};
a.prototype.setupSteps=function(){var a=0;this.installSetCollection(a++,0);this.installAddTitle(a++,0);this.installNewTag(a++,0);this.installAddTags(a++,0);this.installAddImage(a++,0);this.installSavePage(a++,0);this.installNewPage(a++,1);this.installAddTitle(a++,1);this.installAddTags(a++,1);this.installAddPara(a++,1);this.installSavePage(a++,1);this.installToYourHomepage(a++,2);this.installExplore(a++,2);this.installWeAreDone(a++,2)};a.prototype.setupCommonTriggers=function(){this.editingContentDocument=
d.and(this.canvas.editFlags.editing,d.eq(this.document.mapProp("type"),"content")).name("FirstEditSession.editingContentDocument")};a.prototype.nth=function(a){return 1==a?"first":2==a?"second":3==a?"third":4==a?"fourth":5==a?"fifth":6==a?"sixth":"nth"};a.prototype.messageOrNext=function(a,b,c,d){return a?$("<a class=next />").text(d).click(this.proceed.bind(this,b,void 0)):$("<span/>").text(c)};a.prototype.atStep=function(a){return n.lift(function(b,c){return c&&b?c.indexOf(a)==b.length:!1})(this.progress,
this.steps.collapse())};a.prototype.onShow=function(a,b,c){this.focusOverlay.positionOnElement($(a),10,!0,!0);b&&b.call(this)};a.prototype.proceed=function(a,b){s.onThreadEnd(function(a,b){if(this.busy){var c=this.progress.get();void 0!==b&&!f.last(c).match(b)||f.last(c)==a||(q.trackWithMode("onboarding-tutorial-flow-"+a,{version:this.version}),this.progress.set(c.concat(a)))}}.bind(this),arguments,"proceed",this)};a.prototype.back=function(){s.onThreadEnd(function(){var a=this.progress.get();this.progress.set(a.slice(0,
a.length-1))}.bind(this),arguments,"back",this)};a.prototype.balloon=function(a,b,c,f,g,h,k,l,m,p,q){m=n.value(m||!1);p=n.value(p||!1);q=n.value(q||!1);b=$("<div class=tutorial />").append($("<strong/>").append(l),$("<br/><br/>"),b,$("<div class=progress />").rToggleDisplay(d.or(m,p,q)).append($("<div class=bw/>").rToggleDisplay(m).text("< back").click(this.back),$("<div class=fw/>").text("next >").rToggleDisplay(p).click(this.proceed.bind(this,f,void 0)),$("<div class=quit/>").text("done!").rToggleDisplay(q).click(this.proceed.bind(this,
f,void 0)),$("<br/>")));new e(this.vog,{pred:a,html:b,target:function(a){$(c).length?a($(c).first()):this.proceed(f,void 0)}.bind(this),width:320,position:k||"bottom",elementPadding:20,noClose:!0,onShow:this.onShow.bind(this,c,g,void 0),onClose:h,className:"vog-tutorial"})};a.prototype.cancel=function(){this.progress.set(this.steps.get().concat("cancel"));this.focusOverlay.close();this.description.remove()};a.prototype.installSetCollection=function(a){a="set-collection-"+a;this.steps.set(this.steps.get().concat(a));
var b=this.document.bind(function(a){return a&&a.categoryTracking&&a.categoryTracking.category}).sample(400).map(function(a){return a&&0<a.length});this.balloon(d.and(this.editingContentDocument,this.atStep(a)),"First, we need to put them in a collection. Pick a descriptive name like 'restaurant', 'essay', or 'video'.",".keyvalue tr",a,function(){var a=$(".keyvalue td a");$(".keyvalue")[0].component.get().startEditing(a)},void 0,"bottom","Let's create 2 Silk pages.",!1,b)};a.prototype.installAddTitle=
function(a,c){var e="add-title-"+a;this.steps.set(this.steps.get().concat(e));var k=0==c?"What is this page about?":1==c?"What is the title of your second page?":"",l=0==c?"Give this page a nice title.":"",n=m.run(m.seq(g.select(".meta [data-component-uri] .text h1"),g.deep(g.getText)),new b(document.body)).flat().map(function(a){return f.notNull(a).join().length}).sample(400);this.pool.push(n);this.balloon(d.and(this.editingContentDocument,this.atStep(e)),l,"[data-component-uri] .text",e,function(){h.selectNode($(".meta [data-component-uri] .text h1")[0],
0,0)},void 0,"bottom",k,!0,n)};a.prototype.installAddImage=function(a){a="add-image-"+a;this.steps.set(this.steps.get().concat(a));this.balloon(d.and(this.editingContentDocument,this.atStep(a)),"Or continue wihtout an image.",".image",a,void 0,void 0,"right","Silks look nicer with images. Upload one if you want to.",!0,!0)};a.prototype.installAddPara=function(a){a="add-para-"+a;this.steps.set(this.steps.get().concat(a));this.balloon(d.and(this.editingContentDocument,this.atStep(a)),"Type some text here or continue",
".layout.content [data-component-uri$='/text/1']",a,void 0,void 0,"bottom","You can also add normal content like text and images on your Silk pages.",!0,!0)};a.prototype.installNewTag=function(a){a="new-tag-"+a;this.steps.set(this.steps.get().concat(a));var c=m.run(m.seq(g.select(".content .keyvalue textarea")),new b(document.body)).length();this.balloon(d.and(this.editingContentDocument,d.eq(c,0),this.atStep(a)),"Add your first fact.",".keyvalue .new-tag span",a,void 0,this.proceed.bind(this,a,"add-title"),
"bottom","Facts are properties of your page. Facts allow you to easily explore your pages.",!0,!1)};a.prototype.installAddTags=function(a,c){var e="add-tags-"+a;this.steps.set(this.steps.get().concat(e));var f=0==c?"Enter a fact about this page, like an address or a description.":1==c?"As you can see we remembered the tags from your first page.":"",h=0==c?"A fact is a property of your page. Tag it with a description on the left, and enter its value on the right.<br><br> E.g. '<strong>Location</strong>: Times Square'":
1==c?"Click on the tag on the left and enter a new value on the right.":"",k=0==c?"Now add another one":1==c?"Click on the next tag and enter a value":"",l=0==c?"And another one":1==c?"And the next one":"",n=m.run(m.seq(g.select(".keyvalue .data a[data-tag-uri]"),g.deep(g.getText)),new b(document.body)).flat().sample(500).map(function(a){return(a||[]).filter(function(a){return a&&0<a.length})}),q=$("<div/>").rHtml(n.map(function(a){switch(a.length){case 0:return $("<span/>").html(h);case 1:return $("<span/>").html(k);
case 2:return $("<span/>").html(l);default:return $("<span/>")}}.bind(this)));this.balloon(d.and(this.editingContentDocument,this.atStep(e)),q,".keyvalue",e,void 0,void 0,"bottom",f,!1,d.gt(n.mapProp("length"),2))};a.prototype.installSavePage=function(a,b){var c="save-page-"+a;this.steps.set(this.steps.get().concat(c));var e="You just finished your "+this.nth(a+1)+" Silk page!",f=0==b?"Save your page":"";this.balloon(d.and(this.editingContentDocument,this.document.mapProp("dirtyTracking").bindProp("dirty"),
this.atStep(c)),f,".toolbar-button.save-page",c,void 0,this.proceed.bind(this,c),"bottom",e,!1)};a.prototype.installNewPage=function(a){var b="new-page-"+a;this.steps.set(this.steps.get().concat(b));var c=this.document.bind(function(a){return a&&a.categoryTracking&&a.categoryTracking.asTag}).mapProp("name"),e="Create the "+this.nth(a+1)+" in  page in the collection.",e=$("<span/>").rHtml(c.map(function(b){return $("<span/>").html("Create the "+this.nth(a+1)+" page in your <strong>"+b+"</strong> collection.")}.bind(this)));
this.balloon(d.and(d.not(this.editingContentDocument),d.inRange(Silk.domain.repository.documents,1,2),this.atStep(b)).sample(500),"","#product-bar .new-page-menu",b,void 0,this.proceed.bind(this,b),"bottom",e)};a.prototype.installToYourHomepage=function(a){a="to-your-homepage-"+a;this.steps.set(this.steps.get().concat(a));this.balloon(d.and(d.eq(this.document.mapProp("type"),"content"),d.neq(this.document.bindProp("uri"),"home"),this.atStep(a)),"","#top-bar .site-name",a,function(){this.description.fadeOut()}.bind(this),
this.proceed.bind(this,a),"bottom","Let's have a look at your homepage")};a.prototype.installExplore=function(a){a="explore-"+a;this.steps.set(this.steps.get().concat(a));this.balloon(d.and(d.eq(this.document.mapProp("type"),"content"),d.eq(this.document.bindProp("uri"),"home"),this.atStep(a)),"You can now explore your result or create new pages, etc",".toolbar-button.explore",a,function(){this.description.hide();this.focusOverlay.close()}.bind(this),void 0,"bottom","Great job!",!1,!1,!0)};a.prototype.installWeAreDone=
function(){this.steps.set(this.steps.get().concat("done"));this.atStep("done").wait(function(a){return a},this.done.bind(this))};a.prototype.done=function(){this.progress.set(this.progress.get().concat("done"));this.description.remove();this.focusOverlay.close()};a.prototype.stop=function(){this.done()};return a}();k.FirstEditSession=u})(k.tutorial||(k.tutorial={}))})(m.ui||(m.ui={}))})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(m){(function(k){var l=a.typlib.Strings,m=a.typlib.Images,g=a.typlib.Svg,e=a.typlib.Tracking,d=function(){function a(b){var d;this.flyoutShow=this.flyoutShow.bind(this);this.trackingTimeout=this.trackingTimeout.bind(this);this.flyoutHide=this.flyoutHide.bind(this);this.flyoutShowTablet=this.flyoutShowTablet.bind(this);if(d=function(a){this.paths=a;this.trackingTimer=this.flyoutSigninLink=this.flyoutGetStartedLink=this.flyoutClose=this.flyoutWrapper=this.flyoutTrigger=this.flyoutTriggerWrapper=
this.container=null;this.setup();this.setupEvents()}.apply(d||this,arguments))return d}a.getDomain=function(a){return a.split(".").slice(-2).join(".")};a.FoldOut=a;a.prototype.setup=function(){this.container=$("#container");var a=this.paths.loginProtocol+"://www."+this.paths.loginHost+"/product",b=this.getSigninUrl(),a=l.interpolateAsHtml(Resource.FoldOut,{urlSignin:b,urlGetStarted:a});$("body").append(a);this.flyoutGetStartedLink=$("#flyout-getstarted-link");this.flyoutSigninLink=$("#flyout-signin-link");
this.flyoutGetStartedLink.click(function(){e.trackWithMode("foldout-getstarted-link",{});return!0});this.flyoutSigninLink.click(function(){e.trackWithMode("foldout-signin-link",{});return!0});a=Resource.FoldOutTrigger;$("#top-bar").children(".body").children(".content").append(a);this.flyoutTriggerWrapper=$(".flyout-trigger-wrapper");this.flyoutTrigger=$(".flyout-trigger");this.flyoutWrapper=$(".flyout-wrapper");this.flyoutClose=$(".flyout-close");this.flyoutClose.html(g.renderIcon(m.cross(5),40,
40,1))};a.prototype.getSigninUrl=function(){var a=this.paths.loginProtocol+"://www."+this.paths.loginHost+"/signin";return a+="?t="+window.location.href};a.prototype.setupEvents=function(){this.flyoutTrigger.mouseenter(this.flyoutShow);this.flyoutWrapper.mouseleave(this.flyoutHide);this.flyoutTriggerWrapper.click(this.flyoutShowTablet);this.flyoutClose.click(this.flyoutHide)};a.prototype.flyoutShow=function(){e.trackWithMode("foldout-open",{});this.container.addClass("flyout-active");this.flyoutTriggerWrapper.addClass("active");
this.flyoutWrapper.addClass("active").removeClass("tablet");this.flyoutWrapper.show().stop(!0,!1).animate({width:"420px"});this.container.stop(!0,!1).animate({right:"420px"},{step:function(){$(window).trigger("resize")}});this.trackingTimer=setTimeout(this.trackingTimeout,3E3)};a.prototype.trackingTimeout=function(){e.trackWithMode("foldout-open-3s",{})};a.prototype.flyoutHide=function(){clearTimeout(this.trackingTimer);var a={step:function(){$(window).trigger("resize")}},a={step:function(){$(window).trigger("resize")}};
e.trackWithMode("foldout-hide",{});this.container.removeClass("flyout-active");this.flyoutTriggerWrapper.removeClass("active");this.flyoutWrapper.removeClass("active");this.flyoutWrapper.stop(!0,!1).animate({width:"0px"},function(){$(this).hide()});this.container.stop(!0,!1).animate({right:"0px"},a)};a.prototype.flyoutShowTablet=function(){e.trackWithMode("foldout-open",{});this.flyoutClose.addClass("tablet");this.flyoutShow()};return a}();k.FoldOut=d})(m.ui||(m.ui={}))})(a.silk||(a.silk={}))})(_||
(_={}));(function(a){(function(a){var k=function(){function a(){}a.setup=function(){k();g()};a.addEvents=function(){jQuery.each("DOMSubtreeModified DOMAttrModified DOMNodeInserted DOMNodeRemoved DOMCharacterDataModified DOMNodeInsertedIntoDocument DOMNodeRemovedFromDocument contextmenu".split(" "),function(a,d){var b=0===d.indexOf("DOM")?d.slice(3).toLowerCase():d.toLowerCase();jQuery.fn[b]=function(a){return a?this.on(d,a):this.trigger(d)}})};a.wrapOn=function(){var a=$.fn.on;$.fn.on=function(b,d,g,h){"function"===
typeof d?h=d:"function"===typeof g&&(h=g);if(0===b.indexOf("DOM")){for(var f=0,c=this.length;f<c;f++)this[f].addEventListener(b,h,!1);return this}return a.apply(this,arguments)};var d=$.fn.off;$.fn.off=function(a,e){if(0===a.indexOf("DOM")){for(var g=0,h=this.length;g<h;g++)this[g].removeEventListener(a,e,!1);return this}return d.apply(this,arguments)}};a.redirectDOMMutationEvents=function(a,d,b){return"event"!==d?a:a&&function(b,d){if(0===b.indexOf("DOM")){for(var g=0,f=this.length;g<f;g++)this[g].addEventListener(b,
a,!1);return this}return a.apply(this,arguments)}};var k=a.addEvents,g=a.wrapOn;return a}();a.jQueryExtensions=k})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.reactive.Functions,l=a.reactive.Node,p=a.reactive.List,g=a.reactive.Value,e=function(){function a(){}a.setup=function(){function a(b){this.each(function(){var a=new l(window.document.createTextNode(""));a.textContent.is(b);(new l(this)).childNodes.set([a])});return this}function d(a){this.each(function(){var b=a.map(function(a){return a?a.get?a.get():$("<span/>").text(a).get():[]}),b=p.fromList(b).map(l.node);(new l(this)).childNodes.is(b)});return this}function e(a,
b){if(!b)return(new l(this.get(0))).attributes.get(a);this.each(function(){(new l(this)).attributes.get(a).is(b)});return this}function h(a){this.each(function(){(new l(this)).classes().push(g.value(a))});return this}function f(a,b){return this.rAddClass(k.cond(b,a,""))}function c(a,b,c){return this.rAddClass(k.cond(c,a,b))}function m(a){var b=this,c=a.onchange(function(a){b.css("visibility",a?"visible":"hidden")});(new l(this[0])).pool.push(c);void 0!==a.get()&&null!==a.get()||b.css("visibility",
"hidden");return this}function s(a,b){b=void 0===b?"block":b;var c=this,d=a.onchange(function(a){c.css("display",a?b:"none")});(new l(this[0])).pool.push(d);void 0!==a.get()&&null!==a.get()||c.css("display","none");return this}$&&($.fn.rText=a,$.fn.rHtml=d,$.fn.rAttr=e,$.fn.rAddClass=h,$.fn.rToggleClass=f,$.fn.rSwitchClass=c,$.fn.rToggleVisible=m,$.fn.rToggleDisplay=s)};return a}();m.JQuery=e})(a.reactive||(a.reactive={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.Html,l=a.typlib.Scope,p=a.typlib.jQueryExtensions,g=a.typlib.MutationEvents,e=a.typlib.ThreadEnd,d=a.typlib.ErrorHandling,b=a.reactive.JQuery,n=function(){function a(){}a.setup=function(a){d.setup(a);b.setup();k.setup();l.setup();g.setup();p.setup();e.setup()};return a}();m.Setup=n})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){(function(a){var l=function(){function a(){}a.install=function(a){a.user.uuid.onchange(function(b){b&&e(a.user,a.repository.privacy.get())})};a.disableTracking=function(){g.isTrackingDisabled=!0};a.configure=function(a,b){if(!g.isTrackingDisabled){window.startFullstory();var e=window.FS;e.setUserVars=function(a){e("user",a)};e.setSessionVars=function(a){e("session",a)};e.setPageVars=function(a){e("page",a)};e._api("user",{uid:a.uuid.get(),displayName:a.name.get(),email:a.email.get()});
"public"!=b&&"publiclyEditable"!=b||e.m._record()}};a.isTrackingDisabled=!1;var g=a,e=a.configure;return a}();a.Fullstory=l})(a.tracking||(a.tracking={}))})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(a){var k=function(){function a(){}a.init=function(){e()};a.getCookieHost=function(){var a=location.hostname.split(".");if(!(2>a.length))return"."+a.slice(-2).join(".")};a.getCookies=function(){var a=g();k.supportedCookies.forEach(function(b){$.cookie(b)&&(k.cookies[b]=$.cookie(b),a&&$.removeCookie(b,{path:"/",domain:a}))})};a.supportedCookies=["silk_signup_action","silk_invite_accepted","silk_invite_invitor"];a.cookies={};var k=a,g=a.getCookieHost,e=a.getCookies;return a}();
a.Cookies=k;k.init()})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.tracking.Mixpanel,l=a.typlib.tracking.GoogleAnalytics,p=a.typlib.tracking.Intercom,g=a.typlib.tracking.Bugsense,e=a.typlib.tracking.Fullstory,d=a.typlib.Cookies,b=function(){function a(){}a.setupTracking=function(a){var c=a.user;b(h(c));e.install(a);p.install(a);l.trackUser(c);g.trackUser(c);k.trackUser(h(c),d.cookies,!1,f(a.repository));window.SILK_DEBUGGING&&e.disableTracking();(new Uri(location.href)).getQueryParamValues("prerender_mode").length&&e.disableTracking()};
a.trackUserFromMeta=function(){b(c());k.trackUser(c(),d.cookies,!0)};a.disableTrackingForSilkTeam=function(a){a&&a.email&&a.email.match(/@(.+\.)?silk\.co$/i)&&(k.disableTracking(),p.disableTracking(),e.disableTracking())};a.transformUserForMixpanel=function(a){return{name:a.name.get(),email:a.email.get(),uuid:a.uuid.get(),created:a.created.get()}};a.transformRepositoryForMixpanel=function(a){return{privacy:a.privacy.get()}};a.getUserFromMeta=function(){var a=$("script[api-uri='user/current']"),b;
if(!a[0])return null;try{b=JSON.parse(a.html()),b.created=new Date(b.created)}catch(c){a=$(a.html()),b={name:$("name",a).text(),email:$("email",a).text(),uuid:$("uuid",a).text(),created:new Date($("created",a).text())}}return b};var b=a.disableTrackingForSilkTeam,h=a.transformUserForMixpanel,f=a.transformRepositoryForMixpanel,c=a.getUserFromMeta;return a}();m.UserTracking=b})(a.typlib||(a.typlib={}))})(_||(_={}));(function(a){(function(m){var k=a.client.Canvas,l=a.client.InitialCache,p=a.client.component.Components,g=a.client.editing.Discarder,e=a.client.model.Loader,d=a.client.model.migrate.Migrate,b=a.client.ui.FocusManager,n=a.domain.Domain,r=a.lib.ui.Vog,h=a.silk.BootMisc,f=a.silk.SilkRouter,c=a.silk.nav.NavLinks,q=a.silk.nav.NavStatus,s=a.silk.ui.Chrome,u=a.silk.ui.HtmlClass,t=a.silk.ui.tutorial.FirstEditSession,v=a.silk.ui.FoldOut,x=a.typlib.ErrorHandling,w=a.typlib.Setup,y=a.typlib.ThreadEnd,A=a.typlib.Tracking,
z=a.typlib.UserTracking,B=a.typlib.tracking.Bugsense,D=function(){function a(){var b;this.run=this.run.bind(this);if(b=function(){}.apply(b||this,arguments))return b}a.prepare=function(){if(!/noscript/.test(location.search)){window.Silk=new a;var b=window.console&&window.console.firebug||window.document.getUserData&&window.document.getUserData("firebug-Token");window.SILK_DEBUGGING&&!b?y.wrapThread(window.Silk.run,"silk")():(x.Api=h.setupApi(),x.createErrorWrapper(y.wrapThread(window.Silk.run,"silk"))())}};
a.Silk=a;a.prototype.run=function(){var a=new Uri(location.href);this.paths=h.setupPaths();this.browser=h.setupBrowser();p.setup();this.api=h.setupApi(this.paths.loginProtocol);w.setup(this.api);var m=!!a.getQueryParamValues("prerender_mode").length;B.setup(this.paths.bugsenseApiKey,m);this.productName="Silk";this.demoMode=-1<=window.document.cookie.indexOf("silkDemoMode=on");this.initialCache=new l;this.domain=new n(this.api,this.initialCache,this.silkType,d.migrate);this.domain.ensureLoaded();h.setupJQueryUISortableKludge();
var x=a.path()==a.anchor()||!a.anchor(),a=$(document).find("#canvas [data-article]").remove()[0],m=$(document).find("#canvas [data-pinned-components]").remove()[0],a=x?a:null,m=x?m:null,y=$("#page-is-autosave").remove()[0],x=x?!!y:!1;this.canvas=new k(this.domain,this.browser,this.silkType);this.loader=new e(this.canvas,this.api.Page,this.api.Pin,this.domain.tagList,this.domain.repository);this.vog=new r(this.domain);A.install(!this.domain.user.anonymous.get(),this.domain.repository.uri.get(),this.domain.repository.customAnalytics.get());
z.setupTracking(this.domain);this.htmlClass=new u(this.canvas,this.browser,this.silkType);this.foldOut=new v(this.paths);this.router=f.install(this.domain,this.api,this.canvas,this.loader,this.canvas.routerDocument,a,x,m);h.setupGoogleMap(document,window);b.setup();this.discarder=new g(this.loader,this.canvas.document);this.ui=new s(this.canvas,this.domain,this.silkType,this.api.Page,this.htmlClass,this.discarder,this.loader,this.productName,this.vog);h.setupFirebugCheck(this.ui.noticeBar);h.setupBetterPopupBlockerCheck(this.ui.noticeBar);
h.setupViewerOnlyCheck(this.ui.noticeBar,this.browser,this.domain.user,this.canvas.document);h.setupOldWebkitCheck(this.ui.noticeBar,this.browser,this.domain.user);$(window.document.body).click(c.handleNavigationClick.bind(null,q.show));h.setupWindowTitle(this.canvas.document,this.domain.repository,this.productName);h.setupVogTriggers(this.vog,this.domain,this.canvas);(new t).start()};a.prototype.silkType="product";a.prototype.paths=void 0;a.prototype.browser=void 0;a.prototype.api=void 0;a.prototype.shortUrl=
void 0;a.prototype.productName="Silk";a.prototype.demoMode=!1;a.prototype.initialCache=void 0;a.prototype.domain=void 0;a.prototype.uri=void 0;a.prototype.useCache=!1;a.prototype.article=void 0;a.prototype.pageIsAutosave=void 0;a.prototype.canvas=void 0;a.prototype.loader=void 0;a.prototype.vog=void 0;a.prototype.router=void 0;a.prototype.discarded=void 0;a.prototype.htmlClass=void 0;a.prototype.ui=void 0;a.prototype.discarder=void 0;return a}();m.Silk=D})(a.silk||(a.silk={}))})(_||(_={}));(function(a){(function(m){var k=a.typlib.BrowserCheck,l=a.ui.TopBar,p=function(){function a(){}a.prepare=function(){var a=k.browser;$("html").addClass("cannot-view");l.trackCurrentUri();l.installUserMenu();var g=$("<div class=browser-warning />").prependTo("body");g.append("Your browser does not support all features of Silk.<br>","Please consider upgrading or installing ","<a href=http://www.google.com/chrome>Chrome</a> or ","<a href=http://www.mozilla.com/firefox>Firefox</a>.<br>");a.canUpgrade&&
g.append($("<strong/>").append("Or try the ",$("<a href=#>Google Chrome Frame</a>").click(b)),"<br>");g.append($("<a href=#>(dismiss)</a>").click(e));a.canUpgrade&&d()};a.hideBrowserWarning=function(){$(".browser-warning").hide()};a.loadChromeFrameJS=function(){$.getScript("//ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js")};a.startChromeFrame=function(){window.CFInstall.check({mode:"overlay"})};var e=a.hideBrowserWarning,d=a.loadChromeFrameJS,b=a.startChromeFrame;return a}();m.CannotView=
p})(a.silk||(a.silk={}))})(_||(_={}));
Resource = {};Resource["ImageControls"] = "<div class=controls>\n  <a class=\'zoom-in\'>+</a><a class=\'zoom-out\'>-</a><a class=\'zoom-reset\'>1:1</a>\n</div>\n\n<div class=upload-ui>\n  <div class=\'silk\'>\n    <p>Drop an image</p>\n    <p>or click here</p>\n  </div>\n  <div class=\'bookmarklet\'>\n    <p class=\'number\'></p>\n    <p class=\'subtext\'>Images found</p>\n    <a class=\'button\'>pick one</a>\n  </div>\n</div>\n\n<div class=resize-handle></div>\n";Resource["SiteInfo"] = "<div class=\"counts\">\n  <div class=\"page-count\">\n    <div class=\"top-line\"/>\n    <div class=\"type\"/>\n  </div>\n  <div class=\"member-count\">\n    <div class=\"top-line\"/>\n    <div class=\"type\"/>\n  </div>\n  <div class=\"follower-count\">\n    <div class=\"top-line\"/>\n    <div class=\"type\"/>\n  </div>\n</div>\n";Resource["ImporterSection"] = "<div class=\"step-upload\">\n  <div class=\"importer-title\">Import a spreadsheet</div>\n  <div class=\"drop\">\n    <div class=\"upload-icon\"></div>\n    <div class=\"description\">\n      <p>Start by dropping a <strong>CSV</strong><span class=\"secret-feature\"> or <strong>Excel</strong></span> file</p>\n    </div>\n    <div class=\"alternative\">or click to pick one from disk</div>\n  </div>\n  <div class=\"gsheets secret-feature\">\n    <div class=\"gsheets-icon\">\n      <input type=\"text\" value=\"\" placeholder=\"OR PASTE A GOOGLE SHEETS URL HERE\">\n    </div>\n  </div>\n</div>\n";Resource["PageSection"] = "<div class=header>\n  <h2></h2>\n  <span class=tag-empty>No pages yet</span>\n  <a class=tag-link>Explore this collection</a>\n\n  <div class=page-count>\n    <div class=counter></div>\n    <div class=description></div>\n  </div>\n\n  <div class=delete></div>\n</div>\n\n<div class=\"table not-empty\">\n  <div class=loading>\n    <div class=indicator></div>\n  </div>\n</div>\n\n<div class=\"more-pages\"> There are <span class=\"num-pages\"></span> more pages in this collection. <a href=\"#\" class=\"explore-more\">Explore them.</a> </div>\n\n<form>\n  <div class=\"description no-collection\">Add more pages</div>\n  <div class=\"description not-empty\">Add more pages</div>\n  <div class=\"description empty\">Add pages to this collection</div>\n  <input class=\"add\" type=submit value=\"Add\">\n  <input type=text class=\"text\" name=\"name\">\n  <div class=\"loading-indicator\"></div>\n  <div class=\"form-error\"/>\n</form>\n\n<div class=delete-confirm>\n   <div class=warning>All documents in this collection will be deleted! Are you sure?</div>\n   <div class=actions>\n     <a class=ok    >Delete</a>\n     <a class=cancel>Cancel</a>\n   </div>\n</div>\n\n<div class=delete-working>\n  <div class=progress></div>\n  <div class=message>Deleting collection, please be patient...</div>\n</div>\n\n<div class=delete-failed>\n  <div class=message>Not all pages in the collection could be deleted. Please reload this page and try again. If you need assistance, please email <a href=\"email:support@silk.co\">support@silk.co</a> or use the <a href=\"http://www.silk.co/feedback\">feedback form</a>.</div>\n</div>\n";Resource["TagOverview"] = "<section class=manage>\n  <div class=header>\n    <h2>Tags</h2>\n    <br>\n  </div>\n  <div class=tags>\n    <table class=\"line-separated used\">\n      <thead><th></th><th>Tag</th><th>Also used in</th></thead>\n      <tbody></tbody>\n    </table>\n  </div>\n</section>\n";Resource["Configuration"] = "<div class=simple-configuration>\n  <div class=switcher>\n    <div class=line></div>\n    <a class=customize>Customize view</a>\n    <div class=view>\n      <a class=list data-view-uri=\"querytable\"></a><a class=grid data-view-uri=\"pagegrid\"></a><a class=map  data-view-uri=\"googleviz/map\"></a>\n    </div>\n  </div>\n</div>\n";Resource["TagPreview"] = "<div class=\"empty-message\">\n  <p>Create some pages and you</p>\n  <p>will see an overview here</p>\n</div>\n<div class=\"previews\"></div>\n";Resource["Upload"] = "<div class=upload-ui>\n  <p>Drop a file</p>\n  <p>or click here</p>\n</div>\n";Resource["UrlPreview"] = "<div class=\"unconfigured\"><i>This component hasn\'t been configured yet</i></div>";Resource["YourSites"] = "<div class=\"site-list\">\n  <div class=\"table\"/>\n</div>\n\n<div class=\"site-actions\">\n  <a class=\"new-site-button dashboard-side-button\" href=\"\">Create a new Silk</a>\n  <a class=\"tutorials-button dashboard-side-button\" href=\"\">Tutorials</a>\n</div>\n<div class=\"discovery-actions\">\n  <a class=\"discover-button dashboard-side-button\" href=\"\" target=\"_blank\">Discover more Silks</a>\n</div>\n\n<div class=\"dashboard-footer\"/>\n";Resource["BookmarkletDocument"] = "<section class=\"bookmarkletAddToSiteDocument block\">\n  <h1>Create a bookmarklet</h1>\n\n  <div class=\"content\">\n    <div id=\"marklet\">\n      <input type=\"hidden\" name=\"siteUri\" id=\"siteUri\" value=\"{#siteUrl}\" class=\"hidden\">\n      <label for=\"category\">Default page collection</label>\n      <select id=\"category\"/>\n    </div>\n\n    <p>Drag this button onto your bookmark bar to save it.</p>\n\n    <a href=\"#\" class=\"primary-action add\" id=\"bookmark\">Add to {#siteName}</a>\n  </div>\n\n  <div class=\"footer\">\n    Tip: Make sure you are logged in to Silk before using the bookmarklet.\n  </div>\n</section>\n";Resource["InsertBlocksBlock"] = "<div>\n  <div class=\"add-button\"></div>\n  <div class=\"headers\">\n  </div>\n  <div class=\"widget-sections\">\n  </div>\n  <div class=\"detail\">\n    <div class=\"ibb-header\"></div>\n    <form class=\"form\">\n      <input type=\"text\" class=\"text\" placeholder=\"http://\">\n      <input type=\"submit\" value=\"Add\">\n    </form>\n  </div>\n</div>\n";Resource["ImportDocument3"] = "<section class=\"import3\">\n\n  <div class=\"import-toolbar\">\n    <!-- top part -->\n    <div class=\"import-title\">Import data into Silk</div>\n    <div class=\"toolbar-buttons\">\n      <div class=\"toolbar-button cancel-import-button\">\n        Cancel Import\n      </div><div class=\"toolbar-button action start-import-button\">\n        Start Import &nbsp;\n      </div>\n    </div>\n  </div>\n\n  <div class=\"body\">\n\n    <div class=\"step-loading\">\n    </div>\n\n    <div class=\"step-upload drop-area\">\n      <div class=\"click-area\">\n        <div class=\"upload-icon\"></div>\n        <div class=\"description\">\n          <!--\n          <p>Start by dropping either a<br>\n          <strong>JSON, CSV, Excel</strong> or <strong>Numbers</strong><br>\n          document</p>\n          -->\n          <p>Start by dropping a <strong>CSV</strong><span class=\"secret-feature\"> or <strong>Excel</strong></span> file</p>\n        </div>\n        <div class=\"alternative\">or click to pick one from disk</div>\n      </div>\n      <div class=\"gsheets secret-feature\">\n        <div class=\"gsheets-icon\">\n          <input type=\"text\" value=\"\" placeholder=\"OR PASTE A GOOGLE SHEETS URL HERE\">\n        </div>\n      </div>\n    </div>\n\n    <div class=\"step-uploading\">\n      <div class=\"upload-icon\"></div>\n      <div class=\"uploading\">Uploading:</div>\n      <div class=\"upload-filename\"></div>\n\n      <div class=\"sheet-list\">\n        <div class=\"sheet-list-title\">This spreadsheet contains multiple sheets, select one:</div>\n        <div>\n          <div class=\"sheet-list-list\"></div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"step-upload-error\">\n      <div class=\"upload-icon\"></div>\n      <div class=\"error-title\">Error while uploading:</div>\n      <div class=\"error-description\"></div>\n      <div class=\"buttons\">\n        <div class=\"toolbar-button action reprepare-button\">\n          Retry\n        </div><a class=\"toolbar-button get-help-button\" href=\"mailto:support@silk.co\">\n          Get help\n        </a>\n      </div>\n    </div>\n\n    <div class=\"step-preview\">\n      <!-- cards -->\n\n      <div class=\"prev-button paging-button\"></div>\n      <div class=\"next-button paging-button\"></div>\n\n      <div class=\"topbar\">\n        <div class=\"pages\">Previewing page <span class=\"current-page\"></span> of <span class=\"preview-total\"></span></div>\n        <div class=\"title-selector-title\">\n          <span>Page title</span>\n          <span class=\"warning\">WARNING: <a href class=\"duplicate-count\"></a> occur multiple times</span>\n        </div>\n        <div class=\"title-selector-bar\"></div>\n      </div>\n\n      <div data-article class=\"fake-article\">\n        <div class=\"header\"></div>\n        <div class=\"left-section\">\n          <div class=\"import-block\">\n            <h1 class=\"title\"></h1>\n          </div>\n          <div class=\"left-column\"></div>\n        </div>\n        <div class=\"right-section\">\n          <div class=\"import-block\">\n            <table class=\"factsheet\"></table>\n          </div>\n          <div class=\"right-column\"></div>\n        </div>\n      </div>\n\n    </div>\n\n    <div class=\"step-running\">\n      <div class=\"importing\">Importing: <span class=\"import-collectionname\"></span></div>\n      <div class=\"progress-text\">Starting...</div>\n      <div class=\"progress-errored-text\"></div>\n      <div class=\"progress-bar\"><div class=\"progress\"></div></div>\n      <div class=\"toolbar-button abort-import-button\">\n        Abort Import\n      </div>\n    </div>\n\n    <div class=\"step-complete\">\n      <p class=\"complete\">Congratulations, your import is complete!</p>\n      <p class=\"errored\">Your import is complete, however some pages failed to import.</p>\n      <p class=\"showtagpages\"><a href=\"#\">Show all \'<span class=\"tagname\"></span>\' pages</a></p>\n    </div>\n\n    <div class=\"step-aborted\">\n      <div class=\"error-title\">The import was aborted</div>\n      <div class=\"buttons\">\n        <div class=\"toolbar-button start-new-button\">\n          Start a new import\n        </div><div class=\"toolbar-button retry-button\">\n          Retry\n        </div>\n      </div>\n    </div>\n\n    <div class=\"step-errored\">\n      <div class=\"error-title\">There was an error running the import</div>\n      <div class=\"buttons\">\n        <div class=\"toolbar-button start-new-button\">\n          Start a new import\n        </div><div class=\"toolbar-button retry-button\">\n          Retry\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n</section>\n";Resource["NewHomepage"] = "<div data-article=\"\" data-title=\"Homepage\">\n  <section class=\"header\">\n    <div class=\"layout\">\n      <div data-component-uri=\"//silk.co/block/simple/1\">\n        <div data-component-uri=\"//silk.co/widget/text/1\">\n          <h1><site-name /></h1>\n        </div>\n      </div>\n      <div data-component-uri=\"//silk.co/block/simple/1\">\n        <div data-component-uri=\"//silk.co/widget/image/1\">\n          <a><img data-height=\"190\" data-left=\"0\" data-top=\"0\" data-zoom=\"100\" /></a>\n        </div>\n      </div>\n    </div>\n  </section>\n\n\n  <section class=\"body\">\n    <div class=\"layout meta\">\n      <div data-component-uri=\"//silk.co/block/simple/1\">\n        <div data-component-uri=\"//silk.co/widget/text/1\">\n          <h2>Made with Silk</h2>\n          <p><a href=\"//www.silk.co/home\">Silk is a place to explore the world through data.</a> Silk displays data as beautiful interactive charts, maps and web pages. <a href=\"//silk.co/product\">Create your own free Silk now.</a></p>\n        </div>\n      </div>\n      <div data-component-uri=\"//silk.co/block/simple/1\">\n        <div data-component-uri=\"//silk.co/widget/image/1\">\n          <a><img data-height=\"190\" data-left=\"0\" data-top=\"0\" data-zoom=\"100\" /></a>\n        </div>\n      </div>\n      <div data-component-uri=\"//silk.co/block/simple/1\">\n        <div data-component-uri=\"//silk.co/widget/tag-counter/1\"></div>\n      </div>\n    </div>\n\n    <div class=\"layout content\">\n      <div data-component-uri=\"//silk.co/block/simple/1\">\n        <div data-component-uri=\"//silk.co/widget/tag-preview/1\"></div>\n      </div>\n      <div data-component-uri=\"//silk.co/block/simple/1\">\n        <div data-component-uri=\"//silk.co/widget/text/1\">\n          <p></p>\n        </div>\n      </div>\n    </div>\n    <br>\n  </section>\n</div>\n";Resource["NewPage"] = "<div data-article=\"\" data-new=\"\">\n  <section class=\"body\">\n    <div class=\"layout meta\">\n      <div data-component-uri=\"//silk.co/block/simple/1\">\n        <div data-component-uri=\"//silk.co/widget/text/1\" class=\"header\" data-placeholder=\"Insert title here...\">\n          <h1><br></h1>\n        </div>\n      </div>\n      <div data-component-uri=\"//silk.co/block/figure/1\">\n        <div class=\"figure-title\">\n          <div data-component-uri=\"//silk.co/widget/text/1\" data-placeholder=\"Optional title...\">\n            <p><br></p>\n          </div>\n        </div>\n        <div class=\"figure-content\">\n          <div data-component-uri=\"//silk.co/widget/image/1\">\n            <a><img data-width=\"250\" data-height=\"190\" data-left=\"0\" data-top=\"0\" data-zoom=\"100\" /></a>\n          </div>\n        </div>\n        <div class=\"figure-description\">\n          <div data-component-uri=\"//silk.co/widget/text/1\" data-placeholder=\"Optional caption...\">\n            <p><br></p>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"layout content\">\n      <div data-component-uri=\"//silk.co/block/simple/1\">\n        <div data-component-uri=\"//silk.co/widget/keyvalue/1\"></div>\n      </div>\n      <div data-component-uri=\"//silk.co/block/simple/1\">\n        <div data-component-uri=\"//silk.co/widget/text/1\">\n          <p><br></p>\n        </div>\n      </div>\n    </div>\n    <br>\n  </section>\n</div>\n";Resource["FoldOut"] = "<div class=\"flyout-wrapper\">\n  <div class=\"flyout-cloud\"></div>\n  <div class=\"flyout-cloud\"></div>\n  <div class=\"flyout-cloud\"></div>\n  <div class=\"flyout-cloud\"></div>\n  <div class=\"flyout-cloud\"></div>\n  <div class=\"flyout-hawk\"></div>\n  <div class=\"flyout-hawk shadow\"></div>\n  <div class=\"flyout-content-wrapper\">\n    <div class=\"flyout-content\">\n      <div class=\'flyout-close\'></div>\n      <div class=\"flyout-logo-silk\"></div>\n\n      <h3>This site was<br />made with Silk.</h3>\n      Silk is a place to publish your data.<br /><br />\n      Each Silk contains data on a specific topic. Anyone can browse a Silk to explore data and create beautiful interactive charts, maps and web pages.\n\n      <div class=\"cta-signup\">\n        <a id=\"flyout-getstarted-link\" href=\"{#urlGetStarted}\">\n          <div class=\"button\">\n            Learn More\n          </div>\n        </a>\n      </div> \n\n      <div class=\"cta-signin\">\n        <a id=\"flyout-signin-link\" href=\"{#urlSignin}\">or sign in</a>\n      <div>\n    </div>\n\n    <div class=\"flyout-content-shadow\">\n    </div>\n  </div>\n\n</div>\n";Resource["FoldOutTrigger"] = " <div class=\"flyout-trigger-wrapper\">\n   <div class=\"flyout-trigger\">\n     <span>Made with silk</span>\n     <span class=\"logo-flyout-trigger\"></span>\n   </div>\n </div>\n";Resource["InPageBar"] = "<div id=in-page-bar>\n  <div id=in-page-actions>\n    <a class=\"secondary-action share\">Share</a>\n    <div id=share-buttons></div>\n  </div>\n  <div id=\"breadcrumb\" />\n</div>\n";Resource["DeleteSiteDialog"] = "<form>\n\n  <div class=\"before-delete-message\">\n    <div class=\"warning\">Are you sure? This will delete all of your content.</div>\n\n    <table>\n    <tbody>\n      <tr>\n        <td class=\"label\">Password</td>\n        <td class=\"value form-element password-container\">\n          <input type=\"password\" class=\"password\" name=\"password\">\n          <label for=\"password\" class=\"error\"/>\n        </td>\n      </tr>\n    </tbody>\n    </table>\n\n    <label><input type=\"checkbox\" name=\"keep-domain\" class=\"keep-domain\" value=\"yes\" checked=\"checked\">\n      Keep the domain {#siteURL}, just wipe the site clean.</label>\n\n  </div>\n\n  <p class=\"after-wipe-message\">Your site {#siteURL} has been wiped clean.</p>\n  <p class=\"after-delete-message\">Your site {#siteURL} no longer exists. Redirecting to the dashboard...</p>\n\n  <div class=\"actions\">\n    <a class=\"delete-or-wipe\">Wipe</a>\n    <a class=\"cancel\">Cancel</a></td>\n  </div>\n\n</form>\n";Resource["Members-row"] = "<tr>\n  <td class=\"name\"/>\n  <td class=\"email-status\">\n    <div class=\"email\"/>\n  </td>\n  <td class=\"role-resend\">\n    <div class=\"role\">\n      <select class=\"change-role\">\n        <option>Viewer</option>\n        <option selected=yes>Editor</option>\n        <option>Admin</option>\n      </select>\n    </div>\n    <div class=\"resend\"><a class=\"resend-link\">Resend</a></div>\n  </td>\n  <td class=\"remove\"><a class=\"delete\"></a></td>\n  <td class=\"buttons\" colspan=\"2\">\n    <form>\n      <span class=\"message\" />\n      <div>\n        <a class=\"ok danger\"></a>\n        <a class=\"cancel\">Cancel</a>\n      </div>\n    </form>\n  </td>\n  <td class=\"spinner\" colspan=\"2\" />\n</tr>\n";Resource["Members"] = "<section class=\'block users\'>\n\n  <h1>Members</h1>\n\n  <div class=\"users-container\">\n    <table class=\"users\">\n      <tbody class=\"empty\"><tr><td></td></tr></tbody>\n      <tbody class=\"active\"></tbody>\n      <tbody class=\"pending\"></tbody>\n    </table>\n  </div>\n\n</section>\n";Resource["Settings"] = "<div>\n  <section class=\'manage site block\'>\n\n    <h1>Settings</h1>\n\n    <table class=\"settings-table\">\n    <tbody>\n      <tr>\n        <td class=\"label\">Site URL:</td>\n        <td class=\"value siteuri\"></td>\n      </tr>\n      <tr>\n        <td class=\"label\">Site name:</td>\n        <td class=\"value sitename\">\n          <input type=\"text\">\n        </td>\n      </tr>\n      <tr>\n        <td class=\"label\">Template:</td>\n        <td class=\"value template\">\n          <input type=\"text\">\n        </td>\n      </tr>\n      <tr>\n        <td class=\"label\">Privacy:</td>\n        <td class=\"value privacy\">\n          <label class=\"private\"         ><input type=\"radio\" name=\"privacy\" value=\"private\"         >Private</label>\n          <label class=\"public\"          ><input type=\"radio\" name=\"privacy\" value=\"public\"          >Public</label>\n          <label class=\"publiclyEditable\"><input type=\"radio\" name=\"privacy\" value=\"publiclyEditable\">Silk users can edit</label>\n        </td>\n      </tr>\n    </tbody>\n    </table>\n\n    <div class=\"footer\">\n      <div id=\"delete-site\">Delete site</div>\n    </div>\n\n  </section>\n  <div id=\"delete-site-content\" class=\"manage block\"></div>\n</div>\n";Resource["NamePageDialog"] = "<h3>Name the page</h3>\n<form>\n  <div class=\"field\">\n    <label for=\"pageName\">Name</label>\n    <input class=\"pageName\" autocomplete=\"off\" name=\"pageName\" type=\"text\">\n    <label for=\"pageName\" class=\"page-error error\"></label>\n  </div>\n  <div class=\"actions\">\n    <input type=\"submit\" class=\"create\" value=\"Create page\">\n    <a class=\"cancel\">Cancel</a>\n  </div>\n</form>\n";Resource["Invite"] = "<form id=\"invite-form\">\n\n  <div class=\"email-role\">\n    <div class=\"email\">\n      <label for=\"invite-email\" class=\"error msg\"></label>\n      <label for=\"invite-email\" class=\"invite-email-label\">Add:</label>\n      <input type=\"text\" placeholder=\"Email address\" class=\"invite-email\" name=\"invite-email\">\n    </div>\n\n    <div class=\"role\">\n      <label id=\"invite-as\" for=\"invite-role\">as a:</label>\n      <select class=\"invite-role\" name=\"invite-role\">\n        <option>Viewer</option>\n        <option selected=\"yes\">Editor</option>\n        <option>Admin</option>\n      </select>\n      <label class=\"invite-editor-checkbox-label\" for=\"invite-editor-checkbox\">\n        <input type=\"checkbox\" id=\"invite-editor-checkbox\">Allow editing\n      </label>\n    </div>\n  </div>\n\n  <div class=\"note-noconfirm\">\n    <span class=\"noconfirm\"><label for=\"noconfirm\"><input type=\"checkbox\" class=\"noconfirm\" name=\"noconfirm\">Skip message</label></span>\n  </div>\n\n  <div class=\"button-container\">\n    <input type=\"submit\" class=\"invite-button\" value=\"Invite\">\n  </div>\n\n</form>\n";
