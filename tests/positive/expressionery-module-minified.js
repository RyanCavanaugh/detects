var bbox;!function(t){function e(){}function i(){t.events=new t.managers.EventManager,t.events.on(t.events.INIT,function(){t.log("> INIT++++++++++++++++++++++"),t.$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">'),t.$.ajaxSetup(t.getAjaxSetup()),t.services=new t.managers.ServiceManager,t.service.saveService=new t.service.SaveService,t.actionManager=new t.managers.ActionManager,t.errors=new t.managers.ErrorManager,t.imageManager=new t.managers.ImageManager,t.editorManager=new t.managers.EditorManager,t.peepsManager=new t.managers.PeepsManager,t.cacheManager=new t.managers.CacheManager,t.requirementValidationManager=new t.managers.RequirementValidationManager,t.guidedUITipManager=new t.managers.GuidedUITipManager,t.sceneManager=new t.managers.SceneManager,t.config=new t.utils.Config(t.vars),t.config.setProductNameHTML(t.$("#productDetailName").html()),t.service.spriteService=new t.service.SpriteService,t.services.loadChannelConfig(),t.dialogs=new t.managers.DialogManager,t.ui=new t.managers.UIManager,t.fonts=new t.managers.FontManager,t.selections=new t.managers.SelectionManager,t.wizard=new t.managers.WizardManager,document.body.addEventListener("keyup",t._.bind(t.selections.handlerKeyUp,t.selections),!1),t.canvas=document.getElementById("appCanvas"),t.tooltips=new t.managers.TooltipManager,t.DragDrop=window.DragDrop,t.app.views.toolbarView=new t.views.ToolbarView,t.app.views.toolbarView.render(),t.app.views.canvasView=new t.views.CanvasView,t.app.views.canvasView.render(),t.app.views.assetPanelView=new t.views.AssetPanelView,t.app.views.assetPanelView.render(),t.app.views.previewView=new t.views.PreviewView,t.app.views.previewView.render(),t.app.views.sceneControlView=new t.views.SceneView,t.app.views.sceneControlView.render(),t.app.views.zoomControlView=new t.views.ZoomControlView,t.app.views.zoomControlView.render(),t.isLocalEnvironment(),t.canvas.addEventListener("mousedown",function(t){t.preventDefault()},!1),t.canvas.addEventListener("mouseup",function(t){t.preventDefault()},!1),t.canvas.addEventListener("touchstart",function(t){t.preventDefault()},!1),t.canvas.addEventListener("touchend",function(t){t.preventDefault()},!1),createjs.Ticker.addEventListener("tick",t.tick),createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.setFPS(t.frameRate),t.app.router=new t.utils.Router,t.initApp(),t.events.trigger(t.events.WINDOW_RESIZE),t.$("body").keydown(function(e){if(e.ctrlKey&&e.shiftKey&&70==e.keyCode)t.app.router.test();else if(e.ctrlKey&&e.shiftKey&&75==e.keyCode)t.services.dumpSDXML();else if(46!=e.keyCode||t.editorManager.isTextActive())e.ctrlKey&&e.shiftKey&&89===e.keyCode?t.events.trigger(t.events.HISTORY_TRANSACTION_REDO):e.ctrlKey&&e.shiftKey&&90===e.keyCode?t.events.trigger(t.events.HISTORY_TRANSACTION_UNDO):e.ctrlKey&&e.shiftKey&&69===e.keyCode?t.events.trigger(t.events.WIZARD_DISPLAY):e.ctrlKey&&e.shiftKey&&65===e.keyCode&&t.events.trigger(t.events.ZOOM_AUTO_FEATURE);else for(var i=t.stage.getNumChildren();i>0;i--){var o=t.stage.getChildAt(i-1);o.selected&&null!=t.editorManager.active&&t.editorManager.active.handleDelete()}}),t.log("< INIT++++++++++++++++++++++")}),t.events.on(t.events.CHANNEL,function(){t.log("> CHANNEL++++++++++++++++++++++"),t.timerSetup(),t.services.generateToken(),t.cacheManager.setImage(t.config.spriteSheet(),new createjs.Bitmap(t.config.spriteSheet()).image),t.log("< CHANNEL++++++++++++++++++++++")}),t.events.on(t.events.TOKEN_GENERATED,function(){t.log("> TOKEN_GENERATED++++++++++++++++++++++"),t.fonts.loadVerticaleOffsets(),t.fonts.loadFontReplacements(),t.errors.loadCatalog(),!t.utils.ObjectUtil.isEmpty(t.config.uniqueItemId())&&t.config.savedItem()?t.services.loadSavedProduct(t.config.uniqueItemId()):t.utils.ObjectUtil.isEmpty(t.config.commerceItemId())?t.services.loadNewProduct(t.config.productCode()):t.services.loadCartProduct(t.config.commerceItemId()),t.utils.AppUtil.isLocalhost(),t.log("< TOKEN_GENERATED++++++++++++++++++++++")}),t.events.on(t.events.PRODUCT,function(){t.log("> PRODUCT++++++++++++++++++++++"),t.$(t.canvas).css("background-color","#E0E0E0"),t.stage.mask.graphics.clear();var e=t.product.getActiveLayout();t.zoomNav||t.stageRoot.addChild(new t.controls.ZoomNav),t.zoomNav&&null!=t.zoomNav.center&&(t.zoomNav.center=null),t.shadowElement.graphics.beginFill("#CCC").drawRect(1,1,e.width-1,e.height-1),t.stage.mask.graphics.drawRect(0,0,e.width,e.height),t.fonts.loadFontSet(t.product.getInitialFontSet()),t.services.loadProductImageLibrary(t.config.productCode()),t.services.loadUserFiles(),t.services.loadProductOptions(),t.events.trigger(t.events.MANIFEST),t.log("< PRODUCT++++++++++++++++++++++")}),t.events.on(t.events.COMPLETE,function(){t.log("> COMPLETE++++++++++++++++++++++"),t.product.isSingleColor()&&null!=t.globalColor&&t.utils.HtmlUtil.setColorProductOption(t.globalColor);for(var e=t.stage.getNumChildren();e>0;e--){var i=t.stage.getChildAt(e-1);"bbox.controls.LiveArea"==i.type&&(t.stage.removeChild(i),t.stage.addChild(i))}t.config.isReorder()?t._.delay(function(){window.location.assign("#preview"),t.hideLoading()},500):t.hideLoading(),t.productLoadedFlag=!0,t.app.views.sceneControlView.checkSceneStatus();var o=setTimeout(function(){t.initialFontsLoaded=!0;for(var e=t.stage.getNumChildren();e>0;e--){var i=t.stage.getChildAt(e-1);if("bbox.controls.CompositeText"==i.type){var n=i;n.isWarningVisible()&&(n.warningCheck(),t.updateStage())}}clearTimeout(o)},5e3);t.log("< COMPLETE++++++++++++++++++++++")}),t.events.on(t.events.ERROR_CATALOG_COMPLETE,function(){t.log("> ERROR_CATALOG_LOADED++++++++++++++++++++++"),t.log("< ERROR_CATALOG_LOADED++++++++++++++++++++++")}),t.events.on(t.events.ERROR_LOGGING_COMPLETE,function(){t.log("> ERROR_LOGGED++++++++++++++++++++++"),t.log("< ERROR_LOGGED++++++++++++++++++++++")}),t.events.on(t.events.USER_REGISTER_COMPLETE,function(){t.log("> USER_REGISTER++++++++++++++++++++++"),t.log("< USER_REGISTER++++++++++++++++++++++")}),t.$(window).resize(function(){t.events.trigger(t.events.WINDOW_RESIZE)}),t.$(window).keydown(function(t){[37,38,39,40].indexOf(t.keyCode)>-1&&t.preventDefault()}),t.events.on(t.events.WINDOW_RESIZE,function(){void 0!=t.stageRoot&&null!=t.stageRoot&&void 0!=t.stageRoot.canvas&&null!=t.stageRoot.canvas&&t.resizeThrottled()}),t.events.on(t.events.LAST_LAYOUT,function(){t.resizeThrottled()}),t.events.trigger(t.events.INIT)}function o(){return location.protocol+"//"+location.hostname+(location.port&&":"+location.port)}function n(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function s(){return/iPhone|iPod|iPad|Android|BlackBerry|Opera Mini|IEMobile/.test(t.userAgent)}function a(){var t="";return navigator.appVersion&&(t=navigator.appVersion.toUpperCase()),t.indexOf("WIN")>-1}function r(t){return t.stopImmediatePropagation(),!1}function l(){t.utils.ImageTest.run()}function h(){t.utils.FontTest.run()}function c(e){"undefined"==typeof e&&(e=!0);var i;return i=t.utils.AppUtil.isLocalhost()?{async:e,headers:{}}:{async:e,headers:{"cache-control":"no-cache"}}}function d(){var t,e,i,o=document.getElementsByTagName("*"),n={};for(t=0,e=o.length;e>t;t+=1)i=o[t].id||null,i&&(n[i]=n.hasOwnProperty(i)?n[i]+=1:0);for(i in n)n.hasOwnProperty(i)&&n[i]&&console.warn("Duplicate ID #"+i);return!0}function p(){return t.utils.AppUtil.isLocalhost()?(t.utils.HtmlUtil.setAskBeforeQuit(!1),!0):!1}function u(e){t.globalColor=e,t.events.trigger(t.events.SET_COLOR,e),t.product.getActiveLayout().setDefaultColor(e),t.utils.HtmlUtil.setColorProductOption(e)}function g(){null!=t.zoomNav&&(t.zoomNav.zoomView.visible=!1)}function m(e){return(t.utils.ObjectUtil.isUndefined(e.type)||"POST"!=e.type)&&(e.url=e.url.indexOf("?")<0?e.url+"?HCAuthToken="+t.config.HCAuthToken():e.url+"&HCAuthToken="+t.config.HCAuthToken()),t.$.ajax(e)}function f(){var e,i=!0,o=t.stage.getNumChildren();for(o;o>0;o--)if(e=t.stage.getChildAt(o-1),e.hasOwnProperty("isLoaded")&&!e.isLoaded){i=!1;break}return i}function v(){t.readyToCapturePreview()?(0!=this.captureTimeout&&clearTimeout(this.captureTimeout),t.previewImage=t.captureCartPreview()):this.captureTimeout=setTimeout(function(){t.asyncCaptureCartPreview()},250)}function y(){var e,i=t.stage.getNumChildren();for(i;i>0;i--)e=t.stage.getChildAt(i-1),e.edit()}function I(){var e,i=t.stage.getNumChildren();for(i;i>0;i--)e=t.stage.getChildAt(i-1),e.unselect(),e.preview(),e.ui&&e.ui.isWarningDPIVisible()===!0&&e.ui.setWarningDPI(!1)}function b(e){"undefined"==typeof e&&(e=-1),t.inPreviewMode||t.putControlsInPreviewMode();var i,o=t.product.getActiveLayout().width,n=t.product.getActiveLayout().height,s=800;i=-1==e?o>n?s/o:s/n:e,t.stageZoom.cache(t.stage.x,t.stage.y,o,n,i);var a=t.stageZoom.getCacheDataURL();return t.stageZoom.uncache(),t.inPreviewMode||t.putControlsInEditMode(),a}function _(){var e=t.product.getActiveLayout().width,i=t.product.getActiveLayout().height;t.stage.cache(0,0,e,i,1);var o=t.stage.getCacheDataURL();return t.stage.uncache(),o}function C(e){"undefined"==typeof e&&(e=1);var i=t.product.getActiveLayout().width,o=t.product.getActiveLayout().height;t.stage.cache(0,0,i,o,e);var n=t.stage.getCacheDataURL();return t.stage.uncache(),n}function x(){document.getElementById("loading_content").style.display="block",document.getElementById("loading_cover").style.display="block"}function w(){document.getElementById("loading_content").style.display="none",document.getElementById("loading_cover").style.display="none"}function T(){if(t.showLoading(),t.stage){var e,i=t.stage.getNumChildren();for(i;i>0;i--)e=t.stage.getChildAt(i-1),t.stage.removeChild(e);for(i=t.stageZoom.getNumChildren();i>0;i--)e=t.stage.getChildAt(i-1),e!=t.stage&&t.stageZoom.removeChild(e)}}function O(){t.pingFlag=!0}function S(){var e=t.config.keepSessionAlive();t.$.ajax({url:e,headers:t.config.getRequestHeaders(),dataType:"json",success:function(){t.sessionExpiration=t.elapsed+t.config.sessionTimeOutTime()},error:function(t){0==t.status}})}function E(){t.inPreviewMode=!0,t.zoomNav&&null!=t.zoomNav.center&&(t.zoomNav.center=null),t.previewImage=null,0!=t.product.activeLayout?t.save():t.putControlsInPreviewMode(),t.save(),t.$("#sidebar").hide(),t.$("#preview").css("display",""),t.$(".preview-item").show(),t.$(".design-item").hide(),t.app.views.previewView.setup(),null!=t.productOptions&&t.productOptions.hasProductUpsells()&&!t.noThanksToUpsells&&t.dialogs.displayUpsellDialog(),t.events.trigger(t.events.WINDOW_RESIZE)}function A(){t.inPreviewMode=!1,t.zoomNav&&null!=t.zoomNav.center&&(t.zoomNav.center=null),t.app.views.assetPanelView._currentTab="ap_menu_photo_tab",t.selections.clear(),t.putControlsInEditMode(),t.$("#preview").hide(),t.$(".preview-item").hide(),t.$(".design-item").show(),t.app.views.assetPanelView.updateUI(),t.resizeThrottled()}function P(){var e=t.$("#config-container"),i=t.$(".right-side-container",e),o=t.$("#preview",i),n=t.$(".main-container"),s=t.$("#appCanvas"),a=t.$("#sidebar"),r=o.is(":visible")?o.outerWidth():0,l=a.is(":visible")?a.outerWidth():0;n.css({"padding-right":r+l,"margin-left":l}),t.stageRoot.canvas.width=Math.floor(n.width()),t.stageRoot.canvas.height=Math.floor(parseInt(s.css("height"))),t.stageBackground.graphics.clear(),t.stageBackground.graphics.beginFill("#E0E0E0").drawRect(0,0,t.stageRoot.canvas.width,t.stageRoot.canvas.height),t.utils.Stage.center(),t.resetZoomLevel(),t.events.trigger(t.events.WINDOW_RESIZED)}function k(){t.app.views.canvasView.save();var e=t.product.save(),i=t.ugcSwap;if(null!=i){var o=[i.oldUgcPath+i.oldUserId,i.ugcPath+i.newUserId],n=[i.oldUgcPath.split("/").join("\\\\")+i.oldUserId,i.ugcPath.split("/").join("\\\\")+i.newUserId];e=e.split(o[0]).join(o[1]),e=e.split(n[0]).join(n[1])}return e}function L(){t.hideZoomNav(),t.initLayout()}function R(){if(t.product){var e,i=t.product.getActiveLayout().width,o=t.product.getActiveLayout().height,n=t.$("#appCanvas").innerWidth(),s=parseInt(t.$("#appCanvas").css("height")),a=1.1,r=i*a,l=o*a;e=s/l>n/r?n/r:s/l,t.stageZoom.scaleX=t.stageZoom.scaleY=e,t.app.views.zoomControlView.setZoom(e)}}function D(){var e=t.tickDragRate,i=t.tickRenderRate,o=createjs.Ticker.getTicks();o%e==0&&t.dragger&&t.dragger(),o%5==0&&t.fontLoadingFlag&&t.events.trigger(t.events.CHECK_FOR_FONT_UPDATE),o%i==0&&t.renderFlag&&(t.renderFlag=!1,t.stageRoot.update())}function M(){t.timer=window.Timer(),t.timer.every("1 seconds",function(){t.timeCurrent=(new Date).getTime(),t.elapsed=t.elapsed+1}),t.timer.every("10 seconds",function(){navigator.onLine?t.dialogs.offlineDialogVisible&&t.dialogs.hideOfflineDialog():t.dialogs.displayOfflineDialog()}),t.timer.every("15 seconds",function(){t.pingFlag&&(t.pingFlag=!1,t.pingSend())}),t.timer.every("10 minutes",function(){t.services.extendToken()}),t.timer.every("1 seconds",function(){if(t.elapsed>t.sessionExpiration&&0==t.sessionExpirationNotified&&(t.sessionGracePeriod=60,t.closeSessionTime=t.elapsed+60,t.sessionExpirationNotified=!0,t.dialogs.displaySessionDialog(t.utils.AppUtil.getSessionTimeoutMessage(),t._.bind(t.resetSession,t))),t.elapsed>t.sessionExpiration&&t.elapsed>t.closeSessionTime&&1==t.sessionExpirationNotified){t.utils.HtmlUtil.setAskBeforeQuit(!1);var e=t.config.isRegistered()?"redirectRegisteredUser":"redirectAnonymousUser";0==t.sessionClosed&&t.utils.AppUtil.callPageFunction(e)}if(1==t.sessionExpirationNotified&&t.sessionGracePeriod>=0&&t.sessionGracePeriod--,1==t.sessionExpirationNotified&&t.sessionGracePeriod>0){var i=t.utils.AppUtil.getSessionTimeoutMessage();t.$("#sessionContentMessage").text(i)}if(1==t.sessionExpirationNotified&&1==t.config.isRegistered()&&15==t.sessionGracePeriod){var o="Autosave-"+t.utils.AppUtil.getCurrentTimestamp(),n=t.config.isPreviousAutoSave()?!0:!1,s=!0;t.saveNotification=!1,t.services.save(o,n,s)}1==t.sessionExpirationNotified&&1==t.config.isRegistered()&&0==t.sessionGracePeriod&&t.$("#sessionContentMessage").text("Closing session"),1==t.sessionExpirationNotified&&0==t.config.isRegistered()&&0==t.sessionGracePeriod&&t.$("#sessionContentMessage").text("Closing session")}),t.timer.start()}function F(){t.sessionExpiration=t.elapsed+t.config.sessionTimeOutTime(),t.closeSessionTime=t.sessionExpiration+60,t.sessionGracePeriod=60,t.sessionClosed=!1,t.sessionExpirationNotified=!1}function U(e){"undefined"==typeof e&&(e=!1),e?t.stageRoot.update():t.renderFlag=!0}function B(){t.selections.clear(),t.editorManager.commit(),t.dialogs.displayUserDialog("none")}function N(){createjs.Graphics.prototype.dashedLineTo=function(t,e,i,o,n){this.moveTo(t,e);for(var s=i-t,a=o-e,r=Math.floor(Math.sqrt(s*s+a*a)/n),l=s/r,h=a/r,c=0;c++<r;)t+=l,e+=h,this[c%2==0?"moveTo":"lineTo"](t,e);return this[c%2==0?"moveTo":"lineTo"](i,o),this},createjs.Graphics.prototype.drawDashedRect=function(t,e,i,o,n){this.moveTo(t,e);var s=t+i,a=e+o;return this.dashedLineTo(t,e,s,e,n),this.dashedLineTo(s,e,s,a,n),this.dashedLineTo(s,a,t,a,n),this.dashedLineTo(t,a,t,e,n),this},createjs.Graphics.prototype.drawResizableDashedRect=function(t,e,i,o,n,s){this.moveTo(t,e);var a=t+i,r=e+o;return this.dashedLineTo(t+s,e,a-s,e,n),this.dashedLineTo(a,e+s,a,r-s,n),this.dashedLineTo(a-s,r,t+s,r,n),this.dashedLineTo(t,r-s,t,e+s,n),this},createjs.Graphics.prototype.svgPath=function(t){for(var e=t.split(" "),i=e.length,o=0;i>o;o++)"C"!=e[o]?"L"!=e[o]?"M"!=e[o]?"Z"!=e[o]&&"z"!=e[o]:(this.moveTo(e[o+1],e[o+2]),o+=2):(this.lineTo(e[o+1],e[o+2]),o+=2):(this.bezierCurveTo(e[o+1],e[o+2],e[o+3],e[o+4],e[o+5],e[o+6]),o+=6);return this},createjs.Graphics.prototype.svgRect=function(t){for(var e=t.split(" "),i=e.length,o={xmin:null,xmax:null,ymin:null,ymax:null},n=0;i>n;n++)if("C"!=e[n])"M"!=e[n]?"Z"!=e[n]:(null==o.xmin&&(o.xmin=e[n+1]),null==o.ymin&&(o.ymin=e[n+2]),null==o.xmax&&(o.xmax=e[n+1]),null==o.ymax&&(o.ymax=e[n+2]),o.xmin>e[n+1]&&(o.xmin=e[n+1]),o.ymin>e[n+2]&&(o.ymin=e[n+2]),o.xmax<e[n+1]&&(o.xmax=e[n+1]),o.ymax<e[n+2]&&(o.ymax=e[n+2]),n+=2);else{var s,a,r,l;e[n+1]<e[n+3]&&e[n+1]<e[n+5]&&(s=e[n+1]),e[n+2]<e[n+4]&&e[n+2]<e[n+6]&&(a=e[n+2]),e[n+3]<e[n+1]&&e[n+3]<e[n+5]&&(s=e[n+3]),e[n+4]<e[n+2]&&e[n+4]<e[n+6]&&(a=e[n+4]),e[n+5]<e[n+1]&&e[n+5]<e[n+3]&&(s=e[n+5]),e[n+6]<e[n+2]&&e[n+6]<e[n+4]&&(a=e[n+6]),e[n+1]>e[n+3]&&e[n+1]>e[n+5]&&(r=e[n+1]),e[n+2]>e[n+4]&&e[n+2]>e[n+6]&&(l=e[n+2]),e[n+3]>e[n+1]&&e[n+3]>e[n+5]&&(r=e[n+3]),e[n+4]>e[n+2]&&e[n+4]>e[n+6]&&(l=e[n+4]),e[n+5]>e[n+1]&&e[n+5]>e[n+3]&&(r=e[n+5]),e[n+6]>e[n+2]&&e[n+6]>e[n+4]&&(l=e[n+6]),null==o.xmin&&(o.xmin=s),null==o.ymin&&(o.ymin=a),null==o.xmax&&(o.xmax=r),null==o.ymax&&(o.ymax=l),o.xmin>s&&(o.xmin=s),o.ymin>a&&(o.ymin=a),o.xmax<r&&(o.xmax=r),o.ymax<l&&(o.ymax=l),n+=6}return{x:s,y:a,width:r-s,height:l-a}},t.encodingUtils=new t.utils.EncodingUtils}t.log=e,t.version="Path: .Working Copy Root Path: C:UsersA039434workspace\big-box-jsURL: https://subversion.assembla.com/svn/big-box-js/mainRelative URL: ^/mainRepository Root: https://subversion.assembla.com/svn/big-box-jsRepository UUID: 2829f2d7-1a0a-4915-89fe-47fb1fef0443Revision: 4490Node Kind: directorySchedule: normalLast Changed Author: justindruryLast Changed Rev: 4490Last Changed Date: 2014-11-18 09:53:51 -0600 (Tue, 18 Nov 2014)",t.$=window.bboxjquery.noConflict(),t._=window._,t.initCore,t.vars,t.canvas,t.stageRoot,t.stageZoom,t.shadowElement,t.stageBackground,t.zoomNav=null,t.stageDebug,t.stage,t.config=null,t.actionManager=null,t.sceneManager=null,t.services=null,t.tooltips=null,t.errors=null,t.events=null,t.editorManager=null,t.cacheManager=null,t.requirementValidationManager=null,t.guidedUITipManager=null,t.fonts=null,t.ui=null,t.selections=null,t.imageManager=null,t.wizard=null,t.productDataLoading=null,t.product=null,t.productOptions=null,t.dialogs=null,t.peepsManager=null,t.renderFlag=!1,t.pingFlag=!1,t.fontLoadingFlag=!1,t.productLoadedFlag=!1,t.textCheckCount=0,t.initialFontsLoaded=!1,t.sessionExpiration=1680,t.isEdit=!1,t.isDrag=!1,t.isRotate=!1,t.cartQuantity=null,t.frameRate=60,t.sessionGracePeriod=60,t.dragObj=new Object,t.dragger=null,t.inPreviewMode=!1,t.globalColor=null,t.noThanksToUpsells=!1,t.sessionExpirationNotified=!1,t.closeSessionTime=0,t.sessionClosed=!1,t.vb,t.bounds,t.DragDrop,t.bgColor=null,t.tickRenderRate=2,t.tickDragRate=2,t.previewImage=null,t.ugcSwap=null,t.uploadImageTarget=null,t.encodingUtils=null,t.paperStock=null,t.saveNotification=!0,t.addToCartPreviewReady=!1,t.previewUploadFileName=null,t.imageScratch={},t.savedUserLocation=null,t.replacedFontsMessageList=null,t.stageLocked=!0,t.timeStart=function(){return(new Date).getTime()}(),t.timeCurrent=function(){return(new Date).getTime()}(),t.userAgent=function(){var t=navigator,e=window;return"undefined"!=typeof t?t.userAgent||t.vendor:"undefined"!=typeof e?e.opera:"unknown"}(),t.init=i,t.getBaseURL=o,t.isFirefox=n,t.isMobile=s,t.isWindows=a,t.block=r,t.imageTest=l,t.fontTest=h,t.getAjaxSetup=c,t.dupTest=d,t.performanceProfile=function(){if(t.isMobile()){t.tickRenderRate=4,t.tickDragRate=4;var e=navigator.userAgent.toLowerCase(),i=e.indexOf("android")>-1,o=null!=navigator.userAgent.match(/iPad/i);return i?(t.tickRenderRate=4,t.tickDragRate=4,3):o?(t.tickRenderRate=3,t.tickDragRate=3,3):2}return 1}(),t.isLocalEnvironment=p,t.setGlobalColor=u,t.hideZoomNav=g,t.ajax=m,t.readyToCapturePreview=f;t.asyncCaptureCartPreview=v,t.putControlsInEditMode=y,t.putControlsInPreviewMode=I,t.captureCartPreview=b,t.buildNavImage=_,t.captureTestPreview=C,t.showLoading=x,t.hideLoading=w,t.clean=T,t.ping=O,t.pingSend=S,t.preview=E,t.edit=A,t.resizeRaw=P,t.resizeThrottled=t._.throttle(t.resizeRaw,30,{leading:!1}),t.save=k,t.resetZoomLevel=L,t.initLayout=R,t.tick=D,t.showTimerDebug=!1,t.elapsed=0,t.timer=null,t.timerSetup=M,t.resetSession=F,t.updateStage=U,t.lazyRegistration=B,function(t){t.saveService=null,t.spriteService=null}(t.service||(t.service={}));t.service;!function(t){t.version="0.0.1",t.router=null,t.myPhotos=null,t.bboxPhotos=null,t.myBgs=null,t.bboxBgs=null,t.imageLibrary=null,t.userImages=null,t.userPeepImages=null,t.currentGraphics=[],t.photoUploadGraphics=[],t.currentBackgrounds=[],t.searchResults=null,function(t){t.assetPanelView=null,t.canvasView=null,t.toolbarView=null,t.previewView=null,t.sceneControlView=null,t.zoomControlView=null,t.peepsCanvasView=null,function(t){t.photoUpload=null,t.imageZoom=null,t.error=null,t.removeImage=null,t.peepsEditor=null}(t.dialogs||(t.dialogs={}));t.dialogs}(t.views||(t.views={}));t.views}(t.app||(t.app={}));t.app;t.initApp=N}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i,o){e.call(this),this.instanceId=-1,this.height=0,this.width=0,this.selected=!1,this.dragging=!1,this.editInProgress=!1,this.editMode=1,this.isLoaded=!1,this.isDeleted=!1,this.valid=!0,this._mode="edit",this.pageItemBlock=i,t.log(this.pageItemBlock),this.type=o,this.instanceId=t.managers.InstanceManager.create(this);var n=t.utils.HtmlUtil.getBlockName(i);this.x=Number(i[n].Frame._xOffset),this.y=Number(i[n].Frame._yOffset),"undefined"!=typeof i[n].Frame._width&&(this.width=Number(i[n].Frame._width)),"undefined"!=typeof i[n].Frame._height&&(this.height=Number(i[n].Frame._height)),this.setReg(),"undefined"!==i[n].Frame._rotation&&(this.rotation=Number(i[n].Frame._rotation)),this.content=new t.controls.ControlContent(this),this.content.mouseEnabled=!1,this.addChild(this.content),this.ui=new t.controls.ControlUI(this),this.addChild(this.ui),this.getRequired()&&t.events.trigger(t.events.REQUIRED_CONTROL_INITIALIZED,this.pageItemBlock,this)}return __extends(i,e),i.prototype.getCopyable=function(){return"true"==this.pageItemBlock._copyable},i.prototype.getDeletable=function(){return"true"==this.pageItemBlock._deletable},i.prototype.getFlippable=function(){return"true"==this.pageItemBlock._flippable},i.prototype.getMovable=function(){return"true"===this.pageItemBlock._movable&&!t.stageLocked},i.prototype.getRotatable=function(){return"true"===this.pageItemBlock._rotatable&&!t.stageLocked},i.prototype.getScalable=function(){return"true"==this.pageItemBlock._scalable},i.prototype.getSelectable=function(){return"true"==this.pageItemBlock._selectable},i.prototype.getRequired=function(){return"true"==this.pageItemBlock._required},i.prototype.getUserInteracted=function(){return"true"==this.pageItemBlock._userInteracted},i.prototype.getIgnoreBounds=function(){return"true"===this.pageItemBlock._ignoreBounds},i.prototype.getVisible=function(){return"true"===this.pageItemBlock._visible},i.prototype.onGlobalColor=function(){},i.prototype.handles=function(){},i.prototype.double=function(){},i.prototype.outline=function(){},i.prototype.scale=function(){},i.prototype.clean=function(t,e,i){"undefined"==typeof t&&(t=!1),"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=!1)},i.prototype.drop=function(){},i.prototype.showEditor=function(){},i.prototype.cleanUpYourMess=function(){this.isDeleted=!0,this.isLoaded=!1,this.instanceId=-1,this.ui.cleanUpYourMess()},i.prototype.isValid=function(){return!0},i.prototype.showLoading=function(e){this.ui.loading.visible=e,this.ui.render(),t.updateStage()},i.prototype.isUserInteractionReady=function(){return this.isLoaded?"preview"!=this.getMode():!1},i.prototype.mouseHandlerBase=function(t){return t.stopImmediatePropagation(),!this.isUserInteractionReady()},i.prototype.rotate=function(e){if(this.isUserInteractionReady()){var i=this.rotation;e=t.utils.AppUtil.normalizeDegrees(e),this.rotation=e;var o=this.testHandles();o.e&&(this.rotation=i)}},i.prototype.key=function(){},i.prototype.testHandles=function(){var e={e:!1,t:0,te:!1,teb:0,b:0,be:!1,beb:0,l:0,le:!1,leb:0,r:0,re:!1,reb:0};if(this.getIgnoreBounds())return e;if(null==this.parent)return e;if(null==this.ui.resizeHandles.UL.parent)return e;if(null==this.ui.resizeHandles.UR.parent)return e;if(null==this.ui.resizeHandles.LL.parent)return e;if(null==this.ui.resizeHandles.LR.parent)return e;var i=this.ui.resizeHandles.UL,o=i.parent.localToLocal(i.x,i.y,this.parent);o=t.utils.AppUtil.roundPoint(o),e.l=e.r=o.x,e.t=e.b=o.y,i=this.ui.resizeHandles.UR,o=i.parent.localToLocal(i.x,i.y,this.parent),o=t.utils.AppUtil.roundPoint(o),o.x<e.l&&(e.l=o.x),o.x>e.r&&(e.r=o.x),o.y<e.t&&(e.t=o.y),o.y>e.b&&(e.b=o.y),i=this.ui.resizeHandles.LL,o=i.parent.localToLocal(i.x,i.y,this.parent),o=t.utils.AppUtil.roundPoint(o),o.x<e.l&&(e.l=o.x),o.x>e.r&&(e.r=o.x),o.y<e.t&&(e.t=o.y),o.y>e.b&&(e.b=o.y),i=this.ui.resizeHandles.LR,o=i.parent.localToLocal(i.x,i.y,this.parent),o=t.utils.AppUtil.roundPoint(o),o.x<e.l&&(e.l=o.x),o.x>e.r&&(e.r=o.x),o.y<e.t&&(e.t=o.y),o.y>e.b&&(e.b=o.y);var n=!1;return this.getMovable()&&(e.t<t.product.activeData.safeTop&&(n=!0),e.b>t.product.activeData.safeBottom+t.product.activeData.height&&(n=!0),e.l<t.product.activeData.safeLeft&&(n=!0),e.r>t.product.activeData.safeRight+t.product.activeData.width&&(n=!0),n&&(this.warningMessage="bbox.controls.CompositeText"==this.type?t.utils.Constants.TEXT_MARGIN_WARNING:t.utils.Constants.IMAGE_MARGIN_WARNING)),"preview"==this.getMode()&&(n=!1,this.ui.setWarningDPI(!1)),this.ui.setWarning(n||this.shouldShowOverflowWarning()?!0:!1),this.shouldShowDPIWarning()?(this.ui.setWarningDPI(!0),this.warningMessage=t.utils.Constants.IMAGE_RESOLUTION_WARNING):this.ui.setWarningDPI(!1),t.product.activeData.constrained?(e.teb=t.product.activeData.safeTop,e.beb=t.product.activeData.safeBottom+t.product.activeData.height,e.leb=t.product.activeData.safeLeft,e.reb=t.product.activeData.safeRight+t.product.activeData.width,e.t<=t.product.activeData.safeTop&&(e.e=e.te=!0),e.b>=t.product.activeData.safeBottom+t.product.activeData.height&&(e.e=e.be=!0),e.l<=t.product.activeData.safeLeft&&(e.e=e.le=!0),e.r>=t.product.activeData.safeRight+t.product.activeData.width&&(e.e=e.re=!0)):(e.teb=t.product.activeData.bleedTop,e.beb=t.product.activeData.bleedBottom+t.product.activeData.height,e.leb=t.product.activeData.bleedLeft,e.reb=t.product.activeData.bleedRight+t.product.activeData.width,e.t<=t.product.activeData.bleedTop&&(e.e=e.te=!0),e.b>=t.product.activeData.bleedBottom+t.product.activeData.height&&(e.e=e.be=!0),e.l<=t.product.activeData.bleedLeft&&(e.e=e.le=!0),e.r>=t.product.activeData.bleedRight+t.product.activeData.width&&(e.e=e.re=!0)),e},i.prototype.handleBoundsError=function(t,e){t.e&&(t.le?e.x=t.leb+(t.r-t.l)/2+1:t.re&&(e.x=t.reb-(t.r-t.l)/2-1),t.te?e.y=t.teb+(t.b-t.t)/2+1:t.be&&(e.y=t.beb-(t.b-t.t)/2-1))},i.prototype.move=function(t){if(this.isUserInteractionReady()&&this.getMovable()){this.x=t.cx,this.y=t.cy;var e=this.testHandles();this.handleBoundsError(e,this),this.updateMask()}},i.prototype.render=function(){},i.prototype.outline_mouseover=function(e){this.mouseHandlerBase(e)||t.isRotate!==!0&&this.dragging!==!0&&"edit"==this.getMode()&&this.getSelectable()&&(this.ui.strokeColor=this.ui.VALID_LINE_COLOR,this.ui.render(),t.updateStage())},i.prototype.outline_mouseout=function(e){this.mouseHandlerBase(e)||this.dragging!==!0&&(this.ui.strokeColor=this.ui.NO_LINE_COLOR,this.ui.render(),document.body.style.cursor="default",t.updateStage())},i.prototype.outline_double=function(t){this.mouseHandlerBase(t)||this.double(t)},i.prototype.outline_mousedown=function(e){return e.stopImmediatePropagation(),t.ping(),!this.isUserInteractionReady()||this.dragging===!0||"touches"in e.nativeEvent&&e.nativeEvent.touches.length>1?void 0:(this.historyTransactionMoveUpdate(this.getHistoryTransactionState(),!1),t.isMobile()&&"touches"in e.nativeEvent&&e.nativeEvent.touches.length>1&&t.selections.count()>0?void t.selections.select(this):e.nativeEvent.shiftKey&&t.selections.count()>0?void t.selections.select(this):void(this.getSelectable()&&(1===this.editMode&&"edit"==this.getMode()&&this.getMovable()||2===this.editMode)&&(this.ui.toggleButtonVisibility(!1),this.ui.render(),this.origin=this.parent.globalToLocal(e.stageX,e.stageY),this.origin.x=this.x-this.origin.x,this.origin.y=this.y-this.origin.y,document.body.style.cursor="move",t.updateStage())))},i.prototype.outline_pressmove=function(e){if(!this.mouseHandlerBase(e)&&(t.product.activeData.constrained&&t.bounds.showWarning(),null!=this.origin)){t.editorManager.visible&&t.editorManager.hideAll();var i=this.parent.globalToLocal(e.stageX,e.stageY);this.move({ox:this.origin.x,oy:this.origin.y,cx:i.x+this.origin.x,cy:i.y+this.origin.y,final:!1}),t.updateStage()}},i.prototype.outline_pressup=function(e){if(e.stopImmediatePropagation(),t.product.activeData.constrained&&t.bounds.hideWarning(),this.isUserInteractionReady()&&!(e.nativeEvent.shiftKey&&t.selections.count()>0)){if(null!=this.origin&&t.selections.count()<2){var i=this.parent.globalToLocal(e.stageX,e.stageY);this.move({ox:this.origin.x,oy:this.origin.y,cx:i.x+this.origin.x,cy:i.y+this.origin.y,final:!0}),t.events.trigger(t.events.PRODUCT_PERSONALIZED),this.save()}this.origin=null,this.oldModel=null,0==this.selected?(t.selections.select(this,!0),this.ui.toggleButtonVisibility(!0),this.ui.render()):1==this.selected&&(this.ui.toggleButtonVisibility("edit"!==this.getMode()),this.ui.render(),this.showEditor()),this.historyTransactionMoveUpdate(this.getHistoryTransactionState(),!0),t.updateStage()}},i.prototype.outline_mouseup=function(t){this.mouseHandlerBase(t)||this.dragging===!0},i.prototype.outline_click=function(e){this.mouseHandlerBase(e)||t.isDrag&&(t.isDrag=!1)},i.prototype.warning_mouseover=function(e){if(!this.mouseHandlerBase(e)&&this.dragging!==!0){var i=t.utils.HtmlUtil.getTooltipPosition(this);t.tooltips.show(this.warningMessage,i),t.updateStage(),t.isMobile()&&setTimeout(t._.bind(this.hide_tooltips,this),3500)}},i.prototype.warning_mouseout=function(t){this.mouseHandlerBase(t)||this.dragging!==!0&&this.hide_tooltips()},i.prototype.hide_tooltips=function(){t.tooltips.hide(),t.updateStage()},i.prototype.edit_click=function(e){this.mouseHandlerBase(e)||"touches"in e.nativeEvent&&e.nativeEvent.touches.length>1||(this.editInProgress=!0,this.editMode=2,this.hideContainerEditor(),this.openEditor(),document.body.style.cursor="default",t.updateStage())},i.prototype.rotate_mousedown=function(e){if(!(this.mouseHandlerBase(e)||"touches"in e.nativeEvent&&e.nativeEvent.touches.length>1)){this.hideContainerEditor(),this.ui.hideEditButton(),this.ui.render(),t.isRotate=!0,this.origin={},this.historyTransactionMoveUpdate(this.getHistoryTransactionState(),!1),this.origin.beginRotation=this.rotation;var i=this.localToGlobal(this.regX,this.regY),o=e.stageX-i.x,n=e.stageY-i.y;this.origin.rotationOffset=Math.atan2(n,o)*(180/Math.PI);var s=this.getRotationCuePosition();this.origin.rotationCue=t.$("<span id='rotationCue' class='badge badge-info'></span>"),this.origin.rotationCue.css("position","absolute"),this.origin.rotationCue.text(Math.round(this.origin.beginRotation)),this.origin.leftitem=s.left,t.$("#canvas").append(this.origin.rotationCue),this.origin.rotationCue.css("top",this.pxOffset(s.top)),this.origin.rotationCue.css("left",this.pxOffset(this.origin.leftitem-this.origin.rotationCue.width()/2)),t.updateStage()}},i.prototype.rotate_pressmove=function(e){if(this.isUserInteractionReady()){e.stopImmediatePropagation();var i=this.localToGlobal(this.regX,this.regY),o=e.stageX-i.x,n=e.stageY-i.y,s=Math.round(Math.atan2(n,o)*(180/Math.PI));this.rotate(this.origin.beginRotation+s-this.origin.rotationOffset),this.origin.rotationCue.text(Math.round(this.rotation)),this.origin.rotationCue.css("left",this.pxOffset(this.origin.leftitem-this.origin.rotationCue.width()/2)),t.updateStage()}},i.prototype.rotate_pressup=function(e){this.isUserInteractionReady()&&(e.stopImmediatePropagation(),this.ui.setButtonRotation(-this.rotation),this.origin.rotationCue.remove(),this.origin=null,t.isRotate=!1,this.ui.toggleButtonVisibility(!0,this.editMode),this.save(),t.editorManager.showContainer(this),this.ui.showEditButton(),this.ui.render(),this.historyTransactionMoveUpdate(this.getHistoryTransactionState(),!0),t.updateStage())},i.prototype.rotate_click=function(t){this.isUserInteractionReady()&&t.stopImmediatePropagation()},i.prototype.process_move=function(e,i,o){"undefined"==typeof i&&(i=!1),"undefined"==typeof o&&(o=!1),this.outline(e),this.handles(e),this.scale(e);var n=this.testHandles();
n.e?(e=this.lastValidEvent,this.outline(e),this.handles(e),this.scale(e)):this.lastValidEvent=e,i&&(t.dragger=null,this.dragging=!1,this.render(),this.clean(e,!0,o),this.save(),"bbox.controls.Image"==this.type&&this.imageToBackgroundTest(),o===!1&&this.historyTransactionMoveUpdate(e,!0))},i.prototype.imageToBackgroundTest=function(){var e=.9;t.ui.isBackgroundTabEnabled()===!0&&(this.width>=t.product.activeData.width*e||this.height>=t.product.activeData.height*e)&&t.dialogs.displayPromoteBackgroundDialog(this)},i.prototype.bindEventListeners=function(e,i){var o=e.toLowerCase()+"_";i.addEventListener("mousedown",t._.bind(this[o+"mousedown"],this)),i.addEventListener("mouseover",t._.bind(this[o+"mouseover"],this)),i.addEventListener("mouseout",t._.bind(this[o+"mouseout"],this)),i.addEventListener("pressmove",t._.bind(this[o+"pressmove"],this)),i.addEventListener("pressup",t._.bind(this[o+"pressup"],this))},i.prototype.getHandleEvent=function(t,e,i){"undefined"==typeof i&&(i=!1);var o,n=this.globalToLocal(t.stageX,t.stageY);switch(e){case"UL":o={type:"UL",x:n.x,y:n.y,w:this.width-n.x,h:this.height-n.y,t:n.y,vc:(n.y+this.height)/2,b:this.height,l:n.x,hc:n.x+(this.width-n.x)/2,r:this.width};break;case"UM":o={type:"UM",x:0,y:n.y,w:this.width,h:this.height-n.y,t:n.y,vc:n.y+(this.height-n.y)/2,b:this.height,l:0,hc:this.width/2,r:this.width};break;case"UR":o={type:"UR",x:0,y:n.y,w:n.x,h:this.height-n.y,t:n.y,vc:n.y+(this.height-n.y)/2,b:this.height,l:0,hc:n.x/2,r:n.x};break;case"ML":o={type:"ML",x:n.x,y:0,w:this.width-n.x,h:this.height,t:0,vc:this.height/2,b:this.height,l:n.x,hc:n.x+(this.width-n.x)/2,r:this.width};break;case"MR":o={type:"MR",x:0,y:0,w:n.x,h:this.height,t:0,vc:this.height/2,b:this.height,l:0,hc:n.x/2,r:n.x};break;case"LL":o={type:"LL",x:n.x,y:0,w:this.width-n.x,h:n.y,t:0,vc:n.y/2,b:n.y,l:n.x,hc:n.x+(this.width-n.x)/2,r:this.width};break;case"LM":o={type:"LM",x:0,y:0,w:this.width,h:n.y,t:0,vc:n.y/2,b:n.y,l:0,hc:this.width/2,r:this.width};break;case"LR":o={type:"LR",x:0,y:0,w:n.x,h:n.y,t:0,vc:n.y/2,b:n.y,l:0,hc:n.x/2,r:n.x}}return null!=o&&(o.final=i),o},i.prototype.getMouseoverCursorForHandle=function(t){switch(t){case"UL":return"nwse-resize";case"UM":return"ns-resize";case"UR":return"nesw-resize";case"MR":return"ew-resize";case"ML":return"ew-resize";case"LL":return"nesw-resize";case"LM":return"ns-resize";case"LR":return"nwse-resize"}return null},i.prototype.handle_mousedown=function(e,i){if(!this.mouseHandlerBase(e)&&!("touches"in e.nativeEvent&&e.nativeEvent.touches.length>1||"edit"!=this.getMode()||this.dragging)){{this.getHandleEvent(e,i,!0)}this.historyTransactionMoveUpdate(this.getHistoryTransactionState(),!1),this.hideContainerEditor(),this.dragging=!0,this.ui.toggleButtonVisibility(!1),this.ui.render(),t.updateStage(),t.dragger=t._.bind(function(){this.render()},this)}},i.prototype.handle_pressmove=function(t,e){if(!this.mouseHandlerBase(t)){var i=this.getHandleEvent(t,e,!1);this.process_move(i)}},i.prototype.handle_pressup=function(t,e){if(!this.mouseHandlerBase(t)){var i=this.getHandleEvent(t,e,!0);this.process_move(i,!0)}},i.prototype.handle_mouseover=function(e,i){if(!this.mouseHandlerBase(e)&&t.isRotate!==!0&&this.dragging!==!0&&"edit"==this.getMode()&&this.getSelectable()){{this.getHandleEvent(e,i,!0)}this.ui.strokeColor=this.ui.VALID_LINE_COLOR,this.ui.render(),document.body.style.cursor=this.getMovable()&&!this.editInProgress?this.getMouseoverCursorForHandle(i):"default",t.updateStage()}},i.prototype.handle_mouseout=function(e){this.mouseHandlerBase(e)||this.dragging!==!0&&(this.ui.strokeColor=this.ui.NO_LINE_COLOR,this.ui.render(),document.body.style.cursor="default",t.updateStage())},i.prototype.ul_mousedown=function(t){this.handle_mousedown(t,"UL")},i.prototype.ul_pressmove=function(t){this.handle_pressmove(t,"UL")},i.prototype.ul_pressup=function(t){this.handle_pressup(t,"UL")},i.prototype.ul_mouseover=function(t){this.handle_mouseover(t,"UL")},i.prototype.ul_mouseout=function(t){this.handle_mouseout(t,"UL")},i.prototype.um_mousedown=function(t){this.handle_mousedown(t,"UM")},i.prototype.um_pressmove=function(t){this.handle_pressmove(t,"UM")},i.prototype.um_pressup=function(t){this.handle_pressup(t,"UM")},i.prototype.um_mouseover=function(t){this.handle_mouseover(t,"UM")},i.prototype.um_mouseout=function(t){this.handle_mouseout(t,"UM")},i.prototype.ur_mousedown=function(t){this.handle_mousedown(t,"UR")},i.prototype.ur_pressmove=function(t){this.handle_pressmove(t,"UR")},i.prototype.ur_pressup=function(t){this.handle_pressup(t,"UR")},i.prototype.ur_mouseover=function(t){this.handle_mouseover(t,"UR")},i.prototype.ur_mouseout=function(t){this.handle_mouseout(t,"UR")},i.prototype.ml_mousedown=function(t){this.handle_mousedown(t,"ML")},i.prototype.ml_pressmove=function(t){this.handle_pressmove(t,"ML")},i.prototype.ml_pressup=function(t){this.handle_pressup(t,"ML")},i.prototype.ml_mouseover=function(t){this.handle_mouseover(t,"ML")},i.prototype.ml_mouseout=function(t){this.handle_mouseout(t,"ML")},i.prototype.mr_mousedown=function(t){this.handle_mousedown(t,"MR")},i.prototype.mr_pressmove=function(t){this.handle_pressmove(t,"MR")},i.prototype.mr_pressup=function(t){this.handle_pressup(t,"MR")},i.prototype.mr_mouseover=function(t){this.handle_mouseover(t,"MR")},i.prototype.mr_mouseout=function(t){this.handle_mouseout(t,"MR")},i.prototype.ll_mousedown=function(t){this.handle_mousedown(t,"LL")},i.prototype.ll_pressmove=function(t){this.handle_pressmove(t,"LL")},i.prototype.ll_pressup=function(t){this.handle_pressup(t,"LL")},i.prototype.ll_mouseover=function(t){this.handle_mouseover(t,"LL")},i.prototype.ll_mouseout=function(t){this.handle_mouseout(t,"LL")},i.prototype.lm_mousedown=function(t){this.handle_mousedown(t,"LM")},i.prototype.lm_pressmove=function(t){this.handle_pressmove(t,"LM")},i.prototype.lm_pressup=function(t){this.handle_pressup(t,"LM")},i.prototype.lm_mouseover=function(t){this.handle_mouseover(t,"LM")},i.prototype.lm_mouseout=function(t){this.handle_mouseout(t,"LM")},i.prototype.lr_mousedown=function(t){this.handle_mousedown(t,"LR")},i.prototype.lr_pressmove=function(t){this.handle_pressmove(t,"LR")},i.prototype.lr_pressup=function(t){this.handle_pressup(t,"LR")},i.prototype.lr_mouseover=function(t){this.handle_mouseover(t,"LR")},i.prototype.lr_mouseout=function(t){this.handle_mouseout(t,"LR")},i.prototype.shouldShowDPIWarning=function(){return!1},i.prototype.shouldShowOverflowWarning=function(){return!1},i.prototype.getMode=function(){return this._mode},i.prototype.setMode=function(t){this._mode=t},i.prototype.openEditor=function(){},i.prototype.closeEditor=function(){},i.prototype.onResize=function(){},i.prototype.updateMask=function(){},i.prototype.updateAlignment=function(e,i){var o=t.product.getActiveBoundaries(),n=this.testHandles(),s=this.getHistoryTransactionState();"horizontal"==e?"left"==i?this.x=this.x+o.x-n.l+.5:"right"==i?this.x=this.x+o.width-n.r:"center"==i&&(this.x=o.x/2+(this.x-n.l)+o.width/2-(n.r-n.l)/2):"vertical"==e&&("top"==i?this.y=this.y+o.y-n.t+.5:"bottom"==i?this.y=this.y+o.height-n.b:"middle"==i&&(this.y=o.y/2+(this.y-n.t)+o.height/2-(n.b-n.t)/2));var a=this.getHistoryTransactionState();t.updateStage();var r=this.pageItemBlock,l=new t.actions.ContainerMoveAction(s,a,r);t.actionManager.addAction(l)},i.prototype.save=function(){},i.prototype.isRotatable=function(){return this.getRotatable()},i.prototype.isDeletable=function(){return this.getDeletable()},i.prototype.isContentDeletable=function(){return!0},i.prototype.isImageAlignDisabled=function(){return("bbox.controls.Image"==this.type||"bbox.controls.Peep"==this.type)&&!this.isAlignmentEnabled()},i.prototype.isHTextAlignDisabled=function(){return!("bbox.controls.CompositeText"!=this.type||this.isAlignmentEnabled()&&t.ui.isHorizontalTextAlignEnabled())},i.prototype.isVTextAlignDisabled=function(){return!("bbox.controls.CompositeText"!=this.type||this.isAlignmentEnabled()&&t.ui.isVerticalTextAlignEnabled())},i.prototype.isScalable=function(){return this.getSelectable()&&this.getScalable()&&!t.stageLocked},i.prototype.isAlignmentEnabled=function(){return this.getSelectable()&&this.getMovable()},i.prototype.saveProperties=function(e){var i=t.utils.HtmlUtil.getBlockName(e);e[i].Frame._xOffset=this.x-this.regX,e[i].Frame._yOffset=this.y-this.regY,e[i].Frame._width=this.width,e[i].Frame._height=this.height,e[i].Frame._rotation=this.rotation},i.prototype.update=function(t,e){this.width=t,this.height=e,this.ui.update(t,e),this.setReg()},i.prototype.getGlobalPoint=function(){var e=this.x-this.regX,i=this.y+this.regY;return t.stage.localToGlobal(e,i)},i.prototype.setReg=function(){this.x=this.x-this.regX,this.y=this.y-this.regY,this.regX=0,this.regY=0,this.regX=this.width/2,this.regY=this.height/2,this.x=this.x+this.regX,this.y=this.y+this.regY},i.prototype.hideContainerEditor=function(){t.editorManager.hideContainer()},i.prototype.openContainerEditor=function(){"edit"==this.getMode()&&(this.editMode=1,t.editorManager.showContainer(this))},i.prototype.isEdit=function(){return 2==this.editMode},i.prototype.unselect=function(){t.uploadImageTarget=null,this.editInProgress=!1,this.editMode=1,this.selected=!1,this.ui.strokeColor=this.ui.NO_LINE_COLOR,this.ui.toggleButtonVisibility(!1),this.ui.render(),t.updateStage()},i.prototype.select=function(){t.uploadImageTarget=null,this.editInProgress=!1,this.editMode=1,this.selected=!0,this.ui.toggleButtonVisibility(!0,this.editMode),this.openContainerEditor(),this.ui.strokeColor=this.ui.VALID_LINE_COLOR,this.ui.render(),t.updateStage()},i.prototype.onDelete=function(){},i.prototype.updateUserInteracted=function(e){"undefined"==typeof e&&(e=!0),this.pageItemBlock._userInteracted=e.toString(),t.events.trigger(t.events.CONTROL_INTERACTED,this.pageItemBlock),this.ui.render()},i.prototype.getHistoryTransactionState=function(){var e=t.$.extend(!0,{},this.model);return{originalX:this.x,originalY:this.y,originalW:this.width,originalH:this.height,originalRotation:this.rotation,model:e}},i.prototype.restoreHistoryTransactionState=function(e){this.x=e.originalX,this.y=e.originalY,t._.has(e,"originalRotation")&&(this.rotation=e.originalRotation),this.ui.setButtonRotation(-this.rotation)},i.prototype.historyTransactionMoveUpdate=function(e,i){var o,n=!0,s=this;if(JSON.stringify(e)===JSON.stringify(this.prevHistoryValue))n=!1;else if(i===!0){var a=this.pageItemBlock;1===s.editMode?(o=new t.actions.ContainerMoveAction(this.prevHistoryValue,e,a),t.actionManager.addAction(o)):(o=new t.actions.image.ImageMoveAction(this.prevHistoryValue,this.getHistoryTransactionState(),a),t.actionManager.addAction(o))}return this.prevHistoryValue=e,n},i.prototype.getRotationCuePosition=function(){var e,i,o=this.getOffsets();"undefined"!=typeof this.model&&"undefined"!=typeof this.model.container?(e=this.x-this.model.container.width/2,i=this.y-this.model.container.height/2):(e=this.x-this.regX,i=this.y-this.regY);var n=t.stage.localToGlobal(e,i),s=this.width*t.stageZoom.scaleX/2+n.x+o.xOffset;return{top:n.y+o.yOffset-60,left:s-7}},i.prototype.getOffsets=function(){var e=t.$("#sidebar").width(),i=t.$("#sidebar").is(":visible")?e:0,o=t.$("#toolbar").height();return{xOffset:i,yOffset:o}},i.prototype.pxOffset=function(e){return t.utils.HtmlUtil.getDomCompliantValue(e)+"px"},i}(createjs.Container);e.BaseControl=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function t(){}return t.FRAME=1,t.IMAGE=2,t}(),o=function(e){function o(i,o,n,s){"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s="bbox.controls.Image"),e.call(this,i,s),this.MIN_WIDTH=10,this.ready=null,this.swapImageData=null,t.utils.LoggingUtil.log("Image"," > bbox.controls.Image()",t.utils.LoggingUtil.EXTRY_EXIT),this.isLoaded=!1,this.layout=o,this.colorId=t.controls.Image.COLOR,this.colorTint="-1",this.isEmpty=!1,this.dirtyCanvas=!1,this.autoResize=n,this.grayScaleImageCreated=!1,this.imageNotLoadedTimeout=0,this.imageFlip=!1,this.ugcWidth=0,this.ugcHeight=0,this.container=new createjs.Container,this.container.mask=new createjs.Shape,this.emptyImageBackground=new createjs.Shape,this.content.addChild(this.emptyImageBackground),this.content.addChild(this.container);var a=t.utils.ImageUtil.getImageUrl(i,o);if(this.initializeModel(this.width,this.height),t.utils.ObjectUtil.notUndefined(i[this.getBlockType()].Image)&&!t.utils.ObjectUtil.isEmpty(i[this.getBlockType()].Image._imageId)){var r=i[this.getBlockType()].Image;this.imageId=r._imageId,this.imageAsset=this.layout.getImageAsset(this.imageId),this.model.image.width=parseFloat(r._width),this.model.image.height=parseFloat(r._height),t.utils.LoggingUtil.log("Image","   block.Image.x: "+r._xOffset+" y: "+r._yOffset+" r: "+r._rotation+" id: "+this.imageId,t.utils.LoggingUtil.DEBUG),null==this.imageAsset.url&&(this.imageAsset.url=this.imageAsset.isUgcImage?t.config.getFile()+a:a),a=this.imageAsset.url,this.imageAsset.isUgcImage&&!t.utils.ObjectUtil.isEmpty(r._colorizeFilter)&&(this.colorId=r._colorizeFilter),t.utils.ObjectUtil.isEmpty(r._colorTint)||(this.colorTint=r._colorTint,t.utils.LoggingUtil.log("Image","color tint = "+this.colorTint,t.utils.LoggingUtil.DEBUG),0==this.colorTint.indexOf("0x")&&(this.colorTint=t.utils.TextUtil.enforceHexLength(this.colorTint.substr(2)),t.utils.LoggingUtil.log("Image","color tint = "+this.colorTint,t.utils.LoggingUtil.DEBUG)),"-1"!==this.colorTint&&t.product.isSingleColor()===!0&&(t.globalColor=this.colorTint))}else this.setIsEmpty(!0);t.product.isSingleColor()&&(this.colorId=t.controls.Image.BW,"image"==i._type&&(t.events.on(t.events.SET_COLOR,this.onGlobalColor,this),null==t.globalColor&&"-1"!=this.colorTint&&(t.globalColor=this.colorTint),null!=t.globalColor&&(this.colorTint=t.globalColor))),t.product.isSingleColor()||null==a||t.inPreviewMode||(a.split("_GRAY.").length>1&&(a=a.split("_GRAY.").join("."),t.utils.LoggingUtil.log("Image","Image.orginalImageUrl = "+a,t.utils.LoggingUtil.DEBUG)),a.split("_SEPIA.").length>1&&(a=a.split("_SEPIA.").join("."),t.utils.LoggingUtil.log("Image","Image.orginalImageUrl = "+a,t.utils.LoggingUtil.DEBUG)),a.split("_BW.").length>1&&(a=a.split("_BW.").join("."),t.utils.LoggingUtil.log("Image","Image.orginalImageUrl = "+a,t.utils.LoggingUtil.DEBUG)),"-1"!=this.colorTint&&(t.utils.LoggingUtil.log("Image","Image.colorTint = "+this.colorTint,t.utils.LoggingUtil.DEBUG),a=a.split("_"+this.colorTint+".").join("."),t.utils.LoggingUtil.log("Image","Image.orginalImageUrl = "+a,t.utils.LoggingUtil.DEBUG))),"bbox.controls.BackgroundImage"==this.type&&this.setFrameWidthHeight(i[this.getBlockType()].Frame._width,i[this.getBlockType()].Frame._height),null!=a?this.loadImage(a):(this.removeBitmap(),this.container.addChild(this.image)),this.setMode(t.inPreviewMode?"preview":"edit"),this.getVisible()||(this.visible=!1),i[this.getBlockType()].Frame.Path&&(this.imageMask=new t.controls.ImageMask(i[this.getBlockType()]),this.content.mask=this.imageMask.internalGraphic,this.content.mask.x=0,this.content.mask.y=0),"registeredAtWalmart"==this.pageItemBlock._designerLabel&&t.events.trigger(t.events.WALMART_REGISTER_LOGO,this),"bbox.controls.Image"==this.type&&t.imageManager.imageContainerAdd(),this.moveFrame=t._.bind(e.prototype.move,this),t.utils.LoggingUtil.log("Image","< bbox.controls.Image()",t.utils.LoggingUtil.EXTRY_EXIT)}return __extends(o,e),o.prototype.getBlockType=function(){return t.utils.HtmlUtil.getBlockName(this.pageItemBlock)},o.prototype.initializeModel=function(t,e){this.model={container:{x:0,y:0,width:this.width,height:this.height,rotation:0,mask:1},image:{x:0,y:0,width:t,height:e,rotation:0,vflip:!1,hflip:!1,imageFlip:!1,isEmpty:!1}}},o.prototype.getModelClone=function(){var e={};return e.container=t._.clone(this.model.container),e.image=t._.clone(this.model.image),e.container.radial=Math.sqrt(e.container.width*e.container.width+e.container.height*e.container.height),e},o.prototype.populateOldModel=function(){null==this.oldModel&&(this.oldModel=this.getModelClone())},o.prototype.cleanUpYourMess=function(){e.prototype.cleanUpYourMess.call(this),t.events.off(t.events.SET_COLOR,this.onGlobalColor,this),this.removeAllEventListeners()},o.prototype.isOriginalImage=function(){return this.image.image.src.split("_SEPIA.").length>1?!1:this.image.image.src.split("_GRAY.").length>1?!1:this.image.image.src.split("_BW.").length>1?!1:this.image.image.src.split("_"+this.colorTint+".").length>1?!1:!0},o.prototype.loadImage=function(e){"undefined"==typeof e&&(e=null),this.isLoaded=!1,this.showLoading(!0),this.container.removeAllChildren(),e&&(this.rawImageUrl=t.utils.ImageUtil.getImageUrlForResolution(e,this.pageItemBlock._type,this.imageAsset?this.imageAsset.isUgcImage:!1));var i=t.cacheManager.hasBitmap(this.rawImageUrl);i?this.imageLoaded():t.cacheManager.loadBitmap(this.rawImageUrl,t._.bind(this.imageLoaded,this),t._.bind(this.imageLoadingError,this))},o.prototype.setupBitmap=function(){this.image&&(this.container.removeChild(this.image),delete this.image),this.image=t.cacheManager.getBitmap(this.rawImageUrl),this.image.visible=!1,this.container.addChild(this.image)},o.prototype.ensureBitmapsExist=function(){this.image||(this.image=new createjs.Bitmap(null)),this.alphaImage||(this.alphaImage=new createjs.Bitmap(null))},o.prototype.loadAlphaImage=function(){null!=this.alphaImage&&(this.content.removeChild(this.alphaImage),delete this.alphaImage),this.alphaImage=new createjs.Bitmap(t.cacheManager.getImage(this.rawImageUrl)),this.alphaImage.visible=!1,this.alphaImage.alpha=.4,this.content.addChildAt(this.alphaImage,0)},o.prototype.imageLoaded=function(e){return"undefined"==typeof e&&(e=!1),e||this.setupBitmap(),this.isDeleted?void t.log("    image instanceId: "+this.instanceId+" was previously deleted. Exiting imageLoaded()"):(0!=this.imageNotLoadedTimeout&&(t.log("    Image.imageLoaded() Image reload after delay."),clearTimeout(this.imageNotLoadedTimeout),this.imageNotLoadedTimeout=0),this.image.image&&this.image.image.complete&&0!=this.image.image.width?(this.originalWidth=this.image.image.width,this.originalHeight=this.image.image.height,this.afterImageLoaded(),void t.events.trigger(t.events.ZOOM_UPDATE_IMAGE)):(t.log("    image.image.complete == "+this.image.image.complete+" width: "+this.image.image.width+" ! Must wait for good width/height."),void(this.imageNotLoadedTimeout=setTimeout(t._.bind(this.imageLoaded,this,!0),300))))},o.prototype.afterImageLoaded=function(){if(null!=this.pageItemBlock){var e=this.pageItemBlock[t.utils.HtmlUtil.getBlockName(this.pageItemBlock)];this.isOriginalImage(),this.model.container.x=this.model.container.y=0,this.setFrameWidthHeight(e.Frame._width,e.Frame._height),this.model.container.rotation=parseFloat(e.Frame._rotation),this.autoResize&&(this.model.container.height=this.model.container.width*this.originalHeight/this.originalWidth),void 0==e.Image&&(e.Image={},e.Image._xOffset=e.Frame._xOffset,e.Image._yOffset=e.Frame._yOffset,e.Image._width=e.Frame._width,e.Image._height=e.Frame._height,e.Image._copyable=e.Frame._copyable,e.Image._deletable=!0,e.Image._flippable=e.Frame._flippable,e.Image._movable=e.Frame._movable,e.Image._rotatable=e.Frame._rotatable,e.Image._scalable=e.Frame._scalable,e.Image._selectable=e.Frame._selectable,e.Image._verticalScale=e.Frame._verticalScale,e.Image._rotation=e.Frame._rotation),this.model.image.dirty=1;var i=this.translateDOMStateToUpperLeftXY(this,e);if(this.model.image.x=i.x,this.model.image.y=i.y,this.setImageWidthHeight(e.Image._width,e.Image._height),this.resetImageRegXY(),this.container.rotation=this.model.image.rotation=parseFloat(e.Image._rotation)-parseFloat(e.Frame._rotation),this.autoResize&&(this.autoResize=!1,this.setImageWidthHeight(this.model.container.width,this.model.container.height)),isNaN(this.model.image.x)&&(this.model.image.x=0),isNaN(this.model.image.y)&&(this.model.image.y=0),100==parseFloat(e.Image._verticalScale))this.imageFlip=this.model.image.imageFlip=!1,this.model.image.vflip=this.model.image.hflip=!1;else{this.imageFlip=this.model.image.imageFlip=!0,this.model.image.hflip=!1;var o=e.Frame._rotation,n=Math.cos(o*Math.PI/180)*e.Image._height,s=Math.sin(o*Math.PI/180)*e.Image._height;this.model.image.x-=s,this.model.image.y-=n,this.container.scaleY*=-1,this.model.image.vflip=this.container.scaleY<0}t.utils.ObjectUtil.isUndefined(e.Image._rotation)||(this.model.image.rotation=parseFloat(e.Image._rotation)-parseFloat(this.model.container.rotation)),this.isEmpty?(this.doCenterInFrame(!0),this.emptyImageBackground.visible=!0):this.emptyImageBackground.visible=!1,this.dirtyCanvas=!0,this.rotate(parseFloat(this.model.container.rotation),!0),this.loadAlphaImage(),this.colorId!=t.controls.Image.COLOR&&"-1"==this.colorTint&&"bbox.controls.BackgroundImage"!=this.type&&this.setColor(this.colorId),"-1"!=this.colorTint&&(t.product.isSingleColor()?t.inPreviewMode||this.onGlobalColor(this.colorTint):this.applyTint(this.colorTint)),this.render(),this.clean(),this.selected&&!t.inPreviewMode?this.select():this.unselect(),this.testHandles(),null!=this.ready&&(this.ready(),delete this.ready),this.image.visible=!0,this.showLoading(!1),this.isLoaded=!0}},o.prototype.imageLoadingError=function(){t.log(" > Image.imageLoadingError() url: "+this.rawImageUrl),t.utils.AppUtil.isLocalhost()&&this.imageAsset&&this.swapImage(this.imageAsset,this.ugcWidth,this.ugcHeight,!0)},o.prototype.edit_click=function(e){e.stopImmediatePropagation(),this.isEmpty?(t.uploadImageTarget=this,t.dialogs.displayUploadDialogViaAdd()):(this.editInProgress=!0,this.editMode=i.IMAGE,this.hideContainerEditor(),this.openEditor(),document.body.style.cursor="default",t.updateStage())},o.prototype.flipHorizontal=function(){this.isEmpty||(this.updateUserInteracted(),this.container.scaleX*=-1,this.model.image.hflip=this.container.scaleX<0,this.imageFlip=this.model.image.imageFlip=!this.imageFlip,this.dirtyCanvas=!0,this.render())},o.prototype.flipVertical=function(){this.isEmpty||(this.updateUserInteracted(),this.container.scaleY*=-1,this.model.image.vflip=this.container.scaleY<0,this.imageFlip=this.model.image.imageFlip=!this.imageFlip,this.dirtyCanvas=!0,this.render())},o.prototype.clearImageFlips=function(){this.imageFlip=this.model.image.imageFlip=this.model.image.vflip=this.model.image.hflip=!1},o.prototype.imageRotate=function(t,e){"undefined"==typeof e&&(e=!0),this.isEmpty||(this.updateUserInteracted(),this.model.image.rotation=e?this.model.image.rotation+t>359?0:this.model.image.rotation+t<0?345:this.model.image.rotation+t:t,this.container.rotation=this.model.image.rotation,this.dirtyCanvas=!0,this.render())},o.prototype.rotate=function(t,e){"undefined"==typeof e&&(e=!1);var i=this.rotation;if(0>t&&(t=360+t),t>360&&(t%=360),this.rotation=this.model.container.rotation=t,!e){var o=this.testHandles();o.e&&(this.rotation=this.model.container.rotation=i)}this.isEmpty||this.updateUserInteracted()},o.prototype.doImageMove=function(t,e,i){var o=Math.cos(this.rotation*Math.PI/180),n=Math.sin(this.rotation*Math.PI/180),s=o*t,a=o*e,r=n*t,l=n*e;this.model.image.x=i.image.x+l+s,this.model.image.y=i.image.y-r+a},o.prototype.key=function(e){if(this.editMode==i.FRAME)this.getMovable()&&("UP"==e?this.y=this.y-1:"DOWN"==e?this.y=this.y+1:"LEFT"==e?this.x=this.x-1:"RIGHT"==e&&(this.x=this.x+1));else if(this.editMode==i.IMAGE&&this.imageMovable){var o=0,n=0;"UP"==e?n=-1:"DOWN"==e?n=1:"LEFT"==e?o=-1:"RIGHT"==e&&(o=1);var s=this.getModelClone();this.doImageMove(o,n,this.model);var a=this.getModelClone(),r=this.pageItemBlock;t.actionManager.addAction(new t.actions.image.ImageModelAction(s,a,r,"ImageMoveAction")),this.render()}t.updateStage()},o.prototype.move=function(t){this.populateOldModel(),this.isEmpty||this.updateUserInteracted(),this.editMode==i.FRAME&&this.getMovable()?this.moveFrame(t):this.editMode===i.IMAGE&&this.imageMovable()&&this.moveImage(t)},o.prototype.moveImage=function(t){this.model.container.mask=t.final?1:0,this.doImageMove(t.cx-this.x,t.cy-this.y,this.oldModel),this.checkImageBounds(),this.render()},o.prototype.checkImageBounds=function(){var t=!1;if(this.model.image.height<this.model.container.height){var e={x:this.model.image.x+this.container.regX,y:this.model.image.y+this.container.regY};e.x<0?(t=!0,this.model.image.x=-this.container.regX):e.x>this.width&&(t=!0,this.model.image.x=this.width-this.container.regX),e.y<0?(t=!0,this.model.image.y=-this.container.regY):e.y>this.height&&(t=!0,this.model.image.y=this.height-this.container.regY)}else this.model.image.x>this.regX?(t=!0,this.model.image.x=this.regX):this.model.image.x+this.model.image.width<this.regX&&(t=!0,this.model.image.x=-this.regX-(this.model.image.width-this.model.container.width)),this.model.image.y>this.regY?(t=!0,this.model.image.y=this.regY):this.model.image.y+this.model.image.height<this.regY&&(t=!0,this.model.image.y=-this.regY-(this.model.image.height-this.model.container.height));return t},o.prototype.shouldShowDPIWarning=function(){var t=!1,e=300,i=72;return"preview"==this.getMode()?t:this.isEmpty?t:(this.imageAsset.isUgcImage&&(this.model.image.width>parseFloat(this.imageAsset.pixelWidth)/e*i&&(t=!0),this.model.image.height>parseFloat(this.imageAsset.pixelHeight)/e*i&&(t=!0)),t)},o.prototype.toolbarScale=function(t){this.populateOldModel(),this.model.container.mask=0;var e=t/.5;.2>e&&(e=.2),e>1.8&&(e=1.8),this.doImageScale(e),this.testHandles(),this.render()},o.prototype.toolbarScaleEnd=function(){this.oldModel=null,this.model.container.mask=1,this.checkImageBounds(),this.save(),this.render()},o.prototype.zeroImageLocation=function(t){"undefined"==typeof t&&(t=!0),this.model.image.x=this.image.x=0,this.model.image.y=this.image.y=0,t&&(this.model.image.rotation=this.container.rotation=this.image.rotation=0)},o.prototype.resetImageRegXY=function(){this.container.regX=this.model.image.width/2,this.container.regY=this.model.image.height/2},o.prototype.doImageScale=function(t){this.setImageWidthHeight(this.oldModel.image.width*t,this.oldModel.image.height*t);var e=-(this.oldModel.image.width*t-this.oldModel.image.width)/2,i=-(this.oldModel.image.height*t-this.oldModel.image.height)/2;this.model.image.x+=e-this.model.image.x+this.oldModel.image.x,this.model.image.y+=i-this.model.image.y+this.oldModel.image.y,this.resetImageRegXY()},o.prototype.sizeToFrame=function(){this.zeroImageLocation(),this.doCenterInFrame(!0),this.render(),t.updateStage()},o.prototype.doCenterInFrame=function(t){"undefined"==typeof t&&(t=!1);var e=this.model.container.width/this.originalWidth,i=this.model.container.height/this.originalHeight,o=e>=i;t&&(o=!o);var n=o?e:i;this.setImageWidthHeight(this.originalWidth*n,this.originalHeight*n),o?this.model.image.y=this.model.container.y+(this.model.container.height-this.model.image.height)/2:this.model.image.x=this.model.container.x+(this.model.container.width-this.model.image.width)/2,this.resetImageRegXY()},o.prototype.handles=function(t){if(this.isEmpty||this.updateUserInteracted(),this.populateOldModel(),this.editMode==i.FRAME){{var e;this.localToLocal(t.l,t.t,this.parent),this.localToLocal(t.r,t.b,this.parent)}if("MR"==t.type||"ML"==t.type||"UM"==t.type||"LM"==t.type)"MR"==t.type?this.model.container.width=t.r-this.model.container.x<this.MIN_WIDTH?this.MIN_WIDTH:t.r>this.model.image.x+this.model.image.width?-this.model.container.x+this.model.image.x+this.model.image.width:t.r-this.model.container.x:"ML"==t.type?t.l>this.oldModel.container.x+this.oldModel.container.width-this.MIN_WIDTH?(this.model.container.width=this.MIN_WIDTH,this.model.container.x=this.oldModel.container.x+this.oldModel.container.width-this.MIN_WIDTH):t.l<=this.model.image.x?(this.model.container.x=this.model.image.x,this.model.container.width=this.width-this.model.image.x+this.oldModel.container.x):(this.model.container.width=this.width-t.l+this.oldModel.container.x,this.model.container.x=t.l):"UM"==t.type?t.t>this.oldModel.container.y+this.oldModel.container.height-this.MIN_WIDTH?(this.model.container.y=this.oldModel.container.y+this.oldModel.container.height-this.MIN_WIDTH,this.model.container.height=this.MIN_WIDTH):t.t<=this.model.image.y?(this.model.container.y=this.model.image.y,this.model.container.height=this.height-this.model.image.y+this.oldModel.container.y):(this.model.container.y=t.t,this.model.container.height=this.height-t.t+this.oldModel.container.y):"LM"==t.type&&(this.model.container.height=t.b-this.model.container.y<this.MIN_WIDTH?this.MIN_WIDTH:t.b>this.model.image.y+this.model.image.height?-this.model.container.y+this.model.image.y+this.model.image.height:t.b-this.model.container.y);else if(("UL"==t.type||"UR"==t.type||"LL"==t.type||"LR"==t.type)&&(this.closeEditor(),this.isScalable())){var o,n,s,a=!1,r=!1;"UL"==t.type?(a=!0,r=!0):"UR"==t.type?a=!0:"LL"==t.type&&(r=!0),a?(o=t.t,o>this.oldModel.container.y+this.oldModel.container.height-this.MIN_WIDTH&&(o=this.oldModel.container.y+this.oldModel.container.height-this.MIN_WIDTH),s=this.oldModel.container.y+this.height-o):(o=t.b,o-this.model.container.y<this.MIN_WIDTH&&(o=this.model.container.y+this.MIN_WIDTH),s=o-this.model.container.y),r?(o=t.l,o>this.oldModel.container.x+this.oldModel.container.width-this.MIN_WIDTH&&(o=this.oldModel.container.x+this.oldModel.container.width-this.MIN_WIDTH),n=this.oldModel.container.x+this.width-o):(o=t.r,o-this.model.container.x<this.MIN_WIDTH&&(o=this.model.container.x+this.MIN_WIDTH),n=o-this.model.container.x);var l=this.oldModel.container.width/this.oldModel.container.height,h=n/s;h>l?n=s*l:l>h&&(s=n/l),this.setFrameWidthHeight(n,s),a&&(this.model.container.y=this.oldModel.container.y+this.oldModel.container.height-s),r&&(this.model.container.x=this.oldModel.container.x+this.oldModel.container.width-n);var e=Math.sqrt(this.model.container.width*this.model.container.width+this.model.container.height*this.model.container.height)/this.oldModel.container.radial;this.setImageWidthHeight(this.oldModel.image.width*e,this.oldModel.image.height*e),this.model.image.y=a?this.model.container.y-(this.oldModel.container.y-this.oldModel.image.y)*e:(-this.oldModel.container.y+this.oldModel.image.y)*e+this.oldModel.container.y,this.model.image.x=r?this.model.container.x-(this.oldModel.container.x-this.oldModel.image.x)*e:(-this.oldModel.container.x+this.oldModel.image.x)*e+this.oldModel.container.x,this.resetImageRegXY()}}else if(this.editMode==i.IMAGE){this.model.container.mask=t.final?1:0,this.closeEditor();var c=!1;if("MR"==t.type||"ML"==t.type||"UM"==t.type||"LM"==t.type){var d,p;"MR"==t.type?(d=Math.abs(t.r-this.oldModel.container.x-this.oldModel.container.width/2),e=d/this.oldModel.container.width*2):"ML"==t.type?(d=Math.abs(this.width-t.l+this.oldModel.container.x-this.oldModel.container.width/2),e=d/this.oldModel.container.width*2):"UM"==t.type?(p=Math.abs(t.t-this.oldModel.container.y-this.oldModel.container.height/2),e=p/this.oldModel.container.height*2):"LM"==t.type&&(p=Math.abs(this.height-t.b+this.oldModel.container.y-this.oldModel.container.height/2),e=p/this.oldModel.container.height*2),c=!0}else if(("UL"==t.type||"UR"==t.type||"LL"==t.type||"LR"==t.type)&&this.imageScalable){var u,g;"UL"==t.type?(u=this.width/2-t.l+this.oldModel.container.x,g=this.height/2-t.t+this.oldModel.container.y):"UR"==t.type?(u=t.r-this.oldModel.container.width/2-this.oldModel.container.x,g=this.height/2-t.t+this.oldModel.container.y):"LL"==t.type?(u=this.width/2-t.l+this.oldModel.container.x,g=t.b-this.oldModel.container.height/2-this.oldModel.container.y):"LR"==t.type&&(u=t.r-this.oldModel.container.width/2-this.oldModel.container.x,g=t.b-this.oldModel.container.height/2-this.oldModel.container.y),e=Math.abs(Math.sqrt(u*u+g*g))/this.oldModel.container.radial*2,c=!0}c&&this.doImageScale(e)}},o.prototype.scale=function(){this.ui.resizeHandles.UL.x=this.model.container.x,this.ui.resizeHandles.UL.y=this.model.container.y,this.ui.resizeHandles.UM.x=this.model.container.x+this.model.container.width/2,this.ui.resizeHandles.UM.y=this.model.container.y,this.ui.resizeHandles.UR.x=this.model.container.x+this.model.container.width,this.ui.resizeHandles.UR.y=this.model.container.y,this.ui.resizeHandles.ML.x=this.model.container.x,this.ui.resizeHandles.ML.y=this.model.container.y+this.model.container.height/2,this.ui.resizeHandles.MR.x=this.model.container.x+this.model.container.width,this.ui.resizeHandles.MR.y=this.model.container.y+this.model.container.height/2,this.ui.resizeHandles.LL.x=this.model.container.x,this.ui.resizeHandles.LL.y=this.model.container.y+this.model.container.height,this.ui.resizeHandles.LM.x=this.model.container.x+this.model.container.width/2,this.ui.resizeHandles.LM.y=this.model.container.y+this.model.container.height,this.ui.resizeHandles.LR.x=this.model.container.x+this.model.container.width,this.ui.resizeHandles.LR.y=this.model.container.y+this.model.container.height
},o.prototype.alignAlphaImage=function(){var t=this.container.getMatrix(null);t.decompose(this.alphaImage),this.alphaImage.scaleX=this.image.scaleX,this.alphaImage.scaleY=this.image.scaleY},o.prototype.updateMask=function(){this.container.mask.graphics.clear(),this.container.mask.graphics.beginFill(this.ui.FILL_COLOR).drawRect(this.model.container.x,this.model.container.y,this.model.container.width,this.model.container.height),this.alphaImage&&(0==this.model.container.mask?(this.alignAlphaImage(),this.alphaImage.visible=!0):this.alphaImage.visible&&(this.alphaImage.visible=!1,t.controls.Image.IDENTITY_MATRIX.decompose(this.alphaImage)))},o.prototype.checkModelParameters=function(){return 0==this.model.container.height?!1:0==this.model.container.width?!1:0==this.model.image.height?!1:0==this.model.image.width?!1:0/0==this.model.container.height?!1:0/0==this.model.container.width?!1:0/0==this.model.image.height?!1:0/0==this.model.image.width?!1:null==this.model.container.height?!1:null==this.model.container.width?!1:null==this.model.image.height?!1:null==this.model.image.width?!1:!0},o.prototype.render=function(){if(this.checkModelParameters()){var e=1/t.stageZoom.scaleX;if(this.dirtyCanvas&&!this.isEmpty){this.dirtyCanvas=!1,this.emptyImageBackground.visible=!1;var i=[],o=this.image.image.src.toLowerCase().indexOf("png")>0?!0:!1;this.colorId==t.controls.Image.SEPIA&&this.isOriginalImage()&&(i=t.utils.ImageUtil.getImageFilter(this.colorId,o)),this.colorId==t.controls.Image.GRAY&&"-1"==this.colorTint&&this.isOriginalImage()&&(i=t.utils.ImageUtil.getImageFilter(this.colorId,o)),"-1"!=this.colorTint&&(t.product.isSingleColor()?this.isEmpty||(i=t.utils.ImageUtil.getColorFilter(this.colorTint,o)):this.isOriginalImage()&&(i=t.utils.ImageUtil.getTintFilter(this.colorTint,o))),this.image.filters=i,this.alphaImage.filters=i,i.length>0&&"cacheCanvas"in this.image&&null!=this.image.cacheCanvas?(this.image.updateCache(),this.alphaImage.updateCache()):i.length>0?(this.image.cache(0,0,this.originalWidth,this.originalHeight),this.alphaImage.cache(0,0,this.originalWidth,this.originalHeight)):(this.image.uncache(),this.alphaImage.uncache())}this.scale(0),this.ui.outline.graphics.clear(),this.ui.outline.graphics.setStrokeStyle(this.ui.strokeSize*e).beginStroke(this.ui.VALID_LINE_COLOR).drawRect(this.model.container.x,this.model.container.y,this.model.container.width,this.model.container.height);var n=this.model.image.width/this.originalWidth;this.isEmpty&&(this.image.filters=[],this.imageFlip=!1,this.container.scaleX=this.container.scaleY=1,this.emptyImageBackground.graphics.clear(),this.emptyImageBackground.graphics.beginFill("#f1f1f1").drawRect(this.model.container.x,this.model.container.y,this.model.container.width,this.model.container.height),this.emptyImageBackground.visible=!0),this.image.scaleX=this.image.scaleY=n,this.container.x=this.model.image.x+this.container.regX,this.container.y=this.model.image.y+this.container.regY,this.updateMask(),t.updateStage()}},o.prototype.showEditor=function(){this.editMode==i.FRAME?t.editorManager.showContainer(this):this.editMode==i.IMAGE&&t.editorManager.showImage(this),this.editInProgress=!1,this.ui.toggleButtonVisibility(!0,this.editMode),this.ui.strokeColor=this.ui.VALID_LINE_COLOR,this.selected=!0,this.ui.render(),t.updateStage()},o.prototype.clean=function(e,o,n){"undefined"==typeof e&&(e=!1),"undefined"==typeof o&&(o=!1),"undefined"==typeof n&&(n=!1);var s=this.width,a=this.height;if(this.width=this.model.container.width,this.height=this.model.container.height,this.regX=this.width/2,this.regY=this.height/2,this.editMode==i.FRAME){e&&!n&&this.setPreviousHistoryProperties(e,s,a);var r=Math.cos(this.rotation*Math.PI/180),l=Math.sin(this.rotation*Math.PI/180),h=r*(this.width-s)/2,c=r*(this.height-a)/2,d=l*(this.width-s)/2,p=l*(this.height-a)/2;0==e||("UL"==e.type?(this.x=this.x-h+p,this.y=this.y-c-d):"UM"==e.type?(this.x=this.x+p,this.y=this.y-c):"UR"==e.type?(this.x=this.x+p+h,this.y=this.y+d-c):"ML"==e.type?(this.x=this.x-h,this.y=this.y-d):"MR"==e.type?(this.x=this.x+h,this.y=this.y+d):"LL"==e.type?(this.x=this.x-h-p,this.y=this.y+c-d):"LM"==e.type?(this.x=this.x-p,this.y=this.y+c):"LR"==e.type&&(this.x=this.x-p+h,this.y=this.y+d+c)),this.model.image.x-=this.model.container.x,this.model.image.y-=this.model.container.y,this.model.container.x=0,this.model.container.y=0,this.render(),this.scale(0),this.updateMask()}e.final&&this.checkImageBounds()&&this.render(),this.ui.update(this.model.container.width,this.model.container.height,this.model.container.x,this.model.container.y),o&&(this.editMode==i.FRAME?this.openContainerEditor():this.editMode==i.IMAGE&&this.openEditor()),1==this.selected?(this.ui.toggleButtonVisibility(!0,this.editMode),this.ui.strokeColor=this.ui.VALID_LINE_COLOR):(this.ui.toggleButtonVisibility(!1),this.ui.strokeColor=this.ui.NO_LINE_COLOR),this.ui.render(),e&&e.final&&(this.oldModel=null),document.body.style.cursor="default",this.testHandles(),t.updateStage()},o.prototype.setPreviousHistoryProperties=function(e,i,o){e.originalX=this.x,e.originalY=this.y,e.originalW=i,e.originalH=o,e.originalRotation=this.rotation,e.model=this.getModelClone(),e.model.image.imageId=this.imageId,e.model.image.isEmpty=this.isEmpty,e.model.image.imageAsset=t._.clone(this.imageAsset)},o.prototype.restoreImageStateToModel=function(e){this.model.image.x=e.image.x,this.model.image.y=e.image.y,this.setImageWidthHeight(e.image.width,e.image.height),this.resetImageRegXY(),this.imageRotate(e.image.rotation,!1),(e.image.vflip&&this.container.scaleY>0||!e.image.vflip&&this.container.scaleY<0)&&this.flipVertical(),(e.image.hflip&&this.container.scaleX>0||!e.image.hflip&&this.container.scaleX<0)&&this.flipHorizontal(),this.imageFlip=e.image.imageFlip,this.isEmpty=e.image.isEmpty,this.model.image=t._.clone(e.image)},o.prototype.restoreHistoryTransactionState=function(t,i,o){"undefined"==typeof i&&(i=null),"undefined"==typeof o&&(o=!1),e.prototype.restoreHistoryTransactionState.call(this,t),this.width=this.model.container.width=t.originalW,this.height=this.model.container.height=t.originalH,this.regX=this.width/2,this.regY=this.height/2,this.restoreImageStateToModel(t.model),this.ui.update(this.width,this.height),this.render()},o.prototype.preview=function(){this.setMode("preview"),(this.isEmpty||"false"==this.pageItemBlock._visible||"never"==this.pageItemBlock._preview)&&(this.visible=!1,t.updateStage())},o.prototype.edit=function(){this.setMode("edit"),this.getVisible()&&(this.visible=!0,this.ensureBitmapsExist(),this.render(),this.clean(),this.unselect(),t.updateStage())},o.prototype.isValid=function(){return this.valid=this.getRequired()?null!=this.imageAsset:!0,this.ui.strokeColor=this.valid?this.ui.VALID_LINE_COLOR:this.ui.INVALID_LINE_COLOR,this.ui.render(),this.valid},o.prototype.isContentDeletable=function(){return this.pageItemBlock[this.getBlockType()].Image._deletable},o.prototype.rotateOnCenter=function(t,e,i,o){var n=new createjs.Matrix2D(1,0,0,1,0,0),s=new createjs.Point(0,0);s=n.transformPoint(e,i,s),n.tx-=s.x,n.ty-=s.y,n.rotate(o*(Math.PI/180)),n.tx+=s.x,n.ty+=s.y,n.appendMatrix(t.getMatrix(null)),n.decompose(t)},o.prototype.translateImageStateToCenteredRotationXY=function(t,e,i,o,n){var s=new createjs.Shape;s.x=t,s.y=e,this.rotateOnCenter(s,t+i/2,e+o/2,n);var a=new createjs.Shape;a.x=this.model.image.x,a.y=this.model.image.y,this.rotateOnCenter(a,a.x+this.model.image.width/2,a.y+this.model.image.height/2,this.model.image.rotation);var r=s.getMatrix(null),l=a.getMatrix(null),h=r.appendMatrix(l),c=new createjs.Shape;h.decompose(c);var d=this.imageFlip?-1:1,p=a.rotation+n,u=this.getMidPoint(c.x,c.y,this.model.image.width,d*this.model.image.height,p);return this.rotateOnCenter(c,u.x,u.y,-p),{x:c.x,y:c.y,rotation:p}},o.prototype.translateDOMStateToUpperLeftXY=function(t,e){var i=parseFloat(e.Frame._xOffset),o=parseFloat(e.Frame._yOffset),n=parseFloat(e.Frame._width),s=parseFloat(e.Frame._height),a=parseFloat(e.Frame._rotation),r=parseFloat(e.Image._xOffset),l=parseFloat(e.Image._yOffset),h=parseFloat(e.Image._width),c=parseFloat(e.Image._height),d=parseFloat(e.Image._rotation),p=new createjs.Shape;p.x=i,p.y=o,t.rotateOnCenter(p,i+n/2,o+s/2,a);var u=new createjs.Shape;u.x=r,u.y=l,t.rotateOnCenter(u,r+h/2,l+c/2,d);var g=p.getMatrix(null),m=u.getMatrix(null);g.invert();var f=g.appendMatrix(m),v=new createjs.Shape;f.decompose(v);var y=u.rotation-p.rotation,I=this.getMidPoint(v.x,v.y,h,c,y);return t.rotateOnCenter(v,I.x,I.y,-y),{x:v.x,y:v.y,rotation:y}},o.prototype.getMidPoint=function(t,e,i,o,n){var s=n*Math.PI/180,a=Math.cos(s),r=Math.sin(s),l=i/2,h=o/2;return new createjs.Point(t+l*a-h*r,e+l*r+h*a)},o.prototype.setImageIdByAsset=function(){var e=this.pageItemBlock[t.utils.HtmlUtil.getBlockName(this.pageItemBlock)];null!=this.imageAsset?(e.Image._imageId=this.imageAsset.imageId,this.layout.addImageAsset(this.imageAsset)):e.Image._imageId=""},o.prototype.save=function(){if(!this.isLoaded)return void this.setImageIdByAsset();if(null!=this.pageItemBlock){var e=this.pageItemBlock[t.utils.HtmlUtil.getBlockName(this.pageItemBlock)];e.Frame._xOffset=this.precisionSixDigit(this.x-this.regX),e.Frame._yOffset=this.precisionSixDigit(this.y-this.regY),e.Frame._width=this.precisionSixDigit(this.model.container.width),e.Frame._height=this.precisionSixDigit(this.model.container.height),e.Frame._rotation=this.precisionSixDigit(this.model.container.rotation);var i=this.translateImageStateToCenteredRotationXY(e.Frame._xOffset,e.Frame._yOffset,e.Frame._width,e.Frame._height,e.Frame._rotation);if(e.Image._xOffset=this.precisionSixDigit(i.x),e.Image._yOffset=this.precisionSixDigit(i.y),e.Image._width=this.precisionSixDigit(this.model.image.width),e.Image._height=this.precisionSixDigit(this.model.image.height),e.Image._rotation=this.precisionSixDigit(e.Frame._rotation+this.model.image.rotation),this.imageFlip){e.Image._verticalScale=-100;var o=Math.cos(e.Image._rotation*Math.PI/180)*e.Image._height,n=Math.sin(e.Image._rotation*Math.PI/180)*e.Image._height;e.Image._xOffset=this.precisionSixDigit(e.Image._xOffset-n),e.Image._yOffset=this.precisionSixDigit(e.Image._yOffset+o)}else e.Image._verticalScale=100;this.container.scaleX<0&&(e.Image._rotation=(e.Image._rotation+180)%360),this.setImageIdByAsset(),e.Image._colorTint=0==this.colorTint.indexOf("#")?"0x"+this.colorTint.substr(1):"-1"!=this.colorTint?"0x"+this.colorTint:this.colorTint,e.Image._colorizeFilter=this.colorId}},o.prototype.toString=function(){return"Image Instance:"+this.instanceId},o.prototype.openEditor=function(){"edit"==this.getMode()&&(this.editMode=i.IMAGE,t.editorManager.showImage(this),this.ui.toggleButtonVisibility(!1))},o.prototype.closeEditor=function(){"edit"==this.getMode()&&(t.editorManager.image.commit(),this.editInProgress=!1)},o.prototype.removeBitmap=function(e){if("undefined"==typeof e&&(e=!0),0==e){var i=this.image.image.src;if(i.split("mySavedImages").length>1)return;if(i.split("myCartImages").length>1)return}this.updateUserInteracted(!1),this.colorId=t.controls.Image.COLOR,this.colorTint="-1",this.edit(),this.setIsEmpty(!0),this.image&&this.image.uncache(),this.alphaImage&&this.alphaImage.uncache(),this.zeroImageLocation(),this.clearImageFlips(),this.resetImageRegXY();var o=t.service.spriteService.getBitmap(t.model.SpriteType.UPLOADPHOTOLARGE);this.image.image=o.image,this.image.sourceRect=o.sourceRect,this.originalWidth=o.sourceRect.width,this.originalHeight=o.sourceRect.height,this.doCenterInFrame(!0),this.render(),this.clean(),this.image.visible=!0,this.imageAsset&&this.select(),t.updateStage();var n=this.imageId;this.imageId=null,this.imageAsset=null,this.isLoaded=!0,null!=n&&t.events.trigger(t.events.REFRESH_IMAGE_STATE,n,!0)},o.prototype.imageCopyable=function(){return this.checkImageBlockProperty("_copyable")},o.prototype.imageDeletable=function(){return this.checkImageBlockProperty("_deletable")},o.prototype.imageFlippable=function(){return this.checkImageBlockProperty("_flippable")},o.prototype.imageMovable=function(){return this.checkImageBlockProperty("_movable")},o.prototype.imageRotatable=function(){return this.checkImageBlockProperty("_rotatable")},o.prototype.imageScalable=function(){return this.checkImageBlockProperty("_scalable")},o.prototype.imageSelectable=function(){return this.checkImageBlockProperty("_selectable")},o.prototype.checkImageBlockProperty=function(t){return"true"===this.pageItemBlock[this.getBlockType()].Image[t]||this.pageItemBlock[this.getBlockType()].Image[t]===!0},o.prototype.onDelete=function(){"bbox.controls.Image"==this.type&&t.imageManager.imageContainerRemove()},o.prototype.setIsEmpty=function(e){this.isEmpty=this.model.image.isEmpty=e,this.setEditFrame(e?t.model.SpriteType.DONUT_ADD_IMAGE:t.model.SpriteType.DONUT_ICON_IMAGE)},o.prototype.setEditFrame=function(t){this.ui.setEditFrame(t)},o.prototype.modelXYNaNCheck=function(){isNaN(this.model.container.x)&&(this.model.container.x=0),isNaN(this.model.container.y)&&(this.model.container.y=0),isNaN(this.model.image.x)&&(this.model.image.x=this.model.container.x),isNaN(this.model.image.y)&&(this.model.image.y=this.model.container.y)},o.prototype.swapImage=function(e,i,o,n,s,a){"undefined"==typeof i&&(i=0),"undefined"==typeof o&&(o=0),"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=!0),"undefined"==typeof a&&(a=!1),this.isLoaded=!1,this.showLoading(!0),this.oldModel={},this.setPreviousHistoryProperties(this.oldModel,this.width,this.height),this.ensureBitmapsExist(),this.ugcWidth=i,this.ugcHeight=o,this.swapImageData={resetPositioning:s,imgAsset:e,previousImageId:this.imageId},t.product.isSingleColor()&&(n=!0,this.colorId=t.controls.Image.BW,this.colorTint=t.globalColor),0==n&&(this.colorId=t.controls.Image.COLOR,this.colorTint="-1");var r=this.pageItemBlock[t.utils.HtmlUtil.getBlockName(this.pageItemBlock)];this.clearImageFlips(),this.container.scaleX=this.container.scaleY=1,s&&(this.model.container.x=0,this.model.container.y=0,this.setFrameWidthHeight(r.Frame._width,r.Frame._height),this.zeroImageLocation(),this.setImageWidthHeight(this.model.container.width,this.model.container.height),this.resetImageRegXY()),this.image.uncache(),this.alphaImage.uncache();var l;null==e.url&&(e.url=e.isUgcImage?t.config.getFile()+e.webFilename:e.webFilename),l=e.url,t.product.isSingleColor()||1==n&&e.isUgcImage&&(l=l.split("_LOW")[0]+"_LOW"+l.substring(l.lastIndexOf("."))),this.imageAsset=e,this.imageId=e.imageId,this.rawImageUrl=t.utils.ImageUtil.getImageUrlForResolution(l,this.pageItemBlock._type,this.imageAsset?this.imageAsset.isUgcImage:!1),l=t.utils.AppUtil.appendAuthToken(this.rawImageUrl);var h=t.cacheManager.hasImage(this.rawImageUrl);h?this.swapImageOnload(a):(this.image.visible=!1,t.cacheManager.loadBitmap(this.rawImageUrl,t._.bind(this.swapImageOnload,this,a),t._.bind(this.imageLoadingError,this))),t.inPreviewMode?this.unselect():"bbox.controls.BackgroundImage"==this.type?this.unselect():t.selections.select(this,!0)},o.prototype.swapImageOnload=function(e,i){return"undefined"==typeof i&&(i=!1),i||this.setupBitmap(),this.isDeleted?void t.log("    image instanceId: "+this.instanceId+" was previously deleted. Exiting imageLoaded()"):(0!=this.imageNotLoadedTimeout&&(t.log("    Image.swapImageOnload() Image reload after delay."),clearTimeout(this.imageNotLoadedTimeout),this.imageNotLoadedTimeout=0),this.image.image&&this.image.image.complete&&0!=this.image.image.width?(this.originalWidth=this.image.image.width,this.originalHeight=this.image.image.height,void this.afterSwapImageOnload(e)):(t.log("    image.image.complete == false! Must wait for good width/height."),void(this.imageNotLoadedTimeout=setTimeout(t._.bind(this.swapImageOnload,this,e,!0),300))))},o.prototype.afterSwapImageOnload=function(e){var i=this.swapImageData.resetPositioning,o=this.swapImageData.imgAsset,n=this.swapImageData.previousImageId;this.swapImageData=null;var s=t._.clone(this.oldModel);this.dirtyCanvas=!0,this.modelXYNaNCheck(),i&&this.doCenterInFrame(!this.imageAsset.isUgcImage);var a=this.isEmpty;if(this.isEmpty){if(this.setIsEmpty(!1),t.utils.ObjectUtil.notUndefined(this.pageItemBlock.ObjectBlock)){var r=t.$.extend(!0,{},this.pageItemBlock.ObjectBlock);delete this.pageItemBlock.ObjectBlock,this.pageItemBlock.RasterBlock=r}var l=o.imageId,h=t.utils.ImageUtil.createImageElement(this.pageItemBlock.RasterBlock.Image,l,this.x-this.model.container.width/2,this.y-this.model.container.height/2,this.model.container.width,this.model.container.height,this.pageItemBlock.RasterBlock.Frame,this.model.image.width,this.model.image.height);this.pageItemBlock.RasterBlock.Image=h;var c=t.product.getActiveLayout();c.addImageAsset(o),this.updateUserInteracted()}if(this.loadAlphaImage(),this.colorId!=t.controls.Image.COLOR&&"-1"==this.colorTint&&"bbox.controls.BackgroundImage"!=this.type&&this.setColor(this.colorId),"-1"!=this.colorTint&&(t.product.isSingleColor()?t.inPreviewMode||this.onGlobalColor(this.colorTint):this.applyTint(this.colorTint)),this.render(),this.clean(!1,!1),this.save(),e===!1){var d={};this.setPreviousHistoryProperties(d,this.width,this.height);var p=new t.actions.image.ImageSwapAction(s,d,this.pageItemBlock);t.actionManager.addAction(p),this.oldModel=null}this.image.visible=!0,this.showLoading(!1),this.isLoaded=!0,t.events.trigger(t.events.PRODUCT_PERSONALIZED),"bbox.controls.BackgroundImage"==this.type?(t.events.trigger(t.events.REFRESH_IMAGE_STATE,this.imageAsset.fileId,!1,!1),t.events.trigger(t.events.REFRESH_IMAGE_STATE,n,!1,!1)):(t.events.trigger(t.events.REFRESH_IMAGE_STATE,this.imageAsset.fileId,!1),a||t.events.trigger(t.events.REFRESH_IMAGE_STATE,n,!0))},o.prototype.setColor=function(e){var i=this.isOriginalImage();if(this.colorId=e,this.colorTint="-1",this.dirtyCanvas=!0,null!=this.imageAsset&&(this.imageAsset=t.model.ImageAsset.clone(this.imageAsset),this.imageAsset.encodeColor(this.colorId),this.imageId=this.imageAsset.imageId,this.layout.addImageAsset(this.imageAsset)),this.colorId==t.controls.Image.COLOR){if(!i)return void this.swapImage(this.imageAsset,this.ugcWidth,this.ugcHeight,!0,!1);this.render(),this.save()}else i||t.inPreviewMode?(this.render(),this.save()):this.swapImage(this.imageAsset,this.ugcWidth,this.ugcHeight,!0,!1),this.colorize()},o.prototype.applyTint=function(e){if("#000"==e&&(e="#000000"),this.colorTint!=e){var i=this.isOriginalImage();this.colorId=t.controls.Image.GRAY,this.colorTint=e,this.dirtyCanvas=!0,"-1"!=this.colorTint&&this.tint(),null!=this.imageAsset&&(this.imageAsset=t.model.ImageAsset.clone(this.imageAsset),this.imageAsset.encodeTint(e),this.imageId=this.imageAsset.imageId,this.layout.addImageAsset(this.imageAsset)),i||t.inPreviewMode?(this.render(),this.save()):this.swapImage(this.imageAsset,this.ugcWidth,this.ugcHeight,!0,!1)}},o.prototype.onGlobalColor=function(e){if(this.colorTint=e,this.colorId=t.controls.Image.BW,this.dirtyCanvas=!0,this.isEmpty)return void this.render();if(this.imageAsset.isUgcImage&&!this.imageAsset.isBlackAndWhite()){var i=this.imageAsset.imageId;t.imageManager.colorize(this,i,t.controls.Image.BW,"","")}else this.render(),this.save()},o.prototype.onImageColorized=function(e){if(t.product.isSingleColor()){if(e.split("UNKNOWN").length>1)return void this.removeBitmap();var i=!this.imageAsset.isBlackAndWhite();this.imageAsset.updateToBW(e),i&&this.loadImage(this.imageAsset.url)}},o.prototype.colorizeAvailable=function(){return null!=this.imageAsset&&this.imageAsset.isUgcImage},o.prototype.setVisibility=function(e){this.visible=e,this.pageItemBlock._visible=e,t.updateStage()},o.prototype.colorize=function(){if(this.colorizeAvailable()){var e=this.imageAsset.imageId;t.imageManager.colorize(this,e,this.colorId)}},o.prototype.tint=function(){this.grayScaleImageCreated||(t.imageManager.colorize(this,this.imageAsset.imageId,t.controls.Image.GRAY,"",""),this.grayScaleImageCreated=!0);for(var e=t.utils.ImageUtil.getMatrixFromHexValue(this.colorTint),i="5x4:",o=0;o<e.length;o++)i+=e[o]+" ";var n=0==this.colorTint.indexOf("#")?this.colorTint.substr(1):this.colorTint;t.imageManager.colorize(this,this.imageAsset.imageId,"COLOR",t.$.trim(i),n)},o.prototype.setImageWidthHeight=function(t,e){0==t||isNaN(t)||0==e||isNaN(e),this.model.image.width=parseFloat(t),this.model.image.height=parseFloat(e)},o.prototype.setFrameWidthHeight=function(t,e){0==t||isNaN(t)||0==e||isNaN(e),this.model.container.width=parseFloat(t),this.model.container.height=parseFloat(e)},o.prototype.precisionSixDigit=function(t){return Math.floor(1e6*parseFloat(t))/1e6},o.COLOR="fullColor",o.GRAY="GRAY",o.SEPIA="SEPIA",o.BW="BW",o.IDENTITY_MATRIX=new createjs.Matrix2D(1,0,0,1,0,0),o}(t.controls.BaseControl);e.Image=o}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(t,e,i,o,n){"undefined"==typeof n&&(n="noActionName"),this.prevValue=t,this.newValue=e,this.control=i,this.actionType=n,o&&(this.pageItemBlock=JSON.stringify(o))}return e.prototype.isCurrentControl=function(){if(null==this.control)return!1;var e=!0;return this.control.id!==t.editorManager.text.control.id&&(e=!1),e},e.prototype.showEditorManager=function(){if(null!=this.control){var e=t.selections.getSelectedItems();t.selections&&e.length>0&&(1==e.length?this.updateEditorManager(e[0].id===this.control.id?e[0]:this.control):e.length>1&&t.selections.getGroup()&&t.selections.getGroup().id===this.control.id&&(t.editorManager.hideAll(),t.editorManager.showContainer(this.control)))}},e.prototype.getControlFromPageItem=function(){if(this.pageItemBlock){var e=JSON.parse(this.pageItemBlock);if(t.$.isArray(e)&&this.selectedItems)e.length>1&&(this.control=this.selectedItems,this.control.controls=this.getControls(e));else if(t.$.isArray(e))1===e.length?this.control=t.controls.ComponentFactory.lookupControl(e[0]):this.controls=this.getControls(e);else{var i=t.controls.ComponentFactory.lookupControl(e);this.control=i}!this.control}},e.prototype.logMe=function(){this.logging===!0},e.prototype.deAllocateControl=function(){this.control=null},e.prototype.updateEditorManager=function(e){t.selections.select(e,!0),t.editorManager.showContainer(e)},e.prototype.getControls=function(e){for(var i,o=[],n=0;n<e.length;n++)i=t.controls.ComponentFactory.lookupControl(e[n]),o.push(i);return o},e}();e.ActionBase=i}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(t){function e(e,i,o){t.call(this,e,i,null,o,"BackgroundColorAction")}return __extends(e,t),e.prototype.undo=function(){this.updateObjects(this.prevValue)},e.prototype.redo=function(){this.updateObjects(this.newValue)},e.prototype.updateObjects=function(t){this.getControlFromPageItem(),this.control.backgroundColor.changeColor(t),this.deAllocateControl()},e}(t.actions.ActionBase);e.BackgroundColorAction=i}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"ContainerCreateDeleteAction")}return __extends(i,e),i.prototype.undo=function(){this.updateObjects(this.prevValue)},i.prototype.redo=function(){this.updateObjects(this.newValue)},i.prototype.updateObjects=function(e){this.getControlFromPageItem();var i=t.editorManager.container,o=[];this.control?o.push(this.control):this.controls&&(o=this.controls);for(var n=JSON.parse(this.pageItemBlock),s=0;s<o.length;s++)i.setControl(o[s]),"remove"===e.action?i.handleDelete(!1):"bbox.controls.CompositeText"===o[s].type?(t.app.views.canvasView.addExistingText(o[s],e.index),o[s].restoreHistoryTransactionState(e.orgPostion[s]),n&&n.length>0&&o[s].reset(n[s],e.currentStory[s])):(t.app.views.canvasView.addExistingImage(o[s]),e.imageAsset&&e.imageAsset.length>0&&e.imageAsset[s].imageAsset&&o[s].swapImage(e.imageAsset[s].imageAsset,parseFloat(e.imageAsset[s].pixelWidth),parseFloat(e.imageAsset[s].pixelHeight),!1,!0,!0),t.updateStage(),o[s].restoreHistoryTransactionState(e.orgPostion[s],e.imageAsset[s],!0));t.updateStage(),t.save(),t.editorManager.commit(),this.deAllocateControl()},i}(t.actions.ActionBase);e.ContainerCreateDeleteAction=i}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"ContainerLayerAction")}return __extends(i,e),i.prototype.undo=function(){this.updateObjects(this.prevValue)},i.prototype.redo=function(){this.updateObjects(this.newValue)},i.prototype.updateObjects=function(e){this.getControlFromPageItem();var i=t.editorManager.container;i.setControl(this.control);var o=t.controls.ComponentFactory.lookupControl(e.referenceControl,!1);i.updateZOrder(o,e.direction),t.updateStage(),this.showEditorManager(),this.deAllocateControl()},i}(t.actions.ActionBase);e.ContainerLayerAction=i}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(t,i,o,n){"undefined"==typeof n&&(n=null),e.call(this,t,i,null,o,"ContainerMoveAction"),this.selectedItems=n}return __extends(i,e),i.prototype.undo=function(){this.updateObjects(this.prevValue)},i.prototype.redo=function(){this.updateObjects(this.newValue)},i.prototype.updateObjects=function(e){var i;return this.getControlFromPageItem(),this.selectedItems&&!t.selections.getGroup()?(this.makeSelections(),t.$.isArray(e)?this.moveControlsWithinGroup(e):(i=t.selections.getGroup(),i.restoreHistoryTransactionState(e),this.deAllocateControl()),t.selections.clear(),void t.updateStage()):(this.selectedItems&&t.selections.getGroup()?(this.makeSelections(),t.$.isArray(e)?(this.moveControlsWithinGroup(e),this.makeSelections(),t.selections.clear()):(i=t.selections.getGroup(),i.restoreHistoryTransactionState(e),t.selections.clear())):e.type?this.control.process_move(e,!0,!0):this.control.restoreHistoryTransactionState(e),t.updateStage(),t.save(),this.showEditorManager(),void this.deAllocateControl())},i.prototype.makeSelections=function(){for(var e,i=0;i<this.control.controls.length;i++)e=this.control.controls[i],0===i?t.selections.select(e,!0):t.selections.select(e),t.updateStage();return!0},i.prototype.moveControlsWithinGroup=function(e){var i=t.selections.getGroup(),o=this.control.x,n=this.control.y;this.control=i,this.control.x=o,this.control.y=n;for(var s=0;s<e.length;s++)this.control.controls[s].x=e[s].x,this.control.controls[s].y=e[s].y,t.updateStage();this.control.clear(),t.selections.clear()},i}(t.actions.ActionBase);e.ContainerMoveAction=i}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"ImageColorAction")}return __extends(i,e),i.prototype.undo=function(){this.updateImageObjects(this.prevValue)},i.prototype.redo=function(){this.updateImageObjects(this.newValue)},i.prototype.setEditorColorPallet=function(e){t.editorManager.image===t.editorManager.active&&this.control.id===t.editorManager.active.control.id&&t.editorManager.image.setColor(e)},i.prototype.updateImageObjects=function(e){if(this.getControlFromPageItem(),this.control.backgroundImage&&(this.control=this.control.backgroundImage),t.editorManager.image.setControl(this.control),"global"===e.type)return void t.setGlobalColor(e.colorTint);if(e.imageId){e.colorTint&&"-1"!==e.colorTint?(this.control.applyTint(e.colorTint),this.setEditorColorPallet(e.colorTint)):t.editorManager.image.setFilterColor(e.imageId);var i=t.editorManager.image.resetButton;switch(i.removeClass("sprite-icon_img_colorize_color"),i.removeClass("sprite-icon_img_colorize_bw"),i.removeClass("sprite-icon_img_colorize_sepia"),e.imageId){case t.controls.Image.SEPIA:i.addClass("sprite-icon_img_colorize_sepia");break;case t.controls.Image.GRAY:i.addClass("sprite-icon_img_colorize_bw");break;default:i.addClass("sprite-icon_img_colorize_color")}}else"-1"===e.colorTint&&(e.colorTint="#fffffe"),this.control.applyTint(e.colorTint),e.colorTint==t.utils.Constants.RESET_COLOR&&this.control.setColor(e.colorId),this.setEditorColorPallet(e.colorTint);t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.ImageColorAction=i}(e.image||(e.image={}));e.image}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(t){function e(e,i,o){t.call(this,e,i,null,o,"ImageFlipAction")}return __extends(e,t),e.prototype.undo=function(){this.updateImageObjects(this.prevValue)},e.prototype.redo=function(){this.updateImageObjects(this.newValue)},e.prototype.updateImageObjects=function(t){this.getControlFromPageItem(),this.control.backgroundImage&&(this.control=this.control.backgroundImage),"Horizontal"==t?this.control.flipHorizontal():this.control.flipVertical(),this.deAllocateControl()},e}(t.actions.ActionBase);e.ImageFlipAction=i}(e.image||(e.image={}));e.image}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o,n){"undefined"==typeof n&&(n="ImageModelAction"),e.call(this,t,i,null,o,n)}return __extends(i,e),i.prototype.undo=function(){this.updateImageObjects(this.prevValue)},i.prototype.redo=function(){this.updateImageObjects(this.newValue)},i.prototype.updateImageObjects=function(e){this.getControlFromPageItem(),this.control.backgroundImage&&(this.control=this.control.backgroundImage),this.control.restoreImageStateToModel(e),this.control.render(),t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.ImageModelAction=i}(e.image||(e.image={}));e.image}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"ImageMoveAction")}return __extends(i,e),i.prototype.undo=function(){this.updateImageObjects(this.prevValue)},i.prototype.redo=function(){this.updateImageObjects(this.newValue)},i.prototype.updateImageObjects=function(e){this.getControlFromPageItem(),this.control.backgroundImage&&(this.control=this.control.backgroundImage),this.control.model=e.model,this.control.render(),t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.ImageMoveAction=i}(e.image||(e.image={}));e.image}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"ImageRotateAction")}return __extends(i,e),i.prototype.undo=function(){this.updateImageObjects(this.prevValue)},i.prototype.redo=function(){this.updateImageObjects(this.newValue)},i.prototype.updateImageObjects=function(e){this.getControlFromPageItem(),this.control.backgroundImage&&(this.control=this.control.backgroundImage);var i=parseInt(e,10);this.control.imageRotate(i),t.updateStage(),t.save(),this.deAllocateControl()},i}(t.actions.ActionBase);e.ImageRotateAction=i}(e.image||(e.image={}));e.image}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"ImageScaleAction")}return __extends(i,e),i.prototype.undo=function(){this.updateImageObjects(this.prevValue)},i.prototype.redo=function(){this.updateImageObjects(this.newValue)},i.prototype.updateImageObjects=function(e){this.getControlFromPageItem(),this.control.backgroundImage&&(this.control=this.control.backgroundImage),this.control.model.image=e.image,this.control.render(),t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.ImageScaleAction=i}(e.image||(e.image={}));e.image}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"ImageSizeFitAction")}return __extends(i,e),i.prototype.undo=function(){this.updateImageObjects(this.prevValue)},i.prototype.redo=function(){this.updateImageObjects(this.newValue)},i.prototype.updateImageObjects=function(e){this.getControlFromPageItem(),this.control.backgroundImage&&(this.control=this.control.backgroundImage),this.control.model.image=e.image,this.control.render(),t.updateStage(),this.deAllocateControl()
},i}(t.actions.ActionBase);e.ImageSizeFitAction=i}(e.image||(e.image={}));e.image}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"ImageSwapAction")}return __extends(i,e),i.prototype.undo=function(){this.updateImageObjects(this.prevValue)},i.prototype.redo=function(){this.updateImageObjects(this.newValue)},i.prototype.updateImageObjects=function(e){this.getControlFromPageItem(),e&&e.model.image.imageAsset&&e.model.image.imageAsset.imageId?(this.pendingState=e,t.events.on(t.events.REFRESH_IMAGE_STATE,this.restoreState,this),this.control.swapImage(e.model.image.imageAsset,parseFloat(e.model.image.imageAsset.pixelWidth),parseFloat(e.model.image.imageAsset.pixelHeight),!1,!0,!0),t.updateStage()):(this.control.removeBitmap(),t.updateStage(),t.editorManager.hideImage(),this.deAllocateControl())},i.prototype.restoreState=function(){t.events.off(t.events.REFRESH_IMAGE_STATE,this.restoreState,this),this.control.restoreHistoryTransactionState(this.pendingState),this.pendingState=null,t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.ImageSwapAction=i}(e.image||(e.image={}));e.image}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"TextColorAction")}return __extends(i,e),i.prototype.undo=function(){this.updateTextColorObjects(this.prevValue)},i.prototype.redo=function(){this.updateTextColorObjects(this.newValue)},i.prototype.setEditorColorPallet=function(e){this.isCurrentControl()&&t.editorManager.text===t.editorManager.active&&t.editorManager.text.setColor(e)},i.prototype.updateTextColorObjects=function(e){e.type&&(t.setGlobalColor(e.color),e=e.color),this.getControlFromPageItem(),this.control.setCurrentFontColor(e),this.setEditorColorPallet(e),t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.TextColorAction=i}(e.text||(e.text={}));e.text}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"TextFontAction")}return __extends(i,e),i.prototype.undo=function(){this.updateTextFontObjects(this.prevValue)},i.prototype.redo=function(){this.updateTextFontObjects(this.newValue)},i.prototype.setEditorFont=function(e){this.isCurrentControl()&&t.editorManager.text===t.editorManager.active&&t.editorManager.text.setFont(e)},i.prototype.updateTextFontObjects=function(e){this.getControlFromPageItem(),this.control.setCurrentFont(e),this.setEditorFont(e),t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.TextFontAction=i}(e.text||(e.text={}));e.text}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"TextFontAlignAction")}return __extends(i,e),i.prototype.undo=function(){this.updateTextStyleObjects(this.prevValue)},i.prototype.redo=function(){this.updateTextStyleObjects(this.newValue)},i.prototype.setEditorFontAlign=function(e){this.isCurrentControl()&&t.editorManager.text===t.editorManager.active&&t.editorManager.text.setHAlign(e)},i.prototype.updateTextStyleObjects=function(e){this.getControlFromPageItem(),this.control.updateHorizontalAlignment(e),this.setEditorFontAlign(e),t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.TextFontAlignAction=i}(e.text||(e.text={}));e.text}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"TextHeightAction")}return __extends(i,e),i.prototype.undo=function(){this.updateTextStyleObjects(this.prevValue)},i.prototype.redo=function(){this.updateTextStyleObjects(this.newValue)},i.prototype.updateCanvasText=function(){for(var t,e=0;e<this.control.paragraphs.length;e++)t=this.control.paragraphs[e]},i.prototype.setEditorFontHeight=function(e){this.isCurrentControl()&&t.editorManager.text===t.editorManager.active&&t.editorManager.text.setLineHeight(e)},i.prototype.updateTextStyleObjects=function(e){this.getControlFromPageItem(),this.control.lineHeight=e,this.setEditorFontHeight(e),this.updateCanvasText(e),t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.TextHeightAction=i}(e.text||(e.text={}));e.text}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o,n,s){e.call(this,t,o,null,s,"TextRevisionAction"),this.previousPageItem=t,this.previousStory=i,this.newPageItem=o,this.newStory=n,this.logging=!1,this.logMe("new text revision"),this.logMe(i),this.logMe(n)}return __extends(i,e),i.prototype.undo=function(){this.logMe("Text undo"),this.getControlFromPageItem(),t.utils.TextUtil.logText(this.previousPageItem,this.previousStory),this.control.reset(this.previousPageItem,this.previousStory),this.deAllocateControl()},i.prototype.redo=function(){this.logMe("Text redo"),this.getControlFromPageItem(),t.utils.TextUtil.logText(this.newPageItem,this.newStory),this.control.reset(this.newPageItem,this.newStory),this.deAllocateControl()},i}(t.actions.ActionBase);e.TextRevisionAction=i}(e.text||(e.text={}));e.text}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"TextSizeAction")}return __extends(i,e),i.prototype.undo=function(){this.updateTextSizeObjects(this.prevValue)},i.prototype.redo=function(){this.updateTextSizeObjects(this.newValue)},i.prototype.setEditorFontSize=function(e){this.isCurrentControl()&&t.editorManager.text===t.editorManager.active&&t.editorManager.text.setFontSize(e)},i.prototype.updateTextSizeObjects=function(e){this.getControlFromPageItem(),this.control.setCurrentFontSize(e),this.setEditorFontSize(e),t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.TextSizeAction=i}(e.text||(e.text={}));e.text}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,o){e.call(this,t,i,null,o,"TextVariantAction")}return __extends(i,e),i.prototype.undo=function(){this.updateTextStyleObjects(this.prevValue)},i.prototype.redo=function(){this.updateTextStyleObjects(this.newValue)},i.prototype.updateCanvasText=function(t){for(var e,i=0;i<this.control.paragraphs.length;i++)e=this.control.paragraphs[i],e.updateFontVariant(t)},i.prototype.setEditorFontVariant=function(e){this.isCurrentControl()&&t.editorManager.text===t.editorManager.active&&t.editorManager.text.setFontVariant(e.fontStyle)},i.prototype.updateTextStyleObjects=function(e){this.getControlFromPageItem(),this.control.currentVariant=e,this.setEditorFontVariant(e),this.updateCanvasText(e.fontStyle),t.updateStage(),this.deAllocateControl()},i}(t.actions.ActionBase);e.TextVariantAction=i}(e.text||(e.text={}));e.text}(t.actions||(t.actions={}));t.actions}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i,o){e.call(this),this.backgroundImage=null,this.backgroundColor=null,this._mode="edit",this.type="bbox.controls.Background",this.hasImageByDefault=!1,this.pageItemBlock=i,this.backgroundLayout=o,this.blockType=t.utils.HtmlUtil.getBlockName(this.pageItemBlock);var n=t.product.activeData.width,s=t.product.activeData.height;this.backgroundWhite=new createjs.Shape,this.backgroundWhite.graphics.beginFill("#FFFFFF").drawRect(0,0,n,s),this.addChild(this.backgroundWhite),this.backgroundColor=new t.controls.BackgroundColor(this.pageItemBlock,this.backgroundLayout),this.addChild(this.backgroundColor),void 0!=i[this.blockType].Image&&(t.utils.ObjectUtil.isEmpty(i[this.blockType].Image._imageId)||(this.hasImageByDefault=!0,this.backgroundImage=new t.controls.BackgroundImage(i,o),this.addChild(this.backgroundImage))),"false"===i._selectable.toLowerCase()&&t.events.trigger(t.events.DISABLE_BACKGROUND),t.events.on(t.events.CREATE_BACKGROUND_IMAGE,this.createImage,this),t.events.on(t.events.RESET_BACKGROUND,this.reset,this),t.events.on(t.events.OPTIONS_LOADED,this.checkPaperOptions,this),t.events.on(t.events.UNSELECT_BACKGROUND,this.deselect,this),t.events.on(t.events.CHANGE_BACKGROUND_COLOR,this.setBackgroundColor,this),t.events.on(t.events.PAPERSTOCK_CHANGED,this.paperStockChanged,this),t.events.on(t.events.SWAP_BACKGROUND_IMAGE,this.onSwapImage,this),null!=t.productOptions&&this.checkPaperOptions(),null!=t.paperStock&&this.paperStockChanged()}return __extends(i,e),i.prototype.onSwapImage=function(t){this.backgroundImage?this.backgroundImage.swapImage(t,t.pixelWidth,t.pixelHeight):this.createImage(t)},i.prototype.cleanUpYourMess=function(){t.events.off(t.events.CREATE_BACKGROUND_IMAGE,this.createImage,this),t.events.off(t.events.RESET_BACKGROUND,this.reset,this),t.events.off(t.events.OPTIONS_LOADED,this.checkPaperOptions,this),t.events.off(t.events.UNSELECT_BACKGROUND,this.deselect,this),t.events.off(t.events.CHANGE_BACKGROUND_COLOR,this.setBackgroundColor,this),t.events.off(t.events.SWAP_BACKGROUND_IMAGE,this.onSwapImage,this),null!=this.backgroundImage&&this.backgroundImage.cleanUpYourMess(),this.backgroundColor.cleanUpYourMess(),this.removeAllEventListeners()},i.prototype.restoreHistoryTransactionState=function(){},i.prototype.setBackgroundColor=function(e){var i=this.backgroundColor.currentColor,o=this.pageItemBlock,n=new t.actions.BackgroundColorAction(i,e,o);t.actionManager.addAction(n),this.backgroundColor.changeColor(e)},i.prototype.checkPaperOptions=function(){t.productOptions.hasPaperOptions()||""!=this.pageItemBlock[this.blockType].Frame._fillColor||null!=this.backgroundColor||(this.pageItemBlock[this.blockType].Frame._fillColor="#FFFFFF",this.setBackgroundColor("#FFFFFF"))},i.prototype.createImage=function(e){if(e&&(this.pageItemBlock[this.blockType].Image._imageId=e.imageId),null!=this.backgroundImage&&this.removeChild(this.backgroundImage),this.backgroundImage=new t.controls.BackgroundImage(this.pageItemBlock,this.backgroundLayout),this.addChild(this.backgroundImage),null!=this.paperStockOverlay&&(this.removeChild(this.paperStockOverlay),this.addChild(this.paperStockOverlay)),"ObjectBlock"==this.blockType){var i=t.$.extend(!0,{},this.pageItemBlock.ObjectBlock);delete this.pageItemBlock.ObjectBlock,this.pageItemBlock.RasterBlock=i,this.blockType="RasterBlock"}t.updateStage()},i.prototype.swapImage=function(e,i,o,n,s,a){"undefined"==typeof i&&(i=0),"undefined"==typeof o&&(o=0),"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=!0),"undefined"==typeof a&&(a=!1),null!=this.backgroundImage?this.backgroundImage.swapImage(e,i,o,n,s,a):(this.backgroundLayout.addImageAsset(e),this.createImage(null),this.backgroundImage.imageAsset=null,this.backgroundImage.imageId=null,this.backgroundImage.swapImage(e,i,o,!1,!0,a),t.events.trigger(t.events.BACKGROUND_IMAGE_ADDED,e.fileId))},i.prototype.paperStockChanged=function(){null!=this.paperStockOverlay&&this.removeChild(this.paperStockOverlay),this.paperStockOverlay=new createjs.Bitmap(t.utils.AppUtil.appendAuthToken(t.paperStock)),this.paperStockOverlay.mouseEnabled=!1,this.paperStockOverlay.image.onload=function(){t.updateStage()},this.paperStockOverlay.type="bbox.controls.BackgroundImage",this.paperStockOverlay.compositeOperation=t.isFirefox()?"multiply":"darker",this.addChild(this.paperStockOverlay),t.updateStage()},i.prototype.reset=function(e){this.hasImageByDefault?t.events.trigger(t.events.RESET_BACKGROUND_IMAGE):(this.removeChild(this.backgroundImage),this.pageItemBlock[this.blockType].Image._imageId="",this.backgroundImage=null),this.backgroundColor.resetColor(),t.events.trigger(t.events.RESET_BACKGROUND_COLOR,e)},i.prototype.removeBitmap=function(){this.backgroundImage.resetBackground()},i.prototype.deselect=function(){this.backgroundImage&&this.backgroundImage.selected&&t.editorManager.hideImage()},i.prototype.unselect=function(){},i.prototype.select=function(){},i.prototype.getMode=function(){return this._mode},i.prototype.setMode=function(t){this._mode=t},i.prototype.preview=function(){this.setMode("preview"),this.backgroundImage&&this.backgroundImage.setMode("preview")},i.prototype.edit=function(){this.setMode("edit"),this.backgroundImage&&this.backgroundImage.setMode("edit")},i.prototype.isValid=function(){return!0},i.prototype.save=function(){null!=this.backgroundImage&&this.backgroundImage.save(),this.backgroundColor.save()},i.prototype.isDeletable=function(){return"true"==this.pageItemBlock._deletable},i.prototype.isContentDeletable=function(){return null!=this.backgroundImage?this.backgroundImage.isContentDeletable():!0},i.prototype.getHistoryTransactionState=function(){return this.backgroundImage.getHistoryTransactionState()},i}(createjs.Container);e.Background=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i,o){e.call(this),this._mode="edit",this.pageItemBlock=i,this.layout=o;var n=t.utils.HtmlUtil.getBlockName(i),s=""!=i[n].Frame._fillColor?i[n].Frame._fillColor:null;this.type="bbox.controls.BackgroundColor",this.currentColor=s,this.width=t.product.activeData.width,this.height=t.product.activeData.height,this.colorBox=new createjs.Shape,null!=this.currentColor&&this.colorBox.graphics.beginFill(this.currentColor).drawRect(0,0,this.width,this.height),this.addChild(this.colorBox),t.updateStage()}return __extends(i,e),i.prototype.cleanUpYourMess=function(){this.pageItemBlock=null,this.layout=null,this.uncache(),this.removeAllEventListeners()},i.prototype.changeColor=function(e){this.currentColor=e,this.colorBox.graphics.clear(),null!=e&&this.colorBox.graphics.beginFill(e).drawRect(0,0,this.width,this.height),t.updateStage()},i.prototype.resetColor=function(){var e=t.utils.SdxmlUtil.getOriginalBackgroundPageItem(),i=t.utils.HtmlUtil.getBlockName(e),o=e[i];this.changeColor(""==o.Frame._fillColor?null:o.Frame._fillColor)},i.prototype.getMode=function(){return this._mode},i.prototype.setMode=function(t){this._mode=t},i.prototype.preview=function(){this.setMode("preview")},i.prototype.edit=function(){this.setMode("edit")},i.prototype.isValid=function(){return!0},i.prototype.save=function(){var e=t.utils.HtmlUtil.getBlockName(this.pageItemBlock);this.pageItemBlock[e].Frame._fillColor=null==this.currentColor?"":this.currentColor},i.prototype.toString=function(){return"BackgroundColor Instance:"+this.id},i.prototype.unselect=function(){},i}(createjs.Container);e.BackgroundColor=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i,o){e.call(this,i,o,!1,"bbox.controls.BackgroundImage"),this.type="bbox.controls.BackgroundImage",this.isEmpty=!1,t.events.on(t.events.RESET_BACKGROUND_IMAGE,this.resetBackground,this);var n=i[t.utils.HtmlUtil.getBlockName(i)];this.model.container.width=parseFloat(n.Frame._width),this.model.container.height=parseFloat(n.Frame._height),t.product.isSingleColor()!==!0||t.globalColor||t.product.isStamp()||(this.colorTint="#000000"),this.imageAsset&&(this.ugcWidth=parseFloat(this.imageAsset.pixelWidth),this.ugcHeight=parseFloat(this.imageAsset.pixelHeight))}return __extends(i,e),i.prototype.cleanUpYourMess=function(){e.prototype.cleanUpYourMess.call(this),t.events.off(t.events.RESET_BACKGROUND_IMAGE,this.resetBackground,this),this.removeAllEventListeners()},i.prototype.resetBackground=function(){t.log(" > BackgroundImage.resetBackground()"),this.image.filters=null;var e=t.utils.SdxmlUtil.getOriginalBackgroundPageItem(),i=t.utils.HtmlUtil.getBlockName(e),o=e[i],n=o.Image._imageId,s=t.utils.SdxmlUtil.getOriginalImageAsset(n);return null==s?(this.hideBackgroundImage(),void t.updateStage()):(s.url=t.config.imageURL()+t.config.imageLibraryBasePath()+"/"+t.config.productCode()+t.config.imageProductFolder()+"/"+t.product.manifest.productVersion+"/"+s.webFilename,this.model.container.x=0,this.model.container.y=0,this.model.container.rotation=0,this.model.container.width=parseFloat(o.Frame._width),this.model.container.height=parseFloat(o.Frame._height),this.model.image.x=parseFloat(o.Image._xOffset)-parseFloat(o.Frame._xOffset),this.model.image.y=parseFloat(o.Image._yOffset)-parseFloat(o.Frame._yOffset),this.model.image.rotation=0,this.model.image.width=parseFloat(o.Frame._width),this.model.image.height=parseFloat(o.Frame._height),this.swapImage(s),void t._.delay(function(){t.editorManager.clear()},500))},i.prototype.showEditor=function(){t.editorManager.showImage(this),this.editInProgress=!1,this.ui.toggleButtonVisibility(!0,this.editMode),this.ui.strokeColor=this.ui.VALID_LINE_COLOR,this.selected=!0,this.ui.render(),t.updateStage()},i.prototype.hideBackgroundImage=function(){if(this.parent){var t=this.parent;t.backgroundImage=null,t.removeChild(this),t.pageItemBlock[t.blockType].Image._imageId="",this.cleanUpYourMess()}},i.prototype.testHandles=function(){var e={e:!1,t:0,te:!1,teb:0,b:0,be:!1,beb:0,l:0,le:!1,leb:0,r:0,re:!1,reb:0};if(null==this.parent)return e;if(null==this.ui.resizeHandles.UL.parent)return e;if(null==this.ui.resizeHandles.UR.parent)return e;if(null==this.ui.resizeHandles.LL.parent)return e;if(null==this.ui.resizeHandles.LR.parent)return e;var i=this.ui.resizeHandles.UL,o=i.parent.localToLocal(i.x,i.y,this.parent);return e.l=e.r=o.x,e.t=e.b=o.y,i=this.ui.resizeHandles.UR,o=i.parent.localToLocal(i.x,i.y,this.parent),o.x<e.l&&(e.l=o.x),o.x>e.r&&(e.r=o.x),o.y<e.t&&(e.t=o.y),o.y>e.b&&(e.b=o.y),i=this.ui.resizeHandles.LL,o=i.parent.localToLocal(i.x,i.y,this.parent),o.x<e.l&&(e.l=o.x),o.x>e.r&&(e.r=o.x),o.y<e.t&&(e.t=o.y),o.y>e.b&&(e.b=o.y),i=this.ui.resizeHandles.LR,o=i.parent.localToLocal(i.x,i.y,this.parent),o.x<e.l&&(e.l=o.x),o.x>e.r&&(e.r=o.x),o.y<e.t&&(e.t=o.y),o.y>e.b&&(e.b=o.y),e.t<t.product.activeData.bleedTop&&(e.e=e.te=!0,e.teb=t.product.activeData.bleedTop),e.b>=t.product.activeData.bleedBottom+t.product.activeData.height&&(e.e=e.be=!0,e.beb=t.product.activeData.bleedBottom+t.product.activeData.height),e.l<=t.product.activeData.bleedLeft&&(e.e=e.le=!0,e.leb=t.product.activeData.bleedLeft),e.r>=t.product.activeData.bleedRight+t.product.activeData.width&&(e.e=e.re=!0,e.reb=t.product.activeData.bleedRight+t.product.activeData.width),this.shouldShowDPIWarning()?(this.ui.setWarningDPI(!0),this.warningMessage=t.utils.Constants.IMAGE_RESOLUTION_WARNING):this.ui.setWarningDPI(!1),e},i.prototype.outline_mouseover=function(e){return e.stopImmediatePropagation(),this.isLoaded?"asset-panel-backgrounds"!==t.app.views.assetPanelView.getActiveGroup()?(this.ui.strokeColor=this.ui.NO_LINE_COLOR,this.ui.render(),void t.updateStage()):void(t.isRotate!==!0&&this.dragging!==!0&&"edit"==this.getMode()&&this.getSelectable()&&(this.ui.strokeColor=this.ui.VALID_LINE_COLOR,this.ui.render(),t.updateStage())):void 0},i.prototype.outline_mouseout=function(t){t.stopImmediatePropagation()},i.prototype.outline_double=function(t){t.stopImmediatePropagation()},i.prototype.outline_mousedown=function(e){return e.stopImmediatePropagation(),t.editorManager.commit(),"asset-panel-backgrounds"!==t.app.views.assetPanelView.getActiveGroup()?void t.selections.clear():(this.getSelectable()&&"edit"===this.getMode()&&t.selections.select(this,!0),void(this.dragging!==!0&&(e.nativeEvent.shiftKey&&t.selections.count()>0||(this.getSelectable()&&"edit"==this.getMode()&&this.imageSelectable?t.selections.select(this,!0):t.selections.clear()))))},i.prototype.outline_pressmove=function(t){t.stopImmediatePropagation()},i.prototype.outline_pressup=function(t){t.stopImmediatePropagation()},i.prototype.outline_click=function(t){t.stopImmediatePropagation()},i}(t.controls.Image);e.BackgroundImage=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){e.call(this),this.drawn=!1,this.WARNING_COLOR=createjs.Graphics.getRGB(16711680,.3),this.NO_LINE_COLOR=createjs.Graphics.getRGB(0,0),this._mode="edit",this.mouseEnabled=!1,this.warning=new createjs.Shape,this.addChild(this.warning)}return __extends(i,e),i.prototype.cleanUpYourMess=function(){this.removeAllEventListeners()},i.prototype.showWarning=function(){if(1!=this.drawn){this.drawn=!0,this.parent&&this.parent.removeChild(this),t.stage.addChild(this);var e,i,o,n,s=t.product.activeData;this.warning.graphics.clear(),e=s.safeLeft,i=s.safeTop,o=s.width-s.safeLeft+s.safeRight,n=s.height-s.safeTop+s.safeBottom,this.warning.graphics.beginFill(this.WARNING_COLOR).drawRect(0,0,s.width,s.safeTop),this.warning.graphics.beginFill(this.WARNING_COLOR).drawRect(0,s.safeTop,s.safeLeft,s.height),this.warning.graphics.beginFill(this.WARNING_COLOR).drawRect(s.width+s.safeRight,s.safeTop,-s.safeRight,s.height),this.warning.graphics.beginFill(this.WARNING_COLOR).drawRect(s.safeLeft,s.height+s.safeBottom,s.width-s.safeLeft+s.safeRight,-s.safeBottom),t.updateStage()}},i.prototype.hideWarning=function(){this.drawn=!1,this.warning.graphics.clear()},i.prototype.getMode=function(){return this._mode},i.prototype.setMode=function(t){this._mode=t},i.prototype.preview=function(){this.setMode("preview"),this.hideWarning()},i.prototype.edit=function(){this.setMode("edit"),this.hideWarning()},i.prototype.isValid=function(){return!0},i.prototype.save=function(){},i.prototype.toString=function(){return"Bounds"},i.prototype.select=function(){},i.prototype.unselect=function(){},i}(createjs.Container);e.Bounds=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.create=function(e,i){var o=t.utils.HtmlUtil.getBlockName(e);if("background"==e._type)return new t.controls.Background(e,i);if(e._type==t.utils.Constants.PAPER_STOCK)return new t.controls.Paperstock(e,i);if("constrainingRegion"==e._type)return"0"==e[o].Frame._rotation?(parseFloat(e[o].Frame._width)+parseFloat(e[o].Frame._xOffset)<t.product.activeData.width||parseFloat(e[o].Frame._height)+parseFloat(e[o].Frame._yOffset)<t.product.activeData.height)&&(t.product.activeData.constrained=!0,t.product.activeData.safeTop=parseFloat(e[o].Frame._yOffset),t.product.activeData.safeLeft=parseFloat(e[o].Frame._xOffset),t.product.activeData.safeRight=parseFloat(e[o].Frame._xOffset)+parseFloat(e[o].Frame._width)-t.product.activeData.width,t.product.activeData.safeBottom=parseFloat(e[o].Frame._yOffset)+parseFloat(e[o].Frame._height)-t.product.activeData.height):"90"==e[o].Frame._rotation&&(parseFloat(e[o].Frame._height)+parseFloat(e[o].Frame._yOffset)<t.product.activeData.width||parseFloat(e[o].Frame._width)+parseFloat(e[o].Frame._xOffset)<t.product.activeData.height)&&(t.product.activeData.constrained=!0,t.product.activeData.safeTop=parseFloat(e[o].Frame._xOffset),t.product.activeData.safeLeft=parseFloat(e[o].Frame._yOffset)/2+parseFloat(e[o].Frame._xOffset)/2,t.product.activeData.safeRight=parseFloat(e[o].Frame._yOffset)/2+parseFloat(e[o].Frame._xOffset)/2+parseFloat(e[o].Frame._height)-t.product.activeData.width,t.product.activeData.safeBottom=parseFloat(e[o].Frame._xOffset)+parseFloat(e[o].Frame._width)-t.product.activeData.height),null;if("graphic"==e._type&&t.utils.ObjectUtil.notUndefined(e.ObjectBlock))return new t.controls.Graphic(e);if("graphic"==e._type&&t.utils.ObjectUtil.notUndefined(e.VectorBlock))return new t.controls.Image(e,i);if("pathText"==e._type&&t.utils.ObjectUtil.notUndefined(e.PathTextBlock))return t.log("Path Text++++++++++++++++++++++++++++++++++++++++++++++++++++++++++"),t.log(e),new t.controls.PathText(e,i);if("dieCut"==e._type&&t.utils.ObjectUtil.notUndefined(e.ObjectBlock))return new t.controls.DieCut(e);if(t.controls.ComponentFactory.isPeep(e))return new t.controls.Peep(e,i);if("liveArea"==e._type)return new t.controls.LiveArea(e,i);if("image"==e._type){t.imageManager.incrementImageCount();var n=new t.controls.Image(e,i);return n}return"text"==e._type?t.utils.ObjectUtil.isEmpty(e._defaultText)&&t.utils.ObjectUtil.isEmpty(e.TextBlock._storyId)?null:new t.controls.CompositeText(e,i):null},e.lookupControl=function(e,i){"undefined"==typeof i&&(i=!0);var o=this.lookupControlById(e._id);return!o&&i&&(o=this.create(e,t.product.getActiveLayout())),o},e.lookupControlById=function(e){for(var i,o,n=0;n<t.stage.getNumChildren();n++)if(o=t.stage.getChildAt(n),o.hasOwnProperty("pageItemBlock")&&o.pageItemBlock._id==e){i=o;break}return i},e.createNewText=function(e,i,o){var n=t.$(o);n.css("padding-top","");var s=n.text(),a=n.css("color");a=t.utils.TextUtil.colorToHex(a),t.utils.TextUtil.isColorValid(a)||(a=t.product.getActiveLayout().getDefaultTextColor());var r=n.css("font-size");r.indexOf("px")>0&&(r=r.substring(0,r.indexOf("px"))),r=t.utils.HtmlUtil.descaleValue(r);var l=n.css("font-family"),h=n.attr("data-font-family"),c=n.attr("data-font-style"),d=n.attr("data-para-style");return e.newTextControl(i,s,a,r,l,h,c,d)},e.createDefaultImage=function(i,o,n){var s=t.product.getActiveLayout(),a=s.getDefaultImageItem(),r=Number(a.ObjectBlock.Frame._xOffset);r=Math.abs(r);var l=Number(a.ObjectBlock.Frame._yOffset);return l=Math.abs(l),e.createNewImage(r,l,i,o,n)},e.createNewImage=function(e,i,o,n,s,a,r,l){"undefined"==typeof a&&(a=0),"undefined"==typeof r&&(r=0),"undefined"==typeof l&&(l=!1);var h=t.utils.ImageUtil.createImagePageItem(),c=s.imageId,d=t.utils.ImageUtil.createImageElement(h.RasterBlock.Image,c,e,i,o,n,h.RasterBlock.Frame);h.RasterBlock.Image=d;var p=t.product.getActiveLayout();p.addPageItem(h),p.addImageAsset(s);var u=new t.controls.Image(h,p,l);return u.ugcWidth=a,u.ugcHeight=r,u},e.isPeep=function(e){var i="component"==e._type&&t.utils.ObjectUtil.notUndefined(e.ComponentBlock)&&"Peep"==e._contentType,o="peep"==e._type;return i||o},e}();e.ComponentFactory=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i,o,n){"undefined"==typeof n&&(n=!1),e.call(this,i,t.utils.Constants.TEXT_CONTROL),this.story=null,this.prevStory=null,this.textHeight=0,this.paragraphs=[],this.initalParagraphCount=0,this.lineHeightUpdated=!1,this.requireFontCheck=!1,this.lineHeight=0,this.lineHeightMultiplier=120,this.showOverflowWarning=!1,this.heightConstrained=!1,this.widthConstrained=!1,this.minWidth=10,this.minHeight=5,this.pageItemBlock=i,this.layout=o,this.originalPageItemBlock=t.$.extend(!0,{},this.pageItemBlock),this.requireFontCheck=n,this.content.mask=new createjs.Shape,this.requireFontCheck||(this.requireFontCheck=!o.loaded),this.model={outline:{x:0,y:0,w:this.width,h:this.height},handles:{UL:{x:0,y:0},UM:{x:0,y:0},UR:{x:0,y:0},ML:{x:0,y:0},MR:{x:0,y:0},LL:{x:0,y:0},LM:{x:0,y:0},LR:{x:0,y:0}}},t.fonts.isReady()?this.onReady():(t.events.on(t.events.FONT_MAP_LOADED,this.fontsReady,this),t.events.on(t.events.FONT_SET_LOADED,this.fontsReady,this)),t.product.isSingleColor()&&t.events.on(t.events.SET_COLOR,this.onGlobalColor,this),this.textFrameTemplate=t._.template('<div id="textFrameWrapper">    <div class="overflow-warning" style="display:none">        <i class="sprite-icon_validation"></i>    </div>    <div class="more-text" style="display:none">        <i class="sprite-icon_more_text"></i>    </div>    <div id="textFrame" contenteditable="true" style="overflow:hidden;">    </div></div>')}return __extends(i,e),i.prototype.cleanUpYourMess=function(){t.events.off(t.events.FONT_MAP_LOADED,this.fontsReady,this),t.events.off(t.events.FONT_SET_LOADED,this.fontsReady,this),t.events.off(t.events.SET_COLOR,this.onGlobalColor,this),this.ui.cleanUpYourMess();for(var e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];i.cleanUpYourMess()}this.content.removeAllChildren(),this.removeAllEventListeners()},i.prototype.key=function(e){this.getMovable()&&("UP"==e?this.y=this.y-1:"DOWN"==e?this.y=this.y+1:"LEFT"==e?this.x=this.x-1:"RIGHT"==e&&(this.x=this.x+1),t.updateStage())},i.prototype.showEditor=function(){1==this.editMode&&t.editorManager.showContainer(this)},i.prototype.double=function(t){this.edit_click(t)},i.prototype.fontsReady=function(){t.fonts.isReady()&&(t.events.off(t.events.FONT_MAP_LOADED,this.fontsReady,this),t.events.off(t.events.FONT_SET_LOADED,this.fontsReady,this),this.onReady())},i.prototype.onReady=function(){this.verticalAlign=this.pageItemBlock.TextBlock._verticalAlign;var e=t.utils.ObjectUtil.notUndefined(this.pageItemBlock.TextBlock._storyId);if(e){var i=this.pageItemBlock.TextBlock._storyId;this.story=this.layout.getStory(i),this.orginalStory=t.$.extend(!0,{},this.story)}this.createChildren(),this.onResize(!1),this.requireFontCheck&&this.ui.setOverflow(!1),t.productLoadedFlag||this.fontSizingCheck(),this.isLoaded=!0},i.prototype.resetDefaultText=function(){this.story&&this.layout.removeStory(this.story._id);var t=this.getOriginalPageItemBlock();t._defaultText&&(t._userInteracted=!1),this.reset(this.getOriginalPageItemBlock(),null),this.pageItemBlock.TextBlock&&this.pageItemBlock.TextBlock.TextWraps&&(this.pageItemBlock.TextBlock.TextWraps.Para={})},i.prototype.reset=function(e,i){for(var o=0;o<this.paragraphs.length;o++){var n=this.paragraphs[o];n.cleanUpYourMess()}this.paragraphs=[],this.content.removeAllChildren(),this.layout.replacePageItem(this.pageItemBlock,e),this.pageItemBlock=e,null==i&&null!=this.story&&this.layout.removeStory(this.story._id),this.story=i,null!=i&&this.layout.updateStory(this.story),this.createChildren(),this.onResize(!1),t.events.trigger(t.events.CONTROL_INTERACTED,this.pageItemBlock),t.updateStage()},i.prototype.updateText=function(e,i,o){"undefined"==typeof o&&(o=!1);for(var n=!1,s=0;s<this.paragraphs.length;s++){var a=this.paragraphs[s];if(a.id==e){n=a.updateText(i,o),a.updateAlignment(this.width);var r=t.$("#p"+a.id+" span");if(r.length>0&&t.utils.ObjectUtil.notUndefined(r.eq(0).attr("style")))t.utils.TextUtil.updateStyles(a,r.eq(0));else{var l=t.$("#p"+a.id);l.length>0&&t.utils.ObjectUtil.notUndefined(l.attr("style"))&&t.utils.TextUtil.updateStyles(a,l)}this.currentColor=a.color,(n||a.defaultTextUpdated())&&this.updateUserInteracted()}}return n},i.prototype.setText=function(t,e){"undefined"==typeof e&&(e=!1);var i=this.paragraphs[0],o=i.updateText(t,e);return i.updateAlignment(this.width),o&&this.updateUserInteracted(),o},i.prototype.setQuickText=function(t){for(var e,i=t.split("\n"),o=!1,n=0;n<i.length;n++)e=this.paragraphs[n],e&&e.updateText(i[n])===!0?o=!0:o===!1&&this.paragraphs.length<=n&&this.newDefaultTextControl(i[n]),e.updateAlignment(this.width);return o===!0&&this.updateUserInteracted(),o},i.prototype.removeText=function(t){for(var e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];if(t.id==i.id){this.paragraphs.splice(e,1);break}}t.cleanUpYourMess(),this.content.removeChild(t)},i.prototype.clearAllText=function(){for(var t=0;t<this.paragraphs.length;t++){var e=this.paragraphs[t];this.content.removeChild(e)}this.paragraphs=[]},i.prototype.newTextControl=function(e,i,o,n,s,a,r,l){var h=null;if(t.utils.ObjectUtil.notUndefined(a)&&t.utils.ObjectUtil.notUndefined(r)){var c=t.fonts.getFont(a);if(t.utils.ObjectUtil.notUndefined(a)){var d=c.getVariant(r);t.utils.ObjectUtil.notUndefined(d)&&(h=new t.controls.Text(i,o,n,c,d,this.getRequired(),this.verticalAlign,this.lineHeightMultiplier))}}return null==h&&(h=new t.controls.Text(i,o,this.currentSize,this.currentFont,this.currentVariant,this.getRequired(),this.verticalAlign,this.lineHeightMultiplier)),-1==e?this.paragraphs.push(h):this.paragraphs.splice(e,0,h),h.setParagraphStyle(this.layout.getParagraphyStyle(l)),h.lineHeight=this.lineHeight,this.content.addChild(h),h},i.prototype.newDefaultTextControl=function(e){var i=new t.controls.Text(e,this.currentColor,this.currentSize,this.currentFont,this.currentVariant,this.getRequired(),this.verticalAlign);return this.paragraphs.push(i),i.setParagraphStyle(this.defaultParagraphStyle),i.lineHeight=this.lineHeight,this.content.addChild(i),this.updateUserInteracted(),i},i.prototype.repositionTextElements=function(){this.updateHorizontalAlignment(this.horizontalAlign),this.update(this.width,this.height),this.onResize()
},i.prototype.isValid=function(){this.valid=!0;for(var t=0;t<this.paragraphs.length;t++){var e=this.paragraphs[t];if(!e.isValid()){this.valid=!1;break}}return this.ui.strokeColor=this.valid?this.ui.VALID_LINE_COLOR:this.ui.INVALID_LINE_COLOR,this.ui.render(),this.valid},i.prototype.getHtml=function(){var e=t.$(this.textFrameTemplate({}));e=e.find(".overflow-warning").tooltip({title:t.utils.Constants.TEXT_MASK_WARNING,placement:"top"}).end(),e=e.find(".more-text").tooltip({title:t.utils.Constants.TEXT_MASK_WARNING,placement:"bottom"}).end();var i,o=e.find("#textFrame");o.css("color",this.currentColor),o.css("font-size",t.utils.HtmlUtil.scaleValue(this.currentSize)+"px"),o.css("font-family",this.currentVariant.htmlFontFamily),o.css("text-align",this.horizontalAlign);for(var n=0;n<this.paragraphs.length;n++){var s=this.paragraphs[n],a=s.toHtml();"middle"===this.verticalAlign?0==n?(a.css("line-height",this.scaledHeight()/this.getLineCount()+"px"),a.css("vertical-align","middle")):a.css("line-height",this.lineHeightMultiplier.toString()+"%"):"top"===this.verticalAlign&&(i=t.fonts.getHeightOffset(this.currentFont,Number(this.currentSize),this.verticalAlign),a.css("padding-top",i),a.css("line-height",this.lineHeightMultiplier.toString()+"%")),s.paragraphStyle._tracking&&"0"!==s.paragraphStyle._tracking&&a.css("letter-spacing",parseInt(s.paragraphStyle._tracking)/1e3+"em"),o.append(a)}return o.end()},i.prototype.outline=function(t){if(t){var e=this.model.outline;e.x=0,e.y=0,t.r-t.l>this.minWidth&&(e.w=t.r-t.l),t.b-t.t>this.minHeight&&(e.h=t.b-t.t)}},i.prototype.render=function(){var e,i,o=1/t.stageZoom.scaleX;this.ui.outline.graphics.clear(),e=this.model.outline,i=this.ui,i.outline.graphics.setStrokeStyle(i.strokeSize*o).beginStroke(i.VALID_LINE_COLOR).drawRect(e.x,e.y,e.w,e.h),i=this.ui.resizeHandles;var e=this.model.outline;i.UL.x=e.x,i.UL.y=e.y,i.UM.x=e.w/2,i.UM.y=e.y,i.UR.x=e.w,i.UR.y=e.y,i.ML.x=e.x,i.ML.y=e.h/2,i.MR.x=e.w,i.MR.y=e.h/2,i.LL.x=e.x,i.LL.y=e.h,i.LM.x=e.w/2,i.LM.y=e.h,i.LR.x=e.w,i.LR.y=e.h,t.stageRoot.update()},i.prototype.scale=function(t){t&&this.scale2(t.type,t.w,t.h)},i.prototype.handles=function(t){if(t){var e=this.model.handles;e.UL.x=t.l,e.UL.y=t.t,e.UM.x=t.hc,e.UM.y=t.t,e.UR.x=t.r,e.UR.y=t.t,e.ML.x=t.l,e.ML.y=t.vc,e.MR.x=t.r,e.MR.y=t.vc,e.LL.x=t.l,e.LL.y=t.b,e.LM.x=t.hc,e.LM.y=t.b,e.LR.x=t.r,e.LR.y=t.b}},i.prototype.clean=function(e,i,o){"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=!1),"undefined"==typeof o&&(o=!1),this.ui.update(this.width,this.height),this.selected?(this.ui.toggleButtonVisibility(!0),this.ui.strokeColor=this.ui.VALID_LINE_COLOR,this.ui.render(),this.openContainerEditor()):(this.ui.toggleButtonVisibility(!1),this.ui.strokeColor=this.ui.NO_LINE_COLOR,this.ui.render()),document.body.style.cursor="default",this.requireFontCheck||this.warningCheck(),t.updateStage()},i.prototype.scale2=function(t,e,i){e<this.minWidth&&(e=this.minWidth),i<this.minHeight&&(i=this.minHeight);var o=this.width,n=this.height;this.width=e,this.height=i;var s=Math.cos(this.rotation*Math.PI/180),a=Math.sin(this.rotation*Math.PI/180),r=s*(this.width-o)/2,l=s*(this.height-n)/2,h=a*(this.width-o)/2,c=a*(this.height-n)/2;"UL"==t?(this.x=this.x-r+c,this.y=this.y-l-h):"UM"==t?(this.x=this.x+c,this.y=this.y-l):"UR"==t?(this.x=this.x+c+r,this.y=this.y+h-l):"ML"==t?(this.x=this.x-r,this.y=this.y-h):"MR"==t?(this.x=this.x+r,this.y=this.y+h):"LL"==t?(this.x=this.x-r-c,this.y=this.y+l-h):"LM"==t?(this.x=this.x-c,this.y=this.y+l):"LR"==t&&(this.x=this.x-c+r,this.y=this.y+h+l),this.regX=this.width/2,this.regY=this.height/2,this.ui.update(this.width,this.height),this.onResize()},i.prototype.updateMask=function(){var t=0,e=10,i=30;this.ui.isOverflowVisible()===!0&&(e=0,i=0),this.content.mask=new createjs.Shape,this.content.mask.graphics.clear(),this.content.mask.graphics.beginFill(this.ui.FILL_COLOR).drawRect(-1*t-.5*i,-1*t-e,this.width+2*t+i,this.height+2*t+e)},i.prototype.onResize=function(t){"undefined"==typeof t&&(t=!0),this.textHeight=0;for(var e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];i.y=this.textHeight;var o=this.getTextHeight(i,this.paragraphs.length);this.textHeight+=o,i.setWidth(this.width),"undefined"!=typeof i.repositionTextElements&&i.repositionTextElements(),i.updateAlignment(this.width)}this.updateVerticalAlignment(this.verticalAlign),this.ui.render(),t&&this.warningCheck(),this.updateMask()},i.prototype.onDelete=function(){null!=this.story&&this.layout.removeStory(this.story._id)},i.prototype.fontSizingCheck=function(){if(!t.productLoadedFlag||!t.initialFontsLoaded||this.requireFontCheck){this.requireFontCheck&&(this.requireFontCheck=!1);var e=this.calculateTextHeight(),i=t.fonts.getBottomPaddingOffset(this.currentFont);if(e+i>this.height&&e+i-this.height<12){0==i&&e>Math.round(e)?e+=1:0==i&&(e=Math.round(e));{this.paragraphs[0]}this.update(this.width,e+i),this.updateMask(),this.ui.setOverflow(!1),this.setOverflowWarning(!1)}else if(Math.round(e)+1-this.height<2&&t.fonts.isProblemFont(this.currentFont)){var o=Math.round(this.textHeight)+1;o<this.height&&(o=this.height),this.update(this.width,o),this.updateMask(),this.ui.setOverflow(!1),this.setOverflowWarning(!1)}}},i.prototype.isWarningVisible=function(){return this.ui.isWarningVisible()},i.prototype.warningCheck=function(){var e=!1,i=t.fonts.getHeightOffset(this.currentFont),o=this.calculateTextHeight(),n=3;this.heightConstrained=this.height<o-i,this.widthConstrained=!1;var s=!1;if(this.heightConstrained){e=!0;for(var a=0;a<this.paragraphs.length;a++)var r=this.paragraphs[a]}else{for(var l=0,a=0;a<this.paragraphs.length;a++){var r=this.paragraphs[a];r.isWordWrapped()?(l=0,l=t.$.isFunction(r.getWordWrappedWidth)?r.getWordWrappedWidth():this.paragraphs[a].lineWidth,!s&&this.width<l&&(s=!0)):!this.widthConstrained&&this.width<r.getMeasuredWidth()+n&&(this.widthConstrained=!0)}(this.widthConstrained||s)&&(e=!0)}this.ui.isOverflowVisible();if(this.ui.setOverflow(e),this.setOverflowWarning(e),e){{this.paragraphs[0]}return void(this.warningMessage=t.utils.Constants.TEXT_MASK_WARNING)}if(!t.inPreviewMode&&this.parent&&!t.product.isStamp()){{this.testHandles()}this.ui.isWarningVisible()}},i.prototype.onEditEnd=function(){this.repositionTextElements(),this.isValid(),this.visible=!0,this.selected=!1,this.ui.strokeColor=this.ui.NO_LINE_COLOR,this.ui.toggleButtonVisibility(!1),this.ui.render(),t.updateStage(!0)},i.prototype.openEditor=function(){"edit"==this.getMode()&&(this.editMode=2,this.prevPageItemBlock=t.$.extend(!0,{},this.pageItemBlock),null!=this.story&&(this.prevStory=t.$.extend(!0,{},this.story)),t.editorManager.showText(this))},i.prototype.closeEditor=function(){t.editorManager.text.commit(),this.editMode=1,this.editInProgress=!1,this.prevPageItemBlock=null,this.prevStory=null},i.prototype.getCurrentHorizontalAlign=function(){return this.horizontalAlign},i.prototype.alignText=function(e,i){"horizontal"==e?this.updateHorizontalAlignment(i):"vertical"==e&&this.verticalAlign!=i&&this.updateVerticalAlignment(i),t.updateStage()},i.prototype.onGlobalColor=function(t){this.currentColor=t;for(var e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];i.updateColor(this.currentColor)}},i.prototype.preview=function(){this.toStringDebug(),this.setMode("preview"),this.warningCheck();var e="onlyIfUserInteracted"==this.pageItemBlock._publish&&"false"==this.pageItemBlock._userInteracted;if(e)return this.visible=!1,void t.updateStage();for(var i=!1,o=0;o<this.paragraphs.length;o++){var n=this.paragraphs[o],s=n.hideText();s||(i=!0)}!i||this.showOverflowWarning&&(this.widthConstrained||this.heightConstrained)?(this.visible=!1,t.updateStage()):this.updateMask()},i.prototype.edit=function(){this.setMode("edit"),this.visible=!0,this.warningCheck()},i.prototype.toString=function(){for(var t="CompositeText Instance:"+this.instanceId+", text:\n",e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];t+=i.getText()}return t},i.prototype.toStringDebug=function(){for(var t="CompositeText , text:\n",e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];t+=i.getText()}t+="\n",t+="Control x,y: + "+this.x+"/"+this.y+"\n",t+="Control Height: "+this.height+"\n";var o=this.calculateTextHeight();return t+="Text Height: "+o+"\n",t+="Font Size: "+this.currentSize+"\n"},i.prototype.save=function(){if(this.saveProperties(this.pageItemBlock),this.pageItemBlock.TextBlock._verticalAlign=this.verticalAlign,1!=this.paragraphs.length){var e=this.hideParagraphText();if(null!=this.story||e||(this.story=this.layout.createStory(this.pageItemBlock),this.pageItemBlock.TextBlock._storyId=this.story._id),null!=this.story){var i=t.utils.ObjectUtil.notUndefined(this.story.TextFlow.div)?this.story.TextFlow.div:this.story.TextFlow;i.p=[],this.pageItemBlock.TextBlock.TextWraps={},this.pageItemBlock.TextBlock.TextWraps.Para=[]}for(var o=0;o<this.paragraphs.length;o++){var n=this.paragraphs[o];n.save();var s=n.getStyleName();if(0==o&&(this.pageItemBlock.TextBlock._paraStyle=s),!e&&t.utils.ObjectUtil.notUndefined(i)){i.p.push({_paraStyle:s,_paraStyleGroup:"",span:n.getText()});var a=n.writeLineInfo();this.pageItemBlock.TextBlock.TextWraps.Para.push({Line:a})}}}else{var r=this.paragraphs[0];r.save();var s=r.getStyleName();this.pageItemBlock.TextBlock._paraStyle=s;var l=r.getText();if(!r.hideText()){null==this.story&&(this.story=this.layout.createStory(this.pageItemBlock,l),this.pageItemBlock.TextBlock._storyId=this.story._id);var i=t.utils.ObjectUtil.notUndefined(this.story.TextFlow.div)?this.story.TextFlow.div:this.story.TextFlow;i.p={_paraStyle:s,_paraStyleGroup:"",span:l};var a=r.writeLineInfo();this.pageItemBlock.TextBlock.TextWraps={},this.pageItemBlock.TextBlock.TextWraps.Para={},this.pageItemBlock.TextBlock.TextWraps.Para.Line=a}}},i.prototype.getOriginalPageItemBlock=function(){return this.originalPageItemBlock},i.prototype.getOrginalStory=function(){return this.orginalStory},i.prototype.removeDefaultText=function(e){var i=t.utils.ObjectUtil.notUndefined(this.pageItemBlock._defaultText);i&&e!=this.pageItemBlock._defaultText&&(delete this.pageItemBlock._defaultText,this.pageItemBlock._scriptLabel=t.utils.TextUtil.removeDefaultTextFromScript(this.pageItemBlock._scriptLabel))},i.prototype.hideParagraphText=function(){for(var t=!0,e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];i.hideText()||(t=i.hideText())}return t},i.prototype.createChildren=function(){if(null==this.story){var e=this.pageItemBlock._defaultText?this.pageItemBlock._defaultText:"",i=this.pageItemBlock.TextBlock._paraStyle,o="\\n",n=e.split(o);this.initalParagraphCount=n.length;for(var s=0;s<n.length;s++)this.createTextControl(i,n[s],null);this.pageItemBlock=t.utils.TextUtil.encodeDefaultText(this.pageItemBlock)}else{var a=t.utils.ObjectUtil.notUndefined(this.story.TextFlow.div)?this.story.TextFlow.div:this.story.TextFlow,r=t.utils.JsonUtil.getList(a.p);this.textHeight=0;var l=t.utils.ObjectUtil.notUndefined(this.pageItemBlock._defaultText);l&&(this.pageItemBlock=t.utils.TextUtil.encodeDefaultText(this.pageItemBlock)),this.valid=!this.getRequired()||!l,this.initalParagraphCount=r.length;for(var s=0;s<r.length;s++){var h=r[s],i=h._paraStyle;if(r[s].span&&r[s].span.hasOwnProperty("br")&&r[s].span.content){var c=t.$.extend(!0,{},h);delete c.content;for(var d=0;d<r[s].span.content.length;d++)c.span=r[s].span.content[d],this.createTextControl(i,null,c)}else this.createTextControl(i,null,h)}}this.verticalAlign=t.fonts.getVerticalAlignment(this.currentFont,this.verticalAlign),this.updateVerticalAlignment(this.verticalAlign)},i.prototype.createTextControl=function(e,i,o){"undefined"==typeof i&&(i=null),"undefined"==typeof o&&(o=null);var n=null;t.utils.ObjectUtil.isUndefined(e)&&null!=o?n={_color:o._color,_fontId:o._fontFamily,_fontSize:o._fontSize,_textAlign:o._textAlign,_tracking:"0"}:(n=this.layout.getParagraphyStyle(e),this.lineHeight=Number(n._lineHeight)),null!=o&&t.utils.ObjectUtil.notUndefined(o.span)&&t.utils.TextUtil.hasInlineStyles(o)&&(n=t.utils.TextUtil.getInlineStyles(n,o),this.lineHeight=Number(n._lineHeight),this.pageItemBlock.TextBlock._paraStyle=n._name),this.defaultParagraphStyle=n;var s=n._color;!t.utils.TextUtil.isColorValid(s);var a=n._fontSize;this.currentSize=a;var r=this.layout.getFontFamily(n._fontId);this.currentFont=t.fonts.getFont(r);var l=null;t.utils.ObjectUtil.isUndefined(this.currentFont)?(n._fontId="times_nr_mt_std",r="Times NR MT Std",this.currentFont=t.fonts.getFont(r),l="Regular"):l=this.layout.getFontStyle(n._fontId),this.currentVariant=this.currentFont.getVariant(l),this.currentColor=s,t.product.isSingleColor()&&(null==t.globalColor?t.globalColor=this.currentColor:this.currentColor=t.globalColor);var h=null,c=this.verticalAlign;if("middle"===this.verticalAlign&&this.initalParagraphCount>1&&(c="top"),null!=i){var d=t.utils.HtmlUtil.decode(i);h=new t.controls.Text(d,this.currentColor,a,this.currentFont,this.currentVariant,this.getRequired(),c,this.lineHeightMultiplier),h.setDefaultText(d)}else if(t.utils.ObjectUtil.notUndefined(o.span.br)||t.utils.ObjectUtil.isString(o.span)&&o.span.indexOf("<br/>")>-1)h=new t.controls.Paragraph(o,this.width,this.currentColor,a,this.currentFont,this.currentVariant,this.getRequired());else{var p=t.utils.HtmlUtil.getText(o);p=t.utils.HtmlUtil.decode(p),h=new t.controls.Text(p,this.currentColor,a,this.currentFont,this.currentVariant,this.getRequired(),c,this.lineHeightMultiplier)}h.setParagraphStyle(n),h.setAlignment(null!=o&&t.utils.ObjectUtil.notUndefined(o._textAlign)?o._textAlign:n._textAlign),h.x=0,h.y=this.textHeight,h.setWidth(this.width),h.lineHeight=this.lineHeight,this.lineHeightMultiplier=Math.round(this.lineHeight/Number(this.currentSize)*100);try{h.updateLineHeight(this.lineHeightMultiplier)}catch(t){}this.paragraphs.push(h),this.content.addChild(h),h.updateVariant(),this.textHeight+=this.getTextHeight(h,this.initalParagraphCount),this.horizontalAlign=h.getAlignment()},i.prototype.getTextHeight=function(t){if("bbox.controls.Paragraph"==t.type){var e=t.getMeasuredHeight();return e}var i=t.getTextLineHeight(this.lineHeightMultiplier);return i},i.prototype.updateHorizontalAlignment=function(t){this.horizontalAlign=t;for(var e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];i.setAlignment(t),i.updateAlignment(this.width)}},i.prototype.calculateTextHeight=function(){for(var t=0,e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];t+=1==i.getLineCount()?i.lineHeight:i.getMeasuredHeight()}return t},i.prototype.updateVerticalAlignment=function(t){this.verticalAlign=t;var e,i=this.getInitalYValue(this.verticalAlign);if(this.content.y=i,"middle"===this.verticalAlign)if(this.getLineCount()<=1&&1==this.content.children.length)e=this.content.children[0],e.textBaseline="middle";else if(this.getLineCount()>1&&this.content.children&&this.content.children.length>1)for(var o=0;o<this.content.children.length;o++)e=this.content.children[o],e.textBaseline="top"},i.prototype.getInitalYValue=function(e){var i=Number(this.currentSize),o=t.fonts.getHeightOffset(this.currentFont,i,this.verticalAlign),n=o;if("middle"===e){var s=this.getLineCount();if(1===s)n+=this.height/2;else{o=t.fonts.getHeightOffset(this.currentFont,i,"top");var a=0;a=this.lineHeightMultiplier>100?(this.lineHeightMultiplier-100)/100*i*-1:(100-this.lineHeightMultiplier)/100*i*-1/Math.sqrt(100-this.lineHeightMultiplier),n=(this.height-(this.textHeight+a))/2,n+=o}}else"bottom"===e&&this.height>this.textHeight&&(n=this.height-this.textHeight-2);return n},i.prototype.scaledHeight=function(){var e=t.utils.HtmlUtil.getDomCompliantValue(this.height),i=t.stageZoom.scaleX;return t.utils.HtmlUtil.getDomCompliantValue(e*i)},i.prototype.scaledWidth=function(){return t.utils.HtmlUtil.getDomCompliantValue(this.width*t.stageZoom.scaleX)},i.prototype.updateLineHeight=function(e){this.lineHeightMultiplier=e,this.lineHeight=Number(this.currentSize)*(e/100);for(var i=0;i<this.paragraphs.length;i++){var o=this.paragraphs[i];o.updateLineHeight(this.lineHeightMultiplier)}t.updateStage(),this.lineHeightUpdated=!0},i.prototype.isFontSizeEnabled=function(){return this.getRotatable()},i.prototype.setCurrentFont=function(t){this.currentFont=t;for(var e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];i.updateFont(t)}},i.prototype.setCurrentFontVariant=function(t){this.currentVariant=t},i.prototype.setCurrentFontColor=function(e){this.currentColor=e;for(var i=0;i<this.paragraphs.length;i++){var o=this.paragraphs[i];o.updateColor(e),t.product.isSingleColor()||o.setNewStyleFlag()}},i.prototype.setCurrentFontSize=function(t){this.currentSize=t,this.lineHeightUpdated=!0,this.recalculateLineHeight();for(var e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];i.lineHeight=this.lineHeight,i.updateFontSize(Number(t)),i.setNewStyleFlag()}},i.prototype.recalculateLineHeight=function(){if(this.lineHeightUpdated){var t=Number(this.currentSize);this.lineHeight=t*(this.lineHeightMultiplier/100)}},i.prototype.shouldShowOverflowWarning=function(){return this.showOverflowWarning&&(this.warningMessage=t.utils.Constants.TEXT_MASK_WARNING),this.showOverflowWarning},i.prototype.setOverflowWarning=function(t){this.showOverflowWarning=t},i.prototype.getLineCount=function(){for(var t=0,e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e];t+=i.getLineCount()}return t},i.prototype.restoreHistoryTransactionState=function(t){e.prototype.restoreHistoryTransactionState.call(this,t),this.width=this.model.outline.w=t.originalW,this.height=this.model.outline.h=t.originalH,this.regX=this.width/2,this.regY=this.height/2,this.render(),this.clean(),this.onResize(!0)},i}(t.controls.BaseControl);e.CompositeText=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(t){function e(e){t.call(this),this.control=e}return __extends(e,t),e}(createjs.Container);t.ControlContent=e}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){e.call(this),this.side=8,this.hitAreaSide=8,this.hitAreaSideMobile=16,this.strokeSize=1,this.dashLength=7,this.offset=4,this.requiredOutlineOffset=2,this.INVALID_LINE_COLOR="#FF0000",this.VALID_LINE_COLOR=t.utils.Constants.VALID_LINE_COLOR,this.WHITE_LINE_COLOR="#555",this.FILL_COLOR="#FFF",this.MASK_COLOR="#000",this.NO_LINE_COLOR=createjs.Graphics.getRGB(0,.01),this.strokeColor=createjs.Graphics.getRGB(0,.01),this.resizeHandles={},this.editSize=53,this.instanceId=t.managers.InstanceManager.create(this),this.control=i,this.width=i.width,this.height=i.height,this.outline=new createjs.Shape,this.addChild(this.outline),this.outline.addEventListener("mouseover",t._.bind(this.control.outline_mouseover,this.control)),this.outline.addEventListener("mouseout",t._.bind(this.control.outline_mouseout,this.control)),this.outline.addEventListener("mousedown",t._.bind(this.control.outline_mousedown,this.control)),this.outline.addEventListener("mouseup",t._.bind(this.control.outline_mouseup,this.control)),this.outline.addEventListener("pressmove",t._.bind(this.control.outline_pressmove,this.control)),this.outline.addEventListener("pressup",t._.bind(this.control.outline_pressup,this.control)),this.outline.addEventListener("dblclick",t._.bind(this.control.outline_double,this.control)),this.requireOutline=new createjs.Shape,this.addChild(this.requireOutline),this.edit=t.service.spriteService.getBitmap(i.type===t.utils.Constants.TEXT_CONTROL?t.model.SpriteType.DONUT_ICON_TEXT:t.model.SpriteType.DONUT_ICON_IMAGE),this.edit.addEventListener("mousedown",t.block),this.edit.addEventListener("pressup",t.block),this.edit.addEventListener("click",t._.bind(this.control.edit_click,this.control)),this.edit.visible=!1,this.edit.regX=25,this.edit.regY=25;var o=new createjs.Shape;o.graphics.beginFill(this.MASK_COLOR).drawCircle(24.5,24.5,24.5),this.edit.hitArea=o,this.warning=t.service.spriteService.getBitmap(t.model.SpriteType.ICON_VALIDATION),this.warning.visible=!1,this.warning.addEventListener("mouseover",t._.bind(this.control.warning_mouseover,this.control)),this.warning.addEventListener("mouseout",t._.bind(this.control.warning_mouseout,this.control)),this.warning.addEventListener("mousedown",t._.bind(this.control.warning_mouseover,this.control)),this.addChild(this.warning),this.warningDPI=t.service.spriteService.getBitmap(t.model.SpriteType.ICON_WARNING_LOW_DPI),this.warningDPI.visible=!1,this.warningDPI.addEventListener("mouseover",t._.bind(this.control.warning_mouseover,this.control)),this.warningDPI.addEventListener("mouseout",t._.bind(this.control.warning_mouseout,this.control)),this.warningDPI.addEventListener("mousedown",t._.bind(this.control.warning_mouseover,this.control)),this.addChild(this.warningDPI);var n=1/t.stageZoom.scaleX;this.rotate=t.service.spriteService.getBitmap(t.model.SpriteType.ICON_ROTATE_NEW),this.rotate.visible=!1,this.rotate.regX=17.5,this.rotate.regY=17.5,this.rotate.x=this.width/2+this.offsetX,this.rotate.y=this.control.rotation>270||this.control.rotation<90?-this.rotate.regY*n-2:this.height+this.rotate.regY*n+2,this.rotate.addEventListener("mousedown",t._.bind(this.control.rotate_mousedown,this.control)),this.rotate.addEventListener("pressmove",t._.bind(this.control.rotate_pressmove,this.control)),this.rotate.addEventListener("pressup",t._.bind(this.control.rotate_pressup,this.control)),this.rotate.addEventListener("click",t._.bind(this.control.rotate_click,this.control)),this.loading=t.service.spriteService.getBitmap(t.model.SpriteType.ICON_LOADING),this.loading.regX=24,this.loading.regY=24,this.loading.scaleX=this.loading.scaleY=.5,this.loading.visible=!1,this.addChild(this.loading),this.overflow=t.service.spriteService.getBitmap(t.model.SpriteType.ICON_MORE_TEXT),this.overflow.visible=!1,this.overflow.regX=24,this.overflow.regY=24,this.overflow.addEventListener("mouseover",t._.bind(this.control.warning_mouseover,this.control)),this.overflow.addEventListener("mouseout",t._.bind(this.control.warning_mouseout,this.control)),this.overflow.addEventListener("mousedown",t._.bind(this.control.warning_mouseover,this.control)),this.addChild(this.overflow),this.createHandle("UL"),this.createHandle("UM"),this.createHandle("UR"),this.createHandle("ML"),this.createHandle("MR"),this.createHandle("LL"),this.createHandle("LM"),this.createHandle("LR"),this.addChild(this.rotate),this.addChild(this.edit),this.update(this.control.width,this.control.height)}return __extends(i,e),i.prototype.cleanUpYourMess=function(){this.outline.removeAllEventListeners(),this.edit.removeAllEventListeners(),this.warning.removeAllEventListeners(),this.warningDPI.removeAllEventListeners(),this.rotate.removeAllEventListeners(),this.loading.removeAllEventListeners(),this.overflow.removeAllEventListeners(),this.resizeHandles.UL.removeAllEventListeners(),this.resizeHandles.UM.removeAllEventListeners(),this.resizeHandles.UR.removeAllEventListeners(),this.resizeHandles.ML.removeAllEventListeners(),this.resizeHandles.MR.removeAllEventListeners(),this.resizeHandles.LL.removeAllEventListeners(),this.resizeHandles.LM.removeAllEventListeners(),this.resizeHandles.LR.removeAllEventListeners(),this.removeAllEventListeners()},i.prototype.setRotationPosition=function(){var e=1/t.stageZoom.scaleX,i=22*e,o=0;this.control.parent&&(o=this.height+i,this.control.y-o<-5&&(o=t.product.activeData.height+1),this.rotate.y=o>t.product.activeData.height?this.height+i:-i)},i.prototype.setEditFrame=function(e){this.edit.image=t.service.spriteService.getBitmap(e).image},i.prototype.update=function(t,e,i,o){"undefined"==typeof i&&(i=0),"undefined"==typeof o&&(o=0),this.width=t,this.height=e,this.offsetX=i,this.offsetY=o,this.rotate.x=this.width/2+this.offsetX,this.render()},i.prototype.render=function(){this.outline.graphics.clear(),this.requireOutline.graphics.clear();var e=1/t.stageZoom.scaleX;if(t.inPreviewMode?(this.drawOutlineGraphics(e,this.NO_LINE_COLOR),this.toggleHandleVisibility(!1)):this.control.getSelectable()?this.control.dragging?(this.drawOutlineGraphics(e,this.VALID_LINE_COLOR),this.toggleHandleVisibility(!0)):this.control.selected?(this.drawOutlineGraphics(e,this.VALID_LINE_COLOR),this.toggleHandleVisibility(!0)):(this.drawOutlineGraphics(e,this.strokeColor),this.toggleHandleVisibility(this.strokeColor==this.NO_LINE_COLOR?!1:!0)):(this.drawOutlineGraphics(e,this.NO_LINE_COLOR),this.toggleHandleVisibility(!1)),this.control.getMovable()||this.control.getSelectable()){var i=new createjs.Shape,o=this.side*e;i.graphics.beginFill(this.MASK_COLOR).drawRect(-o+this.offsetX,-o+this.offsetY,this.width+o+o,this.height+o+o),this.outline.hitArea=i}else this.outline.visible=!1;this.control.isRotatable()&&(this.rotate.x=this.width/2+this.offsetX,this.rotate.scaleX=this.rotate.scaleY=e),this.loading.x=this.width/2+this.offsetX,this.loading.y=this.height/2+this.offsetY,this.warning.x=2+this.offsetX,this.warning.y=2+this.offsetY,this.warning.scaleX=this.warning.scaleY=e,this.warningDPI.x=2+this.offsetX,this.warningDPI.y=2+this.offsetY,this.warningDPI.scaleX=this.warningDPI.scaleY=e,this.overflow.x=this.width,this.overflow.y=this.height,this.overflow.scaleX=this.overflow.scaleY=e,"bbox.controls.BackgroundImage"==this.control.type&&(this.warningDPI.x=5+this.offsetX,this.warningDPI.y=5+this.offsetY),this.edit.x=this.width/2+this.offsetX,this.edit.y=this.height/2+this.offsetY,this.edit.scaleX=this.edit.scaleY=e,"bbox.controls.BackgroundImage"==this.control.type&&(this.edit.visible=!1),this.resizeHandles.UL.x=0+this.offsetX,this.resizeHandles.UL.y=0+this.offsetY,this.resizeHandles.UL.scaleX=this.resizeHandles.UL.scaleY=e,this.resizeHandles.UM.x=this.width/2+this.offsetX,this.resizeHandles.UM.y=0+this.offsetY,this.resizeHandles.UM.scaleX=this.resizeHandles.UM.scaleY=e,this.resizeHandles.UR.x=this.width+this.offsetX,this.resizeHandles.UR.y=0+this.offsetY,this.resizeHandles.UR.scaleX=this.resizeHandles.UR.scaleY=e,this.resizeHandles.ML.x=0+this.offsetX,this.resizeHandles.ML.y=this.height/2+this.offsetY,this.resizeHandles.ML.scaleX=this.resizeHandles.ML.scaleY=e,this.resizeHandles.MR.x=this.width+this.offsetX,this.resizeHandles.MR.y=this.height/2+this.offsetY,this.resizeHandles.MR.scaleX=this.resizeHandles.MR.scaleY=e,this.resizeHandles.LL.x=0+this.offsetX,this.resizeHandles.LL.y=this.height+this.offsetY,this.resizeHandles.LL.scaleX=this.resizeHandles.LL.scaleY=e,this.resizeHandles.LM.x=this.width/2+this.offsetX,this.resizeHandles.LM.y=this.height+this.offsetY,this.resizeHandles.LM.scaleX=this.resizeHandles.LM.scaleY=e,this.resizeHandles.LR.x=this.width+this.offsetX,this.resizeHandles.LR.y=this.height+this.offsetY,this.resizeHandles.LR.scaleX=this.resizeHandles.LR.scaleY=e,this.setRotationPosition()},i.prototype.getValidBounds=function(){var e=t.product.activeData,i=this.localToLocal(0,0,this.control.parent);i.x=Math.ceil(i.x),i.y=Math.floor(i.y);var o=this.requiredOutlineOffset,n={x:o,y:o,width:Math.floor(this.width-2*o),height:Math.floor(this.height-2*o)};return i.x<0&&(n.x=Math.abs(i.x)+o,n.width-=Math.abs(i.x)),i.y<0&&(n.y=Math.abs(i.y)+o,n.height-=Math.abs(i.y)),i=this.localToLocal(n.x,n.y,this.control.parent),i.x=Math.ceil(i.x),i.y=Math.floor(i.y),i.x+n.width>e.width&&(n.width=e.width-i.x-o),i.y+n.height>e.height&&(n.height=e.height-i.y-o),n},i.prototype.drawRequiredOutline=function(t,e){if("undefined"==typeof e&&(e=this.INVALID_LINE_COLOR),this.control.parent){var i=this.getValidBounds();this.requireOutline.graphics.setStrokeStyle(this.strokeSize*t).beginStroke(e).drawDashedRect(i.x,i.y,i.width,i.height,2*t)}},i.prototype.drawDebugOutline=function(){var e=1/t.stageZoom.scaleX,i=this.getValidBounds(),o=new createjs.Shape,n=this.localToLocal(i.x,i.y,t.stageRoot);t.stageRoot.addChild(o),o.graphics.setStrokeStyle(this.strokeSize*e).beginStroke("#FF9900").drawDashedRect(n.x,n.y,i.width,i.height,2*e),o.visible=!0},i.prototype.drawOutlineGraphics=function(e,i){var o=this.strokeSize*e;this.outline.graphics.setStrokeStyle(o).beginStroke(i).drawRect(this.offsetX,this.offsetY,this.width,this.height),this.control.getRequired()&&!this.control.getUserInteracted()?(this.requireOutline.visible=!0,this.drawRequiredOutline(e,this.INVALID_LINE_COLOR)):this.control.getRequired()&&this.control.getUserInteracted()?(this.drawRequiredOutline(e,this.WHITE_LINE_COLOR),this.requireOutline.visible=!1):t.inPreviewMode!==!0&&this.control.getUserInteracted()!==!0&&this.outline.graphics.setStrokeStyle(o).beginStroke(this.WHITE_LINE_COLOR).drawDashedRect(this.offsetX+o,this.offsetY+o,this.width-.3,this.height-.3,2*e)},i.prototype.createHandle=function(e){var i=new createjs.Shape;this.resizeHandles[e]=i,i.visible=!1;var o=-this.side/2,n=-this.side/2;i.graphics.beginFill(this.FILL_COLOR).setStrokeStyle(1).beginStroke(this.VALID_LINE_COLOR).drawRect(o,n,this.side,this.side);var s=new createjs.Shape;t.isMobile()?s.graphics.beginFill(this.MASK_COLOR).drawRect(-this.hitAreaSideMobile/2+o,-this.hitAreaSideMobile/2+n,this.side+this.hitAreaSideMobile,this.side+this.hitAreaSideMobile):s.graphics.beginFill(this.MASK_COLOR).drawRect(-this.hitAreaSide/2+o,-this.hitAreaSide/2+n,this.side+this.hitAreaSide,this.side+this.hitAreaSide),i.hitArea=s,this.addChild(i),this.control.bindEventListeners(e,i)},i.prototype.toggleButtonVisibility=function(t,e){"undefined"==typeof e&&(e=1),1==e&&(this.edit.visible=t,!this.control.isRotatable()&&t&&(t=!1),this.rotate.visible=t)},i.prototype.setWarning=function(t){this.warning.visible=t},i.prototype.isWarningVisible=function(){return this.warning.visible},i.prototype.setOverflow=function(t){this.overflow.visible=t,this.warning.visible=t},i.prototype.isOverflowVisible=function(){return this.overflow.visible},i.prototype.setWarningDPI=function(t){this.warningDPI.visible=t},i.prototype.isWarningDPIVisible=function(){return this.warningDPI.visible},i.prototype.hideEditButton=function(){this.edit.visible=!1},i.prototype.showEditButton=function(){this.edit.visible=!0},i.prototype.setButtonRotation=function(t){this.edit.rotation=t},i.prototype.toggleHandleVisibility=function(t){t&&!this.control.isScalable()&&(t=!1),this.resizeHandles.UL.visible=t,this.resizeHandles.UM.visible=t,this.resizeHandles.UR.visible=t,this.resizeHandles.ML.visible=t,this.resizeHandles.MR.visible=t,this.resizeHandles.LL.visible=t,this.resizeHandles.LM.visible=t,this.resizeHandles.LR.visible=t},i}(createjs.Container);e.ControlUI=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){e.call(this),this.story=null,this.lineHeight=0,this.isLoaded=!1,this.selected=!1,this.selectedStyle="1px solid "+t.utils.Constants.VALID_LINE_COLOR,this._mode="edit",this.pageItemBlock=i,this.x=Number(i.TextBlock.Frame._xOffset),this.y=Number(i.TextBlock.Frame._yOffset),this.width=Number(i.TextBlock.Frame._width),this.height=Number(i.TextBlock.Frame._height),this.instanceId=t.managers.InstanceManager.create(this),this.copyable="true"==i._copyable,this.deletable="true"==i._deletable,this.flippable="true"==i._flippable,this.movable="true"==i._movable,this.rotatable="true"==i._rotatable,this.scalable="true"==i._scalable,this.selectable="true"==i._selectable,this.required="true"==i._required,this.setElement(t.$("#canvas"),!0);var o='<div id="textControl<%= textId %>" style="position: relative;">    <img id="textEditButton<%= textId %>" style="position:absolute;"/></div>';this.controlTemplate=t._.template(o),t._.bindAll(this,"render"),this.render(),this.isLoaded=!0}return __extends(i,e),i.prototype.cleanUpYourMess=function(){this.pageItemBlock=null,this.story=null},i.prototype.render=function(){var e={textId:this.instanceId};this.html=t.$(this.controlTemplate(e)),t.$("#canvas").append(this.html),this.html.css("position","absolute");var i=Math.round(this.x),o=Math.round(this.y),n=t.stage.localToGlobal(i,o);this.globalX=Math.round(n.x),this.globalY=Math.round(n.y),this.html.css("left",this.globalX),this.html.css("top",this.globalY),this.html.css("width",this.scaledWidth()),this.html.css("height",this.scaledHeight()),t.$("#textEditButton"+this.instanceId).click(t._.bind(this.onEditClick,this)),this.addEventListeners();
var s=this.html.offset();this.canvasX=Math.round(s.left)-this.globalX,this.canvasY=Math.round(s.top)-this.globalY;var a=t.utils.ObjectUtil.notUndefined(this.pageItemBlock.TextBlock._storyId);if(a){var r=this.pageItemBlock.TextBlock._storyId;this.story=t.product.getActiveLayout().getStory(r)}return this.createChildren(),t.$("#textEditButton"+this.instanceId).attr("src",t.config.donutIcon()),t.$("#textEditButton"+this.instanceId).hide(),this},i.prototype.addEventListeners=function(){this.html.mousedown(t._.bind(this.onMouseDown,this)),this.html.mouseover(t._.bind(this.onMouseOver,this)),this.html.mouseout(t._.bind(this.onMouseOut,this))},i.prototype.createChildren=function(){if(null==this.story)for(var e=this.pageItemBlock._defaultText,i=this.pageItemBlock.TextBlock._paraStyle,o="\\n",n=e.split(o),s=0;s<n.length;s++)this.createTextControl(i,n[s],null);else{var a=t.utils.ObjectUtil.notUndefined(this.story.TextFlow.div)?this.story.TextFlow.div:this.story.TextFlow,r=t.utils.JsonUtil.getList(a.p);this.textHeight=0;for(var s=(t.utils.ObjectUtil.notUndefined(this.pageItemBlock._defaultText),0);s<r.length;s++){var l=r[s],i=l._paraStyle;this.createTextControl(i,null,l)}}},i.prototype.createTextControl=function(e,i,o){"undefined"==typeof i&&(i=null),"undefined"==typeof o&&(o=null);var n=t.product.getActiveLayout(),s=null;t.utils.ObjectUtil.isUndefined(e)&&null!=o?s={_color:o._color,_fontId:o._fontFamily,_fontSize:o._fontSize,_textAlign:o._textAlign}:(s=n.getParagraphyStyle(e),this.lineHeight=Number(s._lineHeight)),null!=o&&t.utils.ObjectUtil.notUndefined(o.span)&&t.utils.ObjectUtil.notUndefined(o.span._color)&&(s._color=o.span._color);var a=s._color,r=s._fontSize;this.currentSize=r;var l=n.getFontFamily(s._fontId);this.currentFont=t.fonts.getFont(l);var h=null;t.utils.ObjectUtil.isUndefined(this.currentFont)?(s._fontId="times_nr_mt_std",l="Times NR MT Std",this.currentFont=t.fonts.getFont(l),h="Regular"):h=n.getFontStyle(s._fontId),this.currentVariant=this.currentFont.getVariant(h),this.currentColor=a,t.product.isSingleColor()&&(null==t.globalColor?t.globalColor=this.currentColor:this.currentColor=t.globalColor);var c="left";c=null!=o&&t.utils.ObjectUtil.notUndefined(o._textAlign)?o._textAlign:s._textAlign;var d=new t.model.TextStyle(this.currentColor,r,this.currentVariant.htmlFontFamily,c,this.currentFont,this.currentVariant);if(null!=i)this.defaultText=i,this.textHtml=t.utils.TextUtil.textToHtml(this,this.instanceId,i,d),this.html.append(this.textHtml);else if(t.utils.ObjectUtil.notUndefined(o.span.br))this.textHtml=t.utils.TextUtil.paragraphToHtml(this,this.instanceId,o,d),this.html.append(this.textHtml);else{var p=t.utils.HtmlUtil.getText(o);this.textHtml=t.utils.TextUtil.textToHtml(this,this.instanceId,p,d),this.html.append(this.textHtml)}},i.prototype.onMouseOver=function(){this.selected||this.html.css("text-shadow","0 0 "+this.currentSize+"px #ff0000")},i.prototype.onMouseOut=function(){this.selected||this.html.css("text-shadow","")},i.prototype.onMouseDown=function(e){this.selectable&&"edit"==this.getMode()&&(t.selections.clear(),this.unselectSiblings(),this.html.mousemove(t._.bind(this.onMouseMove,this)),this.html.mouseup(t._.bind(this.onMouseUp,this)),this.outerHeight=this.html.outerHeight(),this.outerWidth=this.html.outerWidth(),this.offsetY=this.html.offset().top+this.outerHeight-e.pageY,this.offsetX=this.html.offset().left+this.outerWidth-e.pageX)},i.prototype.onMouseMove=function(e){var i=Math.round(e.pageX+this.offsetX-this.outerWidth),o=Math.round(e.pageY+this.offsetY-this.outerHeight),n=this.pageToLocal(i,o),s=t.product.getActiveBoundaries();n.x<s.x?i=this.localToPage(s.x,0).x:n.x>s.width-this.width&&(i=this.localToPage(s.width-this.width,0).x),n.y<s.y?o=this.localToPage(0,s.y).y:n.y>s.height-this.height&&(o=this.localToPage(0,s.height-this.height).y),this.html.offset({top:o,left:i})},i.prototype.onMouseUp=function(){this.html.unbind(),this.addEventListeners();var e=this.html.offset();this.globalX=Math.round(e.left)-this.canvasX,this.globalY=Math.round(e.top)-this.canvasY;var i=t.stage.globalToLocal(this.globalX,this.globalY);this.x=Math.round(i.x),this.y=Math.round(i.y),this.select()},i.prototype.onEditClick=function(t){t.preventDefault(),t.stopImmediatePropagation(),"edit"==this.getMode()&&this.html.hide()},i.prototype.move=function(){},i.prototype.resize=function(){},i.prototype.rotate=function(){},i.prototype.getGlobalPoint=function(){return new createjs.Point(this.globalX,this.globalY)},i.prototype.getHtml=function(){var e=t.$("<div id='textFrame' contenteditable='true' style='overflow: hidden;'></div>");return e.append(this.textHtml),e},i.prototype.getJson=function(){for(var e={span:[]},i=t.$("#p"+this.instanceId+" span"),o=0;o<i.length;o++){var n=i.eq(o),s=t.model.TextStyle.toJson(n);e.span.push(s)}return e},i.prototype.setHtml=function(e){t.$("#textControl"+this.instanceId+" p").remove(),this.html.append(e),this.html.show()},i.prototype.getInitalYValue=function(){return 0},i.prototype.alignText=function(){},i.prototype.unselect=function(){this.editor&&this.editor.commit(),this.editor=null,this.html.css("border",""),t.$("#textEditButton"+this.instanceId).hide()},i.prototype.select=function(){this.html.css("text-shadow",""),this.html.css("border",this.selectedStyle);var e=t.$("#textEditButton"+this.instanceId);e.css("top",Math.round(this.scaledHeight()/2-26.5)),e.css("left",Math.round(this.scaledWidth()/2-26.5)),e.show()},i.prototype.getMode=function(){return this._mode},i.prototype.setMode=function(t){this._mode=t},i.prototype.preview=function(){this.setMode("preview")},i.prototype.edit=function(){this.setMode("edit")},i.prototype.isValid=function(){return!0},i.prototype.save=function(){if(this.pageItemBlock.TextBlock.Frame._xOffset=this.x,this.pageItemBlock.TextBlock.Frame._yOffset=this.y,this.pageItemBlock.TextBlock.Frame._width=this.width,this.pageItemBlock.TextBlock.Frame._height=this.height,!this.hideText()){var e=this.getText();null==this.story&&(this.story=t.product.getActiveLayout().createStory(this.pageItemBlock,e),this.pageItemBlock.TextBlock._storyId=this.story._id);var i=t.utils.ObjectUtil.notUndefined(this.story.TextFlow.div)?this.story.TextFlow.div:this.story.TextFlow;i.p=this.getJson()}},i.prototype.unselectSiblings=function(){for(var e=t.stage.getNumChildren();e>0;e--){var i=t.stage.getChildAt(e-1);i!=this&&i.unselect.apply(i)}},i.prototype.hideText=function(){return null!=this.defaultText&&this.defaultText==this.getText()},i.prototype.isVisible=function(){return!0},i.prototype.updateContext=function(){},i.prototype.draw=function(){return!0},i.prototype.getText=function(){return t.$("#p"+this.instanceId).text()},i.prototype.scaledHeight=function(){return Math.round(this.height*t.stageZoom.scaleX)},i.prototype.scaledWidth=function(){return Math.round(this.width*t.stageZoom.scaleX)+10},i.prototype.pageToLocal=function(e,i){return t.stage.globalToLocal(Math.round(e)-this.canvasX,Math.round(i)-this.canvasY)},i.prototype.localToPage=function(e,i){var o=t.stage.localToGlobal(Math.round(e),Math.round(i));return o.x=o.x+this.canvasX,o.y=o.y+this.canvasY,o},i.prototype.removeDefaultText=function(e){var i=t.utils.ObjectUtil.notUndefined(this.pageItemBlock._defaultText);i&&e!=this.pageItemBlock._defaultText&&delete this.pageItemBlock._defaultText},i}(Backbone.View);e.DOMText=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){e.call(this),this.height=0,this.width=0,this._mode="edit",this.type="bbox.controls.DieCut",this.pageItemBlock=i,this.width=Number(this.pageItemBlock.ObjectBlock.Frame._width),this.height=Number(this.pageItemBlock.ObjectBlock.Frame._height),this.color=this.pageItemBlock.ObjectBlock.Frame._borderColor,this.internalGraphic=new createjs.Shape,this.internalGraphic.x=Number(this.pageItemBlock.ObjectBlock.Frame._xOffset),this.internalGraphic.y=Number(this.pageItemBlock.ObjectBlock.Frame._yOffset),this.addChild(this.internalGraphic),this.pageItemBlock.ObjectBlock.Frame.hasOwnProperty("Path")&&(this.pathData=this.pageItemBlock.ObjectBlock.Frame.Path._data),t.stage.mask=this.internalGraphic,t.shadowElement.graphics.clear(),t.shadowElement.graphics.beginFill("#CCC").svgPath(this.pathData),t.shadowElement.x=this.internalGraphic.x,t.shadowElement.y=this.internalGraphic.y,this.render(),t.product.isSingleColor()&&t.events.on(t.events.SET_COLOR,this.onGlobalColor,this)}return __extends(i,e),i.prototype.cleanUpYourMess=function(){t.events.off(t.events.SET_COLOR,this.onGlobalColor,this),this.pageItemBlock=null,this.removeAllEventListeners()},i.prototype.render=function(){this.internalGraphic.graphics.clear(),this.internalGraphic.graphics.setStrokeStyle(1,"round").beginStroke(this.color),this.internalGraphic.graphics.svgPath(this.pathData)},i.prototype.onGlobalColor=function(t){this.color=t,this.render()},i.prototype.getMode=function(){return this._mode},i.prototype.setMode=function(t){this._mode=t},i.prototype.preview=function(){this.setMode("preview")},i.prototype.edit=function(){this.setMode("edit")},i.prototype.isValid=function(){return!0},i.prototype.save=function(){this.pageItemBlock.ObjectBlock.Frame._borderColor=this.color},i.prototype.unselect=function(){},i}(createjs.Container);e.DieCut=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){e.call(this),this._mode="edit",this.target=t.controls.ComponentFactory.lookupControlById(i),this.targetClick=t._.bind(this.target.edit_click,this.target),this.width=85,this.height=27,this.photo=t.service.spriteService.getBitmap(t.model.SpriteType.EDIT_TAB),this.photo.x=0,this.photo.y=0,this.addChild(this.photo),t.stageRoot.addChild(this),t.events.on(t.events.WINDOW_RESIZED,this.render,this),t.events.on(t.events.COMPLETE,this.render,this),this.addEventListener("click",t._.bind(this.onClick,this)),this.addEventListener("mousedown",t.block),this.addEventListener("pressup",t.block)}return __extends(i,e),i.prototype.render=function(){return t.inPreviewMode?void(this.visible=!1):(this.x=t.stageZoom.x+2,this.y=t.stageZoom.y-(this.height+1),this.visible=!0,void t.updateStage())},i.prototype.onClick=function(t){this.targetClick(t)},i.prototype.getMode=function(){return this._mode},i.prototype.setMode=function(t){this._mode=t},i.prototype.preview=function(){this.setMode("preview"),this.visible=!1,t.updateStage()},i.prototype.edit=function(){this.setMode("edit"),this.visible=!0,t.updateStage()},i.prototype.isValid=function(){return!0},i.prototype.save=function(){},i.prototype.toString=function(){return"Edit Tab"},i}(createjs.Container);e.EditTab=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){e.call(this),this.height=0,this.width=0,this.pathCommands=[],this._mode="edit",this.type="bbox.controls.Graphic",this.pageItemBlock=i,this.x=Number(this.pageItemBlock.ObjectBlock.Frame._xOffset),this.y=Number(this.pageItemBlock.ObjectBlock.Frame._yOffset),this.width=Number(this.pageItemBlock.ObjectBlock.Frame._width),this.height=Number(this.pageItemBlock.ObjectBlock.Frame._height),this.color=this.pageItemBlock.ObjectBlock.Frame._borderColor,this.fillColor=this.pageItemBlock.ObjectBlock.Frame._fillColor,this.opacity=Number(this.pageItemBlock.ObjectBlock.Frame._opacity)/100,this.internalGraphic=new createjs.Shape,this.addChild(this.internalGraphic),this.pageItemBlock.ObjectBlock.Frame.hasOwnProperty("Path")&&(this.pathData=this.pageItemBlock.ObjectBlock.Frame.Path._data),this.render(),t.product.isSingleColor()&&t.events.on(t.events.SET_COLOR,this.onGlobalColor,this)}return __extends(i,e),i.prototype.cleanUpYourMess=function(){t.events.off(t.events.SET_COLOR,this.onGlobalColor,this),this.pageItemBlock=null,this.removeAllEventListeners()},i.prototype.render=function(){this.internalGraphic.graphics.clear();var e=1/t.stageZoom.scaleX;this.internalGraphic.graphics.setStrokeStyle(this.height*e).beginStroke(this.color),this.internalGraphic.graphics.beginFill(this.fillColor),this.internalGraphic.graphics.svgPath(this.pathData),this.internalGraphic.graphics.endFill(),this.alpha=this.opacity},i.prototype.onGlobalColor=function(t){this.color=t,this.render()},i.prototype.getMode=function(){return this._mode},i.prototype.setMode=function(t){this._mode=t},i.prototype.preview=function(){this.setMode("preview")},i.prototype.edit=function(){this.setMode("edit")},i.prototype.isValid=function(){return!0},i.prototype.save=function(){this.pageItemBlock.ObjectBlock.Frame._borderColor=this.color},i.prototype.unselect=function(){},i}(createjs.Container);e.Graphic=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){e.call(this),this.type="group",this.width=0,this.height=0,this.lineColor=t.utils.Constants.VALID_LINE_COLOR,this.isLoaded=!0,this.controls=[],this.boundingBox=new createjs.Shape,this.addChild(this.boundingBox),this.addEventListener("mousedown",t._.bind(this.group_mousedown,this)),this.addEventListener("pressmove",t._.bind(this.group_pressmove,this)),this.addEventListener("pressup",t._.bind(this.group_pressup,this))}return __extends(i,e),i.prototype.cleanUpYourMess=function(){for(var t=0;t<this.controls.length;t++){var e=this.controls[t];e.cleanUpYourMess()}this.removeAllEventListeners()},i.prototype.group_mousedown=function(e){e.stopImmediatePropagation(),this.origin=t.stage.globalToLocal(e.stageX,e.stageY),this.origin.x=this.x-this.origin.x,this.origin.y=this.y-this.origin.y,this.origin.productBounds=t.product.getActiveBoundaries(),this.origin.currentW=this.width,this.origin.currentH=this.height,this.historyTransactionUpdate({x:this.x,y:this.y},!1)},i.prototype.group_pressmove=function(e){if(e.stopImmediatePropagation(),null!=this.origin){t.editorManager.visible&&t.editorManager.hideAll();var i=t.stage.globalToLocal(e.stageX,e.stageY),o=i.x+this.origin.x,n=i.y+this.origin.y;o>this.origin.productBounds.x&&o<this.origin.productBounds.width-this.origin.currentW&&(this.x=o),n>this.origin.productBounds.y&&n<this.origin.productBounds.height-this.origin.currentH&&(this.y=n),t.updateStage()}},i.prototype.group_pressup=function(e){this.origin=null,e.stopImmediatePropagation(),t.editorManager.showContainer(this),this.historyTransactionUpdate({x:this.x,y:this.y},!0)},i.prototype.add=function(t){this.controls.push(t)},i.prototype.render=function(){this.clear(),this.updateArea(),this.boundingBox.graphics.clear();var e=1/t.stageZoom.scaleX;this.boundingBox.graphics.setStrokeStyle(1*e).beginStroke(this.lineColor).drawRect(0,0,this.width,this.height),this.updateChildren(),t.editorManager.showContainer(this),t.updateStage()},i.prototype.updateChildren=function(){for(var e=0;e<this.controls.length;e++){var i=this.controls[e];t.stage.removeChild(i);var o=i.x-this.x,n=i.y-this.y;i.x=o,i.y=n,this.addChild(i)}},i.prototype.clear=function(){for(var e=t.stage.getChildIndex(this),i=0;i<this.controls.length;i++){var o=this.controls[i];if(this.getChildIndex(o)>-1&&t.stage.getChildIndex(o)<0){this.removeChild(o),t.stage.addChildAt(o,e+i);var n=o.x+this.x,s=o.y+this.y;o.x=n,o.y=s}}t.editorManager.hideContainer()},i.prototype.unselect=function(){t.selections.clear()},i.prototype.removeChildren=function(){for(var e=t.product.getActiveLayout(),i=0;i<this.controls.length;i++){var o=this.controls[i],n=o.pageItemBlock;e.removePageItem(n),this.removeChild(o)}},i.prototype.updateArea=function(){var t=this.findRectangle();this.x=Math.round(t.x),this.y=Math.round(t.y),this.width=Math.round(t.width)-t.x,this.height=Math.round(t.height)-t.y;var e=new createjs.Shape;e.graphics.beginFill("#000").drawRect(0,0,this.width,this.height),this.hitArea=e},i.prototype.findRectangle=function(){for(var t=new createjs.Rectangle(1e4,1e4,0,0),e=0;e<this.controls.length;e++){var i=this.controls[e];i.x-i.regX<t.x&&(t.x=i.x-i.regX),i.y-i.regY<t.y&&(t.y=i.y-i.regY),i.x-i.regX+i.width>t.width&&(t.width=i.x-i.regX+i.width),i.y-i.regY+i.height>t.height&&(t.height=i.y-i.regY+i.height)}return t},i.prototype.isDeletable=function(){for(var t=0;t<this.controls.length;t++)if(!this.controls[t].isDeletable())return!1;return!0},i.prototype.isImageAlignDisabled=function(){for(var t=0;t<this.controls.length;t++)if(this.controls[t].isImageAlignDisabled())return!0;return!1},i.prototype.isHTextAlignDisabled=function(){for(var t=0;t<this.controls.length;t++)if(this.controls[t].isHTextAlignDisabled())return!0;return!1},i.prototype.isVTextAlignDisabled=function(){for(var t=0;t<this.controls.length;t++)if(this.controls[t].isVTextAlignDisabled())return!0;return!1},i.prototype.updateAlignment=function(e,i){for(var o=[],n=[],s=[],a=(t.product.getActiveBoundaries(),0);a<this.controls.length;a++)s.push(this.controls[a].pageItemBlock),n.push({x:this.controls[a].x,y:this.controls[a].y}),"horizontal"==e?"left"==i?this.controls[a].x=this.controls[a].regX:"right"==i?this.controls[a].x=this.width-this.controls[a].width+this.controls[a].regX:"center"==i&&(this.controls[a].x=this.width/2-this.controls[a].width/2+this.controls[a].regX):"vertical"==e&&("top"==i?this.controls[a].y=this.controls[a].regY:"bottom"==i?this.controls[a].y=this.height-this.controls[a].height+this.controls[a].regY:"middle"==i&&(this.controls[a].y=this.height/2-this.controls[a].height/2+this.controls[a].regY)),o.push({x:this.controls[a].x,y:this.controls[a].y});t.updateStage();var r=new t.actions.ContainerMoveAction(n,o,s,this);t.actionManager.addAction(r)},i.prototype.onDelete=function(){for(var e=t.product.getActiveLayout(),i=[],o=0;o<this.controls.length;o++){var n=this.controls[o].pageItemBlock;t.utils.ObjectUtil.notUndefined(n)&&e.removePageItem(n),i.push(this.controls[o]),this.controls[o].onDelete()}this.removeChildren(),this.controls.length=0},i.prototype.save=function(){for(var t=0;t<this.controls.length;t++)this.controls[t].save()},i.prototype.restoreHistoryTransactionState=function(t){this.x=t.x,this.y=t.y},i.prototype.historyTransactionUpdate=function(e,i){var o=!0;if(this.prevHistoryValue&&this.prevHistoryValue.x===e.x&&this.prevHistoryValue.y===e.y)o=!1;else{if(i===!0){for(var n=[],s=0;s<this.controls.length;s++)n.push(this.controls[s].pageItemBlock);var a=new t.actions.ContainerMoveAction(this.prevHistoryValue,e,n,this);t.actionManager.addAction(a)}this.prevHistoryValue=e}return o},i}(createjs.Container);e.GroupContainer=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){e.call(this),this.height=0,this.width=0,this.pathCommands=[],this._mode="edit",this.type="bbox.controls.ImageMask",this.pageItemBlock=i,this.width=Number(this.pageItemBlock.Frame._width),this.height=Number(this.pageItemBlock.Frame._height),this.color="#FF0000",this.internalGraphic=new createjs.Shape,this.addChild(this.internalGraphic);var o=this.pageItemBlock.Frame.Path._data;this.pathCommands=t.utils.GraphicUtils.parsePathCommands(o),this.render(),t.product.isSingleColor()&&t.events.on(t.events.SET_COLOR,this.onGlobalColor,this)}return __extends(i,e),i.prototype.cleanUpYourMess=function(){this.pageItemBlock=null,t.events.off(t.events.SET_COLOR,this.onGlobalColor,this),this.removeAllEventListeners()},i.prototype.render=function(){this.internalGraphic.graphics.clear();1/t.stageZoom.scaleX;this.internalGraphic.graphics.setStrokeStyle(1,"round").beginStroke(this.color);for(var e=0;e<this.pathCommands.length;e++){var i=this.pathCommands[e];"move"==i.type?this.internalGraphic.graphics.moveTo(i.x,i.y):"line"==i.type?this.internalGraphic.graphics.lineTo(i.x,i.y):"curve"==i.type&&this.internalGraphic.graphics.bezierCurveTo(i.cpx1,i.cpy1,i.cpx2,i.cpy2,i.x,i.y)}},i.prototype.onGlobalColor=function(t){this.color=t,this.render()},i.prototype.getMode=function(){return this._mode},i.prototype.setMode=function(t){this._mode=t},i.prototype.preview=function(){this.setMode("preview")},i.prototype.edit=function(){this.setMode("edit")},i.prototype.isValid=function(){return!0},i.prototype.save=function(){this.pageItemBlock.Frame._borderColor=this.color},i.prototype.unselect=function(){},i}(createjs.Container);e.ImageMask=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i,o){e.call(this),this.type="bbox.controls.LiveArea",this.side=8,this.strokeSize=1,this.dashLength=7,this.offset=4,this.DASH_LINE_COLOR="#CCCCCC",this.LINE_COLOR="#FFFFFF",this._mode="edit",this.mouseEnabled=!1,this.instanceId=t.managers.InstanceManager.create(this),this.pageItemBlock=i,this.layout=o;var n=t.utils.HtmlUtil.getBlockName(i);this.width=parseFloat(this.pageItemBlock[n].Frame._width),this.height=parseFloat(this.pageItemBlock[n].Frame._height),this.xOffset=parseFloat(this.pageItemBlock[n].Frame._xOffset),this.yOffset=parseFloat(this.pageItemBlock[n].Frame._yOffset),0==t.product.activeData.constrained&&(t.product.activeData.safeTop=this.yOffset,t.product.activeData.safeLeft=this.xOffset,t.product.activeData.safeRight=this.width+this.xOffset-t.product.activeData.width,t.product.activeData.safeBottom=this.height+this.yOffset-t.product.activeData.height),this.dashedOutline=new createjs.Shape,this.addChild(this.dashedOutline),this.showOutline(),t.updateStage()}return __extends(i,e),i.prototype.cleanUpYourMess=function(){this.pageItemBlock=null,this.layout=null,this.removeAllEventListeners()},i.prototype.showOutline=function(){this.hideOutline();1/t.stageZoom.scaleX;this.dashedOutline.graphics.clear();var e,i,o,n;e=this.xOffset,i=this.yOffset,o=this.width,n=this.height},i.prototype.hideOutline=function(){this.dashedOutline.graphics.clear()},i.prototype.getMode=function(){return this._mode},i.prototype.setMode=function(t){this._mode=t},i.prototype.preview=function(){this.setMode("preview"),this.hideOutline()},i.prototype.edit=function(){this.setMode("edit"),this.showOutline(),t.updateStage()},i.prototype.isValid=function(){return!0},i.prototype.save=function(){},i.prototype.toString=function(){return"LiveArea Instance:"+this.instanceId},i.prototype.unselect=function(){},i}(createjs.Container);e.LiveArea=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i,o){e.call(this,i,"bbox.controls.Paperstock"),this.pageItemBlock=i,this.layout=o,this.isEmpty=!0,this.container=new createjs.Container,this.container.mask=new createjs.Shape,this.content.addChild(this.container);var n=t.utils.HtmlUtil.getBlockName(i);this.x=Number(i[n].Frame._xOffset),this.y=Number(i[n].Frame._yOffset);var s=t.utils.ImageUtil.getImageUrl(this.pageItemBlock,this.layout);t.utils.ObjectUtil.notUndefined(i[n].Image)&&!t.utils.ObjectUtil.isEmpty(i[n].Image._imageId)?(this.isEmpty=!1,this.imageId=i[n].Image._imageId,this.imageAsset=this.layout.getImageAsset(this.imageId),null==this.imageAsset.url&&(this.imageAsset.url=s),s=this.imageAsset.url):null!=t.app.imageLibrary&&t.app.imageLibrary.hasStockImages()&&null!=t.productOptions&&t.productOptions.hasPaperOptions()?this.imageLibraryLoaded():(t.events.on(t.events.LIBRARY_STOCK_IMAGES_DATA_LOADED,this.imageLibraryLoaded,this),t.events.on(t.events.OPTIONS_LOADED,this.imageLibraryLoaded,this)),this.loadBitmap(s),this.setMode("edit")}return __extends(i,e),i.prototype.cleanUpYourMess=function(){e.prototype.cleanUpYourMess.call(this),t.events.off(t.events.LIBRARY_STOCK_IMAGES_DATA_LOADED,this.imageLibraryLoaded,this),t.events.off(t.events.OPTIONS_LOADED,this.imageLibraryLoaded,this),this.pageItemBlock=null,this.layout=null,this.imageAsset=null,this.removeAllEventListeners()},i.prototype.imageLibraryLoaded=function(){if(null!=t.app.imageLibrary&&t.app.imageLibrary.hasStockImages()&&null!=t.productOptions&&t.productOptions.hasPaperOptions()&&this.isEmpty&&this.isEmpty){this.isEmpty=!1;for(var e=t.productOptions.paperOptions[0].sku,i=t.app.imageLibrary.stockImages.length;i--&&t.app.imageLibrary.stockImages[i]._shortTitle!=e;);var o=t.app.imageLibrary.stockImages[i];this.imageAsset=t.model.ImageAsset.createFromPaperstock(o);var n=t.$.extend(!0,{},this.pageItemBlock.ObjectBlock);delete this.pageItemBlock.ObjectBlock,this.pageItemBlock.RasterBlock=n;var s=this.imageAsset.imageId,a=t.utils.ImageUtil.createImageElement(n.Image,s,this.x,this.y,this.width,this.height,this.pageItemBlock.RasterBlock.Frame);this.pageItemBlock.RasterBlock.Image=a;for(var r=1;r<t.product.layouts.length;r++){var l=t.product.layouts[r],h=l.getPaperstockPageItem();if(null!=h){var c=t.$.extend(!0,{},n),d=t.$.extend(!0,{},this.imageAsset);delete h.ObjectBlock,h.RasterBlock=c;var a=t.utils.ImageUtil.createImageElement(c.Image,s,this.x,this.y,this.width,this.height,h.RasterBlock.Frame);h.RasterBlock.Image=a,l.addImageAsset(d)}}this.loadBitmap(this.imageAsset.url)}},i.prototype.loadBitmap=function(e){"undefined"==typeof e&&(e=null),null!=e?(t.paperStock=e,t.events.trigger(t.events.PAPERSTOCK_CHANGED),this.imageAsset.isLibraryImage=!0,this.isLoaded=!0):t.productLoadedFlag===!0&&t.productOptions&&t.productOptions.hasPaperOptions()===!1&&(this.isLoaded=!0)},i.prototype.preview=function(){this.setMode("preview")},i.prototype.edit=function(){this.setMode("edit")},i.prototype.isValid=function(){return this.valid=!0,this.valid},i.prototype.save=function(){var e=this.pageItemBlock[t.utils.HtmlUtil.getBlockName(this.pageItemBlock)];null!=this.imageAsset&&(e.Image._imageId=this.imageAsset.imageId,this.layout.addImageAsset(this.imageAsset))},i.prototype.toString=function(){return"Paperstock Instance:"+this.instanceId},i.prototype.swapImage=function(e){this.loadBitmap(e.url);var i=this.imageId;this.imageId=e.imageId,this.imageAsset=e,t.events.trigger(t.events.REFRESH_IMAGE_STATE,e.imageId,!1),null!=i&&t.events.trigger(t.events.REFRESH_IMAGE_STATE,i,!0)},i}(t.controls.BaseControl);e.Paperstock=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(t,i,o,n,s,a,r){e.call(this),this.paragraphs=[],this.htmlLineBreak="<br/>",this.pElement=t,this.width=i,this.color=o,this.size=n,this.font=s,this.variant=a,this.required=r,this.type="bbox.controls.Paragraph",this.createChildren()}return __extends(i,e),i.prototype.cleanUpYourMess=function(){for(var t=0;t<this.paragraphs.length;t++)this.paragraphs[t].cleanUpYourMess();this.removeAllEventListeners()},i.prototype.createChildren=function(){var e=[];e=t.utils.ObjectUtil.isString(this.pElement.span)?this.pElement.span.split(this.htmlLineBreak):t.utils.JsonUtil.getList(this.pElement.span.content);var i=this.pElement._paraStyle;this.paragraphStyle=t.product.getActiveLayout().getParagraphyStyle(i),this.lineHeight=Number(this.paragraphStyle._lineHeight);for(var o=0;o<e.length;o++){var n=e[o];n=t.utils.HtmlUtil.decode(n);var s=new t.controls.Text(n,this.color,this.size,this.font,this.variant,this.required);s.lineWidth=this.width,s.setParagraphStyle(this.paragraphStyle);var a="#p"+this.id+"-s"+o;s.setSelector(a),this.paragraphs.push(s),this.addChild(s)}t.updateStage(),this.repositionTextElements()},i.prototype.repositionTextElements=function(){for(var t=0,e=0;e<this.paragraphs.length;e++)this.paragraphs[e].y=t,t+=this.paragraphs[e].getMeasuredHeight(),this.paragraphs.length>1&&e<this.paragraphs.length-1},i.prototype.setSelection=function(){var e="p"+this.id+"-s0";t.utils.HtmlUtil.setSelection(e,this.paragraphs[0].getText())},i.prototype.setParagraphStyle=function(e){this.paragraphStyle=t.$.extend(!0,{},e),this.paragraphStyle._fontSize=this.size,this.paragraphStyle._color=this.color,this.paragraphStyle._fontId=this.variant.fontId},i.prototype.getParagraphStyle=function(){return this.paragraphStyle},i.prototype.getStyleName=function(){return this.paragraphStyle._name},i.prototype.setWidth=function(t){for(var e=0;e<this.paragraphs.length;e++)this.paragraphs[e].lineWidth=t},i.prototype.getMeasuredHeight=function(){for(var t=0,e=0;e<this.paragraphs.length;e++)t+=this.paragraphs[e].getMeasuredHeight(),this.paragraphs.length>1&&e<this.paragraphs.length-1&&(t+=this.lineHeight);return t},i.prototype.getMeasuredLineHeight=function(){return this.paragraphs[0].getMeasuredLineHeight()},i.prototype.getMeasuredWidth=function(){for(var t=0,e=0;e<this.paragraphs.length;e++){var i=this.paragraphs[e].getMeasuredWidth();i>t&&(t=i)}return t},i.prototype.updateText=function(){for(var e=!1,i=0;i<this.paragraphs.length;i++){var o="#p"+this.id+"-s"+i,n=t.$(o).text(),s=this.paragraphs[i].updateText(n);s&&(e=!0)}return t.updateStage(),e},i.prototype.setDefaultText=function(t){for(var e=0;e<this.paragraphs.length;e++)this.paragraphs[e].defaultText=t},i.prototype.updateVariant=function(){for(var t=0;t<this.paragraphs.length;t++)this.paragraphs[t].updateVariant()},i.prototype.toHtml=function(){var e="p"+this.id,i=t.$("<p id='"+e+"'></p>");i.css("color",this.color),i.css("font-size",t.utils.HtmlUtil.scaleValue(this.size)+"px"),i.css("font-family",this.variant.htmlFontFamily),i.css("text-align",this.paragraphStyle._textAlign),i.attr("data-font-family",this.font.fontFamily),i.attr("data-font-style",this.variant.fontStyle),i.attr("data-para-style",this.paragraphStyle._name),i.attr("data-ptype","paragraph");for(var o=0;o<this.paragraphs.length;o++){var n=e+"-s"+o,s=t.$("<span id='"+n+"'>"+this.paragraphs[o].text+"</span>");i.append(s),this.paragraphs.length>1&&o<this.paragraphs.length-1&&i.append(this.htmlLineBreak)}return i},i.prototype.save=function(){for(var t=0;t<this.paragraphs.length;t++)this.paragraphs[t].save()},i.prototype.getText=function(){for(var t=[],e="",i=0;i<this.paragraphs.length;i++)e+=this.paragraphs[i].getText(),t.push(this.paragraphs[i].getText()),this.paragraphs.length>1&&i<this.paragraphs.length-1&&(e+=this.htmlLineBreak);return e},i.prototype.setAlignment=function(t){for(var e=0;e<this.paragraphs.length;e++)this.paragraphs[e].setAlignment(t)},i.prototype.getAlignment=function(){return 0==this.paragraphs.length?"":this.paragraphs[0].getAlignment()},i.prototype.updateAlignment=function(t){for(var e=0;e<this.paragraphs.length;e++)this.paragraphs[e].updateAlignment(t)},i.prototype.isWordWrapped=function(){for(var t=0;t<this.paragraphs.length;t++)if(this.paragraphs[t].isWordWrapped())return!0;return!1},i.prototype.getLineCount=function(){for(var t=0,e=0;e<this.paragraphs.length;e++)t+=this.paragraphs[e].getLineCount();return t},i.prototype.writeLineInfo=function(){for(var t=[],e=1,i=0;i<this.paragraphs.length;i++){var o=this.paragraphs[i].writeLineInfo(e);t=t.concat(o);var n=o[o.length-1];e=n._endAtChar+1}return t},i.prototype.isValid=function(){for(var t=0;t<this.paragraphs.length;t++)if(!this.paragraphs[t].isValid())return!1;return!0},i.prototype.hideText=function(){return!1},i.prototype.defaultTextUpdated=function(){return!0},i.prototype.updateFontSize=function(t){for(var e=0;e<this.paragraphs.length;e++)this.paragraphs[e].updateFontSize(t)},i.prototype.updateFontVariant=function(t){for(var e=0;e<this.paragraphs.length;e++)this.paragraphs[e].updateFontVariant(t)},i.prototype.updateColor=function(t){for(var e=0;e<this.paragraphs.length;e++)this.paragraphs[e].updateColor(t)},i.prototype.updateFont=function(t){for(var e=0;e<this.paragraphs.length;e++)this.paragraphs[e].updateFont(t)},i.prototype.setNewStyleFlag=function(){for(var t=0;t<this.paragraphs.length;t++)this.paragraphs[t].setNewStyleFlag()},i}(createjs.Container);e.Paragraph=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i,o){e.call(this,i,"bbox.controls.PathText"),this.story=null,this.style=null,this.requireFontCheck=!1,t.log("> constructor bbox.controls.PathText"),this.pageItemBlock=i,this.layout=o,this.container=new createjs.Container,t.log(this.pageItemBlock.PathTextBlock.Frame.Path._data),this.points=this.pathToPoints(this.pageItemBlock),this.path=new createjs.Shape,this.path.graphics.setStrokeStyle(1).beginStroke("#FF0000");var n=t.utils.ObjectUtil.notUndefined(this.pageItemBlock.PathTextBlock._storyId);if(n){var s=this.pageItemBlock.PathTextBlock._storyId;
this.story=this.layout.getStory(s),this.orginalStory=t.$.extend(!0,{},this.story),t.log(this.story)}null==this.story?(this.text=this.pageItemBlock._defaultText?this.pageItemBlock._defaultText:"",this.styleName=this.pageItemBlock.PathTextBlock._paraStyle):(this.text=this.story.TextFlow.div.p.span,this.styleName=this.story.TextFlow.div.p._paraStyle);var a=this.story.TextFlow.div.p;t.utils.ObjectUtil.isUndefined(this.styleName)&&null!=this.story.TextFlow.div.p?this.style={_color:a._color,_fontId:a._fontFamily,_fontSize:a._fontSize,_textAlign:a._textAlign}:(this.style=this.layout.getParagraphyStyle(this.styleName),null==this.style&&t.log("can't find paragraph style with name: "+this.styleName),t.log(this.style)),this.currentFont=t.fonts.getFont(this.layout.getFontFamily(this.style._fontId)),t.log(this.currentFont),this.currentVariant=this.currentFont.getVariant(this.layout.getFontStyle(this.style._fontId)),this.requireFontCheck||(this.requireFontCheck=!o.loaded),t.fonts.isReady()?this.onReady():(t.events.on(t.events.FONT_MAP_LOADED,this.fontsReady,this),t.events.on(t.events.FONT_SET_LOADED,this.fontsReady,this)),t.product.isSingleColor()&&t.events.on(t.events.SET_COLOR,this.onGlobalColor,this),t.log("< constructor bbox.controls.PathText")}return __extends(i,e),i.prototype.fontsReady=function(){t.fonts.isReady()&&(t.events.off(t.events.FONT_MAP_LOADED,this.fontsReady,this),t.events.off(t.events.FONT_SET_LOADED,this.fontsReady,this),this.onReady())},i.prototype.onReady=function(){this.createChildren(),!t.productLoadedFlag,this.isLoaded=!0,t.updateStage()},i.prototype.createChildren=function(){if(0==this.currentVariant.isKerningLoaded)this.currentVariant.callbacks.push([this,"createChildren"]);else{t.log(this.currentVariant),t.log(this.text);var e,i,o,n,s,a,r,l=0,h=this.text.split(""),c=parseInt(this.style._fontSize),d=[],p=h.length,u=0;for(a=0;p>a;a++)r=this.currentVariant.getHorizontalShift(h[a],h[a+1],c),d.push(r),u+=r;var g,m=0,f=this.points.length;console.log(f),console.log(u);var v=f/2-u/2;for(console.log(v),l=0;p>l&&(0!=l&&(m+=d[l-1]),g=Math.round(m+v),!(g>=f-1));l++)e=this.points[g],p>l+1?(i=this.points[g+1],s=e[0]>=i[0]?180*Math.atan((e[1]-i[1])/(e[0]-i[0]))/Math.PI+180:180*Math.atan((e[1]-i[1])/(e[0]-i[0]))/Math.PI):(i=this.points[g-1],s=i[0]>=e[0]?180*Math.atan((i[1]-e[1])/(i[0]-e[0]))/Math.PI+180:180*Math.atan((i[1]-e[1])/(i[0]-e[0]))/Math.PI),o=new createjs.Container,n=new createjs.Text(h[l],c.toString()+"px "+this.currentVariant.htmlFontFamily,this.style._color),n.textBaseline="alphabetic",n.x=-(.78*c)/2,n.y=0,o.addChild(n),o.x=e[0],o.y=e[1],o.rotation=s,this.container.addChild(o);this.container.addChild(this.path),this.content.addChild(this.container);var y=this.content.getBounds();this.width=y.width,this.height=y.height,console.log(y),this.ui.update(y.width,y.height,y.x,y.y),this.render()}},i.prototype.cleanUpYourMess=function(){t.log(" > PathText.cleanUpYourMess"),e.prototype.cleanUpYourMess.call(this),this.pageItemBlock=null,this.layout=null,this.removeAllEventListeners(),t.log(" < PathText.cleanUpYourMess")},i.prototype.pathToPoints=function(e){var i=e.PathTextBlock.Frame.Path._data,o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttributeNS(null,"d",i);var n=o.getTotalLength(),s=-1!=i.toLowerCase().indexOf("z"),a=parseFloat(e.PathTextBlock._startBracket),r=parseFloat(e.PathTextBlock._centerBracket),l=parseFloat(e.PathTextBlock._endBracket),h="flipped"==e.PathTextBlock._flipPathEffect;t.log(s),t.log(h),t.log(a),t.log(r),t.log(l);var c,d,p=[];if(s){if(h){for(c=a,p=[];c>=l;){if(c>n){c=0;break}d=o.getPointAtLength(c),p.push([d.x,d.y]),c++}for(;l>c;)d=o.getPointAtLength(c),p.push([d.x,d.y]),c++;return p}for(c=l,p=[];c>=a;){if(c>n){c=0;break}d=o.getPointAtLength(c),p.push([d.x,d.y]),c++}for(;a>c;)d=o.getPointAtLength(c),p.push([d.x,d.y]),c++;return p.reverse(),p}if(h){for(c=a,p=[];c>=l;){if(c>n){c=0;break}d=o.getPointAtLength(c),p.push([d.x,d.y]),c++}for(;l>c;)d=o.getPointAtLength(c),p.push([d.x,d.y]),c++;return p}for(c=a,p=[];l>=c;)d=o.getPointAtLength(c),p.push([d.x,d.y]),c++;return p},i.prototype.preview=function(){this.setMode("preview")},i.prototype.edit=function(){this.setMode("edit")},i.prototype.isValid=function(){return this.valid=!0,this.valid},i.prototype.save=function(){t.log(" > PathText.save")},i.prototype.toString=function(){return"PathText Instance:"+this.instanceId},i}(t.controls.BaseControl);e.PathText=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i,o){var n=t.utils.HtmlUtil.getBlockName(i);"ComponentBlock"==n&&(i.RasterBlock=t.$.extend(!0,{},i.ComponentBlock),delete i.ComponentBlock),i._type="peep",e.call(this,i,o,!1,"bbox.controls.Peep");var s=i[t.utils.HtmlUtil.getBlockName(i)];this.model.container.width=parseFloat(s.Frame._width),this.model.container.height=parseFloat(s.Frame._height),this.setEditFrame(t.model.SpriteType.DONUT_ICON_PEEPS),t.events.on(t.events.PEEPS_UGC_LIST_LOADED,this.onUGCListLoaded,this)}return __extends(i,e),i.prototype.cleanUpYourMess=function(){e.prototype.cleanUpYourMess.call(this),t.events.off(t.events.PEEPS_UGC_LIST_LOADED,this.onUGCListLoaded,this)},i.prototype.setIsEmpty=function(i){e.prototype.setIsEmpty.call(this,i),this.setEditFrame(t.model.SpriteType.DONUT_ICON_PEEPS)},i.prototype.edit_click=function(e){e.stopImmediatePropagation(),this.isLoaded&&(t.utils.ObjectUtil.isUndefined(this.imageAsset)?t.app.userPeepImages.length<t.peepsManager.peepsMaximum?(t.app.views.dialogs.peepsEditor.setEditorMode("create",!1,"SWAP_EMPTY"),t.events.on(t.events.PEEPS_SWAP_PEEP,this.onSwapPeep,this)):t.dialogs.displayDialog("Maximum Peep Families Reached","You have reached the limit of "+t.peepsManager.peepsMaximum+" Peep families. Please remove the appropriate number of Peeps to create additional families."):(t.app.views.dialogs.peepsEditor.setEditorMode("edit",!1,this.imageAsset.fileId,this.imageId),t.events.on(t.events.PEEPS_SWAP_PEEP,this.onSwapPeep,this)))},i.prototype.onSwapPeep=function(e){this.swapImage(e),this.save(),t.updateStage()},i.prototype.afterImageLoaded=function(){e.prototype.afterImageLoaded.call(this),this.zeroImageLocation(!0),this.doCenterInFrame(!this.isEmpty),this.render(),this.save(),t.updateStage(),t.inPreviewMode&&this.unselect()},i.prototype.afterSwapImageOnload=function(e){{var i=this.swapImageData.resetPositioning,o=this.swapImageData.imgAsset;this.swapImageData.previousImageId}if(this.swapImageData=null,this.dirtyCanvas=!0,this.modelXYNaNCheck(),i&&this.doCenterInFrame(!0),this.isEmpty){this.setIsEmpty(!1);var n=o.imageId;this.pageItemBlock.RasterBlock.Image._imageId=n;var s=t.product.getActiveLayout();s.addImageAsset(o),this.updateUserInteracted()}if(this.render(),this.clean(!1,!1),this.save(),e===!1){var a=t._.clone(this.oldModel),r={};this.setPreviousHistoryProperties(r,this.width,this.height);var l=new t.actions.image.ImageSwapAction(a,r,this.pageItemBlock);t.actionManager.addAction(l),this.oldModel=null}this.image.visible=!0,this.isLoaded=!0,this.showLoading(!1),t.inPreviewMode&&this.unselect(),t.events.trigger(t.events.PRODUCT_PERSONALIZED)},i.prototype.removeBitmap=function(e){"undefined"==typeof e&&(e=!0),this.updateUserInteracted(!1),this.edit(),this.setIsEmpty(!0),this.image.uncache(),this.zeroImageLocation(),this.image.image=t.service.spriteService.getBitmap(t.model.SpriteType.PEEPS_CONTAINER),this.originalWidth=this.image.image.width,this.originalHeight=this.image.image.height,this.doCenterInFrame(),this.render(),this.clean(),this.save(),this.image.visible=!0,this.select(),this.imageId=null,this.imageAsset=null},i.prototype.onUGCListLoaded=function(){if(this.imageAsset){var e=t.config.getFile()+this.imageAsset.webFilename;t.cacheManager.removeImage(e),this.loadImage(e)}},i.prototype.shouldShowDPIWarning=function(){return!1},i.prototype.colorizeAvailable=function(){return!1},i}(t.controls.Image);e.Peep=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i,o,n,s,a,r,l,h){"undefined"==typeof l&&(l="top"),"undefined"==typeof h&&(h=120);var c=n+"px "+a.htmlFontFamily;e.call(this,i,c,o),this.instanceId=t.managers.InstanceManager.create(this),this.fontSize=n,this.currentFont=s,this.currentVariant=a,this.isNewStyle=!1,this.required=r,this.defaultText=null,this.fontUpdateInProgress=!1,this.horizontalAlign="left",this.selector="#p"+this.id,this.type="bbox.controls.Text",this.textBaseline=l,this.lineCount=1,this.lineHeightMultiplier=h,t.events.on(t.events.CHECK_FOR_FONT_UPDATE,this.checkFont,this)}return __extends(i,e),i.prototype.cleanUpYourMess=function(){t.events.off(t.events.CHECK_FOR_FONT_UPDATE,this.checkFont,this),t.managers.InstanceManager.destroy(this.instanceId),this.removeAllEventListeners()},i.prototype.setParagraphStyle=function(e){this.paragraphStyle=t.$.extend(!0,{},e),this.paragraphStyle._fontSize=this.fontSize,this.paragraphStyle._color=this.color,this.paragraphStyle._fontId=this.currentVariant.fontId},i.prototype.setSelector=function(t){this.selector=t},i.prototype.getParagraphStyle=function(){return this.paragraphStyle},i.prototype.setNewStyleFlag=function(){this.isNewStyle=!0},i.prototype.getStyleName=function(){return this.paragraphStyle._name},i.prototype.isValid=function(){return this.required&&null!=this.defaultText?this.defaultText!=this.text&&this.text.length>0:!0},i.prototype.hideText=function(){return null!=this.defaultText&&this.defaultText==this.text},i.prototype.defaultTextUpdated=function(){return null!=this.defaultText&&this.defaultText!=this.text},i.prototype.save=function(){var e=t.product.getActiveLayout();e.addFont(this.currentFont),this.lineHeight=this.fontSize*(this.lineHeightMultiplier/100),this.paragraphStyle._lineHeight=this.lineHeight,this.paragraphStyle._textAlign=this.horizontalAlign,this.paragraphStyle=e.updateParagraphStyle(this.paragraphStyle)},i.prototype.isWordWrapped=function(){return this.lineCount>1},i.prototype.getLineCount=function(){return this.lineCount},i.prototype.getTextLineHeight=function(t){var e=this.fontSize*(t/100)*this.getLineCount();return e},i.prototype.updateLineHeight=function(t){this.lineHeightMultiplier=t,this.lineHeight=this.fontSize*(t/100)},i.prototype.getWordWrappedWidth=function(){for(var t=0,e=0;e<this.lineInfo.length;e++)this.lineInfo[e].width>t&&(t=this.lineInfo[e].width);return t},i.prototype.writeLineInfo=function(t){if("undefined"==typeof t&&(t=1),null==this.lineInfo)return[];for(var e=this.lineInfo,i=[],o=0;o<e.length;o++){var n=t+e[o].length,s={_column:"1",_startAtChar:t,_endAtChar:n};i.push(s),t=n+1}return i},i.prototype.updateFontSize=function(e){this.fontSize=e,this.paragraphStyle._fontSize=e,this.font=this.fontSize+"px "+this.currentVariant.htmlFontFamily,t.$(this.selector).css("font-size",t.utils.HtmlUtil.scaleValue(this.fontSize)+"px"),t.updateStage()},i.prototype.updateFontVariant=function(t){this.currentVariant=this.currentFont.getVariantByScreenName(t),this.onFontUpdated(this.currentVariant)},i.prototype.updateText=function(e,i){"undefined"==typeof i&&(i=!1);var o=!1;return i===!0&&this.priorText!==e&&(o=!0,this.priorText=e),this.text=e,t.updateStage(),o},i.prototype.updateColor=function(e){this.color=t.utils.TextUtil.enforceHexLength(e),this.paragraphStyle._color=this.color,t.$(this.selector).css("color",this.color),t.updateStage()},i.prototype.updateFont=function(e){this.currentFont=e,t.$(this.selector).attr("data-font-family",this.currentFont.fontFamily),this.onFontUpdated(this.currentFont.variants[0])},i.prototype.updateVariant=function(){this.onFontUpdated(this.currentVariant)},i.prototype.onFontUpdated=function(e){this.currentVariant=e,this.paragraphStyle._fontId=e.fontId,this.font=this.fontSize+"px "+this.currentVariant.htmlFontFamily,t.$(this.selector).css("font-family",this.currentVariant.htmlFontFamily),t.$(this.selector).attr("data-font-style",this.currentVariant.fontStyle),this.currentWidth=this.getMeasuredWidth(),this.currentHeight=this.getMeasuredHeight(),this.startTime=Date.now(),t.fontLoadingFlag=this.fontUpdateInProgress=!0},i.prototype.checkFont=function(){if(this.fontUpdateInProgress){var e=this.getMeasuredWidth(),i=this.getMeasuredHeight();t.updateStage();var o=Date.now();if(e!=this.currentWidth&&i!=this.currentHeight||o>this.startTime+1500){var n=this.parent;if(t.utils.ObjectUtil.isUndefined(n))return void t.events.off(t.events.CHECK_FOR_FONT_UPDATE,this.checkFont,this);t.utils.ObjectUtil.isUndefined(n.control)&&(n=n.parent),this.updateAlignment(n.control.width),n.control.fontSizingCheck(),n.control.onResize(),n.control.updateVerticalAlignment(n.control.verticalAlign),t.fontLoadingFlag=this.fontUpdateInProgress=!1,t.updateStage()}}},i.prototype.setSelection=function(){var e="p"+this.id;t.utils.HtmlUtil.setSelection(e,this.getText())},i.prototype.setCaret=function(){var e="p"+this.id;t.utils.HtmlUtil.setCaret(e,this.getText())},i.prototype.toHtml=function(){var e=t.$("<div id='p"+this.id+"' class='bboxTextParagraph'></div>");e.css("color",this.color),e.css("font-size",t.utils.HtmlUtil.scaleValue(this.fontSize)+"px"),0==this.currentVariant.htmlFontFamily.indexOf("'")?e.css("font-family",this.currentVariant.htmlFontFamily):e.css("font-family","'"+this.currentVariant.htmlFontFamily+"'"),e.css("text-align",this.horizontalAlign),e.attr("data-font-family",this.currentFont.fontFamily),e.attr("data-font-style",this.currentVariant.fontStyle),e.attr("data-para-style",this.paragraphStyle._name),e.attr("data-ptype","text"),this.text=t.utils.TextUtil.scrubText(this.text),this.priorText=this.text;var i=t.$("<span>"+this.text+"</span>");return null==this.text||0==this.text.length?e.css("height",t.utils.HtmlUtil.scaleValue(this.getMeasuredLineHeight())-1):e.css("margin-bottom",0),e.append(i),e},i.prototype.setDefaultText=function(t){this.defaultText=t},i.prototype.setWidth=function(t){this.lineWidth=t},i.prototype.getText=function(){return this.text},i.prototype.setAlignment=function(t){this.horizontalAlign=t},i.prototype.getAlignment=function(){return this.horizontalAlign},i.prototype.updateAlignment=function(t){this.parentWidth=t},i.prototype._drawText=function(e,i){t.utils.ObjectUtil.isUndefined(i)&&(i={}),this.lineInfo=[];var o=!!e;o||(e=this._prepContext(createjs.Text._workingContext));for(var n=this.lineHeight||this.getMeasuredLineHeight(),s=0,a=0,r=String(this.text).split(/(?:\r\n|\r|\n)/),l=0,h=r.length;h>l;l++){var c=r[l],d=null;if(null!=this.lineWidth&&(d=e.measureText(c).width)>this.lineWidth){var p=c.split(/(\s)/);c=p[0],d=e.measureText(c).width;for(var u=1,g=p.length;g>u;u+=2){var m=e.measureText(p[u]+p[u+1]).width,f=this.currentVariant.getRightShiftPad(e,this.fontSize,this.currentFont.id,p[u],!1);d+=f,d+m>this.lineWidth?(o&&this._drawTextLine(e,c,a*n),d>s&&(s=d),this.lineInfo.push({line:a,length:c.length,width:d}),c=p[u+1],d=e.measureText(c).width,a++):(c+=p[u]+p[u+1],d+=m)}}o&&this._drawTextLine(e,c,a*n),i&&null==d&&(d=e.measureText(c).width),d>s&&(s=d),this.lineInfo.push({line:a,length:c.length,width:d}),a++}return this.lineCount=isNaN(a)?1:a,i&&(i.count=a,i.width=s,i.height=a*n),i},i.prototype._drawTextLine=function(e,i,o){var n=0,s=0;if(this.paragraphStyle._tracking&&(s=parseInt(this.paragraphStyle._tracking,10)),"center"===this.horizontalAlign)n=this.parentWidth/2-e.measureText(i).width/2,n-=(i.length-1)/2*(s/1e3)*this.fontSize;else if("right"===this.horizontalAlign){var a=e.measureText(i.slice(-1)).width;n=this.parentWidth-a}if(null==this.currentVariant||!this.currentVariant.isKerningLoaded)return void e.fillText(i,n,o,this.maxWidth||65535);if("right"!==this.horizontalAlign)for(var r=0;r<i.length;r++){var l=i.charAt(r);e.fillText(l,n,o,this.maxWidth||65535);var h=r+1<i.length?i.charAt(r+1):null,c=this.currentVariant.getHorizontalShift(l,h,this.fontSize,s);isNaN(c)?(n+=e.measureText(l).width+s/1e3*this.fontSize,t.log("Missing Kern Value for "+l)):n+=c}else for(var d=i.length-1;d>=0;d--){var l=i.charAt(d);e.fillText(l,n,o,this.maxWidth||65535);var h=d-1<i.length?i.charAt(d-1):null,c=this.currentVariant.getHorizontalShift(h,l,this.fontSize,s);isNaN(c)?(n-=e.measureText(h).width+s/1e3*this.fontSize,t.log("Missing Kern Value for "+l)):n-=c}},i}(createjs.Text);e.Text=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){e.call(this),this.center=null,this.outlineFill=createjs.Graphics.getRGB(0,.01),this.outlineStroke="#FF0000",this.MAXSIZE=300,this.autoZoomFeature=!1;var i=t.product.getActiveLayout();this.scale=1,i.width>i.height&&i.width>this.MAXSIZE?this.scale=this.MAXSIZE/i.width:i.width<=i.height&&i.height>this.MAXSIZE&&(this.scale=this.MAXSIZE/i.height),this.removeButton=t.service.spriteService.getBitmap(t.model.SpriteType.ICON_REMOVE),this.previewImageData=t.buildNavImage(),this.previewImage=new createjs.Bitmap(this.previewImageData),this.previewImage.y=1,this.previewImage.scaleX=this.previewImage.scaleY=this.scale,t.zoomNav=this,this.zoomView=new createjs.Container,t.events.on(t.events.ZOOM_LEVEL_UPDATE,this.update,this),t.events.on(t.events.ZOOM_LEVEL_UPDATE_SILENT,this.updateSilent,this),t.events.on(t.events.ZOOM_UPDATE_IMAGE,this.updateImage,this),t.events.on(t.events.ZOOM_AUTO_FEATURE,this.onOffAutoZoom,this),t.events.on(t.events.WINDOW_RESIZED,this.onWindowResize,this);var o=t.stageRoot.canvas.width,i=(t.stageRoot.canvas.height,t.product.getActiveLayout());this.zoomView.x=o-i.width*this.scale-14,this.zoomView.y=14;var n=i.width*this.scale,s=i.height*this.scale;this.removeButton.x=n-16,this.removeButton.y=4;var a=new createjs.Shape;a.graphics.beginFill("#000").drawRect(-1,0,n+2,s+2),this.zoomView.addChild(a),this.previewImage.x=0,this.previewImage.y=1,this.zoomView.addChild(this.previewImage),this.zoomDrag=new createjs.Container,this.zoomDrag.x=0,this.zoomDrag.y=0,this.outline=new createjs.Shape,this.drawOutline(),this.zoomDrag.addChild(this.outline),this.zoomView.addChild(this.zoomDrag),this.zoomDrag.addEventListener("mousedown",t._.bind(this.zoom_mousedown,this)),this.zoomDrag.addEventListener("pressmove",t._.bind(this.zoom_pressmove,this)),this.zoomDrag.addEventListener("pressup",t._.bind(this.zoom_pressup,this)),this.zoomDrag.addEventListener("mouseover",t._.bind(this.zoom_mouseover,this)),t.stageRoot.addChild(this.zoomView),this.zoomView.visible=!1,this.removeButton.addEventListener("click",t._.bind(this.onRemoveClick,this)),this.removeButton.scaleX=this.removeButton.scaleY=.5;var r=new createjs.Shape;r.graphics.beginFill("#000").drawRect(0,0,26,26),this.removeButton.hitArea=r,this.zoomView.addChild(this.removeButton)}return __extends(i,e),i.prototype.onOffAutoZoom=function(){this.autoZoomFeature=!this.autoZoomFeature},i.prototype.isAutoZoom=function(){return this.autoZoomFeature},i.prototype.onWindowResize=function(){this.drawOutline(),this.zoomView.x=t.stageRoot.canvas.width-t.product.getActiveLayout().width*this.scale-14},i.prototype.onRemoveClick=function(t){t.stopImmediatePropagation(),this.zoomView.visible=!1},i.prototype.drawOutline=function(){var e=t.utils.Stage.getMetrics();if(null!=e&&"outline"in this&&"graphics"in this.outline){this.outline.graphics.clear();var i=e.scale/this.scale;this.outline.graphics.beginFill(this.outlineFill).beginStroke(this.outlineStroke).setStrokeStyle(1).drawRoundRect(-e.x/i,-e.y/i,e.canvasWidth/i,e.canvasHeight/i,1)}},i.prototype.updateImage=function(){1==this.zoomView.visible&&(this.previewImageData=t.buildNavImage(),this.previewImage.image.src=this.previewImageData,t.updateStage())},i.prototype.update=function(){t.editorManager.clear(),this.updateSilent()},i.prototype.updateSilent=function(){t.app.views.zoomControlView.currentScale=t.stageZoom.scaleX;var e=t.utils.Stage.getMetrics(),i=e.canvasWidth-e.width,o=e.canvasHeight-e.height;this.drawOutline(),0>i||0>o?0==this.zoomView.visible&&(this.zoomView.visible=!0,this.updateImage()):this.zoomView.visible&&(this.zoomView.visible=!1)},i.prototype.zoom_mouseover=function(e){e.stopImmediatePropagation(),t.editorManager.clear()},i.prototype.zoom_mousedown=function(e){e.stopImmediatePropagation(),t.editorManager.clear(),this.origin=t.utils.Stage.getMetrics(),this.origin.start=this.outline.globalToLocal(e.stageX,e.stageY)},i.prototype.zoom_pressup=function(e){e.stopImmediatePropagation(),t.editorManager.clear(),this.origin=null},i.prototype.zoom_pressmove=function(e){e.stopImmediatePropagation();var i=this.outline.globalToLocal(e.stageX,e.stageY),o=this.origin.scale/this.scale*(this.origin.start.x-i.x)+this.origin.x,n=this.origin.scale/this.scale*(this.origin.start.y-i.y)+this.origin.y,s=this.origin.canvasWidth-this.origin.width,a=this.origin.canvasHeight-this.origin.height,r=s/2,l=a/2,h=100;s-h>1?o=r:r+s/2-h>o?o=r+s/2-h:o>r-s/2+h&&(o=r-s/2+h),a-h>1?n=l:l+a/2-h>n?n=l+a/2-h:n>l-a/2+h&&(n=l-a/2+h),this.center={x:o,y:n,scale:this.origin.scale},t.stageZoom.x=o,t.stageZoom.y=n,this.drawOutline(),t.updateStage()},i}(createjs.Container);e.ZoomNav=i}(t.controls||(t.controls={}));t.controls}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){this.setElement(t.$("#containerEditor"),!0),this.$el.css("top","0"),this.$el.css("left","0"),this.onDragToolbar=t._.bind(this.handleToolbarDrag,this),this.$el.drag(this.onDragToolbar,{handle:"#ce_Drag"}),this.htmlTemplate=t._.template('<div class="container-flyout">    <div id="ce_Drag" class="sprite sprite-editor-drag-handle"></div>        <a href="#" class="VAlignHelper2" id="ce_LeftHorizontalAlign">            <i class="sprite sprite-icon_align_left2"></i>        </a>        <a href="#" class="VAlignHelper2" id="ce_CenterHorizontalAlign">            <i class="sprite sprite-icon_align_center2"></i>        </a>        <a href="#" class="VAlignHelper2" id="ce_RightHorizontalAlign">            <i class="sprite sprite-icon_align_right2"></i>        </a>        <a href="#" class="VAlignHelper2" id="ce_MiddleVerticalAlign">            <i class="sprite sprite-icon_align_middle2"></i>        </a>        <a href="#" class="VAlignHelper2" id="ce_TopVerticalAlign">            <i class="sprite sprite-icon_align_top2"></i>        </a>        <a href="#" class="VAlignHelper2" id="ce_BottomVerticalAlign">            <i class="sprite sprite-icon_align_bottom2"></i>        </a>        <a href="#" class="VAlignHelper2" id="ce_BringToFront">            <i class="sprite sprite-icon_bring_forward"></i>        </a>        <a href="#" class="VAlignHelper2" id="ce_SendToBack">            <i class="sprite sprite-icon_send_back"></i>        </a>        <a href="#" class="VAlignHelper2" id="ce_SizeToFrame">            <i class="sprite sprite-icon_fit"></i>        </a>        <a href="#" class="VAlignHelper2" id="ce_DeleteButton">            <i class="sprite sprite-icon_img_delete"></i>        </a>    <div id="ce_End" class="editor_end"></div></div>'),t.events.on(t.events.WINDOW_RESIZED,this.onWindowResized,this),this.events=t.isMobile()?{"touchend #ce_LeftHorizontalAlign":"leftAlign","touchend #ce_CenterHorizontalAlign":"centerAlign","touchend #ce_RightHorizontalAlign":"rightAlign","touchend #ce_MiddleVerticalAlign":"middleAlign","touchend #ce_TopVerticalAlign":"topAlign","touchend #ce_BottomVerticalAlign":"bottomAlign","touchend #ce_BringToFront":"bringToFront","touchend #ce_SendToBack":"sendToBack","touchend #ce_SizeToFrame":"sizeToFrame","touchend #ce_DeleteButton":"onDeleteClick"}:{"mousedown #ce_LeftHorizontalAlign":"onButtonDown","mousedown #ce_CenterHorizontalAlign":"onButtonDown","mousedown #ce_RightHorizontalAlign":"onButtonDown","mousedown #ce_MiddleVerticalAlign":"onButtonDown","mousedown #ce_TopVerticalAlign":"onButtonDown","mousedown #ce_BottomVerticalAlign":"onButtonDown","mousedown #ce_SendToFront":"onButtonDown","mousedown #ce_SendToBack":"onButtonDown","mousedown #ce_DeleteButton":"onButtonDown","mousedown #ce_SizeToFrame":"onButtonDown","mousedown #ce_Photo_del_btn":"onButtonDown","click #ce_LeftHorizontalAlign":"leftAlign","click #ce_CenterHorizontalAlign":"centerAlign","click #ce_RightHorizontalAlign":"rightAlign","click #ce_MiddleVerticalAlign":"middleAlign","click #ce_TopVerticalAlign":"topAlign","click #ce_BottomVerticalAlign":"bottomAlign","click #ce_BringToFront":"bringToFront","click #ce_SendToBack":"sendToBack","click #ce_SizeToFrame":"sizeToFrame","click #ce_DeleteButton":"onDeleteClick"},t._.bindAll(this,"render"),e.call(this)}return __extends(i,e),i.prototype.onWindowResized=function(){this.adjustToolbarPosition()},i.prototype.handleToolbarDrag=function(e){var i=t.$("#config-container").position(),o=e.pageY-28-i.top,n=e.pageX-10-i.left;this.adjustToolbarPosition(o,n)},i.prototype.adjustToolbarPosition=function(e,i){var o=t.$(".right-side-container"),n=this.$el,s=n.position();e=e||s.top,i=i||s.left;var a=o.position(),r=t.$("#sidebar"),l=r.is(":visible")?r.outerWidth():0;e<a.top+t.$("#toolbar").outerHeight(!0)+3&&(e=a.top+t.$("#toolbar").outerHeight(!0)+3),e>a.top+o.height()-(n.height()+6)&&(e=a.top+o.height()-(n.height()+6)),i<a.left+l+3&&(i=a.left+l+3),i>a.left+o.width()-(n.width()+6)&&(i=a.left+o.width()-(n.width()+6)),n.css({top:e,left:i})},i.prototype.setControl=function(t){this.control=t,this.render()},i.prototype.render=function(){this.html=t.$(this.htmlTemplate({})),this.$el.html(this.html),t.isMobile()||(t.utils.HtmlUtil.createTooltip("ce_LeftHorizontalAlign","Align all selected layers left.","top"),t.utils.HtmlUtil.createTooltip("ce_CenterHorizontalAlign","Align all selected layers center vertically.","top"),t.utils.HtmlUtil.createTooltip("ce_RightHorizontalAlign","Align all selected layers right.","top"),t.utils.HtmlUtil.createTooltip("ce_MiddleVerticalAlign","Align all selected layers to center.","top"),t.utils.HtmlUtil.createTooltip("ce_TopVerticalAlign","Align all selected layers to top.","top"),t.utils.HtmlUtil.createTooltip("ce_BottomVerticalAlign","Align all selected layers to bottom.","top"),t.utils.HtmlUtil.createTooltip("ce_BringToFront","Move layer up.","top"),t.utils.HtmlUtil.createTooltip("ce_SendToBack","Move layer down.","top"),t.utils.HtmlUtil.createTooltip("ce_SizeToFrame","Fit image.","top"),t.utils.HtmlUtil.createTooltip("ce_DeleteButton","Delete selected item(s) from the product.","top")),t.$("#ce_DeleteButton > i").removeClass("sprite-icon_text_delete sprite-icon_img_delete"),t.$("#ce_DeleteButton > i").addClass("bbox.controls.Image"==this.control.type?"sprite-icon_img_delete":"sprite-icon_text_delete"),("bbox.controls.Image"==this.control.type||"bbox.controls.BackgroundImage"==this.control.type)&&this.control.getMovable()&&this.control.imageScalable?t.$("#ce_SizeToFrame").show():t.$("#ce_SizeToFrame").hide();var e=this.control.isImageAlignDisabled(),i=this.control.isHTextAlignDisabled(),o=this.control.isVTextAlignDisabled();t.product.isStamp()?(t.utils.HtmlUtil.hide(["ce_LeftHorizontalAlign","ce_CenterHorizontalAlign","ce_RightHorizontalAlign"]),t.utils.HtmlUtil.hide(["ce_MiddleVerticalAlign","ce_TopVerticalAlign","ce_BottomVerticalAlign"]),t.utils.HtmlUtil.hide(["ce_SizeToFrame","ce_BringToFront","ce_SendToBack"]),this.control.isDeletable()?t.$("#ce_DeleteButton").show():t.$("#ce_DeleteButton").hide()):(e||i?t.utils.HtmlUtil.hide(["ce_LeftHorizontalAlign","ce_CenterHorizontalAlign","ce_RightHorizontalAlign"]):t.utils.HtmlUtil.show(["ce_LeftHorizontalAlign","ce_CenterHorizontalAlign","ce_RightHorizontalAlign"]),e||o?t.utils.HtmlUtil.hide(["ce_MiddleVerticalAlign","ce_TopVerticalAlign","ce_BottomVerticalAlign"]):t.utils.HtmlUtil.show(["ce_MiddleVerticalAlign","ce_TopVerticalAlign","ce_BottomVerticalAlign"]),"group"!==this.control.type&&t.ui.isZOrderEnabled()&&this.control.getMovable()?t.utils.HtmlUtil.show(["ce_BringToFront","ce_SendToBack"]):t.utils.HtmlUtil.hide(["ce_BringToFront","ce_SendToBack"]),this.control.isDeletable()?t.$("#ce_DeleteButton").show():t.$("#ce_DeleteButton").hide(),t.$("#containerEditor").show(),t.$("#containerEditor .container-flyout a:hidden").length===t.$("#containerEditor .container-flyout a").length&&t.$("#containerEditor").hide());var n=t.$("#containerEditor a").filter(function(){return"none"!=t.$(this).css("display")});return n&&1===n.length&&"ce_Drag"===n[0].id&&t.$(n[0]).hide(),n&&0===n.length&&(t.$("#ce_Drag").hide(),t.$("#ce_End").hide()),this},i.prototype.commit=function(){t.events.trigger(t.events.ZOOM_UPDATE_IMAGE),t.editorManager.hideContainer()},i.prototype.sizeToFrame=function(){var e=this.control.pageItemBlock,i=this.control.getModelClone();this.control.sizeToFrame();var o=this.control.getModelClone(),n=new t.actions.image.ImageModelAction(i,o,e,"ImageSizeFitAction");t.actionManager.addAction(n)},i.prototype.onButtonDown=function(){this.control.isLoaded&&(t.isEdit=!0)},i.prototype.leftAlign=function(t){this.control.isLoaded&&this.updateAlignment(t,"horizontal","left")},i.prototype.centerAlign=function(t){this.control.isLoaded&&this.updateAlignment(t,"horizontal","center")},i.prototype.rightAlign=function(t){this.control.isLoaded&&this.updateAlignment(t,"horizontal","right")},i.prototype.topAlign=function(t){this.control.isLoaded&&this.updateAlignment(t,"vertical","top")},i.prototype.middleAlign=function(t){this.control.isLoaded&&this.updateAlignment(t,"vertical","middle")},i.prototype.bottomAlign=function(t){this.control.isLoaded&&this.updateAlignment(t,"vertical","bottom")},i.prototype.sendToBack=function(t){if(this.control.isLoaded){t.preventDefault();var e="backward";this.adjustZOrder(e)}},i.prototype.bringToFront=function(t){if(this.control.isLoaded){t.preventDefault();var e="forward";this.adjustZOrder(e)}},i.prototype.adjustZOrder=function(e){var i="forward"===e,o=i?t.utils.AppUtil.getTopIndex():t.utils.AppUtil.getBottomIndex(),n=t.stage.getChildIndex(this.control);if(n!==o){var s=n+(i?1:-1),a=t.stage.getChildAt(s);if(a.hasOwnProperty("pageItemBlock")){var r={direction:i?"backward":"forward",referenceControl:a.pageItemBlock},l={direction:e,referenceControl:a.pageItemBlock},h=new t.actions.ContainerLayerAction(r,l,this.control.pageItemBlock);t.actionManager.addAction(h),this.updateZOrder(a,e)}}},i.prototype.onDeleteClick=function(t){this.control.isLoaded&&(t.preventDefault(),this.handleDelete())},i.prototype.handleDelete=function(e){if("undefined"==typeof e&&(e=!0),this.control.isLoaded&&this.control.getDeletable()){if(e===!0){var i,o,n,s=this.control,a=t.stage.getChildIndex(s),r=[],l=[],h=[],c=[];if(this.control.controls){a=t.stage.getChildIndex(s),l=[];for(var d=0;d<this.control.controls.length;d++)n=this.control.controls[d].getHistoryTransactionState(),s=this.control.controls[d],n.originalX+=this.control.x,n.originalY+=this.control.y,l.push(n),null!=s.story&&(o=t.$.extend(!0,{},s.story),r.push(o)),s.imageAsset&&c.push({imageAsset:s.imageAsset,vflip:s.vflip,hflip:s.hflip,scaleX:s.container.scaleX?s.container.scaleX:null,scaleY:s.container.scaleY?s.container.scaleY:null,colorId:s.colorId}),h.push(this.control.controls[d].pageItemBlock)}else{if(s.imageAsset){{s.container.scaleY}c.push({imageAsset:s.imageAsset,vflip:s.vflip,hflip:s.hflip,scaleX:s.container.scaleX?s.container.scaleX:null,scaleY:s.container.scaleY?s.container.scaleY:null,colorId:s.colorId})}h.push(s.pageItemBlock),l.push(this.control.getHistoryTransactionState()),null!=s.story&&(o=t.$.extend(!0,{},s.story),r.push(o))}i=new t.actions.ContainerCreateDeleteAction({action:"add",index:a,orgPostion:l,imageAsset:c,currentStory:r},{action:"remove",index:-1},h),t.actionManager.addAction(i)}this.control.onDelete(),t.isEdit=!1,t.utils.CanvasUtil.remove(this.control),t.editorManager.hideContainer(),t.updateStage()}},i.prototype.updateAlignment=function(e,i,o){this.control.isLoaded&&!t.stageLocked&&(this.control.hasOwnProperty("pageItemBlock")&&"false"===this.control.pageItemBlock._movable||(t.isEdit=!1,e.preventDefault(),this.control.updateAlignment(i,o)))},i.prototype.updateZOrder=function(e,i){if(this.control.isLoaded&&e&&e.isLoaded){if(t.isEdit=!1,"group"!==this.control.type){var o=t.stage.getChildIndex(e);t.stage.removeChild(this.control),t.stage.addChildAt(this.control,o),this.control.hasOwnProperty("pageItemBlock")&&e.hasOwnProperty("pageItemBlock")&&t.product.getActiveLayout().swapPageItem(this.control.pageItemBlock,e.pageItemBlock,i)
}t.updateStage()}},i}(Backbone.View);e.ContainerEdit=i}(t.editors||(t.editors={}));t.editors}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){this.setElement(t.$("#imageEditor"),!0),this.$el.css("top","0"),this.$el.css("left","0"),this.onDragToolbar=t._.bind(this.handleToolbarDrag,this),this.$el.drag(this.onDragToolbar,{handle:"#ie_Drag"}),this.onScaleDragHandler=t._.bind(this.onScaleDrag,this),this.onScaleDragEndHandler=t._.bind(this.onScaleDragEnd,this),this.toolbarTemplate=t._.template('<div class="container-flyout">    <div id="ie_Drag" class="drag_handle"></div>    <a id="ie_PhotoScaleBtn" class="VAlignHelper2">        <i class="sprite sprite-icon_img_scale"></i>    </a>    <div id="ie_PhotoScale" class="drop-down image-resizer" style="display:none;">        <div id="ie_PhotoScaleHandle" class="sprite sprite-slider-drag-handle"></div>        <!--<div class="hotspot-container">            <a href="#" id="ie_PhotoScalePlusHandle" class="hotspotPlus">&nbsp;</a>            <a href="#" id="ie_PhotoScaleMinusHandle" class="hotspotMinus">&nbsp;</a>        </div> -->    </div>    <a id="ie_ResetBtn" class="VAlignHelper2">        <i class="sprite sprite-icon_img_colorize_color"></i>    </a>    <div id="ie_Filters" class="drop-down color-filter" style="display:none">        <a id="ie_GreyBtn" class="VAlignHelper2">            <i class="sprite sprite-icon_img_colorize_bw"></i>        </a>        <a id="ie_SepiaBtn" class="VAlignHelper2">            <i class="sprite sprite-icon_img_colorize_sepia"></i>        </a>        <a id="ie_ColorBtn" class="VAlignHelper2">            <i class="sprite sprite-icon_img_colorize_color"></i>        </a>    </div>    <div id="ie_ColorPickerContainer" class="color-picker img-color-picker">        <input id="ie_ColorPicker" type="text"/>    </div>    <a id="ie_RotateCounterBtn" class="VAlignHelper2">        <i class="sprite sprite-icon_rotate_counter"></i>    </a>    <a id="ie_RotateBtn" class="VAlignHelper2">        <i class="sprite sprite-icon_rotate"></i>    </a>    <a id="ie_FlipHorizontalBtn" class="VAlignHelper2">        <i class="sprite sprite-icon_img_flip"></i>    </a>    <a id="ie_FlipVerticalBtn" class="VAlignHelper2">        <i class="sprite sprite-icon_img_flip_vertical"></i>    </a>    <a id="ie_SizeToFrame" class="VAlignHelper2">        <i class="sprite sprite-icon_fit"></i>    </a>    <a id="ie_PhotoDeleteBtn" class="VAlignHelper2">        <i class="sprite sprite-icon_img_delete"></i>    </a>    <div id="ie_End" class="editor_end"></div></div>'),t.events.on(t.events.WINDOW_RESIZED,this.onWindowResized,this),this.events=t.isMobile()?{"touchstart #ie_Drag":"hideChildren","click #ie_PhotoScaleBtn":"showScale","click #ie_ResetBtn":"showFilters","click #ie_GreyBtn":"goGrey","click #ie_SepiaBtn":"goSepia","click #ie_ColorBtn":"goReset","touchstart #ie_ColorPickerContainer":"hideChildrenColor","change #ie_ColorPicker":"onColorSelected","click #ie_RotateCounterBtn":"rotateCounterClockwise","click #ie_RotateBtn":"rotate","click #ie_FlipHorizontalBtn":"flipHorizontal","click #ie_FlipVerticalBtn":"flipVertical","click #ie_SizeToFrame":"sizeToFrame","click #ie_PhotoDeleteBtn":"removePhoto"}:{"mouseover #ie_Drag":"hideChildren","mouseover #ie_PhotoScaleBtn":"showScale","mouseover #ie_ResetBtn":"showFilters","click #ie_ResetBtn":"goReset","click #ie_GreyBtn":"goGrey","click #ie_SepiaBtn":"goSepia","click #ie_ColorBtn":"goReset","mouseover #ie_ColorPickerContainer":"hideChildrenColor","change #ie_ColorPicker":"onColorSelected","mouseover #ie_RotateCounterBtn":"hideChildren","click #ie_RotateCounterBtn":"rotateCounterClockwise","mouseover #ie_RotateBtn":"hideChildren","click #ie_RotateBtn":"rotate","mouseover #ie_FlipHorizontalBtn":"hideChildren","click #ie_FlipHorizontalBtn":"flipHorizontal","mouseover #ie_FlipVerticalBtn":"hideChildren","click #ie_FlipVerticalBtn":"flipVertical","mouseover #ie_SizeToFrame":"hideChildren","click #ie_SizeToFrame":"sizeToFrame","mouseover #ie_PhotoDeleteBtn":"hideChildren","click #ie_PhotoDeleteBtn":"removePhoto"},this.colorIdLookup={},this.colorIdClasses=[],this.colorIdLookup[t.controls.Image.COLOR]="sprite-icon_img_colorize_color",this.colorIdLookup[t.controls.Image.GRAY]="sprite-icon_img_colorize_bw",this.colorIdLookup[t.controls.Image.SEPIA]="sprite-icon_img_colorize_sepia",this.colorIdClasses=t._.values(this.colorIdLookup),t._.bindAll(this,"render"),e.call(this)}return __extends(i,e),i.prototype.onWindowResized=function(){this.adjustToolbarPosition()},i.prototype.handleToolbarDrag=function(e){var i=t.$("#config-container").position(),o=e.pageY-28-i.top,n=e.pageX-10-i.left;this.adjustToolbarPosition(o,n)},i.prototype.adjustToolbarPosition=function(e,i){var o=t.$(".right-side-container"),n=this.$el,s=n.position();e=e||s.top,i=i||s.left;var a=o.position(),r=t.$("#sidebar"),l=r.is(":visible")?r.outerWidth():0;e<a.top+t.$("#toolbar").outerHeight(!0)+3&&(e=a.top+t.$("#toolbar").outerHeight(!0)+3),e>a.top+o.height()-(n.height()+6)&&(e=a.top+o.height()-(n.height()+6)),i<a.left+l+3&&(i=a.left+l+3),i>a.left+o.width()-(n.width()+6)&&(i=a.left+o.width()-(n.width()+6)),n.css({top:e,left:i})},i.prototype.setControl=function(t){this.control=t,this.render()},i.prototype.render=function(){this.html=t.$(this.toolbarTemplate({})),this.$el.html(this.html),this.photoScale=t.$("#ie_PhotoScale"),this.photoScaleHandle=t.$("#ie_PhotoScaleHandle"),this.photoScaleButton=t.$("#ie_PhotoScaleBtn"),this.resetButton=t.$("#ie_ResetBtn"),this.filters=t.$("#ie_Filters"),this.photoDeleteButton=t.$("#ie_PhotoDeleteBtn"),this.colorPicker=t.$("#ie_ColorPicker"),this.sizeToFit=t.$("#ie_SizeToFrame"),this.control.imageScalable()&&"bbox.controls.BackgroundImage"==this.control.type?this.sizeToFit.show():this.sizeToFit.hide(),this.resetButton=this.setColorizeClass(this.resetButton,this.control.colorId,this.control.colorTint),t.ui.isImageEffectsEnabled()&&!t.product.isSingleColor()&&this.control.imageAsset.isUgcImage||(this.resetButton.hide(),this.filters.hide()),this.control.imageRotatable()||(t.$("#ie_RotateBtn").hide(),t.$("#ie_RotateCounterBtn").hide()),this.control.imageFlippable()||(t.$("#ie_FlipHorizontalBtn").hide(),t.$("#ie_FlipVerticalBtn").hide()),this.control.imageScalable()?(this.photoScaleHandle.on("drag",{},this.onScaleDragHandler),this.photoScaleHandle.on("dragend",{},this.onScaleDragEndHandler)):this.photoScaleButton.hide(),this.control.colorizeAvailable()&&this.control.imageAsset.isUgcImage||(t.$("#ie_ColorPickerContainer").hide(),this.resetButton.hide(),this.filters.hide()),t.product.isSingleColor()&&t.$("#ie_ColorPickerContainer").show(),this.control.imageScalable()||this.photoScaleButton.hide(),this.control.imageDeletable()?this.photoDeleteButton.show():this.photoDeleteButton.hide(),t.isMobile()||(t.utils.HtmlUtil.createTooltip("ie_RotateCounterBtn","Rotate photo counter clockwise.","top"),t.utils.HtmlUtil.createTooltip("ie_RotateBtn","Rotate photo clockwise.","top"),t.utils.HtmlUtil.createTooltip("ie_FlipVerticalBtn","Flip photo vertically.","top"),t.utils.HtmlUtil.createTooltip("ie_FlipHorizontalBtn","Flip photo horizontally.","top"),t.utils.HtmlUtil.createTooltip("ie_SizeToFrame","Sizes the current image to fit the frame that is on the stage. This will undo any custom cropping that you may have done.","left"),t.utils.HtmlUtil.createTooltip("ie_PhotoDeleteBtn","Remove photo.","top"),t.utils.HtmlUtil.createTooltip("ie_PhotoScaleBtn","Increase or decrease the photo size.","top"),t.utils.HtmlUtil.createTooltip("ie_Filters","Photo color filter.","top"),t.utils.HtmlUtil.createTooltip("ie_ColorPickerContainer","Change ink color","top"));var e;e=t.product.isSingleColor()?t.utils.HtmlUtil.getColorPalette():t.utils.HtmlUtil.getColorPalette(!0);var i={showPalette:!0,showPaletteOnly:!0,palette:e,show:t._.bind(this.onColorShow,this)};return i.color="-1"!=this.control.colorTint?this.control.colorTint:t.utils.Constants.RESET_COLOR,this.control.colorizeAvailable()&&this.control.imageAsset.isUgcImage&&this.colorPicker.spectrum(i),t.product.isSingleColor()&&this.colorPicker.spectrum(i),t.$("#ie_ColorPickerContainer .sp-dd").remove(),"none"==t.$("#ie_PhotoScaleBtn").css("display")&&"none"==t.$("#ie_ResetBtn").css("display")&&"none"==t.$("#ie_Filters").css("display")&&"none"==t.$("#ie_ColorPickerContainer").css("display")&&"none"==t.$("#ie_RotateCounterBtn").css("display")&&"none"==t.$("#ie_RotateBtn").css("display")&&"none"==t.$("#ie_FlipHorizontalBtn").css("display")&&"none"==t.$("#ie_FlipVerticalBtn").css("display")&&"none"==t.$("#ie_PhotoDeleteBtn").css("display")&&(t.$("#ie_Drag").hide(),t.$("#ie_End").hide()),this},i.prototype.onScaleDragEnd=function(){var e=t._.clone(this.control.oldModel);this.control.toolbarScaleEnd(),this.photoScaleHandle.css({top:"43px",left:"1px"}),this.hideChildren();var i=this.control.getModelClone(),o=this.control.pageItemBlock;t.actionManager.addAction(new t.actions.image.ImageModelAction(e,i,o,"ImageMoveAction"))},i.prototype.onScaleDrag=function(t){var e=this.photoScale.offset(),i=t.pageY-e.top-5;i>15&&75>i?this.photoScaleHandle.css({top:i+"px"}):15>i?this.photoScaleHandle.css({top:"16px"}):i>75&&this.photoScaleHandle.css({top:"74px"}),this.scaleMove()},i.prototype.setColorizeClass=function(e,i,o){var n=e.children("i"),s=!1;n.length<=0?n=e:s=!0,o&&"-1"!=o&&(i=t.controls.Image.COLOR);var a=this.colorIdLookup[i],r=t._.without(this.colorIdClasses,a).join(" ");return n.removeClass(r).addClass(a),s?n.end():n},i.prototype.handleDelete=function(){this.removePhoto()},i.prototype.commit=function(){t.events.trigger(t.events.ZOOM_UPDATE_IMAGE),t.editorManager.hideImage()},i.prototype.sizeToFrame=function(){var e=this.control.pageItemBlock,i=this.control.getModelClone();this.control.sizeToFrame();var o=this.control.getModelClone(),n=new t.actions.image.ImageModelAction(i,o,e,"ImageSizeFitAction");t.actionManager.addAction(n)},i.prototype.setToEdit=function(){t.isEdit=!0},i.prototype.onColorShow=function(){var e=t.$('span[data-color="rgb(255, 255, 254)"] .sp-thumb-inner');e.addClass("sprite-icon_color_none"),t.$('span[data-color="rgb(255, 255, 254)"]').removeClass("sp-thumb-active"),e.css("background-color",""),e.removeClass("sp-thumb-inner")},i.prototype.setColor=function(e){return t.$("#ie_ColorPicker").spectrum({color:e}),t.product.isSingleColor()?void t.setGlobalColor(e):void 0},i.prototype.onColorSelected=function(){if(this.control.isLoaded){t.isEdit=!0,this.control.isEmpty||(this.control.pageItemBlock._userInteracted="true");var e=this.resetButton;this.setColorizeClass(e,t.controls.Image.COLOR);var i=this.colorPicker.spectrum("get").toHexString();i=t.utils.HtmlUtil.filterColor(i);var o,n=this.control.pageItemBlock;if(t.product.isSingleColor())return o=new t.actions.image.ImageColorAction({type:"global",colorTint:this.control.colorTint},{type:"global",colorTint:i},n),t.actionManager.addAction(o),void t.setGlobalColor(i);if(i==t.utils.Constants.RESET_COLOR||i==this.control.colorTint)return void this.control.setColor(t.controls.Image.COLOR);o=new t.actions.image.ImageColorAction({type:"single",colorTint:this.control.colorTint,colorId:this.control.colorId},{type:"single",colorTint:i},n),t.actionManager.addAction(o),this.control.applyTint(i),t.isEdit=!1}},i.prototype.flipHorizontal=function(){if(this.control.isLoaded){t.isEdit=!0,this.hideChildren();var e=this.control.getModelClone();this.control.flipHorizontal();var i=this.control.getModelClone(),o=new t.actions.image.ImageModelAction(e,i,this.control.pageItemBlock,"ImageFlipAction");t.actionManager.addAction(o),t.isEdit=!1}},i.prototype.flipVertical=function(){if(this.control.isLoaded){t.isEdit=!0,this.hideChildren();var e=this.control.getModelClone();this.control.flipVertical();var i=this.control.getModelClone(),o=new t.actions.image.ImageModelAction(e,i,this.control.pageItemBlock,"ImageFlipAction");t.actionManager.addAction(o),t.isEdit=!1}},i.prototype.rotate=function(){if(this.control.isLoaded){t.isEdit=!0,this.hideChildren();var e=this.control.getModelClone();this.control.imageRotate(15);var i=this.control.getModelClone(),o=new t.actions.image.ImageModelAction(e,i,this.control.pageItemBlock,"ImageRotateAction");t.actionManager.addAction(o),t.isEdit=!1}},i.prototype.rotateCounterClockwise=function(){if(this.control.isLoaded){t.isEdit=!0,this.hideChildren();var e=this.control.getModelClone();this.control.imageRotate(-15);var i=this.control.getModelClone();t.actionManager.addAction(new t.actions.image.ImageModelAction(e,i,this.control.pageItemBlock,"ImageRotateAction")),t.isEdit=!1}},i.prototype.removePhoto=function(){if(this.control.isLoaded){t.isEdit=!0;var e={};if(this.control.setPreviousHistoryProperties(e,this.control.width,this.control.height),"bbox.controls.BackgroundImage"==this.control.type){var i=this.control;i.hideBackgroundImage()}else this.control.removeBitmap();var o={};this.control.setPreviousHistoryProperties(o,this.control.width,this.control.height);var n=new t.actions.image.ImageSwapAction(e,o,this.control.pageItemBlock);t.actionManager.addAction(n),t.updateStage(),t.isEdit=!1,t.editorManager.hideImage()}},i.prototype.setFilterColor=function(e){this.control.colorizeAvailable()&&this.control.imageAsset.isUgcImage&&this.colorPicker.spectrum("set",t.utils.Constants.RESET_COLOR),this.control.isEmpty||(this.control.pageItemBlock._userInteracted="true");var i=this.control;t._.defer(function(){i.setColor(e)}),t.updateStage()},i.prototype.goGrey=function(){if(this.control.isLoaded){t.isEdit=!0;var e=this.control.pageItemBlock,i=new t.actions.image.ImageColorAction({imageId:this.control.colorId,colorTint:this.control.colorTint},{imageId:t.controls.Image.GRAY},e);t.actionManager.addAction(i),this.setFilterColor(t.controls.Image.GRAY);var o=this.resetButton;this.setColorizeClass(o,t.controls.Image.GRAY),t.isEdit=!1,this.hideChildren()}},i.prototype.goSepia=function(){if(this.control.isLoaded){t.isEdit=!0;var e=this.control.pageItemBlock,i=new t.actions.image.ImageColorAction({imageId:this.control.colorId,colorTint:this.control.colorTint},{imageId:t.controls.Image.SEPIA},e);t.actionManager.addAction(i),this.setFilterColor(t.controls.Image.SEPIA);var o=this.resetButton;this.setColorizeClass(o,t.controls.Image.SEPIA),t.isEdit=!1,this.hideChildren()}},i.prototype.goReset=function(){if(this.control.isLoaded){t.isEdit=!0;var e=this.control.pageItemBlock,i=new t.actions.image.ImageColorAction({imageId:this.control.colorId,colorTint:this.control.colorTint},{imageId:t.controls.Image.COLOR},e);t.actionManager.addAction(i),this.setFilterColor(t.controls.Image.COLOR);var o=this.resetButton;this.setColorizeClass(o,t.controls.Image.COLOR),t.isEdit=!1,this.hideChildren()}},i.prototype.scaleMove=function(){this.control.isLoaded&&this.control.toolbarScale(1-(this.photoScaleHandle.position().top-15)/57)},i.prototype.showScale=function(){if(this.control.isLoaded){this.hideChildren();this.photoScale.show(0,t._.bind(function(){this.photoScaleHandle.css({top:"43px",left:"1px"})},this))}},i.prototype.showFilters=function(){this.setToEdit(),this.control.isLoaded&&(this.hideChildren(),this.filters.show())},i.prototype.hideChildrenColor=function(){this.filters.hide(),this.photoScale.hide()},i.prototype.hideChildren=function(){this.filters.hide(),this.photoScale.hide(),this.colorPicker.spectrum("hide")},i}(Backbone.View);e.ImageEdit=i}(t.editors||(t.editors={}));t.editors}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){this.rowCount=0,this.setElement(t.$("#peepAttributeEditor"),!0),this.$el.css("top","0"),this.$el.css("left","0"),this.toolbarTemplate=t._.template('<div id="pae-attribute-editor" class="container-flyout" style="display:hidden;">    <div id="pae-header" class="pae-title"><img src="/resources/store/scripts/JSConfigurator/img/peep-attribute-header.png" alt="Edit my peep" /></div>    <div id="pae_container">        <div class="pae-grey">            <div>                <input id="pae_peep-name" maxlength="<%= bbox.peepsManager.peepsMaxChars %>" class="pae-fit" type="text" placeholder="add name here..." />                <div id="pae_fontOptions" class="btn-group font-selection">                    <a class="btn dropdown-toggle text-dropdown pae-fit" data-toggle="dropdown">                        <span id="pae_font-button-label" ><%= currentFont.screenName %></span> <span class="caret"></span>                    </a>                    <ul id="pae_font-list" class="dropdown-menu font-dropdown-menu" style="overflow-y: scroll;">                        <% bbox._.each(fonts, function(font){ %>                        <li class="fontItem" data-font-label="<%= font.Family %>"><img src="<%= fontManager.getFontPreview( font.Family ) %>"></li>                        <% }); %>                    </ul>                </div>            </div>        </div>        <div id="pae-part-attributes"></div>        <div id="pae_End" class="editor_end"> </div>    </div></div>'),this.mobileToolbarTemplate=t._.template('<div id="pae-attribute-editor" class="container-flyout" style="display:hidden;">    <div id="pae-header" class="pae-title"><img src="/resources/store/scripts/JSConfigurator/img/peep-attribute-header.png" alt="Edit my peep" /></div>    <div id="pae_container">        <div class="pae-grey">            <div>                <input id="pae_peep-name" maxlength="20" class="pae-fit" type="text" placeholder="add name here..." />                <div id="pae_fontOptions" class="btn-group font-selection">                    <select id="pae_font-list" class="t-font-family">                        <% bbox._.each(fonts, function(font){ %>                        <% if( font.Family == currentFont.fontFamily ){ %>                        <option data-font-label="<%= font.Family %>" value="<%= font.Family %>" selected><%= font.Family %></option>                        <% } else { %>                        <option data-font-label="<%= font.Family %>" value="<%= font.Family %>"><%= font.Family %></option>                        <% } %>                        <% }); %>                    </select>                </div>            </div>        </div>        <div id="pae-part-attributes"></div>        <div id="pae_End" class="editor_end"> </div>    </div></div>'),t.events.on(t.events.PEEPS_SET_ATTRIBUTES,this.onSetAttributes,this),t.events.on(t.events.PEEPS_HIDE_ATTRIBUTES,this.onHideAttributes,this),this.events={"keyup #pae_peep-name":"onLabelChange","blur #pae_peep-name":"onLabelChange","click .fontItem":"onFontChange","change #pae_font-list":"onFontChange","change .pae-color-picker":"onColorChange"},t._.bindAll(this,"render"),e.call(this)}return __extends(i,e),i.prototype.render=function(){var e={fonts:t.fonts.fontSet.fonts,currentFont:t.peepsManager.getFontById(this.info.fontId),fontManager:t.fonts};this.html=t.$(t.isMobile()?this.mobileToolbarTemplate(e):this.toolbarTemplate(e)),this.$el.html(this.html),""!=this.info.label&&t.$("#pae_peep-name").val(this.info.label),t.$("#pae-part-attributes").empty();var i="";this.rowCount=0;for(var o=0;o<this.info.parts.length;o++)i+=this.getPartRow(this.info.parts[o].label,this.info.parts[o].selectedColor);t.$("#pae-part-attributes").html(i);for(var n=this.getColorPalette(),s={showPalette:!0,showPaletteOnly:!0,palette:n,show:t._.bind(this.onColorShow,this)},o=0;o<this.info.parts.length;o++){s.color=this.info.parts[o].selectedColor;var a="#pae_ColorPicker"+o;this.colorPicker=t.$(a),this.colorPicker.spectrum(s)}return t.$(".sp-dd").remove(),this},i.prototype.onColorShow=function(){var e=t.$('span[data-color="rgb(255, 255, 254)"] .sp-thumb-inner');e.addClass("sprite-icon_color_none"),t.$('span[data-color="rgb(255, 255, 254)"]').removeClass("sp-thumb-active"),e.css("background-color",""),e.removeClass("sp-thumb-inner")},i.prototype.onSetAttributes=function(e){t.$("#peepAttributeEditor").is(":hidden")&&(t.$("#peepAttributeEditor").show(),t.$("#startPeepInstruction").hide()),this.info=e,this.rowCount=0,""!=this.info.label&&t.$("#pae_peep-name").val(this.info.label),t.$("#pae-part-attributes").empty();var i="";this.rowCount=0;for(var o=0;o<this.info.parts.length;o++)i+=this.getPartRow(this.info.parts[o].label,this.info.parts[o].selectedColor);t.$("#pae-part-attributes").html(i)},i.prototype.onHideAttributes=function(){var e=setTimeout(function(){t.$("#peepAttributeEditor").hide(),t.$("#startPeepInstruction").show(),clearTimeout(e)},100)},i.prototype.onLabelChange=function(){t.events.trigger(t.events.PEEPS_TEXT_CHANGE,t.$("#pae_peep-name").val())},i.prototype.onColorChange=function(e){var i=t.$(e.currentTarget).text(),o="#"+e.target.id,n=t.$(o).spectrum("get").toHexString();n=t.utils.HtmlUtil.filterColor(n),t.events.trigger(t.events.PEEPS_COLOR_CHANGE,i,n)},i.prototype.onFontChange=function(e){var i="";t.isMobile()?i=t.$(e.currentTarget).val():(i=t.$(e.currentTarget).attr("data-font-label"),t.$("#pae_font-button-label").text(i));var o=t.fonts.getFont(i);t.peepsManager.peepsFont=o,t.events.trigger(t.events.PEEPS_FONT_CHANGE,o)},i.prototype.getPartRow=function(t){var e="<div id='pae_ColorPickerContainer"+this.rowCount+"' class='pae-color-picker pae-row' >";return e+="<span class='pae-part-label'>"+t+"</span><input id='pae_ColorPicker"+this.rowCount+"' class='pae-chooser' type='text'/>",e+="</div>",this.rowCount++,e},i.prototype.getColorPalette=function(){for(var e=[],i=[],o=8,n=1;n<t.peepsManager.peepsSwatches.length+1;n++)i.push(t.peepsManager.peepsSwatches[n-1]._rgbValue),n%o==0&&(e.push(i),i=[]);return i.length<o&&e.push(i),e},i}(Backbone.View);e.PeepAttributeEdit=i}(t.editors||(t.editors={}));t.editors}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){e.call(this),this.type="PeepEdit",this.peepType="",this.component=i,this.transform=new t.editors.PeepTransform,this.info={},this.cursor="pointer",this.labelHeight=50,this.labelOffset=25,this.peepId=t.utils.GUID.create(),this.uiScale=1,this.frameThickness=2,this.active=!1,this.minWidth=350,this.defaultSwatches={},t.events.on(t.events.PEEPS_RECALCULATE_HEIGHT,this.onRecalculateHeight,this),t.events.on(t.events.PEEPS_UI_SCALE,this.onUIScaleChange,this),t.events.on(t.events.PEEPS_COLOR_CHANGE,this.onColorChange,this),t.events.on(t.events.PEEPS_TEXT_CHANGE,this.onTextChange,this),t.events.on(t.events.PEEPS_FONT_CHANGE,this.onFontChange,this),t.events.on(t.events.PEEPS_SHOW_EDITOR_BACKGROUND,this.onShowEditorBackground,this),this.addEventListener("mouseover",t._.bind(this.onPeepMouseOver,this)),this.addEventListener("mouseout",t._.bind(this.onPeepMouseOut,this)),this.init()}return __extends(i,e),i.prototype.clean=function(){t.events.off(t.events.PEEPS_RECALCULATE_HEIGHT,this.onRecalculateHeight,this),t.events.off(t.events.PEEPS_UI_SCALE,this.onUIScaleChange,this),t.events.off(t.events.PEEPS_COLOR_CHANGE,this.onColorChange,this),t.events.off(t.events.PEEPS_TEXT_CHANGE,this.onTextChange,this),t.events.off(t.events.PEEPS_FONT_CHANGE,this.onFontChange,this),t.events.off(t.events.PEEPS_SHOW_EDITOR_BACKGROUND,this.onShowEditorBackground,this),this.removeEventListener("mouseover",t._.bind(this.onPeepMouseOver,this)),this.removeEventListener("mouseout",t._.bind(this.onPeepMouseOut,this))},i.prototype.init=function(){this.ui=new createjs.Container,this.content=new createjs.Container,this.peep=new createjs.Shape,this.frame=new createjs.Container,this.outline=new createjs.Shape,this.background=new createjs.Shape,this.label=new createjs.Text,this.label.textAlign="center",this.isFirst=!1,this.isLast=!1,this.padLeftIcon=t.config.baseAssetUrl()+"img/pad-left.png",this.padRightIcon=t.config.baseAssetUrl()+"img/pad-right.png",this.moveLeftIcon=t.config.baseAssetUrl()+"img/move-left.png",this.moveRightIcon=t.config.baseAssetUrl()+"img/move-right.png",this.removeIcon=t.config.baseAssetUrl()+"img/peep-remove.png",this.moveLeftBtn=new createjs.Bitmap(this.moveLeftIcon),this.moveRightBtn=new createjs.Bitmap(this.moveRightIcon),this.removeBtn=new createjs.Bitmap(this.removeIcon),this.defaultSwatches=[],this.addChild(this.background),this.addChild(this.content),this.addChild(this.frame),this.addChild(this.ui),this.frame.addChild(this.outline),this.frame.addChild(this.removeBtn),this.frame.addChild(this.moveLeftBtn),this.frame.addChild(this.moveRightBtn),this.moveLeftBtn.addEventListener("click",t._.bind(this.onMoveLeftClick,this)),this.moveRightBtn.addEventListener("click",t._.bind(this.onMoveRightClick,this)),this.removeBtn.addEventListener("click",t._.bind(this.onRemoveClick,this)),this.parse(this.component)},i.prototype.parse=function(t){this.peep.graphics.clear(),this.editors={};var e=t.transform.split("translate(")[1].split(") ")[0].split(",");this.transform.x=parseFloat(e[0]),this.transform.y=parseFloat(e[1]),e=t.transform.split("rotate(")[1].split("),")[0],this.transform.rotate=parseFloat(e[0]),e=t.transform.split("scale(")[1].split(")")[0],this.transform.scale=parseFloat(e[0]),this.info=t.json["hcsvg:info"],this.transform.width=parseFloat(this.info._width),this.transform.height=parseFloat(this.info._height),this.peepType=this.info._name,this.width=this.transform.width<this.minWidth?this.minWidth:this.transform.width,this.height=this.transform.height+this.labelHeight;for(var i,o=0;o<this.info.swatches.Swatch.length;o++)i=this.info.swatches.Swatch[o],-1==i._templateName.indexOf(" copy")&&this.defaultSwatches.push(i);for(var n,s=t.paths,a=s.length,r=0;a>r;r++)"true"==s[r]["_hcsvg:selectablePeepPart"]&&(n=s[r]["_hcsvg:peepPartName"],void 0==this.editors[n]&&(this.editors[n]=[],this.editors[n].fill=s[r]._fill,this.editors[n].label=s[r]["_hcsvg:peepPartName"]),this.editors[n].push(s[r])),this.peep.graphics.beginFill(s[r]._fill).svgPath(s[r]._d);this.content.addChild(this.peep),this.content.addChild(this.label),this.peep.x=.5*(this.width-this.transform.width),this.setLabelInfo(this.info.label)},i.prototype.updateParts=function(){this.peep.graphics.clear();for(var t=this.component.paths,e=0;e<t.length;e++)this.peep.graphics.beginFill(t[e]._fill).svgPath(t[e]._d).endFill();this.update()},i.prototype.setLabelInfo=function(e){this.label.x=.5*this.width,this.label.y=this.transform.height,this.label.text=this.validateName(e.content,this.info._name,!1)?e.content:"",this.label.color=e._color,t.utils.ObjectUtil.isUndefined(t.peepsManager.peepsFont)&&t.peepsManager.getFontById(e._fontId),this.label.font=t.peepsManager.getFontCSS(),this.update()},i.prototype.validateName=function(t,e,i){t="undefined"!=typeof t?t:"",e="undefined"!=typeof e?e:"";var o=t.split(" ").join("").toLowerCase(),n=e.split(" ").join("").toLowerCase();return i||""!==o?o!==n:!1},i.prototype.onFontChange=function(){this.label.font=t.peepsManager.getFontCSS();var e=t.isMobile()?40:20,i=0,o=setInterval(function(){t.app.views.peepsCanvasView.peepStage.update(),i++},100),n=setTimeout(function(){clearInterval(o),clearTimeout(n)},100*e)},i.prototype.update=function(){t.app.views.peepsCanvasView.peepStage.update()},i.prototype.onMoveLeftClick=function(e){e.preventDefault(),t.events.trigger(t.events.PEEPS_MOVE_LEFT,this)},i.prototype.onMoveRightClick=function(e){e.preventDefault(),t.events.trigger(t.events.PEEPS_MOVE_RIGHT,this)},i.prototype.onRemoveClick=function(e){e.preventDefault(),t.events.trigger(t.events.PEEPS_REMOVE,this)},i.prototype.onPeepMouseOver=function(){this.active||(this.frame.visible=!0,this.update())},i.prototype.onPeepMouseOut=function(){this.active||(this.frame.visible=!1,this.update())},i.prototype.onRecalculateHeight=function(t){this.height=t,this.background.graphics.clear().beginFill("#ffffff").drawRect(0,0,this.width,this.height),this.outline.graphics.clear().setStrokeStyle(this.frameThickness).beginStroke("#ccc").drawRect(0,0,this.width,this.height),this.content.y=this.height-(this.transform.height+this.labelHeight),this.moveLeftBtn.y=this.height-33,this.moveRightBtn.y=this.height-33,this.moveLeftBtn.visible=!this.isFirst,this.moveRightBtn.visible=!this.isLast,this.update()},i.prototype.onUIScaleChange=function(t){this.uiScale=t,this.outline.graphics.clear().setStrokeStyle(this.frameThickness*this.uiScale).beginStroke("#ccc").drawRect(0,0,this.width,this.height),this.removeBtn.scaleX=this.removeBtn.scaleY=t,this.removeBtn.x=this.width-21*t,this.moveLeftBtn.scaleX=this.moveLeftBtn.scaleY=t,this.moveRightBtn.scaleX=this.moveRightBtn.scaleY=t,this.moveRightBtn.x=this.width-(16*t+10),this.moveLeftBtn.x=10,this.update()},i.prototype.setActive=function(t){this.active=t,this.frame.visible=this.active,t&&this.getAttributeInfo(),this.update()},i.prototype.getAttributeInfo=function(){this.attr=new t.editors.PeepAttributeInfo,this.attr.label=this.label.text,this.attr.fontId=t.peepsManager.getCurrentFontFamily();var e=[];for(var i in this.editors){var o={};o.label=i,o.selectedColor=this.editors[i].fill,e.push(o)}e.sort(function(t,e){return t.label-e.label}),this.attr.parts=e,t.events.trigger(t.events.PEEPS_SET_ATTRIBUTES,this.attr)},i.prototype.onTextChange=function(e){if(this.active){if(e.length<=t.peepsManager.peepsMaxChars){if(!this.validateName(e,this.info._name,!0))return t.$("#pae_peep-name").blur().val(e.substring(0,e.length-1)),void t.dialogs.displayDialog("Invalid Name","The original name of the Peep is reserved and cannot be used. Please choose a different name.");this.label.text=e}else this.label.text=e.substr(0,t.peepsManager.peepsMaxChars-1);this.update()}},i.prototype.onColorChange=function(t,e){if(this.active){var i=this.editors[t],o=0;for(o;o<i.length;o++)i[o]._fill=e;this.editors[t].fill=e,this.updateParts()}},i.prototype.onShowEditorBackground=function(t){this.background.visible=t,this.update()},i.prototype.save=function(e,i){this.transform.x=e+this.peep.x,this.transform.y=i,this.component.json._transform=this.transform.toString(),this.info.swatches.Swatch=[];for(var o=0;o<this.defaultSwatches.length;o++)this.info.swatches.Swatch.push(this.defaultSwatches[o]);for(var n in this.editors){var s=this.getSwatch(this.editors[n].fill);s&&this.info.swatches.Swatch.push(s)}return this.info.label._color=t.peepsManager.peepsFontColor,this.info.label._fontId=t.peepsManager.peepsFont.variants[0].fontId,this.info.label._fontSize=t.peepsManager.fontRatio(t.peepsManager.peepsFont.variants[0].fontId),this.info.label._height=this.labelHeight,this.info.label._width=this.width,this.info.label._x=.5*(this.transform.width-this.width),this.info.label._y=this.label.y,this.info.label.content="undefined"!=typeof this.label.text?this.label.text:"",this.info._FlexAppVersion=t.utils.AppUtil.setConfiguratorVersion(""),this.component},i.prototype.getSwatch=function(e){var i=0;for(i=0;i<this.info.swatches.Swatch.length;i++)if(this.info.swatches.Swatch[i]._rgbValue.toLowerCase()==e.toLowerCase())return null;for(i=0;i<t.peepsManager.peepsSwatches.length;i++)if(t.peepsManager.peepsSwatches[i]._rgbValue.toLowerCase()==e.toLowerCase())return t.peepsManager.peepsSwatches[i];return null},i.prototype.encodeLabel=function(t){if(t&&t.length>0){var e=/ /gi;t=t.replace(e,"&nbsp;")}return t},i}(createjs.Container);e.PeepEdit=i;var o=function(){function t(){this.x=0,this.y=0,this.width=0,this.height=0,this.rotate=0,this.scale=1}return t.prototype.toString=function(){return"translate("+this.x+","+this.y+") rotate("+this.rotate+"), scale("+this.scale+")"},t}();e.PeepTransform=o;var n=function(){function t(){this.label="",this.fontId="",this.parts=[]}return t}();e.PeepAttributeInfo=n}(t.editors||(t.editors={}));t.editors}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){this.templateLoaded=!1,this.setElement(t.$("#textEditor"),!0),this.$el.css("top","0"),this.$el.css("left","0"),this.onDragToolbar=t._.bind(this.handleToolbarDrag,this),this.$el.drag(this.onDragToolbar,{handle:"#dragObj-container"}),this.toolbarTemplate=t._.template('<div class="obj-container">    <div id="dragObj-container" class="sprite sprite-editor-drag-handle"></div>    <div class="container-flyout text-content-flyout">        <div id="fontOptions" class="btn-group font-selection">            <button class="font-selection-btn btn dropdown-toggle text-dropdown" data-toggle="dropdown" tabindex="10">                <span id="fontButtonLabel" ><%= currentFont.screenName %></span> <span class="caret"></span>            </button>            <ul id="fontList" class="dropdown-menu font-dropdown-menu" style="overflow-y: scroll;">                <% bbox._.each(fonts, function(font){ %>                <li class="fontItem" data-font-label="<%= font.Family %>"><img src="<%= fontManager.getFontPreview( font.Family ) %>"></li>                <% }); %>            </ul>        </div>        <select id="sizeOptions" class="t-font-size" tabindex="20">            <% bbox._.each(sizeOptions, function(size){ %>            <% if( currentSize == size ){ %>            <option selected><%= size %></option>            <% } else { %>            <option><%= size %></option>            <% } %>            <% }); %>        </select>        <div id="colorPickerContainer" class="color-picker" tabindex="30">            <input id="colorPicker" type="text"/>        </div>        <select id="variantOptions" class="t-font-stlye" tabindex="40">            <option value="-1">-- select style --</option>            <% bbox._.each(variants, function(variant){ %>            <% if( currentVariant.styleScreenName == variant.styleScreenName ){ %>            <option selected><%= variant.styleScreenName %></option>            <% } else { %>            <option><%= variant.styleScreenName %></option>            <% } %>            <% }); %>        </select>        <select id="lineHeightOptions" class="t-font-lh" tabindex="50">            <% bbox._.each(lineHeightOptions, function(lineHeightOption){ %>            <% if( Number(lineMultiplier) == Number(lineHeightOption) ){ %>            <option selected><%= lineHeightOption %></option>            <% } else { %>            <option><%= lineHeightOption %></option>            <% } %>            <% }); %>        </select>        <div id="textHorizontalAlignOptions" class="btn-group" tabindex="60">            <button class="btn dropdown-toggle text-dropdown align-dropdown" data-toggle="dropdown">                <span id="hAlignButton" class="text-align-selected">                    <i class="sprite sprite-icon_align_text_left"></i>                </span>                <span class="caret"></span>            </button>            <ul id="hAlignList" class="dropdown-menu text-align-menu">                <li id="hAlignOption1" class="hAlignItem" ><!--data-h-align="center">-->                    <i class="sprite sprite-icon_align_text_center"></i>                </li>                <li id="hAlignOption2" class="hAlignItem" ><!--data-h-align="right">-->                    <i class="sprite sprite-icon_align_text_right"></i>                </li>            </ul>        </div>    </div>    <div id="ce_End" class="editor_end"></div></div>'),this.mobileToolbarTemplate=t._.template('<div class="obj-container">    <div id="dragObj-container" class="drag_handle"></div>    <div class="container-flyout text-content-flyout">        <select id="fontList" class="t-font-family" tabindex="10">            <% bbox._.each(fonts, function(font){ %>            <% if( font.Family == currentFont.fontFamily ){ %>            <option data-font-label="<%= font.Family %>" value="<%= font.Family %>" selected><%= font.Family %></option>            <% } else { %>            <option data-font-label="<%= font.Family %>" value="<%= font.Family %>"><%= font.Family %></option>            <% } %>            <% }); %>        </select>        <select id="sizeOptions" class="t-font-size" tabindex="20">            <% bbox._.each(sizeOptions, function(size){ %>            <% if( currentSize == size ){ %>            <option selected><%= size %></option>            <% } else { %>            <option><%= size %></option>            <% } %>            <% }); %>        </select>        <div id="colorPickerContainer" class="color-picker" tabindex="30">            <input id="colorPicker" type="text"/>        </div>        <select id="variantOptions" class="t-font-stlye" tabindex="40">            <option value="-1">-- select style --</option>            <% bbox._.each(variants, function(variant){ %>            <% if( currentVariant.styleScreenName == variant.styleScreenName ){ %>            <option selected><%= variant.styleScreenName %></option>            <% } else { %>            <option><%= variant.styleScreenName %></option>            <% } %>            <% }); %>        </select>        <select id="lineHeightOptions" class="t-font-lh" tabindex="50">            <% bbox._.each(lineHeightOptions, function(lineHeightOption){ %>            <% if( Number(lineMultiplier) == Number(lineHeightOption) ){ %>            <option selected><%= lineHeightOption %></option>            <% } else { %>            <option><%= lineHeightOption %></option>            <% } %>            <% }); %>        </select>        <select id="textHorizontalAlignOptions" class="t-font-align" tabindex="60">            <% bbox._.each(horizontalOptions, function(horizontalOption){ %>            <% if( horizontalOption == currentAlignment ){ %>            <option data-h-align="<%= horizontalOption %>" selected><%= horizontalOption %></option>            <% } else { %>            <option data-h-align="<%= horizontalOption %>"><%= horizontalOption %></option>            <% } %>            <% }); %>        </select>    </div></div>'),t.events.on(t.events.WINDOW_RESIZED,this.onWindowResized,this),this.events={"mousedown #fontList":"onOptionMouseDown","mousedown #fontOptions":"onOptionMouseDown","mousedown #variantOptions":"onOptionMouseDown","mousedown #sizeOptions":"onOptionMouseDown","mousedown #lineHeightOptions":"onOptionMouseDown","mousedown .sp-replacer":"onOptionMouseDown","mousedown #deleteButton":"onOptionMouseDown","click #fontOptions":"onOptionClick","click #variantOptions":"onOptionClick","click #sizeOptions":"onOptionClick","click .sp-replacer":"onOptionClick","change #fontOptions":"onFontSelected","change #variantOptions":"onVariantSelected","change #sizeOptions":"onSizeSelected","change #lineHeightOptions":"onLineHeightSelected","change #colorPicker":"onColorSelected","click .fontItem":"onFontSelected","change #fontList":"onFontSelected","click .hAlignItem":"onHAlignClick","change #textHorizontalAlignOptions":"onHAlignClick","click #deleteButton":"onDeleteClick"},t._.bindAll(this,"render"),e.call(this)
}return __extends(i,e),i.prototype.onWindowResized=function(){this.adjustToolbarPosition()},i.prototype.handleToolbarDrag=function(e){var i=t.$("#config-container").position(),o=e.pageY-28-i.top,n=e.pageX-10-i.left;this.adjustToolbarPosition(o,n)},i.prototype.adjustToolbarPosition=function(e,i){var o=t.$(".right-side-container"),n=this.$el,s=n.position();e=e||s.top,i=i||s.left;var a=o.position(),r=t.$("#sidebar"),l=r.is(":visible")?r.outerWidth():0;e<a.top+t.$("#toolbar").outerHeight(!0)+3&&(e=a.top+t.$("#toolbar").outerHeight(!0)+3),e>a.top+o.height()-(n.height()+6)&&(e=a.top+o.height()-(n.height()+6)),i<a.left+l+3&&(i=a.left+l+3),i>a.left+o.width()-(n.outerWidth(!0)+6)&&(i=a.left+o.width()-(n.outerWidth(!0)+6)),n.css({top:e,left:i})},i.prototype.setControl=function(t){this.control=t,this.templateLoaded?this.updateTemplate():this.loadTemplate(),this.control.currentFont&&this.updateFontSize(this.control.currentFont),this.render()},i.prototype.loadTemplate=function(){var e=this.control.paragraphs[0],i=e.getAlignment(),o=t.fonts.fontSet.fonts,n=this.getFontSizeOptions(this.control.currentFont,16),s={fonts:o,variants:this.control.currentFont.variants,currentFont:this.control.currentFont,currentVariant:this.control.currentVariant,sizeOptions:n,currentSize:this.control.currentSize,fontManager:t.fonts,lineHeightOptions:t.utils.Constants.LINE_HEIGHT_OPTIONS,lineMultiplier:this.control.lineHeightMultiplier,horizontalOptions:t.utils.Constants.HALIGN_OPTIONS,currentAlignment:i};this.html=t.$(t.isMobile()?this.mobileToolbarTemplate(s):this.toolbarTemplate(s)),this.$el.html(this.html),this.templateLoaded=!0},i.prototype.updateFontSize=function(e){var i=e.minSize,o=e.maxSize,n=parseInt(this.control.currentSize),s=i,a=[],r=t.$("#sizeOptions");for(r.empty(),s;o>=s;s++)a.push(s!==n?t.$("<option />").val(s).text(s)[0]:t.$("<option selected />").val(s).text(s)[0]);r.append(a),i>n&&(this.control.currentSize=i.toString(),this.onSizeSelected(null))},i.prototype.updateTemplate=function(){if(t.isMobile()){t.utils.HtmlUtil.setSelectOption("fontList",this.control.currentFont.fontFamily);var e=this.control.paragraphs[0],i=e.getAlignment();t.utils.HtmlUtil.setSelectOption("textHorizontalAlignOptions",i)}else t.$("#fontButtonLabel").text(this.control.currentFont.fontFamily);t.utils.HtmlUtil.setSelectOption("sizeOptions",this.control.currentSize),t.utils.HtmlUtil.setSelectOption("variantOptions",this.control.currentVariant.styleScreenName),t.utils.HtmlUtil.setSelectOption("lineHeightOptions",this.control.lineHeightMultiplier.toString())},i.prototype.render=function(){var e=t.fonts.fontSet.fonts,i=20*e.length,o=i>300?300:i,n=this.control.getGlobalPoint();n.y+o>t.$("#canvas").height()?t.$("#fontOptions").addClass("dropup"):t.$("#fontOptions").removeClass("dropup");var s=this.control.paragraphs[0],a=s.getAlignment();this.updateHAlignOptions(a),this.updateVAlignOptions(this.control.verticalAlign),t.$("#colorPicker").spectrum({color:this.control.currentColor,showPalette:!0,showPaletteOnly:!0,palette:t.utils.HtmlUtil.getColorPalette()}),t.$(".sp-dd").remove();var r=this.control.currentFont.minSize<this.control.currentFont.maxSize;return r?t.$("#sizeOptions").show():t.$("#sizeOptions").hide(),t.ui.isSingleFontProduct()?t.utils.HtmlUtil.hide(["fontOptions","variantOptions"]):t.utils.HtmlUtil.show(["fontOptions","variantOptions"]),t.product.isSingleFontColor()?t.$("#colorPickerContainer").hide():t.$("#colorPickerContainer").show(),this.updateLineHeightMargin(this.control.lineHeightMultiplier),this},i.prototype.onTextInput=function(){{var e=t.$("#textFrame p"),i=e.eq(0),o=i.children("span");o.eq(0)}},i.prototype.handleDelete=function(){var t=window.getSelection();t.removeAllRanges()},i.prototype.onOptionMouseDown=function(){this.handleDelete(),t.$("#textEditor").focus(),t.isEdit=!0,this.mouseState="mouseDown"},i.prototype.onOptionClick=function(){this.handleDelete(),t.isEdit="click"!=this.mouseState},i.prototype.getFontSizeOptions=function(t){for(var e=[],i=t.minSize;i<t.maxSize;i++)e.push(i);return e},i.prototype.updateHAlignOptions=function(e){if(t.$("#textFrame").children("p").each(function(i,o){t.$(o).css("text-align",e)}),!t.isMobile()){var i="sprite sprite-icon_align_text_"+e;t.$("#hAlignButton").html("<i class='"+i+"'></i>"),"left"==e?(this.updateAlignmentOption("#hAlignOption1","center","h"),this.updateAlignmentOption("#hAlignOption2","right","h")):"center"==e?(this.updateAlignmentOption("#hAlignOption1","left","h"),this.updateAlignmentOption("#hAlignOption2","right","h")):"right"==e&&(this.updateAlignmentOption("#hAlignOption1","left","h"),this.updateAlignmentOption("#hAlignOption2","center","h"))}},i.prototype.updateVAlignOptions=function(e){var i="sprite sprite-icon_align_text_"+e;t.$("#vAlignButton").html("<i class='"+i+"'></i>"),"top"==e?(this.updateAlignmentOption("#vAlignList1","middle","v"),this.updateAlignmentOption("#vAlignList2","bottom","v")):"middle"==e?(this.updateAlignmentOption("#vAlignList1","top","v"),this.updateAlignmentOption("#vAlignList2","bottom","v")):"bottom"==e&&(this.updateAlignmentOption("#vAlignList2","top","v"),this.updateAlignmentOption("#vAlignList2","middle","v"));var o=this.control.getInitalYValue(e);o=Math.round(o*t.stageZoom.scaleX);this.control.lineHeight},i.prototype.setHAlign=function(t){this.control.alignText("horizontal",t),this.updateHAlignOptions(t)},i.prototype.onHAlignClick=function(e){if(this.control.isLoaded){var i="";i=t.isMobile()?t.$(e.currentTarget).val():t.$(e.currentTarget).data("h-align");var o=this.control.pageItemBlock,n=new t.actions.text.TextFontAlignAction(this.control.getCurrentHorizontalAlign(),i,o);this.updateAlignment(e,"horizontal",i),this.updateHAlignOptions(i),this.updateControl(),t.actionManager.addAction(n)}},i.prototype.updateAlignment=function(e,i,o){this.control.isLoaded&&(t.isEdit=!1,e.preventDefault(),this.control.alignText(i,o))},i.prototype.setColor=function(e){t.$("#colorPicker").spectrum({color:e,showPalette:!0,showPaletteOnly:!0,palette:t.utils.HtmlUtil.getColorPalette()}),t.$(".sp-dd").remove(),t.$("#textFrame").css("color",e),this.control.setCurrentFontColor(e),t.product.isSingleColor()&&t.setGlobalColor(e)},i.prototype.onColorSelected=function(){if(this.control.isLoaded){this.mouseState="click",t.isEdit=!1;var e=t.$("#colorPicker").spectrum("get").toHexString();e=t.utils.HtmlUtil.filterColor(e),t.$("#textFrame").css("color",e);var i,o=this.control.pageItemBlock;t.product.isSingleColor()?(i=new t.actions.text.TextColorAction({type:"global",color:this.control.currentColor},{type:"global",color:e},o),t.setGlobalColor(e)):i=new t.actions.text.TextColorAction(this.control.currentColor,e,o),this.control.setCurrentFontColor(e),this.updateControl(),t.actionManager.addAction(i)}},i.prototype.setFontSize=function(e){t.$("#sizeOptions").val(e),t.$("#textFrame").css("font-size",t.utils.HtmlUtil.scaleValue(e)+"px"),this.control.setCurrentFontSize(e.toString())},i.prototype.onSizeSelected=function(e){if(this.control.isLoaded){this.mouseState="click";var i=t.$("#sizeOptions").val(),o=this.control.pageItemBlock,n=new t.actions.text.TextSizeAction(this.control.currentSize,i,o);t.$("#textFrame").css("font-size",t.utils.HtmlUtil.scaleValue(i)+"px"),this.control.setCurrentFontSize(i.toString()),this.updateControl(),e&&t.actionManager.addAction(n)}},i.prototype.setLineHeight=function(e){t.$("#lineHeightOptions").val(e),this.control.updateLineHeight(e),this.updateLineHeightMargin(e)},i.prototype.onLineHeightSelected=function(){if(this.control.isLoaded){this.mouseState="click";var e=t.$("#lineHeightOptions").val(),i=this.control.pageItemBlock,o=new t.actions.text.TextHeightAction(this.control.lineHeight,e,i);this.control.updateLineHeight(e),this.updateLineHeightMargin(e),this.updateControl(),t.actionManager.addAction(o)}},i.prototype.updateLineHeightMargin=function(e){var i=0;e>120&&(i=Math.round(Number(this.control.currentSize)*((e-100)/100))),t.$("#textFrame").children("p").each(function(o,n){t.$(n).css("line-height",e.toString()+"%"),t.$(n).css("margin-bottom",i)})},i.prototype.setFontVariant=function(e){t.$("#variantOptions").val(e);var i=this.control.currentFont.getVariantByScreenName(e);this.control.setCurrentFontVariant(i)},i.prototype.onVariantSelected=function(){if(this.control.isLoaded){this.mouseState="click";var e=t.$("#variantOptions").val(),i=this.control.currentFont.getVariantByScreenName(e),o=this.control.pageItemBlock,n=new t.actions.text.TextVariantAction(this.control.currentVariant,i,o);this.updateFontProperty("updateFontVariant",e),this.control.setCurrentFontVariant(i),this.updateControl(),t.actionManager.addAction(n)}},i.prototype.setFont=function(e){this.updateFontProperty("updateFont",e),t.$("#variantOptions").empty();var i=this.buildFontVariant(e);this.control.setCurrentFont(e),this.control.setCurrentFontVariant(i),t.$("#textFrame").css("font-family",i.htmlFontFamily),t.$("#fontButtonLabel").text(e.fontFamily)},i.prototype.onFontSelected=function(e){if(this.control.isLoaded){this.mouseState="click";var i="";t.isMobile()?i=t.$(e.currentTarget).val():(i=t.$(e.currentTarget).attr("data-font-label"),t.$("#fontButtonLabel").text(i));var o=t.fonts.getFont(i);this.updateFontSize(o),this.updateFontProperty("updateFont",o),t.$("#variantOptions").empty();var n=this.buildFontVariant(o),s=this.control.pageItemBlock,a=new t.actions.text.TextFontAction(this.control.currentFont,o,s);this.control.setCurrentFont(o),this.control.setCurrentFontVariant(n),t.$("#textFrame").css("font-family",n.htmlFontFamily),this.updateControl(),t.actionManager.addAction(a)}},i.prototype.cleanEmptyPElements=function(e){if("undefined"==typeof e&&(e=[]),e&&e.length>1&&this.control.paragraphs){var i,o,n=e.length-1,s="";for(n;n>-1&&(o=e.eq(n),s=t.$.trim(o.text()),0===s.length&&this.control.paragraphs.length===e.length);n--)e.splice(n,1),i=this.control.paragraphs.slice(),this.control.removeText(i[n])}},i.prototype.updateTextElements=function(e){"undefined"==typeof e&&(e=!1);var i,o={},n="<br>",s=this.control.instanceId,a=t.managers.InstanceManager.get(s),r=0,l=!1,h=!1,c=t.$("#textFrame div"),d=t.$.trim(t.$("#textFrame").text());if(0==d.length&&this.control.getRequired()===!0)return!1;if(e===!0&&this.cleanEmptyPElements(c),0==c.length){var p=t.$("#textFrame").html();if(e&&p.indexOf(n)>-1){a.clearAllText(),t.$("#textFrame").html(""),i=p.split(n);for(var u=0;u<i.length;u++)if(d=t.$.trim(i[u]),u<i.length-1){var g=a.newDefaultTextControl(d);t.$("#textFrame").append(g.toHtml())}return e}return l=this.control.setText(d,e)}for(var m=null,u=0;u<c.length;u++){var f=c.eq(u);r+=1.3*t.$(f).height();var v=f.attr("id"),y=t.utils.ObjectUtil.isUndefined(v)||0==v.length;if(y){var I=f.attr("class");if(!t.utils.ObjectUtil.isEmpty(I)&&"p1"==I&&u>0&&t.utils.ObjectUtil.notUndefined(m))a.updateText(Number(m.substring(1)),f.text(),e);else{var b=t.controls.ComponentFactory.createNewText(a,u,f);t.$(f).attr("id","p"+b.id)}}else if(t.utils.ObjectUtil.notUndefined(o[v])){var b=t.controls.ComponentFactory.createNewText(a,u,f);t.$(f).attr("id","p"+b.id),l=!0}else{o[v]="processed";var _=Number(v.substring(1)),p=f.html();if(p.indexOf(n)>-1){if(p=f.children().first().html(),i=p.split(n),d=t.$.trim(i[0]),l=a.updateText(_,d,e),e)for(var C=1;C<i.length;C++){d=t.$.trim(i[C]),0==d.length&&(d=" ");var g=a.newDefaultTextControl(d);h=!0,t.$("#textFrame").append(g.toHtml())}}else d=t.$.trim(f.text()),l=0==d.length&&0==u&&t.$("#textFrame").text().length>0&&c.length<2?!1:a.updateText(_,d,e);l===!0&&(h=!0)}m=v}return this.updateVerticalScroll(),h===!0&&(l=!0),l},i.prototype.getTextHeight=function(){for(var e=0,i=t.$("#textFrame p"),o=0;o<i.length;o++){var n=i.eq(o);e+=t.$(n).height()}return e},i.prototype.updateVerticalScroll=function(){var e=this.getTextHeight();e>this.control.scaledHeight()?t.$("#textFrame").css("overflow-y","scroll"):t.$("#textFrame").css("overflow-y","inherit")},i.prototype.cleanParagraphs=function(){for(var e=this.control.paragraphs,i=e.slice(),o=1;o<i.length;o++){var n=i[o],s=t.$("#p"+n.id).length;0==s&&this.control.removeText(n)}},i.prototype.commit=function(){t.isEdit=!1;var e=t.$.trim(t.$("#textFrame").text()),i=this.updateTextElements(!0);this.cleanParagraphs(),this.control.onEditEnd(),t.updateStage(),t.editorManager.hideText(),i===!0?(t.events.trigger(t.events.PRODUCT_PERSONALIZED),this.control.save(),this.createTextRevAction()):0==e.length&&(this.control.resetDefaultText(),this.control.pageItemBlock._defaultText||(this.control.save(),this.createTextRevAction())),t.events.trigger(t.events.ZOOM_UPDATE_IMAGE)},i.prototype.onDeleteClick=function(){t.isEdit=!1,t.utils.CanvasUtil.remove(this.control)},i.prototype.setOverflowStatus=function(e){var i=t.$("#textFrameWrapper > .overflow-warning"),o=t.$("#textFrameWrapper > .more-text");i[e?"show":"hide"](),o[e?"show":"hide"]()},i.prototype.updateFontProperty=function(e,i){t.events.trigger(t.events.PRODUCT_PERSONALIZED);var o=t.utils.HtmlUtil.getSelectedText().toString();if("undefined"!=typeof o&&0!=o.length&&"updateFontSize"!=e)for(var n=o.split("\n"),s=0;s<n.length;s++)for(var a=n[s],r=0;r<this.control.paragraphs.length;r++){var l=this.control.paragraphs[r];if(a.length>0&&l.text.indexOf(a)>-1){l[e](i),"updateColor"==e&&t.product.isSingleColor()||l.setNewStyleFlag();break}}else for(var r=0;r<this.control.paragraphs.length;r++){var l=this.control.paragraphs[r];l[e](i),"updateColor"==e&&t.product.isSingleColor()||l.setNewStyleFlag()}},i.prototype.updateAlignmentOption=function(e,i,o){t.$(e).data(o+"-align",i),t.$(e).html("<i class='sprite sprite-icon_align_text_"+i+"'></i>")},i.prototype.buildFontVariant=function(e){for(var i=null,o=null,n=0;n<e.variants.length;n++)i=e.variants[n],0==n?(t.$("#variantOptions").append("<option selected>"+i.styleScreenName+"</option>"),o=i):t.$("#variantOptions").append("<option>"+i.styleScreenName+"</option>");return o},i.prototype.updateControl=function(){t.editorManager.commit(),t.editorManager.showText(this.control),this.render()},i.prototype.createTextRevAction=function(){var e=this.control.prevPageItemBlock,i=this.control.prevStory,o=t.$.extend(!0,{},this.control.pageItemBlock),n=null;null!=this.control.story&&(n=t.$.extend(!0,{},this.control.story));var s=this.control.pageItemBlock,a=new t.actions.text.TextRevisionAction(e,i,o,n,s);t.actionManager.addAction(a)},i}(Backbone.View);e.TextEdit=i}(t.editors||(t.editors={}));t.editors}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.actions=null,this.cursors=null,this.maxTransactions=20,this.LOG_ME=!1,t.events.on(t.events.HISTORY_TRANSACTION_UNDO,this.undo,this),t.events.on(t.events.HISTORY_TRANSACTION_REDO,this.redo,this),t.events.on(t.events.HISTORY_TRANSACTION_INIT,this.initilize,this),t.events.on(t.events.HISTORY_TRANSACTION_CHECK,this.disableEnableUndoRedoEnable,this),t.events.on(t.events.HISTORY_SCENE_CHANGE,this.manageScene,this),t.events.on(t.events.REMOVE_IMAGE,this.removeImageControl,this)}return e.prototype.addAction=function(e){if(this.logMe("> add action"),this.actions){if(this.actions.length>=1){var i=this.actions[this.getCurrentLayoutId()];i&&0===i.length&&t.events.trigger(t.events.PRODUCT_CHANGED_BY_USER,!0)}}else this.initilize(),t.events.trigger(t.events.PRODUCT_CHANGED_BY_USER,!0);var o=this.getCurrentLayoutId();this.checkDuplicate(e)===!1&&(-1===this.maxTransactions||this.actions[o].length<this.maxTransactions?(this.cursors[o]++,this.actions[o].splice(this.getActionCursor(),this.getLayoutActionLength(),e)):(this.cursors[o]=this.maxTransactions-1,this.actions[o].splice(0,1),this.actions[o].push(e)),t.events.trigger(t.events.HISTORY_UNDO,"enable"),t.events.trigger(t.events.HISTORY_REDO,"disable"),this.logMe("< add action current postion "+this.cursors[o])),t.addToCartPreviewReady=!1},e.prototype.hasUndo=function(){return this.getLayoutActionLength()>0&&this.getActionCursor()>-1},e.prototype.hasRedo=function(){return this.getLayoutActionLength()>0&&this.getActionCursor()<this.getLayoutActionLength()-1},e.prototype.setTestingPlayback=function(t){this.maxTransactions=20,t===!0&&(this.maxTransactions=-1)},e.prototype.undo=function(){if(t.inPreviewMode===!0)return void this.logMe("In Preview Mode");if(-1===this.getActionCursor())return void this.logMe("already at beginning of undo stack");var e=this.getAction();e.undo(),this.cursors[this.getCurrentLayoutId()]--,-1===this.getActionCursor()&&t.events.trigger(t.events.HISTORY_UNDO,"disable"),t.events.trigger(t.events.HISTORY_REDO,"enable"),t.addToCartPreviewReady=!1},e.prototype.buildHistoryJSON=function(){var e="";try{for(var i,o=t.$.extend(!0,[],this.actions),n=0;n<o.length;n++)for(var s=0;s<o[n].length;s++)i=t.$.trim(o[n][s].pageItemBlock),o[n][s].pageItemBlock=JSON.parse(i);e=JSON.stringify(o)}catch(t){e="{'error':was not able to parse object to json "+t.toString()+"'}"}return e},e.prototype.redo=function(){if(t.inPreviewMode===!0)return void this.logMe("In Preview Mode");if(this.getActionCursor()===this.getLayoutActionLength()-1)return void this.logMe("already at end of redo stack");this.cursors[this.getCurrentLayoutId()]++;var e=this.getAction();e.redo(),t.events.trigger(t.events.HISTORY_UNDO,"enable"),this.getActionCursor()===this.getLayoutActionLength()-1&&t.events.trigger(t.events.HISTORY_REDO,"disable"),t.addToCartPreviewReady=!1},e.prototype.initilize=function(){this.logMe(" > HistoryManager.initilize"),t.events.trigger(t.events.HISTORY_UNDO,"disable"),t.events.trigger(t.events.HISTORY_REDO,"disable"),t.events.trigger(t.events.PRODUCT_CHANGED_BY_USER,!1),this.cursors=[],this.actions=[];for(var e=t.product.layouts.length,i=0;e>i;i++)this.cursors[i]=-1,this.actions[i]=[];this.logMe(" < HistoryManager.initilize")},e.prototype.getSceneLayout=function(){for(var e=0,i=0;i<t.product.manifest.scenes.length;i++)for(var o=0;o<t.product.manifest.scenes[i].length;o++)if(t.product.manifest.scenes[i][o]===t.product.activeLayout)return o;return e},e.prototype.getCurrentLayoutId=function(){var e=t.product.activeLayout;return t.product.manifest.isMultiScene===!0&&(e=this.getSceneLayout()),e},e.prototype.getLayoutActionLength=function(){return this.actions[this.getCurrentLayoutId()].length},e.prototype.getActionCursor=function(){return this.cursors[this.getCurrentLayoutId()]},e.prototype.getActions=function(){var t=[];return this.actions&&(t=this.actions[this.getCurrentLayoutId()]),t},e.prototype.getAction=function(){return this.getActions()[this.getActionCursor()]},e.prototype.checkDuplicate=function(t){var e=!1;if("ImageFlipAction"===t.actionType||"ImageRotateAction"===t.actionType)return!1;var i=this.actions[this.getCurrentLayoutId()][this.getLayoutActionLength()-1];return i&&t&&i.constructor.name===t.constructor.name&&null==i.control&&t.control&&i.control.id===t.control.id&&(JSON.stringify(t.newValue)===JSON.stringify(i.newValue)&&(e=!0),JSON.stringify(t.newValue)===JSON.stringify(i.prevValue)&&(e=!0)),this.logMe("is duplicate "+e),e},e.prototype.logMe=function(){this.LOG_ME===!0},e.prototype.disableEnableUndoRedoEnable=function(){this.cursors&&this.cursors[this.getCurrentLayoutId()]!==this.getLayoutActionLength()-1?t.events.trigger(t.events.HISTORY_REDO,"enable"):t.events.trigger(t.events.HISTORY_REDO,"disable"),this.cursors&&-1!==this.cursors[this.getCurrentLayoutId()]?t.events.trigger(t.events.HISTORY_UNDO,"enable"):t.events.trigger(t.events.HISTORY_UNDO,"disable")},e.prototype.removeImageControl=function(e){for(var i,o=t.$(e.currentTarget).attr("data-file-id"),n=this.getActions(),s=0;s<n.length;s++)n[s].getControlFromPageItem(),!n[s].control.imageAsset||n[s].control.imageAsset.imageId!==o&&n[s].control.imageAsset.fileId!==o||(n[s].control.deletable?(n.splice(s,1),this.cursors[this.getCurrentLayoutId()]--,i=!0,s--):(n[s].control.removeBitmap(!0),i=!0)),n[s].deAllocateControl();i===!0&&(this.cursors[this.getCurrentLayoutId()]===this.getLayoutActionLength()-1&&t.events.trigger(t.events.HISTORY_REDO,"disable"),-1===this.cursors[this.getCurrentLayoutId()]&&t.events.trigger(t.events.HISTORY_UNDO,"disable")),t.events.trigger(t.events.REMOVE_IMAGE_DONE,e)},e.prototype.manageScene=function(){this.getCurrentLayoutId()},e}();e.ActionManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.model={},t.events.on(t.events.LAST_LAYOUT,this.preloadAssets,this)}return e.prototype.loadBitmap=function(e,i,o){if("undefined"==typeof i&&(i=null),"undefined"==typeof o&&(o=null),null!=e){e=e.split("?")[0];var n;if(e in this.model&&null!=i)return void this.model[e].callbacks.push(i);e in this.model?n=this.model[e]:(n={},n.loaded=!1,n.deleted=!1,n.imageErrorTimeout=0,n.imageErrorCount=0,n.callbacks=[],n.errors=[],null!=i&&n.callbacks.push(i),null!=o&&n.errors.push(o),this.model[e]=n),n.bitmap=new createjs.Bitmap(t.utils.AppUtil.appendAuthToken(e)),n.bitmap.image.onload=function(){if(t.log("    CacheManager bitmap loaded. deleted: "+n.deleted+" Callback count: "+n.callbacks.length+" url: "+e),!n.deleted&&(0!=n.imageErrorTimeout&&clearTimeout(n.imageErrorTimeout),n.loaded=!0,n.image=n.bitmap.image,n.callbacks instanceof Array))for(var i=0;i<n.callbacks.length;i++)n.callbacks[i]()};var s=t._.bind(this.removeImage,this,e),a=2;n.bitmap.image.onerror=function(){if(n.imageErrorCount++,t.log(" > CacheManager.imageError() imageErrorCount: "+n.imageErrorCount),0!=n.imageErrorTimeout&&clearTimeout(n.imageErrorTimeout),n.imageErrorCount<=a)n.imageErrorTimeout=setTimeout(function(){t.cacheManager.loadBitmap(e)},750*n.imageErrorCount);else{for(var i=0;i<n.errors.length;i++)n.errors[i]();s()}}}},e.prototype.hasBitmap=function(t){return t=t.split("?")[0],t in this.model&&this.model[t].loaded},e.prototype.getBitmap=function(t){return t=t.split("?")[0],new createjs.Bitmap(this.model[t].bitmap.image)},e.prototype.getImage=function(t){return t=t.split("?")[0],this.model[t].image},e.prototype.setImage=function(t,e){t=t.split("?")[0],this.model[t]={bitmap:new createjs.Bitmap(e),image:e,loaded:!0,deleted:!1}},e.prototype.hasImage=function(t){return t=t.split("?")[0],t in this.model},e.prototype.removeImage=function(t){t=t.split("?")[0],this.model[t]&&(this.model[t].deleted=!0,delete this.model[t])},e.prototype.preloadAssets=function(){for(var e=1;e<t.product.layouts.length;e++)for(var i=t.product.layouts[e],o=0;o<i.pageItems.length;o++){var n=i.pageItems[o],s=n.VectorBlock||n.RasterBlock||null;if(null!=s&&s.Image){var a=s.Image._imageId,r=i.getImageAsset(a),l=t.utils.ImageUtil.getImageUrl(n,i);l=t.utils.ImageUtil.getImageUrlForResolution(l,n._type,r?r.isUgcImage:!1),r&&r.isUgcImage===!0&&(l=t.config.getFile()+l),this.loadBitmap(l)}}},e}();e.CacheManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.offlineDialogVisible=!1,t.app.views.dialogs.photoUpload=new t.views.dialogs.PhotoUpload,t.app.views.dialogs.error=new t.views.dialogs.Error,t.app.views.dialogs.peepsEditor=new t.views.dialogs.PeepsEditor,this.saveDialog=new t.views.dialogs.SaveDialog,this.upsellDialog=new t.views.dialogs.UpsellDialog,this.backOptionDialog=new t.views.dialogs.BackOptionsDialog,this.userDialog=new t.views.dialogs.UserDialog,this.confirmDialog=new t.views.dialogs.ConfirmDialog,this.testPreviewDialog=new t.views.dialogs.TestPreview,this.imageZoomDialog=new t.views.dialogs.ImageZoom,this.removeImageDialog=new t.views.dialogs.RemoveImageDialog,this.busyDialog=new t.views.dialogs.BusyDialog,this.sessionDialog=new t.views.dialogs.SessionDialog,this.offlineDialog=new t.views.dialogs.Offline,this.promoteBackgroundDialog=new t.views.dialogs.PromoteBackgroundDialog,this.cancelPeepDialog=new t.views.dialogs.CancelPeepSessionDialog,this.wizardDialog=new t.views.dialogs.WizardDialog,this.approveDialog=new t.views.dialogs.ApproveDialog}return e.prototype.displayOfflineDialog=function(){0==this.offlineDialogVisible&&(this.offlineDialogVisible=!0,this.offlineDialog.render())},e.prototype.hideOfflineDialog=function(){1==this.offlineDialogVisible&&(this.offlineDialog.hideDialog(),this.offlineDialogVisible=!1)},e.prototype.displayConfirmResetDialog=function(){this.confirmDialog.render()},e.prototype.displayPromoteBackgroundDialog=function(t){this.promoteBackgroundDialog.setEditor(t),this.promoteBackgroundDialog.render()},e.prototype.displayUploadDialog=function(){t.app.views.dialogs.photoUpload.render()},e.prototype.displayUploadDialogViaAdd=function(){t.app.views.dialogs.photoUpload.render(!0,!1)},e.prototype.displaySessionDialog=function(t,e){this.sessionDialog.callbackFunction=e,this.sessionDialog.message=t,this.sessionDialog.render()},e.prototype.displayBusyDialog=function(t,e){this.busyDialog.title=t,this.busyDialog.message=e,this.busyDialog.render()},e.prototype.displayDialog=function(t,e,i){this.displayError(t,e,i)},e.prototype.displayError=function(e,i,o){t.app.views.dialogs.error.title=t.utils.ObjectUtil.isEmpty(o)||"DEBUG"==o?e:e+" - "+o,t.app.views.dialogs.error.message=i,t.app.views.dialogs.error.render()},e.prototype.displaySaveDialog=function(){window.location.assign("#"),this.saveDialog.render()},e.prototype.displayUpsellDialog=function(){this.upsellDialog.render()},e.prototype.displayApproveDialog=function(){this.approveDialog.render()},e.prototype.displayBackOptionDialog=function(){this.backOptionDialog.render()},e.prototype.displayUserDialog=function(t){this.userDialog.show(t)},e.prototype.displayImageZoom=function(t){this.imageZoomDialog.image=t,this.imageZoomDialog.render()},e.prototype.displayRemoveImageDialog=function(t){this.removeImageDialog.removeEvent=t,this.removeImageDialog.render()},e.prototype.displayCancelPeepDialog=function(){this.cancelPeepDialog.render()},e.prototype.displayWizardDialog=function(){this.wizardDialog.render()},e}();e.DialogManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.visible=!1,this.container=new t.editors.ContainerEdit,this.text=new t.editors.TextEdit,this.image=new t.editors.ImageEdit,this.$text=t.$("#textEditor"),this.$image=t.$("#imageEditor"),this.$container=t.$("#containerEditor"),this.$textContainer=t.$("#textContainer"),this.$canvas=t.$("#appCanvas"),t.events.on(t.events.RESET_DESIGN,this.resetDesign,this),this.$text.hide(),this.$image.hide(),this.$container.hide(),this.$textContainer.hide()}return e.prototype.commit=function(){null!=this.active&&(this.active.commit(),t.zoomNav.updateSilent(),t.app.views.zoomControlView.fixZoom())},e.prototype.clear=function(){t.selections.clear(),this.hideAll()},e.prototype.resetDesign=function(){this.newToolbarPostion=null},e.prototype.updateCanvasMetrics=function(t){this.canvasMetrics=this.$canvas.position(),this.canvasMetrics.width=this.$canvas.width(),this.canvasMetrics.height=this.$canvas.height(),this.canvasMetrics.editorWidth=t+3,this.canvasMetrics.editorHeight=50},e.prototype.showContainer=function(e){this.$text.hide(),this.$image.hide(),this.$textContainer.hide(),this.commit(),this.container.setControl(e),this.active=this.container,this.visible=!0,this.positionEditor(this.$container,e),"bbox.controls.BackgroundImage"==e.type&&(this.visible=!1,this.$container.hide(),this.showImage(e)),this.updateCanvasMetrics(this.$container.width()),t.updateStage(),this.addContainerListeners()},e.prototype.showImage=function(e){this.$container.hide(),this.$text.hide(),this.$textContainer.hide(),this.commit(),this.image.setControl(e),this.active=this.image,this.visible=!0,"bbox.controls.BackgroundImage"==e.type?this.positionBackgroundEditor(this.$image,e):this.positionEditor(this.$image,e),this.$image.show(),this.updateCanvasMetrics(this.$image.width()),t.updateStage()},e.prototype.updateTextControl=function(){var e=t.utils.HtmlUtil.getProperty(t.$("#textFrame"),"height");this.text.updateTextElements();var i=t.utils.HtmlUtil.getProperty(t.$("#textFrame"),"height");this.updateTextEditor(i-e)},e.prototype.checkTextOverflow=function(t){this.updateTextControl(),this.text.cleanParagraphs(),t.warningCheck(),this.text.setOverflowStatus(t.shouldShowOverflowWarning())},e.prototype.showText=function(e){this.$image.hide(),this.$container.hide(),this.commit(),this.text.setControl(e),this.active=this.text;var i=!1,o=t.stageZoom.scaleX,n=t.stageZoom.scaleX,s=t.stageZoom.x,a=t.stageZoom.x,r=t.stageZoom.y,l=t.stageZoom.y;if(e.scaledWidth()+100>t.canvas.width){var h=t.stageZoom.scaleX;n=t.canvas.width/(1.5*e.scaledWidth())*h,a=t.stageZoom.x+e.x*h-e.x*n,l=t.stageZoom.y+e.y*h-e.y*n,i=t.zoomNav.isAutoZoom()}else if(e.scaledWidth()<t.canvas.width/8){var h=t.stageZoom.scaleX;n=t.canvas.width/(1.5*e.scaledWidth())*h,a=t.stageZoom.x+e.x*h-e.x*n,l=t.stageZoom.y+e.y*h-e.y*n,i=t.zoomNav.isAutoZoom()}t.log(o+":"+n),t.log(s+":"+a),t.log(r+":"+l),1==i?createjs.Tween.get(t.stageZoom,{onChange:t.updateStage,useTicks:!1}).to({x:a,y:l,scaleX:n,scaleY:n},2e3,createjs.Ease.cubicIn).call(t.editorManager.showTextComplete,[e,!0],t.editorManager):this.showTextComplete(e)},e.prototype.encodeChar=function(e){"undefined"==typeof e&&(e="");var i=e.charCodeAt(0),o=t.fonts.getApprovedChars();switch(e){case"\n":return e;case"\r":return e;case"'":return e;case'"':return e;case"\\":return e;case"	":return e;case"\b":return e;case"\f":return e}if(i>127){for(var n=i.toString(16).toLowerCase();n.length<4;)n="0"+n;i="&#x"+n+";",i=o[i],"string"!=typeof i&&(e="#R")}return e},e.prototype.findSpecialCharsReplace=function(e){"undefined"==typeof e&&(e="");var i,o=0,n=0,s=0,a="";for(t.$("#textClean").empty(),t.$("#textClean").html(e),e=t.$("#textClean").text(),t.$("#textClean").empty(),n=e.length,s=0;n>s;s++)i=this.encodeChar(e[s]),"#R"===i?(a+="#",o++):a+=e[s];if(o>0){var r="The text was to be pasted contained characters which are not supported by the current font.  "+o+" unsupported characters have been replaced with hash signs. ";t.dialogs.displayError('<i class="sprite sprite-icon sprite-icon_validation"></i> Unsupported Characters!',r)}return a},e.prototype.showTextComplete=function(e,i){"undefined"==typeof i&&(i=!1),e.visible=!1,t.zoomNav.zoomView.visible=!1,t.updateStage(!0),this.visible=!0;var o=e.getHtml();this.$textContainer.html(o),t.$("#textFrameWrapper > .overflow-warning, #textFrameWrapper > .more-text")[e.shouldShowOverflowWarning()?"show":"hide"]();var n=t.$("#textFrame");n.css("height",e.scaledHeight()),n.css("width",e.scaledWidth()),n.css("text-alignment",e.horizontalAlign),o.keyup(function(e){13==e.keyCode&&t.editorManager.updateTextControl()}),o.on("paste",function(e){{var i=!0,o=e.originalEvent.clipboardData,n=e.originalEvent.clipboardData.types,s=o.getData("Text");this.innerHTML}if(s&&s.length>0){if(n&&n.length>0)for(var a,r=0;r<n.length;r++)if(a=n[r].split("/"),i=!1,"image"===a[0]){i=!0;break}i===!1&&(e.preventDefault(),s=t.editorManager.findSpecialCharsReplace(s),document.execCommand("insertText",!1,s),t.editorManager.updateTextControl())}i===!0&&e.preventDefault()}),o.on("drop",function(t){t.preventDefault()}),this.positionEditor(this.$text,e),this.positionTextEditor(this.$textContainer,e),this.$textContainer.show(),this.$text.show(),t.editorManager.text.updateVerticalScroll(),this.selectAllText(),i&&(t.log("triggerZoomUpdate onComplete"),t.app.views.zoomControlView.fixZoom(),t.zoomNav.center={x:t.stageZoom.x,y:t.stageZoom.y,scale:t.stageZoom.scaleX}),this.updateCanvasMetrics(this.$text.width()),this.addTextContainerListeners()},e.prototype.selectAllText=function(){var e=document.getElementById("textFrame"),i=e.firstChild,o=e.lastChild,n=document.createRange();t.$(e).trigger("focus"),n.setStartBefore(i),n.setEndAfter(o);var s=window.getSelection();s.removeAllRanges(),s.addRange(n)},e.prototype.isTextActive=function(){return this.active==this.text},e.prototype.hideContainer=function(){this.visible=!1,this.$container.hide()},e.prototype.hideImage=function(){this.visible=!1,this.$image.hide()},e.prototype.hideText=function(){this.text.control&&!this.text.control.visible&&(this.text.control.visible=!0),this.visible=!1;var t=window.getSelection();t.removeAllRanges(),this.$text.hide(),this.$textContainer.hide(),this.active=null
},e.prototype.hideAll=function(){this.hideContainer(),this.hideText(),this.hideImage()},e.prototype.positionEditor=function(e,i){var o,n,s=this.getOffsets();"undefined"!=typeof i.model&&"undefined"!=typeof i.model.container?(o=i.x-i.model.container.width/2,n=i.y-i.model.container.height/2+i.model.container.height+3):(o=i.x-i.regX,n=i.y+i.height-i.regY+3);var a,r,l=t.stage.localToGlobal(o,n),h=t.stage.localToGlobal(0,0),c=t.stage.localToGlobal(t.product.activeData.width,t.product.activeData.height),d=this.$canvas.position(),p=this.$canvas.width(),u=this.$canvas.height();if(l.x<h.x||l.x>c.x||l.y<h.y||l.y>c.y||l.x+s.xOffset<d.left||l.x+s.xOffset>d.left+p||l.y+s.yOffset<d.top||l.y+s.yOffset>d.top+u)a=this.pxOffset(p/2+s.xOffset-e.width()/2),r=this.pxOffset(50+s.yOffset);else if(this.newToolbarPostion&&t.isMobile()===!1)a=this.newToolbarPostion.x,r=this.newToolbarPostion.y;else{var g=i.width*t.stageZoom.scaleX/2+l.x+s.xOffset;a=this.pxOffset(g-e.width()/2),r=this.pxOffset(l.y+s.yOffset-e.height()+50)}e.css("left",a),e.css("top",r)},e.prototype.positionBackgroundEditor=function(e){var i=this.getOffsets(),o=t.stage.localToGlobal(t.product.activeData.width/2,t.product.activeData.height),n=o.x+i.xOffset-e.width()/2,s=o.y+i.yOffset-e.height();e.css("left",this.pxOffset(n)),e.css("top",this.pxOffset(s))},e.prototype.positionTextEditor=function(e,i){var o=this.getOffsets(),n=t.stage.localToGlobal(i.x-i.regX,i.y-i.regY),s=n.x+o.xOffset,a=n.y+o.yOffset;e.css("left",this.pxOffset(s)),e.css("top",this.pxOffset(a))},e.prototype.updateTextEditor=function(e){var i=t.utils.HtmlUtil.getProperty(this.text.$el,"top");i+=e,this.text.$el.css("top",i)},e.prototype.adjGlobalToolBarPostion=function(t,e){var i=parseInt(t.x,10),o=parseInt(t.y,10),n=parseInt(e.x,10),s=parseInt(e.y,10);(this.getRatioToolbarMove(i,n)>=.1||this.getRatioToolbarMove(o,s)>=.1)&&(this.newToolbarPostion=e)},e.prototype.getRatioToolbarMove=function(t,e){var i=0,o=Math.abs(t-e);return i=o/t,i=.1*(10*i<<0)},e.prototype.pxOffset=function(e){return t.utils.HtmlUtil.getDomCompliantValue(e)+"px"},e.prototype.getOffsets=function(){var e=t.$("#sidebar").width(),i=t.$("#sidebar").is(":visible")?e:0,o=t.$("#toolbar").height();return{xOffset:i,yOffset:o}},e.prototype.addContainerListeners=function(){var e;t.$("#containerEditor #ce_Drag").off("mousedown mouseup touchstart touchend"),t.$("#containerEditor #ce_Drag").on("mousedown touchstart",function(){e={x:t.$("#containerEditor").css("left"),y:t.$("#containerEditor").css("top")}}).on("mouseup touchend",function(){var i={x:t.$("#containerEditor").css("left"),y:t.$("#containerEditor").css("top")};t.editorManager.adjGlobalToolBarPostion(e,i)})},e.prototype.addTextContainerListeners=function(){var e;t.$("#textEditor .drag_handle").off("mousedown mouseup touchstart touchend"),t.$("#textEditor .drag_handle").on("mousedown touchstart",function(){e={x:t.$("#textEditor").css("left"),y:t.$("#textEditor").css("top")}}).on("mouseup touchend",function(){var i={x:t.$("#textEditor").css("left"),y:t.$("#textEditor").css("top")};t.editorManager.adjGlobalToolBarPostion(e,i)})},e}();e.EditorManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.SESSION_TIMEOUT="ERR_1999",this.PRODUCT_NOT_LOADABLE="ERR_4000",this.PRODUCT_OPTIONS_UNAVAIL="ERR_4001",this.CHANNEL_CONFIG_UNAVAIL="ERR_4002",this.FONTS_UNAVAIL="ERR_4003",this.IMAGE_LIB_UNAVAIL="ERR_4004",this.PEEP_LIBR_UNAVAIL="ERR_4005",this.PEEP_IMAGE_UNAVAIL="ERR_4006",this.MAX_IMAGES_REACHED="ERR_1601",this.EMAIL_MISMATCH="ERR_1104",this.INVALID_EMAIL="ERR_1100",this.INVALID_PASSWORD_FMT="ERR_1102",this.PASSWORD_MISMATCH="ERR_1101",this.AUTHENTICATION_SVC_FAILURE="",this.GENERAL_LOGIN_FAILURE="",this.catalog=null}return e.prototype.loadCatalog=function(){t.ajax({url:t.config.errorLookup()+"?all=true",headers:t.config.getRequestHeaders(),dataType:"json",success:function(e){t.errors.catalog=e.atgResponse.allErrCodesWithMsgs,t.events.trigger(t.events.ERROR_CATALOG_COMPLETE,e)}})},e.prototype.parse=function(t){var e=t.indexOf("ERR_"),i=t.indexOf("-",e),o=t.substring(e,i);return null!=this.catalog&&this.catalog.hasOwnProperty(o)?this.catalog[o]:t.substring(i+1)},e.prototype.error=function(e,i){"undefined"==typeof i&&(i=!1),t.errors.log(e,"ERROR",i)},e.prototype.warning=function(e,i){"undefined"==typeof i&&(i=!1),t.errors.log(e,"WARNING",i)},e.prototype.info=function(e,i){"undefined"==typeof i&&(i=!1),t.errors.log(e,"INFO",i)},e.prototype.debug=function(e,i){"undefined"==typeof i&&(i=!1),t.errors.log(e,"DEBUG",i)},e.prototype.log=function(e,i,o){var n;n=t.errors.catalog[e]?t.errors.catalog[e]:e,o&&t.dialogs.displayError(e,n,i);var s={messageCode:e,messageText:n,messageType:i};t.config.networkName()&&(s.siteId=t.config.networkName()),t.config.profileID()&&(s.profileId=t.config.profileID()),t.config.productID()&&(s.productId=t.config.productID()),t.config.skuID()&&(s.skuId=t.config.skuID()),t.ajax({url:t.config.errorLog(),headers:t.config.getRequestHeaders(),data:s,dataType:"json",success:function(e){t.events.trigger(t.events.ERROR_LOGGING_COMPLETE,e)}})},e}();e.ErrorManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.INIT="APP_INIT",this.CHANNEL="APP_CHANNEL",this.TOKEN_GENERATED="APP_TOKEN_GENERATED",this.PRODUCT="APP_PRODUCT",this.COMPLETE="APP_COMPLETE",this.MANIFEST="MANIFEST_LOADED",this.LAST_LAYOUT="LAST_LAYOUT",this.LOAD_LAYOUT_FAILED="LOAD_LAYOUT_FAILED",this.WINDOW_RESIZE="APP_WINDOW_RESIZE",this.WINDOW_RESIZED="APP_WINDOW_RESIZED",this.LIBRARY_IMAGES_LOADED="APP_LIBRARY_IMAGES_LOADED",this.SET_COLOR="APP_SET_COLOR",this.FONT_MAP_LOADED="APP_FONT_MAP_LOADED",this.FONT_SET_LOADED="APP_FONT_SET_LOADED",this.USER_IMAGES_LOADED="APP_USER_IMAGES_LOADED",this.USER_IMAGE_REMOVED="APP_USER_IMAGE_REMOVED",this.KEYWORD_SEARCH="APP_KEYWORD_SEARCH",this.ERROR_CATALOG_COMPLETE="APP_ERROR_CATALOG_COMPLETE",this.ERROR_LOGGING_COMPLETE="APP_ERROR_LOGGING_COMPLETE",this.USER_REGISTER_COMPLETE="APP_USER_REGISTER_COMPLETE",this.USER_REGISTER_FAILED="APP_USER_REGISTER_FAILED",this.USER_LOGIN_FAILED="APP_USER_LOGIN_FAILED",this.USER_LOGIN_COMPLETE="APP_USER_LOGIN_COMPLETE",this.USER_SAVE_PREVIEW_COMPLETE="APP_USER_SAVE_PREVIEW_COMPLETE",this.USER_SAVE_COMPLETE="APP_USER_SAVE_COMPLETE",this.USER_LOAD_SAVED_ITEM_COMPLETE="APP_USER_LOAD_SAVED_ITEM_COMPLETE",this.USER_LOAD_CART_ITEM_COMPLETE="APP_USER_LOAD_CART_ITEM_COMPLETE",this.USER_ADD_TO_CART_PREVIEW_COMPLETE="APP_USER_ADD_TO_CART_PREVIEW_COMPLETE",this.USER_ADD_TO_CART_COMPLETE="APP_USER_ADD_TO_CART_COMPLETE",this.ADD_TEXT="APP_ADD_TEXT",this.IMAGE_UPLOADED="IMAGE_UPLOADED",this.ADD_IMAGES="APP_ADD_IMAGES",this.IMAGE_ADDED="IMAGE_ADDED",this.BACKGROUND_IMAGE_ADDED="BACKGROUND_IMAGE_ADDED",this.REFRESH_IMAGE_STATE="REFRESH_IMAGE_STATE",this.ADD_IMAGE_CONTAINER="ADD_IMAGE_CONTAINER",this.CHANGE_BACKGROUND="CHANGE_BACKGROUND",this.RESET_DESIGN="RESET_DESIGN",this.RESET_DESIGN_COMPLETE="RESET_DESIGN_COMPLETE",this.IMAGE_COUNT_CHANGED="IMAGE_COUNT_CHANGED",this.OPTIONS_LOADED="OPTIONS_LOADED",this.PRODUCT_PERSONALIZED="PRODUCT_PERSONALIZED",this.UPDATE_UI="UPDATE_UI",this.UPDATE_ASSET_TABS="UPDATE_ASSET_TABS",this.PAPERSTOCK_CHANGED="PAPERSTOCK_CHANGED",this.LOAD_GRAPHICS_MODAL="LOAD_GRAPHICS_MODAL",this.UPSELL_OPTIONS_CHANGE="UPSELL_OPTIONS_CHANGE",this.SWITCH_CURRENT_LAYOUT="SWITCH_CURRENT_LAYOUT",this.SWITCH_IMAGE="SWITCH_IMAGE",this.CHECK_FOR_FONT_UPDATE="CHECK_FOR_FONT_UPDATE",this.RELATED_PRODUCTS_LOADED="RELATED_PRODUCTS_LOADED",this.SEARCH_RESULTS_LOADED="SEARCH_RESULTS_LOADED",this.RESET_BACKGROUND="RESET_BACKGROUND",this.UNSELECT_BACKGROUND="UNSELECT_BACKGROUND",this.RESET_BACKGROUND_IMAGE="RESET_BACKGROUND_IMAGE",this.RESET_BACKGROUND_COLOR="RESET_BACKGROUND_COLOR",this.SWAP_BACKGROUND_IMAGE="SWAP_BACKGROUND_IMAGE",this.CHANGE_BACKGROUND_COLOR="CHANGE_BACKGROUND_COLOR",this.CREATE_BACKGROUND_IMAGE="CREATE_BACKGROUND_IMAGE",this.CREATE_BACKGROUND_COLOR="CREATE_BACKGROUND_COLOR",this.DISABLE_BACKGROUND="DISABLE_BACKGROUND",this.ON_DROP_ADD_IMAGE="ON_DROP_ADD_IMAGE",this.REMOVE_IMAGE="REMOVE_IMAGE",this.REMOVE_IMAGE_DONE="REMOVE_IMAGE_DONE",this.LIBRARY_STOCK_IMAGES_DATA_LOADED="LIBRARY_STOCK_IMAGES_DATA_LOADED",this.ZOOM_LEVEL_UPDATE="ZOOM_LEVEL_UPDATE",this.ZOOM_LEVEL_UPDATE_SILENT="ZOOM_LEVEL_UPDATE_SILENT",this.ZOOM_UPDATE_IMAGE="ZOOM_UPDATE_IMAGE",this.ZOOM_FIT="ZOOM_FIT",this.ZOOM_AUTO_FEATURE="ZOOM_AUTO_FEATURE",this.USER_UPDATE_UGCPATH="USER_UPDATE_UGCPATH",this.WALMART_REGISTER_LOGO="WALMART_REGISTER_LOGO",this.PRELOAD_GRAPHICS="PRELOAD_GRAPHICS",this.PRELOAD_BACKGROUNDS="PRELOAD_BACKGROUNDS",this.IMAGE_ADD_STATE_CHANGE="IMAGE_ADD_STATE_CHANGE",this.PEEPS_LIBRARY_LOADED="PEEPS_LIBRARY_LOADED",this.PEEPS_ON_DROP_ADD="PEEPS_ON_DROP_ADD",this.PEEPS_SVG_LOADED="PEEPS_SVG_LOADED",this.PEEPS_REMOVE_PEEP="PEEPS_REMOVE_PEEP",this.PEEPS_ADDED_PEEP="PEEPS_ADDED_PEEP",this.PEEPS_SWAP_PEEP="PEEPS_SWAP_PEEP",this.PEEPS_RECALCULATE_HEIGHT="PEEPS_RECALCULATE_HEIGHT",this.PEEPS_RECALCULATE_FAMILY_SIZE="PEEPS_RECALCULATE_FAMILY_SIZE",this.PEEPS_SPACING_ADJUSTMENT="PEEPS_SPACING_ADJUSTMENT",this.PEEPS_UI_SCALE="PEEPS_UI_SCALE",this.PEEPS_COLOR_CHANGE="PEEPS_COLOR_CHANGE",this.PEEPS_TEXT_CHANGE="PEEPS_TEXT_CHANGE",this.PEEPS_SET_ATTRIBUTES="PEEPS_SET_ATTRIBUTES",this.PEEPS_HIDE_ATTRIBUTES="PEEPS_HIDE_ATTRIBUTES",this.PEEPS_LOAD="PEEPS_LOAD",this.PEEPS_FONT_CHANGE="PEEPS_FONT_CHANGE",this.PEEPS_UGC_LIST_LOADED="PEEPS_UGC_LIST_LOADED",this.PEEPS_REMOVE="PEEPS_REMOVE",this.PEEPS_MOVE_LEFT="PEEPS_MOVE_LEFT",this.PEEPS_MOVE_RIGHT="PEEPS_MOVE_RIGHT",this.PEEPS_CLEANSE="PEEPS_CLEANSE",this.PEEPS_CANCEL_CONFIRM="PEEPS_CANCEL_CONFIRM",this.PEEPS_ADD_MOBILE_PEEP="PEEPS_ADD_MOBILE_PEEP",this.PEEPS_SHOW_EDITOR_BACKGROUND="PEEPS_SHOW_EDITOR_BACKGROUND",this.PEEPS_ADD_DOUBLE_CLICK="PEEPS_ADD_DOUBLE_CLICK",this.PEEPS_UPDATE_STAGE="PEEPS_UPDATE_STAGE",this.PEEPS_LOGIN_COMPLETE="PEEPS_LOGIN_COMPLETE",this.ADD_TO_CART_PREVIEW_UPLOADED="ADD_TO_CART_PREVIEW_UPLOADED",this.HISTORY_TRANSACTION="HISTORY_TRANSACTION",this.HISTORY_TRANSACTION_UNDO="HISTORY_TRANSACTION_UNDO",this.HISTORY_TRANSACTION_REDO="HISTORY_TRANSACTION_REDO",this.HISTORY_TRANSACTION_INIT="HISTORY_TRANSACTION_INIT",this.HISTORY_TRANSACTION_CHECK="HISTORY_TRANSACTION_CHECK",this.HISTORY_SCENE_CHANGE="HISTORY_SCENE_CHANGE",this.WIZARD_DISPLAY="WIZARD_DISPLAY",this.PRODUCT_CHANGED_BY_USER="PRODUCT_CHANGED_BY_USER",this.REQUIRED_CONTROL_INITIALIZED="REQUIRED_CONTROL_INITIALIZED",this.CONTROL_INTERACTED="CONTROL_INTERACTED",this.HISTORY_UNDO="HISTORY_UNDO",this.HISTORY_REDO="HISTORY_REDO",this.REQUIRED_ITEMS_VALID="REQUIRED_ITEMS_VALID",this.REQUIRED_ITEMS_INVALID="REQUIRED_ITEMS_INVALID",this.SCENE_VISIBILITY_CHANGED="SCENE_VISIBILITY_CHANGED",this.STAGE_LOCK_CHANGED="STAGE_LOCK_CHANGED",t._.extend(this,Backbone.Events)}return e}();e.EventManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.globalFontMap=null,this.fontSet=null,this.kerning={},this.replacementFonts=[],this.fontBehaviorMap={}}return e.prototype.isReady=function(){return null!=t.fonts.globalFontMap&&null!=t.fonts.fontSet},e.prototype.getFont=function(e){var i=t.fonts.globalFontMap[e];return null==i||null==i.cssUrl||0==i.cssUrl.length||i.isLoaded?i&&i.isLoaded:(t.$("head").append(t.$("<link/>",{href:i.cssUrl,rel:"stylesheet"})),i.isLoaded=!0,this.loadKerning(i)),i},e.prototype.getFontByCssLabel=function(t){return this.htmlVariantMap[t]},e.prototype.getFontPreview=function(e){var i=t.fonts.globalFontMap[e];return t.utils.ObjectUtil.isUndefined(i)?"":i.getPreview()},e.prototype.getApprovedChars=function(){var t={"&#x201c;":"","&#x201d;":"","&#x2018;":"","&#x2019;":"","&#x20ac;":"","&#x201a;":"","&#x0192;":"","&#x201e;":"","&#x2026;":"","&#x2020;":"","&#x2021;":"","&#x02c6;":"","&#x2030;":"","&#x0160;":"","&#x2039;":"","&#x0152;":"","&#x2013;":"","&#x2014;":"","&#x02dc;":"","&#x2122;":"","&#x0161;":"","&#x203a;":"","&#x0153;":"","&#x017e;":"","&#x0178;":"","&#x00a1;":"","&#x00a2;":"","&#x00a3;":"","&#x00a4;":"","&#x00a5;":"","&#x00a6;":"","&#x00a7;":"","&#x00a8;":"","&#x00a9;":"","&#x00ae;":"","&#x00b0;":"","&#x00b9;":"","&#x00aa;":"","&#x00ab;":"","&#x00ac;":"","&#x2310;":"","&#x00b1;":"","&#x00b2;":"","&#x00b3;":"","&#x00b4;":"","&#x00b5;":"","&#x00b6;":"","&#x2022;":"","&#x00b8;":"","&#x00ba;":"","&#x00bb;":"","&#x00bc;":"","&#x00bd;":"","&#x00be;":"","&#x00bf;":"","&#x00c0;":"","&#x00c1;":"","&#x00c2;":"","&#x00c3;":"","&#x00c4;":"","&#x00c5;":"","&#x00c6;":"","&#x00c7;":"","&#x00c8;":"","&#x00c9;":"","&#x00ca;":"","&#x00cb;":"","&#x00cc;":"","&#x00cd;":"","&#x00ce;":"","&#x00cf;":"","&#x00d0;":"","&#x00d1;":"","&#x00d2;":"","&#x00d3;":"","&#x00d5;":"","&#x00d6;":"","&#x00d7;":"","&#x00d8;":"","&#x00d9;":"","&#x00da;":"","&#x00db;":"","&#x00dc;":"","&#x00dd;":"","&#x00df;":"","&#x00e0;":"","&#x00e1;":"","&#x00e2;":"","&#x00e3;":"","&#x00e4;":"","&#x00e5;":"","&#x00e6;":"","&#x00e7;":"","&#x00e8;":"","&#x00e9;":"","&#x00ea;":"","&#x00eb;":"","&#x00ec;":"","&#x00ed;":"","&#x00ee;":"","&#x00ef;":"","&#x00f0;":"","&#x00f1;":"","&#x00f2;":"","&#x00f3;":"","&#x00f4;":"","&#x00f5;":"","&#x00f6;":"","&#x00f7;":"","&#x00f8;":"","&#x00f9;":"","&#x00fa;":"","&#x00fb;":"","&#x00fc;":"","&#x00fd;":"","&#x00fe;":"","&#x00ff;":""};return t},e.prototype.getRightPaddingOffset=function(t){return"corsiva_mt_std"==t.id?2:"snell_roundhand_lt_std"==t.id?1:"mahogany_script_std"==t.id?1:0},e.prototype.getLeftPaddingOffset=function(t){return"wendy_lp_medium"==t.id?3:"amadeo_std"==t.id?1:0},e.prototype.getBottomPaddingOffset=function(t){return"helvetica_neue_lt_std"==t.id?1:"apricot"==t.id?9:"kristen_normal_itc_std"==t.id?3:"new_century_schoolbook_lt_pro"==t.id||"new_century_schoolbook_lt_std"==t.id?1:"copperplate_gothic_lt_pro"==t.id||"copperplate_gothic_std"==t.id?-3:0},e.prototype.getVerticalAlignment=function(t,e){return e},e.prototype.requiredRightPadding=function(t){var e="",i={snell_roundhand_lt_std:{px:2},serlio_lt_std:{px:2},mahogany_script_std:{px:2},corsiva_mt_std:{px:2},thirsty_rough:{px:3},bickham_script_pro:{px:2},edwardian_script_itc_std:{px:2},melany_lane:{px:2},mr_sheffield:{px:2},apricot:{px:2},dartangnon_itc_std:{px:2}};return i[t]&&(e=i[t]),e},e.prototype.getHeightOffset=function(e,i,o){"undefined"==typeof i&&(i=0),"undefined"==typeof o&&(o="");var n=0,s=0,a=this.fontBehaviorMap[e.id+":"+o];if(a){n=a.baseOffset;var r=t.isWindows();a.startSize&&i<a.startSize&&(n=0,s=0),r===!1&&a.linuxFactor?s=a.linuxFactor:r===!0&&a.winFactor&&(s=a.winFactor)}return t.isFirefox()?n:n+Math.round(i*s)},e.prototype.getBottomAlignOffset=function(t,e){"undefined"==typeof e&&(e=0);var i=0;return"snell_roundhand_lt_std"==t.id&&(i=3),i},e.prototype.isProblemFont=function(t){return"corsiva_mt_std"==t.id||"helvetica_neue_lt_std"==t.id},e.prototype.loadGlobalFontMap=function(){this.htmlVariantMap={};var e=t.config.globalFontMapURL();t.ajax({url:e,headers:t.config.getRequestHeaders(),dataType:"json",success:function(e){for(var i=e.fonts,o=i.Font,n={},s=0,a=0;a<o.length;a++){var r=o[a],l=new t.model.Font(r);n[l.fontFamily]=l;for(var h=0;h<l.variants.length;h++){var c=l.variants[h];t.fonts.htmlVariantMap[c.htmlFontFamily]=l}s+=l.variants.length}t.fonts.globalFontMap=n,t.events.trigger(t.events.FONT_MAP_LOADED)}})},e.prototype.loadVerticaleOffsets=function(){var e=t.config.getFontVertical();t.ajax({url:e,headers:t.config.getRequestHeaders(),dataType:"json",success:function(e){e&&(t.fonts.fontBehaviorMap=e),t.fonts.loadGlobalFontMap()},error:function(){t.fonts.loadGlobalFontMap()}})},e.prototype.loadFontSet=function(e){var i=t.config.getFontSet()+"/?format=json&name="+e;t.utils.AppUtil.isLocalhost()&&(i=t.config.getFontSet()+"/"+e+"?format=json"),t.ajax({url:i,headers:t.config.getRequestHeaders(),dataType:"json",success:function(e){var i=new t.model.FontSet(e);t.fonts.fontSet=i,t.events.trigger(t.events.FONT_SET_LOADED)}})},e.prototype.loadKerning=function(e){var i;t.log(e);for(var i in e.variants)t.log(e.variants[i].htmlFontFamily),this.loadKerningVariant(e,e.variants[i])},e.prototype.loadKerningVariant=function(e,i){var o=t.config.getFontKerningUrl(i.htmlFontFamily);t.log("> Font Manager: loading kerning variant at "+o),t.ajax({url:o,headers:t.config.getRequestHeaders(),dataType:"text",success:function(e){var n,s,a,r=e.split("\n"),l=null;for(var h in r){l=r[h],n=l.split("|"),s=parseInt(n.shift());for(var c in n)a=n[c],a&&(a=a.replace(/[\n\r]/g,"")),i.kerning[a]=s}i.isKerningLoaded=!0,i.callbacks.map(function(t){t[0][t[1]]()}),i.callbacks=[],t.log("<> kern set loaded at "+o)}})},e.prototype.loadFontReplacements=function(){var e=t.config.getFontReplacements()+"?format=json";t.ajax({url:e,headers:t.config.getRequestHeaders(),dataType:"json",error:function(){t.log("error loading getFontReplacement service at:"+e)},success:function(e){if(e&&e.ReplacementFonts)if(t.utils.ObjectUtil.notUndefined(e.ReplacementFonts)){t.log("Loaded Replacement Fonts data");for(var i=e.ReplacementFonts,o=[],n=i.length,s=0;n>s;s++){var a=new t.model.FontReplacementObject;a.OriginalFamily=i[s].OriginalFamily,a.ReplacementFamily=i[s].ReplacementFamily,a.ReplacementDate=i[s].ReplacementDate,o.push(a)}t.fonts.replacementFonts=o}else t.log("failed to load Replacement Fonts, ReplacementFonts may be undefined");else t.log("failed to load Replacement Fonts, possible AuthError or other unexpected data")}})},e}();e.FontManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.tips={},this.currentShowing=[],this.nextShowing=[],this.workflowHints=[],t.events.on(t.events.REQUIRED_CONTROL_INITIALIZED,this.onRequiredControlInitialized,this),t.events.on(t.events.COMPLETE,this.onComplete,this),t.events.on(t.events.RESET_DESIGN_COMPLETE,this.onResetDesignCompleted,this),t._.bind(this.initializeWorkflowHints,this)()}return e.prototype.resetTips=function(){for(var t=0;t<this.workflowHints.length;t++){var e=this.workflowHints[t];e.reset()}for(var i in this.tips){var o=this.tips[i];o.reset()}},e.prototype.onResetDesignCompleted=function(){this.resetTips(),this.onSwitchCurrentLayout(null,!1)},e.prototype.onRequiredControlInitialized=function(e,i){this.tips.hasOwnProperty(e._id)||(this.tips[e._id]=new t.model.RequiredFieldTip,this.tips[e._id].init(i)),this.tips[e._id].shouldShow(e)&&this.nextShowing.push(this.tips[e._id])},e.prototype.onComplete=function(){Object.keys(this.tips).length>0&&(t._.bind(this.showTips,this,this.nextShowing)(),this.currentShowing=this.nextShowing.slice(0),this.nextShowing=[]),this.workflowHints.length>0&&t._.bind(this.showWorkflowHints,this,this.workflowHints)(),t.events.on(t.events.SWITCH_CURRENT_LAYOUT,this.onSwitchCurrentLayout,this),t.events.on(t.events.WINDOW_RESIZED,this.refreshCurrentTips,this),t.events.on(t.events.ZOOM_LEVEL_UPDATE,this.refreshCurrentTips,this),t.events.on(t.events.CONTROL_INTERACTED,this.onControlInteracted,this),t.updateStage()},e.prototype.refreshCurrentTips=function(){t._.bind(this.hideTips,this,this.currentShowing)(),t._.bind(this.showTips,this,this.currentShowing)(),t._.bind(this.hideWorkflowHints,this,this.workflowHints.filter(function(t){return"canvas"===t.type}),!1)(),t._.bind(this.showWorkflowHints,this,this.workflowHints.filter(function(t){return"canvas"===t.type}))(),t.updateStage()},e.prototype.onSwitchCurrentLayout=function(e,i){"undefined"==typeof i&&(i=!0),t._.bind(this.hideTips,this,this.currentShowing)(),t._.bind(this.showTips,this,this.nextShowing)(),t._.bind(this.hideWorkflowHints,this,this.workflowHints,i)(),t._.bind(this.showWorkflowHints,this,this.workflowHints)(),this.currentShowing=this.nextShowing.slice(0),this.nextShowing=[],t.updateStage()},e.prototype.onControlInteracted=function(e){if(e._required&&e._userInteracted&&this.tips.hasOwnProperty(e._id)){var i=[];i.push(this.tips[e._id]),t._.bind(this.hideTips,this,i)(),t.updateStage()}},e.prototype.hideTips=function(t){for(var e in t)t[e].hide()},e.prototype.showTips=function(e){for(var i in e)e[i].show(t.controls.ComponentFactory.lookupControlById(e[i].getPageItemId()))},e.prototype.hideWorkflowHints=function(t,e){"undefined"==typeof e&&(e=!1);for(var i=0;i<t.length;i++){var o=t[i];"canvas"===o.type&&o.hide(e)}},e.prototype.showWorkflowHints=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.showHint(i)}},e.prototype.showHint=function(e){e.shouldShow()&&!t.inPreviewMode&&e.show()},e.CreateDomWorkflowHint=function(e,i,o,n){return"undefined"==typeof n&&(n=t.model.DomWorkflowHint.defaultShouldShowCheck),new t.model.DomWorkflowHint(e,i,o,n)},e.CreateCanvasWorkflowHint=function(e,i,o){return new t.model.CanvasWorkflowHint(e,i,o)},e.prototype.initializeWorkflowHints=function(){var i=e.CreateDomWorkflowHint("Navigate to different scenes using the arrows above","#scene_label","bottom",function(){return t.product.manifest.isMultiScene});this.workflowHints.push(i);var o=e.CreateDomWorkflowHint("Navigate other panels.","#pageList > li:nth-child(2)","top",function(){return t.productOptions.hasBackOption()||t.product.manifest.pageCount>1});this.workflowHints.push(o);var n=e.CreateCanvasWorkflowHint("Get started by adding text to personalize your product.",function(e){var i=e[0];if(t.product.getActiveLayout()!=i)return null;for(var o=null,n=null,s=0;s<i.pageItems.length;s++){var a=i.pageItems[s];if("true"===a._required)return null;"text"===a._type&&a._defaultText&&a.TextBlock&&a.TextBlock.Frame&&(!o||a.TextBlock.Frame._yOffset<o.TextBlock.Frame._yOffset)&&(o=a)}if(o){var r=t.controls.ComponentFactory.lookupControlById(o._id),l=r.x-r.regX,h=r.y-r.regY;n=t.stage.localToGlobal(l,h)}return n},function(){for(var e=0;e<t.product.layouts[0].pageItems.length;e++){var i=t.product.layouts[0].pageItems[e];if(i._required&&"true"===i._required)return!1}return!0});this.workflowHints.push(n)},e}();e.GuidedUITipManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.imagesAddedCount=0,this.imagesContainerCount=0,t.events.on(t.events.IMAGE_ADDED,this.onImageAdded,this),t.events.on(t.events.BACKGROUND_IMAGE_ADDED,this.onBackgroundAdded,this),t.events.on(t.events.REFRESH_IMAGE_STATE,this.refreshImageState,this)}return e.prototype.imageContainerAdd=function(){this.imagesContainerCount++,this.imagesContainerCount>Number(t.config.maxImagesPerProduct())&&t.events.trigger(t.events.IMAGE_ADD_STATE_CHANGE,!1)},e.prototype.imageContainerRemove=function(){this.imagesContainerCount--,this.imagesContainerCount<Number(t.config.maxImagesPerProduct())&&t.events.trigger(t.events.IMAGE_ADD_STATE_CHANGE,!0)},e.prototype.getGraphics=function(e,i){var o=t.config.getImageURL()+e;t.ajax({type:"POST",url:t.config.xmljsonService(),headers:t.config.getRequestHeaders(),dataType:"json",data:{xmlStr:"",xmlSource:encodeURI(o)},success:function(e){"payload"in e&&"imageCategory"in e.payload&&t.events.trigger(i,e.payload.imageCategory)},error:function(e,i){t.dialogs.displayError("Error searching for images. Please Try again.",i+"\n"+e.responseText)}})},e.prototype.loadStockThumbnailData=function(){var e=t.config.getImageURL()+t.app.imageLibrary.getStockDataUrl();t.ajax({type:"POST",url:t.config.xmljsonService(),headers:t.config.getRequestHeaders(),dataType:"json",data:{xmlStr:"",xmlSource:e},success:function(e){"success"==e.result&&(t.app.imageLibrary.setStockImageData(e.payload.imageCategory),t.events.trigger(t.events.LIBRARY_STOCK_IMAGES_DATA_LOADED))}})},e.prototype.asyncUploadPreview=function(e){t.readyToCapturePreview()?t.imageManager.uploadPreview(e):setTimeout(t._.bind(t.imageManager.asyncUploadPreview,this,e),200)},e.prototype.uploadPreview=function(e){t.addToCartPreviewReady=!1,null==t.previewImage&&(t.previewImage=t.captureCartPreview());var i=t.previewImage,o="data:image/png;base64,",n=t.previewUploadFileName;null==n&&(t.previewUploadFileName=t.utils.GUID.create()+".png",n=t.previewUploadFileName);var s=t.config.fileUpload();s=t.utils.AppUtil.appendAuthToken(s);var a=new FormData;a.append("userId",t.config.profileID()+"/savedDesign"),a.append("ugcPath",t.config.ugcPath()),a.append("saveJSON","false"),a.append("base64",i.substring(o.length)),a.append("Filename",n),t.$.ajax({url:s,type:"POST",contentType:!1,processData:!1,headers:t.config.getRequestHeaders(),data:a,secureuri:!1,dataType:"json",success:function(i){if(i&&i.authError)return void t.services.generateToken(t.imageManager.asyncUploadPreview,e);t.previewImage=null;var o=i[0];t.config.previewImageUrl=t.config.getFile()+o.thumbnailImageURL,t.addToCartPreviewReady=!0,t.events.trigger(e)},error:function(i){0!=i.status&&(t.previewImage=null,t.addToCartPreviewReady=!1,t.events.trigger(e))}})},e.prototype.fileUpload=function(e,i){var o=t.config.fileUpload();o=t.utils.AppUtil.appendAuthToken(o),t.$.ajaxFileUpload({url:o,headers:t.config.getRequestHeaders(),data:{userId:t.config.profileID()+"/myImages",ugcPath:t.config.ugcPath(),saveJSON:"true"},secureuri:!1,fileElementId:e,dataType:"json",success:function(e){var o=e[0];if("S001"==o.code)t.app.userImages.unshift(o),t.app.views.assetPanelView.loadUserImages(),t.app.views.dialogs.photoUpload.loadUserImages(),t.ui.imageUploaded(),i&&t.events.trigger(t.events.IMAGE_UPLOADED,"photo0");else{var n="";switch(o.code){case"G001":n="Oops, something went wrong, please try your upload again.";break;case"E001":n="An error occurred when receiving the file. Please try your upload again.";break;case"E002":n="Oops, something went wrong, please try your upload again";break;case"E005":n="The file sent was corrupt and can not be opened. Please try your upload again.";break;case"E006":n="The file format not supported";break;case"E007":n="Maximum file size exceeded";break;case"E009":n="The file type was not accepted";break;case"E010":n="The creation of a file failed. Please try your upload again.";break;case"E015":n="Image dimensions were exceeded";break;case"E016":n="Image dimensions are too small to be printed";break;default:n="Oops, something went wrong, please try your upload again."}t.dialogs.displayDialog("Upload Error",n,"")}},error:function(t,e,i){if(0!=t.status)throw i}})},e.prototype.colorize=function(e,i,o,n,s){var a="/myImages";e.imageAsset.webFilename.split("/mySavedImages").length>1&&(a="/mySavedImages"),e.imageAsset.webFilename.split("/myCartImages").length>1&&(a="/myCartImages");var r=t.config.profileID()+a,l=t.config.ugcPath(),h=t.config.colorizeImage();i.indexOf("_")>0&&(i=i.substr(0,i.indexOf("_")));var c={userId:r,colorId:o.toString(),fileId:i,ugcPath:l};t.utils.ObjectUtil.isEmpty(n)||t.utils.ObjectUtil.isEmpty(s)||(c.matrix=n,c.colorSuffix=s,c.profile=!1,c.legacy=!1),t.ajax({type:"POST",url:h,headers:t.config.getRequestHeaders(),data:c,dataType:"text",success:function(t){e&&e.onImageColorized(t)}})},e.prototype.reset=function(){this.imagesAddedCount=0,this.imagesContainerCount=0},e.prototype.incrementImageCount=function(){this.imagesAddedCount++},e.prototype.getGraphicData=function(e){for(var i=0;i<t.app.currentGraphics.length;i++){var o=t.app.currentGraphics[i];if(o._name==e)return o}if(t.app.photoUploadGraphics)for(var i=0;i<t.app.photoUploadGraphics.length;i++){var o=t.app.photoUploadGraphics[i];if(o._name==e)return o}if(t.app.searchResults)for(var i=0;i<t.app.searchResults.length;i++){var o=t.app.searchResults[i];if(o._name==e)return o}return null},e.prototype.getBackgroundData=function(e){for(var i=0;i<t.app.currentBackgrounds.length;i++){var o=t.app.currentBackgrounds[i];if(o._name==e)return o}return null},e.prototype.getUGCData=function(e){for(var i=0;i<t.app.userImages.length;i++){var o=t.app.userImages[i];if(o.fileId==e)return o}return null},e.prototype.getPeepData=function(e){for(var i=0;i<t.app.userPeepImages.length;i++){var o=t.app.userPeepImages[i];if(o.fileId==e)return o}return null},e.prototype.onImageAdded=function(e){t.$("a.sprite-icon_active",'li[data-file-id="'+e+'"]').show(),t.events.trigger(t.events.STAGE_LOCK_CHANGED,!1),t.events.trigger(t.events.PRODUCT_PERSONALIZED),this.imagesAddedCount++,t.events.trigger(t.events.UPDATE_UI)},e.prototype.onBackgroundAdded=function(e){t.$("a.sprite-icon_active",'li[data-file-id="'+e+'"]').show(),t.events.trigger(t.events.PRODUCT_PERSONALIZED),t.events.trigger(t.events.UPDATE_UI)},e.prototype.refreshImageState=function(e,i,o){"undefined"==typeof o&&(o=!0);var n=t.$('li[data-file-id="'+e+'"]'),s=t.app.views.canvasView.isImageOnCanvas(e);n.find("a.sprite-icon_active")[s?"show":"hide"](),o&&(i?this.imagesAddedCount--:this.imagesAddedCount++),t.events.trigger(t.events.UPDATE_UI)},e.prototype.removeImage=function(e){for(var i=0;i<t.app.userImages.length;i++){var o=t.app.userImages[i];if(o.fileId==e)return void t.app.userImages.splice(i,1)}},e}();e.ImageManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.create=function(e){var i=t.managers.InstanceManager.items.length;return t.managers.InstanceManager.items.push(e),i},e.clean=function(){this.items=null,this.items=[]},e.get=function(e){return t.managers.InstanceManager.items[e]},e.destroy=function(e){var i=t.managers.InstanceManager.items[e];i&&i.hasOwnProperty("destroy")&&i.destroy(),t.managers.InstanceManager.items[e]=null},e.nextStoryId=function(){if(0==t.managers.InstanceManager.storyCounter)for(var e=t.product.getActiveLayout(),i=0;i<e.stories.length;i++){var o=e.stories[i];Number(o._id)>t.managers.InstanceManager.storyCounter&&(t.managers.InstanceManager.storyCounter=Number(o._id))}return t.managers.InstanceManager.storyCounter++,t.managers.InstanceManager.storyCounter.toString()},e.nextPageItemId=function(){if(0==t.managers.InstanceManager.currentPageItemId){for(var e=t.product.getActiveLayout(),i=0;i<e.pageItems.length;i++){var o=e.pageItems[i];Number(o._id)>t.managers.InstanceManager.currentPageItemId&&(t.managers.InstanceManager.currentPageItemId=Number(o._id))}for(var i=0;i<e.defaults.length;i++){var o=e.defaults[i].PageItemBlock;Number(o._id)>t.managers.InstanceManager.currentPageItemId&&(t.managers.InstanceManager.currentPageItemId=Number(o._id))}}return t.managers.InstanceManager.currentPageItemId++,t.managers.InstanceManager.currentPageItemId.toString()},e.items=[],e.storyCounter=0,e.currentPageItemId=0,e}();e.InstanceManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.peepsCollection=[],this.peepsFontSize=36,this.peepsMaxChars=15,this.peepsFileId="",this.peepsTask="ADD",this.peepsFontColor="#231f20",this.peepsSwatches=this.fillSwatches(),this.peepsMaximum=100,t.events.on(t.events.PEEPS_CLEANSE,this.reset,this)}return e.prototype.reset=function(){this.peepsFont=null,this.peepsFontVariant=null,this.peepsFontSize=36,this.peepsFileId="",this.peepsTask="ADD"},e.prototype.loadPeeps=function(){var e=t.config.getImageURL()+"/images/webProducts/peeps_index/peeps-category-index.xml";t.ajax({type:"POST",url:t.config.xmljsonService(),headers:t.config.getRequestHeaders(),dataType:"json",data:{xmlStr:"",xmlSource:encodeURI(e)},success:function(e){if("payload"in e&&"category"in e.payload["peeps-category-index"])for(var i=e.payload["peeps-category-index"].category,o=0;o<i.length;o++)t.peepsManager.loadPeepCategory(i[o]["_web-path"])},error:function(){}})},e.prototype.loadPeepSVG=function(e,i){"undefined"==typeof i&&(i=!1),t.ajax({type:"POST",url:t.config.xmljsonService(),headers:t.config.getRequestHeaders(),dataType:"json",data:{xmlStr:"",xmlSource:e},success:function(e){if("success"==e.result&&"undefined"!=typeof e.payload||null!=e.payload)for(var i=e.payload.svg,o=t.utils.JsonUtil.getList(i.g),n=0;n<o.length;n++){var s=new t.model.PeepComponent(o[n]);t.app.views.peepsCanvasView.peepFamily.addPeep(s)}else t.dialogs.displayDialog("Error getting Peep","There was an error attempting to get the Peep. Please try again. If the error persists, please contact Customer Service.")
},error:function(e){0!=e.status&&t.dialogs.displayDialog("Error getting Peep","There was an error attempting to get the Peep. Please try again. If the error persists, please contact Customer Service.")}})},e.prototype.loadPeepCategory=function(e){var i=t.config.getImageURL()+e;t.ajax({type:"POST",url:t.config.xmljsonService(),headers:t.config.getRequestHeaders(),dataType:"json",async:!1,data:{xmlStr:"",xmlSource:encodeURI(i)},success:function(e){if("payload"in e&&"peeps"in e.payload["peeps-category"]){var i=new Object;i.displayName=e.payload["peeps-category"]["_display-name"],i.name=e.payload["peeps-category"]._name,i.peeps=[];var o=e.payload["peeps-category"].peeps,n=[];"[object Array]"===Object.prototype.toString.call(o)?n=o:(n=[],n.push(o));for(var s,a,r=0;r<n.length;r++)s=new t.model.Peep,a=n[r],s.code=a["_peeps-code"],s.displayName=a["_display-name"],s.svgFileName=a["_svg-file-name"],s.svgFilePath=a["_svg-file-path"],s.thumbnailFileName=a["_thumbnail-file-name"],s.thumbnailFilePath=a["_thumbnail-file-path"],i.peeps.push(s);t.peepsManager.peepsCollection.push(i)}},error:function(e){0!=e.status&&t.dialogs.displayDialog("Error getting Peeps","There was an error attempting to access the Peeps libraries. Please try again. If the error persists, please contact Customer Service.")}})},e.prototype.getPeepCategories=function(){for(var t=[],e=0;e<this.peepsCollection.length;e++)t.push(this.peepsCollection[e].displayName);return t.sort(function(t,e){var i=t.toLowerCase().replace("peeps ",""),o=e.toLowerCase().replace("peeps ","");return o>i?-1:i>o?1:0}),t},e.prototype.getPeepContentByName=function(t){for(var e=0;e<this.peepsCollection.length;e++)if(this.peepsCollection[e].displayName===t)return this.peepsCollection[e];return null},e.prototype.getPeepContentById=function(t){for(var e,i=0;i<this.peepsCollection.length;i++){e=this.peepsCollection[i].peeps;for(var o=0;o<e.length;o++)if(e[o].code===t)return e[o]}return null},e.prototype.getFontCSS=function(){var t=this.peepsFont.variants[0].htmlFontFamily,e=this.fontRatio(t)+"px "+t;return e},e.prototype.fontRatio=function(t){var e=this.peepsFontSize;try{if(t.toLowerCase().indexOf("amore")>-1)return Math.floor(.97*e);if(t.toLowerCase().indexOf("bradley")>-1)return Math.floor(.95*e);if(t.toLowerCase().indexOf("bruno")>-1)return Math.floor(1.05*e);if(t.toLowerCase().indexOf("caliban")>-1)return Math.floor(1.3*e);if(t.toLowerCase().indexOf("cinderella")>-1)return Math.floor(1.1*e);if(t.toLowerCase().indexOf("clover")>-1)return Math.floor(1.1*e);if(t.toLowerCase().indexOf("garamond")>-1)return Math.floor(1.1*e);if(t.toLowerCase().indexOf("kidprint")>-1)return Math.floor(1.2*e);if(t.toLowerCase().indexOf("klepto")>-1)return Math.floor(1.1*e);if(t.toLowerCase().indexOf("litterbox")>-1)return Math.floor(1.2*e);if(t.toLowerCase().indexOf("mahogany")>-1)return Math.floor(1.3*e);if(t.toLowerCase().indexOf("serlio")>-1)return Math.floor(1.15*e);if(t.toLowerCase().indexOf("spumoni")>-1)return Math.floor(1.15*e);if(t.toLowerCase().indexOf("times")>-1)return Math.floor(1.05*e);if(t.toLowerCase().indexOf("wendy")>-1)return Math.floor(1.2*e)}catch(t){}return e},e.prototype.getCurrentFontFamily=function(){var e="futura_lt_pro";return t.utils.ObjectUtil.notUndefined(this.peepsFont.variants[0])&&(e=this.peepsFont.variants[0].fontId),e},e.prototype.getFontVariantById=function(t,e){if(e){for(var i=0;i<e.variants.length;i++)if(e.variants[i].fontId===t)return e.variants[i]}else this.getFontVariantById(t,this.getFontById(t));return null},e.prototype.getFontById=function(e){var i,o;for(var n in t.fonts.globalFontMap){for(var s=t.fonts.globalFontMap[n],a=0;a<s.variants.length;a++)o=s.variants[a],o.fontId===e&&(this.peepsFontVariant=o,i=s);if(s.id===e){i=s;break}}return null==i||null==i.cssUrl||0==i.cssUrl.length||i.isLoaded?i&&i.isLoaded:(t.$("head").append(t.$("<link/>",{href:i.cssUrl,rel:"stylesheet"})),i.isLoaded=!0),this.peepsFont=i,i},e.prototype.getPeepsEditorMode=function(){return t.app.views.dialogs.peepsEditor.editorMode},e.prototype.fillSwatches=function(){return[{color:"0xf6e7c8",_rgbValue:"#f6e7c8",_cmykValue:this.getCMYKHexColor("0|5|20|3"),_designerLabel:"s_Skin1",_templateName:"s_Skin1"},{color:"0xf5decc",_rgbValue:"#f5decc",_cmykValue:this.getCMYKHexColor("0|10|15|3"),_designerLabel:"s_Skin2",_templateName:"s_Skin2"},{color:"0xfdd1af",_rgbValue:"#fdd1af",_cmykValue:this.getCMYKHexColor("0|20|30|0"),_designerLabel:"s_Skin3",_templateName:"s_Skin3"},{color:"0xd7b593",_rgbValue:"#d7b593",_cmykValue:this.getCMYKHexColor("10|25|40|5"),_designerLabel:"s_Skin4",_templateName:"s_Skin4"},{color:"0xb87e5f",_rgbValue:"#b87e5f",_cmykValue:this.getCMYKHexColor("0|40|50|30"),_designerLabel:"s_Skin5",_templateName:"s_Skin5"},{color:"0xf8c0d2",_rgbValue:"#f8c0d2",_cmykValue:this.getCMYKHexColor("0|30|3|0"),_designerLabel:"s_Pink",_templateName:"s_Pink"},{color:"0xec008b",_rgbValue:"#ec008b",_cmykValue:this.getCMYKHexColor("0|100|0|0"),_designerLabel:"s_HotPink",_templateName:"s_HotPink"},{color:"0xed1650",_rgbValue:"#ed1650",_cmykValue:this.getCMYKHexColor("0|100|60|0"),_designerLabel:"s_Red",_templateName:"s_Red"},{color:"0xf36f21",_rgbValue:"#f36f21",_cmykValue:this.getCMYKHexColor("0|70|100|0"),_designerLabel:"s_Orange",_templateName:"s_Orange"},{color:"0xef4023",_rgbValue:"#ef4023",_cmykValue:this.getCMYKHexColor("0|90|100|0"),_designerLabel:"s_Tangerine",_templateName:"s_Tangerine"},{color:"0xffe600",_rgbValue:"#ffe600",_cmykValue:this.getCMYKHexColor("0|5|100|0"),_designerLabel:"s_Yellow",_templateName:"s_Yellow"},{color:"0xffe192",_rgbValue:"#ffe192",_cmykValue:this.getCMYKHexColor("0|10|50|0"),_designerLabel:"s_Blonde",_templateName:"s_Blonde"},{color:"0xc2cb20",_rgbValue:"#c2cb20",_cmykValue:this.getCMYKHexColor("20|0|100|10"),_designerLabel:"s_Lime",_templateName:"s_Lime"},{color:"0x00a550",_rgbValue:"#00a550",_cmykValue:this.getCMYKHexColor("100|0|100|0"),_designerLabel:"s_Green",_templateName:"s_Green"},{color:"0xb9e5fa",_rgbValue:"#b9e5fa",_cmykValue:this.getCMYKHexColor("25|0|0|0"),_designerLabel:"s_Sky",_templateName:"s_Sky"},{color:"0x00a3a5",_rgbValue:"#00a3a5",_cmykValue:this.getCMYKHexColor("85|0|35|10"),_designerLabel:"s_Teal",_templateName:"s_Teal"},{color:"0x00acdc",_rgbValue:"#00acdc",_cmykValue:this.getCMYKHexColor("100|0|10|0"),_designerLabel:"s_Aqua",_templateName:"s_Aqua"},{color:"0x0083ca",_rgbValue:"#0083ca",_cmykValue:this.getCMYKHexColor("100|35|0|0"),_designerLabel:"s_Blue",_templateName:"s_Blue"},{color:"0x589ac1",_rgbValue:"#589ac1",_cmykValue:this.getCMYKHexColor("60|20|5|10"),_designerLabel:"s_Slate",_templateName:"s_Slate"},{color:"0x00417a",_rgbValue:"#00417a",_cmykValue:this.getCMYKHexColor("100|60|0|40"),_designerLabel:"s_Navy",_templateName:"s_Navy"},{color:"0xbc9dca",_rgbValue:"#bc9dca",_cmykValue:this.getCMYKHexColor("25|40|0|0"),_designerLabel:"s_Violet",_templateName:"s_Violet"},{color:"0x80298f",_rgbValue:"#80298f",_cmykValue:this.getCMYKHexColor("60|100|0|0"),_designerLabel:"s_Purple",_templateName:"s_Purple"},{color:"0x983b2b",_rgbValue:"#983b2b",_cmykValue:this.getCMYKHexColor("40|90|100|10"),_designerLabel:"s_Brown",_templateName:"s_Brown"},{color:"0x8a655d",_rgbValue:"#8a655d",_cmykValue:this.getCMYKHexColor("50|65|65|5"),_designerLabel:"s_Chocolate",_templateName:"s_Chocolate"},{color:"0xc5cdc9",_rgbValue:"#c5cdc9",_cmykValue:this.getCMYKHexColor("5|0|5|20"),_designerLabel:"s_Silver",_templateName:"s_Silver"},{color:"0xd3c89f",_rgbValue:"#d3c89f",_cmykValue:this.getCMYKHexColor("0|3|30|20"),_designerLabel:"s_Gold",_templateName:"s_Gold"},{color:"0x231f20",_rgbValue:"#231f20",_cmykValue:this.getCMYKHexColor("0|0|0|100"),_designerLabel:"s_Black",_templateName:"s_Black"},{color:"0xffffff",_rgbValue:"#ffffff",_cmykValue:this.getCMYKHexColor("0|0|0|0"),_designerLabel:"s_White",_templateName:"s_White"}]},e.prototype.getCMYKHexColor=function(t){var e=t.split("|"),i="64|64|64|64";try{var o=parseFloat(e[0]).toString(16);1==o.length&&(o="0"+o);var n=parseFloat(e[1]).toString(16);1==n.length&&(n="0"+n);var s=parseFloat(e[2]).toString(16);1==s.length&&(s="0"+s);var a=parseFloat(e[3]).toString(16);1==a.length&&(a="0"+a),i=o+"|"+n+"|"+s+"|"+a}catch(t){i="64|64|64|64"}return i},e.prototype.hasSwatch=function(t){for(var e=0;e<this.peepsSwatches.length;e++)if(this.peepsSwatches[e]._rgbValue==t)return!0;return!1},e.prototype.capturePeepThumb=function(e){var i=t.app.views.peepsCanvasView.peepFamily.width,o=t.app.views.peepsCanvasView.peepFamily.height,n=1;n=i>o?e/i:e/o;var s=(e-i*n)/2,a=(e-o*n)/2;t.app.views.peepsCanvasView.peepFamily.deactivateEditors(),t.app.views.peepsCanvasView.peepStage.update(),t.events.trigger(t.events.PEEPS_SHOW_EDITOR_BACKGROUND,!1),t.app.views.peepsCanvasView.peepFamily.setWhiteBackground(!0),t.app.views.peepsCanvasView.peepFamily.cache(0,0,i,o,n);var r=t.app.views.peepsCanvasView.peepFamily.cacheCanvas.getContext("2d").getImageData(0,0,i,o);t.app.views.peepsCanvasView.peepFamily.uncache(),t.app.views.peepsCanvasView.peepFamily.setWhiteBackground(!1);var l=new createjs.Container;l.cache(0,0,e,e);var h=l.cacheCanvas.getContext("2d");h.putImageData(r,s,a),h.fillStyle="#FFFFFF",0!=s?(h.fillRect(0,0,s,e),h.fillRect(e-s,0,s,e)):0!=a&&(h.fillRect(0,0,e,a),h.fillRect(0,e-a,e,a));var c=l.getCacheDataURL();return l.uncache(),c=c.replace("data:image/png;base64,","")},e.prototype.capturePeepPreview=function(e){var i=t.app.views.peepsCanvasView.peepFamily.width,o=t.app.views.peepsCanvasView.peepFamily.height;t.app.views.peepsCanvasView.peepFamily.deactivateEditors(),t.app.views.peepsCanvasView.peepStage.update(),t.events.trigger(t.events.PEEPS_SHOW_EDITOR_BACKGROUND,!1);var n=1;n=i>o?e/i:e/o;var s;return t.app.views.peepsCanvasView.peepFamily.cache(0,0,i,o,n),s=t.app.views.peepsCanvasView.peepFamily.getCacheDataURL(),t.app.views.peepsCanvasView.peepFamily.uncache(),s=s.replace("data:image/png;base64,","")},e.prototype.savePeeps=function(e){var i=this.capturePeepPreview(800),o=this.capturePeepThumb(100),n=t.config.savePeep();t.events.trigger(t.events.PEEPS_SHOW_EDITOR_BACKGROUND,!0),t.$.ajax({type:"POST",url:n,headers:t.config.getRequestHeaders(),data:{ugcPath:t.config.ugcPath(),userId:t.config.profileID(),cardId:"peepImages/",peepTask:this.peepsTask,svgXml:e,base64THB:o,base64LOW:i,fileId:""},dataType:"json",success:function(e){t.events.trigger(t.events.PEEPS_LOAD);setTimeout(function(){var i=t.model.ImageAsset.createFromUGC(e[0]);i.isPeep=!0,t.events.trigger(t.events.PEEPS_SWAP_PEEP,i)},500)},error:function(e,i){0!=e.status&&t.dialogs.displayDialog("Error Saving Peeps:",i+"\n"+e.responseText)}})},e}();e.PeepsManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.requiredPageItems={},this.allRequiredItemsValid=!0,t.events.on(t.events.LAST_LAYOUT,this.loadRequiredPageItems,this),t.events.on(t.events.RESET_DESIGN_COMPLETE,this.onResetDesignComplete,this)}return e.prototype.onResetDesignComplete=function(){this.requiredPageItems={},this.allRequiredItemsValid=!0,this.loadRequiredPageItems()},e.prototype.loadRequiredPageItems=function(){for(var e=[],i=0;i<t.product.layouts.length;i++)for(var o=t.product.layouts[i],n=0;n<o.pageItems.length;n++){var s=o.pageItems[n];"true"===s._required&&e.push({layout:i,pageItem:s})}this.init.call(this,e)},e.prototype.init=function(e){for(var i=0;i<e.length;i++){var o=e[i];this.requiredPageItems[o.pageItem._id]=o}this.requiredPageItems&&Object.keys(this.requiredPageItems).length>0&&this.checkAllRequiredItems(),t.events.on(t.events.CONTROL_INTERACTED,this.onControlInteracted,this)},e.prototype.getAllRequiredItemsValid=function(){return this.allRequiredItemsValid},e.prototype.onControlInteracted=function(e){this.updatePageItems(e),t._.bind(this.checkAllRequiredItems,this)()},e.prototype.checkAllRequiredItems=function(){for(var e=!0,i=0;i<Object.keys(this.requiredPageItems).length;i++){for(var o=this.requiredPageItems[Object.keys(this.requiredPageItems)[i]],n=t.product.layouts[o.layout],s=0;s<n.pageItems.length;s++){var a=n.pageItems[s];if(a._id===o.pageItem._id&&"true"!==a._userInteracted){e=!1;break}}if(!e)break}e!=this.allRequiredItemsValid&&(this.allRequiredItemsValid=e,t.events.trigger(e?t.events.REQUIRED_ITEMS_VALID:t.events.REQUIRED_ITEMS_INVALID))},e.prototype.updatePageItems=function(t){"true"===t._required&&this.requiredPageItems.hasOwnProperty(t._id)&&(this.requiredPageItems[t._id].pageItem=t)},e}();e.RequirementValidationManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.prototype.handlePageClick=function(e){if(t.product.activePage!=e){t.inPreviewMode||t.save();var i=t.product.getLayoutIndex(e);t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,i),t.product.activePage=e,t.inPreviewMode||this.updatePreviewButtons(),t.app.views.toolbarView.updatePageButtons()}},e.prototype.handleNextClick=function(){if(t.product.activeLayout%t.product.manifest.pageCount==1||1==t.product.manifest.pageCount){if(!t.product.hasNextScene())return;t.inPreviewMode||t.save(),t.product.nextScene(),this.updateScene(t.product.FIRST_PAGE)}else{if(!t.product.hasNextPage())return;t.inPreviewMode||t.save();var e=t.product.nextPage(),i=t.product.getLayoutIndex(e);t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,i),t.product.activePage=e}t.inPreviewMode||this.updatePreviewButtons(),t.app.views.toolbarView.updatePageButtons()},e.prototype.handlePreviousClick=function(){if(t.product.activeLayout%t.product.manifest.pageCount==0){if(!t.product.hasPrevScene())return;t.save(),t.product.prevScene(),this.updateScene(t.product.manifest.pageCount-1)}else{if(!t.product.hasPrevPage())return;t.save();var e=t.product.prevPage(),i=t.product.getLayoutIndex(e);t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,i),t.product.activePage=e}this.updatePreviewButtons(),t.app.views.toolbarView.updatePageButtons()},e.prototype.updateScene=function(e){t.$("#scene_label").html("Scene "+(t.product.activeScene+1));var i=t.product.getLayoutIndex(e);t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,i),t.product.activePage=e,t.app.views.sceneControlView.updateNavButtons()},e.prototype.updatePreviewButtons=function(){t.product.hasNextLayout()?(t.$("#nextButton").show(),t.utils.HtmlUtil.createTooltip("nextButton","Go to Next Page.","bottom"),t.$("#previewButton").hide()):(t.$("#nextButton").hide(),t.$("#previewButton").show()),t.product.hasPrevLayout()&&t.$("#previousButton").show(),t.product.hasPrevLayout()?(t.utils.HtmlUtil.createTooltip("previousButton","Go to Previous Page.","bottom"),t.$("#previousButton").removeClass("disabled")):(t.$("#previousButton").tooltip("destroy"),t.$("#previousButton").addClass("disabled"))},e}();e.SceneManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.selectedItems=[],this.throttledCheckTextOverflow=t._.debounce(t._.bind(t.editorManager.checkTextOverflow,t.editorManager),75,!0)}return e.prototype.select=function(e,i){"undefined"==typeof i&&(i=!1),i&&(this.clear(),e.selected=!0,e.select()),(1!=this.selectedItems.length||this.selectedItems[0].instanceId!=e.instanceId)&&(this.selectedItems.push(e),null==this.group&&this.selectedItems.length>1&&(this.group=new t.controls.GroupContainer,t.stage.addChild(this.group)),-1==t.stage.getChildIndex(this.group)&&this.selectedItems.length>1&&t.stage.addChild(this.group),2==this.selectedItems.length?(this.selectedItems[0].unselect(),this.group.add(this.selectedItems[0]),this.group.add(this.selectedItems[1]),this.group.render()):this.selectedItems.length>2&&(this.group.add(e),this.group.render()),t.editorManager.showContainer(this.selectedItems.length>1?this.group:e))},e.prototype.handlerKeyUp=function(e){var i=null;switch(e||(e=window.event),e.keyCode){case 37:i="LEFT";break;case 39:i="RIGHT";break;case 38:i="UP";break;case 40:i="DOWN"}var o,n,s,a=!1,r=!1;null!=this.group&&t.stage.getChildIndex(this.group)>-1?(a=!0,s=this.group,o={x:this.group.x,y:this.group.y}):1===this.selectedItems.length&&1===this.selectedItems[0].editMode&&(r=!0,o=this.selectedItems[0].prevHistoryValue);for(var l=0;l<this.selectedItems.length;l++){var h=this.selectedItems[l];null!=i&&h.key(i)}if(a===!0?(this.group.render(),n={x:this.group.x,y:this.group.y}):r===!0&&(n=this.selectedItems[0].getHistoryTransactionState()),i&&o){var c=[];if(a===!0)for(var l=0;l<this.selectedItems.length;l++)c.push(this.selectedItems[l].pageItemBlock);else s=null,c=this.selectedItems[0].pageItemBlock;var d=new t.actions.ContainerMoveAction(o,n,c,s);t.actionManager.addAction(d)}h&&"bbox.controls.CompositeText"===h.type&&2===h.editMode&&this.throttledCheckTextOverflow(h)},e.prototype.unselect=function(t){for(var e=0;e<this.selectedItems.length;e++){var i=this.selectedItems[e];if(t.instanceId==i.instanceId)return void this.selectedItems.splice(e,1)}},e.prototype.clear=function(){t.editorManager.commit();var e=window.getSelection();e.removeAllRanges();var i=document.getElementById("textFrame");null!=i&&i.blur(),this.selectedItems=[],null!=this.group&&(this.group.clear(),t.stage.removeChild(this.group),this.group=null);for(var o=t.stage.getNumChildren();o>0;o--){var n=t.stage.getChildAt(o-1);n.type&&(n.selected=!1,n.unselect.apply(n))}t.editorManager.hideAll()},e.prototype.count=function(){return this.selectedItems.length},e.prototype.getSelectedItems=function(){return this.selectedItems},e.prototype.getGroup=function(){return this.group},e}();e.SelectionManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.isAutoSave=!1,t.events.on(t.events.USER_LOGIN_COMPLETE,this.loginComplete),t.events.on(t.events.USER_IMAGE_REMOVED,this.deleteFile),t.events.on(t.events.KEYWORD_SEARCH,this.searchForFiles),t.events.on(t.events.USER_LOAD_SAVED_ITEM_COMPLETE,this.loadSavedProductComplete),t.events.on(t.events.USER_LOAD_CART_ITEM_COMPLETE,this.loadCartProductComplete),t.events.on(t.events.USER_ADD_TO_CART_COMPLETE,this.addToCartComplete),t.events.on(t.events.USER_ADD_TO_CART_PREVIEW_COMPLETE,this.addToCartPreviewComplete),t.events.on(t.events.USER_SAVE_PREVIEW_COMPLETE,this.savePreviewComplete),t.events.on(t.events.USER_SAVE_COMPLETE,this.saveComplete),t.events.on(t.events.USER_UPDATE_UGCPATH,this.onUGCPathChanged),t.events.on(t.events.PEEPS_LOAD,this.loadPeepFiles,this)}return e.prototype.onUGCPathChanged=function(e){t.ugcSwap=e},e.prototype.loadChannelConfig=function(){t.log("> channel config prime loading at "+t.config.primeChannelConfig()),t.$.ajax({url:t.config.primeChannelConfig(),headers:t.config.getRequestHeaders(),complete:function(e){var i=JSON.parse(e.responseText);"failure"==i.result?(t.log("*****************************************"),t.log("Error loading prime channel config: "+i.message),t.log("*****************************************")):t.log("< channel config prime loaded"),t.log("> channel config loading at "+t.config.channelConfig()),t.$.ajax({url:t.config.channelConfig(),headers:t.config.getRequestHeaders(),complete:function(e){for(var i=e.responseText.split("\r").join(""),o=i.split("\n"),n={},s=0;s<o.length;s++){var a=o[s].split("="),r=a[0],l=a[1];n[r]=l}t.config.setChannelConfig(n),t.events.trigger(t.events.CHANNEL),t.log("< channel config loaded")}})}})},e.prototype.loadExternalDialogText=function(){t.$.ajax({url:t.config.getExternalDialogUrl(),headers:t.config.getRequestHeaders(),dataType:"text",success:function(){},error:function(e,i){0!=e.status&&t.dialogs.displayError("Error Loading Product",i+"\n"+e.responseText)}})},e.prototype.generateToken=function(e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),t.log("> generating token at "+t.config.generateToken()),t.$.ajax({type:"POST",url:t.config.generateToken(),data:{arg1:t.config.isCSR()},dataType:"json",success:function(o){if(t.utils.AppUtil.isLocalhost())t.config.token="TestAuthToken123";else{var n=o.atgResponse;t.config.token=n}t.log("***** generateToken success *****, token: "+t.config.token),e?e(i):t.events.trigger(t.events.TOKEN_GENERATED)},error:function(i,o){0!=i.status&&(t.log("Error Generating Token :"+o+"\n"+i.responseText),t.services.generateToken(e),t.dialogs.displayError("Error Generating Token",o+"\n"+i.responseText))}})},e.prototype.extendToken=function(){t.$.ajax({type:"POST",url:t.config.extendTokenLife(),headers:t.config.getRequestHeaders(),data:{arg1:t.config.isCSR()},dataType:"json",success:function(){},error:function(t){0==t.status}})},e.prototype.loadCartProduct=function(e){t.clean(),t.config.setCommerceItemId(e),t.config.setProductSource("cart"),t.ajax({url:t.config.getCommerceItem(),headers:t.config.getRequestHeaders(),data:{commerceItemId:e,nfc:!0},dataType:"json",success:function(e){t.events.trigger(t.events.USER_LOAD_CART_ITEM_COMPLETE,e)}})},e.prototype.loadCartProductComplete=function(e){var i,o=[];o[0]=e.commerceItemXml.productXmlMap.Manifest,t.replacedFontsMessageList=[],o[0]=t.utils.FontReplaceUtils.replaceManifestFonts(o[0]),t.services.showFontReplacementMessageIfNeeded(),delete o[0].success,t._.each(e.commerceItemXml.productXmlMap.Pages,function(e,n){delete e.success,"layout_"==n.substr(0,7)&&(i=n.split("layout_")[1].split(".xml")[0],e=t.utils.FontReplaceUtils.replaceLayoutFonts(e),o[i]=e)});var n=new t.model.Product(o);t.product=n,t.events.trigger(t.events.PRODUCT)},e.prototype.loadSavedProduct=function(e){t.clean(),t.config.setUniqueItemId(e),t.config.setProductSource("saved"),t.ajax({url:t.config.getSavedItem(),headers:t.config.getRequestHeaders(),data:{uniqueItemId:e,nfc:!0},dataType:"json",success:function(e){t.events.trigger(t.events.USER_LOAD_SAVED_ITEM_COMPLETE,e)},error:function(e,i){0!=e.status&&t.dialogs.displayError("Error Loading Product",i+"\n"+e.responseText)}})},e.prototype.loadSavedProductComplete=function(e){var i,o=[];o[0]=e.savedItem.productXmlMap.Manifest,t.replacedFontsMessageList=[],o[0]=t.utils.FontReplaceUtils.replaceManifestFonts(o[0]),t.services.showFontReplacementMessageIfNeeded(),delete o[0].success,t._.each(e.savedItem.productXmlMap.Pages,function(e,n){delete e.success,"layout_"==n.substr(0,7)&&(i=n.split("layout_")[1].split(".xml")[0],e=t.utils.FontReplaceUtils.replaceLayoutFonts(e),o[i]=e)});var n=new t.model.Product(o);t.product=n,t.events.trigger(t.events.PRODUCT)},e.prototype.loadProductIndex=function(e){var i,o;0==e?(i="manifest",o=t.services.onManifestLoaded):(i="layout_"+e+".xml",o=t.services.onProductLoaded);var n=t.config.primeProductService(i);t.productDataLoading[e]=t.ajax({url:n,headers:t.config.getRequestHeaders(),dataType:"text",success:function(i){try{var n=JSON.parse(i);if(n&&n.result&&"failure"===n.result)return void t.events.trigger(t.events.LOAD_LAYOUT_FAILED,n)}catch(t){}o(e)},error:function(e,i){0!=e.status&&t.dialogs.displayError("Error Loading Product",i+"\n"+e.responseText)}})},e.prototype.loadNewProduct=function(e){t.clean(),t.config.setProductCode(e),t.config.setProductSource("new"),t.productDataLoading=[],t.services.loadProductIndex(0)},e.prototype.onManifestLoaded=function(){t.services.loadProductIndex(1)},e.prototype.onProductLoaded=function(){if(t.productDataLoading[0].responseText&&t.productDataLoading[1].responseText){var e=[],i=JSON.parse(t.productDataLoading[0].responseText);i=t.utils.ObjectUtil.getDocument(i),i=t.utils.FontReplaceUtils.replaceManifestFonts(i);var o=JSON.parse(t.productDataLoading[1].responseText);o=t.utils.ObjectUtil.getDocument(o),o=t.utils.FontReplaceUtils.replaceLayoutFonts(o),e[0]=i,e[1]=o;var n=new t.model.Product(e);t.product=n,null!=t.fonts.globalFontMap&&t.product.preloadFonts();var s=1;t.productDataLoading[0]=!1,t.productDataLoading[1]=!1,t._.each(t.utils.JsonUtil.getList(i.LayoutBookMap.layoutRefs.LayoutRef),function(){1==s||t.services.loadProductIndex(s),s+=1}),t.events.trigger(t.events.PRODUCT)}else if(0==t.productDataLoading[0]&&0==t.productDataLoading[1])for(var a=t.productDataLoading.length,r=0;a>r;r++)if(t.productDataLoading[r]&&4==t.productDataLoading[r].readyState){var l=JSON.parse(t.productDataLoading[r].responseText);l=t.utils.ObjectUtil.getDocument(l),l=t.utils.FontReplaceUtils.replaceLayoutFonts(l),t.product.addLayout(r,l),t.productDataLoading[r]=!1}},e.prototype.showFontReplacementMessageIfNeeded=function(){var e="";if(t.replacedFontsMessageList.length>0){e="One or more font families used on this product were discontinued and have been replaced with a better font. Please review your product and make to ensure you are OK with the revised changes.<br>";for(var i=0;i<t.replacedFontsMessageList.length;i++)e+="<br>"+t.replacedFontsMessageList[i];t.dialogs.displayDialog("Replaced font notice",e)}},e.prototype.loadProductOptions=function(){t.ajax({url:t.config.getProductOptions(),data:{productId:t.config.productID(),skuId:t.config.skuID()},headers:t.config.getRequestHeaders(),dataType:"json",success:function(e){e.hasOwnProperty("productOptionsObj")&&e.productOptionsObj.success&&(t.productOptions=new t.model.ProductOptions(e.productOptionsObj),null!=t.app.imageLibrary&&t.app.imageLibrary.updatePaperOptions(),t.events.trigger(t.events.OPTIONS_LOADED)),t.events.trigger(t.events.COMPLETE)},error:function(e,i){0!=e.status&&(t.dialogs.displayError("Error Getting Product Options",i+"\n"+e.responseText),t.events.trigger(t.events.COMPLETE))}})},e.prototype.loadUserFiles=function(){t.ajax({url:t.config.getJSONFileList(),data:{ugcPath:t.config.ugcPath(),userId:t.config.profileID()+"/myImages"},headers:t.config.getRequestHeaders(),dataType:"json",success:function(e){t.app.userImages=t.utils.JsonUtil.getList(e),t.events.trigger(t.events.USER_IMAGES_LOADED)},error:function(e){0!=e.status&&(t.app.userImages=[],t.events.trigger(t.events.USER_IMAGES_LOADED))}})},e.prototype.loadPeepFiles=function(){t.ajax({url:t.config.getJSONFileList(),data:{ugcPath:t.config.ugcPath(),userId:t.config.profileID()+"/peepImages"},headers:t.config.getRequestHeaders(),dataType:"json",success:function(e){t.app.userPeepImages=t.utils.JsonUtil.getList(e);for(var i=0;i<t.app.userPeepImages;i++)t.app.userPeepImages[i].isPeep=!0;t.events.trigger(t.events.PEEPS_UGC_LIST_LOADED)},error:function(e){0!=e.status&&(t.app.userPeepImages=[],t.events.trigger(t.events.PEEPS_UGC_LIST_LOADED))}})},e.prototype.loadProductImageLibrary=function(e){var i=t.config.getImageURL()+t.config.imageLibraryBasePath()+"/"+e+"/image-library.xml";t.ajax({type:"POST",url:t.config.xmljsonService(),headers:t.config.getRequestHeaders(),dataType:"json",data:{xmlStr:"",xmlSource:i},success:function(e){if(e.payload&&null!=e.payload.categories){var i=new t.model.ImageLibrary(e.payload.categories["category-list"]);t.app.imageLibrary=i,i.hasStockCategory()&&t.imageManager.loadStockThumbnailData()}t.events.trigger(t.events.LIBRARY_IMAGES_LOADED)}})},e.prototype.deleteFile=function(e){var i=t.config.removeFiles();t.ajax({url:i,headers:t.config.getRequestHeaders(),data:e,dataType:"json",success:function(){t.product.hasPeeps&&t.events.trigger(t.events.PEEPS_LOAD)}})},e.prototype.searchForFiles=function(e){var i=e.keyword?e.keyword:"",o=e.graphicsPath?e.graphicsPath:"";t.ajax({url:t.config.xmljsonService(),headers:t.config.getRequestHeaders(),data:{xmlStr:i,xmlSource:encodeURI(t.config.getImageURL()+o)},dataType:"json",type:"POST",success:function(e){"success"===e.result&&e.payload&&e.payload.imageCategory&&(t.app.searchResults=e.payload.imageCategory.image,t.events.trigger(t.events.SEARCH_RESULTS_LOADED,t.app.searchResults))},error:function(e,i){t.dialogs.displayError("Error searching for images. Please Try again.",i+"\n"+e.responseText)}})},e.prototype.login=function(e,i,o){"undefined"==typeof o&&(o=!0),t.ajax({url:t.config.login(),headers:t.config.getRequestHeaders(),data:{username:e,password:i,autologin:!0},dataType:"text",type:"POST",success:function(o){try{var n=JSON.parse(o);if(n&&n.authError)return void t.services.generateToken(t.services.loginFailed,{user:e,pass:i})}catch(t){}if(o.indexOf("ERR_")>-1){var s=t.errors.parse(o);return void t.events.trigger(t.events.USER_LOGIN_FAILED,s)}if(o.indexOf("INFO_1000")>-1){var a=o.split("Error 200: INFO_1000-"),s=a[1];return void t.events.trigger(t.events.USER_LOGIN_FAILED,s)}var r=t.utils.AppUtil.parseUserResponse(o);t.events.trigger(t.events.USER_LOGIN_COMPLETE,r)}})},e.prototype.loginFailed=function(e){t.services.login(e.user,e.pass)},e.prototype.loginComplete=function(e){var i=t.config.ugcPath(),o=t.config.profileID();null!=e.profileId&&t.config.setProfileId(e.profileId),null!=e.ugcPath&&t.config.setUgcPath(e.ugcPath),null!=t.app.userImages&&t.app.userImages.length>0?t.services.moveFiles(i,o):t.services.loadUserFiles();var n=window;"undefined"!=typeof n.refreshHeaderForConfigurator&&n.refreshHeaderForConfigurator()},e.prototype.register=function(e,i,o,n,s){"undefined"==typeof s&&(s=!1),t.ajax({url:t.config.registerUser()+"?"+this.cacheBuster(),headers:t.config.getRequestHeaders(),data:{profileId:t.config.profileID(),username:e,confirmUsername:e,password:i,retypePassword:i,emailPreference:s,question:o,answer:n,_windowid:t.config.windowid()},dataType:"text",type:"POST",success:function(e){if(e.indexOf("ERR_")>-1){var i=t.errors.parse(e);return void t.events.trigger(t.events.USER_REGISTER_FAILED,i)}if(e.indexOf("profileId-")>-1){var o=t.utils.AppUtil.parseUserResponse(e),n=t.config.ugcPath(),s=t.config.profileID();t.config.setUgcPath(o.ugcPath),t.config.setProfileId(o.profileId),null!=t.app.userImages&&t.app.userImages.length>0?t.services.moveFiles(n,s):t.services.loadUserFiles();var a=window;"undefined"!=typeof a.refreshHeaderForConfigurator&&a.refreshHeaderForConfigurator()}t.events.trigger(t.events.USER_REGISTER_COMPLETE,e)}})},e.prototype.moveFiles=function(e,i){var o={oldUserId:i,newUserId:t.config.profileID(),oldUgcPath:e,ugcPath:t.config.ugcPath(),saveJSON:!0};t.events.trigger(t.events.USER_UPDATE_UGCPATH,o),t.ajax({url:t.config.moveFiles(),headers:t.config.getRequestHeaders(),data:o,dataType:"text",type:"POST",success:function(){t.services.loadUserFiles()}})},e.prototype.addToCart=function(e){"undefined"==typeof e&&(e=1),t.cartQuantity=e,1==t.addToCartPreviewReady?t.services.addToCartPreviewComplete():t.imageManager.asyncUploadPreview(t.events.USER_ADD_TO_CART_PREVIEW_COMPLETE)},e.prototype.addToCartPreviewComplete=function(){var e={catalogRefId1:t.config.skuID(),productId:t.config.productID(),productConfigurationXML:t.save(),previewImageUrl:t.config.previewImageUrl,quantity:t.config.quantity(),nfc:!0,_windowid:t.config.windowid()},i=t.product.getName();null!=i&&(e.itemDesignName=i),"cart"!=t.config.productSource()||t.config.isReorder()?"saved"!=t.config.productSource()||""==t.config.commerceItemId()||t.config.isReorder()||(e.commerceItemId=t.config.commerceItemId()):e.commerceItemId=t.config.commerceItemId(),e.subSkuIds=t.productOptions.getSubSkuIdList(),t.ajax({url:t.config.addToCart(),headers:t.config.getRequestHeaders(),data:e,type:"POST",dataType:"json",success:function(e){t.dialogs.busyDialog.hide(),t.events.trigger(t.events.USER_ADD_TO_CART_COMPLETE,e)},error:function(e,i){t.dialogs.busyDialog.hide(),t.dialogs.displayError("Error Adding to Cart. Please Try again.",i+"\n"+e.responseText)}})},e.prototype.addToCartComplete=function(e){if(t.utils.HtmlUtil.setAskBeforeQuit(!1),e.atgResponse){var i=!0;"localhost"==document.domain&&(i=confirm("LOCAL: READY TO REDIRECT TO CART?")),document.domain.split("swf2").length>1&&(i=confirm("SWF2: READY TO REDIRECT TO CART?")),1==i&&(window.location.href=t.config.cartURL())}},e.prototype.save=function(e,i,o){"undefined"==typeof o&&(o=!1),this.isAutoSave=o,t.config.saveProductName=e,t.config.saveAsNew=i,1==t.addToCartPreviewReady?t.services.savePreviewComplete():t.imageManager.asyncUploadPreview(t.events.USER_SAVE_PREVIEW_COMPLETE),t.events.trigger(t.events.HISTORY_TRANSACTION_INIT)},e.prototype.savePreviewComplete=function(){var e=t.config.getFile()+t.config.ugcPath()+t.config.profileID()+"/savedDesign"+t.config.previewImageUrl.split("savedDesign")[1];t.config.previewImageUrl=e;var i={profileId:t.config.profileID(),uniqueItemId:t.config.uniqueItemId(),uniqueItemName:t.config.saveProductName,skuId:t.config.skuID(),productId:t.config.productID(),categoryId:t.config.categoryID(),productXML:t.save(),previewImageUrl:e,quantity:t.config.quantity(),saveAsNew:t.config.saveAsNew,nfc:!0,autoSave:this.isAutoSave,_windowid:t.config.windowid()};
i.subSkuIds=t.productOptions.getSubSkuIdList(),t.config.setSubSkuIds(i.subSkuIds),t.$.ajax({url:t.config.saveItem(),headers:t.config.getRequestHeaders(),data:i,type:"POST",dataType:"text",success:function(e){t.dialogs.busyDialog.hide();var i=!0;if(e.indexOf("saveAsNewUniqueItemId")>-1){var o=e.split("-"),n=t.$.trim(o[o.length-1]);t.config.setUniqueItemId(n),t.utils.HtmlUtil.setProductName(t.config.saveProductName)}if(e.indexOf("ERR_")>-1){var s=t.errors.parse(e);return i=!1,void t.dialogs.displayDialog("Error",s)}t.events.trigger(t.events.USER_SAVE_COMPLETE,t.config.uniqueItemId(),i)},error:function(e,i){0!=e.status&&(t.utils.AppUtil.isLocalhost()||(t.dialogs.busyDialog.hide(),t.dialogs.displayError("Error saving design",i+"\n"+e.responseText)))}})},e.prototype.saveComplete=function(e,i){""!=e?(t.savedUserLocation=new t.model.SavedUserLocation(t.product.activeLayout,t.inPreviewMode),1==t.saveNotification&&t.dialogs.displayDialog("Message","Your design was saved to your account."),t.ugcSwap=null,t.services.loadSavedProduct(t.config.uniqueItemId()),i&&t.utils.HtmlUtil.setProductName(t.config.saveProductName)):t.dialogs.displayDialog("Error","There was a problem saving your design to your account.")},e.prototype.cacheBuster=function(){var t=new Date;return"cache="+t.getTime()},e.prototype.dumpSDXML=function(){var e="";t.utils.AppUtil.isLocalhost()&&(e="http://qa.fidipidi.com"),t.$.ajax({type:"POST",url:e+"/ConfigPrime/rest/jsontoxmlservice",data:{jsonStr:t.product.save()},dataType:"text",success:function(){},error:function(e,i){0!=e.status&&t.dialogs.displayError("Error converting JSON to XML",i+"\n"+e.responseText)}})},e}();e.ServiceManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.width=200,this.container=new createjs.Container,this.style=new createjs.Shape,this.container.addChild(this.style),this.text=new createjs.Text,this.textWidth=230,this.text.lineWidth=this.textWidth,this.text.font="12px Arial",this.padWidth=17,this.padHeight=15,this.text.x=this.padWidth,this.text.y=this.padHeight,this.container.addChild(this.text)}return e.prototype.show=function(e,i,o,n,s){"undefined"==typeof o&&(o="#F00"),"undefined"==typeof n&&(n="#D74746"),"undefined"==typeof s&&(s="#FFF"),this.text.text=e,t.stageRoot.addChild(this.container);var a=this.text.getMeasuredHeight(),r=Math.round(this.textWidth+2*this.padWidth),l=Math.round(a+2*this.padHeight);this.style.graphics.clear(),this.style.graphics.setStrokeStyle(2).beginStroke(n).beginFill(s).drawRect(0,0,r,l).endFill(),this.text.color=o,this.style.cache(0,0,r,l),this.style.shadow=new createjs.Shadow("#777",3,3,8),this.container.x=i.x+20,this.container.y=i.y-(Math.round(a)+40)},e.prototype.hide=function(){t.stageRoot.removeChild(this.container)},e.prototype.showCanvasNavigator=function(){},e}();e.TooltipManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.uploadCount=0,this.productUpdated=!1,this.backgroundSelectable=!0,t.events.on(t.events.PRODUCT_PERSONALIZED,this.onProductUpdated,this),t.events.on(t.events.DISABLE_BACKGROUND,this.onBackgroundDisabled,this),t.events.on(t.events.PRODUCT_CHANGED_BY_USER,this.onUserUpdatedProduct,this),this.onUserUpdatedProduct(!1)}return e.prototype.isPhotoTabEnabled=function(){return!t.product.isStamp()&&t.product.isUgcEnabled()},e.prototype.isBackgroundTabEnabled=function(){return t.product.isSingleColor()||!this.backgroundSelectable?!1:!t.product.isStamp()&&(t.product.isUgcEnabled()||null!=t.app.imageLibrary&&t.app.imageLibrary.hasBackgroundCategories())},e.prototype.isGraphicsTabEnabled=function(){return null!=t.app.imageLibrary&&t.app.imageLibrary.hasImageCategories()},e.prototype.isLayoutsTabEnabled=function(){return!t.product.isStamp()&&null!=t.productOptions&&t.productOptions.hasLayouts()},e.prototype.isPeepsTabEnabled=function(){return t.product.getActiveLayout().isPeepsEnabled},e.prototype.isUploadEnabled=function(){return"true"==t.config.registered()?!0:this.uploadCount<Number(t.config.maxTransientImages())},e.prototype.isSaveEnabled=function(){return!0},e.prototype.isResetEnabled=function(){return this.productUpdated},e.prototype.isAddTextEnabled=function(){return t.product.isAddTextEnabled()},e.prototype.isAddImageEnabled=function(e){"undefined"==typeof e&&(e=!1);var i=!1;return i=e?t.product.isUgcEnabled():t.product.isAddImageContainerEnabled(),!t.product.isStamp()&&i&&t.imageManager.imagesAddedCount<Number(t.config.maxImagesPerProduct())&&t.imageManager.imagesContainerCount<Number(t.config.maxImagesPerProduct())},e.prototype.maxImagesReached=function(){return t.imageManager.imagesContainerCount==Number(t.config.maxImagesPerProduct())},e.prototype.isZOrderEnabled=function(){return t.product.isZOrderEnabled()},e.prototype.isImageEffectsEnabled=function(){return t.product.isImageEffectsEnabled()},e.prototype.isHorizontalTextAlignEnabled=function(){return t.product.isHorizontalTextAlignEnabled()},e.prototype.isVerticalTextAlignEnabled=function(){return t.product.isVerticalTextAlignEnabled()},e.prototype.isSingleFontProduct=function(){return t.fonts.fontSet.fonts.length<2&&t.product.manifest.fonts.length<2},e.prototype.isLayoutFixed=function(){var e=this.isAddTextEnabled(),i=this.isAddImageEnabled();if(e||i)return!1;for(var o=t.product.getActiveLayout(),n=0;n<o.pageItems.length;n++){var s=o.pageItems[n];if("true"===s._scalable||"true"===s._movable)return!1}return!0},e.prototype.imageUploaded=function(){this.uploadCount++,t.events.trigger(t.events.IMAGE_COUNT_CHANGED)},e.prototype.imageDeleted=function(){this.uploadCount--,t.events.trigger(t.events.IMAGE_COUNT_CHANGED)},e.prototype.onProductUpdated=function(){this.productUpdated=!0,t.events.trigger(t.events.UPDATE_UI)},e.prototype.onBackgroundDisabled=function(){this.backgroundSelectable=!1,t.events.trigger(t.events.UPDATE_UI)},e.prototype.onUserUpdatedProduct=function(e){"undefined"==typeof e&&(e=!0),t.utils.HtmlUtil.setAskBeforeQuit(e)},e}();e.UIManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){"use strict";var i=function(){function e(){}return e.prototype.getKeyData=function(e){return t.utils.WebStorageUtil.getStoredData(e)},e.prototype.setData=function(e,i){"undefined"==typeof i&&(i=!1);var o=!1;try{if(e){var n,s,a;i===!1&&t.utils.WebStorageUtil.clearStoredData();for(var r=0;r<e.length;r++)n=t.$(e[r]).attr("designerLabel"),s=t.$(e[r]).val(),i===!0&&t.utils.WebStorageUtil.storeData(n,s),a=t.controls.ComponentFactory.lookupControlById(t.$(e[r]).attr("productId")),s=t.utils.TextUtil.trim(s),this.setText(a,s);o=!0}}catch(t){o=!1}return o},e.prototype.preSetData=function(e){var i;try{var o=t.utils.TextUtil.trim(t.$(e).val()),n=t.controls.ComponentFactory.lookupControlById(t.$(e).attr("productId"));this.setText(n,o),i=!0}catch(t){i=!1}return i},e.prototype.getCurrentOrderedTextObjects=function(){var e,i,o,n=[],s=t.product.activeLayout;e=t.$.extend(!0,[],t.product.layouts[s].pageItems);for(var a=0;a<e.length;a++)i=e[a]._designerLabel,o=e[a]._type,void 0!=i&&"_unmapped"!==i&&""!==i&&(t.utils.LoggingUtil.log("WizardManager",i,t.utils.LoggingUtil.INFO),n.push(this.getWizardLayout(e[a])));return t._.sortBy(n,function(t){return"text"==t.pageItem._type?t.pageItem.TextBlock.Frame._yOffset/1:1e5})},e.prototype.manageTextValue=function(e,i){if("undefined"==typeof e&&(e=""),"undefined"==typeof i&&(i=""),0==e.length){e=i;var o=e.split("\\n");e="";for(var n=0;n<o.length;n++)e+=o[n]+"\n"}return t.$.trim(e)},e.prototype.getWizardLayout=function(e){var i,o,n=t.product.layouts[t.product.activeLayout].paragraphStyles,s=0;if(n&&e.TextBlock){var a=e.TextBlock._paraStyle,r=e._defaultText.split("\\n");s=r.length,i="left",o=e._defaultText;for(var l=0;l<n.length;l++)if(n[l]._name===a&&""!==n[l]._textAlign){i=n[l]._textAlign;break}}var h={pageItem:e,alignment:i,lineCount:s};return h},e.prototype.setText=function(t,e){"undefined"==typeof e&&(e=""),t.setQuickText(e)},e}();e.WizardManager=i}(t.managers||(t.managers={}));t.managers}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(t,e,i){this.dismissed=!1,this.type="canvas",this.message=t,this.shouldShowCheck=i,this.location=e,this.init(),this.initDisplayObject()}return e.prototype.init=function(){this.show=t._.bind(this.showImpl,this),this.hide=t._.bind(this.hideImpl,this),this.reset=t._.bind(this.resetImpl,this),this.dimensions={height:0,width:0},this.hideTipDelay=15e3},e.prototype.onClicked=function(){this.hideImpl(!0),this.container.removeAllEventListeners()},e.prototype.initDisplayObject=function(t){var e=new createjs.Container,i=new createjs.Shape,o=new createjs.Text;t=t||{padX:17,padY:15,lineWidth:120},e.addChild(i),o.lineWidth=t.lineWidth,o.font="12px Arial",o.x=t.padX,o.y=t.padY,o.text=this.message,o.color="#000",this.dimensions.height=Math.round(o.getMeasuredHeight())+2*t.padY,this.dimensions.width=t.lineWidth+2*t.padX,i.graphics.clear(),i.graphics.setStrokeStyle(2).beginStroke("#999").beginFill("#FFF").drawRect(0,0,this.dimensions.width,this.dimensions.height).endFill(),i.tip=this,i.cache(0,0,this.dimensions.width,this.dimensions.height),i.shadow=new createjs.Shadow("#777",3,3,8),e.addChild(o),this.container=e},e.prototype.getLocation=function(){var e;if("function"==typeof this.location)e=this.location(t.product.layouts);else{if("object"!=typeof this.location)return null;e=this.location}if(!e)return null;if(e.x<this.dimensions.width+5){var i=e.y-this.dimensions.height+5;i>=this.dimensions.height+5&&(e.y=i)}else e.x-=this.dimensions.width+5;return e},e.prototype.showImpl=function(){var e=this.getLocation();e&&(t.stageRoot.addChild(this.container),this.container.x=Math.floor(e.x),this.container.y=Math.floor(e.y),this.container.addEventListener("click",t._.bind(this.onClicked,this)),clearInterval(this.hideTipTimeout),this.hideTipTimeout=setTimeout(this.hide,this.hideTipDelay))},e.prototype.hideImpl=function(e){"undefined"==typeof e&&(e=!1),e&&(this.dismissed=e),clearInterval(this.hideTipTimeout),t.stageRoot.removeChild(this.container),t.updateStage()},e.prototype.resetImpl=function(){this.dismissed=!1},e.prototype.shouldShow=function(){return this.dismissed?!1:this.shouldShowCheck.call(this)},e}();e.CanvasWorkflowHint=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(t,i,o,n){"undefined"==typeof n&&(n=e.defaultShouldShowCheck),this.dismissed=!1,this.template='<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',this.visible=!1,this.type="dom",this.init(t,i,o,n)}return e.prototype.shouldShow=function(){return this.dismissed||this.visible?!1:this.shouldShowCheck.call(this)},e.prototype.show=function(){setTimeout(function(t){t.showImpl.call(t)},300,this)},e.prototype.init=function(t,e,i,o){this.message=t,this.selector=e,this.orientation=i,this.shouldShowCheck=o},e.defaultShouldShowCheck=function(){return!0},e.prototype.hide=function(e){function i(){var e=setTimeout(function(){o.off(t.$.support.transition.end).detach()},500);o.one(t.$.support.transition.end,function(){clearTimeout(e),o.detach()})}"undefined"==typeof e&&(e=!1);var o=this.tip();e&&(this.dismissed=e),o.off("click"),t.$.support.transition&&this.$tip.hasClass("fade")?i():o.detach(),o.removeClass("in"),o.dismissed=!0,o.displayed=!1},e.prototype.setContent=function(){var t=this.tip();t.find(".tooltip-inner").text(this.message),t.removeClass("fade in top bottom left right")},e.prototype.getPosition=function(){var e=this.element();return t.$.extend({},e.offset(),{width:e[0].offsetWidth,height:e[0].offsetHeight})},e.prototype.tip=function(){return this.$tip=this.$tip||t.$(this.template)},e.prototype.element=function(){return t.$(this.selector)},e.prototype.showImpl=function(){var e,i,o,n,s,a,r;switch(i=this.element(),e=this.tip(),this.setContent.call(this),e.detach().css({top:0,left:0,display:"block"}).insertAfter(i),a=this.orientation,o=this.getPosition(),n=e[0].offsetWidth,s=e[0].offsetHeight,a){case"bottom":r={top:o.top+o.height,left:o.left+o.width/2-n/2};break;case"top":r={top:o.top-s,left:o.left+o.width/2-n/2};break;case"left":r={top:o.top+o.height/2-s/2,left:o.left-n};break;case"right":r={top:o.top+o.height/2-s/2,left:o.left+o.width}}e.offset(r).addClass(a).addClass("in"),e.on("click .tooltip-inner",i.parent(),t._.bind(this.hide,this)),this.visible=!0,e.delay(2e4).fadeOut(300)},e.prototype.reset=function(){this.dismissed=!1},e}();e.DomWorkflowHint=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(e){this.variants=[],this.id=e.fontFamilyId,this.fontFamily=e.fontFamily,this.screenName=e.screenName,this.minSize=parseInt(e.hc_fontSizeMin),this.maxSize=parseInt(e.hc_fontSizeMax),this.previewImg=e.previewImg,this.cssUrl=t.utils.AppUtil.isLocalhost()?e.cssUrlLocal:e.cssUrl,this.isLoaded=!1;for(var i=t.utils.JsonUtil.getList(e.fontVariant),o=0;o<i.length;o++){var n=i[o],s=new t.model.FontVariant(n);this.variants.push(s)}}return e.prototype.getPreview=function(){return t.config.fontURL()+"/"+this.previewImg},e.prototype.getVariant=function(t){for(var e=0;e<this.variants.length;e++){var i=this.variants[e];if(i.fontStyle==t)return i}return null},e.prototype.getVariantByScreenName=function(t){for(var e=0;e<this.variants.length;e++){var i=this.variants[e];if(i.styleScreenName==t)return i}return null},e.prototype.getScreenName=function(t){for(var e=0;e<this.variants.length;e++){var i=this.variants[e];if(i.htmlFontFamily==t)return i.styleScreenName}return""},e.prototype.toJson=function(t){var e={_fontFamily:this.fontFamily,_hc_fontSizeMax:this.maxSize,_hc_fontSizeMin:this.minSize};if("undefined"==typeof t||null==t){e.fontVariant=[];for(var i=0;i<this.variants.length;i++){var o=this.variants[i];e.fontVariant.push(o.toJson())}}else e.fontVariant=t.toJson();return e},e}();e.Font=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(){this.OriginalFontIds=[]}return t}();t.FontReplacementObject=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(e){this.name=e.Name,this.fonts=t.utils.ObjectUtil.isUndefined(e.Fonts)?[]:e.Fonts;for(var i=t.product.getActiveLayout(),o=0;o<i.fonts.length;o++){for(var n=i.fonts[o],s=!1,a=0;a<this.fonts.length;a++){var r=this.fonts[a],l=r.Family;if(n._fontFamily==l){s=!0;break}}s||this.fonts.unshift({Family:n._fontFamily})}this.fonts.sort(this.sortFontSet)}return e.prototype.sortFontSet=function(t,e){return t.Family>e.Family?1:-1},e}();e.FontSet=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(t){this.kerning={},this.json=t,this.fontStyle=t.fontStyle,this.styleScreenName=t.styleScreenName,this.htmlFontFamily=this.processHtmlFontFamily(t.htmlFontFamily),this.fontId=t.fontId,this.isKerningLoaded=!1,this.callbacks=[]}return e.prototype.processHtmlFontFamily=function(e){return e?t.utils.AppUtil.isLocalhost()?e:e.split(" ").join("_"):e},e.prototype.toJson=function(){var t={};for(var e in this.json)t["_"+e]=this.json[e];return t},e.prototype.getHorizontalShift=function(e,i,o,n){"undefined"==typeof n&&(n=0);var s=this.kerning[e];o=parseFloat(o),s&&"undefined"!=typeof s||(s=this.kerning["horiz-adv-x"]);var a=this.getTotalShift(s,o,n);if(null!=i){var r=this.kerning[e+""+i];if(!t.utils.ObjectUtil.isUndefined(r)&&!isNaN(r)){var l=this.getTotalShift(r,o,n);a-=l}}return a},e.prototype.getRightShiftPad=function(e,i,o,n,s){"undefined"==typeof i&&(i=""),"undefined"==typeof o&&(o=""),"undefined"==typeof n&&(n=""),"undefined"==typeof s&&(s=!1);var a=e.measureText(n.slice(-1)).width,r=t.fonts.requiredRightPadding(o);return s===!1&&(a=0),"object"==typeof r&&r.px?a+=r.px:"width"===r?a=e.measureText(" ").width:"em"===r&&(a=this.kerning[" "]/this.kerning["units-per-em"]*i),a},e.prototype.getTotalShift=function(t,e,i){var o;return o=t/this.kerning["units-per-em"]*e+i/1e3*e},e}();e.FontVariant=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.pixelHeight="100",this.pixelWidth="100",this.isPeep=!1,this.url=null,this.COLOR_OPTIONS=[t.controls.Image.SEPIA,t.controls.Image.GRAY,t.controls.Image.BW]}return e.prototype.toJson=function(){var e=this.isUgcImage,i=this.isLibraryImage,o={_imageId:this.imageId,_webFilename:this.webFilename,_printFilename:this.printFilename,_thumbnailImage:this.thumbnailImage,_libraryImage:i.toString(),_ugcImage:e.toString()};return t.utils.ObjectUtil.notUndefined(this.pixelHeight)&&(o._pixelHeight=this.pixelHeight),t.utils.ObjectUtil.notUndefined(this.pixelWidth)&&(o._pixelWidth=this.pixelWidth),o},e.prototype.encodeTint=function(t){0==t.indexOf("#")&&(t=t.substring(1));var e="_"+t,i=this.imageId.lastIndexOf("_");-1==i?(this.imageId=this.imageId+e,this.addSuffix("printFilename",e),this.addSuffix("webFilename",e),this.addSuffix("thumbnailImage",e)):(this.replaceSuffix("imageId",e),this.replaceSuffix("printFilename",e),this.replaceSuffix("webFilename",e),this.replaceSuffix("thumbnailImage",e))},e.prototype.encodeColor=function(e){var i="_"+e;this.isColorized()||e==t.controls.Image.COLOR?this.isColorized()&&e!=t.controls.Image.COLOR?(this.replaceSuffix("imageId",i),this.replaceSuffix("printFilename",i),this.replaceSuffix("webFilename",i),this.replaceSuffix("thumbnailImage",i)):this.isColorized()&&e==t.controls.Image.COLOR&&(this.stripSuffix("imageId"),this.stripSuffix("printFilename"),this.stripSuffix("webFilename"),this.stripSuffix("thumbnailImage")):(this.imageId=this.imageId+i,this.addSuffix("printFilename",i),this.addSuffix("webFilename",i),this.addSuffix("thumbnailImage",i))},e.prototype.addSuffix=function(t,e){var i=this[t].lastIndexOf(".");if(-1==i)return void(this[t]=this[t]+e);var o=this[t].substr(0,i),n=this[t].substr(i);this[t]=o+e+n},e.prototype.replaceSuffix=function(t,e){var i=this[t].lastIndexOf("_"),o=this[t].lastIndexOf("."),n=this[t].substr(0,i);if(-1==o)return void(this[t]=n+e);var s=this[t].substr(o);this[t]=n+e+s},e.prototype.stripSuffix=function(t){var e=this[t].lastIndexOf("_"),i=this[t].lastIndexOf("."),o=this[t].substr(0,e);if(-1==i)return void(this[t]=o);var n=this[t].substr(i);this[t]=o+n},e.prototype.isColorized=function(){for(var t=0;t<this.COLOR_OPTIONS.length;t++){var e=this.COLOR_OPTIONS[t];if(this.imageId.indexOf("_"+e)>0)return!0}var i="f1655d",o=this.imageId.lastIndexOf("_");return-1!=o&&this.imageId.length==o+i.length+1?!0:!1},e.prototype.isBlackAndWhite=function(){return this.imageId.indexOf("_BW")>0},e.prototype.updateToBW=function(e){if(t.utils.ObjectUtil.isEmpty(e))return this.encodeColor(t.controls.Image.BW),void(this.url=this.isUgcImage?t.config.getFile()+this.webFilename:this.webFilename);try{var i=JSON.parse(e);this.imageId=i.fileId+"_BW",this.printFilename=i.printImageURL,this.webFilename=i.previewImageURL,this.thumbnailImage=i.thumbnailImageURL,this.url=this.isUgcImage?t.config.getFile()+this.webFilename:this.webFilename}catch(t){}},e.clone=function(e){var i=new t.model.ImageAsset;return i.imageId=e.imageId,i.fileId=e.fileId,i.isLibraryImage=e.isLibraryImage,i.isUgcImage=e.isUgcImage,i.printFilename=e.printFilename,i.webFilename=e.webFilename,i.thumbnailImage=e.thumbnailImage,i.pixelHeight=e.pixelHeight,i.pixelWidth=e.pixelWidth,i},e.createFromSDXML=function(e){var i=new t.model.ImageAsset;return i.imageId=e._imageId,i.fileId=i.imageId,i.isLibraryImage="true"==e._libraryImage,i.isUgcImage="true"==e._ugcImage,i.printFilename=e._printFilename,i.webFilename=e._webFilename,i.thumbnailImage=e._thumbnailImage,i.pixelHeight=e._pixelHeight,i.pixelWidth=e._pixelWidth,i},e.createFromUGC=function(e){var i=new t.model.ImageAsset;return i.imageId=e.fileId,i.fileId=i.imageId,i.isLibraryImage=!1,i.isUgcImage=!0,i.printFilename=e.printImageURL,i.webFilename=e.previewImageURL,i.thumbnailImage=e.thumbnailImageURL,i.pixelHeight=e.height,i.pixelWidth=e.width,i},e.createFromLibrary=function(e,i){var o=new t.model.ImageAsset;return o.imageId=e._name,o.fileId=i,o.isLibraryImage=!0,o.isUgcImage=!1,o.printFilename=e.printURL,o.webFilename=e.previewURL,o.thumbnailImage=e.thumbnailURL,o},e.createFromPaperstock=function(e,i){var o=new t.model.ImageAsset;return o.imageId=e._name,o.fileId=t.utils.ObjectUtil.isUndefined(i)?o.imageId:i,o.isLibraryImage=!0,o.isUgcImage=!1,o.printFilename=e.printURL,o.webFilename=e.previewURL,o.thumbnailImage=e.thumbnailURL,o.url=e.previewURL,o},e}();e.ImageAsset=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(e){if(this.imageCategories=[],this.backgroundCateories=[],this.stockCategory=null,this.stockImageData=null,this.stockImages=[],!t.utils.ObjectUtil.isUndefined(e))for(var i=0;i<e.length;i++){var o=e[i];"Images"==o._type&&null!=o.category?this.imageCategories=o.category:"Background"==o._type&&null!=o.category?this.backgroundCateories=o.category:"Stock"==o._type&&null!=o.category&&(this.stockCategory=o.category)}}return e.prototype.setStockImageData=function(e){this.stockImageData=e,this.stockImages=this.stockImageData.image,null!=t.productOptions&&this.updatePaperOptions()},e.prototype.updatePaperOptions=function(){if(!t.utils.ObjectUtil.isUndefined(this.stockImages)){var e=t.productOptions.getPaperOptionData();if(null!=e&&null!=this.stockImages&&0!=this.stockImages.length){e.hasPreviewImage=!0;for(var i=e.list,o=0;o<i.length;o++)for(var n=i[o],s=0;s<this.stockImages.length;s++){var a=this.stockImages[s];n.sku!=a._shortTitle||(n.previewImageUrl=a.thumbnailURL)}}}},e.prototype.getFreePaperOption=function(){if(t.utils.ObjectUtil.isUndefined(this.stockImages))return null;var e=t.productOptions.getPaperOptionData();if(null==e||null==this.stockImages||0==this.stockImages.length)return null;for(var i=e.list,o=0;o<i.length;o++){var n=i[o];if(!(0==n.sku.indexOf("NONE-")||n.getPrice(t.config.quantity())>0))for(var s=0;s<this.stockImages.length;s++){var a=this.stockImages[s];if(n.sku==a._shortTitle)return a}}return null},e.prototype.hasImageCategories=function(){return this.imageCategories.length>0},e.prototype.hasBackgroundCategories=function(){return this.backgroundCateories.length>0},e.prototype.hasStockCategory=function(){return null!=this.stockCategory},e.prototype.hasStockImages=function(){return null!=this.stockImages&&this.stockImages.length>0},e.prototype.getImageCategories=function(){return this.imageCategories},e.prototype.getBackgroundCategories=function(){return this.backgroundCateories},e.prototype.getStockDataUrl=function(){return this.stockCategory._webserverPath},e.prototype.getStockImage=function(t){for(var e=0;e<this.stockImages.length;e++){var i=this.stockImages[e];if(t==i._shortTitle)return i}return null},e}();e.ImageLibrary=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(e){this.autoAddBack=!1,this.FlexAppVersion="NFC",this.isPeepsEnabled=!1,this.loaded=!1,this.layout=e,this.originalLayout=t.$.extend(!0,{},this.layout),this.init()}return e.prototype.reset=function(){this.layout=t.$.extend(!0,{},this.originalLayout),this.init()},e.prototype.setParagraphStyles=function(){for(var e=this.layout.Template.styles.paragraphStyles,i=t.utils.JsonUtil.getList(e.ParagraphStyle),o=0;o<i.length;o++)0==i[o]._color.length&&(i[o]._color="#000000"),i[o]._tracking||(i[o]._tracking="0");this.paragraphStyles=i},e.prototype.init=function(){var e=this.layout.Template;this.height=Number(e._height),this.width=Number(e._width),this.swatches=t.utils.JsonUtil.getList(e.swatches.Swatch),this.fonts=t.utils.JsonUtil.getList(e.fonts.Font);var i=t.utils.JsonUtil.getList(e.imageAssets.ImageAsset);this.imageAssets=this.parseImageAssets(i),this.defaults=t.utils.JsonUtil.getList(e.defaults.Default),this.stories=t.utils.JsonUtil.getList(e.stories.Story),this.fontSetName=e._hc_fontSet,this.FlexAppVersion=t.utils.AppUtil.setConfiguratorVersion(e._FlexAppVersion);var o=e.pages.Page;this.isAddImageContainerEnabled="true"==o._addImageFrames||"True"==o._addImageFrames,this.isAddTextEnabled="true"==o._addTextFrames||"True"==o._addTextFrames,this.isUploadUserImageEnabled="true"==o._uploadUserImages||"True"==o._uploadUserImages,this.isPeepsEnabled="true"==o._allowPeeps||"True"==o._allowPeeps,this.pageItems=t.utils.JsonUtil.getList(o.PageItemBlock),this.setParagraphStyles(),this.parseProductInfo(e._productInfo),e.hasOwnProperty("_hc_autoAddBack")&&(this.autoAddBack="True"==e._hc_autoAddBack),this.checkForReplacementFonts(),this.loaded=!1},e.prototype.copyPersonalizedPageItems=function(t){for(var e=[],i=0;i<this.pageItems.length;i++){var o=this.pageItems[i];"text"!=o._type&&"image"!=o._type&&e.push(o)}this.pageItems=e;for(var n=0;n<t.pageItems.length;n++){var o=t.pageItems[n];("text"==o._type||"image"==o._type)&&this.pageItems.push(o)}this.stories=[];for(var s=0;s<t.stories.length;s++){var a=t.stories[s];this.stories.push(a)}this.paragraphStyles=[];for(var r=0;r<t.paragraphStyles.length;r++){var l=t.paragraphStyles[r];this.paragraphStyles.push(l)}this.fonts=[];for(var h=0;h<t.fonts.length;h++){var c=t.fonts[h];this.fonts.push(c)}for(var d=0;d<t.imageAssets.length;d++){var p=t.imageAssets[d];(p.isUgcImage||p.isLibraryImage)&&this.addImageAsset(p)}},e.prototype.checkForReplacementFonts=function(){},e.prototype.parseProductInfo=function(t){this.productInfo={};for(var e=t.split("|"),i=0;i<e.length;i++){var o=e[i].split("="),n=o[0],s=o[1];this.productInfo[n]=s}},e.prototype.parseImageAssets=function(e){for(var i=[],o=0;o<e.length;o++)i.push(t.model.ImageAsset.createFromSDXML(e[o]));return i},e.prototype.getFontColorCount=function(){for(var t=0,e=0;e<this.swatches.length;e++)0==this.swatches[e]._templateName.indexOf("s_")&&t++;return t},e.prototype.getFontSwatches=function(){for(var t=[],e=0;e<this.swatches.length;e++)0==this.swatches[e]._templateName.indexOf("s_")&&t.push(this.swatches[e]);return t},e.prototype.getSwatch=function(t){for(var e=0;e<this.swatches.length;e++)if(0==this.swatches[e]._templateName.indexOf("s_"+t))return this.swatches[e];return null},e.prototype.setDefaultColor=function(t){for(var e=null,i=0;i<this.swatches.length;i++)if(0==this.swatches[i]._templateName.indexOf("s_")&&this.swatches[i]._rgbValue==t){e=this.swatches[i];break}if(null!=e)for(var i=0;i<this.swatches.length;i++)if(0==this.swatches[i]._templateName.indexOf("d_")){var o=this.swatches[i];return o._rgbValue=e._rgbValue,o._designerLabel="d_"+e._designerLabel.substring(2),void(o._templateName="d_"+e._templateName.substring(2))}},e.prototype.toJson=function(){this.updateFonts(),this.updateParagraphStyles(),this.updateStories(),this.updatePageItems(),this.updateImageAssets();try{this.layout.Template._FlexAppVersion=t.utils.AppUtil.setConfiguratorVersion(this.FlexAppVersion),this.layout.Template._Browser=this.browserInformation(),this.layout.Template._BrowserVersion=encodeURI(navigator.appVersion),this.layout.Template._OS=this.osInformation()}catch(t){this.layout.Template._FlexAppVersion="NFC N/A",this.layout.Template._Browser="NFC Browser Unknown",this.layout.Template._BrowserVersion="NFC Browser Version Unknown",this.layout.Template._OS="NFC OS Unknown"}return this.layout},e.prototype.clear=function(){this.imageAssets=[]},e.prototype.updateFonts=function(){if(1==this.fonts.length)return void(this.layout.Template.fonts.Font=this.fonts[0]);this.layout.Template.fonts.Font=[];for(var t=0;t<this.fonts.length;t++)this.layout.Template.fonts.Font.push(this.fonts[t])},e.prototype.updateStories=function(){if(this.layout.Template.stories={},1==this.stories.length)return void(this.layout.Template.stories.Story=this.stories[0]);this.layout.Template.stories.Story=[];for(var t=0;t<this.stories.length;t++)this.layout.Template.stories.Story.push(this.stories[t])},e.prototype.updatePageItems=function(){if(1==this.pageItems.length)return void(this.layout.Template.pages.Page.PageItemBlock=this.pageItems[0]);this.layout.Template.pages.Page.PageItemBlock=[];for(var t=0;t<this.pageItems.length;t++)this.layout.Template.pages.Page.PageItemBlock.push(this.pageItems[t])},e.prototype.updateParagraphStyles=function(){for(var e=0;e<this.paragraphStyles.length;e++)t.utils.ObjectUtil.isEmpty(this.paragraphStyles[e]._color)&&(this.paragraphStyles[e]._color="#231F20");if(1==this.paragraphStyles.length)return void(this.layout.Template.styles.paragraphStyles.ParagraphStyle=this.paragraphStyles[0]);this.layout.Template.styles.paragraphStyles.ParagraphStyle=[];for(var e=0;e<this.paragraphStyles.length;e++)!t.utils.ObjectUtil.isEmpty(this.paragraphStyles[e]._name)&&this.isStyleInUse(this.paragraphStyles[e]._name)&&this.layout.Template.styles.paragraphStyles.ParagraphStyle.push(this.paragraphStyles[e])},e.prototype.isStyleInUse=function(e){for(var i=0;i<this.pageItems.length;i++){var o=t.utils.ObjectUtil.notUndefined(this.pageItems[i].TextBlock);if(o){var n=!t.utils.ObjectUtil.isEmpty(this.pageItems[i].TextBlock._paraStyle);if(n&&this.pageItems[i].TextBlock._paraStyle==e)return!0}}var s=this.getDefaultTextItem();if(null!=s&&s.TextBlock._paraStyle==e)return!0;for(var a,r,l,h,c=0;c<this.stories.length;c++)if(a=this.stories[c],a&&a.TextFlow){r=t.utils.ObjectUtil.notUndefined(a.TextFlow.div)?a.TextFlow.div:a.TextFlow,l=t.utils.JsonUtil.getList(r.p);for(var d=0;d<l.length;d++)if(h=l[d],h._paraStyle==e)return!0}return!1},e.prototype.addFont=function(t){for(var e=0;e<this.fonts.length;e++){var i=this.fonts[e];if(t.fontFamily==i._fontFamily)return void(this.fonts[e]=t.toJson())}this.fonts.push(t.toJson())},e.prototype.addImageAsset=function(t){for(var e=0;e<this.imageAssets.length;e++)if(t.imageId==this.imageAssets[e].imageId)return;this.imageAssets.push(t)},e.prototype.updateImageAssets=function(){if(this.layout.Template.imageAssets={},1==this.imageAssets.length)return void(this.layout.Template.imageAssets.ImageAsset=this.imageAssets[0].toJson());this.layout.Template.imageAssets.ImageAsset=[];for(var t=0;t<this.imageAssets.length;t++)this.layout.Template.imageAssets.ImageAsset.push(this.imageAssets[t].toJson())},e.prototype.updateParagraphStyle=function(e){for(var i=0;i<this.paragraphStyles.length;i++)if(t.utils.SdxmlUtil.isEqual(e,this.paragraphStyles[i]))return t.$.extend(!0,{},this.paragraphStyles[i]);for(var o=!1,i=0;i<this.paragraphStyles.length;i++)if(e._name==this.paragraphStyles[i]._name){o=!0;break}return o===!0&&(e._name=t.utils.GUID.create()),this.paragraphStyles.push(e),e},e.prototype.createStory=function(e,i){"undefined"==typeof i&&(i="Add new Text");var o=t.managers.InstanceManager.nextStoryId(),n={_id:e._id},s={TextFrame:n},a=[],r=e.TextBlock._paraStyle,l="\\n";if(i.indexOf(l)<0)this.addParagraph(i,r,a);else{for(var h=0,c=i.indexOf(l);c>-1;){var d=i.substring(h,c);this.addParagraph(d,r,a),h=c+l.length,c=i.indexOf(l,h)}var p=i.substring(h);this.addParagraph(p,r,a)}var u={p:a},g={div:u,_xmlns:"http://ns.adobe.com/textLayout/2008",_alignmentBaseline:"useDominantBaseline",_blockProgression:"tb",_breakOpportunity:"auto",_fontLookup:"embeddedCFF",_leadingModel:"auto",_lineBreak:"toFit",_renderingMode:"cff",_verticalAlign:"top",_whiteSpaceCollapse:"preserve",_version:"2.0.0"},m={_id:o,textContainers:s,TextFlow:g};return this.stories.push(m),m},e.prototype.removePageItem=function(t){for(var e=0;e<this.pageItems.length;e++){var i=this.pageItems[e];if(t._id==i._id)return void this.pageItems.splice(e,1)}},e.prototype.addPageItem=function(t){this.pageItems.push(t)},e.prototype.replacePageItem=function(t,e){for(var i=0;i<this.pageItems.length;i++){var o=this.pageItems[i];if(t._id==o._id)return void(this.pageItems[i]=e)}},e.prototype.swapPageItem=function(e,i,o){for(var n,s,a=0;a<this.pageItems.length;a++){var r=this.pageItems[a];e._id===r._id?n=a:i._id===r._id&&(s=a)}s!=this.pageItems.length&&-1!=s&&("forward"===o&&s++,t.utils.ObjectUtil.swapItem(s,n,this.pageItems))},e.prototype.hasImageAsset=function(t){return null!=this.getImageAsset(t)
},e.prototype.getImageAsset=function(t){for(var e=0;e<this.imageAssets.length;e++){var i=this.imageAssets[e];if(i.imageId==t)return i}return null},e.prototype.getPaperstockPageItem=function(){for(var e=0;e<this.pageItems.length;e++){var i=this.pageItems[e];if(i._type==t.utils.Constants.PAPER_STOCK)return i}return null},e.prototype.getParagraphyStyle=function(t){for(var e=0;e<this.paragraphStyles.length;e++){var i=this.paragraphStyles[e];if(i._name==t)return i}return null},e.prototype.getStory=function(t){for(var e=0;e<this.stories.length;e++){var i=this.stories[e];if(i._id==t)return i}return null},e.prototype.updateStory=function(t){for(var e=0;e<this.stories.length;e++){var i=this.stories[e];if(i._id==t._id)return void(this.stories[e]=t)}this.stories.push(t)},e.prototype.removeStory=function(t){for(var e=0;e<this.stories.length;e++){var i=this.stories[e];if(i._id==t)return void this.stories.splice(e,1)}},e.prototype.getFontFamily=function(e){for(var i=0;i<this.fonts.length;i++)for(var o=this.fonts[i],n=t.utils.JsonUtil.getList(o.fontVariant),s=0;s<n.length;s++){var a=n[s];if(a._fontId==e)return o._fontFamily}return null},e.prototype.getFontStyle=function(e){for(var i=0;i<this.fonts.length;i++)for(var o=this.fonts[i],n=t.utils.JsonUtil.getList(o.fontVariant),s=0;s<n.length;s++){var a=n[s];if(a._fontId==e)return a._fontStyle}return null},e.prototype.getDefaultTextColor=function(){var e=this.getDefaultPageItem("defaultText");if(!t.utils.ObjectUtil.isEmpty(e.TextBlock._paraStyle)){var i=e.TextBlock._paraStyle,o=this.getParagraphyStyle(i);if(null!=o&&!t.utils.ObjectUtil.isEmpty(o._color))return o._color}return"#000000"},e.prototype.getDefaultTextItem=function(){return this.getDefaultPageItem("defaultText")},e.prototype.getDefaultImageItem=function(){return this.getDefaultPageItem("defaultImage")},e.prototype.hasPaperstock=function(){for(var e=0;e<this.pageItems.length;e++){var i=this.pageItems[e];if(i._type==t.utils.Constants.PAPER_STOCK)return!0}return!1},e.prototype.addParagraph=function(t,e,i){var o={_paraStyle:e,span:t};i.push(o)},e.prototype.getDefaultPageItem=function(t){for(var e=0;e<this.defaults.length;e++){var i=this.defaults[e].PageItemBlock;if(i._type==t)return i}return null},e.prototype.osInformation=function(){var t="N/A";return-1!=navigator.appVersion.indexOf("Win")&&(t="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(t="MacOS"),-1!=navigator.appVersion.indexOf("X11")&&(t="UNIX"),-1!=navigator.appVersion.indexOf("Linux")&&(t="Linux"),t},e.prototype.browserInformation=function(){var t=navigator.userAgent,e="",i=null!=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i);return i===!0&&(e="Mobile "),-1!=t.indexOf("Chrome")?e+="Chrome":-1!=t.indexOf("Safari")?e+="Safari":-1!=t.indexOf("Opera")?e+="Opera":-1!=t.indexOf("Firefox")?e+="Firefox":-1!=t.indexOf("MSIE")?e+="MSIE":e=encodeURI(navigator.appName),e},e}();e.Layout=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(e){this.manifest=e,this.originalManifest=t.$.extend(!0,{},this.manifest),this.init()}return e.prototype.reset=function(){this.manifest=t.$.extend(!0,{},this.originalManifest),this.init()},e.prototype.clear=function(){this.imageAssets=[],this.fonts=[]},e.prototype.init=function(){var e=this.manifest.LayoutBookMap;"_hc_productVersion"in e&&(this.productVersion=e._hc_productVersion),this.layoutType=e._layoutType,this.fonts=t.utils.JsonUtil.getList(e.fonts.Font),this.imageAssets=t.utils.JsonUtil.getList(e.imageAssets.ImageAsset),this.layoutRefs=t.utils.JsonUtil.getList(e.layoutRefs.LayoutRef),this.layoutCount=this.layoutRefs.length,this.isMultiScene="true"==e._hc_isMultiScene,this.pageCount=t.utils.ObjectUtil.isEmpty(e._hc_pagesPerScene)?this.layoutRefs.length:Number(e._hc_pagesPerScene),this.sceneCount=t.utils.ObjectUtil.isEmpty(e._hc_numberOfScenes)?0:Number(e._hc_numberOfScenes),this.scenes=[];for(var i=[],o=0;o<this.layoutCount;o++)i.push(o),(o+1)%this.pageCount==0&&(this.scenes.push(i),i=[])},e.prototype.updateAssets=function(t){for(var e=t.imageAssets,i=0;i<e.length;i++)this.addImageAsset(e[i]);for(var i=0;i<t.fonts.length;i++)this.addFont(t.fonts[i])},e.prototype.toJson=function(){return this.updateImageAssets(),this.updateFonts(),this.manifest},e.prototype.addImageAsset=function(t){for(var e=0;e<this.imageAssets.length;e++)if(t.imageId==this.imageAssets[e].imageId)return;this.imageAssets.push(t)},e.prototype.addFont=function(t){for(var e=0;e<this.fonts.length;e++){var i=this.fonts[e];if(t._fontFamily==i._fontFamily)return}this.fonts.push(t)},e.prototype.updateImageAssets=function(){if(this.manifest.LayoutBookMap.imageAssets={},1==this.imageAssets.length)return void(this.manifest.LayoutBookMap.imageAssets.ImageAsset=this.imageAssets[0].toJson());this.manifest.LayoutBookMap.imageAssets.ImageAsset=[];for(var t=0;t<this.imageAssets.length;t++)this.manifest.LayoutBookMap.imageAssets.ImageAsset.push(this.imageAssets[t].toJson())},e.prototype.updateFonts=function(){if(1==this.fonts.length)return void(this.manifest.LayoutBookMap.fonts.Font=this.fonts[0]);this.manifest.LayoutBookMap.fonts.Font=[];for(var t=0;t<this.fonts.length;t++)this.manifest.LayoutBookMap.fonts.Font.push(this.fonts[t])},e}();e.Manifest=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(){}return t}();t.Peep=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(t){this.json=t,this.transform=this.json._transform,this.paths=this.getList(this.json.path)}return t.prototype.getPaths=function(){return this.paths},t.prototype.getList=function(t){return"undefined"==typeof t?[]:t instanceof Array?t:[t]},t}();t.PeepComponent=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){this.editors=[],this.spacing=0,this.spacingMin=0,this.spacingMax=20,this.xPos=0,this.height=0,this.width=0,this.peepsMax=10,this.peepsTotal=0,this.peepAttributes=new t.editors.PeepAttributeEdit,this.$peepAttributes=t.$("#peepAttributeEditor"),this.$peepAttributes.hide(),t.events.on(t.events.PEEPS_SPACING_ADJUSTMENT,this.onSpacingAdjustment,this),t.events.on(t.events.PEEPS_REMOVE,t._.bind(this.onRemovePeep,this)),t.events.on(t.events.PEEPS_MOVE_RIGHT,t._.bind(this.onMovePeepRight,this)),t.events.on(t.events.PEEPS_MOVE_LEFT,t._.bind(this.onMovePeepLeft,this)),t.events.on(t.events.PEEPS_CLEANSE,this.reset,this),e.call(this)}return __extends(i,e),i.prototype.update=function(){this.maintainCollectionOrder(),t.events.trigger(t.events.PEEPS_RECALCULATE_FAMILY_SIZE,this),t.events.trigger(t.events.PEEPS_RECALCULATE_HEIGHT,this.height),t.app.views.peepsCanvasView.peepStage.update()},i.prototype.reset=function(){this.editors=[],this.spacing=0,this.xPos=0,this.height=0,this.width=0,this.peepsTotal=0,this.removeAllChildren(),this.$peepAttributes.hide()},i.prototype.onPeepMouseClick=function(t){this.setActivePeep(t)},i.prototype.onSpacingAdjustment=function(t){this.spacing>=this.spacingMin&&this.spacing<=this.spacingMax&&(this.spacing+=t,this.spacing<this.spacingMin&&(this.spacing=this.spacingMin),this.spacing>this.spacingMax&&(this.spacing=this.spacingMax),this.calculateContainerSize(),this.calibrateSpacing())},i.prototype.addPeep=function(e){if(this.editors.length<this.peepsMax){var i=new t.editors.PeepEdit(e);this.addChild(i),this.calculateContainerSize(),this.configurePeep(i),this.xPos+=i.width+this.spacing,this.editors.push(i),this.setActivePeep(i),this.update(),t.events.trigger(t.events.PEEPS_ADDED_PEEP)}else t.dialogs.displayDialog("Maximum Peeps Reached","You have reached the maximum number of Peeps that can be added to the product. To continue adding Peeps, you must remove other Peeps.")},i.prototype.configurePeep=function(e){e.x=this.xPos,e.addEventListener("click",t._.bind(this.onPeepMouseClick,this,e))},i.prototype.calculateContainerSize=function(){this.width=0,this.height=0;for(var t,e=0,i=0;i<this.getNumChildren();i++)t=this.getChildAt(i),e=t.transform.height+t.labelHeight,e>this.height&&(this.height=e),this.width+=t.width+this.spacing;this.width-=this.spacing},i.prototype.onRemovePeep=function(e){var i,o;for(i=0;i<this.getNumChildren();i++)if(o=this.getChildAt(i),o.peepId===e.peepId){this.removeChildAt(i);break}for(i=0;i<this.editors.length;i++)if(this.editors[i].peepId===e.peepId){this.editors[i].clean(),this.editors.splice(i,1);break}this.calculateContainerSize(),this.calibrateSpacing(),t.events.trigger(t.events.PEEPS_HIDE_ATTRIBUTES),this.update()},i.prototype.onMovePeepLeft=function(t){var e=this.getPeepIndex(t);if(e>0){var i=e-1,o=this.editors[i],n=o.x;t.x=n,o.x+=t.width+this.spacing,this.update()}},i.prototype.onMovePeepRight=function(t){var e=this.getPeepIndex(t);if(e<this.editors.length-1){{var i=(this.editors.length-1,this.editors[e+1]);i.x}i.x=t.x,t.x+=i.width+this.spacing,this.update()}},i.prototype.getPeepIndex=function(t){for(var e=0;e<this.editors.length;e++)if(this.editors[e].id===t.id)return e;return null},i.prototype.maintainCollectionOrder=function(){this.editors.sort(function(t,e){return t.x-e.x});for(var t,e=0;e<this.editors.length;e++)t=this.editors[e],t.isFirst=0==e?!0:!1,t.isLast=e==this.editors.length-1?!0:!1},i.prototype.calibrateSpacing=function(){this.xPos=0;for(var t=0;t<this.editors.length;t++)this.editors[t].x=this.xPos,this.xPos+=this.editors[t].width+this.spacing;this.update()},i.prototype.save=function(){this.doc=new t.model.SVGDocument,this.doc.setFamilyDimensions(this.width,this.height);for(var e=0;e<this.editors.length;e++)this.doc.addGroup(this.editors[e].save(this.editors[e].x,this.editors[e].content.y).json);this.convertToXML(this.doc)},i.prototype.convertToXML=function(e){var i="",o=window;i=o.location.host.indexOf("localhost:9000")>-1?"http://qa.fidipidi.com":t.config.getImageURL(),t.$.ajax({type:"POST",url:i+"/ConfigPrime/rest/jsontoxmlservice",data:{jsonStr:e.toString()},dataType:"text",success:function(e){t.peepsManager.savePeeps(e)},error:function(e,i){0!=e.status&&t.dialogs.displayDialog("Error converting JSON to XML",i+"\n"+e.responseText)}})},i.prototype.deactivateEditors=function(){for(var t=0;t<this.editors.length;t++)this.editors[t].active=!1,this.editors[t].frame.visible=!1;this.$peepAttributes.hide()},i.prototype.setActivePeep=function(t){for(var e=0;e<this.editors.length;e++)this.editors[e].setActive(!1);t.setActive(!0),this.$peepAttributes.show(),this.peepAttributes.render()},i.prototype.setWhiteBackground=function(t){if(t){var e=new createjs.Shape((new createjs.Graphics).beginFill("#FFFFFF").rect(0,0,this.width,this.height).endFill());this.addChildAt(e,0),this.update()}else this.removeChildAt(0),this.update()},i}(createjs.Container);e.PeepFamily=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(t,e){this.x=t,this.y=e}return e.prototype.subtract=function(e){return new t.model.Point(this.x-e.x,this.y-e.y)},e}();e.Point=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];this.points=[t].concat(e)}return t.prototype.count=function(){return this.points.length},t.prototype.getAtIndex=function(t){return this.points[t]},t}();t.PointCollection=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(t){var e=t.split(",");this.quantity=Number(e[0]),this.price=Number(e[1]);try{this.pricePerUnit=Number(e[2])}catch(t){this.pricePerUnit=0}}return t}();t.PriceOption=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(e){this.activeLayout=null,this.activeData=null,this.activeScene=null,this.activePage=null,this.layouts=[],this.FIRST_PAGE=0,this.BACK_PAGE=1,this.hasPeeps=!1,this.documents=e,this.manifest=new t.model.Manifest(e[0]);for(var i=1;i<e.length;i++){var o=new t.model.Layout(e[i]);this.layouts.push(o),o.isPeepsEnabled&&(this.hasPeeps=!0)}this.initPosition(),this.hasPeeps&&(t.peepsManager.loadPeeps(),t.services.loadPeepFiles())}return e.prototype.getName=function(){return null!=t.config.saveProductName&&""!=t.config.saveProductName&&"null"!=t.config.saveProductName?t.$.trim(decodeURI(t.config.saveProductName)):null!=t.config.savedDesignName()?t.$.trim(decodeURI(t.config.savedDesignName())):null!=t.config.displayProductName()?t.$.trim(decodeURI(t.config.displayProductName())):null},e.prototype.reset=function(){this.manifest.reset();for(var t=0;t<this.layouts.length;t++)this.layouts[t].reset();this.initPosition()},e.prototype.initPosition=function(){this.activeLayout=this.FIRST_PAGE,this.activePage=this.FIRST_PAGE,this.activeScene=0,this.setActiveData()},e.prototype.save=function(){this.manifest.isMultiScene&&this.updateScenes(),this.manifest.clear();for(var t=[],e={},i=0;i<this.layouts.length;i++)e["layout_"+(i+1)+".xml"]=this.layouts[i].toJson(),t.push(e),this.manifest.updateAssets(this.layouts[i]);var o={Manifest:this.manifest.toJson(),Pages:t},n=JSON.stringify(o);return n},e.prototype.updateScenes=function(){for(var t=this.getActiveLayout(),e=this.manifest.scenes,i=null,o=-1,n=0;n<e.length;n++){for(var s=e[n],a=0;a<s.length;a++){var r=s[a];if(r==this.activeLayout){i=s,o=a;break}}if(-1!=o)break}if(-1!=o)for(var n=0;n<e.length;n++){var s=e[n];if(s!=i){var l=s[o],h=this.layouts[l];h.copyPersonalizedPageItems(t)}}},e.prototype.addLayout=function(e,i){this.documents[e]=i;var o=new t.model.Layout(i);if(this.layouts[e-1]=o,null!=this.manifest&&this.manifest.layoutCount==this.layouts.length){for(var n=!0,s=0;s<this.layouts.length;s++){var o=this.layouts[s];if(!o||!o.pageItems){n=!1;break}}n&&t.events.trigger(t.events.LAST_LAYOUT)}},e.prototype.setActiveLayout=function(t){return t<this.layouts.length?(this.activeLayout=t,this.activePage=t,this.setActiveData(),!0):!1},e.prototype.getActiveLayout=function(){return this.layouts[this.activeLayout]},e.prototype.getBackLayout=function(){return this.layouts[this.BACK_PAGE]},e.prototype.setActiveData=function(){var t=this.getActiveLayout();this.activeData={},this.activeData.width=t.width,this.activeData.height=t.height,this.activeData.constrained=!1,this.activeData.bleedTop=-parseFloat(t.productInfo.bleedTop),this.activeData.bleedLeft=-parseFloat(t.productInfo.bleedLeft),this.activeData.bleedRight=parseFloat(t.productInfo.bleedRight),this.activeData.bleedBottom=parseFloat(t.productInfo.bleedBottom),this.activeData.safeTop=5,this.activeData.safeLeft=5,this.activeData.safeRight=-5,this.activeData.safeBottom=-5},e.prototype.getActiveBoundaries=function(){var t=this.getActiveLayout(),e=Math.round(Math.abs(this.activeData.safeLeft)),i=Math.round(Math.abs(this.activeData.safeTop)),o=Math.round(t.width-e),n=Math.round(t.height-i);return this.activeData.constrained&&(o+=this.activeData.safeRight+e,n+=this.activeData.safeBottom+i),new createjs.Rectangle(e,i,o,n)},e.prototype.getWidth=function(){return this.activeData.constrained?this.activeData.width-this.activeData.safeLeft+this.activeData.safeRight:this.activeData.width},e.prototype.getHeight=function(){return this.activeData.constrained?this.activeData.height-this.activeData.safeTop+this.activeData.safeBottom:this.activeData.height},e.prototype.getInitialFontSet=function(){var t=this.layouts[0];return t.fontSetName},e.prototype.preloadFonts=function(){for(var e=this.manifest.fonts,i=0;i<e.length;i++)t.fonts.getFont(e[i]._fontFamily)},e.prototype.updatePaperstockImage=function(e){for(var i=0;i<this.layouts.length;i++){var o=this.layouts[i],n=o.getPaperstockPageItem();if(null!=n){var s=n[t.utils.HtmlUtil.getBlockName(n)];t.utils.ObjectUtil.notUndefined(s.Image)&&(s.Image._imageId=e.imageId,o.addImageAsset(e))}}},e.prototype.removeImageReferences=function(e){for(var i=0;i<this.layouts.length;i++)if(i!=this.activeLayout)for(var o=this.layouts[i],i=0;i<o.pageItems.length;i++){var n=o.pageItems[i];if("image"==n._type){var s=n[t.utils.HtmlUtil.getBlockName(n)];if(t.utils.ObjectUtil.notUndefined(s.Image)&&s.Image._imageId==e){var a=o.getImageAsset(e),r=a.url;null==r&&(r=t.utils.ImageUtil.getImageUrl(n,o)),null!=r&&-1==r.indexOf("mySavedImages")&&-1==r.indexOf("myCartImages")&&(s.Image._imageId="")}}}},e.prototype.nextScene=function(){return this.activeScene<this.manifest.sceneCount-1&&this.activeScene++,this.activeScene},e.prototype.prevScene=function(){return this.activeScene>0&&this.activeScene--,this.activeScene},e.prototype.hasNextScene=function(){return this.activeScene<this.manifest.sceneCount-1},e.prototype.hasPrevScene=function(){return this.activeScene>0},e.prototype.getLayoutIndex=function(t){return this.activePage=t,this.manifest.scenes[this.activeScene][t]},e.prototype.nextPage=function(){return this.activePage<this.manifest.pageCount-1&&this.activePage++,this.activePage},e.prototype.prevPage=function(){return this.activePage>0&&this.activePage--,this.activePage},e.prototype.hasNextPage=function(){return this.activePage<this.manifest.pageCount-1},e.prototype.showNextPage=function(){return this.hasNextPage()&&null!=t.productOptions&&!t.productOptions.showBackApproval()},e.prototype.hasPrevPage=function(){return this.activePage>0},e.prototype.hasNextLayout=function(){return this.activeLayout<this.layouts.length-1},e.prototype.hasPrevLayout=function(){return this.activeLayout>0},e.prototype.autoAddBack=function(){return this.getActiveLayout().autoAddBack},e.prototype.isSingleColor=function(){return"TwoColor"==this.getActiveLayout().productInfo.colorSelectionMode},e.prototype.isSingleFontColor=function(){return this.getActiveLayout().getFontColorCount()<2},e.prototype.isTwoPage=function(){return 2==this.manifest.pageCount},e.prototype.isUgcEnabled=function(){return this.getActiveLayout().isUploadUserImageEnabled},e.prototype.isAddTextEnabled=function(){return this.getActiveLayout().isAddTextEnabled},e.prototype.isAddImageContainerEnabled=function(){return this.getActiveLayout().isAddImageContainerEnabled},e.prototype.isZOrderEnabled=function(){return"False"==this.getActiveLayout().productInfo.disableZOrder},e.prototype.isImageEffectsEnabled=function(){return"False"==this.getActiveLayout().productInfo.disableImageEffects},e.prototype.isHorizontalTextAlignEnabled=function(){return"False"==this.getActiveLayout().productInfo.disableHorizontalTextAlignment},e.prototype.isVerticalTextAlignEnabled=function(){return"False"==this.getActiveLayout().productInfo.disableVerticalTextAlignment},e.prototype.isStamp=function(){return"stamp"==this.getActiveLayout().productInfo.type},e.prototype.toString=function(){return"type: "+this.manifest.layoutType+", image count: "+this.manifest.imageAssets.length+", layout count: "+this.layouts.length},e}();e.Product=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function i(t,e){this.sku=t,this.priceMap=[];var i=e.split("|");this.vendorCode="null"==i[0]?null:i[0],this.label="null"==i[1]?null:i[1],this.parsePriceMap(i[2]),this.index=Number(i[3])}return i.prototype.setPreviewUrl=function(t){this.previewImageUrl=t},i.prototype.getPrice=function(t){for(var e=0;e<this.priceMap.length;e++){var i=this.priceMap[e];if(i.quantity==t)return i.price}return 0},i.prototype.getPriceLabel=function(){var e=Number(t.config.quantity()),i=this.getPrice(e);return"$"+i.toFixed(2)},i.prototype.parsePriceMap=function(i){var o=t.$.trim(i).lastIndexOf(";");i=i.slice(0,o);try{for(var n=i.split(";"),s=0;s<n.length;s++)this.priceMap.push(new e.PriceOption(n[s]))}catch(t){}},i}();e.ProductOption=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function i(e){this.init(),this.originalOptions=e.productOptions,this.parseProductOptions(e.productOptions),this.parseRelatedProducts(e.relatedProducts),this.updateCurrentUpsellOptions(),this.autoAddBackCheck(),this.originalSelectedOptions=t.$.extend(!0,[],this.selectedOptions)}return i.prototype.init=function(){this.currentOptions=[],this.persistedOptions=[],this.selectedOptions=[],this.selectedPersistedOptions=[],this.backOptions=[],this.frontOptions=[],this.nonConfigurableOptions=[],this.paperOptions=[],this.inkColorOptions=[],this.inkTypeOptions=[],this.inkTypeOptionsBack=[],this.fontOptions=[],this.logoOptions=[],this.expressionOptions=[],this.softProofOptions=[],this.relatedProducts=[]},i.prototype.updateCurrentUpsellOptions=function(){var e=t.config.subSkuIds();if(t.$.trim(e).length>0)for(var i=t.$.trim(e).split(","),o=0;o<i.length;o++)this.addSelectedOption(i[o]);if(this.hasPaperOptions()&&!this.paperOptionSelected()){var n=this.paperOptions[0];this.addSelectedOption(n.sku)}if(this.inkColorOptions.length>0&&!this.inkOptionSelected()){var s=this.inkColorOptions[0];this.addSelectedOption(s.sku)}},i.prototype.resetOptions=function(){this.init(),this.parseProductOptions(this.originalOptions),this.resetSelectedOptions(this.originalSelectedOptions),this.autoAddBackCheck(),t.events.trigger(t.events.UPSELL_OPTIONS_CHANGE)},i.prototype.cancelOptions=function(){if(null!=this.originalSelectedOptions){if(this.resetSelectedOptions(this.originalSelectedOptions),!t.productOptions.hasPaperOptions())return;for(var e=0;e<this.originalSelectedOptions.length;e++){var i=this.originalSelectedOptions[e];if(t.productOptions.isPaperOption(i)){var o=t.app.imageLibrary.getStockImage(i);if(null!=o){var n=t.model.ImageAsset.createFromPaperstock(o);t.app.views.canvasView.changePaperstock(n)}}}}},i.prototype.autoAddBackCheck=function(){t.product.autoAddBack()&&!this.backOptionApproved()&&this.addBackOption()},i.prototype.hasProductUpsells=function(){return this.currentOptions.length>0},i.prototype.hasLayouts=function(){return this.relatedProducts.length>0},i.prototype.resetSelectedOptions=function(t){if(this.clearSelections(),null!=t)for(var e=0;e<t.length;e++){var i=t[e];this.addSelectedOption(i)}},i.prototype.addSelectedOption=function(t){if(this.isBackOption(t))this.addBackOption();else{for(var e=0;e<this.selectedOptions.length;e++)if(t==this.selectedOptions[e])return;this.selectedOptions.push(t),this.setOption(t)}},i.prototype.clearSelections=function(){this.selectedOptions.length=0,this.hasBackOption()&&t.utils.HtmlUtil.toggleBackOptionButton(!0)},i.prototype.getOption=function(t){for(var e=0;e<this.currentOptions.length;e++)for(var i=this.currentOptions[e],o=0;o<i.list.length;o++){var n=i.list[o];if(n.sku==t)return n}return null},i.prototype.setOption=function(t){for(var e=0;e<this.currentOptions.length;e++)for(var i=this.currentOptions[e],o=0;o<i.list.length;o++){var n=i.list[o];if(n.sku==t)return void(i.selectedSku=t)}},i.prototype.parseProductOptions=function(t){null!=t.PAPER_OPTIONS&&this.parseBasicOption(t,"PAPER_OPTIONS",this.paperOptions,"Paper Stock"),null!=t.BACK_OPTIONS&&this.parseBasicOption(t,"BACK_OPTIONS",this.backOptions,"Back Options"),null!=t.FRONT_OPTIONS&&this.parseBasicOption(t,"FRONT_OPTIONS",this.frontOptions,"Front Options"),null!=t.NON_CONFIGURABLE_OPTIONS&&this.parseBasicOption(t,"NON_CONFIGURABLE_OPTIONS",this.nonConfigurableOptions,"N/A Options"),null!=t.INK_COLOR_OPTIONS&&this.parseBasicOption(t,"INK_COLOR_OPTIONS",this.inkColorOptions,"Ink Color Options"),null!=t.INK_TYPE_OPTIONS&&this.parseBasicOption(t,"INK_TYPE_OPTIONS",this.inkTypeOptions,"Ink Type Options"),null!=t.INK_TYPE_OPTIONS_BACK&&this.parseBasicOption(t,"INK_TYPE_OPTIONS_BACK",this.inkTypeOptionsBack,"Back Ink Type Options"),null!=t.FONT_OPTIONS&&this.parseBasicOption(t,"FONT_OPTIONS",this.fontOptions,"Font Options"),null!=t.LOGO_OPTIONS&&this.parseBasicOption(t,"LOGO_OPTIONS",this.logoOptions,"Logo Options"),null!=t.EXPRESSION_OPTIONS&&this.parseBasicOption(t,"EXPRESSION_OPTIONS",this.expressionOptions,"Expression Options"),null!=t.SOFT_PROOF_OPTION&&this.parseBasicOption(t,"SOFT_PROOF_OPTION",this.softProofOptions,"Soft Proof")},i.prototype.parseBasicOption=function(t,i,o,n){try{for(var s in t[i]){var a=t[i][s];o.push(new e.ProductOption(s,a))}if(o.length>0){o.sort(this.sortProductOptions);var r="NONE-"+i;"BACK_OPTIONS"!=i?r=this.getPreviouslySelectedSku(o):o.unshift(new e.ProductOption(r,"null|null|100,0.00,0.00|-1"));var l=this.optionWrapper(n,o,i,r,!1);"SOFT_PROOF_OPTION"!=i?this.currentOptions.push(l):this.persistedOptions.push(l)}}catch(t){}},i.prototype.getPreviouslySelectedSku=function(e){var i=t.config.subSkuIds();if(t.$.trim(i).length>0)for(var o=t.$.trim(i).split(","),n=0;n<o.length;n++){this.addSelectedOption(o[n]);for(var s=0;s<e.length;s++)if(o[n]==e[s].sku)return e[s].sku}return e[0].sku},i.prototype.sortProductOptions=function(t,e){return t.index>e.index?1:-1},i.prototype.optionWrapper=function(t,e,i,o,n){return"undefined"==typeof n&&(n=!1),{label:t,list:e,key:i,selectedSku:o,hasPreviewImage:n}},i.prototype.parseRelatedProducts=function(i){try{for(var o in i)for(var n in i[o]){var s=i[o][n];this.relatedProducts.push(new e.RelatedProduct(o,n,s))}t.events.trigger(t.events.RELATED_PRODUCTS_LOADED,this.relatedProducts)}catch(t){}},i.prototype.inkOptionSelected=function(){for(var t=0;t<this.selectedOptions.length;t++)for(var e=0;e<this.inkColorOptions.length;e++)if(this.selectedOptions[t]==this.inkColorOptions[e].sku)return!0;return!1},i.prototype.hasPaperOptions=function(){return this.paperOptions.length>0},i.prototype.paperOptionSelected=function(){for(var t=0;t<this.selectedOptions.length;t++)for(var e=0;e<this.paperOptions.length;e++)if(this.selectedOptions[t]==this.paperOptions[e].sku)return!0;return!1},i.prototype.isPaperOption=function(t){for(var e=0;e<this.paperOptions.length;e++){var i=this.paperOptions[e];if(i.sku==t)return!0}return!1},i.prototype.getPaperOptionData=function(){for(var t=0;t<this.currentOptions.length;t++){var e=this.currentOptions[t];if("PAPER_OPTIONS"==e.key)return e}return null},i.prototype.backOptionApproved=function(){var t=this.getBackOption();if(null==t)return!1;for(var e=0;e<this.selectedOptions.length;e++)if(t.sku==this.selectedOptions[e])return!0;return!1},i.prototype.hasBackOption=function(){return this.backOptions.length>0},i.prototype.showBackApproval=function(){return this.hasBackOption()&&!this.backOptionApproved()},i.prototype.getBackOption=function(){for(var t=0;t<this.backOptions.length;t++){var e=this.backOptions[t];if(0!=e.sku.indexOf("NONE-"))return e}return null},i.prototype.isBackOption=function(t){var e=this.getBackOption();return null==e?!1:e.sku==t},i.prototype.addBackOption=function(){var e=this.getBackOption();if(null!=e){for(var i=0;i<this.selectedOptions.length;i++)if(e.sku==this.selectedOptions[i])return;this.selectedOptions.push(e.sku),this.setOption(e.sku),t.utils.HtmlUtil.toggleBackOptionButton(!1)}},i.prototype.removeBackOption=function(){var e=this.getBackOption();null!=e&&(this.selectedOptions=t._.without(this.selectedOptions,e.sku),t.utils.HtmlUtil.toggleBackOptionButton(!0),this.setOption("NONE-BACK_OPTIONS"))},i.prototype.getBackPrice=function(){var e=this.getBackOption();if(null==e)return 0;var i=Number(t.config.quantity());return e.getPrice(i)},i.prototype.hasSoftProof=function(){return this.softProofOptions.length>0},i.prototype.hasSoftProofSku=function(){if(this.hasSoftProof)for(var t=this.getSoftProofSku(),e=0;e<this.selectedOptions.length;e++)if(this.selectedOptions[e]===t)return!0;return!1},i.prototype.getSoftProofSku=function(){return this.softProofOptions.length>0?this.softProofOptions[0].sku:null},i.prototype.getPersistedSku=function(t){for(var e,i=this.persistedOptions.length,o=0;i>o;o++)if(e=this.persistedOptions[o],e.selectedSku===t)return e;return null},i.prototype.addPersistedSku=function(t){for(var e,i=this.selectedPersistedOptions.length,o=0;i>o;o++)if(e=this.selectedPersistedOptions[o],e.selectedSku===t)return;this.selectedPersistedOptions.push(this.getPersistedSku(t))},i.prototype.removePersistedSku=function(t){for(var e,i=this.selectedPersistedOptions.length,o=0;i>o;o++)if(e=this.selectedPersistedOptions[o],e.selectedSku===t)return void this.selectedPersistedOptions.splice(o,1)},i.prototype.getSubSkuIdList=function(){var t="";if(this.selectedOptions.length>0&&(t+=this.selectedOptions.join(",")),this.selectedPersistedOptions.length>0)for(var e=0;e<this.selectedPersistedOptions.length;e++){var i=this.selectedPersistedOptions[e];t+=","+i.selectedSku.toString()}return t},i}();e.ProductOptions=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(t,e,i){this.index=-1,this.productId=t,this.sku=e,this.parseOptions(i)}return t.prototype.parseOptions=function(t){var e=t.split("|");this.productName="null"==e[0]?null:e[0],this.productCode="null"==e[1]?null:e[1],this.imageUrl=e[2]},t}();t.RelatedProduct=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.prototype.shouldShow=function(e){return!(this.dismissed||"true"===e._userInteracted||t.inPreviewMode)},e.prototype.show=function(e){if(e){var i=this.getLocation(e);t.stageRoot.addChild(this.container),this.container.x=Math.floor(i.x),this.container.y=Math.floor(i.y),this.container.addEventListener("click",t._.bind(this.onClicked,this)),clearInterval(this.hideTipTimeout),this.hideTipTimeout=setTimeout(this.hideTip,this.hideTipTime)}},e.prototype.getPageItemId=function(){return this.pageItemId},e.prototype.onClicked=function(){this.dismissed=!0,this.hide(),this.container.removeAllEventListeners()},e.prototype.hide=function(){clearInterval(this.hideTipTimeout),t.stageRoot.removeChild(this.container),t.updateStage()},e.prototype.init=function(t){this.dismissed=!1,this.padWidth=17,this.padHeight=15,this.padTip=5,this.lineWidth=200,this.totalWidth=this.lineWidth+2*this.padWidth,this.pageItemId=t.pageItemBlock._id;var e=this;this.hideTipTime=15e3,this.hideTip=function(){e.hide()},this.configureContainer(t)},e.prototype.reset=function(){this.dismissed=!1},e.prototype.configureContainer=function(t){var i=new createjs.Container,o=new createjs.Shape,n=new createjs.Text;i.addChild(o),n.lineWidth=this.lineWidth,n.font="12px Arial",n.x=this.padWidth,n.y=this.padHeight,n.text="bbox.controls.CompositeText"==t.type?e.TextMessage:e.ImageMessage,n.color="#F00",this.height=Math.round(n.getMeasuredHeight()),this.totalHeight=this.height+2*this.padHeight,o.graphics.clear(),o.graphics.setStrokeStyle(2).beginStroke("#D74746").beginFill("#FFF").drawRect(0,0,this.totalWidth,this.totalHeight).endFill(),o.tip=this,o.cache(0,0,this.totalWidth,this.totalHeight),o.shadow=new createjs.Shadow("#777",3,3,8),i.addChild(n),this.container=i},e.prototype.getLocation=function(e){var i=e.x-e.regX,o=e.y-e.regY,n=t.stage.localToGlobal(i,o);if(n.x<this.totalWidth+this.padTip){var s=n.y-this.totalHeight+this.padTip;s>=this.totalHeight+this.padTip&&(n.y=s)}else n.x-=this.totalWidth+this.padTip;return n},e.TextMessage="This container requires custom text. Please personalize it here.",e.ImageMessage="This container requires a custom image. Please personalize it here.",e}();e.RequiredFieldTip=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(){this.file={},this.svg={},this.file.svg=this.svg,this.svg["_xmlns:xlink"]="http://www.w3.org/1999/xlink",this.svg["_xmlns:hcsvg"]="http://ns.harlandclarke.com/2013/hcsvg",this.svg._xmlns="http://www.w3.org/2000/svg",this.svg.g=[],this.svg._version="1.1",this.svg._x="0px",this.svg._y="0px",this.svg._width="100",this.svg._height="100"}return t.prototype.setFamilyDimensions=function(t,e){this.svg._width=t,this.svg._height=e},t.prototype.reset=function(){this.svg.g=[]},t.prototype.addGroup=function(t){this.svg.g.push(t)},t.prototype.toString=function(){return JSON.stringify(this.file)},t.prototype.xml=function(){return""},t}();t.SVGDocument=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(){}return t}();t.SaveData=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(t,e){this.activeLayout=t,this.inPreviewMode=e
}return t}();t.SavedUserLocation=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(t,e,i,o,n,s){this.name=t,this.frame=e,this.x=i,this.y=o,this.width=n,this.height=s}return t.prototype.getFrameData=function(){return[this.x,this.y,this.width,this.height,0]},t.getAllSpriteFrameData=function(){return[this.UPLOADFILE.getFrameData(),this.ASSET_PANEL_BACKGROUND.getFrameData(),this.ASSET_PANEL_PHOTOS.getFrameData(),this.ASSET_PANEL_STOCKART.getFrameData(),this.DONUT_ADD_IMAGE.getFrameData(),this.DONUT_ICON_IMAGE.getFrameData(),this.DONUT_ICON_PEEPS.getFrameData(),this.DONUT_ICON_TEXT.getFrameData(),this.EDIT_TAB.getFrameData(),this.EDITOR_DRAG_HANDLE.getFrameData(),this.FB_ICON.getFrameData(),this.FB_LOGIN_BTN.getFrameData(),this.FB_TITLE.getFrameData(),this.FLK_ICON.getFrameData(),this.ICON_LOADING.getFrameData(),this.ICON_ACTIVE.getFrameData(),this.ICON_ADD_BACK.getFrameData(),this.ICON_ADD_TEXT.getFrameData(),this.ICON_ALIGN_BOTTOM2.getFrameData(),this.ICON_ALIGN_CENTER2.getFrameData(),this.ICON_ALIGN_LEFT2.getFrameData(),this.ICON_ALIGN_MIDDLE2.getFrameData(),this.ICON_ALIGN_RIGHT2.getFrameData(),this.ICON_ALIGN_TEXT_CENTER.getFrameData(),this.ICON_ALIGN_TEXT_LEFT.getFrameData(),this.ICON_ALIGN_TEXT_RIGHT.getFrameData(),this.ICON_ALIGN_TOP2.getFrameData(),this.ICON_ARROW.getFrameData(),this.ICON_BRING_FORWARD.getFrameData(),this.ICON_COLOR_NONE.getFrameData(),this.ICON_DELETE.getFrameData(),this.ICON_FIT.getFrameData(),this.ICON_GRAPHICS.getFrameData(),this.ICON_HELP.getFrameData(),this.ICON_IMG_COLORIZE_BW.getFrameData(),this.ICON_IMG_COLORIZE_COLOR.getFrameData(),this.ICON_IMG_COLORIZE_SEPIA.getFrameData(),this.ICON_IMG_DELETE.getFrameData(),this.ICON_IMG_FLIP.getFrameData(),this.ICON_IMG_FLIP_VERTICAL.getFrameData(),this.ICON_IMG_SCALE.getFrameData(),this.ICON_MORE_TEXT.getFrameData(),this.ICON_NAV_PEEPS.getFrameData(),this.ICON_PHOTOS.getFrameData(),this.ICON_PICASSA.getFrameData(),this.ICON_PICKER_ARROW.getFrameData(),this.ICON_REDO.getFrameData(),this.ICON_REMOVE.getFrameData(),this.ICON_REMOVE_BACK.getFrameData(),this.ICON_RESET.getFrameData(),this.ICON_RESET2.getFrameData(),this.ICON_ROTATE.getFrameData(),this.ICON_ROTATE_COUNTER.getFrameData(),this.ICON_ROTATE_NEW.getFrameData(),this.ICON_SAVE.getFrameData(),this.ICON_SAVE_OLD.getFrameData(),this.ICON_SEND_BACK.getFrameData(),this.ICON_SHUTTERFLY.getFrameData(),this.ICON_TAB_ARROW.getFrameData(),this.ICON_TEXT_DELETE.getFrameData(),this.ICON_UNDO.getFrameData(),this.ICON_VALIDATION.getFrameData(),this.ICON_WARNING_LOW_DPI.getFrameData(),this.ICON_WHITE_CAMERA.getFrameData(),this.ICON_ZOOM.getFrameData(),this.MOBILE_ADD.getFrameData(),this.PEEPS_CONTAINER.getFrameData(),this.PIC_TITLE.getFrameData(),this.PROGRESS_1_ACTIVE.getFrameData(),this.PROGRESS_1_INACTIVE.getFrameData(),this.PROGRESS_2_ACTIVE.getFrameData(),this.PROGRESS_2_INACTIVE.getFrameData(),this.PROGRESS_3_ACTIVE.getFrameData(),this.PROGRESS_3_INACTIVE.getFrameData(),this.SLIDER_DRAG_HANDLE.getFrameData(),this.TOOLBAR_DRAG_HANDLE.getFrameData(),this.TOOLBAR_HOVER_BACKGROUND.getFrameData(),this.UPLOADPHOTOLARGE.getFrameData(),this.ZOOM_FIT_ACTIVE.getFrameData(),this.ZOOM_FIT_INACTIVE.getFrameData(),this.ZOOM_IN_ACTIVE.getFrameData(),this.ZOOM_IN_INACTIVE.getFrameData(),this.ZOOM_OUT_ACTIVE.getFrameData(),this.ZOOM_OUT_INACTIVE.getFrameData()]},t.UPLOADFILE=new t("UPLOADFILE",0,417,0,384,233),t.ASSET_PANEL_BACKGROUND=new t("ASSET_PANEL_BACKGROUND",1,554,290,52,34),t.ASSET_PANEL_PHOTOS=new t("ASSET_PANEL_PHOTOS",2,608,290,32,32),t.ASSET_PANEL_STOCKART=new t("ASSET_PANEL_STOCKART",3,750,235,36,36),t.DONUT_ADD_IMAGE=new t("DONUT_ADD_IMAGE",4,631,235,49,49),t.DONUT_ICON_IMAGE=new t("DONUT_ICON_IMAGE",5,472,235,53,53),t.DONUT_ICON_PEEPS=new t("DONUT_ICON_PEEPS",6,417,235,53,53),t.DONUT_ICON_TEXT=new t("DONUT_ICON_TEXT",7,580,235,49,49),t.EDIT_TAB=new t("EDIT_TAB",8,550,332,87,27),t.EDITOR_DRAG_HANDLE=new t("EDITOR_DRAG_HANDLE",9,732,235,16,45),t.FB_ICON=new t("FB_ICON",10,776,363,21,21),t.FB_LOGIN_BTN=new t("FB_LOGIN_BTN",11,625,363,70,22),t.FB_TITLE=new t("FB_TITLE",12,417,290,98,37),t.FLK_ICON=new t("FLK_ICON",13,713,389,18,18),t.ICON_LOADING=new t("ICON_LOADING",14,682,235,48,48),t.ICON_ACTIVE=new t("ICON_ACTIVE",15,600,411,14,14),t.ICON_ADD_BACK=new t("ICON_ADD_BACK",16,583,411,15,15),t.ICON_ADD_TEXT=new t("ICON_ADD_TEXT",17,726,363,25,21),t.ICON_ALIGN_BOTTOM2=new t("ICON_ALIGN_BOTTOM2",18,581,363,22,22),t.ICON_ALIGN_CENTER2=new t("ICON_ALIGN_CENTER2",19,557,363,22,22),t.ICON_ALIGN_LEFT2=new t("ICON_ALIGN_LEFT2",20,513,363,22,22),t.ICON_ALIGN_MIDDLE2=new t("ICON_ALIGN_MIDDLE2",21,489,363,22,22),t.ICON_ALIGN_RIGHT2=new t("ICON_ALIGN_RIGHT2",22,441,363,22,22),t.ICON_ALIGN_TEXT_CENTER=new t("ICON_ALIGN_TEXT_CENTER",23,673,411,14,13),t.ICON_ALIGN_TEXT_LEFT=new t("ICON_ALIGN_TEXT_LEFT",24,657,411,14,13),t.ICON_ALIGN_TEXT_RIGHT=new t("ICON_ALIGN_TEXT_RIGHT",25,616,411,14,13),t.ICON_ALIGN_TOP2=new t("ICON_ALIGN_TOP2",26,465,363,22,22),t.ICON_ARROW=new t("ICON_ARROW",27,788,235,8,14),t.ICON_BRING_FORWARD=new t("ICON_BRING_FORWARD",28,605,363,18,22),t.ICON_COLOR_NONE=new t("ICON_COLOR_NONE",29,524,411,16,16),t.ICON_DELETE=new t("ICON_DELETE",30,366,411,17,17),t.ICON_FIT=new t("ICON_FIT",31,753,363,21,21),t.ICON_GRAPHICS=new t("ICON_GRAPHICS",32,613,389,18,18),t.ICON_HELP=new t("ICON_HELP",33,691,332,23,25),t.ICON_IMG_COLORIZE_BW=new t("ICON_IMG_COLORIZE_BW",34,479,389,24,20),t.ICON_IMG_COLORIZE_COLOR=new t("ICON_IMG_COLORIZE_COLOR",35,505,389,24,20),t.ICON_IMG_COLORIZE_SEPIA=new t("ICON_IMG_COLORIZE_SEPIA",36,434,389,24,20),t.ICON_IMG_DELETE=new t("ICON_IMG_DELETE",37,697,363,27,21),t.ICON_IMG_FLIP=new t("ICON_IMG_FLIP",38,388,389,25,20),t.ICON_IMG_FLIP_VERTICAL=new t("ICON_IMG_FLIP_VERTICAL",39,417,363,22,22),t.ICON_IMG_SCALE=new t("ICON_IMG_SCALE",40,480,411,20,16),t.ICON_MORE_TEXT=new t("ICON_MORE_TEXT",41,366,363,24,24),t.ICON_NAV_PEEPS=new t("ICON_NAV_PEEPS",42,671,290,32,28),t.ICON_PHOTOS=new t("ICON_PHOTOS",43,502,411,20,16),t.ICON_PICASSA=new t("ICON_PICASSA",44,392,363,23,23),t.ICON_PICKER_ARROW=new t("ICON_PICKER_ARROW",45,788,251,8,8),t.ICON_REDO=new t("ICON_REDO",46,667,332,22,25),t.ICON_REMOVE=new t("ICON_REMOVE",47,639,332,26,26),t.ICON_REMOVE_BACK=new t("ICON_REMOVE_BACK",48,566,411,15,15),t.ICON_RESET=new t("ICON_RESET",49,761,332,25,25),t.ICON_RESET2=new t("ICON_RESET2",50,766,290,29,27),t.ICON_ROTATE=new t("ICON_ROTATE",51,415,389,17,20),t.ICON_ROTATE_COUNTER=new t("ICON_ROTATE_COUNTER",52,460,389,17,20),t.ICON_ROTATE_NEW=new t("ICON_ROTATE_NEW",53,517,290,35,35),t.ICON_SAVE=new t("ICON_SAVE",54,642,290,27,29),t.ICON_SAVE_OLD=new t("ICON_SAVE_OLD",55,740,332,19,25),t.ICON_SEND_BACK=new t("ICON_SEND_BACK",56,537,363,18,22),t.ICON_SHUTTERFLY=new t("ICON_SHUTTERFLY",57,633,389,18,18),t.ICON_TAB_ARROW=new t("ICON_TAB_ARROW",58,788,261,11,6),t.ICON_TEXT_DELETE=new t("ICON_TEXT_DELETE",59,531,389,20,19),t.ICON_UNDO=new t("ICON_UNDO",60,716,332,22,25),t.ICON_VALIDATION=new t("ICON_VALIDATION",61,705,290,29,27),t.ICON_WARNING_LOW_DPI=new t("ICON_WARNING_LOW_DPI",62,736,290,28,27),t.ICON_WHITE_CAMERA=new t("ICON_WHITE_CAMERA",63,542,411,22,16),t.ICON_ZOOM=new t("ICON_ZOOM",64,366,389,20,20),t.MOBILE_ADD=new t("MOBILE_ADD",65,752,389,42,17),t.PEEPS_CONTAINER=new t("PEEPS_CONTAINER",66,0,332,364,190),t.PIC_TITLE=new t("PIC_TITLE",67,366,332,182,29),t.PROGRESS_1_ACTIVE=new t("PROGRESS_1_ACTIVE",68,385,411,17,17),t.PROGRESS_1_INACTIVE=new t("PROGRESS_1_INACTIVE",69,404,411,17,17),t.PROGRESS_2_ACTIVE=new t("PROGRESS_2_ACTIVE",70,423,411,17,17),t.PROGRESS_2_INACTIVE=new t("PROGRESS_2_INACTIVE",71,442,411,17,17),t.PROGRESS_3_ACTIVE=new t("PROGRESS_3_ACTIVE",72,461,411,17,17),t.PROGRESS_3_INACTIVE=new t("PROGRESS_3_INACTIVE",73,733,389,17,17),t.SLIDER_DRAG_HANDLE=new t("SLIDER_DRAG_HANDLE",74,632,411,23,13),t.TOOLBAR_DRAG_HANDLE=new t("TOOLBAR_DRAG_HANDLE",75,689,411,53,12),t.TOOLBAR_HOVER_BACKGROUND=new t("TOOLBAR_HOVER_BACKGROUND",76,527,235,51,50),t.UPLOADPHOTOLARGE=new t("UPLOADPHOTOLARGE",77,0,0,415,330),t.ZOOM_FIT_ACTIVE=new t("ZOOM_FIT_ACTIVE",78,653,389,18,18),t.ZOOM_FIT_INACTIVE=new t("ZOOM_FIT_INACTIVE",79,593,389,18,18),t.ZOOM_IN_ACTIVE=new t("ZOOM_IN_ACTIVE",80,573,389,18,18),t.ZOOM_IN_INACTIVE=new t("ZOOM_IN_INACTIVE",81,693,389,18,18),t.ZOOM_OUT_ACTIVE=new t("ZOOM_OUT_ACTIVE",82,673,389,18,18),t.ZOOM_OUT_INACTIVE=new t("ZOOM_OUT_INACTIVE",83,553,389,18,18),t}();t.SpriteType=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(t,e,i,o,n,s){this.color=t,this.fontSize=e,this.fontFamily=i,this.textAlign=o,this.font=n,this.fontVariant=s}return e.prototype.updateElement=function(e,i){t.utils.ObjectUtil.isUndefined(i)&&(i=t.model.TextStyle.getStyle(e)),t.utils.ObjectUtil.notUndefined(this.color)?e.css("color",this.color):t.utils.ObjectUtil.notUndefined(i.color)&&e.css("color",i.color),t.utils.ObjectUtil.notUndefined(this.fontFamily)?e.css("font-family",this.fontFamily):t.utils.ObjectUtil.notUndefined(i.fontFamily)&&e.css("font-family",i.fontFamily),t.utils.ObjectUtil.notUndefined(this.fontSize)?e.css("font-size",this.fontSize):t.utils.ObjectUtil.notUndefined(i.fontSize)&&e.css("font-size",i.fontSize)},e.prototype.setFont=function(t){this.font=t,this.setFontVariant(this.font.variants[0])},e.prototype.setFontVariant=function(t){this.fontVariant=t,this.fontFamily=this.fontVariant.htmlFontFamily},e.getStyle=function(e){var i=new t.model.TextStyle;return t.utils.ObjectUtil.isEmpty(e.css("color"))||(i.color=t.utils.TextUtil.colorToHex(e.css("color"))),t.utils.ObjectUtil.isEmpty(e.css("font-family"))||(i.fontFamily=e.css("font-family")),t.utils.ObjectUtil.isEmpty(e.css("font-size"))||(i.fontSize=e.css("font-size")),i},e.toJson=function(e){var i={content:e.text()},o=t.model.TextStyle.getStyle(e);return t.utils.ObjectUtil.notUndefined(o.color)&&(i._color=o.color),t.utils.ObjectUtil.notUndefined(o.fontSize)&&(i._fontSize=o.fontSize),i},e.clearStyle=function(t){t.css("color",""),t.css("font-family",""),t.css("font-size","")},e}();e.TextStyle=i}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(){}return t.VALID="VALID",t.EMPTY_NAME="EMPTY_NAME",t.DESIGN_LIMIT="DESIGN_LIMIT",t.EXISTING_NAME="EXISTING_NAME",t.ERROR="ERROR",t}();t.ValidationResultType=e}(t.model||(t.model={}));t.model}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.prototype.validateSaveData=function(e,i){var o=t.config.saveItemAvailability();t.$.ajax({url:o,headers:t.config.getRequestHeaders(),type:"POST",data:{arg1:t.config.profileID(),arg2:t.config.ugcPath(),arg3:e.projectName},dataType:"json",success:function(o){if(o.atgResponse&&1==o.atgResponse.length){var n=o.atgResponse[0];e.validationResult=n.maxLimitReached?t.model.ValidationResultType.DESIGN_LIMIT:n.savedDesignExists?t.model.ValidationResultType.EXISTING_NAME:t.model.ValidationResultType.VALID,i(e)}}})},e}();e.SaveService=i}(t.service||(t.service={}));t.service}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){this.cached={},this.clone=t.$.extend}return e.prototype.initSprites=function(){this.spriteSheet=new createjs.Bitmap(t.config.spriteSheet())},e.prototype.getBitmap=function(e){var i=new createjs.Bitmap(t.config.spriteSheet());return i.sourceRect=new createjs.Rectangle(e.x,e.y,e.width,e.height),i},e}();e.SpriteService=i}(t.service||(t.service={}));t.service}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(t){this.saveProductName="",this.saveAsNew=!0,this.token=null,this.ofv=t}return e.prototype.setChannelConfig=function(e){this.occ=e,t.sessionExpiration=this.sessionTimeOutTime()},e.prototype.setUgcPath=function(t){this.ofv.ugcPath=t},e.prototype.setProfileId=function(t){this.ofv.profileID=t},e.prototype.setRegistered=function(){this.ofv.registered="true"},e.prototype.cc=function(t){if(null!=this.occ[t])return this.occ[t];throw"NO "+t+" in Loaded ChannelConfig!!!"},e.prototype.fv=function(t){if(null!=this.ofv[t])return this.ofv[t];throw"NO "+t+" in Loaded FlashVars!!!"},e.prototype.isRegistered=function(){return"true"==this.registered()},e.prototype.isReorder=function(){try{return this.fv("reOrderId").length>1}catch(t){return!1}},e.prototype.getImageUrl=function(e){var i=this.imageURL()+this.imageLibraryBasePath()+"/"+this.productCode()+this.imageProductFolder()+"/"+t.product.manifest.productVersion+"/"+e+".png";return i},e.prototype.getPeepsLibraryUrl=function(){return this.cc("peepsLibrary")},e.prototype.getExternalDialogUrl=function(){return this.cc("externalDialog")},e.prototype.getFontKerningUrl=function(t){return this.cc("globalFontKerning")+"/"+t.split("'").join("").split(" ").join("_")+".kern"},e.prototype.getFontVertical=function(){return this.cc("globalFontKerning")+"/baseVertOffsets.json"},e.prototype.getBaseImageUrl=function(){var e=this.imageURL()+this.imageLibraryBasePath()+"/"+this.productCode()+this.imageProductFolder()+"/"+t.product.manifest.productVersion+"/";return e},e.prototype.getRequestHeaders=function(){return{HCAuthToken:this.HCAuthToken(),"cache-control":"no-cache"}},e.prototype.primeChannelConfig=function(){return this.prime()+"/rest/channelConfig?url="+this.channelConfig()},e.prototype.primeProductService=function(t){return this.prime()+"/rest/productjsonservice/getProduct?productSource="+this.productSource()+"&productCode="+this.productCode()+"&fileName="+t},e.prototype.prime=function(){return"/ConfigPrime"},e.prototype.productNameHTML=function(){return this.fv("productNameHTML")},e.prototype.setProductNameHTML=function(t){return this.ofv.productNameHTML=t,this.productNameHTML()},e.prototype.productCode=function(){return this.fv("productCode")},e.prototype.setProductCode=function(t){return this.ofv.productCode=t,this.productCode()},e.prototype.productSource=function(){return this.fv("productSource")},e.prototype.setProductSource=function(t){return this.ofv.productSource=t,this.productSource()},e.prototype.baseAssetUrl=function(){return"/resources/store/scripts/JSConfigurator/"},e.prototype.removeIcon=function(){return this.baseAssetUrl()+"img/remove-icon.png"},e.prototype.donutIcon=function(){return this.baseAssetUrl()+"img/donut-icon-image.png"},e.prototype.peepDonutIcon=function(){return this.baseAssetUrl()+"img/donut-icon-peeps.png"},e.prototype.addImageDonutIcon=function(){return this.baseAssetUrl()+"img/add-image-donut-icon.png"},e.prototype.imageToolbarScaleHandle=function(){return this.baseAssetUrl()+"img/slider-drag-handle.png"},e.prototype.imageToolbarScaleTrack=function(){return this.baseAssetUrl()+"img/slider-custom-track.png"},e.prototype.textDonutIcon=function(){return this.baseAssetUrl()+"img/donut-icon-text.png"},e.prototype.warningDPIIcon=function(){return this.baseAssetUrl()+"img/icon_warning_low_dpi.png"},e.prototype.warningIcon=function(){return this.baseAssetUrl()+"img/validation-icon.png"},e.prototype.rotateIcon=function(){return this.baseAssetUrl()+"img/rotate-icon.png"},e.prototype.loadingIcon=function(){return this.baseAssetUrl()+"img/loading-icon.png"},e.prototype.busyIcon=function(){return this.baseAssetUrl()+"img/loading-icon.gif"},e.prototype.uploadImageIcon=function(){return this.baseAssetUrl()+"img/UploadFile.png"},e.prototype.uploadPeepIcon=function(){return this.baseAssetUrl()+"img/peeps-container.png"},e.prototype.createPeepFamilyIcon=function(){return this.baseAssetUrl()+"img/StartFamily.png"},e.prototype.overflowIcon=function(){return this.baseAssetUrl()+"img/text-more-icon.png"},e.prototype.spriteSheet=function(){return this.baseAssetUrl()+"img/spritesheet.png"},e.prototype.maxFileSize=function(){return this.cc("maxFileSize")},e.prototype.maxImagesPerProduct=function(){return this.cc("maxImagesPerProduct")},e.prototype.maxProfileImages=function(){return this.cc("maxProfileImages")},e.prototype.maxTransientImages=function(){return this.cc("maxTransientImages")},e.prototype.messageBundleURL=function(){return this.cc("messageBundleURL")},e.prototype.globalFontMapURL=function(){return t.utils.AppUtil.isLocalhost()?"/build/global-font-map.fonts.com.json":this.cc("globalFontMapURL").replace(".xml",".json")},e.prototype.fontURL=function(){return this.cc("fontURL")},e.prototype.getFontSet=function(){return this.cc("getFontSet")},e.prototype.getFontReplacements=function(){return this.cc("getFontReplacements")},e.prototype.getImageURL=function(){return t.utils.AppUtil.isLocalhost()?"https://uat.iprint.com":this.cc("imageURL")},e.prototype.imageURL=function(){return this.cc("imageURL")},e.prototype.imageLibraryBasePath=function(){return this.cc("imageLibraryBasePath")},e.prototype.imageProductFolder=function(){return this.cc("imageProductFolder")},e.prototype.getProducts=function(){return this.cc("getProducts")},e.prototype.getFragmentJob=function(){return this.cc("getFragmentJob")},e.prototype.getProductOptions=function(){return this.cc("getProductOptions")},e.prototype.saveItem=function(){return this.cc("saveItem")},e.prototype.savePeep=function(){return this.cc("savePeep")},e.prototype.getSavedItem=function(){return this.cc("getSavedItem")},e.prototype.getCommerceItem=function(){return this.cc("getCommerceItem")},e.prototype.addToCart=function(){return this.cc("addToCart")},e.prototype.registerUser=function(){return this.cc("registerUser")},e.prototype.login=function(){return this.cc("login")},e.prototype.fileUpload=function(){return this.cc("fileUpload")},e.prototype.remoteFileUpload=function(){return this.cc("remoteFileUpload")},e.prototype.removeFiles=function(){return this.cc("removeFiles")},e.prototype.moveFiles=function(){return this.cc("moveFiles")},e.prototype.getFile=function(){return this.cc("getFile")+"/"},e.prototype.createWebProofDirectory=function(){return this.cc("createWebProofDirectory")},e.prototype.getJSONFileList=function(){return this.cc("getJSONFileList")},e.prototype.colorizeImage=function(){return this.cc("colorizeImage")},e.prototype.searchImageLibrary=function(){return this.cc("searchImageLibrary")},e.prototype.keepSessionAlive=function(){return this.cc("keepSessionAlive")},e.prototype.sessionTimeOutTime=function(){try{return Number(this.cc("sessionTimeOutTime"))}catch(t){return 1680}},e.prototype.generateToken=function(){return this.cc("generateToken")},e.prototype.extendTokenLife=function(){return this.cc("extendTokenLife")},e.prototype.softProof=function(){return this.cc("softProof")},e.prototype.createDirectory=function(){return this.cc("createDirectory")},e.prototype.errorLog=function(){return this.cc("errorLog")},e.prototype.errorLookup=function(){return this.cc("errorLookup")},e.prototype.xmljsonService=function(){return this.cc("xmljsonservice")},e.prototype.jsontoxmlservice=function(){return this.cc("jsontoxmlservice")},e.prototype.windowid=function(){return this.fv("_windowid")},e.prototype.HCAuthToken=function(){var t;if(null!=this.token)return this.token;try{t=this.fv("HCAuthToken")}catch(e){t="sd89f9asd-Grant-Fabricated-This-Token-234992kl32kl4jkl2j3k4j234"}return t},e.prototype.atg_host=function(){return this.fv("atg_host")},e.prototype.atg_port=function(){return this.fv("atg_port")},e.prototype.atg_port_secure=function(){return this.fv("atg_port_secure")},e.prototype.cartURL=function(){return this.fv("cartURL")},e.prototype.categoryID=function(){return this.fv("categoryID")},e.prototype.channelConfig=function(){return this.fv("channelConfig")},e.prototype.channelConfigEndpoint=function(){return this.fv("channelConfigEndpoint")},e.prototype.channelID=function(){return this.fv("channelID")},e.prototype.commerceItemId=function(){return this.fv("commerceItemId")},e.prototype.setCommerceItemId=function(t){return this.ofv.commerceItemId=t,this.commerceItemId()},e.prototype.disableMessageAuthentication=function(){return this.fv("disableMessageAuthentication")},e.prototype.isCSR=function(){try{return"true"==this.fv("isCSR")}catch(t){return!1}},e.prototype.isExistingUser=function(){return this.fv("isExistingUser")},e.prototype.legacyProfileID=function(){return this.fv("legacyProfileID")},e.prototype.networkName=function(){return this.fv("networkName")},e.prototype.price=function(){return this.fv("price")},e.prototype.productID=function(){return this.fv("productID")},e.prototype.profileID=function(){return this.fv("profileID")},e.prototype.quantity=function(){return this.fv("quantity")},e.prototype.registered=function(){return this.fv("registered")},e.prototype.savedItem=function(){return this.fv("savedItem")},e.prototype.skuDisplayName=function(){return this.fv("skuDisplayName")},e.prototype.skuID=function(){return this.fv("skuID")},e.prototype.subSkuIds=function(){try{var t=this.fv("subSkuIds");return null==t||"null"==t?"":t}catch(t){return""}},e.prototype.setSubSkuIds=function(t){this.ofv.subSkuIds=t},e.prototype.ugcPath=function(){return this.fv("ugcPath")},e.prototype.uniqueItemId=function(){return this.fv("uniqueItemId")},e.prototype.savedDesignName=function(){try{return this.fv("savedDesignName")}catch(t){return this.displayProductName()}},e.prototype.displayProductName=function(){try{return this.fv("displayProductName")}catch(t){return null}},e.prototype.isPreviousAutoSave=function(){var t=this.savedDesignName();return null!=t&&0==t.indexOf("Autosave-")},e.prototype.setUniqueItemId=function(t){return this.ofv.uniqueItemId=t,this.uniqueItemId()},e.prototype.showEtiquette=function(){try{return"true"==this.fv("etiquette")?!0:!1}catch(t){return!1}},e.prototype.showShareDesign=function(){try{return"true"==this.fv("showSaveandShare")?!0:!1}catch(t){return!1}},e.prototype.getSecurityQuestions=function(){for(var e=[],i=t.$.trim(t.$("#securityQAFlashvars").html()).split("|"),o=0;o<i.length;o+=2){var n={};n.questionId=i[o],n.question=i[o+1],e.push(n)}return e},e.prototype.saveItemAvailability=function(){return this.cc("saveItemAvailability")},e.prototype.enableTerms=function(){var t=this.cc("enableTerms");return"none"!=t},e.prototype.termsAction=function(){var t=this.cc("enableTerms"),e=t.split("|");return{type:e[0],value:e[1]}},e}();e.Config=i}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(){}return t.RESET_COLOR="#fffffe",t.VALID_LINE_COLOR="#555555",t.PAPER_STOCK="paperStock",t.LIVE_AREA="liveArea",t.TEXT_CONTROL="bbox.controls.CompositeText",t.PATH_TEXT_CONTROL="bbox.controls.PathText",t.TEXT_MASK_WARNING="The text is overset. Resize the container or text to allow for more space. Some text MAY NOT print if this warning is visible.",t.TEXT_MARGIN_WARNING="The text is outside of the safe margin for printing.  Please move the text away from the edge to ensure proper display of your text.",t.IMAGE_MARGIN_WARNING="The image is outside of the safe margin for printing.  Please move the image away from the edge to ensure proper display of your image.",t.IMAGE_RESOLUTION_WARNING="The image used is under the recommended 300 DPI for this container.  To fix this use a larger image, or reduce the scale of the image, or size of the container.",t.LINE_HEIGHT_OPTIONS=["120","140","160","180","200"],t.HALIGN_OPTIONS=["left","center","right"],t.FOLD_HORIZONTAL_LABELS=["FRONT","INSIDE TOP","INSIDE BOTTOM","BACK"],t.FOLD_VERTICAL_LABELS=["FRONT","INSIDE LEFT","INSIDE RIGHT","BACK"],t.LABELS=["front","back"],t.GENERIC_FOUR_PAGE_LABELS=["PAGE 1","PAGE 2","PAGE 3","PAGE 4"],t.NETWORK_IPRINT="100003",t.NETWORK_WALMART="100011",t.NETWORK_EXPRESSIONERY="100009",t.DEFAULT_IMAGE_WIDTH=85,t.DEFAULT_IMAGE_HEIGHT=85,t}();t.Constants=e}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.encodeCharacterToHex=function(t){for(var e=t.toString(16).toUpperCase();e.length<4;)e="0"+e;return"&#x"+e+";"},e.encodeStringToHex=function(t,i){if("undefined"==typeof i&&(i=!0),t.length>0){var o,n,s="",a=t.length,r=0;for(r;a>r;r++)o=t.charAt(r),n=t.charCodeAt(r),s+=i?128>n?o:e.encodeCharacterToHex(o):o;return s}return""},e.htmlEncode=function(e){return t.$("</div>").html(e).text()},e.htmlDecode=function(e){return t.$("</div>").text(e).html()},e}();e.EncodingUtils=i}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.clearTextControls=function(){for(var e=t.stage.getNumChildren();e>0;e--){var i=t.stage.getChildAt(e-1);i.type==t.utils.Constants.TEXT_CONTROL&&t.utils.CanvasUtil.remove(i)}t.updateStage()},e.run=function(e,i){"undefined"==typeof e&&(e="The quick fox jumps over the dog"),"undefined"==typeof i&&(i="top"),this.clearTextControls();for(var o=e,n=t.fonts.fontSet,s=60,a=20,r=t.product.getActiveLayout().height,l=t.product.getActiveLayout().width,h=(l-s-10)/2,c=0;c<n.fonts.length&&8>c;c++){var d=n.fonts[c].Family,p=t.fonts.getFont(d),u=t.app.views.canvasView.addText();u.setCurrentFont(p),u.setText(o),u.x=s,u.y=a,u.verticalAlign=i,u.update(h,u.height+10),a+=u.height+5,a>r&&(a=20,s+=u.width+10)}t.selections.clear(),t.updateStage()},e.showAllFontInList=function(){var e={Name:"Monster Stationery Set",Count:106,fonts:[{Family:"Amadeo Std"},{Family:"Amore"},{Family:"Apricot"},{Family:"Astro Black Std ITC"},{Family:"Astro White Std ITC"},{Family:"Baskerville Com"},{Family:"Bauhaus Std"},{Family:"Belinda"},{Family:"Bernhard Modern Std"},{Family:"New Berolina MT Std"},{Family:"Bickham Script Pro"},{Family:"Black Swan BF"},{Family:"BodoniClassicCondensed"},{Family:"Bodoni Std"},{Family:"Bombshell Pro"},{Family:"Bradley Hand ITC Std"},{Family:"Brandon Grotesque"},{Family:"Bruno JB Std"},{Family:"Burgues Script"},{Family:"Business Penmanship"},{Family:"Caliban Std"},{Family:"Cancione ITC Std"},{Family:"Century Gothic Pro Grk"},{Family:"Dear Sarah Pro"},{Family:"Directors Gothic 220"},{Family:"New Century Schoolbook LT Pro"},{Family:"Charlemagne Std"},{Family:"Chevalier Std"},{Family:"Chiller Std"},{Family:"Christophs Quill ITC Std"},{Family:"Cinderella ITC Std"},{Family:"Clover ITC Std"},{Family:"Comic Sans"},{Family:"Comic Sans Pro"},{Family:"Copperplate Gothic LT Pro"},{Family:"Copperplate Gothic Std"},{Family:"Corsiva MT Std"},{Family:"Dartangnon ITC Std"},{Family:"Didot LT Std"},{Family:"Dorchester Script MT Std"},{Family:"Edwardian Script ITC Std"},{Family:"Enamel"},{Family:"Enviro Std"},{Family:"Fette Fraktur LT Std"},{Family:"Fine Hand Std"},{Family:"Fling Std"},{Family:"ITC Franklin Gothic Std"},{Family:"Frosted"},{Family:"Futura LT Pro"},{Family:"Garamond MT Std"},{Family:"Gigi Std"},{Family:"Gravura Std"},{Family:"Helvetica Neue LT Std"},{Family:"Italia Std"},{Family:"Juice ITC Std"},{Family:"Kidprint MT Pro"},{Family:"Klepto ITC Std"},{Family:"Kristen Normal ITC Std"},{Family:"Kulukundis ITC Std"},{Family:"LiebeErika"},{Family:"Linoscript Std"},{Family:"LitterboxICG Std"},{Family:"Mahogany Script Std"},{Family:"Mahsuri Sans MT Std"},{Family:"Melany Lane"},{Family:"ITC Mona Lisa Std"},{Family:"Mr Sheffield"},{Family:"Naive Inline"},{Family:"Officina Display ITC Std"},{Family:"Old English Std"},{Family:"Optima LT Pro"},{Family:"ITC Ozwald Std"},{Family:"Papyrus Std"},{Family:"Parisian Std"},{Family:"Pepita MT Std"},{Family:"Populaire"},{Family:"Populaire Light"},{Family:"Rockwell Std"},{Family:"Rodeqa Slab 4F"},{Family:"Rusticana LT Std"},{Family:"Sackers Gothic Std"},{Family:"Savoye Std"},{Family:"Serlio LT Std"},{Family:"Shelley Script LT CYR"},{Family:"Silvermoon ITC Std"},{Family:"Snell Roundhand LT Std"},{Family:"Solid Antique Roman Std"},{Family:"Spumoni LP"},{Family:"Stylus ITC Std"},{Family:"Tekton Pro"},{Family:"Telegram Std"},{Family:"Tempus Sans ITC Std"},{Family:"Thirsty Rough"},{Family:"Times NR MT Pro"},{Family:"Times NR MT Std"},{Family:"Typewriter Gothic MT Std"},{Family:"University Roman Std"},{Family:"Veneer"},{Family:"Vermandois"},{Family:"Wee Todd"},{Family:"Wendy LP Medium"},{Family:"ITC Zapf Chancery Pro"},{Family:"Zemke Hand ITC Std"},{Family:"Zennor Std"}]};t.fonts.fontSet=e},e.basicTest=function(e,i){"undefined"==typeof e&&(e="top"),"undefined"==typeof i&&(i=""),this.clearTextControls();for(var o=i,n=t.fonts.fontSet,s=90,a=20,r=t.product.getActiveLayout().height,l=t.product.getActiveLayout().width,h=l/2+20,c=0;c<n.fonts.length&&5>c;c++){var d=n.fonts[c].Family,p=t.fonts.getFont(d),u=t.app.views.canvasView.addText();u.setCurrentFont(p),u.setText(o),u.x=s,u.y=a,u.verticalAlign=e,u.update(h,u.height),a+=u.height+5,a>r&&(a=10,s+=u.width+10)}t.selections.clear(),t.updateStage()},e.basicAlphaTest=function(t){"undefined"==typeof t&&(t="top");var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";this.basicTest(t,e)},e.basicNumericTest=function(t){"undefined"==typeof t&&(t="top");var e="0123456789";this.basicTest(t,e)},e.basicCharTest=function(t){"undefined"==typeof t&&(t="top");var e='~`!@#$%^&*()_+={}:"<>?/.,;][|?';this.basicTest(t,e)},e.basicLatinTest=function(t){"undefined"==typeof t&&(t="top");var e="  ? ?  ?????  ";this.basicTest(t,e)},e.getHtmlNode=function(e){var i="<span>"+e+"</span>",o=t.$(i);o.css("margin","0px"),o.css("display","block"),o.css("top","0px"),o.css("font","20px Bree Serif"),o.css("letter-spacing","2px")},e}();e.FontTest=i}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.PointCollectionsOverlap=function(t,e){for(var i=0;i<t.count();i++)for(var o=0;o<e.count();o++)if(this.lineSegmentsIntersect(t.getAtIndex(i),t.getAtIndex((i+1)%t.count()),e.getAtIndex(o),e.getAtIndex((o+1)%e.count())))return!0;return this.PointCollectionContainsPoint(t,e.getAtIndex(0))||this.PointCollectionContainsPoint(e,t.getAtIndex(0))?!0:!1},e.PointCollectionContainsPoint=function(e,i){for(var o=new t.model.Point(-100,-100),n=0,s=0;s<e.count();s++)this.lineSegmentsIntersect(e.getAtIndex(s),e.getAtIndex((s+1)%e.count()),o,i)&&n++;return n%2==1},e.determinant=function(t,e){return t.x*e.y-t.y*e.x},e.lineSegmentsIntersect=function(t,e,i,o){var n=this.determinant(e.subtract(t),i.subtract(o)),s=this.determinant(i.subtract(t),i.subtract(o))/n,a=this.determinant(e.subtract(t),i.subtract(t))/n;return s>=0&&a>=0&&1>=s&&1>=a},e}();e.GeometryUtil=i}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(){}return t.parsePathCommands=function(e){for(var i=null,o=[],n=!1,s=!1,a=!1,r=!1,l=!1,h=!1,c=0;c<e.length;c++){var d=e.charAt(c);if("M"==d)i={type:"move"},o.push(i),l=!0;else if("L"==d)i={type:"line"},o.push(i),l=!0;else{if("C"==d){i={type:"curve"},o.push(i),n=!0;continue}if(" "==d)continue;var p=Number(d);if(isNaN(p))continue;var u=t.getNumberEndIndex(e,c);p=Number(e.substring(c,u+1)),u>c&&(p=Number(e.substring(c,u+1))),n?(i.cpx1=p,s=!0,n=!1):s?(i.cpy1=p,s=!1,n=!1,a=!0):a?(i.cpx2=p,r=!0,a=!1):r?(i.cpy2=p,l=!0,r=!1):l?(i.x=p,l=!1,h=!0):h&&(i.y=p,h=!1),c=u}}return o},t.getNumberEndIndex=function(t,e){for(;e+1<t.length&&" "!=t.charAt(e+1);)e++;return e},t.findPointOnCurve=function(t,e){var i=Math.pow(e,3)*(t[2]+3*(t[4]-t[6])-t[0])+3*Math.pow(e,2)*(t[0]-2*t[4]+t[6])+3*e*(t[4]-t[0])+t[0],o=Math.pow(e,3)*(t[3]+3*(t[5]-t[7])-t[1])+3*Math.pow(e,2)*(t[1]-2*t[5]+t[7])+3*e*(t[5]-t[1])+t[1];return[i.toFixed(4),o.toFixed(4)]},t.calcAngle=function(t,e){var i=[t[4],t[5]],o=[t[6],t[7]],n=[t[0],t[1]],s=[t[2],t[3]],a=this.interPolatePoint(i,n,e),r=this.interPolatePoint(o,i,e),l=this.interPolatePoint(s,o,e),h=this.interPolatePoint(r,a,e),c=this.interPolatePoint(l,r,e),d=Math.atan((h[1]-c[1])/(h[0]-c[0]))-2*Math.PI;return c[0]<h[0]&&(d-=Math.PI),d=180*d/Math.PI,d.toFixed(4)},t.interPolatePoint=function(t,e,i){var o=(e[0]-t[0])*(1-i)+t[0],n=(e[1]-t[1])*(1-i)+t[1];return[o,n]},t}();t.GraphicUtils=e}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.run=function(){var e;e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=29.9787610619469,this.y=24.6902654867256,this.model.container.x=0,this.model.container.y=0,this.model.container.width=42.5,this.model.container.height=31.875,this.model.container.rotation=0,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.render(),this.clean()
},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=64.7842920353982,this.y=24.6902654867257,this.model.container.x=21.25,this.model.container.y=0,this.model.container.width=21.25,this.model.container.height=31.875,this.model.container.rotation=0,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.render(),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=88.3909292035398,this.y=24.6902654867257,this.model.container.x=0,this.model.container.y=0,this.model.container.width=20.5491150442478,this.model.container.height=31.875,this.model.container.rotation=0,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.render(),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=122.495575221239,this.y=32.6590154867257,this.model.container.x=0,this.model.container.y=15.9375,this.model.container.width=42.5,this.model.container.height=15.9375,this.model.container.rotation=0,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.render(),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=168.053097345133,this.y=17.2471792035398,this.model.container.x=0,this.model.container.y=0,this.model.container.width=42.5,this.model.container.height=16.9888274336283,this.model.container.rotation=0,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.render(),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=57.6637168141593,this.y=66.0424778761062,this.model.container.x=0,this.model.container.y=0,this.model.container.width=42.5,this.model.container.height=31.875,this.model.container.rotation=39.5297927064653,this.rotation=this.model.container.rotation,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.render(),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=110.580530973451,this.y=68.1451327433628,this.model.container.x=0,this.model.container.y=0,this.model.container.width=42.5,this.model.container.height=31.875,this.model.container.rotation=324.644636147568,this.rotation=this.model.container.rotation,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.render(),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=176.575442477876,this.y=67.4442477876106,this.model.container.x=24.0535398230088,this.model.container.y=0,this.model.container.width=18.4464601769912,this.model.container.height=31.875,this.model.container.rotation=322.601194760728,this.rotation=this.model.container.rotation,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.render(),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=212.846238938053,this.y=71.2991150442478,this.model.container.x=16.6942477876106,this.model.container.y=0,this.model.container.width=25.8057522123894,this.model.container.height=31.875,this.model.container.rotation=42.0350254878127,this.rotation=this.model.container.rotation,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.render(),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=30.168,this.y=119.256,this.model.container.x=0,this.model.container.y=0,this.model.container.width=42.5,this.model.container.height=31.875,this.model.container.rotation=0,this.rotation=this.model.container.rotation,this.model.image.x=21.25,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=15,this.resetImageRegXY(),this.render(),this.imageRotate(this.model.image.rotation-this.model.container.rotation),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=140,this.y=110,this.model.container.x=0,this.model.container.y=0,this.model.container.width=42.5,this.model.container.height=31.875,this.model.container.rotation=45,this.rotation=this.model.container.rotation,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.resetImageRegXY(),this.flipHorizontal(),this.render(),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=80,this.y=120,this.model.container.x=0,this.model.container.y=0,this.model.container.width=42.5,this.model.container.height=31.875,this.model.container.rotation=0,this.model.image.x=0,this.model.image.y=0,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.resetImageRegXY(),this.flipVertical(),this.render(),this.clean()},t.stage.addChild(e),e=t.controls.ComponentFactory.createNewImage(0,0,10,10,t.app.views.canvasView.getImageAsset(t.$("#photo1")),4608,3456,!0),e.ready=function(){this.x=215,this.y=120,this.model.container.x=0,this.model.container.y=0,this.model.container.width=42.5,this.model.container.height=31.875,this.model.container.rotation=0,this.model.image.x=0,this.model.image.y=-15,this.model.image.width=42.5,this.model.image.height=31.875,this.model.image.rotation=0,this.render(),this.clean()},t.stage.addChild(e)},e}();e.ImageTest=i}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.log=function(i,o,n){if(this.viewLog>this.OFF&&i){var o;this.setLoggingClasses(),this.myLogging[i]!==!0||!o||e.viewLog!==n&&e.viewLog!==this.ALL||t.log(i+"::: "+o)}},e.setLoggingClasses=function(){if(!this.myLogging){var t=[];t.ActionManager=!1,t.InstanceManager=!1,t.DialogManager=!1,t.FontManager=!0,t.ServiceManager=!1,t.CacheManager=!1,t.EditorManager=!1,t.ErrorManager=!1,t.EventManager=!1,t.ImageManager=!1,t.UIManager=!1,t.SelectionManager=!1,t.SceneManager=!1,t.TooltipManager=!1,t.PeepsManager=!1,t.RequirementValidationManager=!1,t.GuidedUITipManager=!1,t.Product=!1,t.Layout=!1,t.Manifest=!1,t.FontSet=!1,t.Font=!1,t.FontVariant=!1,t.ProductOptions=!1,t.ProductOption=!1,t.PriceOption=!1,t.RelatedProduct=!1,t.ImageLibrary=!1,t.ImageAsset=!1,t.TextStyle=!1,t.SaveData=!1,t.ValidationResultType=!1,t.Peep=!1,t.PeepFamily=!1,t.PeepComponent=!1,t.FontReplacementObject=!1,t.Point=!1,t.SVGDocument=!1,t.DomWorkflowHint=!1,t.RequiredFieldTip=!1,t.SavedUserLocation=!1,t.SaveService=!1,t.BaseControl=!1,t.BackgroundColor=!1,t.Bounds=!1,t.Text=!1,t.CompositeText=!1,t.Image=!1,t.Background=!1,t.LiveArea=!1,t.Paragraph=!1,t.ControlUI=!1,t.ControlContent=!1,t.ComponentFactory=!1,t.GroupContainer=!1,t.DOMText=!1,t.Graphic=!1,t.Paperstock=!1,t.BackgroundImage=!1,t.ZoomNav=!1,t.DieCut=!1,t.ImageMask=!1,t.Peep=!1,t.CanvasView=!1,t.PeepsCanvasView=!1,t.ToolbarView=!1,t.AssetPanelView=!1,t.SceneView=!1,t.PhotoUpload=!1,t.Error=!1,t.SaveDialog=!1,t.UpsellDialog=!1,t.BackOptionsDialog=!1,t.UserDialog=!1,t.Offline=!1,t.ConfirmDialog=!1,t.TestPreview=!1,t.ImageZoom=!1,t.RemoveImageDialog=!1,t.PeepsEditor=!1,t.CancelPeepSessionDialog=!1,t.BusyDialog=!1,t.SessionDialog=!1,t.PromoteBackgroundDialog=!1,t.PreviewView=!1,t.ZoomControlView=!1,t.TextEdit=!1,t.ImageEdit=!1,t.ContainerEdit=!1,t.PeepEdit=!1,t.PeepAttributeEdit=!1,t.Config=!1,t.TextUtil=!1,t.EncodingUtils=!1,t.Constants=!1,t.Router=!1,t.GraphicUtils=!1,t.LoggingUtil=!1,t.StringUtil=!1,t.ActionBase=!1,t.BackgroundColorAction=!1,t.ContainerLayerAction=!1,t.ContainerCreateDeleteAction=!1,t.ContainerMoveAction=!1,t.ImageColorAction=!1,t.ImageFlipAction=!1,t.ImageModelAction=!1,t.ImageMoveAction=!1,t.ImageRotateAction=!1,t.ImageScaleAction=!1,t.ImageSizeFitAction=!1,t.ImageSwapAction=!1,t.TextColorAction=!1,t.TextFontAction=!1,t.TextFontAlignAction=!1,t.TextHeightAction=!1,t.TextRevisionAction=!1,t.TextSizeAction=!1,t.TextVariantAction=!1,t.WizardDialog=!1,this.myLogging=t}},e.EXTRY_EXIT=1,e.INFO=2,e.DEBUG=3,e.FATAL=9,e.OFF=0,e.ALL=10,e.viewLog=10,e}();e.LoggingUtil=i}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){this.routes={"":"index",preview:"preview",test:"test",compPreview:"compositionPreview",sdxml:"sdxml"},e.call(this),Backbone.history.start()}return __extends(i,e),i.prototype.index=function(){t.edit()},i.prototype.preview=function(){return t.selections.clear(),null==t.product?(t.edit(),void window.location.assign("#")):void(t.app.views.canvasView.isProductValid()?(t.preview(),setTimeout(function(){t.events.trigger(t.events.WINDOW_RESIZE)},1e3)):(this.navigate("",{trigger:!0}),t.$("#previewButton").popover("show"),setTimeout(this.hidePopOver,5500)))},i.prototype.hidePopOver=function(){t.$("#previewButton").popover("hide")},i.prototype.test=function(){null!=t.product&&(t.dialogs.testPreviewDialog.preview(),window.location.assign("#"))},i.prototype.compositionPreview=function(){t.$('#compositionTabs a[href="#compPreview"]').tab("show")},i.prototype.sdxml=function(){t.$('#compositionTabs a[href="#sdxml"]').tab("show")},i}(Backbone.Router);e.Router=i}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(t){var e=function(){function t(){}return t.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},t.appendSuffix=function(e,i,o){return"undefined"==typeof o&&(o=!1),!o&&t.endsWith(e,i)?name:e+i},t}();t.StringUtil=e}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.trim=function(e){return"undefined"==typeof e&&(e=""),t.$.trim(e)},e.updateTextStyle=function(e,i,o){var n,s=t.$(e),a=s.text(),r=null;if(0!=i.text.length&&i.startIndex!=i.endIndex){var l=t.$(e+" span"),h=l.eq(0);if(0==i.startIndex&&i.text.length==a.length)return h.text(a),t.model.TextStyle.clearStyle(h),s.empty(),s.append(h),void o.updateElement(s);if(1!=l.length){var c=t.utils.TextUtil.getStartSpanIndex(i,l),d=t.utils.TextUtil.getEndSpanIndex(a,i,l);if(h=l.eq(c),c!=d){var p=0;n=-1;for(var u=0,g=-1,m=c;d>=m;m++){h=l.eq(m);var f=h.text();p+=f.length,m==c&&(n=a.indexOf(f),u=f.length),m==d&&(g=a.indexOf(f))}if(p!=i.text.length){if(h=l.eq(c),i.startIndex==n){var v=i.endIndex-i.startIndex,y=a.substr(n,v),I=a.substring(i.endIndex,n+p),b=l.eq(d);r=t.model.TextStyle.getStyle(b);for(var m=c;d>m;m++){var _=l.eq(m);o.updateElement(_)}var C=a.substring(g,i.endIndex);b.text(C),o.updateElement(b);var x=t.$("<span>"+I+"</span>");return t.utils.TextUtil.insertAtIndex(e,x,d+1),void r.updateElement(x)}var w=a.substring(n,i.startIndex),T=a.substr(i.startIndex,u-w.length);h.text(w),r=t.model.TextStyle.getStyle(h);var x=t.$("<span>"+T+"</span>");o.updateElement(x,r);for(var m=c+1;d>m;m++){var _=l.eq(m);o.updateElement(_)}t.utils.TextUtil.insertAtIndex(e,x,c+1);var C=a.substring(g,i.endIndex),b=l.eq(d);if(b.text(C),r=t.model.TextStyle.getStyle(b),o.updateElement(b),i.endIndex<n+p){var O=a.substring(i.endIndex,n+p),S=t.$("<span>"+O+"</span>");t.utils.TextUtil.insertAtIndex(e,S,d+2),r.updateElement(S)}}else for(var m=c;d>=m;m++){var _=l.eq(m);o.updateElement(_)}}else{var f=h.text();if(f.length==i.text.length)return void o.updateElement(h);if(i.startIndex==a.indexOf(f)){var v=i.endIndex-i.startIndex,y=f.substr(0,v),I=f.substring(v);h.text(y),r=t.model.TextStyle.getStyle(h),o.updateElement(h);var x=t.$("<span>"+I+"</span>");return t.utils.TextUtil.insertAtIndex(e,x,c+1),void r.updateElement(x)}n=a.indexOf(f);var y=a.substring(n,i.startIndex),I=a.substring(i.startIndex,i.endIndex);h.text(y),r=t.model.TextStyle.getStyle(h);var x=t.$("<span>"+I+"</span>");if(o.updateElement(x,r),t.utils.TextUtil.insertAtIndex(e,x,c+1),i.endIndex<n+f.length){var O=f.substring(y.length+I.length),S=t.$("<span>"+O+"</span>");t.utils.TextUtil.insertAtIndex(e,S,c+2),r.updateElement(S)}}}else{if(r=t.model.TextStyle.getStyle(h),0==i.startIndex){var y=a.substring(i.startIndex,i.endIndex),I=a.substring(i.endIndex);h.text(y),o.updateElement(h);var x=t.$("<span>"+I+"</span>");return r.updateElement(x),void s.append(x)}var y=a.substring(0,i.startIndex),I=a.substring(i.startIndex,i.endIndex);h.text(y);var x=t.$("<span>"+I+"</span>");if(o.updateElement(x,r),s.append(x),i.endIndex<a.length){var O=a.substring(i.endIndex),S=t.$("<span>"+O+"</span>");r.updateElement(S),s.append(S)}}}},e.insertAtIndex=function(e,i,o){if(0===o)return void t.$(e).prepend(i);var n=t.$(e+" span:nth-child("+o+")");n.after(i)},e.getStartSpanIndex=function(t,e){if(0==t.startIndex)return 0;for(var i=0,o=0;o<e.length;o++){var n=e.eq(o),s=n.text().length;if(i+=s,i>=t.startIndex)return o}return e.length-1},e.getEndSpanIndex=function(t,e,i){if(e.endIndex==t.length)return i.length-1;for(var o=t.length,n=i.length;n>0;n--){var s=i.eq(n-1),a=s.text().length;if(o-=a,o<e.endIndex)return n-1}return 0},e.getCaretCharacterOffsetWithin=function(t){var e,i=0,o=window,n=document;if("undefined"!=typeof o.getSelection){var s=o.getSelection().getRangeAt(0),a=s.cloneRange();a.selectNodeContents(t),a.setEnd(s.endContainer,s.endOffset),i=a.toString().length}else if((e=n.selection)&&"Control"!=e.type){var r=e.createRange(),l=n.body.createTextRange();l.moveToElementText(t),l.setEndPoint("EndToEnd",r),i=l.text.length}return i},e.textToHtml=function(e,i,o,n){var s=t.$("<p id='p"+i+"'></p>");s.css("color",n.color),s.css("font-size",t.utils.HtmlUtil.scaleValue(n.fontSize)+"px"),s.css("font-family",n.fontFamily),s.css("text-align",n.textAlign),s.attr("data-font-family",e.currentFont.fontFamily),s.attr("data-font-style",e.currentVariant.fontStyle);var a=t.$("<span>"+o+"</span>");return s.append(a),s},e.colorToHex=function(t){if("#"===t.substr(0,1))return t;var e=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(t),i=parseInt(e[2]).toString(16),o=parseInt(e[3]).toString(16),n=parseInt(e[4]).toString(16);1==i.length&&(i="0"+i),1==o.length&&(o="0"+o),1==n.length&&(n="0"+n);var s="#"+i+o+n;return s},e.enforceHexLength=function(t){var e="#000000";return 7===t.length?e=t:6===t.length&&-1===t.indexOf("#")?e="#"+t:4===t.length&&(e="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),e},e.updateStyles=function(e,i){var o=i.attr("style");if(o.indexOf("font-family")>-1){var n=i.css("font-family");0==n.indexOf("'")&&(n=n.substr(1)),n.lastIndexOf("'")==n.length-1&&(n=n.substr(0,n.length-1));var s=t.fonts.getFontByCssLabel(n);if(t.utils.ObjectUtil.notUndefined(s)){e.updateFont(s);var a=s.getScreenName(n);e.updateFontVariant(a)}}if(o.indexOf("font-size")>-1){var r=i.css("font-size");r.indexOf("px")>0&&(r=r.substring(0,r.indexOf("px"))),r=t.utils.HtmlUtil.descaleValue(r),e.updateFontSize(r)}if(o.indexOf("color")>-1){var l=i.css("color");l=t.utils.TextUtil.colorToHex(l),t.utils.TextUtil.isColorValid(l)||(l=t.product.getActiveLayout().getDefaultTextColor()),e.updateColor(l)}},e.paragraphToHtml=function(e,i,o,n){var s="p"+i,a=t.$("<p id='"+s+"'></p>");a.css("color",n.color),a.css("font-size",t.utils.HtmlUtil.scaleValue(n.fontSize)+"px"),a.css("font-family",n.fontFamily),a.css("text-align",n.textAlign),a.attr("data-font-family",e.font.fontFamily),a.attr("data-font-style",e.variant.fontStyle);for(var r=t.utils.JsonUtil.getList(o.span.content),l=0;l<r.length;l++){var h=r[l],c=s+"-s"+l,d=t.$("<span id='"+c+"'>"+h+"</span>");a.append(d),r.length>1&&l<r.length-1&&a.append("<br/>")}return a},e.hasInlineStyles=function(e){return t.utils.ObjectUtil.notUndefined(e.span._color)||t.utils.ObjectUtil.notUndefined(e.span._fontId)||t.utils.ObjectUtil.notUndefined(e.span._fontSize)||t.utils.ObjectUtil.notUndefined(e.span._lineHeight)},e.getInlineStyles=function(e,i){var o=t.$.extend(!0,{},e);return o._name=t.utils.GUID.create(),t.utils.ObjectUtil.notUndefined(i.span._color)&&(o._color=i.span._color),t.utils.ObjectUtil.notUndefined(i.span._fontId)&&(o._fontId=i.span._fontId),t.utils.ObjectUtil.notUndefined(i.span._fontSize)&&(o._fontSize=i.span._fontSize),t.utils.ObjectUtil.notUndefined(i.span._lineHeight)&&(o._lineHeight=i.span._lineHeight),o},e.isColorValid=function(e){for(var i=t.product.getActiveLayout().getFontSwatches(),o=0;o<i.length;o++)if(e.toUpperCase()==i[o]._rgbValue.toUpperCase())return!0;return!1},e.scrubText=function(t){for(var e="",i=0;i<t.length;i++){var o=t.charAt(i),n=t.charCodeAt(i);if(n>127)if((""==o||""==o)&&i+2<t.length&&128==t.charCodeAt(i+1)&&153==t.charCodeAt(i+2))e+="&rsquo;",i+=2;else if((""==o||""==o)&&i+2<t.length&&128==t.charCodeAt(i+1)&&147==t.charCodeAt(i+2))e+="&ndash;",i+=2;else if((""==o||""==o)&&i+2<t.length&&128==t.charCodeAt(i+1)&&148==t.charCodeAt(i+2))e+="&mdash;",i+=2;else if((""==o||""==o)&&i+2<t.length&&128==t.charCodeAt(i+1)&&162==t.charCodeAt(i+2))e+="&bull;",i+=2;else if(""!=o&&""!=o||!(i+2<t.length)||128!=t.charCodeAt(i+1)||166!=t.charCodeAt(i+2)&&352!=t.charCodeAt(i+2))if((""==o||""==o)&&i+2<t.length)e+="",i+=2;else{var s=encodeURI(o);e+="%EF%BF%BD"==s?" ":o}else e+="&hellip;",i+=2;else e+="<"==o?"&lt;":">"==o?"&gt;":o}return e},e.updateScriptLabel=function(t,e){for(var i="",o=t.split("|"),n=0;n<o.length;n++){var s=o[n].split("="),a=s[0],r=s[1];i+="defaultText"==a?a+"="+e:a+"="+r,n<o.length-1&&(i+="|")}return i},e.removeDefaultTextFromScript=function(t){for(var e="",i=t.split("|"),o=0;o<i.length;o++){var n=i[o].split("="),s=n[0],a=n[1];"defaultText"!=s&&(e+=s+"="+a),o<i.length-1&&(e+="|")}return e},e.encodeDefaultText=function(e){var i=t.utils.ObjectUtil.notUndefined(e._defaultText);if(!i)return e;var o=e._defaultText?e._defaultText:"",n=t.utils.HtmlUtil.decode(o),s=t.utils.HtmlUtil.encode(n);return e._defaultText=s,e._scriptLabel=t.utils.TextUtil.updateScriptLabel(e._scriptLabel,s),e},e.debug=function(){for(var e=t.product.getActiveLayout(),i=0;i<e.fonts.length;i++);},e.logText=function(e,i){if(t.utils.ObjectUtil.notUndefined(e._defaultText),null!=i)for(var o=t.utils.ObjectUtil.notUndefined(i.TextFlow.div)?i.TextFlow.div:i.TextFlow,n=t.utils.JsonUtil.getList(o.p),s=0;s<n.length;s++){var a=n[s];t.utils.HtmlUtil.getText(a)}},e}();e.TextUtil=i}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.storeData=function(e,i){var o;try{var n=t.$.rc4EncryptStr(i,this.tmpKey);localStorage.setItem(e,n),o=!0}catch(t){o=!1}return o},e.getStoredData=function(e){var i;try{i=localStorage.getItem(e),i=t.$.rc4DecryptStr(i,this.tmpKey)}catch(t){i=""}return i},e.clearStoredData=function(){var t=!0;try{localStorage.clear()}catch(e){t=!1}return t},e.tmpKey="123456789",e}();e.WebStorageUtil=i}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(){function e(){}return e.getMetrics=function(){if(t.product){var e={};e.canvasHeight=t.stageRoot.canvas.height,e.canvasWidth=t.stageRoot.canvas.width,e.scale=t.stageZoom.scaleX;var i=t.stageRoot.localToLocal(0,0,t.stageZoom);e.cornerX=i.x,e.cornerY=i.y;var o=t.product.getActiveLayout();return e.width=o.width*e.scale,e.height=o.height*e.scale,e.x=t.stageZoom.x,e.y=t.stageZoom.y,e}return null},e.center=function(){var e=t.utils.Stage.getMetrics();null!=e&&(t.stageZoom.x=(e.canvasWidth-e.width)/2,t.stageZoom.y=(e.canvasHeight-e.height)/2,t.updateStage())},e}();e.Stage=i;var o=function(){function t(){}return t.getList=function(t){return"undefined"==typeof t?[]:t instanceof Array?t:[t]},t}();e.JsonUtil=o;var n=function(){function t(){}return t.isString=function(e){return t.notUndefined(e)&&"string"==typeof e},t.isUndefined=function(t){return"undefined"==typeof t||null==t},t.notUndefined=function(t){return"undefined"!=typeof t||null!=t},t.swapItem=function(t,e,i){i.splice(t,0,i.splice(e,1)[0])},t.isEmpty=function(e){return t.isUndefined(e)||null==e||0==e.length},t.getDocument=function(t){return t.hasOwnProperty("payload")?t.payload:t},t}();e.ObjectUtil=n;var s=function(){function e(){}return e.remove=function(e){var i=e.pageItemBlock;if(t.utils.ObjectUtil.notUndefined(i)){var o=t.product.getActiveLayout();o.removePageItem(i)}if(t.stage.removeChild(e),e.hasOwnProperty("instanceId")&&t.managers.InstanceManager.destroy(e.instanceId),"bbox.controls.Image"==e.type){var n=e;null!=n.imageId&&t.events.trigger(t.events.REFRESH_IMAGE_STATE,n.imageId,!0)}},e}();e.CanvasUtil=s;var a=function(){function e(){}return e.getElementEdges=function(t){var e=0;return e+=parseInt(t.css("margin-left")),e+=parseInt(t.css("margin-right")),e+=parseInt(t.css("padding-left")),e+=parseInt(t.css("padding-right"))},e.setSelectOption=function(e,i){t.$("#"+e+" option").filter(function(){return t.$(this).text()==i}).prop("selected",!0)},e.getDomCompliantValue=function(t){"undefined"==typeof t&&(t=0);var e,i=t.toFixed(1),o=.1*(i%1*10<<0),n=Math.floor(i);return e=.3>o?n:o>.7?t.toFixed(0):n+.5},e.scaleValue=function(e){return Math.round(e*t.stageZoom.scaleX)},e.descaleValue=function(e){return Math.round(e/t.stageZoom.scaleX)},e.decode=function(e){e=t.utils.TextUtil.scrubText(e);var i=t.$("<div />").html(e).text();return i},e.encode=function(t){for(var e="",i=0;i<t.length;i++){var o=t.charAt(i);e+="&"==o?"&amp;":o}return e},e.getProperty=function(t,e){var i=t.css(e);return i.indexOf("px")>0&&(i=i.substring(0,i.indexOf("px"))),Number(i)},e.setProductName=function(e){var i=window;if("undefined"!=typeof i.refreshProductName){var o=t.$.trim(decodeURI(e));i.refreshProductName(o)}},e.setAskBeforeQuit=function(t){var e=window;"undefined"!=typeof e.askBeforeQuit&&(e.askBeforeQuit=t)},e.sendCatalystEvent=function(t,e){var i=window;"undefined"!=typeof i.sendEvent&&i.sendEvent(t,e)},e.openHelp=function(){var e=window;"undefined"!=typeof e.openCardConfigHelpModal&&(e.openCardConfigHelpModal(),t.utils.HtmlUtil.sendCatalystEvent(34,"Configurator Help"))},e.shareDesign=function(){var e=window;"undefined"!=typeof e.refreshGetFeedbackFromFriendDroplet&&e.refreshGetFeedbackFromFriendDroplet(t.config.uniqueItemId())},e.getTooltipPosition=function(e){var i=e.x-e.regX,o=e.y-e.regY,n=t.stage.localToGlobal(i,o);return n.y<90&&(n.y=90),n},e.resetComboBox=function(e){var i=t.$(e);i.empty(),i.show(),i.append('<option value="0">-- Choose --</option>')},e.createTooltip=function(e,i,o,n,s){"undefined"==typeof n&&(n=null),"undefined"==typeof s&&(s=!1),t.isMobile()&&s!==!0||(t.$("#"+e).tooltip("destroy"),t.$("#"+e).tooltip(n?{title:i,placement:o,container:n}:{title:i,placement:o}),t.$("#"+e).tooltip("enable"))},e.removeTooltip=function(e){t.$("#"+e).tooltip("disable")},e.clearFields=function(e){for(var i=0;i<e.length;i++)t.$("#"+e[i]).val("")},e.show=function(e){for(var i=0;i<e.length;i++)t.$("#"+e[i]).show()},e.hide=function(e){for(var i=0;i<e.length;i++)t.$("#"+e[i]).hide()},e.toggleBackOptionButton=function(e){var i=t.$("#addRemoveIcon");e?(i.removeClass("sprite-icon_remove_back"),i.addClass("sprite-icon_add_back")):(i.removeClass("sprite-icon_add_back"),i.addClass("sprite-icon_remove_back"))},e.setSelection=function(e){{var i=window,o=document,n=o.createRange(),s=t.$("#"+e+" span"),a=s.get(0),r=s.eq(s.length-1),l=r.contents().get(0);t.$("#"+e)}n.setStart(a,0),n.setEnd(l,r.text().length);var h=i.getSelection();h.removeAllRanges(),h.addRange(n)},e.setCaret=function(e){{var i=window,o=document,n=o.createRange(),s=t.$("#"+e+" span"),a=(s.get(0),s.eq(s.length-1)),r=a.contents().get(0);t.$("#"+e)}n.setStart(r,a.text().length),n.setEnd(r,a.text().length);var l=i.getSelection();l.removeAllRanges(),l.addRange(n)},e.getSelectedText=function(){var t="",e=window,i=document;return e.getSelection?t=e.getSelection():i.getSelection?t=i.getSelection():i.selection&&(t=i.selection.createRange().text),t},e.getSelectedTextInfo=function(e){var i=t.$(e),o=i.text(),n=0,s=o.length,a="",r=window,l=document;if(r.getSelection){var h=r.getSelection();if(h&&h.rangeCount>0){a=""+h;for(var c=r.getSelection().getRangeAt(0),d=t.$(e+" span"),p=0,u=0;u<d.length;u++){var g=d.eq(u),m=g.text();m==c.startContainer.nodeValue&&(n=p+c.startOffset),m==c.endContainer.nodeValue&&(s=p+c.endOffset),p+=m.length}}}else l.getSelection?a=""+l.getSelection():l.selection&&(a=""+l.selection.createRange().text);return{text:""+h,startIndex:n,endIndex:s}},e.getText=function(e){var i=e.span,o=Object.prototype.toString.call(i),n="";if("[object Object]"===o)return t.utils.ObjectUtil.isEmpty(i.content)||(n=i.content.toString()),n;if("[object Array]"===o){for(var s=0;s<i.length;s++)n+=t.utils.ObjectUtil.isEmpty(i[s].content)?t.utils.ObjectUtil.isUndefined(i[s])?"":i[s].toString():i[s].content.toString();return n}return t.utils.ObjectUtil.isUndefined(i)?"":i.toString()},e.getBlockName=function(t){for(var e in t)if(e.indexOf("Block")>0)return e;return null},e.filterColor=function(t){return"#000"==t&&(t="#000000"),"#fff"==t&&(t="#ffffff"),t},e.setColorProductOption=function(i){i=e.filterColor(i),i=i.toUpperCase();var o=t.product.getActiveLayout().getFontSwatches(),n=null,s=0;for(s=0;s<o.length;s++)if(o[s]._rgbValue==i){n=o[s]._designerLabel.split("s_")[1];break}var a=t.productOptions.currentOptions;for(s=0;s<a.length;s++)if("INK_COLOR_OPTIONS"==a[s].key)for(var r=a[s].list,l=0;l<r.length;l++)if(r[l].label==n)return t.productOptions.currentOptions[s].selectedSku=r[l].sku,void(t.productOptions.selectedOptions[s]=r[l].sku)},e.getColorPalette=function(e){"undefined"==typeof e&&(e=!1);var i=[],o=[],n=t.product.getActiveLayout().getFontSwatches();e&&n.unshift({_rgbValue:t.utils.Constants.RESET_COLOR});for(var s=n.length+1,a=Math.round(n.length<9?3:n.length/8),r=1;s>r;r++)o.push(n[r-1]._rgbValue),r%a==0&&(i.push(o),o=[]);return o.length<a&&i.push(o),i},e}();e.HtmlUtil=a;var r=function(){function t(){}return t.create=function(){var t=function(){return Math.floor(65536*Math.random()).toString(16)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t}();e.GUID=r;var l=function(){function e(){}return e.createImagePageItem=function(){var e=t.product.getActiveLayout().getDefaultImageItem(),i=t.$.extend(!0,{},e);i._type="image",i._id=t.managers.InstanceManager.nextPageItemId();var o=t.$.extend(!0,{},i.ObjectBlock);return delete i.ObjectBlock,i.RasterBlock=o,i},e.getImageFilter=function(e,i){if(e==t.controls.Image.GRAY){var o=new createjs.ColorMatrixFilter([.33,.33,.33,0,0,.33,.33,.33,0,0,.33,.33,.33,0,0,0,0,0,1,0]);return i&&(o=new createjs.ColorMatrixFilter([.28,.58,0,.25,0,.28,.58,0,.25,0,.28,.58,0,.25,0,0,0,0,1,0])),[o]}if(e==t.controls.Image.SEPIA){var n=new createjs.ColorMatrixFilter([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.13,0,0,0,0,.6,1,0]);return[n]}return[]},e.getTintFilter=function(e,i){0==e.indexOf("#")&&(e=e.substring(1));var o,n=t.utils.ImageUtil.getImageFilter(t.controls.Image.GRAY,i)[0];o=1==i?t.utils.ImageUtil.getMatrixFromHexValue(e,!1):t.utils.ImageUtil.getMatrixFromHexValue(e,!0);var s=new createjs.ColorMatrixFilter(o);return[n,s]},e.getColorFilter=function(t){var e=[];for(0==t.indexOf("#")&&(t=t.substring(1));t.length>=2;)e.push(parseInt(t.substring(0,2),16)),t=t.substring(2,t.length);var i=e.length>0?e[0]:0,o=e.length>1?e[1]:0,n=e.length>2?e[2]:0,s=new createjs.ColorFilter(0,0,0,1,i,o,n,0);return[s]},e.getMatrixFromHexValue=function(t,e){"undefined"==typeof e&&(e=!0);var i=[];for(0==t.indexOf("#")&&(t=t.substring(1));t.length>=2;)i.push(parseInt(t.substring(0,2),16)),t=t.substring(2,t.length);var o=i.length>0?i[0]:0,n=i.length>1?i[1]:0,s=i.length>2?i[2]:0,a=o/255,r=n/255,l=s/255;return 1==e?[a,0,0,0,0,0,r,0,0,0,0,0,l,0,0,0,0,0,1,0]:[.8*a,.12,.12,.06,0,.12,.8*r,.12,.06,0,.12,.12,.8*l,.06,0,0,0,0,1,0]},e.getImageUrl=function(e,i){if("undefined"!=typeof e.VectorBlock){var o=i.getImageAsset(e.VectorBlock.Image._imageId);return t.config.getImageUrl(e.VectorBlock.Image._imageId)}if("undefined"!=typeof e.RasterBlock&&t.utils.ObjectUtil.isUndefined(e.RasterBlock.Image)&&"peep"==e._type)return t.config.uploadPeepIcon();if("undefined"!=typeof e.RasterBlock&&!t.utils.ObjectUtil.isEmpty(e.RasterBlock.Image._imageId)){var n=e.RasterBlock.Image._imageId,o=i.getImageAsset(n);if(null==o)return e.RasterBlock.Image._imageId="",null;var s=o.webFilename;return s.indexOf("/")>-1?s:null==t.config.productCode()?o.printFilename:t.config.getBaseImageUrl()+s}return"background"!=e._type&&"paperStock"!=e._type?null:null},e.getImageUrlForResolution=function(e,i,o){if("background"!=i)return e;var n=e.lastIndexOf("."),s=t.product.activeData,a=4*(s.width-s.bleedLeft+s.bleedRight)*4*(s.height-s.bleedTop+s.bleedBottom)/1024/1024;return"background"==i&&a>3&&t.isMobile()&&!o?e=e.slice(0,n)+"_low"+e.slice(n,e.length):"background"==i&&a>3&&!o&&(e=e.slice(0,n)+"_med"+e.slice(n,e.length)),e},e.createImageElement=function(e,i,o,n,s,a,r,l,h){"undefined"==typeof l&&(l=null),"undefined"==typeof h&&(h=null);var c=t.$.extend(!0,{},e);return c.hasOwnProperty("_colorTint")||(c._colorTint=""),c.hasOwnProperty("_colorizeFilter")||(c._colorizeFilter=""),c.hasOwnProperty("_copyable")||(c._copyable="true"),c.hasOwnProperty("_deletable")||(c._deletable="true"),c.hasOwnProperty("_flippable")||(c._flippable="true"),c.hasOwnProperty("_movable")||(c._movable="true"),c.hasOwnProperty("_rotatable")||(c._rotatable="true"),c.hasOwnProperty("_rotation")||(c._rotation=0),c.hasOwnProperty("_scalable")||(c._scalable="true"),c.hasOwnProperty("_selectable")||(c._selectable="true"),c.hasOwnProperty("_verticalScale")||(c._verticalScale="100"),r._xOffset=o,r._yOffset=n,r._width=s,r._height=a,c._imageId=i,c._xOffset=o,c._yOffset=n,null==l?(c._width=s,c._height=a):(c._width=l,c._height=h),void 0==c._rotation&&(c._rotation=0),0!=r._rotation&&(c._rotation=r._rotation),c},e}();e.ImageUtil=l;var h=function(){function e(){}return e.round=function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i},e.isEqual=function(t,e){return t._fontId==e._fontId&&t._fontSize==e._fontSize&&t._color==e._color&&t._lineHeight==e._lineHeight&&t._textAlign==e._textAlign&&t._tracking==e._tracking},e.getOriginalBackgroundPageItem=function(){for(var e=t.product.getActiveLayout().originalLayout.Template.pages.Page.PageItemBlock,i=e.length,o=0;i>o;o++)if("background"==e[o]._type)return e[o]},e.getOriginalImageAsset=function(e){var i=t.product.getActiveLayout().originalLayout.Template.imageAssets.ImageAsset;if(void 0==i||null==i)return null;for(var o=i.length,n=0;o>n;n++){var s=i[n];if(s._imageId==e){var a=t.model.ImageAsset.createFromSDXML(s);return a}}return null},e}();e.SdxmlUtil=h;var c=function(){function e(){}return e.normalizeDegrees=function(t){return 0>t?360+t:t>360?t%360:Math.floor(1e6*t)/1e6},e.handleSave=function(){t.config.isRegistered()?t.dialogs.displaySaveDialog():t.dialogs.displayUserDialog("save")},e.getBottomIndex=function(){for(var e=0,i=0;i<t.stage.getNumChildren();i++){var o=t.stage.getChildAt(i);"group"==o.type||"background"!=o.pageItemBlock._type&&"paperStock"!=o.pageItemBlock._type||e++}return e},e.getTopIndex=function(){for(var e=t.stage.getNumChildren()-1,i=0;i<t.stage.getNumChildren();i++){var o=t.stage.getChildAt(i);
"group"==o.type||"liveArea"!==o.pageItemBlock._type&&"constrainingRegion"!==o.pageItemBlock._type&&"overlay"!==o.pageItemBlock._layer||e--}return e},e.parseUserResponse=function(t){var e=t.split("&amp;"),i={};return e.length>1&&(i.profileId=e[0].split("profileId-")[1],i.profileId=i.profileId.split("\r").join("").split("\n").join(""),i.ugcPath=e[1].split("ugcPath-")[1],i.ugcPath=i.ugcPath.split("\r").join("").split("\n").join("")),i},e.callPageFunction=function(e){t.utils.HtmlUtil.setAskBeforeQuit(!1);var i=window;"redirectRegisteredUser"==e?i.redirectRegisteredUser():"redirectAnonymousUser"==e&&i.redirectAnonymousUser(),t.sessionClosed=!0},e.isLocalhost=function(){var t=window;return t.location.host.indexOf("localhost:9000")>-1},e.isWindiowOS=function(){return-1!==navigator.platform.toUpperCase().indexOf("WIN")},e.appendAuthToken=function(e){return t.utils.ObjectUtil.isUndefined(e)&&(e=""),e.indexOf("HCAuthToken")>0?e:t.utils.AppUtil.appendCacheBreak(e.indexOf("?")<0?e+"?HCAuthToken="+t.config.HCAuthToken():e+"&HCAuthToken="+t.config.HCAuthToken())},e.appendCacheBreak=function(t){if(t.indexOf("Random")>0)return t;var e=parseInt((1e4*Math.random()).toString(),10);return t.indexOf("?")<0?t+"?Random="+e.toString():t+"&Random="+e.toString()},e.getCurrentTimestamp=function(){var t=new Array("January","February","March","April","May","June","July","August","September","October","November","December"),e=new Date,i="PM";e.getHours()<12&&(i="AM");var o=e.getHours();return 0==o?o=12:o>12&&(o-=12),t[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()+" "+o+":"+e.getMinutes()+":"+e.getSeconds()+" "+i},e.setConfiguratorVersion=function(e){try{var i=e,o=t.$.trim(t.version.split("Revision:")[1].split("Node Kind:")[0]);if(""==i)return"NFC-"+o;var n=i.split("|");return n[n.length-1]=="NFC-"+o?i:i+"|NFC-"+o}catch(t){return e}},e.getSessionTimeoutMessage=function(){return"You will be logged out in "+t.sessionGracePeriod+" seconds.  Do you want to continue your session?"},e.checkImageUploadLimit=function(e){if(!t.config.isRegistered()&&e>=5){var i="You can upload up to 5 images when not signed in.  If you wish to add more than 5 images, please sign in or create an account.";return t.dialogs.displayError("Sign in to add more images",i),!1}return!0},e.roundPoint=function(t){return t.x=Math.round(t.x),t.y=Math.round(t.y),t},e}();e.AppUtil=c;var d=function(){function e(){}return e.replaceManifestFonts=function(e){var i=t.utils.FontReplaceUtils.replaceFontsInFontList(e,!0);return i},e.replaceLayoutFonts=function(e){var i=t.utils.FontReplaceUtils.replaceFontsInFontList(e,!1);return i=JSON.parse(t.utils.FontReplaceUtils.replaceFontsIds(JSON.stringify(i)))},e.replaceFontsInFontList=function(i,o){var n,s=i;n=t.utils.JsonUtil.getList(1==o?s.LayoutBookMap.fonts.Font:s.Template.fonts.Font);for(var a=t.fonts.replacementFonts.length,r=0;a>r;r++)for(var l=n.length,h=0;l>h;h++)if(t.fonts.replacementFonts[r].OriginalFamily==n[h]._fontFamily){t.replacedFontsMessageList.push(n[h]._fontFamily+" was replaced with "+t.fonts.replacementFonts[r].ReplacementFamily);var c;c=t.fonts.globalFontMap[t.fonts.replacementFonts[r].ReplacementFamily],t.fonts.replacementFonts[r].ReplacementFontId=c.variants[0].fontId,t.fonts.replacementFonts[r].OriginalFontIds=[];for(var d=t.utils.JsonUtil.getList(n[h].fontVariant).length,p=0;d>p;p++)t.fonts.replacementFonts[r].OriginalFontIds[p]=t.utils.JsonUtil.getList(n[h].fontVariant)[p]._fontId;var u=c.toJson();e.containsFontFamily(n,t.fonts.replacementFonts[r].ReplacementFamily)?delete n[h]:n[h]=u}return 1==o?s.LayoutBookMap.fonts.Font=n:s.Template.fonts.Font=n,s},e.containsFontFamily=function(t,e){for(var i,o=0;o<t.length;o++)if(e==t[o]._fontFamily){i=!0;break}return i},e.replaceFontsIds=function(e){for(var i=0;i<t.fonts.replacementFonts.length;i++)if(void 0!=t.fonts.replacementFonts[i].ReplacementFontId)for(var o='_fontId":"'+t.fonts.replacementFonts[i].ReplacementFontId+'"',n='_fontFamily":"'+t.fonts.replacementFonts[i].ReplacementFontId+'"',s=0;s<t.fonts.replacementFonts[i].OriginalFontIds.length;s++){var a='_fontId":"'+t.fonts.replacementFonts[i].OriginalFontIds[s]+'"',r='_fontFamily":"'+t.fonts.replacementFonts[i].OriginalFontIds[s]+'"';e=e.split(a).join(o),e=e.split(r).join(n)}return e},e}();e.FontReplaceUtils=d}(t.utils||(t.utils={}));t.utils}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){this.loadingErrors={},this.IMAGE_ERROR_RETRYS=3,this.setElement(t.$("#sidebar"),!0),this.sidebarTemplate=t._.template('<div class="accordion" id="asset-panel-accordion">    <div class="accordion-group" id="asset-panel-photos" style="display: none">        <div class="accordion-heading">            <a class="accordion-toggle VAlignHelper2" data-toggle="collapse" data-parent="#asset-panel-accordion" data-target="#ap-photos-body">                <span class="">Photos</span>            </a>        </div>        <div id="ap-photos-body" class="accordion-body collapse">            <div class="accordion-inner">                <a href="#" id="addImageButton" class="btn btn-primary-config VAlignHelper2">                    <span class="">add photos</span>                </a>                <p id="noPhotosFeedback" class="side-bar-feedback">You have not added any photos yet. Please click the button above to upload photos.</p>                <ul class="sidebar-img-thumb" id="myPhotos"></ul>            </div>        </div>    </div>    <div class="accordion-group" id="asset-panel-backgrounds" style="display: none">        <div class="accordion-heading">            <a class="accordion-toggle VAlignHelper2" data-toggle="collapse" data-parent="#asset-panel-accordion" data-target="#ap-backgrounds-body">                <span class="">Backgrounds</span>            </a>        </div>        <div id="ap-backgrounds-body" class="accordion-body collapse">            <div class="accordion-inner">                <a href="#" id="addBackgroundButton" class="btn btn-primary-config VAlignHelper2">                    <span class="">add photos</span>                </a>                <a href="#" id="delBackgroundButton" class="btn btn-primary-config VAlignHelper2">                    <span class="">reset background</span>                </a>                <div id="bboxbgColorContainer">                    <p>Background Color</p>                    <ul id="bboxColors" class="bg-color-swatch"></ul>                </div>                <div class="accordion" id="ap-backgrounds-accordion">                    <div class="accordion-group active">                        <div class="accordion-heading light">                            <a class="accordion-toggle accordion-subheader VAlignHelper2" data-toggle="collapse" data-target="#ap-backgrounds-mine">                                <span class="text no-select">My Images</span>                                <span class="img-counter" id="myBackgroundCount"></span>                                <span class="wrapper VAlignHelper2"><span class="sprite-inline sprite-icon_tab_arrow"></span></span>                            </a>                        </div>                        <div class="accordion-body collapse in" id="ap-backgrounds-mine">                            <ul class="sidebar-img-thumb" id="myBackgrounds"></ul>                        </div>                    </div>                    <div class="accordion-group active">                        <div class="accordion-heading light">                            <a class="accordion-toggle accordion-subheader VAlignHelper2" data-toggle="collapse" data-target="#ap-backgrounds-library">                                <span class="text no-select">Background Library</span>                                <span class="wrapper VAlignHelper2"><span class="sprite-inline sprite-icon_tab_arrow"></span></span>                            </a>                        </div>                        <div class="accordion-body collapse in" id="ap-backgrounds-library">                            <select id="bbBackgroundCategories">                                <option>-- Choose --</option>                            </select>                            <ul id="bboxbg_container" class="sidebar-img-thumb"></ul>                        </div>                    </div>                </div>            </div>        </div>    </div>    <div class="accordion-group" id="asset-panel-graphics" style="display: none">        <div class="accordion-heading">            <a class="accordion-toggle VAlignHelper2" data-toggle="collapse" data-parent="#asset-panel-accordion" data-target="#ap-graphics-body">                <span class="">Graphics</span>            </a>        </div>        <div id="ap-graphics-body" class="accordion-body collapse">            <div class="accordion-inner">                <select id="bbGraphics"></select>                <ul class="sidebar-img-thumb" id="bbimages"></ul>            </div>        </div>    </div>    <div class="accordion-group" id="asset-panel-layouts" style="display: none">        <div class="accordion-heading">            <a class="accordion-toggle VAlignHelper2" data-toggle="collapse" data-parent="#asset-panel-accordion" data-target="#ap-layouts-body">                <span class="">Layouts</span>            </a>        </div>        <div id="ap-layouts-body" class="accordion-body collapse">            <div class="accordion-inner">                <ul id="relatedProducts" class="sidebar-img-thumb"></ul>            </div>        </div>    </div>    <div class="accordion-group" id="asset-panel-peeps" style="display: none">        <div class="accordion-heading">            <a class="accordion-toggle VAlignHelper2" data-toggle="collapse" data-parent="#asset-panel-accordion" data-target="#ap-peeps-body">                <span class="">Peeps</span>            </a>        </div>        <div id="ap-peeps-body" class="accordion-body collapse">            <div class="accordion-inner">                <a href="#" id="addPeepButton" class="btn btn-primary-config VAlignHelper2">                    <span class="">create peeps family</span>                </a>                <p id="noPeepsFeedback" class="side-bar-feedback">You currently do not have any Peeps families. Get started by clicking on the &quot;create peeps family&quot; button above.</p>                <ul id="peeps-products" class="sidebar-img-thumb">                </ul>            </div>        </div>    </div></div>'),this.photoTemplate=t._.template('<li data-file-id="<%= fileId %>">    <a href="#" class="img-thumb">        <span class="VAlignHelper"></span>        <img id="<%= imagePrefix %><%= index %>" src="<%= imageUrl %>"             data-canvasurl="<%= previewImageUrl %>" data-file-id="<%= fileId %>" data-type="<%= type %>"             data-origwidth="<%= width %>" data-origheight="<%= height %>" class="photos" draggable="true"             data-userimage="<%= userImage %>" data-name="<%= name %>" data-id="<%= imagePrefix %><%= index %>" />        <span class="VAlignHelper"></span>    </a>    <a id="selected<%= imagePrefix %><%= index %>" href="#" class="sprite-inline sprite-icon_active selphoto" data-selected-file-id="<%= fileId %>" data-name="<%= name %>"></a>    <div class="thumb-img-control">        <a href="#" class="sprite-inline sprite-mobile_add addphoto" title="add image" id="add_<%= imagePrefix %><%= index %>" data-id="<%= imagePrefix %><%= index %>"></a>        <a href="#" class="sprite-inline sprite-icon_delete remphoto" id="remove<%= imagePrefix %><%= index %>" data-file-id="<%= fileId %>" title="delete" data-imgurl="<%= imageUrl %>"></a>        <a href="#" class="sprite-inline sprite-icon_zoom zoomphoto" id="zoom<%= imagePrefix %><%= index %>" title="zoom" data-userimage="<%= userImage %>" data-imgurl="<%= previewImageUrl %>"></a>    </div>    <div class="img-thumb-text"><%= name %></div></li>'),this.relatedTemplate=t._.template('<li>    <a href="#" class="img-thumb">        <img id="<%= imagePrefix %><%= index %>" src="<%= imageUrl %>" class="layout"/>    </a>    <div class="thumb-img-control" style="display:none;">        <!--<a href="#" class="tab-icon-delete-img remphoto" id="<%= filePrefix %><%= fileId %>" title="delete" style="display: none"></a>-->        <a href="#" class="tab-icon-zoom-img" title="zoom"></a>    </div></li>'),this.colorSwatchTemplate=t._.template('<li class=""><div id="swatch<%= index %>" class="swatch" data-rgb="<%= rgbValue %>"></div></li>'),this._currentTab="ap_menu_photo_tab",this.photoDialogShown=!1,this.events={"click #addImageButton":"onAddImageClick","click #addBackgroundButton":"onAddImageClick","click #addPeepButton":"onAddPeepClick","click .remphoto":"showRemoveImage","click .layout":"changeLayout","click .swatch":"changeColor","click #delBackgroundButton":"resetProductBackground","click .zoomphoto":"showLargeImage","click .icon-search":"doSearch","change #bbBackgroundCategories":"getBackgrounds","change #bbGraphics":"getGraphics","blur #graphicSearch":"doSearch","show #asset-panel-accordion":"accordionChanged","hide #asset-panel-accordion":"accordionChanged"};var o={};o=t.isMobile()?{"click .addphoto":"onThumbnailClick"}:{"dblclick #ap-photos-body .photos":"onThumbnailClick","dblclick #ap-graphics-body .photos":"onThumbnailClick","dblclick #ap-peeps-body .photos":"onThumbnailClick","mousedown .photos":"setInfo"},t.$.extend(this.events,o),t.events.on(t.events.LIBRARY_IMAGES_LOADED,this.updateImageCategories,this),t.events.on(t.events.USER_IMAGES_LOADED,this.loadUserImages,this),t.events.on("graphics_loaded",this.loadGraphics,this),t.events.on("backgrounds_loaded",this.loadBackgrounds,this),t.events.on(t.events.PRELOAD_GRAPHICS,this.getGraphics,this),t.events.on(t.events.PRELOAD_BACKGROUNDS,this.getBackgrounds,this),t.events.on(t.events.RELATED_PRODUCTS_LOADED,this.loadRelatedProducts),t.events.on(t.events.PRODUCT,this.updateUI,this),t.events.on(t.events.OPTIONS_LOADED,this.updateUI,this),t.events.on(t.events.IMAGE_COUNT_CHANGED,this.onImageCountChange,this),t.events.on(t.events.UPDATE_UI,this.onUpdateUIEvent,this),t.events.on(t.events.SEARCH_RESULTS_LOADED,this.loadSearchResults,this),t.events.on(t.events.REMOVE_IMAGE_DONE,this.removePhoto,this),t.events.on(t.events.UPDATE_ASSET_TABS,this.updateUI,this),t.events.on(t.events.RESET_DESIGN,this.resetDesign,this),t.events.on(t.events.PEEPS_UGC_LIST_LOADED,this.loadPeepImages,this),t.events.on(t.events.WINDOW_RESIZED,this.updateUI,this),t.events.on(t.events.COMPLETE,this.onComplete,this),t._.bindAll(this,"render"),e.call(this,i)}return __extends(i,e),i.prototype.render=function(){var e={},i=this.sidebarTemplate(e);return this.$el.html(i),t.isMobile()||t.utils.HtmlUtil.createTooltip("photosTab","These are your photos that can be added to a product","right"),this},i.prototype.getActiveGroup=function(){var e="",i=t.$("#asset-panel-accordion").find(".active");return i&&(e=i[0].id),e},i.prototype.accordionChanged=function(e){var i=t.$(e.target,this.$el),o=i.closest(".accordion-group"),n="show"===e.type?"addClass":"removeClass";o[n]("active"),"show"===e.type&&t.events.trigger(t.events.UNSELECT_BACKGROUND)},i.prototype.adjustAccordionHeights=function(){for(var e=t.$("#asset-panel-accordion",this.$el),i=e.find("> .accordion-group:visible > .accordion-heading"),o=e.find("> .accordion-group:visible > .accordion-body > .accordion-inner"),n=e.innerHeight(),s=0;s<i.length;s++){var a=i[s];n-=t.$(a).outerHeight(!0)}for(var s=0;s<o.length;s++){var a=o[s];t.$(a).css("height",n)}},i.prototype.adjustBackgroundAccordionHeight=function(){for(var e=t.$("#ap-backgrounds-body > .accordion-inner",this.$el),i=e.find("#ap-backgrounds-accordion"),o=e.innerHeight(),n=e.find("> a, > div:first"),s=0;s<n.length;s++){var a=n[s];o-=t.$(a).outerHeight(!0)}i.css("height",o)},i.prototype.showFirstAccordionGroup=function(){t.$("#asset-panel-accordion > .accordion-group > .accordion-body",this.$el).removeClass("in").css("height","0"),t.$("#asset-panel-accordion > .accordion-group",this.$el).removeClass("active"),t.$("#asset-panel-accordion > .accordion-group:visible:first > .accordion-body",this.$el).addClass("in").css("height","auto"),t.$("#asset-panel-accordion > .accordion-group:visible:first",this.$el).addClass("active")},i.prototype.getImageUrl=function(e){var i=t.config.getFile()+e;return i=t.utils.AppUtil.appendAuthToken(i)},i.prototype.getImagePreviewUrl=function(e){return t.utils.AppUtil.appendAuthToken(e)},i.prototype.getTemplateParameters=function(t,e,i,o){var n=!t.hasOwnProperty("_name"),s='bbox.log("'+(n?"Image":"Graphic")+'loading error!")',a={fileId:n?t.fileId:t._name,imagePrefix:i,index:e,imageUrl:n?this.getImageUrl(t.thumbnailImageURL):t.thumbnailURL,name:n?"":t._name.replace("_"," "),previewImageUrl:n?this.getImagePreviewUrl(t.previewImageURL):t.previewURL,userImage:n,width:t.width,height:t.height,type:o,onError:s};return a},i.prototype.toggleSelected=function(e,i){"undefined"==typeof i&&(i=!1);var o=t.app.views.canvasView.isImageOnCanvas(e.data("fileId")),n=e.find("a.sprite-icon_active");return n[o&&!i?"show":"hide"]().end()},i.prototype.toggleMobileAdd=function(e,i){"undefined"==typeof i&&(i=!1);var o=t.isMobile();return e.find("a.sprite-mobile_add")[o&&!i?"show":"hide"]().end()},i.prototype.toggleName=function(e,i){"undefined"==typeof i&&(i=!1);var o=!t.isMobile()&&"graphic"===e.data("type");return e.find("div.img-thumb-text")[o&&!i?"show":"hide"]().end()},i.prototype.toggleRemove=function(t,e){"undefined"==typeof e&&(e=!1);var i=t.find("img").data("userimage");return t.find("a.remphoto")[i&&!e?"show":"hide"]().end()},i.prototype.processNewImage=function(e,i,o,n,s,a){"undefined"==typeof a&&(a={});var r=this.getTemplateParameters(i,e,n,s),l=this.photoTemplate(r),h=t.$(l);h=this.toggleSelected(h,a.hide_selected||!1),h=this.toggleMobileAdd(h,a.hide_mobileAdd||!1),h=this.toggleName(h,a.hide_name||!1),h=this.toggleRemove(h,a.hide_remove||!1),o.append(h)},i.prototype.buildThumbNailControl=function(e,i,o,n,s){"undefined"==typeof s&&(s={});var a=this.getTemplateParameters(i,e,o,n),r=this.photoTemplate(a),l=t.$(r);return l=this.toggleSelected(l,s.hide_selected||!1),l=this.toggleMobileAdd(l,s.hide_mobileAdd||!1),l=this.toggleName(l,s.hide_name||!1),l=this.toggleRemove(l,s.hide_remove||!1)},i.prototype.loadUserImages=function(){var e=t.$("#myPhotos",t.$(this.$el)),i=t.$("#myBackgrounds",t.$(this.$el)),o=[],n=[];e.empty(),i.off("click","img"),i.empty(),this.setImageCount();for(var s=0;s<t.app.userImages.length;s++){var a=t.app.userImages[s];a.hasOwnProperty("errorCode")||t.utils.ObjectUtil.notUndefined(a.code)&&"E"==a.code.charAt(0)||(n.push(this.buildThumbNailControl(s,a,"photo","image")),o.push(this.buildThumbNailControl(s,a,"bgPhoto","background")))}t.$(e).append(n),t.$(i).append(o),i.on("click","img",this.onThumbnailClick)},i.prototype.loadPeepImages=function(){var e=t.$("#peeps-products",this.$el),i=t.$("#noPeepsFeedback",this.$el),o=e.find("#myPeepsCount");e.off("click","img").empty();for(var n=0;n<t.app.userPeepImages.length;n++){var s=t.app.userPeepImages[n];if(!(s.hasOwnProperty("errorCode")||t.utils.ObjectUtil.notUndefined(s.code)&&"E"==s.code.charAt(0))){var a={hide_remove:!0};this.processNewImage(n,s,e,"peep","peep",a)}}o.html("("+e.children("li").length+")"),e.off("click","img"),i[e.children().length>0?"hide":"show"]()},i.prototype.loadGraphics=function(e){var i=t.$("#bbimages",t.$(this.$el));if(t.app.currentGraphics=t.utils.JsonUtil.getList(e.image),i.empty(),void 0==e.image.length&&e.image)return void this.processNewImage(0,e.image,i,"graphic","graphic");for(var o=0;o<e.image.length;o++)this.processNewImage(o,e.image[o],i,"graphic","graphic")},i.prototype.loadBackgrounds=function(e){var i=t.$("#bboxbg_container",t.$(this.$el));t.app.currentBackgrounds=t.utils.JsonUtil.getList(e.image),i.off("click","img");for(var o=0;o<e.image.length;o++)this.processNewImage(o,e.image[o],i,"background","background");i.on("click","img",this.onThumbnailClick)},i.prototype.loadSearchResults=function(){var e=t.$("#bbimages",t.$(this.$el)).empty();t.$("#bbBackgroundCategories").val(0);for(var i=0;i<t.app.searchResults.length;i++)this.processNewImage(i,t.app.searchResults[i],e,"searchImg","graphic")},i.prototype.checkForBackgroundSwatches=function(){for(var e=t.$("#bboxbgColorContainer",this.$el),i=t.$("#bboxColors",e).empty(),o=t.product.getActiveLayout().swatches,n=0;n<o.length;n++){var s=o[n];if(/b_/.test(s._designerLabel)){var a=this.colorSwatchTemplate({index:n,rgbValue:s._rgbValue}),r=t.$(a).find("div").css("background-color",s._rgbValue).end();i.append(r)}}var l=i.children().length>0;e[l?"show":"hide"](),this.adjustBackgroundAccordionHeight()},i.prototype.resetDesign=function(){t.events.trigger(t.events.HISTORY_TRANSACTION_INIT),t.events.trigger(t.events.PRODUCT_CHANGED_BY_USER,!1),t.$("#sidebar [data-selected-file-id]").each(function(e,i){t.$(i).hide()}),this.updateUI(),this.photoDialogShown=!1,this.showInitialDialog()},i.prototype.changeTab=function(t){this._currentTab=t.target.id,"ap_menu_background_tab"!=this._currentTab},i.prototype.currentTab=function(){return this._currentTab},i.prototype.setInfo=function(e){var i=e.target.id;i.split("add_").length>1&&(i=i.split("add_")[1]),t.dragObj={},t.dragObj.width=t.utils.Constants.DEFAULT_IMAGE_HEIGHT,t.dragObj.height=t.utils.Constants.DEFAULT_IMAGE_HEIGHT,t.dragObj.offsetX=t.utils.ObjectUtil.isUndefined(e.originalEvent.offsetX)?0:e.originalEvent.offsetX,t.dragObj.offsetY=t.utils.ObjectUtil.isUndefined(e.originalEvent.offsetY)?0:e.originalEvent.offsetY,t.dragObj.elementId=i},i.prototype.onThumbnailClick=function(e){e.preventDefault(),t.selections.clear();var i=t.app.views.assetPanelView;t.isMobile()?i.handleThumbnailClickMobile(e):i.handleThumbnailClick(e)},i.prototype.handleThumbnailClick=function(e){t.events.trigger(t.events.ON_DROP_ADD_IMAGE,e,!0)},i.prototype.handleThumbnailClickMobile=function(e){this.setInfo(e),t.events.trigger(t.events.ON_DROP_ADD_IMAGE,e,!0)},i.prototype.updateUI=function(){var e=!1;if(t.product){t.$("#asset-panel-layouts",this.$el)[t.ui.isLayoutsTabEnabled()?"hide":"hide"](),t.$("#asset-panel-backgrounds",this.$el)[t.ui.isBackgroundTabEnabled()?"show":"hide"](),t.$("#asset-panel-graphics",this.$el)[t.ui.isGraphicsTabEnabled()?"show":"hide"](),t.$("#asset-panel-photos",this.$el)[t.ui.isPhotoTabEnabled()?"show":"hide"](),t.$("#asset-panel-peeps",this.$el)[t.ui.isPeepsTabEnabled()?"show":"hide"]();for(var i=t.$("#asset-panel-accordion > .accordion-group"),o=!1,n=0;n<i.length;n++){var s=t.$(i[n]);if("none"!==s.css("display")){o=!0;break}}o=!t.inPreviewMode&&o,e=this.$el.is(":visible")!==o,this.$el[o?"show":"hide"](),this.adjustAccordionHeights(),this.showFirstAccordionGroup(),e===!0&&t.events.trigger(t.events.WINDOW_RESIZE),this.checkForBackgroundSwatches()}},i.prototype.onUpdateUIEvent=function(){t.ui.maxImagesReached()?t.$("#maxLimitContainer").show():t.$("#maxLimitContainer").hide(),t.ui.isAddImageEnabled(!0)?t.$("#addImageButton").removeClass("disabled"):t.$("#addImageButton").addClass("disabled")},i.prototype.onComplete=function(){this.showInitialDialog()},i.prototype.showInitialDialog=function(e){var i=this;if("undefined"==typeof e&&(e=!1),!this.photoDialogShown&&(t.ui.isPhotoTabEnabled()||t.ui.isBackgroundTabEnabled())&&this.hasEmptyPhotoContainer())if(t.app.userImages){if(e)t.dialogs.displayUploadDialog();else var o=setTimeout(function(){t.dialogs.displayUploadDialog(),clearTimeout(o)},500);this.photoDialogShown=!0}else var n=setTimeout(function(){i.showInitialDialog(!0),clearTimeout(n)},500);else this.photoDialogShown=!0},i.prototype.hasEmptyPhotoContainer=function(){for(var e=0;e<t.product.layouts[0].pageItems.length;e++){var i=t.product.layouts[0].pageItems[e],o=t.utils.HtmlUtil.getBlockName(i);if("image"===i._type&&o&&i[o].Image&&""===i[o].Image._imageId)return!0}return!1},i.prototype.onImageCountChange=function(){},i.prototype.onAddImageClick=function(e){e.preventDefault(),t.dialogs.displayUploadDialog()},i.prototype.onAddPeepClick=function(){t.app.userPeepImages.length<t.peepsManager.peepsMaximum?t.app.views.dialogs.peepsEditor.setEditorMode("create"):t.dialogs.displayDialog("Maximum Peep Families Reached","You have reached the limit of "+t.peepsManager.peepsMaximum+" Peep families. Please remove the appropriate number of Peeps to create additional families.")},i.prototype.getBackgrounds=function(){var e=t.$("#bbBackgroundCategories").val();t.$("#bboxbg_container").empty(),t.imageManager.getGraphics(e,"backgrounds_loaded")},i.prototype.getGraphics=function(){var e=t.$("#bbGraphics").val();t.$("#bbimages").empty(),t.imageManager.getGraphics(e,"graphics_loaded")},i.prototype.onPeepLoadingError=function(e,i){var o;e.toString()in this.loadingErrors?(o=this.loadingErrors[e],o.errorCount++):(o={},o.errorCount=1,o.timeout=0,this.loadingErrors[e]=o),o.errorCount<=this.IMAGE_ERROR_RETRYS?o.timeout=setTimeout(t._.bind(this.tryPeepImageReload,this,e,i),750*o.errorCount):delete this.loadingErrors[e]},i.prototype.tryPeepImageReload=function(e,i){t.$("#peep"+e).attr("src",i),clearTimeout(this.loadingErrors[e])},i.prototype.loadRelatedProducts=function(){},i.prototype.displayRelatedProduct=function(){},i.prototype.updateImageCategories=function(){if(t.app.imageLibrary&&t.app.imageLibrary.hasImageCategories()){t.$("#graphicsTab").show();var e=t.app.imageLibrary.getImageCategories();t.utils.HtmlUtil.resetComboBox("#bbGraphics"),t.$.each(e,function(e,i){t.$("#bbGraphics").append('<option value="'+i._webserverPath+'">'+i._categoryDisplayName+"</option>"),0==e&&(t.$("#bbGraphics").val(i._webserverPath),t.events.trigger(t.events.PRELOAD_GRAPHICS))})}else t.$("#graphicsTab").hide();if(t.app.imageLibrary&&t.app.imageLibrary.hasBackgroundCategories()){t.$("#bigBoxBackgroundsHeader").show();var i=t.app.imageLibrary.getBackgroundCategories();t.utils.HtmlUtil.resetComboBox("#bbBackgroundCategories"),t.$.each(i,function(e,i){t.$("#bbBackgroundCategories").append('<option value="'+i._webserverPath+'">'+i._categoryDisplayName+"</option>"),0==e&&(t.$("#bbBackgroundCategories").val(i._webserverPath),t.events.trigger(t.events.PRELOAD_BACKGROUNDS))})}else t.$("#bigBoxBackgroundsHeader").hide();this.updateUI()},i.prototype.showRemoveImage=function(e){t.dialogs.displayRemoveImageDialog(e)},i.prototype.removePhoto=function(e){var i=t.$(e.currentTarget).attr("data-file-id");if(t.app.views.canvasView.isImageOnCanvas(i))for(var o=t.app.views.canvasView.getImages(i),n=0;n<o.length;n++)o[n].removeBitmap(!1);t.product.removeImageReferences(i);var s="/myImages";e.currentTarget.id.indexOf("removepeep")>-1&&(s="/peepImages");var a={userId:t.config.profileID()+s,ugcPath:t.config.ugcPath(),fileId:i};t.$('li[data-file-id="'+i+'"]').remove(),t.imageManager.removeImage(i),this.setImageCount(),t.events.trigger(t.events.USER_IMAGE_REMOVED,a),t.ui.imageDeleted()},i.prototype.changeLayout=function(e){t.services.loadNewProduct(t.$("#"+e.currentTarget.id).attr("productCode"))},i.prototype.doSearch=function(){var e={productCode:t.config.productCode(),keyword:t.$("#graphicSearch").val(),libraryType:"images"};t.events.trigger(t.events.KEYWORD_SEARCH,e)},i.prototype.resetProductBackground=function(e){e.preventDefault(),t.$("#backgroundLib [data-selected-file-id]:visible").each(function(e,i){t.$(i).hide()}),t.events.trigger(t.events.RESET_BACKGROUND,e)},i.prototype.changeColor=function(e){t.events.trigger(t.events.CHANGE_BACKGROUND_COLOR,t.$("#"+e.target.id).data("rgb"))},i.prototype.showLargeImage=function(e){var i=e.target;t.dialogs.displayImageZoom(i)},i.prototype.setImageCount=function(){t.app.userImages.length>0&&(t.$("#noPhotosFeedback").hide(),t.$("#myBackgroundCount").html("("+t.app.userImages.length+")"))},i}(Backbone.View);e.AssetPanelView=i}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){this.inDragMode=!1,this.setElement(t.$("#canvas"),!0),this.events={"dragover #appCanvas":"stage_dragover","drop #appCanvas":"onDrop"},t._.bindAll(this,"render"),e.call(this,i),this.editTabMap={},t.events.on(t.events.ADD_TEXT,this.addText,this),t.events.on(t.events.IMAGE_UPLOADED,this.addImageToStageByElementId,this),t.events.on(t.events.ADD_IMAGES,this.addImages,this),t.events.on(t.events.ADD_IMAGE_CONTAINER,this.addImageContainer,this),t.events.on(t.events.RESET_DESIGN,this.reset,this),t.events.on(t.events.PRODUCT,this.loadProduct,this),t.events.on(t.events.SWITCH_CURRENT_LAYOUT,this.loadLayout,this),t.events.on(t.events.ON_DROP_ADD_IMAGE,this.onImageDoubleClick,this),t.events.on(t.events.SCENE_VISIBILITY_CHANGED,this.adjustCanvasHeight,this),t.events.on(t.events.LOAD_LAYOUT_FAILED,this.loadLayoutFailed,this)}return __extends(i,e),i.prototype.loadProduct=function(){this.loadLayout(t.product.activeLayout)},i.prototype.loadLayout=function(e){if(t.selections.clear(),t.hideZoomNav(),null!=t.savedUserLocation&&(e=t.savedUserLocation.activeLayout,t.savedUserLocation=null),t.product.setActiveLayout(e)){var i=t.stage.getNumChildren();for(i;i>0;i--){var o=t.stage.getChildAt(i-1);o.cleanUpYourMess()}t.stage.removeAllChildren(),t.initLayout(),t.imageManager.reset();var n,s,a=t.product.getActiveLayout();t.managers.InstanceManager.clean();var r,o,l,h,c,d,p=null;if(this.editTabMap[e])d=this.editTabMap[e].imageIdToCheck,l=this.editTabMap[e].photoBounds,h=this.editTabMap[e].checkBounds,c=this.editTabMap[e].overlapped;else{for(var u=-1,g=0;g<t.stageRoot.children.length;g++){var m=t.stageRoot.children[g];m instanceof t.controls.EditTab&&(u=g)}u>=0&&t.stageRoot.removeChildAt(u)}for(i=0;i<a.pageItems.length;i++)if(r=a.pageItems[i],"liveArea"===r._type)n=r;else if("overlay"===r._layer)s=r;else if(o=t.controls.ComponentFactory.create(r,a),null!=o){if(t.stage.addChild(o),o.ui&&o.ui.render(),d||p&&!c&&"true"===r._selectable){var f=o.localToLocal(0,0,o.parent),v=new t.model.PointCollection(new t.model.Point(f.x,f.y),new t.model.Point(f.x+o.width,f.y),new t.model.Point(f.x+o.width,f.y+o.height),new t.model.Point(f.x,f.y+o.height));c=t.utils.GeometryUtil.PointCollectionsOverlap(l,v)}if(!p&&"image"===r._type&&"true"===r._selectable){p=o;var y=Math.min(75,p.width/2),I=Math.min(50,p.height/2);h={trP:{x:p.regX-y,y:p.regY-I},tlP:{x:p.regX+I,y:p.regY-I},blP:{x:p.regX+I,y:p.regY+I},brP:{x:p.regX-I,y:p.regY+I}},l=new t.model.PointCollection(new t.model.Point(h.trP.x,h.trP.y),new t.model.Point(h.tlP.x,h.tlP.y),new t.model.Point(h.blP.x,h.blP.y),new t.model.Point(h.brP.x,h.brP.y))}}if(d||p&&c){d=d||p.pageItemBlock._id;var b=new t.controls.EditTab(d);t.stageRoot.addChild(b),b.render(),this.editTabMap[e]||(this.editTabMap[e]={photoBounds:l,checkBounds:h,overlapped:c,imageIdToCheck:d})}if(s&&(o=t.controls.ComponentFactory.create(s,a),o&&t.stage.addChild(o)),n&&(o=t.controls.ComponentFactory.create(n,a),o&&t.stage.addChild(o)),t.inPreviewMode)for(var i=t.stage.getNumChildren();i>0;i--){var _=t.stage.getChildAt(i-1),C=_;C.unselect(),C.preview()}t.events.trigger(t.events.HISTORY_TRANSACTION_CHECK),a.loaded=!0,t.utils.HtmlUtil.sendCatalystEvent(42,"Load Complete"),t.resetZoomLevel(),t.utils.Stage.center(),t.events.trigger(t.events.WINDOW_RESIZE)}},i.prototype.loadLayoutFailed=function(e){"undefined"==typeof e&&(e={}),e.message&&t.dialogs.displayError('<i class="sprite sprite-inline sprite-icon_validation"></i> Error Loading Product!',e.message+"\n Please refresh the browser."),t.$("#toolbar .draggable-toolbar").hide(),t.$("#zoomControls").hide(),t.hideLoading(),window.askBeforeQuit=!1},i.prototype.adjustCanvasHeight=function(e){if(t.product.manifest.isMultiScene&&e){var i=t.$("#toolbar"),o=t.$("#sidebar"),n=t.$("#appCanvas"),s=t.$(".right-side-container"),a=n.height(),r=s.innerHeight()-i.outerHeight();a!==r&&(n.css("height",r),o.css("height",r),t.events.trigger(t.events.WINDOW_RESIZE))}},i.prototype.isImageOnCanvas=function(e){for(var i=t.stage.getNumChildren();i>0;i--){var o=t.stage.getChildAt(i-1);if("bbox.controls.Image"==o.type){var n=o;if(n.imageId===e||n.imageId&&n.imageId.indexOf(e)>-1)return!0}else if("bbox.controls.Background"==o.type){var s=o;
if("backgroundImage"in s&&null!=s.backgroundImage&&s.backgroundImage.imageId&&s.backgroundImage.imageId.indexOf(e)>-1)return!0}}return!1},i.prototype.getImages=function(e){for(var i=[],o=t.stage.getNumChildren();o>0;o--){var n=t.stage.getChildAt(o-1);if("bbox.controls.Image"==n.type||"bbox.controls.Peep"==n.type){var s=n;(s.imageId==e||s.imageId&&s.imageId.indexOf(e)>-1)&&i.push(s)}else if("bbox.controls.Background"==n.type){var a=n;"backgroundImage"in a&&null!=a.backgroundImage&&a.backgroundImage.imageId&&a.backgroundImage.imageId.indexOf(e)>-1&&i.push(a.backgroundImage)}}return i},i.prototype.isProductValid=function(){for(var e=0;e<t.stage.getNumChildren();e++){var i=t.stage.getChildAt(e);if(!i.isValid())return!1}return!0},i.prototype.save=function(){t.product.getActiveLayout().clear();for(var e=0;e<t.stage.getNumChildren();e++){var i=t.stage.getChildAt(e);i.save()}},i.prototype.render=function(){t.log(" > CanvasView.render()");return t.stageRoot=new createjs.Stage(t.canvas),createjs.Touch.enable(t.stageRoot),t.stageRoot.enableMouseOver(30),t.stageRoot.addEventListener("mousedown",t._.bind(this.stage_mousedown,this)),t.stageRoot.addEventListener("pressmove",t._.bind(this.stage_pressmove,this)),t.stageRoot.addEventListener("pressup",t._.bind(this.stage_pressup,this)),t.stageBackground=new createjs.Shape,t.stageRoot.addChild(t.stageBackground),t.stageDebug=new createjs.Text,t.stageDebug.isValid=function(){return!0},t.stageDebug.x=0,t.stageDebug.y=3,t.stageDebug.font="10px Arial",t.stageDebug.color="#FFFFFF",t.stageDebug.text=t.version.split("Revision:")[1].split("Node Kind:")[0],t.stageRoot.addChild(t.stageDebug),t.stageZoom=new createjs.Container,t.stageRoot.addChild(t.stageZoom),t.shadowElement=new createjs.Shape,t.shadowElement.shadow=new createjs.Shadow("#A0A0A0",8,8,10),t.stageZoom.addChild(t.shadowElement),t.stage=new createjs.Container,t.stage.mask=new createjs.Shape,t.stageZoom.addChild(t.stage),t.bounds=new t.controls.Bounds,t.stage.addChild(t.bounds),t.updateStage(),this},i.prototype.stage_mousedown=function(e){t.ping(),this.origin={},this.origin.stageX=e.stageX,this.origin.stageY=e.stageY,t.events.trigger(t.events.ZOOM_UPDATE_IMAGE)},i.prototype.stage_pressmove=function(t){null!=this.origin&&(window.scrollBy(this.origin.stageX-t.stageX,this.origin.stageY-t.stageY),this.origin.stageX=t.stageX+this.origin.stageX-t.stageX,this.origin.stageY=t.stageY+this.origin.stageY-t.stageY)},i.prototype.stage_pressup=function(e){null!=this.origin&&window.scrollBy(this.origin.stageX-e.stageX,this.origin.stageY-e.stageY),t.selections.clear()},i.prototype.stage_dragover=function(t){t.preventDefault(),t.stopPropagation()},i.prototype.canvas_click=function(){t.$("#previewButton").popover("hide")},i.prototype.checkForImageSwap=function(e,i,o){return null!=t.uploadImageTarget?(t.uploadImageTarget.swapImage(e,i,o),t.uploadImageTarget=null,!0):this.doActiveControlImageSwap(e,i,o)},i.prototype.doActiveControlImageSwap=function(e,i,o,n){"undefined"==typeof n&&(n=!1);for(var s=t.stage.getNumChildren();s>0;s--){var a=t.stage.getChildAt(s-1);if(a.selected&&"bbox.controls.Image"==a.type){var r=a;return n&&r.isEmpty?r.swapImage(e,i,o):r.swapImage(e,i,o),t.isEdit=!1,!0}}return!1},i.prototype.getStageDropWH=function(e,i,o,n){var s=e/o;i=n*s;var a=t.product.getWidth(),r=t.product.getHeight();return e>a/3&&(e=.5*e,i=.5*i),i>r/3&&(e=.5*e,i=.5*i),a/10>e&&(e=2*e,i=2*i),r/10>i&&(e=2*e,i=2*i),{width:e,height:i,scale:s,canvasScale:1/t.stageZoom.scaleX,widthDriving:!0}},i.prototype.getStageDropWH2=function(e,i,o,n){var s=e/o,a=i/n,r=s>=a,l=r?s:a;r?i=n*l:e=o*l;var h=1/t.stageZoom.scaleX,c=t.product.getWidth(),d=t.product.getHeight();return e>c/3&&(e=.5*e,i=.5*i),i>d/3&&(e=.5*e,i=.5*i),c/10>e&&(e=2*e,i=2*i),d/10>i&&(e=2*e,i=2*i),{width:e,height:i,scale:l,canvasScale:h,widthDriving:r}},i.prototype.onDrop=function(e){if(e.preventDefault(),t.dragObj||t.dragObj.elementId){var i,o,n=t.dragObj.elementId,s=1/t.stageZoom.scaleX,a=t.dragObj.width,r=t.dragObj.height,l=(t.dragObj.offsetX,t.dragObj.offsetY,t.editorManager.$canvas.position()),h=!1;null!=window.mozInnerScreenX?(h=!0,i=(e.originalEvent.pageX-l.left-t.stageZoom.x)*s,o=(e.originalEvent.pageY-l.top-80-t.stageZoom.y)*s):(i=(e.originalEvent.pageX-l.left-t.stageZoom.x)*s,o=(e.originalEvent.pageY-l.top-130-t.stageZoom.y)*s);var c=t.stage.globalToLocal(e.originalEvent.layerX,e.originalEvent.layerY),d=c.x,p=c.y;h&&(d=i,p=o),this.addImageToStage(n,d,p,a,r),t.dragObj.elementId=null}},i.prototype.addImageToStage=function(e,i,o,n,s){var a=t.$("#"+e),r=this.getImageAsset(a),l=parseFloat(a.data("origwidth"));isNaN(l)&&(l=1);var h=parseFloat(a.data("origheight"));isNaN(h)&&(h=1);var c,d,p=a.data("fileId");if(t.isMobile())if(t.editorManager.active)c=t.editorManager.active.control,d=c.type,i=c.x,o=c.y;else for(var u=0;u<t.stage.children.length;u++)c=t.stage.children[u],c.isEmpty&&("bbox.controls.Image"==c.type&&!r.isPeep||"bbox.controls.Peep"==c.type&&r.isPeep)&&(i=c.x,o=c.y);var g=this.hitTestImageControls(i,o);if(g||(g=t.stage.getObjectUnderPoint(i,o)),null!=g){for(;;){if(g==t.stage||"bbox.controls.Image"==g.type||"bbox.controls.Peep"==g.type)break;g=g.parent}if("bbox.controls.Peep"==g.type&&r.isPeep)return void g.swapImage(r,l,h);if("bbox.controls.Image"==g.type&&!r.isPeep&&(g.isEdit()||g.isEmpty))return void g.swapImage(r,l,h)}var m="background"===a.data("type");if(t.ui.maxImagesReached()&&-1===String(e).search("background")&&!m){var f="You have reached the limit for images that can be added to a product.  Please delete an image from the stage before adding more.";return void t.dialogs.displayError("Warning",f)}if(!m||!this.swapBackground(r,l,h)){if(0==t.product.getActiveLayout().isAddImageContainerEnabled)return void t.dialogs.displayDialog("Unable to add images","This product does not allow images to be dropped on the canvas. Please use the containers provided.");s=n*h/l;var v=t.product.getWidth(),y=t.product.getHeight();n>v/3&&(n=.5*n,s=.5*s),s>y/3&&(n=.5*n,s=.5*s),v/10>n&&(n=2*n,s=2*s),y/10>s&&(n=2*n,s=2*s);var I;I="graphic"===a.data("type")?t.controls.ComponentFactory.createNewImage(i-n/2,o-s/2,n,s,r,l,h,!0):t.controls.ComponentFactory.createNewImage(i-n/2,o-s/2,n,s,r,l,h),t.stage.addChildAt(I,this.getStageIndex()),t.selections.select(I,!0);var b=I.testHandles();I.handleBoundsError(b,I),this.addUndoRedoAction(I),t.updateStage(),t.events.trigger(t.events.IMAGE_ADDED,p)}},i.prototype.hitTestImageControls=function(e,i){var o,n,s,a,r=t.stage.getNumChildren(),l=r-1;for(l;l>=0;l--)if(o=t.stage.getChildAt(l),("bbox.controls.Image"==o.type||"bbox.controls.Peep"==o.type)&&o.getSelectable()&&(n=this.getDisplayObject(0,0,o.width,o.height,o.rotation),o.addChild(n),a=t.stage.localToLocal(e,i,o),s=o.hitTest(a.x-o.regX,a.y-o.regY),o.removeChild(n),s))return o;return null},i.prototype.getDisplayObject=function(t,e,i,o,n,s){"undefined"==typeof s&&(s="#ff0000");var a=new createjs.Shape;return a.graphics.beginFill(s).drawRect(0,0,i,o),a.x=t,a.y=e,a.regX=i/2,a.regY=o/2,a.rotation=n,a},i.prototype.onDragOver=function(t){t.preventDefault(),t.stopPropagation()},i.prototype.onMouseDown=function(t){},i.prototype.addExistingText=function(e,i){var o=t.product.getActiveLayout();o.addPageItem(e.pageItemBlock),t.stage.addChildAt(e,i),this.setInitialContainerBounds(e)},i.prototype.addText=function(){var e=t.product.getActiveLayout(),i=e.getDefaultTextItem(),o=t.$.extend(!0,{},i);o._id=t.utils.GUID.create(),o._defaultText="Add new Text",o._type="text",e.addPageItem(o);var n=!0,s=new t.controls.CompositeText(o,e,n);t.stage.addChildAt(s,this.getStageIndex()),this.setInitialContainerBounds(s);var a=t.stage.getChildIndex(s),r=s.pageItemBlock,l=[s.getHistoryTransactionState()],h=new t.actions.ContainerCreateDeleteAction({action:"remove",index:-1},{action:"add",index:a,orgPostion:l},r);return t.actionManager.addAction(h),t.events.trigger(t.events.STAGE_LOCK_CHANGED,!1),t.events.trigger(t.events.PRODUCT_PERSONALIZED),s},i.prototype.addExistingImage=function(e){t.stage.addChildAt(e,this.getStageIndex());var i=t.product.getActiveLayout();i.addPageItem(e.pageItemBlock),t.selections.select(e,!0),t.updateStage()},i.prototype.addImageContainer=function(){if(t.product.getActiveLayout().isAddImageContainerEnabled){var e=t.product.getActiveLayout(),i=e.getDefaultImageItem();if(null!=i){var o=t.$.extend(!0,{},i);o._id=t.utils.GUID.create(),o._type="image",e.addPageItem(o);var n=new t.controls.Image(o,e);n.isEmpty=!0,n.imageAsset=null,n.imageId=null,n.visible=!0,t.stage.addChildAt(n,this.getStageIndex());var s=n.testHandles();n.x=(s.reb-s.leb)/2,n.y=(s.beb-s.teb)/2,n.handleBoundsError(s,n),n.select(),this.addUndoRedoAction(n),t.updateStage()}}},i.prototype.addUndoRedoAction=function(e){var i=t.stage.getChildIndex(e),o=[];o.push(e.getHistoryTransactionState());var n=[{imageAsset:e.imageAsset,colorId:e.colorId}],s=new t.actions.ContainerCreateDeleteAction({action:"remove",index:-1},{action:"add",index:i,orgPostion:o,imageAsset:n},e.pageItemBlock);t.actionManager.addAction(s),t.updateStage()},i.prototype.addImages=function(e){var i=e.length;if(1==i)return void this.addImageToStageByElementId(e[0]);for(var o=0;i>o;o++){if(t.ui.maxImagesReached()){var n="You have reached the limit for images that can be added to a product.  Please delete an image from the stage before adding more.";return void t.dialogs.displayError("Warning",n)}this.addImage(o==i-1?e[o]:e[o])}},i.prototype.addImageToStageByElementId=function(e){var i=t.$("#"+e),o=parseFloat(i.data("origwidth")),n=parseFloat(i.data("origheight")),s=this.getImageAsset(i);this.checkForImageSwap(s,o,n)||this.addImage(e)},i.prototype.addImage=function(e,i,o){"undefined"==typeof i&&(i=t.utils.Constants.DEFAULT_IMAGE_WIDTH),"undefined"==typeof o&&(o=t.utils.Constants.DEFAULT_IMAGE_HEIGHT);var n=t.product.getWidth(),s=t.product.getHeight(),a=n/2,r=s/2;this.addImageToStage(e,a,r,i,o)},i.prototype.onImageDoubleClick=function(){this.addImageToStageByElementId(t.dragObj.elementId)},i.prototype.addThirdPartyImage=function(t){this.doActiveControlImageSwap(t,0,0,!0)},i.prototype.swapBackground=function(e,i,o){"undefined"==typeof i&&(i=0),"undefined"==typeof o&&(o=0);for(var n=t.stage.getNumChildren();n>0;n--){var s=t.stage.getChildAt(n-1);if("bbox.controls.Background"==s.type){var a=s;return t.selections.clear(),a.swapImage(e,i,o),t.events.trigger(t.events.PRODUCT_PERSONALIZED),"saved"!=t.config.productSource()&&t.utils.HtmlUtil.setProductName("Design your own"),!0}}return!1},i.prototype.changePaperstock=function(e){for(var i=t.stage.getNumChildren();i>0;i--){var o=t.stage.getChildAt(i-1);if("bbox.controls.Paperstock"==o.type){var n=o;return n.swapImage(e),void t.product.updatePaperstockImage(e)}}},i.prototype.reset=function(){t.initialFontsLoaded=!1,t.product.reset(),t.previewImage=null,t.stageLocked=!0,null!=t.productOptions&&t.productOptions.backOptionApproved()&&!t.product.autoAddBack()&&t.productOptions.removeBackOption(),null!=t.productOptions&&t.productOptions.resetOptions(),t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,0),t.app.views.toolbarView.updatePageButtons(),t.app.views.toolbarView.updatePreviewButtons(),t.ui.productUpdated=!1,t.imageManager.reset(),t.events.trigger(t.events.UPDATE_UI),t.events.trigger(t.events.UPSELL_OPTIONS_CHANGE),t.events.trigger(t.events.HISTORY_TRANSACTION_CHECK),t.events.trigger(t.events.COMPLETE),t.events.trigger(t.events.STAGE_LOCK_CHANGED,!0),t.events.trigger(t.events.RESET_DESIGN_COMPLETE)},i.prototype.getImageAsset=function(e){var i=e.data("fileId"),o=i,n=e.data("userimage")||!1,s=n?t.config.getFile():"",a=s+e.data("canvasurl"),r=null;if(n){var l=e.data("id");if(l&&0==l.indexOf("peep")){var h=t.imageManager.getPeepData(i);r=t.model.ImageAsset.createFromUGC(h),r.isPeep=!0}else{var h=t.imageManager.getUGCData(i);r=t.model.ImageAsset.createFromUGC(h)}}else if("background"===e.data("type")){i=e.data("name");var h=t.imageManager.getBackgroundData(i);r=t.model.ImageAsset.createFromLibrary(h,o)}else{i=e.data("fileId");var h=t.imageManager.getGraphicData(i);r=t.model.ImageAsset.createFromLibrary(h,o)}return r.url=a,r},i.prototype.setInitialContainerBounds=function(e){var i=e.testHandles();1==t.product.activeData.constrained?(e.x=t.product.activeData.safeLeft+(t.product.activeData.width-t.product.activeData.safeLeft+t.product.activeData.safeRight)/2,e.y=t.product.activeData.safeTop+(t.product.activeData.height-t.product.activeData.safeTop+t.product.activeData.safeBottom)/2):(e.x=t.product.activeData.width/2,e.y=t.product.activeData.height/2),t.selections.select(e,!0),e.selected=!0,e.handleBoundsError(i,e),e.clean(!0,!0),t.updateStage()},i.prototype.getStageIndex=function(){for(var e=t.stage.children.length-1;e>=0;e--){var i=t.stage.children[e];if(!i.pageItemBlock||"liveArea"!==i.pageItemBlock._type&&"overlay"!==i.pageItemBlock._layer)return e+1}},i}(Backbone.View);e.CanvasView=i}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.canvas=document.getElementById("peepsCanvas"),this.peepStage=new createjs.Stage(this.canvas),this.peepStage.enableMouseOver(10),this.peepInstruction=new createjs.Text("drag peeps here","20px Arial","#cccccc"),t.isMobile()&&(this.peepInstruction.text="touch peep to add here"),this.peepInstruction.mouseEnabled=!1,this.peepInstruction.textAlign="center",this.peepStage.addChild(this.peepInstruction),this.peepFamily=new t.model.PeepFamily,this.peepStage.addChild(this.peepFamily),this.peepStageBg=new createjs.Shape,this.peepStage.addChild(this.peepStageBg),this.familySizeRatio=1,this.antiScale=1,this.events={"dragover #peepsCanvas":"onStageOver","drop #peepsCanvas":"onDrop"},createjs.Touch.enable(this.peepStage),t.events.on(t.events.PEEPS_RECALCULATE_FAMILY_SIZE,this.onRecalculateFamilySize,this),t.events.on(t.events.PEEPS_CLEANSE,this.reset,this),t.events.on(t.events.PEEPS_ADD_MOBILE_PEEP,this.onMobileAdd,this),t.events.on(t.events.PEEPS_ADD_DOUBLE_CLICK,this.onDoubleClickAdd,this),t.events.on(t.events.WINDOW_RESIZE,function(){void 0!=t.app.views.peepsCanvasView&&null!=t.app.views.peepsCanvasView&&void 0!=t.app.views.peepsCanvasView.canvas&&null!=t.app.views.peepsCanvasView.canvas&&t.app.views.peepsCanvasView.render()}),t._.bindAll(this,"render"),e.call(this,i)}return __extends(i,e),i.prototype.reset=function(){this.peepStage.clear(),this.peepFamily.removeAllChildren(),this.peepFamily.reset(),this.peepInstruction.visible=!0,this.spacingValue=0,this.familySizeRatio=1,this.antiScale=1,this.stageResize(this.peepStage.canvas.width,this.peepStage.canvas.height),this.showInstructionalText()},i.prototype.render=function(){var e=function(){var e=t.$("#peepsCanvas"),o=e.innerWidth(),n=e.innerHeight();o>0&&n>0&&(clearInterval(i),t.app.views.peepsCanvasView.stageResize(o,n))},i=setInterval(e,100);return this.showInstructionalText(),this},i.prototype.stageResize=function(t,e){this.peepStage.canvas.width=t,this.peepStage.canvas.height=e,this.drawBackground(t,e),this.peepStage.clear(),this.peepInstruction.x=.5*t,this.peepInstruction.y=.5*(e-20),this.onRecalculateFamilySize(this.peepFamily)},i.prototype.drawBackground=function(t,e){this.peepStageBg.graphics.clear().beginStroke("#aaa").drawDashedRect(0,0,t,e,4)},i.prototype.onRecalculateFamilySize=function(e){var i=this.peepStage.canvas.width/e.width,o=this.peepStage.canvas.height/e.height,n=e.width/this.peepStage.canvas.width,s=e.height/this.peepStage.canvas.height;o>i?(this.familySizeRatio=i,this.antiScale=n):(this.familySizeRatio=o,this.antiScale=s),e.scaleX=this.familySizeRatio,e.scaleY=this.familySizeRatio,t.events.trigger(t.events.PEEPS_UI_SCALE,this.antiScale),this.peepStage.update(),this.showInstructionalText()},i.prototype.onDrop=function(t){t.preventDefault(),this.addPeep()},i.prototype.onDoubleClickAdd=function(){this.addPeep()},i.prototype.onMobileAdd=function(){this.addPeep()},i.prototype.addPeep=function(){var e=t.peepsManager.getPeepContentById(t.dragObj.elementId);if(e){var i=t.config.getImageURL()+e.svgFilePath+"/"+e.svgFileName;t.peepsManager.loadPeepSVG(i)}this.peepStage.update()},i.prototype.showInstructionalText=function(){this.peepInstruction.visible=this.peepFamily.getNumChildren()>0?!1:!0,this.peepStage.update()},i.prototype.onStageOver=function(t){t.preventDefault(),t.stopPropagation()},i}(Backbone.View);e.PeepsCanvasView=i}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){this.setElement(t.$("#preview"),!0),this.template=t._.template('<div class="preview-side-bar">    <div class="selected-upsell">        <h5>Make it Special<span class="info-icon"></span></h5>        <a href="#" id="editOptionsButton" class="btn btn-secondary-config btn-gray">edit</a>        <p>You have chosen:</p>        <ul id="upsellOptions">        </ul>    </div>    <div class="share-content">        <h5>Share your design<span class="info-icon"></span></h5>        <p>Privately share your design with friends &amp; family.</p><p style="color:#638ac6">You must save your design first.</p>        <a href="#" id="shareButton" class="btn btn-secondary-config btn-gray">share</a>    </div>    <div class="soft-proof-content">        <h5>Order a Digital Proof<span class="info-icon"></span></h5>        <label><input id="addSoftProof" type="checkbox"/>Get a Soft Proof</label>    </div>    <div class="registered-logo">        <h5>Add &quot;Registered at Walmart&quot;<span class="info-icon"></span></h5>        <label><input id="addRegisteredLogo" type="checkbox"/>Yes, Add </label>    </div></div><div class="preview-btn preview-btn-btm">    <a id="editButton1" href="#" class="btn btn-secondary-config btn-pre">        <span class="VAlignHelper"></span>        <span class="text">edit design</span>        <span class="VAlignHelper"></span>    </a>    <a id="addToCart1" class="btn btn-orange btn-pre">        <span class="VAlignHelper"></span>        <span class="text">add to cart</span>        <span class="VAlignHelper"></span>    </a></div>'),this.events={"click #editOptionsButton":"onUpsellClick","click #shareButton":"onShareClick","change #addSoftProof":"onSoftProofChange","change #addRegisteredLogo":"onRegisterLogoChange","click #addToCart1":"addToCart","click #editButton1":"onEditClick"},t._.bindAll(this,"render"),e.call(this,i),this.isReady=!1,t.events.on(t.events.UPSELL_OPTIONS_CHANGE,this.onOptionsChanged,this),t.events.on(t.events.WALMART_REGISTER_LOGO,this.onWalmartRegisterShow,this),t.events.on(t.events.SCENE_VISIBILITY_CHANGED,this.adjustPreviewHeight,this)}return __extends(i,e),i.prototype.adjustPreviewHeight=function(e){if(t.product.manifest.isMultiScene&&e){var i=t.$("#toolbar"),o=t.$("#preview"),n=t.$(".right-side-container"),s=t.$("#zoomControls"),a=o.height(),r=n.innerHeight()-(i.height()+s.height());a!==r&&(o.css("height",r),t.events.trigger(t.events.WINDOW_RESIZE))}},i.prototype.onSoftProofChange=function(){var e=t.productOptions.getSoftProofSku().toString();t.$("#addSoftProof").is(":checked")?t.productOptions.addPersistedSku(e):t.productOptions.removePersistedSku(e),this.onOptionsChanged()},i.prototype.render=function(){var e=this.template({});return this.$el.html(e),t.isMobile()||(t.utils.HtmlUtil.createTooltip("shareButton","Share your design.","bottom"),t.utils.HtmlUtil.createTooltip("editOptionsButton","Upgrade your design with product specfic options.","bottom")),this},i.prototype.setup=function(){this.init(),t.product.initPosition(),t.app.views.toolbarView.preview(),t.events.trigger(t.events.HISTORY_TRANSACTION_CHECK),"cart"==t.config.productSource()&&!t.config.isReorder()||t.config.commerceItemId()?(t.$("#addToCart > span.text").text("update cart"),t.$("#addToCart1 > span.text").text("update cart")):(t.$("#addToCart > span.text").text("add to cart"),t.$("#addToCart1 > span.text").text("add to cart")),t.productOptions.hasSoftProof()?t.productOptions.hasSoftProofSku()&&t.$("#addSoftProof").prop("checked",!0):t.$(".soft-proof-content").hide(),t.config.showShareDesign()&&t.config.isRegistered()||t.$(".share-content").hide(),t.$(".registered-logo").hide(),t.product.manifest.isMultiScene?t.sceneManager.updateScene(t.product.FIRST_PAGE):t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,t.product.FIRST_PAGE),t.events.trigger(t.events.ZOOM_FIT),t.imageManager.asyncUploadPreview(t.events.ADD_TO_CART_PREVIEW_UPLOADED)},i.prototype.init=function(){if(!this.isReady){this.isReady=!0,null==t.productOptions||t.productOptions.hasProductUpsells()||t.$(".selected-upsell").hide();try{this.onOptionsChanged()}catch(t){}}},i.prototype.onUpsellClick=function(e){e.preventDefault(),t.productOptions.hasProductUpsells()&&t.dialogs.displayUpsellDialog()},i.prototype.onOptionsChanged=function(){t.$("#upsellOptions").empty();var e="",i=null,o="",n=0,s=t.productOptions.selectedOptions.length;for(n;s>n;n++)e=t.productOptions.selectedOptions[n],i=t.productOptions.getOption(e),o+="<li>"+i.label+"</li>";for(s=t.productOptions.selectedPersistedOptions.length,n=0;s>n;n++){var a=t.productOptions.selectedPersistedOptions[n];o+="<li>"+a.label+"</li>"}t.$("#upsellOptions").append(o)},i.prototype.onShareClick=function(e){e.preventDefault(),null==t.product.getName()||""==t.product.getName()?(t.selections.clear(),t.utils.AppUtil.handleSave(e),t.editorManager.commit()):t.config.profileID()?t.utils.HtmlUtil.shareDesign(e):t.dialogs.displayUserDialog("save")},i.prototype.onWalmartRegisterShow=function(e){this.registerLogo=e,t.$(".registered-logo").show()},i.prototype.onRegisterLogoChange=function(e){e.preventDefault(),this.registerLogo.setVisibility(t.$("#addRegisteredLogo").is(":checked"))},i.prototype.addToCart=function(){t.$("#prog_personalize, #prog_preview").removeClass("active"),t.$("#prog_order").addClass("triggered active"),t.dialogs.displayApproveDialog()},i.prototype.onEditClick=function(e){t.utils.ObjectUtil.notUndefined(e)&&e.preventDefault(),t.app.router.navigate("",{trigger:!0}),t.app.views.toolbarView.edit(),t.product.manifest.isMultiScene?t.sceneManager.updatePreviewButtons():t.app.views.toolbarView.updateNavButtons(),t.events.trigger(t.events.WINDOW_RESIZE),t.resetZoomLevel()},i}(Backbone.View);e.PreviewView=i}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){this.setElement(t.$("#scenes"),!0),this.sceneViewTemplate=t._.template('<div id="sceneManager">	<span class="scene-label">multi-scene:</span><!-- --><div class="scene-nav">        <a href="#" class="btn" id="backToScene"><i class="icon-chevron-left"></i></a><!--     --><strong id="scene_label" class="scene-num"></strong><!--     --><a href="#" class="btn" id="forwardToScene"><i class="icon-chevron-right"></i></a>    </div></div>'),this.events={"click #backToScene":"changeScene","click #forwardToScene":"changeScene"},e.call(this)}return __extends(i,e),i.prototype.render=function(){var e={},i=this.sceneViewTemplate(e);return this.$el.html(i),t.$("#sceneManager").hide(),this},i.prototype.checkSceneStatus=function(){t.product.manifest.isMultiScene?(t.$("#scenes").show(),t.$("#sceneManager").show(),t.events.trigger(t.events.SCENE_VISIBILITY_CHANGED,!0)):(t.$("#sceneManager").hide(),t.events.trigger(t.events.SCENE_VISIBILITY_CHANGED,!1)),this.updateNavButtons(),this.sceneLabel="Scene 1",t.$("#scene_label").html(this.sceneLabel),t.inPreviewMode||t.sceneManager.updatePreviewButtons()},i.prototype.changeScene=function(e){switch(e.preventDefault(),e.currentTarget.id){case"forwardToScene":if(!t.product.hasNextScene())return;t.product.nextScene();break;case"backToScene":if(!t.product.hasPrevScene())return;t.product.prevScene()}this.updateNavButtons(),t.selections.clear(),t.save(),t.$("#scene_label").html("Scene "+(t.product.activeScene+1));var i=t.product.FIRST_PAGE,o=t.product.getLayoutIndex(i);t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,o),t.product.activePage=i,t.inPreviewMode||t.sceneManager.updatePreviewButtons(),t.events.trigger(t.events.HISTORY_TRANSACTION_CHECK)},i.prototype.updateNavButtons=function(){t.product.hasNextScene()?t.$("#forwardToScene").removeClass("disabled"):t.$("#forwardToScene").addClass("disabled"),t.product.hasPrevScene()?t.$("#backToScene").removeClass("disabled"):t.$("#backToScene").addClass("disabled")},i}(Backbone.View);e.SceneView=i}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(i){this.invalidProductMsg="At least one container is missing required content.",this.setElement(t.$("#toolbar"),!0),this.toolbarTemplate=t._.template('<div class="toolbar tb-white toolbar-progressIndicator">    <ul>        <li id="prog_personalize" class="triggered active VAlignHelper2">            <i class="sprite-inline"></i>            <span class="text">Personalize</span>        </li>        <li id="prog_preview" class="VAlignHelper2">            <i class="sprite-inline"></i>            <span class="text">Preview</span>        </li>        <li id="prog_order" class="VAlignHelper2">            <i class="sprite-inline"></i>            <span class="text">Order</span>        </li>    </ul>    <div id="etiquetteInfo" class="pull-right VAlignHelper2">        <a id="etiquetteButton" href="#">etiquette</a>    </div></div><div class="toolbar toolbar-nav">    <div id="pagerToolBar">        <ul id="pageList" class="pager-tabs flex-container pull-left">            <li id="page0" class="active" index="0" style="display: none">                <a id="pageLink0" href="#">                    <span class="VAlignHelper2">                        <span class="text">FRONT</span>                    </span>                </a>            <li id="page1" class="" index="1" style="display: none">                <a id="pageLink1" href="#">                    <span class="VAlignHelper2">                        <span class="text">BACK</span>                    </span>                    <i id="addRemoveIcon" class="sprite-inline sprite-icon_add_back" style="display:none;"></i>                </a>        </ul>    </div>    <div class="nav-buttons pull-right">        <div class="preview-item" style="display: none">            <a id="editButton" href="#" class="btn btn-secondary-config btn-pre pull-left VAlignHelper2">                <span class="text">edit design</span>            </a>            <a id="addToCart" class="btn btn-orange btn-pre pull-left VAlignHelper2">                <span class="text">add to cart</span>            </a>        </div>        <div class="design-item">            <a href="#" id="previousButton" style="display: none" class="btn pull-left btn-blue disabled VAlignHelper2">                <i class="sprite-inline sprite-icon_arrow "></i>            </a>            <a id="previewButton" style="display: none" class="btn btn-blue pull-left btn-pre VAlignHelper2">                <div class="wrapper VAlignHelper2">                    <span class="text">preview</span>                </div>                <i class="sprite-inline sprite-icon_arrow"></i>            </a>            <a href="#" id="nextButton" style="display: none" class="btn btn-blue btn-pre VAlignHelper2">                <div class="wrapper VAlignHelper2">                    <span class="text">next</span>                </div>                <i class="sprite-inline sprite-icon_arrow"></i>            </a>        </div>    </div></div><div id="scenes" class="toolbar toolbar-scenes" style="display: none"></div><div class="toolbar toolbar-actions">    <ul>        <li>            <a id="saveButton" href="#" class="VAlignHelper2">                <i class="fa fa-floppy-o"></i>                <span class="">Save</span>            </a>        </li><!--     --><li>            <a id="helpButton" href="#" class="VAlignHelper2">                <i class="fa fa-question"></i>                <span class="">Help</span>            </a>        </li><!--     --><li class="design-item">            <a id="undoHistoryButton" href="#" class="VAlignHelper2">                <i class="fa fa-undo"></i>                <span class="">Undo</span>            </a>        </li><!--     --><li class="design-item">            <a id="redoHistoryButton" href="#" class="VAlignHelper2">                <i class="fa fa-repeat"></i>                <span class="">Redo</span>            </a>        </li><!--     --><li class="design-item">            <a id="resetButton" href="#" class="VAlignHelper2">                <i class="fa fa-refresh"></i>                <span class="">Reset</span>            </a>        </li><!--     --><li class="design-item">            <a id="addTextButton" href="#" class="VAlignHelper2">                <i class="fa fa-plus-square-o"></i>                <span class="">Add Text</span>            </a>        </li><!--     --><li class="design-item">            <a id="toggleStageLock" href="#" class="VAlignHelper2">                <i class="fa fa-arrows"></i>                <span class="">Move Items</span>            </a>        </li><!--     --><li id="zoomControls" class="zoom-nav-control VAlignHelper2"></li>    </ul></div>'),this.events={"click #undoHistoryButton":"onUndoHistoryButtonClick","click #redoHistoryButton":"onRedoHistoryButtonClick","click #addTextButton":"onAddTextClick","click #addImageToolbarButton":"onAddImageClick","click #resetButton":"onResetClick","click #saveButton":"onSaveClick","click #previewButton":"onPreviewClick","click #prog_preview":"onPreviewClick","click #helpButton":"onHelpClick","click #page0":"switchLayout","click #page1":"switchLayout","click #nextButton":"onNextClick","click #previousButton":"onPreviousClick","click #addRemoveIcon":"onAddRemoveBackClick","click #etiquetteButton":"onEtiquetteClick","click #addToCart":"addToCart","click #editButton":"onEditClick","click #prog_personalize":"onEditClick","click #toggleStageLock":"onToggleStageLockClick"},t.events.on(t.events.UPDATE_UI,this.onUpdateToolbar,this),t.events.on(t.events.PRODUCT,this.onProductLoaded,this),t.events.on(t.events.COMPLETE,this.onProductLoaded,this),t.events.on(t.events.OPTIONS_LOADED,this.updatePreviewButtons,this),t.events.on(t.events.IMAGE_ADD_STATE_CHANGE,this.imageAddStateChange,this),t.events.on(t.events.REQUIRED_ITEMS_INVALID,this.onRequiredItemsInvalid,this),t.events.on(t.events.REQUIRED_ITEMS_VALID,this.onRequiredItemsValid,this),t.events.on(t.events.HISTORY_UNDO,this.undoEnable,this),t.events.on(t.events.HISTORY_REDO,this.redoEnable,this),t.events.on(t.events.SWITCH_CURRENT_LAYOUT,this.updatePageButtons,this),t.events.on(t.events.RESET_DESIGN_COMPLETE,this.resetProgressButtons,this),t.events.on(t.events.STAGE_LOCK_CHANGED,this.onStageLockChanged,this),t._.bindAll(this,"render"),e.call(this,i)}return __extends(i,e),i.prototype.onEtiquetteClick=function(t){t.preventDefault();var e=window;e.openEtiquetteModal()},i.prototype.render=function(){var e={buttonText:"add text"},i=this.toolbarTemplate(e);return this.$el.html(i),this.$("#previewButton").popover({placement:"left",trigger:"manual",content:this.invalidProductMsg}),t.isMobile()||(t.utils.HtmlUtil.createTooltip("addTextButton","Add custom text to your design.","bottom","#toolTipper"),t.utils.HtmlUtil.createTooltip("addImageToolbarButton","Add a new Image element to your product. You will be able to drag an existing image from your library or upload a new image from your computer or Social Media account.","bottom"),t.utils.HtmlUtil.createTooltip("resetButton","Reset design to the original format. You will lose your personalization to date.","bottom","#toolTipper"),t.utils.HtmlUtil.createTooltip("saveButton","Save your design to the My Account section.","bottom","#toolTipper"),t.utils.HtmlUtil.createTooltip("helpButton","Help.","bottom","#toolTipper"),t.utils.HtmlUtil.createTooltip("prog_personalize","You are currently Personalizing your product.","bottom"),t.utils.HtmlUtil.createTooltip("previewButton","Go to Next Page.","bottom"),t.utils.HtmlUtil.createTooltip("toggleStageLock","Toggle this button to enable or disable the ability to arrange elements on the product. Some containers may not be editable by design.","bottom"),t.$("#prog_personalize").css({cursor:"default"})),t.config.showEtiquette()||this.$("#etiquetteInfo").hide(),this
},i.prototype.imageAddStateChange=function(e){e?t.$("#addImageToolbarButton").removeClass("disabled"):t.$("#addImageToolbarButton").addClass("disabled")},i.prototype.onUpdateToolbar=function(){t.ui.isAddImageEnabled()?(t.$("#addImageToolbarButton").removeClass("disabled"),t.utils.HtmlUtil.createTooltip("addImageToolbarButton","Add a new Image element to your product. You will be able to drag an existing image from your library or upload a new image from your computer or Social Media account.","bottom")):(t.$("#addImageToolbarButton").addClass("disabled"),t.$("#addImageToolbarButton").tooltip("destroy")),t.ui.isAddTextEnabled()?(t.$("#addTextButton").removeClass("disabled"),t.utils.HtmlUtil.createTooltip("addTextButton","Add custom text to your design.","bottom","#toolTipper")):(t.$("#addTextButton").addClass("disabled"),t.$("#addTextButton").tooltip("destroy"))},i.prototype.onLoadingComplete=function(){t.log("cofigurator init complete"),this.onProductLoaded(),t.log("*************")},i.prototype.onProductLoaded=function(){if(!this._productLoaded){var e=t.ui.isLayoutFixed();if(t.$("#toggleStageLock").toggleClass("disabled",e),t.$("#toggleStageLock").tooltip(e?"disable":"enable"),t.ui.isAddTextEnabled()||(t.$("#addTextButton").addClass("disabled"),t.$("#addTextButton").tooltip("destroy")),4==t.product.manifest.pageCount){var i=t.utils.Constants.GENERIC_FOUR_PAGE_LABELS,o=t.product.getActiveLayout().productInfo;t.utils.ObjectUtil.isEmpty(o.foldType)||("vertical"==o.foldType.toLowerCase()?i=t.utils.Constants.FOLD_VERTICAL_LABELS:"horizontal"==o.foldType.toLowerCase()&&(i=t.utils.Constants.FOLD_HORIZONTAL_LABELS)),t.$("#page0").show(),t.$("#pageLink0 .text").text(i[0]),t.$("#page1").show(),t.$("#pageLink1 .text").text(i[1]),t.$("#previousButton").show();for(var n=2;n<t.product.manifest.pageCount;n++){var s="<li id='page"+n+"' index='"+n+"' ><a href='#'><span class='VAlignHelper2'><span class='text'>"+i[n]+"</span></span></a>";t.$("#pageList").append(s),t.$("#page"+n).click(this.switchLayout)}}else if(t.product.manifest.pageCount>2){t.$("#page0").show(),t.$("#pageLink0 .text").text("Page 1"),t.$("#page1").show(),t.$("#pageLink1 .text").text("Page 2"),t.$("#previousButton").show();for(var n=2;n<t.product.manifest.pageCount;n++){var s="<li id='page"+n+"' index='"+n+"' ><a href='#'><span class='VAlignHelper2'><span class='text'>Page "+(n+1)+"</span></span></a>";t.$("#pageList").append(s),t.$("#page"+n).click(this.switchLayout)}}else t.$("#page0").show(),t.product.manifest.pageCount>1&&(t.$("#page1").show(),t.$("#previousButton").show());this._productLoaded=!0}this.updateNavButtons(),t.product.manifest.isMultiScene&&t.sceneManager.updatePreviewButtons()},i.prototype.onPreviewClick=function(t){t.preventDefault(),t&&"previewButton"!==t.currentTarget.id&&(t.currentTarget.className.indexOf("triggered")<=-1||t.currentTarget.className.indexOf("active")>-1)||window.location.assign("#preview")},i.prototype.onUndoHistoryButtonClick=function(e){var i="#"+e.currentTarget.id;e.preventDefault(),t.$(i).hasClass("disabled")===!1&&(t.editorManager.commit(),e.preventDefault(),t.events.trigger(t.events.HISTORY_TRANSACTION_UNDO))},i.prototype.onRedoHistoryButtonClick=function(e){var i="#"+e.currentTarget.id;e.preventDefault(),t.$(i).hasClass("disabled")===!1&&(t.editorManager.commit(),e.preventDefault(),t.events.trigger(t.events.HISTORY_TRANSACTION_REDO))},i.prototype.onAddTextClick=function(e){var i="#"+e.currentTarget.id;e.preventDefault(),t.ui.isAddTextEnabled()&&t.$(i).hasClass("disabled")===!1&&(t.events.trigger(t.events.ADD_TEXT),t.editorManager.commit())},i.prototype.onAddImageClick=function(e){var i="#"+e.currentTarget.id;e.preventDefault(),t.ui.isAddImageEnabled()&&t.$(i).hasClass("disabled")===!1&&(t.events.trigger(t.events.ADD_IMAGE_CONTAINER),t.editorManager.commit())},i.prototype.onHelpClick=function(e){e.preventDefault(),t.utils.HtmlUtil.openHelp(e),t.editorManager.commit()},i.prototype.onSaveClick=function(e){e.preventDefault(),t.selections.clear(),t.utils.AppUtil.handleSave(e),t.editorManager.commit()},i.prototype.onResetClick=function(e){e.preventDefault(),t.dialogs.displayConfirmResetDialog(),t.selections.clear()},i.prototype.onAddRemoveBackClick=function(e){e.preventDefault(),0==t.product.activeLayout&&t.asyncCaptureCartPreview(),t.product.autoAddBack()||(t.$("#addRemoveIcon").hasClass("sprite-icon_remove_back")&&(e.stopImmediatePropagation(),t.dialogs.backOptionDialog.renderRemoveModal()),t.editorManager.commit())},i.prototype.switchLayout=function(e){e.preventDefault();var i=Number(t.$("#"+e.currentTarget.id).attr("index"));if(t.product.manifest.isMultiScene)return void t.sceneManager.handlePageClick(i);if(i!=t.product.activeLayout){if(0==t.product.activeLayout&&t.asyncCaptureCartPreview(),i==t.product.BACK_PAGE&&t.product.isTwoPage()&&t.productOptions.showBackApproval())return void t.dialogs.displayBackOptionDialog();t.save();var o=t.product.getLayoutIndex(i);t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,o),t.app.views.toolbarView.updateNavButtons(),t.inPreviewMode||t.events.trigger(t.events.UPDATE_ASSET_TABS)}},i.prototype.onNextClick=function(e){if(e.preventDefault(),t.selections.clear(),0==t.product.activeLayout&&t.asyncCaptureCartPreview(),t.product.manifest.isMultiScene)return void t.sceneManager.handleNextClick();var i=t.product.nextPage();return t.product.activePage==t.product.BACK_PAGE&&t.product.isTwoPage()&&t.productOptions.showBackApproval()?void t.dialogs.displayBackOptionDialog():(t.save(),t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,i),this.updateNavButtons(),t.events.trigger(t.events.UPDATE_ASSET_TABS),t.editorManager.commit(),void t.events.trigger(t.events.HISTORY_TRANSACTION_CHECK))},i.prototype.onPreviousClick=function(e){if(e.preventDefault(),t.selections.clear(),0==t.product.activeLayout&&t.asyncCaptureCartPreview(),t.product.manifest.isMultiScene)return void t.sceneManager.handlePreviousClick();if(t.product.hasPrevPage()){t.save();var i=t.product.prevPage();t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,i),this.updateNavButtons(),t.events.trigger(t.events.UPDATE_ASSET_TABS),t.editorManager.commit(),t.events.trigger(t.events.HISTORY_TRANSACTION_CHECK)}},i.prototype.resetProgressButtons=function(){t.$("#prog_preview").removeClass("triggered active"),t.$("#prog_preview").css({cursor:""}),t.utils.HtmlUtil.removeTooltip("prog_preview"),t.$("toggleStageLock").toggleClass("toggled",!0)},i.prototype.updateNavButtons=function(){t.product.manifest.isMultiScene||(this.updatePageButtons(),t.inPreviewMode||this.updatePreviewButtons())},i.prototype.updatePageButtons=function(){for(var e=0;e<t.product.manifest.pageCount;e++)t.$("#page"+e).removeClass("active");t.$("#page"+t.product.activePage).addClass("active");var i=!t.product.autoAddBack()&&null!=t.productOptions&&t.productOptions.hasBackOption();t.$("#addRemoveIcon").toggle(i)},i.prototype.updatePreviewButtons=function(){t.product.manifest.isMultiScene?t.sceneManager.updatePreviewButtons():(t.product.showNextPage()?(t.$("#nextButton").show(),t.utils.HtmlUtil.createTooltip("nextButton","Go to Next Page.","bottom"),t.$("#previewButton").hide()):(t.$("#nextButton").hide(),t.$("#previewButton").show()),t.product.manifest.pageCount>1&&t.$("#previousButton").show(),t.product.hasPrevPage()?(t.utils.HtmlUtil.createTooltip("previousButton","Go to Previous Page.","bottom"),t.$("#previousButton").removeClass("disabled")):(t.$("#previousButton").tooltip("destroy"),t.$("#previousButton").addClass("disabled")),(t.product.autoAddBack()||null!=t.productOptions&&!t.productOptions.hasBackOption())&&t.$("#addRemoveIcon").hide())},i.prototype.addToCart=function(){t.$("#prog_personalize, #prog_preview").removeClass("active"),t.$("#prog_order").addClass("triggered active"),t.dialogs.displayApproveDialog()},i.prototype.onEditClick=function(e){t.utils.ObjectUtil.notUndefined(e)&&e.preventDefault(),(!e||0!=e.currentTarget.className.length&&"triggered active"!==e.currentTarget.className)&&(t.app.router.navigate("",{trigger:!0}),t.app.views.toolbarView.edit(),t.product.manifest.isMultiScene?t.sceneManager.updatePreviewButtons():t.app.views.toolbarView.updateNavButtons(),t.resetZoomLevel())},i.prototype.onToggleStageLockClick=function(){t.$("#toggleStageLock").hasClass("disabled")||t.events.trigger(t.events.STAGE_LOCK_CHANGED,!t.stageLocked)},i.prototype.preview=function(){this.updatePageButtons(),t.$("#prog_personalize, #prog_order").removeClass("active"),t.$("#prog_preview").addClass("triggered active"),t.$("#prog_personalize").css({cursor:"pointer"}),t.$("#prog_preview").css({cursor:"default"}),t.utils.HtmlUtil.createTooltip("prog_personalize","Personalize your product.","bottom"),t.utils.HtmlUtil.createTooltip("prog_preview","You are currently Previewing your product.","bottom"),t.editorManager.commit()},i.prototype.edit=function(){this.updatePreviewButtons(),t.events.trigger(t.events.UPDATE_ASSET_TABS),t.$("#prog_preview, #prog_order").removeClass("active"),t.$("#prog_order").removeClass("triggered"),t.$("#prog_personalize").addClass("active"),t.utils.HtmlUtil.createTooltip("prog_preview","Preview your product.","bottom"),t.utils.HtmlUtil.createTooltip("prog_personalize","You are currently Personalizing your product.","bottom"),t.$("#prog_personalize").css({cursor:"default"}),t.$("#prog_preview").css({cursor:"pointer"}),t.editorManager.commit(),t.events.trigger(t.events.WINDOW_RESIZE)},i.prototype.onRequiredItemsInvalid=function(){t.$(this.el).off("click","#previewButton"),t.$("#prog_preview",this.el).hasClass("triggered")&&(t.$(this.el).off("click","#prog_preview"),t.utils.HtmlUtil.removeTooltip("prog_preview"),t.utils.HtmlUtil.createTooltip("prog_preview","At least one container is missing required content.","bottom",null,!0)),t.utils.HtmlUtil.createTooltip("previewButton","At least one container is missing required content.","bottom",null,!0),t.$("#previewButton").addClass("btn-preview-invalid")},i.prototype.onRequiredItemsValid=function(){t.$(this.el).on("click","#previewButton",this.onPreviewClick),t.$("#prog_preview",this.el).hasClass("triggered")&&(t.$(this.el).on("click","#prog_preview",this.onPreviewClick),t.utils.HtmlUtil.removeTooltip("prog_preview"),t.utils.HtmlUtil.createTooltip("prog_preview","Preview your product.","bottom")),t.utils.HtmlUtil.removeTooltip("previewButton"),t.$("#previewButton").removeClass("btn-preview-invalid")},i.prototype.onStageLockChanged=function(e){var i=t.$("#toggleStageLock");t.stageLocked=e,i.toggleClass("toggled",!e),this.reselectControls()},i.prototype.reselectControls=function(){var e=t.selections.getSelectedItems();if(e&&1===e.length){var i=e[0];t.selections.select(i,!0)}else for(var o=0;o<e.length;o++){var i=e[o];t.selections.unselect(i)}},i.prototype.undoEnable=function(e){"disable"===e?(t.$("#undoHistoryButton").addClass("disabled"),t.$("#undoHistoryButton").tooltip("destroy")):(t.$("#undoHistoryButton").removeClass("disabled"),t.utils.HtmlUtil.createTooltip("undoHistoryButton","Undo the last action.","bottom","#toolTipper"))},i.prototype.redoEnable=function(e){"disable"===e?(t.$("#redoHistoryButton").addClass("disabled"),t.$("#redoHistoryButton").tooltip("destroy")):(t.$("#redoHistoryButton").removeClass("disabled"),t.utils.HtmlUtil.createTooltip("redoHistoryButton","Redo the last action.","bottom","#toolTipper"))},i}(Backbone.View);e.ToolbarView=i}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){var i=function(e){function i(){this.setElement(t.$("#zoomControls"),!0),this.zoomTemplate=t._.template('<a href="#" id="resetZoom" class="VAlignHelper2">    <i class="fa fa-expand"></i>    <span class="">Fit to Canvas</span></a><a href="#" id="decZoom" class="VAlignHelper2">    <i class="fa fa-search-minus" draggable="false"></i></a><input type="range" id="slider" min=".5" max="6" step=".1" draggable="false"><a href="#" id="incZoom" class="VAlignHelper2">    <i class="fa fa-search-plus" draggable="false"></i></a>'),this.step=.1,this.events={"click #decZoom":"zoomOut","click #incZoom":"zoomIn","click #resetZoom":"resetZoom","input #slider":"zoom","change #slider":"zoom"},t.events.on(t.events.ZOOM_FIT,this.resetZoom,this),e.call(this)}return __extends(i,e),i.prototype.render=function(){this.startScale=t.stageZoom.scaleX,this.currentScale=this.startScale;var e={},i=this.zoomTemplate(e);return this.$el.html(i),t.isMobile()||(t.utils.HtmlUtil.createTooltip("resetZoom","Fit design into window.","bottom"),t.utils.HtmlUtil.createTooltip("decZoom","Zoom design out.","bottom"),t.utils.HtmlUtil.createTooltip("incZoom","Zoom design in.","bottom")),this},i.prototype.getCurrentSliderVal=function(){return parseFloat(t.$("#slider").val())},i.prototype.getMaxValue=function(){return parseFloat(t.$("#slider").prop("max"))},i.prototype.getMinValue=function(){return parseFloat(t.$("#slider").prop("min"))},i.prototype.mangeZoomIcons=function(){var e=this.getCurrentSliderVal();e>=this.getMaxValue()?(t.$("#incZoom").addClass("disabled"),t.$("#incZoom").tooltip("destroy"),t.$("#decZoom").removeClass("disabled")):e<=this.getMinValue()?(t.$("#incZoom").removeClass("disabled"),t.$("#decZoom").addClass("disabled"),t.$("#decZoom").tooltip("destroy")):(t.$("#incZoom").removeClass("disabled"),t.$("#decZoom").removeClass("disabled"),t.utils.HtmlUtil.createTooltip("decZoom","Zoom design out.","left"),t.utils.HtmlUtil.createTooltip("incZoom","Zoom design in.","right"))},i.prototype.zoom=function(e){t.editorManager.clear(),t.stageZoom.scaleX=t.stageZoom.scaleY=e.currentTarget.value/1,this.setupZoom(e)},i.prototype.zoomIn=function(e){e.preventDefault(),this.getCurrentSliderVal()<this.getMaxValue()&&(t.editorManager.clear(),this.handleZoom(e,this.step))},i.prototype.zoomOut=function(e){e.preventDefault(),this.getCurrentSliderVal()>this.getMinValue()&&(t.editorManager.clear(),this.handleZoom(e,-1*this.step))},i.prototype.handleZoom=function(e,i){e.preventDefault(),this.currentScale=(this.currentScale+i)/1,t.$("#slider").val(this.currentScale.toFixed(1)),t.stageZoom.scaleX=t.stageZoom.scaleY=this.currentScale,this.setupZoom(e)},i.prototype.setupZoom=function(e){var i=t.utils.Stage.getMetrics();if(null!=i){var o=i.width-i.canvasWidth,n=i.height-i.canvasHeight,s=Math.abs(o),a=Math.abs(n),r=(i.canvasWidth-i.width)/2,l=(i.canvasHeight-i.height)/2,h=r,c=l,d=100;if(null!=t.zoomNav.center){var p=t.zoomNav.center.x/t.zoomNav.center.scale*i.scale,u=t.zoomNav.center.y/t.zoomNav.center.scale*i.scale;h=0>o?r:r-s/2>p?r-s/2-d:p>r+s/2?r+s/2+d:p,c=0>n?l:l-a/2>u?l-a/2-d:u>l+a/2?l+a/2+d:u}t.stageZoom.x=h,t.stageZoom.y=c,t.updateStage(),this.mangeZoomIcons()}t.updateStage(),t.events.trigger(t.events.ZOOM_LEVEL_UPDATE,e)},i.prototype.resetZoom=function(e){null!=e&&e.preventDefault(),t.zoomNav&&null!=t.zoomNav.center&&(t.zoomNav.center=null),t.editorManager.clear(),t.initLayout(),t.events.trigger(t.events.ZOOM_LEVEL_UPDATE,e)},i.prototype.fixZoom=function(){var e=t.stageZoom.scaleX;this.startScale=this.currentScale=e/1,t.$("#slider").val(e)},i.prototype.setZoom=function(e){this.startScale=this.currentScale=e/1,t.$("#slider").val(e),t.stageZoom.scaleX=t.stageZoom.scaleY=this.startScale,t.utils.Stage.center(),t.updateStage()},i}(Backbone.View);e.ZoomControlView=i}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.approveTemplate=t._.template('<div id="approveDialog" class="modal-container fade">    <div class="VAlignHelper"></div>    <div class="modal small-modal">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3>Approve Your Project</h3>        </div>        <div class="modal-body">            <p>I acknowledge that I have reviewed all personalization to this design including text and images and that they meet my satisfaction.</p>        </div>        <div class="modal-footer">            <a id="approveCancelButton" href="#" class="btn">Return to edit</a>            <a id="approveOkButton" href="#" class="btn btn-blue">Approve design</a>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.events={"click #approveOkButton":"onOkClick","click #approveCancelButton":"onCancelClick"},t._.bindAll(this,"render"),e.call(this,i)}return __extends(i,e),i.prototype.render=function(){if(0===t.$("#approveDialog").length){var e=this.approveTemplate({});t.$(e).modal("show")}else t.$("#approveDialog").modal("show");return this},i.prototype.onCancelClick=function(e){e.preventDefault(),t.$("#approveDialog").modal("hide"),t.app.router.navigate("",{trigger:!0}),t.app.views.toolbarView.edit(),t.inPreviewMode=!1},i.prototype.onOkClick=function(e){e.preventDefault(),t.$("#approveDialog").modal("hide"),t.addToCartPreviewReady=!1,t.services.addToCart(),t.utils.HtmlUtil.sendCatalystEvent(19,"Add To Cart"),t.dialogs.displayBusyDialog("Status","Adding design to cart")},i}(Backbone.View);e.ApproveDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.backOptionsTemplate=t._.template('<div id="backOptionsDialog" class="modal-container">    <div class="VAlignHelper"></div>    <div class="modal small-modal">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3>Add a Back Side?</h3>        </div>        <div class="modal-body">            <p>Add a back side to your card for only <span class="back-price">$<%= price %></span>.</p>        </div>        <div class="modal-footer">            <a href="#" class="btn" data-dismiss="modal">cancel</a>            <a id="addBackButton" href="#" class="btn btn-blue">yes, add a back</a>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.removeBackTemplate=t._.template('<div id="removeBackOptionsDialog" class="modal-container">    <div class="VAlignHelper"></div>    <div class="modal small-modal">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3>Remove the Back Side?</h3>        </div>        <div class="modal-body">            <p><strong>Are you sure you want to remove the back side of your card?</strong></p>            <p>This will clear and remove any text or images on the back side of the card.</p>        </div>        <div class="modal-footer">            <a id="removeCancelButton"href="#" class="btn">cancel</a>            <a id="removeBackButton" href="#" class="btn btn-blue">yes, clear and remove back</a>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.events={"click #addBackButton":"onAddClick","click #removeBackButton":"onRemoveClick","click #removeCancelButton":"onRemoveCancelClick"},t._.bindAll(this,"render"),e.call(this,i)}return __extends(i,e),i.prototype.render=function(){if(0==t.$("#backOptionsDialog").length){var e=t.productOptions.getBackPrice(),i=this.backOptionsTemplate({price:e});t.$(i).modal("show")}else t.$("#backOptionsDialog").modal("show");return this},i.prototype.renderRemoveModal=function(){if(0==t.$("#removeBackOptionsDialog").length){var e=this.removeBackTemplate({});t.$(e).modal("show")}else t.$("#removeBackOptionsDialog").modal("show")},i.prototype.onRemoveClick=function(e){if(e.preventDefault(),t.$("#removeBackOptionsDialog").modal("hide"),t.productOptions.removeBackOption(),t.product.activeLayout!=t.product.FIRST_PAGE){var i=t.product.getLayoutIndex(t.product.FIRST_PAGE);t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,i)}t.app.views.toolbarView.updateNavButtons(),t.product.getBackLayout().reset()},i.prototype.onRemoveCancelClick=function(e){e.preventDefault(),t.inPreviewMode&&t.dialogs.upsellDialog.resetBackoption(),t.$("#removeBackOptionsDialog").modal("hide")},i.prototype.onAddClick=function(e){e.preventDefault(),t.$("#backOptionsDialog").modal("hide"),t.productOptions.addBackOption(),t.save();var i=t.product.getLayoutIndex(t.product.BACK_PAGE);t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,i),t.app.views.toolbarView.updateNavButtons()},i}(Backbone.View);e.BackOptionsDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.template=t._.template('<div id="busyModal" class="modal small-modal fade" tabindex="-1" role="dialog" aria-labelledby="errorTitle" aria-hidden="true">    <div class="modal-header">        <h3 id="busyTitle"><%= title %></h3>    </div>    <div class="modal-body">        <center>            <p><%= message %></p>            <p style="text-align: center">                <img id="busyImage" src="<%= busyIconUrl %>"/>            </p>        </center>    </div>    <div class="modal-footer">    </div></div>'),this.events={},e.call(this,i)}return __extends(i,e),i.prototype.render=function(){var e={title:this.title,message:this.message,busyIconUrl:t.config.busyIcon()},i=this.template(e);if(t.$(i).modal("show"),0==t.$("#busyModal").length)var o=setInterval(function(){t.$("#busyModal").length>0&&(clearInterval(o),t.$("#busyModal").on("hidden",function(){t.$("#busyModal").remove()}))},100);return this},i.prototype.hide=function(){t.$("#busyModal").modal("hide"),t.$("#busyModal").remove()},i}(Backbone.View);e.BusyDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(){this.setElement(t.$("body"),!0),this.cancelPeepSession_template=t._.template('<div class="modal mid-size-modal fade" id="cancelPeep_dialog">    <div class="modal-header"><h3>Cancel Peep Session</h3></div>    <div class="modal-body">      <p>Are you sure you want to close this Peep editing session? All current changes will be lost.</p>    </div>    <div class="modal-footer">        <a href="#" class="btn" data-dismiss="modal">no, stay in session</a>        <a href="#" class="btn btn-blue" id="cancelPeepSession">yes, cancel session</a>    </div></div>'),this.events={"click #cancelPeepSession":"cancelPeepSession"},this.removeEvent="",t._.bindAll(this,"render"),e.call(this)}return __extends(i,e),i.prototype.render=function(){var e={},i=this.cancelPeepSession_template(e);return 0==t.$("#cancelPeep_dialog").length?t.$(i).modal():(t.$("#cancelPeep_dialog").replaceWith(i),t.$("#cancelPeep_dialog").modal("show")),this},i.prototype.cancelPeepSession=function(){t.$("#cancelPeep_dialog").modal("hide"),t.$("#cancelPeep_dialog").remove(),t.events.trigger(t.events.PEEPS_CANCEL_CONFIRM)},i}(Backbone.View);e.CancelPeepSessionDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.confirmTemplate=t._.template('<div id="confirmDialog" class="modal-container">    <div class="VAlignHelper"></div>    <div class="modal small-modal">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3>Confirm Reset</h3>        </div>        <div class="modal-body">            <p><strong>Are you sure you want to reset the design?</strong></p>            <p>You will lose any recent personalizations made to the product. <br />Press Ok to proceed.</p>        </div>        <div class="modal-footer">            <a href="#" class="btn" data-dismiss="modal">cancel</a>            <a id="confirmOkButton" href="#" class="btn btn-blue">ok</a>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.events={"click #confirmOkButton":"onOkClick"},t._.bindAll(this,"render"),e.call(this,i)}return __extends(i,e),i.prototype.render=function(){if(0==t.$("#confirmDialog").length){var e=this.confirmTemplate({});t.$(e).modal("show")}else t.$("#confirmDialog").modal("show");return this},i.prototype.onOkClick=function(e){e.preventDefault(),t.$("#confirmDialog").modal("hide"),t.$("#productDetailName").html(t.config.productNameHTML()),t.events.trigger(t.events.RESET_DESIGN)},i}(Backbone.View);e.ConfirmDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.template=t._.template('<div id="errorModal" class="modal-container fade">    <div class="VAlignHelper"></div>    <div class="modal small-modal" tabindex="-1">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3 id="errorTitle"><%= title %></h3>        </div>        <div class="modal-body">            <p><%= message %></p>        </div>        <div class="modal-footer">            <button class="btn" data-dismiss="modal">Close</button>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.events={},e.call(this,i)}return __extends(i,e),i.prototype.render=function(){var e={title:this.title,message:this.message},i=this.template(e);if(t.$(i).modal("show"),0===t.$("#errorModal").length)var o=setInterval(function(){t.$("#errorModal").length>0&&(clearInterval(o),t.$("#errorModal").on("hidden",function(){t.$("#errorModal").remove()}))},100);return this},i.prototype.hide=function(){t.$("#errorModal").modal("hide"),t.$("#errorModal").remove()},i}(Backbone.View);e.Error=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(){this.image="",this.setElement(t.$("body"),!0),this.imageZoom_template=t._.template('<div class="modal" id="image_zoom_dialog">    <div class="modal-header">        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>        <h3>Image Preview</h3>    </div>    <div class="modal-body" id="image_zoom">    </div></div>'),t._.bindAll(this,"render"),e.call(this)}return __extends(i,e),i.prototype.render=function(){var e=this.$("#"+this.image.id),i=(e.data("userimage")?t.config.getFile():"")+e.data("imgurl"),o=t.$('<img src="'+i+'"/>');if(this.$imageZoom&&this.$imageZoom.empty(),!this.$dialog){var n=this.imageZoom_template({});this.$dialog=t.$(n),this.$imageZoom=t.$("#image_zoom",this.$dialog)}return this.$imageZoom.append(o),this.$dialog.modal("show"),this},i}(Backbone.View);e.ImageZoom=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.confirmTemplate=t._.template('<div id="offlineDialog" class="modal-container">    <div class="VAlignHelper"></div>    <div class="modal small-modal">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3>Internet Connection Error</h3>        </div>        <div class="modal-body">            <p><strong>We have detected a network connectivitly error. </strong></p>            <p>Please check your device for internet accessability.</p>        </div>        <div class="modal-footer">            <a id="confirmOkButton" href="#" class="btn btn-blue">ok</a>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.events={"click #confirmOkButton":"onOkClick"},t._.bindAll(this,"render"),e.call(this,i)}return __extends(i,e),i.prototype.render=function(){if(0==t.$("#offlineDialog").length){var e=this.confirmTemplate({});t.$(e).modal("show")}else t.$("#offlineDialog").modal("show");return this},i.prototype.hideDialog=function(){t.$("#offlineDialog").modal("hide")},i.prototype.onOkClick=function(e){e.preventDefault(),t.dialogs.hideOfflineDialog()},i}(Backbone.View);e.Offline=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.isRendered=!1,this.fileId=null,this.editorId=null,this.template=t._.template('<div id="peepsEditor" class="modal peep fade" tabindex="-1" data-backdrop="static" role="dialog" aria-labelledby="peepsEditor" aria-hidden="true">    <div class="modal-header peep-header">        <h3>create my peeps family</h3>        <span id="peep-add-note"> - Add up to 10 peeps per family</span>        <div id="spacing-controls"><img id="space-less" src="" alt="Less Space"> <img id="space-more" src="" alt="More Space"></div>    </div>    <div class="modal-body">        <div id="peep-create" class="row">            <div class="span5">                <div class="peep-panel">                    <p><strong>Start from scratch</strong></p>                    <div>                        <img id="imgCreateFamily" src="" alt="Start Peep Family" />                    </div>                </div>            </div>            <div class="span6 left-border">                <div class="peep-panel">                    <p><strong>Or use another design as a template</strong></p>                    <p id="noPeepTemplates">You currently do not have any saved peeps. Get started right away by Creating a Peep Family. Once you have at least one family created, you can reuse those families as templates for new families.</p>                    <div id="peepTemplates"></div>                </div>            </div>        </div>        <div id="peep-edit" class="row">            <div id="peepAttributeEditor" class="text-flyout" style="position:absolute; display:none;"></div>            <div id="startPeepInstruction">                <p><strong>Personalize your family</strong></p>                <p>Personalize your Peep family by dragging a Peep below into the &quot;Peep Canvas&quot;. Customize the individual Peeps by adding a label, change the fonts, and change individual colors for your Peeps.</p>            </div>            <canvas id="peepsCanvas"></canvas>        </div>    </div>    <div id="peep-editor-content">        <div id="peep-category-tabs" class="tabbable tabs-top">            <ul class="nav nav-tabs"></ul>        </div>        <div id="peeps-category-content" class="tab-content"></div>    </div>    <div class="modal-footer peep-footer">        <button id="peep-cancelProjectButton" class="btn btn-secondary-config modal-secondary" aria-hidden="true">Cancel</button>        <button id="peep-saveProjectButton" class="btn btn-primary-config" aria-hidden="true">Save and Continue</button>    </div></div>'),this.editorMode="create",this.events=t.isMobile()?{"click #peep-saveProjectButton":"onSaveClick","click #peep-cancelProjectButton":"onCancelClick","click #imgCreateFamily":"onCreateFamilyClick","click #space-less":"onSpaceLessClick","click #space-more":"onSpaceMoreClick","click .peep-thumb":"onMobileAddPeep"}:{"click #peep-saveProjectButton":"onSaveClick","click #peep-cancelProjectButton":"onCancelClick","click #imgCreateFamily":"onCreateFamilyClick","click #space-less":"onSpaceLessClick","click #space-more":"onSpaceMoreClick","mousedown .peep-thumb img":"onSetImageInfo","dblclick .peep-thumb img":"onPeepDoubleClick"},t.events.on(t.events.PEEPS_CLEANSE,this.reset,this),t.events.on(t.events.PEEPS_LOAD,this.onSaveComplete,this),t.events.on(t.events.PEEPS_CANCEL_CONFIRM,this.onCancelConfirm,this),t.events.on(t.events.PEEPS_LOGIN_COMPLETE,this.onPeepsLoginComplete,this),t._.bindAll(this,"render"),e.call(this,i)}return __extends(i,e),i.prototype.reset=function(){this.fileId=null,this.editorId=null,this.editorMode="create"},i.prototype.render=function(){if(0==t.$("#peepsEditor").length){var e=this.template();t.$(e).modal("show");var i=setInterval(function(){t.$("#peepsEditor").length>0&&(clearInterval(i),t.app.views.dialogs.peepsEditor.setEditorState(),t.app.views.dialogs.peepsEditor.loadTemplates(),t.app.views.dialogs.peepsEditor.setPeepCategoriesTabs(),t.$("#imgCreateFamily").attr("src",t.config.baseAssetUrl()+"img/StartFamily.png"),t.$("#space-less").attr("src",t.config.baseAssetUrl()+"img/pad-left.png"),t.$("#space-more").attr("src",t.config.baseAssetUrl()+"img/pad-right.png"),t.$("#peepsEditor").modal({backdrop:"static",keyboard:!1}),t.utils.HtmlUtil.createTooltip("space-less","Remove padding between Peeps.","bottom"),t.utils.HtmlUtil.createTooltip("space-more","Add padding between Peeps.","bottom"))
},50)}else t.$("#peepsEditor").modal("show"),t.app.views.dialogs.peepsEditor.setEditorState();return this},i.prototype.loadTemplates=function(){if(t.app.userPeepImages.length>0){t.$("#noPeepTemplates").hide(),t.$("#peepTemplates").empty();for(var e="",i="",o=0;o<t.app.userPeepImages.length;o++){var n=t.app.userPeepImages[o];n.hasOwnProperty("errorCode")||t.utils.ObjectUtil.notUndefined(n.code)&&"E"==n.code.charAt(0)||(i=t.config.getImageURL()+"/services/UGCGetFileFromServer/"+n.thumbnailImageURL,i=t.utils.AppUtil.appendAuthToken(i),e+='<img src="'+i+'" class="peep-template" width="100" height="100" alt="Peep Template" data-id="'+n.fileId+'" />')}t.$("#peepTemplates").append(e),t.$("#peepTemplates").on("click","img",this.onTemplateClick)}},i.prototype.onTemplateClick=function(e){var i=e.currentTarget.dataset.id;i?t.app.views.dialogs.peepsEditor.setEditorMode("edit",!0,i):t.dialogs.displayDialog("Missing Peep","We were unable to locate the Peep family. Please try a different one or create a new family.")},i.prototype.onSetImageInfo=function(e){var i=e.target.id;t.dragObj={},t.dragObj.elementId=i},i.prototype.onMobileAddPeep=function(e){e.preventDefault();var i=e.target.id;t.dragObj={},t.dragObj.elementId=i,t.events.trigger(t.events.PEEPS_ADD_MOBILE_PEEP)},i.prototype.onPeepDoubleClick=function(e){e.preventDefault();var i=e.target.id;t.dragObj={},t.dragObj.elementId=i,t.events.trigger(t.events.PEEPS_ADD_MOBILE_PEEP)},i.prototype.getSVGPathById=function(e){if(t.app.userPeepImages.length>0)for(var i=0;i<t.app.userPeepImages.length;i++)if(t.app.userPeepImages[i].fileId===e)return t.app.userPeepImages[i].rawImageURL;return null},i.prototype.setEditorMode=function(e,i,o,n){if("undefined"==typeof i&&(i=!0),"undefined"==typeof o&&(o=""),"undefined"==typeof n&&(n=""),"create"===e||"edit"===e){if(this.editorMode=e,"edit"===e)if(i&&""==o);else{i||(this.fileId=o,t.peepsManager.peepsFileId=o,""!=n&&(this.editorId=n));var s,a=t.app.views.dialogs.peepsEditor.getSVGPathById(o);a&&(s=t.config.getImageURL()+"/services/UGCGetFileFromServer/"+a,s=t.utils.AppUtil.appendAuthToken(s),t.peepsManager.loadPeepSVG(s))}}else this.editorMode="create";this.render()},i.prototype.setEditorState=function(){"edit"===this.editorMode?(t.$("#peep-create").hide(),t.$("#peep-edit").show(),t.$("#peep-editor-content").show(),t.$("#saveProjectButton").show()):"create"===this.editorMode&&(t.$("#peep-create").show(),t.$("#peep-edit").hide(),t.$("#peep-editor-content").hide(),t.$("#saveProjectButton").hide())},i.prototype.setPeepCategoriesTabs=function(){t.$("#peep-category-tabs ul").empty(),t.$("#peeps-category-content").empty();var e=[];e=t.peepsManager.getPeepCategories();for(var i="",o="",n=0;n<e.length;n++)o="peep-cat-"+n,i+=0!=n?"<li class='peepCategory'><a href='#"+o+"' data-toggle='tab' >"+e[n]+"</a></li>":"<li class='active peepCategory'><a href='#"+o+"' data-toggle='tab' >"+e[n]+"</a></li>",this.setPeepCategoriesContent(e[n],n);t.$("#peep-category-tabs ul").append(i),this.isRendered||(this.isRendered=!0,t.app.views.peepsCanvasView=new t.views.PeepsCanvasView,t.app.views.peepsCanvasView.render())},i.prototype.setPeepCategoriesContent=function(e,i){var o="";o+=0!=i?'<div class="tab-pane" id="peep-cat-'+i+'">':'<div class="tab-pane active" id="peep-cat-'+i+'">';for(var n,s=t.peepsManager.getPeepContentByName(e),a="",r=0;r<s.peeps.length;r++)n=s.peeps[r],a=t.config.getImageURL()+n.thumbnailFilePath+"/Thumbnails/"+n.thumbnailFileName,o+="<div class='peep-thumb'><img id='"+n.code+"' src='"+a+"' alt='"+n.displayName+"' width='100' height='100' draggable='true' /><span>"+n.displayName+"</span></div>";o+="</div>",t.$("#peeps-category-content").append(o)},i.prototype.onPeepsLoginComplete=function(){this.onSaveClick()},i.prototype.onSaveClick=function(){t.config.isRegistered()?t.app.views.peepsCanvasView.peepFamily.editors.length>0?t.app.views.peepsCanvasView.peepFamily.save():t.dialogs.displayDialog("Nothing to Save","You currently have no Peeps to save. Please add at least one Peep to your family, then try saving this Peep to your account."):t.dialogs.displayUserDialog("peeps")},i.prototype.onSaveComplete=function(){t.events.trigger(t.events.PEEPS_CLEANSE),this.hide()},i.prototype.onCancelClick=function(){t.dialogs.displayCancelPeepDialog()},i.prototype.onCancelConfirm=function(){t.events.trigger(t.events.PEEPS_CLEANSE),this.hide()},i.prototype.onCreateFamilyClick=function(){this.setEditorMode("edit")},i.prototype.onSpaceLessClick=function(){t.events.trigger(t.events.PEEPS_SPACING_ADJUSTMENT,-1)},i.prototype.onSpaceMoreClick=function(){t.events.trigger(t.events.PEEPS_SPACING_ADJUSTMENT,1)},i.prototype.hide=function(){t.$("#peepsEditor").modal("hide")},i.EDITOR_CREATE=0,i.EDITOR_TEMPLATE=1,i.EDITOR_SAVED=2,i}(Backbone.View);e.PeepsEditor=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.autoAdd=!1,this.setElement(t.$("#config-container"),!0),this.uploadTemplate=t._.template('<div id="uploadPhotoModal" class="modal-container">    <div class="VAlignHelper"></div>    <div class="modal" tabindex="-1" role="dialog" aria-labelledby="uploadPhotoTitle" aria-hidden="true">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3 id="uploadPhotoTitle">Add Image</h3>            <div id="uploadErrorMessage" class="alert alert-error" style="display: none"></div>        </div>        <div class="modal-body upload-img-modal">            <div class="tabbable tabs-left upload-nav-tabs">                <ul id="photoUploadTabs" class="nav nav-tabs">                    <li id="ugcUploadTab" class="active"><a href="#upload" data-toggle="tab"><i class="sprite sprite-inline sprite-icon_photos"></i><span class="text">Upload photos</span></a></li>                    <li id="libraryUploadTab"><a href="#library" data-toggle="tab"><i class="sprite sprite-inline sprite-icon_graphics"></i><span class="text">Stock art</span></a></li>                    <li><a href="#facebook" data-toggle="tab"><i class="sprite sprite-inline sprite-fb_icon"></i><span class="text">Facebook</span></a></li>                    <li><a href="#picasa" data-toggle="tab"><i class="sprite sprite-inline sprite-icon_picassa"></i><span class="text">Picasa</span></a></li>                </ul>            </div>            <div class="tab-content">                <div class="tab-pane active" id="upload">                    <p id="uploadTitle">Upload a photo to your account.</p>                    <p id="uploadSigninTitle">Upload your photo or <a id="signinLink" href="#" >sign in</a> if you have saved a photo to your account.</p>                    <div class="well well-small" style="margin-right: 25px">                        <p>Click Browse to select photos to upload from your computer.                        <form id="photoUploadDialogForm" enctype="multipart/form-data"></p>                            <input type="file" id="photoUploadDialogFile" name="photoUploadDialogFile">                        </form>                        <p>You can upload several photos at once to save time. (jpg, jpeg, png, gif, bmp, tiff and tiff up to 20MB each)</p>                    </div>                    <ul class="sidebar-img-thumb" id="myPhotosDialog"></ul>                </div>                <div class="tab-pane" id="library">                    <h4>Add images from the stock art library</h4>                    <p>                        <span>Select Category: <select id="photoUploadGraphics" contenteditable="true"></select> <span class="input-append">                                <input class="span2" id="dialog_graphicSearch" style="box-sizing: content-box" type="text">                                <span class="add-on"><i class="icon-search"></i> </span>                            </span>                        </span>                    </p>                    <p>Select an image and click "Add Image" to insert it.</p>                    <div class="photo-gallery">                        <div class="img-pagination">                        </div>                        <ul id="photoUploadGraphicsContainer" class="sidebar-img-thumb"></ul>                    </div>                </div>                <div class="tab-pane" id="facebook">                    <div class="tab-title VAlignHelper2">                        <i class="sprite-fb_title"></i>                    </div>                    <hr/>                    <h5>Are your photos stored in your Facebook account?</h5>                    <p>Just sign in and give us access to your account so you can select photos you&#39;d like to add. And don&#39;t worry -- that doesn&#39;t mean we&#39;ll have access to your login information or any other personal information.</p>                    <a id="facebookButton" href="#">                        <i class="sprite-fb_login_btn"></i>                    </a>                    <!--<button id="facebookButton" class="btn btn-primary-config">Connect to Facebook</button>&lt;!&ndash;TODO: Replace with Facebook styled login button&ndash;&gt;-->                </div>                <div class="tab-pane" id="picasa">                    <div class="tab-title VAlignHelper2">                        <i class="sprite-pic_title"></i>                    </div>                    <hr/>                    <h5>Are your photos stored in your Picasa account?</h5>                    <p>Just sign in and give us access to your account so you can select photos you&#39;d like to add. And don&#39;t worry -- that doesn&#39;t mean we&#39;ll have access to your login information or any other personal information.</p>                    <button id="picasaButton" class="btn btn-primary-config">Sign In</button><!--TODO: Replace with Picasa styled login button-->                </div>            </div>        </div>        <div class="modal-footer">            <p class="photoRights">Respect the rights of others. Ensure that you have the rights to use the images you upload.<br/><a id="photoUsageLink" href="#">Terms of Photo Usage</a> <a id="photoRequirementsLink" href="#">Photo Size and Format Requirements.</a></p>            <button id="closeButton" class="btn btn-secondary-config modal-secondary" aria-hidden="true">Cancel</button>            <button id="okButton" class="btn btn-primary-config" aria-hidden="true">Done</button>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.photoTemplate=t._.template('<li data-file-id="<%= fileId %>">    <a href="#" class="img-thumb">        <span class="VAlignHelper"></span>        <img id="<%= imagePrefix %><%= index %>" src="<%= imageUrl %>"             data-canvasurl="<%= previewImageUrl %>" data-file-id="<%= fileId %>" data-type="<%= type %>"             data-origwidth="<%= width %>" data-origheight="<%= height %>" class="photos" draggable="true"             data-userimage="<%= userImage %>" data-name="<%= name %>" data-id="<%= imagePrefix %><%= index %>" />        <span class="VAlignHelper"></span>    </a>    <a id="selected<%= imagePrefix %><%= index %>" href="#" class="sprite-inline sprite-icon_active selphoto" data-selected-file-id="<%= fileId %>" data-name="<%= name %>"></a>    <div class="thumb-img-control">        <a href="#" class="sprite-inline sprite-mobile_add addphoto" title="add image" id="add_<%= imagePrefix %><%= index %>" data-id="<%= imagePrefix %><%= index %>"></a>        <a href="#" class="sprite-inline sprite-icon_delete remphoto" id="remove<%= imagePrefix %><%= index %>" data-file-id="<%= fileId %>" title="delete" data-imgurl="<%= imageUrl %>"></a>        <a href="#" class="sprite-inline sprite-icon_zoom zoomphoto" id="zoom<%= imagePrefix %><%= index %>" title="zoom" data-userimage="<%= userImage %>" data-imgurl="<%= previewImageUrl %>"></a>    </div>    <div class="img-thumb-text"><%= name %></div></li>'),this.onImageClickedThrottled=t._.debounce(this.onImageClick,400,!0),this.events={"click #closeButton":"hide","click #photoUploadDialogFile":"onUploadClick","change #photoUploadDialogFile":"onFileSelected","change #photoUploadGraphics":"getGraphics","click #facebookButton":"onFacebookClick","click #picasaButton":"onPicasaClick","click #okButton":"onOkClick","click #signinLink":"onSigninClick","click #photoUsageLink":"onPhotoUsageClick","click #photoRequirementsLink":"onPhotoRequirementsClick","blur #dialog_graphicSearch":"doSearch","click .icon-search":"doSearch","click [id^=addPhoto]":"onImageClickedThrottled","click [id^=addGraphic]":"onImageClickedThrottled"},t._.bindAll(this,"render"),e.call(this,i),t.events.on(t.events.LOAD_GRAPHICS_MODAL,this.onGraphicsLoaded,this),this.selectedImages=[]}return __extends(i,e),i.prototype.onUploadClick=function(){return t.utils.AppUtil.checkImageUploadLimit(t.app.userImages.length)?!0:!1},i.prototype.onSigninClick=function(e){e.preventDefault(),this.hide(),t.dialogs.displayUserDialog("upload")},i.prototype.onPhotoUsageClick=function(){var e="Terms of Photo Usage",i="Images which are copyrighted will not be accepted. Copyright infringement issues and claims will be the sole responsibility of the customer. It is your responsibility for the photo you have submitted. We reserve the right to reject any image(s) submitted for reproduction.";t.dialogs.displayDialog(e,i)},i.prototype.onPhotoRequirementsClick=function(){var e="Photo Size and Format Requirements",i='<p>Our photo upload feature supports a number of image formats, including JPG, JPEG, GIF, PNG, BMP, TIF and TIFF. Note: Only photos smaller than 20MB can be uploaded. To save time, you can upload multiple photos at one time.</p><p><strong>Making your photos smaller for upload</strong></p><p>Check out <a href="http://www.picresize.com/" target="_blank">http://www.picresize.com/</a> or <a href="http://www.shrinkpictures.com/" target="_blank">http://www.shrinkpictures.com/</a> - both are free online image crop sites to help convert, crop, rotate, or edit images. Upload the photo and select a new photo size. The resized photo is displayed in your browser, then save it back to your computer.</p><p>Google&apos;s <a href="http://picasa.google.com/" target="_blank">Picasa</a> is a free tool for organizing, editing, and sharing your photos. Picasa can also help you resize your photos.</p>';t.dialogs.displayDialog(e,i)},i.prototype.setupGraphics=function(e,i){if(e=e.find("#libraryUploadTab")[i?"show":"hide"]().end(),!i)return e;var o=e.find("#photoUploadGraphics"),n=t.app.imageLibrary.getImageCategories();o=o.empty().show().append('<option value="0">-- Choose --</option>');for(var s=0;s<n.length;s++){var a=n[s];o=o.append('<option value="'+a._webserverPath+'">'+a._categoryDisplayName+"</option>")}return o=o.find("option:nth-child(2)").attr("selected","selected").end(),e=o.end()},i.prototype.toggleTitle=function(t,e){return t=t.find("#uploadTitle")[e?"show":"hide"]().end(),t.find("#uploadSigninTitle")[e?"hide":"show"]().end()},i.prototype.render=function(e,i,o){if("undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=!0),"undefined"==typeof o&&(o=!0),this.autoAdd=e,this.allowMultiselect=i,o=o&&t.app.imageLibrary.hasImageCategories(),!this.$photoUpload){var n=this.uploadTemplate({}),s=t.$(n);s=this.toggleTitle(s,t.config.isRegistered()),s=this.setupGraphics(s,o),s.on("hidden.bs.modal",function(){s.remove()}),this.$photoUpload=s}return this.loadUserImages(),this.getGraphics(),t.$("#uploadErrorMessage",this.$photoUpload).css("display","none"),t.$("#photoUploadTabs a:first",this.$photoUpload).tab("show"),this.resetSelectedImages(),this.$photoUpload.modal(),this.setElement(this.$photoUpload,!0),this},i.prototype.getImageUrl=function(e){var i=t.config.getFile()+e;return i=t.utils.AppUtil.appendAuthToken(i)},i.prototype.getImagePreviewUrl=function(e){return t.utils.AppUtil.appendAuthToken(e)},i.prototype.getTemplateParameters=function(t,e,i,o){var n=!t.hasOwnProperty("_name"),s='bbox.log("'+(n?"Image":"Graphic")+'loading error!")',a={fileId:n?t.fileId:t._name,imagePrefix:i,index:e,imageUrl:n?this.getImageUrl(t.thumbnailImageURL):t.thumbnailURL,name:n?"":t._name.replace("_"," "),previewImageUrl:n?this.getImagePreviewUrl(t.previewImageURL):t.previewURL,userImage:n,width:t.width,height:t.height,type:o,onError:s};return a},i.prototype.toggleSelected=function(e,i){"undefined"==typeof i&&(i=!1);var o=t.app.views.canvasView.isImageOnCanvas(e.data("fileId")),n=e.find("a.sprite-icon_active");return n[o&&!i?"show":"hide"]().end()},i.prototype.toggleMobileAdd=function(e,i){"undefined"==typeof i&&(i=!1);var o=t.isMobile();return e.find("a.sprite-mobile_add")[o&&!i?"show":"hide"]().end()},i.prototype.toggleName=function(e,i){"undefined"==typeof i&&(i=!1);var o=!t.isMobile()&&"graphic"===e.data("type");return e.find("div.img-thumb-text")[o&&!i?"show":"hide"]().end()},i.prototype.toggleRemove=function(t,e){"undefined"==typeof e&&(e=!1);var i=t.find("img").data("userimage");return t.find("a.remphoto")[i&&!e?"show":"hide"]().end()},i.prototype.toggleZoom=function(t,e){return"undefined"==typeof e&&(e=!1),t.find("a.zoomphoto")[e?"hide":"show"]().end()},i.prototype.processNewImage=function(e,i,o,n,s,a){"undefined"==typeof a&&(a={});var r=this.getTemplateParameters(i,e,n,s),l=this.photoTemplate(r),h=t.$(l);h=this.toggleSelected(h,a.hide_selected||!1),h=this.toggleMobileAdd(h,a.hide_mobileAdd||!1),h=this.toggleName(h,a.hide_name||!1),h=this.toggleRemove(h,a.hide_remove||!1),h=this.toggleZoom(h,a.hide_zoom||!1),o.append(h)},i.prototype.loadUserImages=function(){var e=t.$("#myPhotosDialog",this.$photoUpload),i={hide_mobileAdd:!0,hide_name:!0,hide_remove:!0,hide_zoom:!0};e.empty();for(var o=0;o<t.app.userImages.length;o++){var n=t.app.userImages[o];n.hasOwnProperty("errorCode")||t.utils.ObjectUtil.notUndefined(n.code)&&"E"==n.code.charAt(0)||this.processNewImage(o,n,e,"addPhoto","image",i)}},i.prototype.onGraphicsLoaded=function(e){var i=t.$("#photoUploadGraphicsContainer",this.$photoUpload),o={hide_mobileAdd:!0,hide_name:!0,hide_remove:!0,hide_zoom:!0};t.app.photoUploadGraphics=t.utils.JsonUtil.getList(e.image),i.empty();for(var n=0;n<e.image.length;n++)this.processNewImage(n,e.image[n],i,"addGraphic","graphic",o)},i.prototype.resetSelectedImages=function(){var e=this;this.selectedImages&&this.selectedImages.length>0&&t._.each(this.selectedImages,function(i){var o=t.$("#selected"+i,e.$photoUpload);o.css("display","none")}),this.selectedImages=[]},i.prototype.doSearch=function(){var e={productCode:t.config.productCode(),graphicsPath:t.$("#photoUploadGraphics",this.$photoUpload).val(),keyword:t.$.trim(t.$("#dialog_graphicSearch").val()),libraryType:"images"};t.events.trigger(t.events.KEYWORD_SEARCH,e)},i.prototype.onImageClick=function(e){e.preventDefault();var i=t.$(e.target);i.hasClass("bbox-selected")?(i.removeClass("bbox-selected"),this.selectedImages=t._.without(this.selectedImages,e.target.id)):(this.allowMultiselect?this.selectedImages.push(e.target.id):(this.selectedImages[0]&&t.$("#"+this.selectedImages[0]).removeClass("bbox-selected"),this.selectedImages[0]=e.target.id),i.addClass("bbox-selected"),t.$("#uploadErrorMessage").css("display","none"))},i.prototype.onFacebookClick=function(t){this.openExternalContainer(t,"#getFacebookImages")},i.prototype.onPicasaClick=function(t){this.openExternalContainer(t,"#getGoogleImages")},i.prototype.openExternalContainer=function(e,i){e.preventDefault();var o=window;t.utils.ObjectUtil.notUndefined(o.$.fancybox)&&o.$.fancybox.open({href:i}),this.hide()},i.prototype.onFileSelected=function(){this.autoAdd?t.imageManager.fileUpload("photoUploadDialogFile",!0):"ap_menu_background_tab"==t.app.views.assetPanelView.currentTab()?t.imageManager.fileUpload("photoUploadDialogFile",!0):t.imageManager.fileUpload("photoUploadDialogFile",!1),this.hide()},i.prototype.getGraphics=function(){var e=t.$("#photoUploadGraphics",this.$photoUpload).val();t.imageManager.getGraphics(e,t.events.LOAD_GRAPHICS_MODAL)},i.prototype.hide=function(){this.selectedImages=[],t.$("#uploadPhotoModal").modal("hide")},i.prototype.onOkClick=function(){return!this.selectedImages||this.selectedImages.length<=0?(t.$("#uploadErrorMessage").html("Please select an image to add."),void t.$("#uploadErrorMessage").show()):(this.selectedImages=t._.uniq(this.selectedImages),t._.each(this.selectedImages,function(e){e.split("modalGraphic").length>1&&t.$("#"+e).removeClass("bbox-selected")}),t.events.trigger(t.events.ADD_IMAGES,this.selectedImages,!1),this.selectedImages=[],void this.hide())},i}(Backbone.View);e.PhotoUpload=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.promoteBackgroundTemplate=t._.template('<div id="promoteBackgroundDialog" class="modal-container">    <div class="VAlignHelper"></div>    <div class="modal small-modal">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3>Set image as background?</h3>        </div>        <div class="modal-body">            <p>We noticed that you scaled the image near the full size of the product. Did you mean for this to be the background?  Your image should extend slightly beyond the edges to account for slight deviations in the cutting process.</p>        </div>        <div class="modal-footer">            <a id="keepImageContainer" href="#" class="btn" data-dismiss="modal">keep it as is</a>            <a id="confirmBackgroundButton" href="#" class="btn btn-blue">yes, set as background</a>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.events={"click #confirmBackgroundButton":"onConfirmBackgroundClick","click #keepImageContainer":"onKeepImageClick"},t._.bindAll(this,"render"),e.call(this,i)}return __extends(i,e),i.prototype.render=function(){if(0==t.$("#promoteBackgroundDialog").length){var e=this.promoteBackgroundTemplate({});t.$(e).modal("show")}else t.$("#promoteBackgroundDialog").modal("show");return this},i.prototype.setEditor=function(t){this.editor=t},i.prototype.onConfirmBackgroundClick=function(e){e.preventDefault(),t.events.trigger(t.events.SWAP_BACKGROUND_IMAGE,this.editor.imageAsset),t.utils.CanvasUtil.remove(this.editor),t.$("#promoteBackgroundDialog").modal("hide")},i.prototype.onKeepImageClick=function(e){e.preventDefault(),t.$("#promoteBackgroundDialog").modal("hide")},i}(Backbone.View);e.PromoteBackgroundDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(){this.setElement(t.$("body"),!0),this.removeImage_template=t._.template('<div class="modal mid-size-modal fade" id="removeImage_dialog">    <div class="modal-header"><h4 style="color:#FFFFFF;">Remove Image Confirmation</h4></div>    <div class="modal-body">      <img class="img-thumb pull-left push-right10 remove-image" src="<%= imageUrl %>">      <p>        You are attempting to remove an image from your library.<br/>        This Action cannot be undone. Do you want to proceed?      </p>    </div>    <div class="modal-footer">        <a href="#" class="btn btn-danger" data-dismiss="modal">Cancel</a>        <a href="#" class="btn btn-success" id="deleteImage">Yes, remove image</a>    </div></div>'),this.events={"click #deleteImage":"deleteImage"},this.removeEvent="",t._.bindAll(this,"render"),e.call(this)}return __extends(i,e),i.prototype.render=function(){var e=this.removeEvent.currentTarget.attributes["data-imgurl"].value,i={imageUrl:e},o=this.removeImage_template(i);return 0==t.$("#removeImage_dialog").length?t.$(o).modal():(t.$("#removeImage_dialog").replaceWith(o),t.$("#removeImage_dialog").modal("show")),e&&e.indexOf("peepImages")>-1&&setTimeout(function(){t.$("#removeImage_dialog h4").text("Remove Peep Confirmation"),t.$("#removeImage_dialog .modal-body p").first().text("You are attempting to remove a Peep family from your library. This Action cannot be undone. Do you want to proceed?"),t.$("#deleteImage").text("Yes, remove peep")},300),this},i.prototype.deleteImage=function(){t.$("#removeImage_dialog").modal("hide"),t.$("#removeImage_dialog").remove(),t.events.trigger(t.events.REMOVE_IMAGE,this.removeEvent)},i}(Backbone.View);e.RemoveImageDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.saveTemplate=t._.template('<div id="saveDialog" class="modal-container">    <div class="VAlignHelper"></div>    <div class="modal small-modal">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3 id="saveTitle"><%= title %></h3>        </div>        <div class="modal-body">            <div id="saveErrorMessage" class="alert alert-error" style="display: none"></div>            <div id="saveContainer">                <p>What would you like to name your project?</p>                <input id="projectNameInput" type="text" class="save-name" placeholder="Please enter Project name" maxlength="40"/>            </div>            <div id="saveAsContainer" class="save-as-container">                <label class="current-project-name">                    <input id="currentProjectOption" type="radio" name="saveOptions" value="current" checked />Current Project: "<strong id="currentProductName"><%= name %></strong>"                </label>                <label class="new-pro-name">                    <input id="newProjectOption" type="radio" name="saveOptions" value="new" />A New Project                    <input id="newNameInput" type="text"  placeholder="Please enter Project name" value="<%= name %>" class="save-name" maxlength="40"/>                </label>            </div>        </div>        <div class="modal-footer">            <a id="cancelProjectButton" href="#" class="btn" data-dismiss="modal">cancel</a>            <button id="saveProjectButton" class="btn btn-blue" disabled>save</button>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.events={"click #saveProjectButton":"onSaveClick","change input[name=saveOptions]":"onOptionClick","click #newProjectOption":"onSetFocus","focus #newNameInput":"onSetOption","click #cancelProjectButton":"onCancelClick","keyup .save-name":"checkLength","keypress .save-name":"validateInput","paste .save-name":"validatePaste"},t._.bindAll(this,"render"),e.call(this,i),this.allowedInputRx=new RegExp("[a-zA-Z\\d_\\- ]")}return __extends(i,e),i.prototype.render=function(){var e,i=!1,o=!0,n="Save Your Project";if(e=t.product.getName()||"",t.utils.ObjectUtil.isEmpty(e)){var s=t.$.trim(t.$("#projectNameInput").val());s&&s.length>0&&(o=!1)}else n="Save Changes",i=!0,o=!1;if("cart"==t.config.productSource()&&(i=!1),0==t.$("#saveDialog").length){var a=this.saveTemplate({title:n,name:e});t.$(a).modal("show");var r=setInterval(function(){t.$("#saveDialog").length>0&&(clearInterval(r),t.dialogs.saveDialog.setView(i),t.$("#newNameInput").prop("disabled",t.$("#currentProjectOption").is(":checked")),t.$("#saveErrorMessage").css("display","none"))},100)}else t.$("#saveTitle").text(n),t.$("#newNameInput").prop("disabled",t.$("#currentProjectOption").is(":checked")),t.$("#currentProductName").text(e),t.dialogs.saveDialog.setView(i),t.$("#saveErrorMessage").css("display","none"),t.$("#saveDialog").modal("show");return t.$("#saveProjectButton").prop("disabled",o),this},i.prototype.onOptionClick=function(e){e.preventDefault(),t.$("#newNameInput").prop("disabled","newProjectOption"!=e.target.id),"newProjectOption"!==e.target.id?t.$("#saveProjectButton").prop("disabled",!1):t.$.trim(t.$("#newNameInput").val()).length>0?t.$("#saveProjectButton").prop("disabled",!1):t.$("#saveProjectButton").prop("disabled",!0)},i.prototype.setView=function(e){e?(t.$("#saveContainer").hide(),t.$("#saveAsContainer").show(),t.$("#newNameInput").val(t.utils.StringUtil.appendSuffix(t.product.getName(),"-copy"))):(t.$("#saveContainer").show(),t.$("#saveAsContainer").hide())},i.prototype.onSetFocus=function(){setTimeout(function(){t.$("#newNameInput").focus(),t.$("#newNameInput").select()},50)},i.prototype.onSetOption=function(e){e.preventDefault(),t.$("#newProjectOption").prop("checked",!0)},i.prototype.onSaveClick=function(){var t=this.checkLength(null);if(t===!1){var e=this.getSaveData();this.validateSaveData(e)}},i.prototype.onCancelClick=function(){t.$("#projectNameInput").val("")},i.prototype.getSaveData=function(){var e={};return e.inputElementId=t.$("#saveContainer").is(":visible")?"projectNameInput":"newNameInput",e.projectName=t.product.getName(),e.newDesign=!1,e.validationResult=t.model.ValidationResultType.VALID,(t.utils.ObjectUtil.isEmpty(e.projectName)||"new"==t.$("input[name=saveOptions]:radio:checked").val()||"cart"===t.config.productSource())&&(e.projectName=t.$("#"+e.inputElementId).val(),e.newDesign=!0),e},i.prototype.performSave=function(e){e.validationResult==t.model.ValidationResultType.VALID&&(t.$("#saveDialog").modal("hide"),t.services.save(e.projectName,e.newDesign),t.utils.HtmlUtil.sendCatalystEvent(21,"Save Design"),t.dialogs.displayBusyDialog("Status","Saving design"))},i.prototype.handleValidatedSaveData=function(e){e.validationResult==t.model.ValidationResultType.EMPTY_NAME?(t.$("#saveErrorMessage").html("Please enter a name for this project"),t.$("#saveErrorMessage").show()):e.validationResult==t.model.ValidationResultType.EXISTING_NAME?(t.$("#saveErrorMessage").html("Sorry, that name is already in use. Please choose an alternate design name."),t.$("#saveErrorMessage").show()):e.validationResult==t.model.ValidationResultType.DESIGN_LIMIT?(t.$("#saveErrorMessage").html("You have reached the maximum number of saved designs for your account. Please remove existing saved designs if you would like to add a new one."),t.$("#saveErrorMessage").show()):t.dialogs.saveDialog.performSave(e)},i.prototype.validateSaveData=function(e){0==e.projectName.trim().length&&(e.validationResult=t.model.ValidationResultType.EMPTY_NAME,this.handleValidatedSaveData(e)),e.newDesign?t.service.saveService.validateSaveData(e,this.handleValidatedSaveData):this.performSave(e)},i.prototype.validatePaste=function(t){var e=!0,i=t.originalEvent.clipboardData,o=t.originalEvent.clipboardData.types,n=i.getData("Text");if(n&&n.length>0){if(o&&o.length>0)for(var s,a=0;a<o.length;a++)if(s=o[a].split("/"),e=!1,"image"===s[0]){e=!0;break}e===!1&&(t.preventDefault(),n=this.sanitizePasteData(n),document.execCommand("insertText",!1,n))}e===!0&&t.preventDefault()},i.prototype.sanitizePasteData=function(e){var i=document.createElement("div");t.$(i).html(e),e=t.$(i).text();for(var o=e.length,n="",s=0;o>s;s++){var a=e[s];a.match(this.allowedInputRx)&&(n+=e[s])}return n},i.prototype.validateInput=function(t){var e=String.fromCharCode(t.charCode||t.which);e.match(this.allowedInputRx)||(t.preventDefault?t.preventDefault():t.returnValue=!1)},i.prototype.checkLength=function(){var e=t.product.getName()||"",i=t.$.trim(t.$("#projectNameInput").val());e.length>0&&(i=t.$.trim(t.$("#newNameInput").val()));var o=!1;return 0===i.length&&(o=!0),t.$("#saveProjectButton").prop("disabled",o),o},i}(Backbone.View);e.SaveDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.template=t._.template('<div id="sessionModal" class="modal small-modal fade" tabindex="-1" role="dialog" aria-labelledby="errorTitle" aria-hidden="true">    <div class="modal-header">        <h3><i class="sprite-inline sprite-icon_validation"></i>Your session is about to expire</h3>    </div>    <div class="modal-body">        <p id="sessionContentMessage"><%= message %></p>    </div>    <div class="modal-footer">        <button id="sessionOkButton" class="btn" aria-hidden="true">Continue</button>    </div></div>'),this.events={"click #sessionOkButton":"onOKClick"},t._.bindAll(this,"render"),e.call(this,i)
}return __extends(i,e),i.prototype.render=function(){if(0==t.$("#sessionModal").length){var e={message:this.message},i=this.template(e);t.$(i).modal("show")}else t.$("#sessionContentMessage").text(this.message),t.$("#sessionModal").modal("show");return this},i.prototype.hide=function(){t.$("#sessionModal").modal("hide")},i.prototype.onOKClick=function(t){t.preventDefault(),this.callbackFunction&&this.callbackFunction(),this.hide()},i}(Backbone.View);e.SessionDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.template=t._.template('<div id="testPreviewModal" class="modaltest fade" tabindex="-1" role="dialog" style="position: absolute">    <div class="modal-header">        <h3 id="compositionStatusContainer">Status</h3>    </div>    <div class="modaltest-body">        <ul class="nav nav-tabs" id="compositionTabs">            <li class="active"><a href="#compPreview">Composition Preview</a></li>            <li><a href="#sdxml">SDXML</a></li>        </ul>        <div class="tab-content">            <div class="tab-pane active" id="compPreview">                <div class="modaltest-section">                    <div class="modaltest-server-view">                        <p>Composition Rendering</p>                        <img id="serverPreviewImage" style="border:1px;border-style:solid;border-color:#000000;"/>                    </div>                    <div>                        <p>Client Rendering</p>                        <img id="clientPreviewImage" src="<%= client %>" style="border:1px;border-style:solid;border-color:#000000;"/>                    </div>                </div>            </div>            <div class="tab-pane" id="sdxml">                <pre id="sdxmlDisplay"></pre>            </div>        </div>   </div></div>'),this.events={},e.call(this,i)}return __extends(i,e),i.prototype.preview=function(){this.render()},i.prototype.render=function(){if(0==t.$("#compositionStatusContainer").length){var e=this.template({client:t.captureTestPreview()});t.$(e).modal("show");var i=setInterval(function(){t.$("#compositionStatusContainer").length>0&&(clearInterval(i),t.$("#compositionStatusContainer").text("Status: Calling Services... this may take a few seconds"),t.$("#clientPreviewImage").prop("src",t.captureCartPreview()),t.dialogs.testPreviewDialog.onWebproofClick())},100)}else t.$("#testPreviewModal").modal("show"),t.$("#serverPreviewImage").prop("src",""),t.$("#clientPreviewImage").prop("src",t.captureCartPreview()),t.$("#compositionStatusContainer").text("Status: Calling Services... this may take a few seconds"),this.onFragmentClick();return this},i.prototype.onWebproofClick=function(){t.$.ajax({type:"POST",url:t.config.createWebProofDirectory(),headers:t.config.getRequestHeaders(),dataType:"json",data:{userId:t.config.profileID()+"/myImages",cardId:t.config.productID(),ugcPath:t.config.ugcPath(),createPreviewDirectory:"Y",createSavedDesignDirectory:"Y"},success:function(e){t.dialogs.testPreviewDialog.previewFilePath=e.previewFilePath,t.dialogs.testPreviewDialog.previewWebPath=e.previewWebPath,t.dialogs.testPreviewDialog.onFragmentClick()},error:function(e,i){0!=e.status&&t.dialogs.displayError("Error Creating Web Proof Directory",i+"\n"+e.responseText)}})},i.prototype.onFragmentClick=function(){t.save();var e=t.product.getActiveLayout(),i=e.toJson(),o=JSON.stringify(i),n="";t.utils.AppUtil.isLocalhost()&&(n="http://qa.fidipidi.com"),t.$.ajax({type:"POST",url:n+"/ConfigPrime/rest/jsontoxmlservice",data:{jsonStr:o},dataType:"text",success:function(e){t.dialogs.testPreviewDialog.loadFragment(e)},error:function(e,i){0!=e.status&&t.dialogs.displayError("Error converting layout to XML",i+"\n"+e.responseText)}})},i.prototype.loadFragment=function(e){this.layoutXML=e;try{var i=window;t.$("#sdxmlDisplay").text(i.vkbeautify.xml(e));var o='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>';0==e.indexOf(o)&&(e=e.substring(o.length))}catch(t){}var n=t.config.getImageURL()+"/services/FragmentJobService?format=json&HCAuthToken=TestAuthToken123";t.$.ajax({type:"POST",url:n,dataType:"json",contentType:"application/json",data:JSON.stringify({InstanceXML:e,OutputPath:this.previewFilePath}),success:function(e){if(t.utils.ObjectUtil.isEmpty(e.OutputFiles))t.$("#compositionStatusContainer").text("Status: Error - Preview Image List is Empty - Job ID: "+e.JobID);else{var i=(e.OutputFiles[0],e.OutputFiles[1],e.OutputFiles[2]);t.dialogs.testPreviewDialog.displayPreview(i)}},error:function(e,i){0!=e.status&&t.dialogs.displayError("Error on Getting Fragment",i+"\n"+e.responseText)}})},i.prototype.displayPreview=function(e){var i=t.config.getFile()+this.previewWebPath+e+"?id="+t.utils.GUID.create();i=t.utils.AppUtil.appendAuthToken(i),t.$("#serverPreviewImage").unbind(),t.$("#serverPreviewImage").load(function(){var e=t.$(this).width(),i=t.$(this).height();t.$("#clientPreviewImage").prop("height",i),t.$("#clientPreviewImage").prop("width",e)}),t.$("#serverPreviewImage").prop("src",i),t.$("#compositionStatusContainer").text("Status: Complete")},i}(Backbone.View);e.TestPreview=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.upsellTemplate=t._.template('<div id="upsellDialog" class="modal-container">    <div class="VAlignHelper"></div>    <div class="modal mid-size-modal">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3>Make it Special</h3>        </div>        <div class="modal-body">            <h4>Upgrade your design to match your style!</h4>            <% bbox._.each(options, function(option){ %>            <div class="upsell-options">                <h4><%= option.label %></h4>                <% if( option.hasPreviewImage ){ %>                <div class="upsell-preview-img"><img id="<%= option.key %>Preview" /></div>                <% } %>                <div class="upsell-seletor">                    <% bbox._.each(option.list, function(productOption, index){ %>                    <label class="radio">                        <% if( productOption.sku == option.selectedSku ){ %>                        <input type="radio" class="productOptionRadio" name="<%= option.key %>" id="<%= option.key %><%= index %>Option" value="<%= productOption.sku %>" checked />                        <% } else { %>                        <input type="radio" class="productOptionRadio" name="<%= option.key %>" id="<%= option.key %><%= index %>Option" value="<%= productOption.sku %>" />                        <% } %>                        <% if( productOption.label == null ){ %>                        Back not included                        <% } else { %>                        <%= productOption.label %> - <%= productOption.getPriceLabel() %>                        <% } %>                    </label>                    <% }); %>                </div>            </div>            <% }); %>        </div>        <div class="modal-footer">            <a id="cancelOptionsButton" href="#" class="btn">no, thanks</a>            <a id="saveOptionsButton" href="#" class="btn btn-blue">continue</a>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.events={"click #saveOptionsButton":"onSaveClick","click #cancelOptionsButton":"onCancelClick","change .productOptionRadio":"onOptionClick"},t.events.on(t.events.RESET_DESIGN,this.onResetDesign,this),t._.bindAll(this,"render"),e.call(this,i)}return __extends(i,e),i.prototype.render=function(){if(0==t.$("#upsellDialog").length){if(t.productOptions.selectedOptions.length>0)for(var e=0;e<t.productOptions.selectedOptions.length;e++){var i=t.productOptions.selectedOptions[e];t.productOptions.setOption(i)}var o={options:t.productOptions.currentOptions},n=this.upsellTemplate(o);t.$(n).modal("show")}else{t.$("#upsellDialog").modal("show"),t.$("input:radio").each(function(){t.$("input:radio").prop("checked",!1)});for(var e=0;e<t.productOptions.currentOptions.length;e++)for(var s=t.productOptions.currentOptions[e],a=0;a<s.list.length;a++){var r=s.list[a],l="#"+s.key+a+"Option";if(r.sku==s.selectedSku){t.$(l).prop("checked",!0);break}t.$(l).prop("checked",!1)}}return this.backOptionApproved=t.productOptions.backOptionApproved(),this},i.prototype.onCancelClick=function(e){e.preventDefault(),t.noThanksToUpsells=!0,null!=t.productOptions&&t.productOptions.cancelOptions(),t.productOptions.backOptionApproved(),t.events.trigger(t.events.UPSELL_OPTIONS_CHANGE),t.$("#upsellDialog").modal("hide")},i.prototype.onOptionClick=function(e){if(e.preventDefault(),0==e.target.id.indexOf("BACK_OPTIONS")){var i=t.$("input[name=BACK_OPTIONS]:checked").val();return void("NONE-BACK_OPTIONS"==i&&t.productOptions.backOptionApproved()&&t.dialogs.backOptionDialog.renderRemoveModal())}if(0==e.target.id.indexOf("INK_COLOR_OPTIONS")){var o=t.$("input[name=INK_COLOR_OPTIONS]:checked").val();if(0==o.indexOf("NONE-"))return;var n=t.productOptions.getOption(o),s=t.product.getActiveLayout(),a=s.getSwatch(n.label),r=a._rgbValue;return void t.setGlobalColor(r)}if(-1!=e.target.id.indexOf("PAPER_OPTIONS")){var o=t.$("input[name=PAPER_OPTIONS]:checked").val(),l=null;if(0!=o.indexOf("NONE-")){var n=t.productOptions.getOption(o);t.$("#PAPER_OPTIONSPreview").show(),t.$("#PAPER_OPTIONSPreview").attr("src",n.previewImageUrl);var h=n.sku;l=t.app.imageLibrary.getStockImage(h)}else t.$("#PAPER_OPTIONSPreview").hide(),l=t.app.imageLibrary.getFreePaperOption();if(null!=l){var c=t.model.ImageAsset.createFromPaperstock(l);t.app.views.canvasView.changePaperstock(c)}}},i.prototype.onResetDesign=function(){t.$("div.upsell-preview-img img").attr("src","")},i.prototype.resetBackoption=function(){t.$("#BACK_OPTIONS0Option").prop("checked",!1),t.$("#BACK_OPTIONS1Option").prop("checked",!0)},i.prototype.onSaveClick=function(e){e.preventDefault(),t.productOptions.clearSelections();for(var i=t.productOptions.currentOptions,o=0;o<i.length;o++){var n=i[o],s=t.$("input[name="+n.key+"]:checked").val();n.selectedSku=s,0!=s.indexOf("NONE-")&&t.productOptions.addSelectedOption(s)}if(!this.backOptionApproved&&t.productOptions.backOptionApproved()){t.app.views.previewView.onEditClick();var a=t.product.getLayoutIndex(t.product.BACK_PAGE);t.events.trigger(t.events.SWITCH_CURRENT_LAYOUT,a),t.app.views.toolbarView.updateNavButtons()}else t.productOptions.hasBackOption();t.events.trigger(t.events.UPSELL_OPTIONS_CHANGE),t.$("#upsellDialog").modal("hide")},i}(Backbone.View);e.UpsellDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){var i=function(e){function i(i){this.setElement(t.$("body"),!0),this.signinTemplate=t._.template('<div id="signinDialog" class="modal-container">    <div class="VAlignHelper"></div>    <div class="modal mid-size-modal">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>            <h3>Sign In or Create a New Account</h3>        </div>        <div class="modal-body">            <div class = "account-type-seletor">                 <label>Enter your email address and password and sign in.  If you do not have an account, create one now.</label>                <label class="radio">                    <input id="signinOption" type="radio" name="signinOptions" value="signin" checked>Use an existing account                </label>                <label class="radio">                    <input id="registerOption" type="radio" name="signinOptions" value="register">Create a new account                </label>            </div>            <div id="signinContainer" class="account-value">                <form class="form-horizontal">                    <fieldset>                        <div class="control-group">                            <label class="control-label" for="emailInput">* Email Address</label>                            <div class="controls">                                <input type="text" id="emailInput" name="email" placeholder="" class="input-xlarge" value="<%= email %>" />                            </div>                        </div>                        <div class="control-group">                            <label class="control-label" for="passwordInput">* Password</label>                            <div class="controls">                                <input type="password" id="passwordInput" name="password" placeholder="" class="input-xlarge" value="<%= password %>"/>                            </div>                        </div>                    </fieldset>                </form>                <span>(*) required fields</span>            </div>            <div id="registerContainer" class="account-value" style="display: none;" >                <form class="form-horizontal">                    <fieldset>                        <!-- div>                            <legend class="">Create an Account</legend>                        </div -->                        <div class="control-group">                            <label class="control-label" for="registerEmailInput">* Email Address</label>                            <div class="controls">                                <input type="text" id="registerEmailInput" name="email" placeholder="" class="input-xlarge">                            </div>                        </div>                        <div class="control-group">                            <label class="control-label" for="reRegisterEmailInput">* Re-type Email</label>                            <div class="controls">                                <input type="text" id="reRegisterEmailInput" name="email" placeholder="" class="input-xlarge">                            </div>                        </div>                        <div class="control-group">                            <label class="control-label" for="registerPassword">* Password</label>                            <div class="controls">                                <input type="password" id="registerPassword" name="password" placeholder=""                                       class="input-xlarge">                            </div>                        </div>                        <div class="control-group">                            <label class="control-label" for="registerConfirmPassword">* Repeat Password</label>                            <div class="controls">                                <input type="password" id="registerConfirmPassword" name="repeatPassword" placeholder=""                                       class="input-xlarge">                            </div>                        </div>                        <div class="control-group">                            <label class="control-label" for="registerSecurityQuestion">Security Question</label>                            <div class="controls">                                <select id="registerSecurityQuestion" name="securityQuestion" class="input-xlarge">                                    <option value selected>Select</option>                                    <% bbox._.each(securityQuestions, function(item) { %>                                    <option value="<%= item.questionId %>"><%= item.question %></option>                                    <% }); %>                                </select>                            </div>                        </div>                        <div class="control-group">                            <label class="control-label" for="registerSecurityAnswer">Security Answer</label>                            <div class="controls">                                <input type="text" id="registerSecurityAnswer" name="securityAnswer" placeholder=""                                       class="input-xlarge" maxlength="60">                            </div>                        </div>                        <div class="account-options">                            <label id="ageValidInput" class="checkbox">                                <input id="ageValidCheckbox" type="checkbox"> <a id="ageValidTerms" href="#">* Terms and Conditions.</a>                            </label>                            <!--                            <label id="termsInput" class="checkbox">                                <input id="termsCheckbox" type="checkbox"> <a id="termsConditions">I agree with the Terms and Conditions of this site.</a>                            </label>                            -->                            <label class="checkbox">                                <input id="emailCheckbox" type="checkbox"> Yes, I would like to receive emails about special money saving offers.                            </label>                            <span>(*) required fields</span>                        </div>                    </fieldset>                </form>            </div>            <div id="validationMessage" class="alert alert-error" style="display: none"></div>        </div>        <div class="modal-footer">            <a href="#" class="btn" data-dismiss="modal">cancel</a>            <button id="signinButton" class="btn btn-blue">submit</button>        </div>    </div>    <div class="VAlignHelper"></div></div>'),this.events={"click #signinButton":"onSubmit","change input[name=signinOptions]":"onOptionClick","click #ageValidTerms":"onAgeValidTerms"},t._.bindAll(this,"render"),t.events.on(t.events.USER_LOGIN_COMPLETE,this.onLoginComplete,this),t.events.on(t.events.USER_LOGIN_FAILED,this.onError,this),t.events.on(t.events.USER_REGISTER_COMPLETE,this.onLoginComplete,this),t.events.on(t.events.USER_REGISTER_FAILED,this.onError,this),e.call(this,i)}return __extends(i,e),i.prototype.show=function(e){if(this.returnAction=e,0==t.$("#signinDialog").length){var i=t.config.getSecurityQuestions(),o={email:"",password:"",securityQuestions:i},n=this.signinTemplate(o);t.$(n).modal("show"),t.$("#registerContainer").hide(),t.$("#signinDialog").on("hide",function(){})}else t.$("#signinDialog").modal("show");t.$("#signinButton").prop("disabled",!1),t.$("#validationMessage").css("display","none")},i.prototype.onOptionClick=function(e){e.preventDefault(),"signinOption"==e.target.id?(t.$("#signinContainer").show(),t.$("#registerContainer").hide()):(t.$("#signinContainer").hide(),t.$("#registerContainer").show(),this.setNetworkSpecific())},i.prototype.setNetworkSpecific=function(){t.config.enableTerms()?(t.$("#ageValidInput").show(),t.$("#termsInput").hide()):(t.$("#ageValidInput").hide(),t.$("#termsInput").show())},i.prototype.onSubmit=function(){var e=t.$("input[name=signinOptions]:checked").val();"signin"===e?this.signin():this.register()},i.prototype.signin=function(){var e=t.$("#emailInput").val(),i=t.$("#passwordInput").val(),o=[];this.isPropertyValid(e)===!1?o.push("The email address entered is not valid."):this.validateEmailFormat(e)||o.push("The email address entered is not valid format."),this.isPropertyValid(i)===!1&&o.push("Password is missing."),this.errorMessageModal(o)!==!0&&(t.$("#validationMessage").css("display","none"),t.$("#signinButton").prop("disabled",!0),t.services.login(e,i))},i.prototype.register=function(){var e=t.$.trim(t.$("#registerEmailInput").val()),i=t.$.trim(t.$("#reRegisterEmailInput").val()),o=t.$.trim(t.$("#registerPassword").val()),n=t.$.trim(t.$("#registerConfirmPassword").val()),s=t.$.trim(t.$("#registerSecurityQuestion").val()),a=t.$.trim(t.$("#registerSecurityAnswer").val()),r=[];this.isPropertyValid(e)===!1?r.push("The email address entered is not valid."):this.isPropertyValid(i)===!1?r.push("The retype email address entered is not valid."):e!==i?r.push("The email addresses do not match. "):this.validateEmailFormat(e)||r.push("The email address entered is not valid format."),this.isPropertyValid(o)===!1?r.push("Password is missing."):o.length<6&&r.push("Passwords must be at least 6 characters in length."),this.isPropertyValid(n)===!1&&r.push("Re-enter Password is missing."),o!==n&&r.push("The passwords do not match."),""!==s&&this.isPropertyValid(a)===!1&&r.push("Provide an answer to your security question.");var l=!1;if(l=t.config.enableTerms()?t.$("#ageValidCheckbox").is(":checked"):!0,l||r.push("You must click the Terms and Conditions checkbox."),this.errorMessageModal(r)!==!0){var h=t.$("#emailCheckbox").is(":checked");t.$("#validationMessage").css("display","none"),t.$("#signinButton").prop(" disabled",!0),t.services.register(e,o,s,a,h)}},i.prototype.onLoginComplete=function(){t.config.setRegistered(),t.$("#validationMessage").css("display","none"),t.$("#signinButton").prop("disabled",!1),t.$("#signinDialog").modal("hide"),"upload"==this.returnAction?t.dialogs.displayUploadDialog():"save"==this.returnAction?t.dialogs.displaySaveDialog():"peeps"==this.returnAction&&t.events.trigger(t.events.PEEPS_LOGIN_COMPLETE),t.product.hasPeeps&&t.services.loadPeepFiles()},i.prototype.onError=function(e){t.$("#signinButton").prop("disabled",!1),this.showValidationMessage(e);var i=t.$("input[name=signinOptions]:checked").val();"signin"==i?(t.utils.HtmlUtil.clearFields(["emailInput","passwordInput"]),t.$("#emailInput").focus()):(t.utils.HtmlUtil.clearFields(["registerEmailInput","registerPassword","registerConfirmPassword"]),t.$("#registerEmailInput").focus())},i.prototype.onAgeValidTerms=function(t){t.preventDefault(),this.handleTerms()},i.prototype.validateEmailFormat=function(t){"undefined"==typeof t&&(t="");var e=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;return t.match(e)},i.prototype.errorMessageModal=function(e){"undefined"==typeof e&&(e=[]);var i=!1;if(e.length>0){for(var o=e.length>1?"s":"",n='<i class="sprite sprite-inline sprite-icon_validation"></i> Validation Error'+o,s="The following problem"+o+" were found trying to register:",a=1,r=0;r<e.length;r++)s+="<p>"+a+". "+e[r]+"</p>",a++;t.dialogs.displayDialog(n,s),i=!0}return i},i.prototype.handleTerms=function(){var e=t.config.termsAction();switch(e.type){case"url":window.open(e.value,"_tab");break;case"function":window[e.value]()}},i.prototype.isPropertyValid=function(t,e){"undefined"==typeof e&&(e="");var i=!0;return 0===t.length&&(i=!1,e.length>0&&this.showValidationMessage(e)),i},i.prototype.showValidationMessage=function(e){t.$("#validationMessage").html(e),t.$("#validationMessage").show()},i}(Backbone.View);e.UserDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));var bbox;!function(t){!function(e){!function(e){"use strict";var i=function(e){function i(i){t.utils.LoggingUtil.log("Image"," > bbox.views.dialogs()",t.utils.LoggingUtil.EXTRY_EXIT),t.events.on(t.events.WIZARD_DISPLAY,this.displayWizard,this),this.setElement(t.$("body"),!0),this.wizardTemplate=t._.template('<div id="WizardDialog" class="modal-container modalwizard fade in" tabindex="-1" role="dialog" aria-labelledby="errorTitle" aria-hidden="true">    <div class="modal-header">        <h3>Welome to Quick edit.</h3>    </div>    <div class="modalwizard-body">        <div  class="wizard-steps" id="wizardNavSteps">                <ul  class="pager-tabs pull-left">                    <li id="wizard0" class="active" index="0" style="">                        <a class="wizardLinks" id="wizardLink0" href="#">Text</a>                    </li>                    <li id="wizard1" index="1" style="" class="">                        <a class="wizardLinks" id="wizardLink1"  href="#">Photo</a>                    </li>                    <li id="wizard2" index="2" style="" class="">                        <a class="wizardLinks" id="wizardLink2"  href="#">Similar Products</a>                    </li>                    <p></p>                </ul>            </div>        <div class="row">        <br>        <br>        <div style="float:left;">          <div id="wizardSection">          </div>          <div id="wizardPhotoSection" style="display: none;">          </div>          <div id="wizardAddonsSection" style="display: none;">          </div>       </div>        <div class="zoomWizard" id="wizardImage" >            <img border="0" id="wizardPreviewImage"src="" alt="Preview" >        </div>      </div>    </div>    <div class="modal-footer">        <input type="checkbox" id="preserveData" value="storeData" checked>Preserve Data        <button id="wizardOkButton" class="btn" aria-hidden="true">Continue</button>    </div><div id="templateQuickInputs" style="display: none;">        <p>            <textarea rows="1" class="field span4" cols="100"></textarea>        </p></div></div>'),this.events={"click #wizardOkButton":"onOkClick","focusin #wizardSection textarea":"focusInInput","focusout #wizardSection textarea":"focusOutInput","keyup #wizardSection textarea":"updateOnKeyUp","input #wizardSection textarea":"updateOnKeyUp"},t._.bindAll(this,"render"),e.call(this,i),t.utils.LoggingUtil.log("Image"," > bbox.views.dialogs()",t.utils.LoggingUtil.EXTRY_EXIT)}return __extends(i,e),i.prototype.render=function(){if(t.selections.clear(),0==t.$("#WizardDialog").length){var e=this.wizardTemplate({});t.$(e).modal("show")}else t.$("#WizardDialog").modal("show"),t.$("#wizardNavSteps li").removeClass("active"),t.$("#wizard0").addClass("active");t.$("#wizardSection").empty();{var i=this.buildForm,o=this.navigationWizard;setTimeout(function(){i(),o(),t.utils.LoggingUtil.log("WizardDialog"," open wizard dialog",t.utils.LoggingUtil.INFO)},500)}return this},i.prototype.cloneTab=function(){var e=t.$("#sidebar").children().clone();t.$("#wizardPhotoSection").empty(),t.$(e).appendTo("#wizardPhotoSection"),t.$("#wizardSection #sidebarTabs").hide()},i.prototype.onOkClick=function(e){var i=!1;e.preventDefault(),t.$("#preserveData").is(":checked")&&(i=!0),t.wizard.setData(this.getInputs(),i),t.$("#wizardSection").empty(),t.$("#WizardDialog").modal("hide")},i.prototype.showControls=function(e){switch(e){case"0":t.$("#wizardAddonsSection").hide(),t.$("#wizardPhotoSection").hide(),t.$("#wizardSection").show(),t.$("#wizardPreviewImage").show();break;case"1":t.$("#wizardAddonsSection").hide(),t.$("#wizardSection").hide(),t.$("#wizardPreviewImage").show(),t.$("#wizardPhotoSection").show(),t.wizard.setData(this.getInputs()),this.cloneTab();break;case"2":t.$("#wizardPhotoSection").hide(),t.$("#wizardSection").hide(),t.$("#wizardPreviewImage").hide(),t.$("#wizardAddonsSection").show();break;default:this.buildForm()}},i.prototype.displayWizard=function(){t.dialogs.displayWizardDialog()},i.prototype.navigationWizard=function(){"none"!==t.$(" #photosTab").css("display")?(t.$("#wizard1").show(),t.$(".wizardLinks").click(function(){var e=this.parentElement.id;t.$("#wizardNavSteps li").removeClass("active"),t.$(" #"+e).addClass("active");var i=t.$("#"+e).attr("index");t.dialogs.wizardDialog.showControls(i)})):t.$("#wizard1").hide()},i.prototype.updateProductImage=function(e){var i=t.controls.ComponentFactory.lookupControlById(e);i.ui.strokeColor="#005CE6",i.ui.render(),i.ui.toggleHandleVisibility(!1),t.updateStage(),t.$("#wizardPreviewImage").attr("src",t.captureTestPreview(2)),t.$("#wizardImage").zoom({on:"grab"}),i.ui.strokeColor=i.ui.NO_LINE_COLOR,i.ui.render(),t.updateStage()},i.prototype.focusInInput=function(e){var i=t.$(e.currentTarget);i.select().mouseup(function(t){t.preventDefault(),i.off("mouseup")}),this.updateProductImage(i.attr("productid"))},i.prototype.focusOutInput=function(e){var i=t.$(e.currentTarget).attr("data-text");e.currentTarget.value=t.wizard.manageTextValue(e.currentTarget.value,i)},i.prototype.updateOnKeyUp=function(e){var i=t.$(e.currentTarget);return 9===e.keyCode?void i.select():void("keyup"!==e.type&&(t.wizard.preSetData(i),0==t.$(i).val().length?t.$(i).addClass("zoomDefaultText"):t.$(i).removeClass("zoomDefaultText"),t.$("#wizardPreviewImage").attr("src",t.captureTestPreview(2)),t.$("#wizardImage").zoom({on:"grab"}),t.utils.LoggingUtil.log("WizardDialog"," key up change in text area",t.utils.LoggingUtil.INFO)))},i.prototype.buildForm=function(){var e,i,o,n,s=t.wizard.getCurrentOrderedTextObjects(),a=t.product.getActiveLayout().width*t.stageZoom.scaleX,r=t.product.getActiveLayout().height*t.stageZoom.scaleX;t.$("#wizardImage").width(a).height(r);for(var l=0;l<s.length;l++)e=t.$("#templateQuickInputs").children().clone(),i=e[0].firstElementChild,0==l&&(o=i),t.$(i).attr("data-text",s[l].pageItem._defaultText),t.$(i).attr("designerLabel",s[l].pageItem._designerLabel),t.$(i).attr("productId",s[l].pageItem._id),t.$(i).attr("rows",s[l].lineCount),t.$(i).css("text-align",s[l].alignment),n=t.wizard.getKeyData(s[l].pageItem._designerLabel),t.$(e).appendTo("#wizardSection"),0==n.length?t.$(i).addClass("zoomDefaultText"):t.$(i).removeClass("zoomDefaultText"),t.$(i).val(t.wizard.manageTextValue(n,s[l].pageItem._defaultText)),n.length>0&&t.wizard.preSetData(i);t.$("#wizardPreviewImage").attr("src",t.captureTestPreview(1)),t.$("#wizardImage").zoom({on:"grab"}),t.$(o).focus(),t.$(o).select()},i.prototype.getInputs=function(){var e=t.$("#wizardSection textarea");return e},i}(Backbone.View);e.WizardDialog=i}(e.dialogs||(e.dialogs={}));e.dialogs}(t.views||(t.views={}));t.views}(bbox||(bbox={}));